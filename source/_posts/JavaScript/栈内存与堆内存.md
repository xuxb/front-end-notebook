---
title: 栈内存与堆内存
categories: JavaScript
tags: [JavaScript 原理]
date: 2021-01-27 12:24:48
---

# 栈内存与堆内存

### 1、栈内存

概念：存放基本类型的变量和对象的引用，比如 `boolean`、`string`、`number` 等，分配在栈内存区。

特点：
* 存取速度较快
* 数据可以共享
* 生命周期固定，缺乏灵活性

### 2、堆内存

概念：存放复杂数据类型（引用类型），比如 `Object`、 `Array` 等，系统不知道需要多大空间，需程序自己申请，分配在堆内存区。

特点：
* 存取速度较慢
* 存放大量数据，每份数据的地址都不一样（通过 `new` 方式创建）

### 3、为什么区分栈内存和堆内存？

通常与垃圾回收机制有关，为了使程序运行时占用的内存最小。

当一个方法执行时，每个方法都会建立自己的内存栈，在这个方法内定义的变量将会逐个放入这块栈内存里，随着方法的执行结束，这个方法的内存栈也将自然销毁了。因此，所有在方法中定义的变量都是放在栈内存中的；

当我们在程序中创建一个对象时，这个对象将被保存到运行时数据区中，以便反复利用（因为对象的创建成本通常较大），
这个运行时数据区就是堆内存。堆内存中的对象不会随方法的结束而销毁，即使方法结束后，这个对象还可能被另一个引用变量所引用（方法的参数传递时很常见），

则这个对象依然不会被销毁，只有当一个对象没有任何引用变量引用它时，系统的垃圾回收机制才会在核实的时候回收它。

![栈内存、堆内存](https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1525441275251&di=22dc34589ed420f3b6733993269f18f8&imgtype=0&src=http%3A%2F%2Fimg.1oc.cn%2F2018%2F01%2F25%2F2014093009031910.png)

> 栈使用的是一级缓存， 通常都是被调用时处于存储空间中，调用完毕立即释放
> 堆则是存放在二级缓存中，生命周期由虚拟机的垃圾回收算法来决定，调用的速度要相对来得低一些

### 4、调用栈
概念：函数中的 **调用栈（call stack）** 指由 **栈帧￼（stack frame）** 或叫 **活动记录（activation record）**构成的**栈**

函数调用的局部状态中的数据存活时间满足 “后入先出”（LIFO）顺序，与算法中的栈结构有相同的机制，所以叫做调用栈。

对于同步调用的函数，其调用逻辑是递归的，被调用者的局部信息所占空间的分配总是后于调用者的（后入），而其释放则总是先于调用者的（先出），所以使用栈结构是最简捷的一种方式（不一定必须用栈）

```
main()  a()  b()  c()
   -                         main()
   |
   +>     -                    a()
   .      |
   .      +>   -                 b()
   .      .    |
   .      .    +>   -              c()
   .      .    .    |
   .      .    +   <-              return from c()
   .      .    |
   .      +   <-                 return from b()
   .      |
   +     <-                    return from a()
   |
   -                         return from main()
```

**算法中的栈、堆、队列**
栈：一种后进先出的的数据结构
队列：一种先进先出的的数据结构
堆：可以被看成是一棵树，如：堆排序

