---
title: 技巧篇 - 动态规划 - 求买卖股票求最大利润
categories: 算法题
tags: [算法题, 技巧篇]
date: 2021-05-24 16:32:28
---

# 技巧篇 - 动态规划 - 求买卖股票求最大利润

### 买卖股票的最佳时机（leetcode 题目编号 121）
**问题：**
给定一个数组，它的第 i 个元素是一支给定股票第 i 天的价格。

如果你最多只允许完成一笔交易（即买入和卖出一支股票一次），设计一个算法来计算你所能获取的最大利润。

注意：你不能在买入股票前卖出股票。

**示例：**
示例 1:
输入: [7,1,5,3,6,4]
输出: 5
解释: 在第 2 天（股票价格 = 1）的时候买入，在第 5 天（股票价格 = 6）的时候卖出，最大利润 = 6-1 = 5 。
     注意利润不能是 7-1 = 6, 因为卖出价格需要大于买入价格；同时，你不能在买入前卖出股票。

示例 2:
输入: [7,6,4,3,1]
输出: 0
解释: 在这种情况下, 没有交易完成, 所以最大利润为 0。

**思路：**
* 遍历数组取里面的最小值作为买入价
* 每次比较遍历项与买入价的差值
* 取各差值的最大者即为最大利润

```js
var maxProfit = function(prices) {
  let res = 0;
  let buy = prices[0];

  for (let i = 1; i < prices.length; i++) {
    if (prices[i] > buy) {
      res = Math.max(res, prices[i] - buy);
    } else {
      buy = prices[i];
    }
  }

  return res;
};
```


### 买卖股票的最佳时机 II（leetcode 题目编号 122）
**问题：**
给定一个数组，它的第 i 个元素是一支给定股票第 i 天的价格。

设计一个算法来计算你所能获取的最大利润。你可以尽可能地完成更多的交易（多次买卖一支股票）。

注意：你不能同时参与多笔交易（你必须在再次购买前出售掉之前的股票）。

**示例：**
示例 1:
输入: [7,1,5,3,6,4]
输出: 7
解释: 在第 2 天（股票价格 = 1）的时候买入，在第 3 天（股票价格 = 5）的时候卖出, 这笔交易所能获得利润 = 5-1 = 4 。
     随后，在第 4 天（股票价格 = 3）的时候买入，在第 5 天（股票价格 = 6）的时候卖出, 这笔交易所能获得利润 = 6-3 = 3 。

示例 2:
输入: [1,2,3,4,5]
输出: 4
解释: 在第 1 天（股票价格 = 1）的时候买入，在第 5 天 （股票价格 = 5）的时候卖出, 这笔交易所能获得利润 = 5-1 = 4 。
     注意你不能在第 1 天和第 2 天接连购买股票，之后再将它们卖出。
     因为这样属于同时参与了多笔交易，你必须在再次购买前出售掉之前的股票。

**思路：**
* 从第二天开始，如果当前价格比之前价格高，则把差值加入利润中

```js
var maxProfit = function(prices) {
  let res = 0;
  
  for (let i = 0; i < prices.length - 1; i++) {
    if (prices[i] < prices[i + 1]) {
      res += prices[i + 1] - prices[i]
    }
  }

  return res;
};
```

### 买卖股票的最佳时机 III（leetcode 题目编号 123）
**问题：**
给定一个数组，它的第 i 个元素是一支给定的股票在第 i 天的价格。

设计一个算法来计算你所能获取的最大利润。你最多可以完成 两笔 交易。

注意: 你不能同时参与多笔交易（你必须在再次购买前出售掉之前的股票）。

**示例：**
示例 1:
输入: [3,3,5,0,0,3,1,4]
输出: 6
解释: 在第 4 天（股票价格 = 0）的时候买入，在第 6 天（股票价格 = 3）的时候卖出，这笔交易所能获得利润 = 3-0 = 3 。
     随后，在第 7 天（股票价格 = 1）的时候买入，在第 8 天 （股票价格 = 4）的时候卖出，这笔交易所能获得利润 = 4-1 = 3 。

示例 2:
输入: [1,2,3,4,5]
输出: 4
解释: 在第 1 天（股票价格 = 1）的时候买入，在第 5 天 （股票价格 = 5）的时候卖出, 这笔交易所能获得利润 = 5-1 = 4 。   
     注意你不能在第 1 天和第 2 天接连购买股票，之后再将它们卖出。   
     因为这样属于同时参与了多笔交易，你必须在再次购买前出售掉之前的股票。

**思路：**
* 定义 `local[i][j]` 为在到达第 `i` 天时最多可进行 `j` 次交易并且**最后一次交易在最后一天卖出**的最大利润，此为局部最优
* 定义 `global[i][j]` 为在到达第 `i` 天时最多可进行 `j` 次交易的最大利润，此为全局最优
* 局部最优值是比较**前一天并少交易一次的全局最优加上大于0的差值**，和**前一天的局部最优加上差值**中取较大值
* 全局最优是比较**局部最优**和**前一天的全局最优**

```js
var maxProfit = function(prices) {
  if (!prices.length) return 0; 

  let local = [[0, 0, 0]];
  let global = [[0, 0, 0]];
  
  for (let i = 1; i < prices.length; i++) {
    let diff = prices[i] - prices[i - 1];
    local[i] = [0];
    global[i] = [0];

    for (let j = 1; j <= 2; j++) {
      local[i][j] = Math.max(global[i - 1][j - 1] + Math.max(diff, 0), local[i - 1][j] + diff);      
      global[i][j] = Math.max(local[i][j], global[i - 1][j]);
    }
    
  }

  return global[prices.length - 1][2];
};
```

### 最佳买卖股票时机含冷冻期（leetcode 题目编号 309）

**问题：**
给定一个整数数组，其中第 i 个元素代表了第 i 天的股票价格 。​

设计一个算法计算出最大利润。在满足以下约束条件下，你可以尽可能地完成更多的交易（多次买卖一支股票）:

你不能同时参与多笔交易（你必须在再次购买前出售掉之前的股票）。
卖出股票后，你无法在第二天买入股票 (即冷冻期为 1 天)。

**示例：**
示例1:

输入: [1,2,3,0,2]
输出: 3 
解释: 对应的交易状态为: [买入, 卖出, 冷冻期, 买入, 卖出]

**思路：**
* 设 `buy[i]` 表示在第 `i` 天之前最后一个操作是买，此时的最大收益。
* 设 `sell[i]` 表示在第 `i` 天之前最后一个操作是卖，此时的最大收益。
* 则可以得出递推公式 `buy[i]  = max(sell[i-2] - price, buy[i-1])` 、`sell[i] = max(buy[i-1] + price, sell[i-1])`

```js
var maxProfit = function(prices) {
  if (!prices.length) return 0; 

  let buy = [];
  let sell = [];

  for (let i = 0; i < prices.length; i++) {
    if (i === 0) {
      buy[i] = -prices[0];
      sell[i] = 0;
    } else if (i === 1) {
      buy[i] = Math.max(-prices[1], buy[i - 1]);
      sell[i] = Math.max(prices[1] - prices[0], sell[i - 1]);
    } else {
      buy[i] = Math.max(sell[i - 2] - prices[i], buy[i - 1]);
      sell[i] = Math.max(buy[i - 1] + prices[i], sell[i - 1]);
    }
  }

  return sell[prices.length - 1];
};
```

